=========================
Preparing Backing MongDBs
=========================

.. default-domain:: mms

Overview
--------

Backing databases store the |mms| application data needed for operations.
At minimum, these databases are a two-node replica set. Details will
depend on your deployment and operational needs.

The backing replica sets store this application data:

- Monitoring data collected from monitoring agents.

- Meta data for MMS users, groups, hosts, monitoring data, and backup state.

- Configuration data for the databases.

- The Blockstore which contains backup snapshot data.

While one replica set can store all application data, the Blockstore data
size is large enough to store in a dedicated replica set. Larger scale
deployments should consider dividing application data across more than two
replica sets. As you design the backing MongoDBs for your application,
resources with a ``mongoUri`` value in the
``<install_dir>/conf/conf-mms.properties`` file are candidates for a
replica set.

Prerequisites
-------------

Read the :manaual:`MongoDB Production Notes
</administration/production-notes>` before installing
MongoDB and other software on your servers. If you are deploying MMS
on Amazon AWS, please see ::doc:`/management/tutorial/configure-aws-hosts`.

Setup and Install Replica Sets
------------------------------

To create replica sets, start the :program:`mongod` instances for each
member of a new replica set, configure the replica set, then add the
:program:`mongod` instances to the replica set.

The :manual:`Deploy a Replica Set </tutorial/deploy-replica-set>` guide
has step by step details how to setup and deploy replica sets for use as
backing MongoDBs for MMS.

Replication Configuration
-------------------------

The backing MongoDB store uses a connection string URI defined in the
``<install_dir>/conf/conf-mms.properties`` directory.

Edit conf-mms.properties to define the replication hosts. For example:

.. code-block:: ini

   mongo.mongoUri=mongodb://host1:40000,host2:40000,host3:40000/?maxPoolSize=100
   mongo.replicaSet=mmsreplset

See :manual:`Connection String URI Format
</reference/connection-string/>` for more information.

