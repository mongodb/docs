================
Alert Conditions
================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: twocols

Introduction
------------

This page describes the conditions for which you can trigger alerts related to
your clusters. You specify conditions and thresholds when :doc:`configuring
alerts </configure-alerts>`.

.. include:: /includes/fact-groups-projects-synonyms.rst

Host Alerts
-----------

The conditions in this section apply if you select :guilabel:`Host` as the
alert target when configuring the alert. You can apply the condition to all
hosts or to specific type of host, such as :term:`primaries <primary>` or
:term:`config servers <config server>`.

Asserts
~~~~~~~

The following alert conditions measure the rate of asserts for a MongoDB
process, as collected from the MongoDB ``serverStatus`` command's
:serverstatus:`asserts` document. You can view asserts through :doc:`cluster
monitoring </monitor-cluster-metrics>`.

.. alert:: Asserts: Regular is

   Sends an alert if the rate of regular asserts meets the specified
   threshold.

.. alert:: Asserts: Warning is

   Sends an alert if the rate of warnings meets the specified threshold.

.. alert:: Asserts: Msg is

   Sends an alert if the rate of message asserts meets the specified
   threshold. Message asserts are internal server errors. Stack traces are
   logged for these.

.. alert:: Asserts: User is

   Sends an alert if the rate of errors generated by users meets the specified
   threshold.

Opcounter
~~~~~~~~~

The following alert conditions measure the rate of database operations on a
MongoDB process since the process last started, as collected from the MongoDB
``serverStatus`` command's :serverstatus:`opcounters` document. You can view
opcounters through :doc:`cluster monitoring </monitor-cluster-metrics>`.

.. alert:: Opcounter: Cmd is

   Sends an alert if the rate of commands performed meets the specified
   threshold.

.. alert:: Opcounter: Query is

   Sends an alert if the rate of queries meets the specified threshold.

.. alert:: Opcounter: Update is

   Sends an alert if the rate of updates meets the specified threshold.

.. alert:: Opcounter: Delete is

   Sends an alert if the rate of deletes meets the specified threshold.

.. alert:: Opcounter: Insert is

   Sends an alert if the rate of inserts meets the specified threshold.

.. alert:: Opcounter: Getmores is

   Sends an alert if the rate of ``getmore`` operations to retrieve the next
   cursor batch meets the specified threshold. See `Cursor Batches
   <https://docs.mongodb.com/manual/core/cursors/#cursor-batches>`_ in the
   MongoDB manual.

Opcounter - Repl
~~~~~~~~~~~~~~~~

The following alert conditions measure the rate of database operations on
MongoDB :term:`secondaries <secondary>`, as collected from the MongoDB
``serverStatus`` command's :serverstatus:`opcountersRepl` document. You can
view these metrics on the :guilabel:`Opcounters - Repl` chart, accessed
through :doc:`cluster monitoring </monitor-cluster-metrics>`.

.. alert:: Opcounter: Repl Cmd is

   Sends an alert if the rate of replicated commands meets the specified
   threshold.

.. alert:: Opcounter: Repl Update is

   Sends an alert if the rate of replicated updates meets the specified
   threshold.

.. alert:: Opcounter: Repl Delete is

   Sends an alert if the rate of replicated deletes meets the specified
   threshold.

.. alert:: Opcounter: Repl Insert is

   Sends an alert if the rate of replicated inserts meets the specified
   threshold.

Atlas Free Tier
~~~~~~~~~~~~~~~

.. alert:: Logical Size is

   Sends an alert if the total size of the data and indexes is outside
   the specified threshold.

   *Applicable for Atlas Free Tier Only*

Memory
~~~~~~

The following alert conditions measure memory for a MongoDB process, as
collected from the MongoDB ``serverStatus`` command's :serverstatus:`mem`
document. You can view these metrics on the |service| :guilabel:`Memory` and
:guilabel:`Non-Mapped Virtual Memory` charts, accessed through :doc:`cluster
monitoring </monitor-cluster-metrics>`.

.. alert:: Memory: Resident is

   Sends an alert if the size of the resident memory meets the specified
   threshold. It is typical over time, on a dedicated database server, for the
   size of the resident memory to approach the amount of physical RAM on the
   box.

.. alert:: Memory: Virtual is

   Sends an alert if the size of virtual memory for the :manual:`mongod
   </reference/program/mongod>` process meets the specified threshold. You can
   use this alert to flag excessive memory outside of memory mapping. For more
   information, click the :guilabel:`Memory` chart's :guilabel:`i` icon.

.. alert:: Memory: Computed is

   Sends an alert if the size of virtual memory that is not accounted for by
   memory-mapping meets the specified threshold. If this number is very high
   (multiple gigabytes), it indicates that excessive memory is being used
   outside of memory mapping. For more information on how to use this metric,
   view the :guilabel:`Non-Mapped Virtual Memory` chart and click the chart's
   :guilabel:`i` icon.

Connections
~~~~~~~~~~~

The following alert condition measures connections to a MongoDB process, as
collected from the MongoDB ``serverStatus`` command's
:serverstatus:`connections` document. You can view this metric on the
|service| :guilabel:`Connections` chart, accessed through :doc:`cluster
monitoring </monitor-cluster-metrics>`.

.. alert:: Connections is

   Sends an alert if the number of active connections to the host meets
   the specified average.

Queues
~~~~~~

The following alert conditions measure operations waiting on locks, as
collected from the MongoDB ``serverStatus`` command's
:serverstatus:`globalLock` document. You can view these metrics on the
|service| :guilabel:`Queues` chart, accessed through :doc:`cluster monitoring
</monitor-cluster-metrics>`.

.. alert:: Queues: Total is

   Sends an alert if the number of operations waiting on a
   :term:`lock` of any type meets the specified average.

.. alert:: Queues: Readers is

   Sends an alert if the number of operations waiting on a :term:`read
   lock` meets the specified average.

.. alert:: Queues: Writers is

   Sends an alert if the number of operations waiting on a :term:`write
   lock` meets the specified average.

Page Faults
~~~~~~~~~~~

The following alert condition measures the rate of page faults for a MongoDB
process, as collected from the MongoDB ``serverStatus`` command's
:serverstatus:`extra_info.page_faults` field.

.. alert:: Page Faults is

   Sends an alert if the rate of page faults (whether or not an exception is
   thrown) meets the specified threshold. You can view this metric on the
   |service| :guilabel:`Page Faults` chart, accessed through :doc:`cluster
   monitoring </monitor-cluster-metrics>`.

Cursors
~~~~~~~

The following alert conditions measure the number of :manual:`cursors
</core/cursors>` for a MongoDB process, as collected from the MongoDB
``serverStatus`` command's :serverstatus:`metrics.cursor` document. You can
view these metrics on the |service| :guilabel:`Cursors` chart, accessed
through :doc:`cluster monitoring </monitor-cluster-metrics>`.

.. alert:: Cursors: Open is

   Sends an alert if the number of cursors the server is maintaining for
   clients meets the specified average.

.. alert:: Cursors: Timed Out is

   Sends an alert if the number of timed-out cursors the server is
   maintaining for clients meets the specified average.

Network
~~~~~~~

The following alert conditions measure throughput for MongoDB process, as
collected from the MongoDB ``serverStatus`` command's :serverstatus:`network`
document. You can view these metrics on a host's :guilabel:`Network` chart,
accessed through :doc:`cluster monitoring </monitor-cluster-metrics>`.

.. alert:: Network: Bytes In is

   Sends an alert if the number of bytes sent *to* MongoDB meet the specified
   threshold.

.. alert:: Network: Bytes Out is

   Sends an alert if the number of bytes sent *from* MongoDB meet the specified
   threshold.

.. alert:: Network: Num Requests is

   Sends an alert if the number of requests sent to MongoDB meet the specified
   average.

Replication Oplog
~~~~~~~~~~~~~~~~~

The following alert conditions apply to the MongoDB process's :manual:`oplog
</core/replica-set-oplog>`. You can view these metrics on the following
charts, accessed through :doc:`cluster monitoring </monitor-cluster-metrics>`:

- :guilabel:`Replication Oplog Window`
- :guilabel:`Replication Lag`
- :guilabel:`Replication Headroom`
- :guilabel:`Oplog GB/Hour`

The following alert conditions apply to the oplog:

.. alert:: Replication Oplog Window is

   Sends an alert if the approximate amount of time available in the
   :term:`primary's <primary>` replication :term:`oplog` meets the specified
   threshold.

.. alert:: Replication Lag is

   Sends an alert if the approximate amount of time that the :term:`secondary`
   is behind the primary meets the specified threshold. |service| calculates
   replication lag using the approach described in :ref:`Check the Replication
   Lag <replica-set-replication-lag>` in the MongoDB manual.

.. alert:: Replication Headroom is

   Sends an alert when the difference between the sync source member's oplog
   window and the replication lag time on the secondary meets the specified threshold.

.. alert:: Oplog Data Per Hour is

   Sends an alert when the amount of data per hour being written to a
   primary's oplog meets the specified threshold.

DB Storage
~~~~~~~~~~

The following alert conditions apply to database storage, as collected for a
MongoDB process by the MongoDB :manual:`dbStats </reference/command/dbStats>`
command. The conditions are based on the summed total of **all databases** on
the MongoDB process:

.. alert:: DB Storage is

   Sends an alert if the allocated storage meets the specified threshold. This
   alert condition can be viewed on a host's :guilabel:`DB Storage` chart,
   accessed through :doc:`cluster monitoring </monitor-cluster-metrics>`.

.. alert:: DB Data Size is

    Sends an alert if approximate size of all documents (and their paddings)
    meets the specified threshold.

WiredTiger Storage Engine
~~~~~~~~~~~~~~~~~~~~~~~~~

The following alert conditions apply to the MongoDB process's
:manual:`WiredTiger </core/wiredtiger>` storage engine, as collected from the
MongoDB ``serverStatus`` command's :serverstatus:`wiredTiger.cache` and
:serverstatus:`wiredTiger.concurrentTransactions` documents.

You can view these metrics on the following charts, accessed through
:doc:`cluster monitoring </monitor-cluster-metrics>`:

- :guilabel:`Tickets Available`
- :guilabel:`Cache Activity`
- :guilabel:`Cache Usage`

The following are the alert conditions that apply to WiredTiger:

.. alert:: Tickets Available: Reads is

   Sends an alert if the number of read tickets available to the
   WiredTiger storage engine meet the specified threshold.

.. alert:: Tickets Available: Writes is

   Sends an alert if the number of write tickets available to the
   WiredTiger storage engine meet the specified threshold.

.. alert:: Cache: Dirty Bytes is

   Sends an alert when the number of dirty bytes in the WiredTiger cache
   meets the specified threshold.

.. alert:: Cache: Used Bytes is

   Sends an alert when the number of used bytes in the WiredTiger cache
   meets the specified threshold.

.. alert:: Cache: Bytes Read Into Cache is

   Sends an alert when the number of bytes read into the WiredTiger cache
   meets the specified threshold.

.. alert:: Cache: Bytes Written From Cache is

   Sends an alert when the number of bytes written from the WiredTiger
   cache meets the specified threshold.

System and Disk Alerts
~~~~~~~~~~~~~~~~~~~~~~

The following alert conditions measure usage on your |service| server instances:

.. alert:: System: CPU (Steal) % is

   *Applicable when the EC2 instance credit balance is exhausted.*

   The percentage by which the CPU usage exceeds the guaranteed
   baseline CPU credit accumulation rate. CPU credits are units of CPU
   utilization that you accumulate. The credits accumulate at a
   constant rate to provide a guaranteed level of performance. These
   credits can be used for additional CPU performance. When the credit
   balance is exhausted, only the guaranteed baseline of CPU
   performance is provided, and the amount of excess is shown as steal
   percent.

.. alert:: System: CPU (User) % is

   The normalized CPU usage of the MongoDB process, which is scaled to a range of 0-100%.

.. alert:: Disk space % used on Data Partition is

   The percentage of disk space used on any partition that contains the
   MongoDB collection data.

.. alert:: Disk space % used on Index Partition is

   The percentage of disk space used on any partition that contains the
   MongoDB index data.

.. alert:: Disk space % used on Journal Partition is

   The percentage of disk space used on the partition that contains the
   MongoDB journal, if journaling is enabled.

.. alert:: Disk I/O % utilization on Data Partition is

   The percentage of time during which requests are being issued to any
   partition that contains the MongoDB collection data. This includes requests
   from any process, not just MongoDB processes.

.. alert:: Disk I/O % utilization on Index Partition is

   The percentage of time during which requests are being issued to any
   partition that contains the MongoDB index data. This includes requests from
   any process, not just MongoDB processes.

.. alert:: Disk I/O % utilization on Journal Partition is

   The percentage of time during which requests are being issued to the
   partition that contains the MongoDB journal, if journaling is enabled. This
   includes requests from any process, not just MongoDB processes.

Inapplicable Host Conditions
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The following host conditions do not apply to |service|. |service| will
not generate alerts for the following conditions:

- Memory: Mapped is

- B-tree: accesses is

- B-tree: hits is

- B-tree: misses is

- B-tree: miss ratio is

- Effective Lock % is

- Background Flush Average is

- Accesses Not In Memory: Total is

- Page Fault Exceptions Thrown: Total is

- Cursors: Client Cursors Size is

- Journaling Commits in Write Lock is

- Journaling MB is

- Journaling Write Data Files MB is

Query Targeting Alerts
----------------------

The following alerts may indicate a need for indexes to improve the
efficiency of your read operations. For more information on indexing,
refer to :manual:`Indexing Strategies </applications/indexes>`.

.. alert:: Query Targeting: Scanned / Returned

   Sends an alert if the ratio of documents scanned to documents returned
   meets the specified threshold.

.. alert:: Query Targeting: Scanned Objects / Returned

   Sends an alert if the ratio of index items scanned to documents returned
   meets the specified threshold.

Replica Set Alerts
------------------

The following alert condition applies to :term:`replica sets <replica set>`:

.. alert:: Replica set has no primary

   Sends an alert when a replica set does not have a :term:`primary`.
   Specifically, when none of the members of a
   replica set have a status of ``PRIMARY``, the alert triggers. For
   example, this condition may arise when a set has an even number of
   voting members resulting in a tie.

   If |service| collects data during an :manual:`election for primary
   </core/replica-set-elections>`, this alert might send a false positive. To
   prevent such false positives, set the alert configuration's
   :guilabel:`after waiting` interval (in the configuration's :guilabel:`Send
   to` section).

Sharded Cluster Alerts
----------------------

The following alert condition applies to :term:`sharded clusters <sharded
cluster>`:

.. alert:: Cluster is missing an active mongos

   Sends an alert if |service| cannot reach a :program:`mongos <bin.mongos>` for the cluster.

.. _backup-alert-conditions:

Backup Alerts
-------------

The following alert conditions apply to your cluster :doc:`backups
</backup-cluster>`, if enabled:

.. alert:: Backup oplog is behind

   Sends an alert if the most recent :term:`oplog` data received by |service| is
   more than 75 minutes old.

.. alert:: Backup requires a resync

   Sends an alert if the replication process for a backup falls too far
   behind the :term:`oplog` to catch up. This occurs when the host
   overwrites oplog entries that backup has not yet replicated. When this
   happens, you must resync backup.

User Alerts
-----------

The following alert conditions apply to |service| users.

.. alert:: User joined the project

   Sends an alert when a new user joins the |service| project.

.. alert:: User left the project

   Sends an alert when a user leaves the |service| project.

.. alert:: User had their role changed

   Sends an alert when an |service| user's roles have changed.

Project Alerts
--------------

The following alert conditions apply to your |service| project.

.. alert:: Users awaiting approval to join project

   Sends an alert if there are users who have asked to join the project. A user
   can ask to join a project when first registering for |service|.

.. alert:: Users do not have two-factor authentication enabled

   Sends an alert if the project has users who have not set up two-factor
   authentication.

Billing Alert
-------------

The following alert condition applies to |service| billing.

.. alert:: Credit card is about to expire

   Sends an alert if the credit card on file is about to expire. The alert is
   triggered at the beginning of the month that the card expires. |service|
   enables this alert when a credit card is added for the first time.

.. alert:: Daily amount billed ($) is above threshold

   The project's last daily amount billed exceeds your
   configured threshold. |service| does not account for any credits
   applied for the previous day when calculating the billed amount.

   .. note::

      The amount billed is in :abbr:`USD (United States Dollars)`.

.. alert:: Project pending invoice ($) total is above threshold

   The project's pending monthly invoice exceeds your configured threshold. When
   the current pending invoice closes, this alert resets.

   This alert resolves automatically if you pay enough to bring the pending
   invoice below the threshold. It may take up to 24 hours for the payment to
   clear. This alert can repeat if the pending invoice exceeds the threshold
   again before the invoice closes.

   .. note::

      The amount billed is in :abbr:`USD (United States Dollars)`.
