=======================================
Install the Monitoring Agent on Windows
=======================================

.. start-content

.. include:: /includes/install-saas-registration.rst

If you have not downloaded the Monitoring agent already, you can click
the "Settings" link immediately after you sign into MMS, select
"Settings" and then click on "MMS Agent" to download an agent
specifically configured for your account.

Install Agent Software
~~~~~~~~~~~~~~~~~~~~~~

The Monitoring agent distribution download includes a ``WINDOWS.txt``
file with instructions for using the agent on Windows platforms. Before
you can use the agent on Windows platforms, you must ensure your system
meets the system requirements.

The following tutorial will ensure you have installed all required
packages.

#. If you do not have a 2.x-series Python installation on your system,
   install the latest version of Python 2.7.x. If your system supports
   64-bit executable, use the 64-bit version.

#. Use the Windows installer to install `PyMongo from PyPi
   <http://pypi.python.org/pypi/pymongo/>`_. Ensure that you install the
   correct PyMongo build for your Python installation both in terms of
   version number (e.g .2.6, 2.7, etc.) and system architecture (e.g. 32
   or 64-bit.)

   See the `Python Download Page <http://www.python.org/download/>`_ for
   the most up to date Python distribution downloads, or use the direct
   link for the `Python 2.7 64-bit Windows Installer`_

#. If you do not have Windows PowerShell version 2.0 to install,
   install it now. PowerShell is available as part of the `Windows
   Management Framework <http://support.microsoft.com/kb/968929>`_.

   Check your installed version of PowerShell by starting a PowerShell
   command window and issuing the following command:

   .. code-block:: powershell

      Get-Host

   Install the correct version if your version number is lower than 2.0.

#. Enable script execution in PowerShell. After installing the correct
   version, right click the PowerShell icon in the "Start Menu," and
   run PowerShell as administrator. Issue the following command:
   
   .. code-block:: powershell

      Get-ExecutionPolicy

   This returns the current execution policy. Save this value for future
   use. If the policy is "``Unrestricted``" you can proceed to the next
   step. If the policy is not "``Unrestricted``" issue the following
   command:
   
   .. code-block:: powershell

      Set-ExecutionPolicy -ExecutionPolicy Unrestricted

   Confirm the policy change when prompted.

#. Start an administrator command window. Change to the folder
   containing the Monitoring agent files. Run ``mongommsinstall.bat``. If this
   succeeds, the Monitoring agent will be running and will start on system
   boot.
  
.. _`Python 2.7 64-bit Windows Installer`: http://www.python.org/ftp/python/2.7.2/python-2.7.2.amd64.msi

Now you can start and stop the Windows service to control the MMS
agent. Consult the ``WINDOWS.txt`` file for more information.

If you have changed the execution policy, after the installation has
completed successfully set it back to its original value using the
following command:

.. code-block:: powershell

   Set-ExecutionPolicy -ExecutionPolicy <original value>

Replace "``<original value>``" with the value that you recorded above.

.. end-content

.. note:: 

   The Monitoring agent does have some resource requirements and
   should run on separate systems to avoid impacting ``mongod`` and
   ``mongos`` performance. To monitor five or fewer nodes, you can
   safely deploy on an AWS "micro instance." Similarly, if you are
   only monitoring a small number of databases, you may be able to
   deploy the agent on the system running the ``mongos`` process.
   Running PyMongo with the native extensions, which requires GCC,
   provides significant performance improvements.

Next Steps
----------

Now that you have properly configured your machines and installed 
the Monitoring agent software, you can  :doc:`deploy the Monitoring
agent in production </monitoring/tutorial/deploy-mms-in-production>`.

