.. facet::
   :name: programming_language
   :values: csharp, go, java, javascript/typescript, python

.. meta::
   :keywords: code example, node.js, compass, java sync
   :description: Build a CSFLE-enabled application using Azure Key Vault to encrypt fields in MongoDB documents automatically.

.. _csfle-tutorial-automatic-azure:

===========================================================
Use Automatic {+csfle+} with Azure
===========================================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

.. composable-tutorial::
   :options: language-no-dependencies
   :defaults: nodejs

   Overview
   --------

   This guide shows you how to build a {+csfle+} ({+csfle-abbrev+})-enabled
   application using {+azure-kv+}.

   After you complete the steps in this guide, you should have:

   - A {+cmk-long+} hosted on an {+azure-kv+} instance.
   - A working client application that inserts {+in-use-docs+}
     using your {+cmk-long+}.

   Before You Get Started
   ----------------------

   .. include:: /includes/set-up-section.rst

   .. include:: /includes/fact-csfle-placeholder.rst

   .. include:: /includes/select-your-language.rst

   Full Application Code
   ~~~~~~~~~~~~~~~~~~~~~

   To see the complete code for the sample application, select your programming
   language in the language selector.

   .. selected-content:: 
      :selections: java-sync

      `Complete Java Application <{+sample-app-url-csfle+}/java/azure/reader/>`__

   .. selected-content:: 
      :selections: nodejs

      `Complete Node.js Application <{+sample-app-url-csfle+}/node/azure/reader/>`__

   .. selected-content:: 
      :selections: python

      `Complete Python Application <{+sample-app-url-csfle+}/python/azure/reader/>`__

   .. selected-content:: 
      :selections: csharp

      `Complete C# Application <{+sample-app-url-csfle+}/dotnet/azure/reader/CSFLE/>`__

   .. selected-content:: 
      :selections: go

      `Complete Go Application <{+sample-app-url-csfle+}/go/azure/reader/>`__

   Set Up the KMS
   --------------

   .. procedure::
      :style: normal

      .. step:: Register your Application with Azure

         a. Log in to `Azure <https://azure.microsoft.com/en-us/features/azure-portal/>`__.     

         #. Register your Application with Azure Active Directory

            .. _csfle-tutorial-automatic-azure-register:

            To register an application on Azure Active Directory,
            follow Microsoft's official
            `Register an application with the Microsoft identity platform <https://docs.microsoft.com/en-us/azure/active-directory/develop/quickstart-register-app>`__
            Quick Start.

            .. include:: /includes/tutorials/automatic/azure/record-credentials.rst

      .. step:: Create the {+cmk-long+}

         .. _aws-create-master-key:

         .. include:: /includes/tutorials/automatic/azure/cmk.rst

   Create the Application
   ----------------------

   .. selected-content:: 
      :selections: java-sync

      .. include:: /includes/csfle/javasync-azure-automatic-steps.rst    

   .. selected-content:: 
      :selections: nodejs

      .. include:: /includes/csfle/nodejs-azure-automatic-steps.rst

   .. selected-content:: 
      :selections: python

      .. include:: /includes/csfle/python-azure-automatic-steps.rst


   .. selected-content:: 
      :selections: csharp

      .. include:: /includes/csfle/csharp-azure-automatic-steps.rst

   .. selected-content:: 
      :selections: go

      .. include:: /includes/csfle/go-azure-automatic-steps.rst

Learn More
----------

To learn how {+csfle-abbrev+} works, see
:ref:`<csfle-fundamentals>`.

To learn more about the topics mentioned in this guide, see the
following links:

- Learn more about CSFLE components on the :ref:`Reference <csfle-reference>` page.
- Learn how {+cmk-long+}s and {+dek-long+}s work on the :ref:`<qe-reference-keys-key-vaults>` page
- See how KMS Providers manage your CSFLE keys on the :ref:`<qe-fundamentals-kms-providers>` page.


