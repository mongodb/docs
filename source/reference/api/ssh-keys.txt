========
SSH Keys
========

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: twocols

Overview
--------

The ``sshKeys`` resource displays the public keys available to choose from
when you provision servers through |mms|'s integration with a cloud service
provider. When you provision a new server, |mms| adds the public key to the
server's authorized keys list. You must have the corresponding private key to
log into the provisioned server.

For more information on |mms| integration with cloud service providers, see
:doc:`/tutorial/nav/provision-cloud-servers`.

Endpoints
---------

Get All SSH Keys for the Group
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. code-block:: none

   GET /api/public/v1.0/groups/GROUP-ID/sshKeys

Get an SSH Key by ID
~~~~~~~~~~~~~~~~~~~~

.. code-block:: none

   GET /api/public/v1.0/groups/GROUP-ID/sshKeys/KEY-ID

Get an SSH Key by Name
~~~~~~~~~~~~~~~~~~~~~~

.. code-block:: none

   GET /api/public/v1.0/groups/GROUP-ID/sshKeys/byName/KEY-NAME

.. QUESTION for reviewer: Is the above enabled?
.. 
.. 

Add an SSH Key
~~~~~~~~~~~~~~

.. code-block:: none

   POST /api/public/v1.0/groups/GROUP-ID/sshKeys

Delete an SSH Key
~~~~~~~~~~~~~~~~~

.. code-block:: none

   DELETE /api/public/v1.0/groups/GROUP-ID/sshKeys/KEY-ID

.. QUESTION for reviewer: Can you also delete by KEY-NAME?
.. 
.. 

Sample Entity
-------------

.. code-block:: javascript

   {
     "id" : "545e3e3ae4b08a04fbc21005",
     "name" : "myKey",
     "publicKey" : "<ssh-key>",
     "links" : [ ... ],
   }

Entity Fields
-------------

.. list-table::
   :widths: 10 10 80
   :header-rows: 1

   * - Name
     - Type
     - Description

   * - ``id``
     - string
     - Unique identifier.

   * - ``name``
     - string
     - The name of the public key as it appears in |mms| :guilabel:`Provisioning Settings`.
       For more information on provisioning, see :doc:`/tutorial/nav/provision-cloud-servers`.

   * - ``publicKey``
     - string
     - The contents of the public key.

Links
-----

.. list-table::
   :header-rows: 1

   * - Relation
     - Description

   * - ``self``
     - Me

   * - ``http://mms.mongodb.com/group``
     - The group the SSH key belongs to

Examples
--------

Get All SSH Keys
~~~~~~~~~~~~~~~~

Request
```````

.. code-block:: none

   curl -u "username:apiKey" --digest -i "https://cloud.mongodb.com/api/public/v1.0/groups/5421e044e4b09da19248b17f/sshKeys"

Response
````````

.. code-block:: none

   HTTP/1.1 200 OK

   {
     "totalCount" : 1,
     "results" : [ {
       "id" : "545e3e3ae4b08a04fbc21005",
       "name" : "myKey",
       "publicKey" : "<ssh-key>",
       "links" : [ ... ]
     }, { ...} ],
     "links" : [ ... ]
   }

Get an SSH Key by ID
~~~~~~~~~~~~~~~~~~~~

Request
```````

.. code-block:: none

   curl -u "username:apiKey" --digest -i "https://cloud.mongodb.com/api/public/v1.0/groups/5421e044e4b09da19248b17f/sshKeys/545e3e3ae4b08a04fbc21005"

Response
````````

.. code-block:: none

   HTTP/1.1 200 OK

   {
     "id" : "545e3e3ae4b08a04fbc21005",
     "name" : "myKey",
     "publicKey" : "<ssh-key>",
     "links" : [ ... ]
   }

Add an SSH Key
~~~~~~~~~~~~~~

Request
```````

.. code-block:: none

   curl -u "username:apiKey" --digest -i -H "Content-Type: application/json" -X POST "https://cloud.mongodb.com/api/public/v1.0/groups/5421e044e4b09da19248b17f/sshKeys" --data '
   {
     "name" : "myKey",
     "publicKey" : "<ssh-key>"
   }'

Response
````````

.. code-block:: none

   HTTP/1.1 201 Created

   {
     "id" : "54c7a8bee4b0b5a9451be44e",
     "name" : "myKey",
     "publicKey" : "<ssh-key>",
     "links" : [ ... ]
   }

Delete an SSH Key
~~~~~~~~~~~~~~~~~

Request
```````

.. code-block:: none

   curl -u "username:apiKey" --digest -i -X DELETE "https://cloud.mongodb.com/api/public/v1.0/groups/5421e044e4b09da19248b17f/sshKeys/545e3e3ae4b08a04fbc21005"

Response
````````

.. code-block:: none

   HTTP/1.1 200 OK

   {}
