===========================
{+mdbagent+} Prerequisites
===========================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. include:: /includes/styles/corrections.rst

.. tabs-pillstrip:: platforms

This section describes the requirements for the hosts that run the 
:doc:`MongoDB Agent </tutorial/nav/mongodb-agent>`.

.. cond:: cloud

   .. _cloud-manager-agent-os-compatibility:

   Operating Systems Compatible with the MongoDB Agent
   -----------------------------------------------------

   The following platforms support {+mdbagent+} working with MongoDB 4.0
   and later.

   - :ref:`Intel/AMD (x86_64) Hardware Architectures <intel_arch>`
   - :ref:`PowerPC (ppc64le) Hardware Architectures <ppc_arch>`
   - :ref:`IBM zSeries (s390x) Hardware Architectures <zseries_arch>`
   - :ref:`ARM64 Hardware Architectures <arm64_arch>`

   .. _intel_arch:

   Intel/AMD (``x86_64``) Hardware Architectures
   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

   - :ref:`MongoDB Server 5.0.x on x86_64 <cloud-manager-agent-mdb5-86-64>`
   - :ref:`MongoDB Server 4.4.x on x86_64 <cloud-manager-agent-mdb44-86-64>`
   - :ref:`MongoDB Server 4.2.x on x86_64 <cloud-manager-agent-mdb42-86-64>`
   - :ref:`MongoDB Server 4.0.x on x86_64 <cloud-manager-agent-mdb40-86-64>`

   .. _cloud-manager-agent-mdb5-86-64:

   MongoDB Server 5.0.x on x86_64
   ```````````````````````````````

   Hosts that run {+mdbagent+}s must run on a 64-bit version of one of
   the following operating systems on the ``x86_64`` architectures:

   .. list-table::
      :widths: 40 30 30
      :header-rows: 1

      * - Operating System
        - MongoDB 5.0.x Community
        - MongoDB 5.0.x Enterprise
      * - Amazon Linux
        - 2 LTS
        - 2 LTS
      * - Debian
        - 9, 10, 11
        - 9, 10, 11
      * - Red Hat Enterprise Linux / CentOS
        - 7.x, 8.x
        - 7.x, 8.x
      * - SUSE Linux Enterprise Server
        - 12, 15
        - 12, 15
      * - Ubuntu
        - 18.x, 20.x
        - 18.x, 20.x
      * - Windows Server
        - 2016, 2019, 2020
        - 2016, 2019, 2020
      * - Windows
        - 10
        - 10

   .. _cloud-manager-agent-mdb44-86-64:

   MongoDB Server 4.4.x on x86_64
   ````````````````````````````````

   Hosts that run {+mdbagent+}s must run on a 64-bit version of one of
   the following operating systems on the ``x86_64`` architectures:

   .. list-table::
      :widths: 40 30 30
      :header-rows: 1

      * - Operating System
        - MongoDB 4.4.x Community
        - MongoDB 4.4.x Enterprise
      * - Amazon Linux
        - 1, 2 LTS
        - 1, 2 LTS
      * - Debian
        - 9, 10
        - 9, 10
      * - Red Hat Enterprise Linux / CentOS
        - 7.x, 8.x
        - 7.x, 8.x
      * - SUSE Linux Enterprise Server
        - 12, 15
        - 12, 15
      * - Ubuntu
        - 18.x, 20.x
        - 18.x, 20.x
      * - macOS
        - 10.13, 10.14, 10.15
        - 10.13, 10.14, 10.15
      * - Windows Server
        - 2016, 2019
        - 2016, 2019
      * - Windows
        - 10
        - 10

   .. _cloud-manager-agent-mdb42-86-64:

   MongoDB Server 4.2.x on x86_64
   ```````````````````````````````

   Hosts that run {+mdbagent+}s must run on a 64-bit version of one of
   the following operating systems on the ``x86_64`` architectures:

   .. list-table::
      :widths: 40 30 30
      :header-rows: 1

      * - Operating System
        - MongoDB 4.2.x Community
        - MongoDB 4.2.x Enterprise
      * - Amazon Linux
        - 1, 2 LTS
        - 1, 2 LTS
      * - Debian
        - 9, 10
        - 9, 10
      * - Red Hat Enterprise Linux / CentOS
        - 7.x, 8.x
        - 7.x, 8.x
      * - SUSE Linux Enterprise Server
        - 12, 15
        - 12, 15
      * - Ubuntu
        - 16.x, 18.x
        - 16.x, 18.x
      * - MacOS
        - 10.12, 10.13, 10.14, 10.15
        - 10.12, 10.13, 10.14, 10.15
      * - Windows Server
        - 2012, 2016, 2019, 2008R2, 2012R2
        - 2012, 2016, 2019, 2008R2, 2012R2
      * - Windows
        - 7, 8, 8.1, 10
        - 7, 8, 8.1, 10

   .. _cloud-manager-agent-mdb40-86-64:

   MongoDB Server 4.0.x on x86_64
   ```````````````````````````````

   Hosts that run {+mdbagent+}s must run on a 64-bit version of one of
   the following operating systems on the ``x86_64`` architectures:

   .. list-table::
      :widths: 40 30 30
      :header-rows: 1

      * - Operating System
        - MongoDB 4.0.x Community
        - MongoDB 4.0.x Enterprise
      * - Amazon Linux
        - 1, 2 LTS
        - 1, 2 LTS
      * - Debian
        - 8, 9
        - 8, 9
      * - Red Hat Enterprise Linux / CentOS
        - 7.x
        - 7.x
      * - SUSE Linux Enterprise Server
        - 12
        - 12
      * - Ubuntu
        - 14.x, 16.x, 18.x
        - 14.x, 16.x, 18.x
      * - Windows Server
        - 2008R2, 2012, 2012R2, 2016
        - 2008R2, 2012, 2012R2, 2016

   .. _ppc_arch:

   PowerPC (``ppc64le``) Hardware Architectures
   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

   - :ref:`MongoDB Server 5.0.x on PowerPC <cloud-manager-agent-mdb5-ppc>`
   - :ref:`MongoDB Server 4.4.x on PowerPC <cloud-manager-agent-mdb44-ppc>`
   - :ref:`MongoDB Server 4.2.x on PowerPC <cloud-manager-agent-mdb42-ppc>`

   .. _cloud-manager-agent-mdb5-ppc:

   MongoDB Server 5.0.x on PowerPC
   `````````````````````````````````

   Hosts that run {+mdbagent+}s must run on a 64-bit version of one of
   the following operating systems on the ``ppc64le`` architectures:

   .. list-table::
      :widths: 40 30 30
      :header-rows: 1

      * - Operating System
        - MongoDB 5.0.x Community
        - MongoDB 5.0.x Enterprise
      * - Red Hat Enterprise Linux / CentOS
        -
        - 7.x, 8.x

   .. _cloud-manager-agent-mdb44-ppc:

   MongoDB Server 4.4.x on PowerPC
   `````````````````````````````````

   Hosts that run {+mdbagent+}s must run on a 64-bit version of one of
   the following operating systems on the ``ppc64le`` architectures:

   .. list-table::
      :widths: 40 30 30
      :header-rows: 1

      * - Operating System
        - MongoDB 4.4.x Community
        - MongoDB 4.4.x Enterprise
      * - Red Hat Enterprise Linux / CentOS
        - 7.x
        - 7.x, 8.x
      * - Ubuntu
        - 18.04
        - 18.04

   .. _cloud-manager-agent-mdb42-ppc:

   MongoDB Server 4.2.x on PowerPC
   `````````````````````````````````

   Hosts that run {+mdbagent+}s must run on a 64-bit version of one of
   the following operating systems on the ``ppc64le`` architectures:

   .. list-table::
      :widths: 40 30 30
      :header-rows: 1

      * - Operating System
        - MongoDB 4.2.x Community
        - MongoDB 4.2.x Enterprise
      * - Red Hat Enterprise Linux / CentOS
        - 
        - 7.x, 8.x
      * - Ubuntu
        - 
        - 16.x, 18.x
   
   On Ubuntu 18.x, MongoDB Server 4.2.17 is the last release that
   {+mdbagent+} supports.

   .. _zseries_arch:

   IBM zSeries (``s390x``) Hardware Architectures
   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

   - :ref:`MongoDB Server 5.0.x on zSeries <cloud-manager-agent-mdb5-s390x>`
   - :ref:`MongoDB Server 4.4.x on zSeries <cloud-manager-agent-mdb44-s390x>`
   - :ref:`MongoDB Server 4.2.x on zSeries <cloud-manager-agent-mdb42-s390x>`

   .. _cloud-manager-agent-mdb5-s390x:

   MongoDB Server 5.0.x on zSeries
   `````````````````````````````````

   Hosts that run {+mdbagent+}s must run on a 64-bit version of one of
   the following operating systems on the ``s390x`` architectures:

   .. list-table::
      :widths: 40 30 30
      :header-rows: 1

      * - Operating System
        - MongoDB 5.0 Community
        - MongoDB 5.0 Enterprise
      * - Red Hat Enterprise Linux / CentOS
        - 7.x
        - 7.x, 8.x

   .. _cloud-manager-agent-mdb44-s390x:

   MongoDB Server 4.4.x on zSeries
   ````````````````````````````````

   Hosts that run {+mdbagent+}s must run on a 64-bit version of one of
   the following operating systems on the ``s390x`` architectures:

   .. list-table::
      :widths: 40 30 30
      :header-rows: 1

      * - Operating System
        - MongoDB 4.4.x Community
        - MongoDB 4.4.x Enterprise
      * - Red Hat Enterprise Linux / CentOS
        - 7.x
        - 7.x
      * - SUSE Linux Enterprise Server (SLES)
        - 12
        - 12

   - On RHEL/CentOS 7.x, MongoDB Server 4.4.10 is the last release that
     {+mdbagent+} supports.
   - On SLES 12, MongoDB Server 4.4.6 is the last release that {+mdbagent+}
     supports.

   .. _cloud-manager-agent-mdb42-s390x:

   MongoDB Server 4.2.x on zSeries
   `````````````````````````````````

   Hosts that run {+mdbagent+}s must run on a 64-bit version of one of
   the following operating systems on the ``s390x`` architectures:

   .. list-table::
      :widths: 40 30 30
      :header-rows: 1

      * - Operating System
        - MongoDB 4.2.x Community
        - MongoDB 4.2.x Enterprise
      * - Red Hat Enterprise Linux / CentOS
        - 7.x
        - 7.x
      * - Ubuntu
        - 18.x
        - 18.x
      * - SUSE Linux Enterprise Server (SLES)
        - 12
        - 12

   - On RHEL/CentOS 7.x, the last releases that {+mdbagent+} supports are
     MongoDB Server 4.2.17 Community and MongoDB Server 4.2.9 Enterprise.
   - On Ubuntu 18.x and SLES 12, the last releases that {+mdbagent+}
     supports are MongoDB Server 4.2.9 Community and
     MongoDB Server 4.2.14 Enterprise.

   .. _arm64_arch:

   ARM64 Hardware Architectures
   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~

   - :ref:`MongoDB Server 5.0.x on ARM64 <cloud-manager-agent-mdb5-arm64>`
   - :ref:`MongoDB Server 4.4.x on ARM64 <cloud-manager-agent-mdb44-arm64>`

   .. _cloud-manager-agent-mdb5-arm64:

   MongoDB Server 5.0.x on ARM64
   `````````````````````````````

   Hosts that run {+mdbagent+}s must run on a 64-bit version of one of
   the following operating systems on the ARM64 architectures:

   .. list-table::
      :widths: 40 30 30
      :header-rows: 1

      * - Operating System
        - MongoDB 5.0.x Community
        - MongoDB 5.0.x Enterprise
      * - Red Hat Enterprise Linux
        - 8.x
        - 8.x

      * - Amazon Linux
        - 2 LTS
        - 2 LTS

   .. _cloud-manager-agent-mdb44-arm64:

   MongoDB Server 4.4.x on ARM64
   `````````````````````````````

   Hosts that run {+mdbagent+}s must run on a 64-bit version of one of
   the following operating systems on the ARM64 architectures:

   .. list-table::
      :widths: 40 30 30
      :header-rows: 1

      * - Operating System
        - MongoDB 4.4.x Community
        - MongoDB 4.4.x Enterprise
      * - Red Hat Enterprise Linux
        - 8.x
        - 8.x

      * - Amazon Linux
        - 2 LTS
        - 2 LTS

Hardware Requirements
---------------------

Use 64-bit Chip Architectures
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The {+mdbagent+} must run on 64-bit architectures.

Provide Sufficient CPU and RAM for the Backup Host
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

If you :ref:`activate backup <activate-backup>`, all {+mdbagent+} hosts
require at least 2 CPU cores and 3 GB of RAM beyond basic platform
requirements. Each backup job that the {+mdbagent+} runs further impacts
host performance.

Set Host Network Access
-----------------------

The hosts that serve the MongoDB deployments must:

- Have full network access to each other through their Fully
  Qualified Domain Names (FQDNs). Each host must reach each other host
  through the |fqdn|.

- Permit Automation to start |mongod| on a random ephemeral port and
  connect to that port when restoring your deployment from a backup.

.. tabs-platforms::

   .. tab::
      :tabid: windows

      - Find the |fqdn| for each host. Run the following command in
        Powershell:

        .. code-block:: powershell

           net config workstation | findstr /C:"Full Computer name"

      - Download and install the
        `Windows BIND <http://www.isc.org/downloads/>`__ tools.

   .. tab::
      :tabid: debian

      - Find the |fqdn| for each host. Run the following command in
        the shell:

        .. code-block:: sh

           hostname -f

   .. tab::
      :tabid: rhel

      - Find the |fqdn| for each host. Run the following command in
        the shell:

        .. code-block:: sh

           hostname -f

   .. tab::
      :tabid: linux

      - Find the |fqdn| for each host. Run the following command in
        the shell:

        .. code-block:: sh

           hostname -f

- Resolve each |fqdn| to a unique IP address. Run the following
  command in the shell to resolve the |fqdn|:

  .. code-block:: shell

     dig +short myip.opendns.com @resolver1.opendns.com

- Set the Common Name or :rfc:`Subject Alternative Name <3280>` value
  of any |ssl| certificates to the MongoDB host's |fqdn|.

The network configuration must allow each {+mdbagent+} to
make a direct connection to each MongoDB deployment listed on the
:guilabel:`Deployment` page. |mms| does not support port forwarding.

.. tabs-platforms::

   .. tab::
      :tabid: windows

      Disable Windows Firewall Stealth Mode
      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

      For best performance,
      `Disable Windows Firewall stealth mode <https://support.microsoft.com/en-us/help/2586744/disable-stealth-mode>`__
      on the MongoDB hosts on which you installed the {+mdbagent+}.

Set Host Permissions
--------------------

On a Host that Already Runs MongoDB
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

If you install the {+mdbagent+} on a host that is running a MongoDB
process, the agent must have:

- Permission to stop any MongoDB processes. The {+mdbagent+} restarts the
  process using the Agent's own set of MongoDB binaries. If you installed
  MongoDB with a package manager, use the same package manager to install
  the {+mdbagent+}. This gives the {+mdbagent+} the same owner as MongoDB.

- ``Read`` and ``Write`` permissions on the MongoDB data directory and
  log directory.

On a Host Before Installing MongoDB
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

If you deploy the {+mdbagent+} to a host that doesn't have MongoDB
installed, ensure the user that owns the {+mdbagent+} has ``Read`` and
``Write`` permissions on the MongoDB data and log directories you plan
to use.

.. tabs-platforms::

   .. tab::
      :tabid: debian

      Root Access
      ~~~~~~~~~~~

      To install the {+mdbagent+} using a ``deb`` package, log in as
      ``root`` or a user with ``sudo`` privileges.

   .. tab::
      :tabid: rhel

      To install the {+mdbagent+} using a ``.rpm`` package, log in as
      ``root`` or a user with ``sudo`` privileges.

   .. tab::
      :tabid: linux

      To install the {+mdbagent+} using a ``.tar`` package, log in as
      ``root`` or a user with ``sudo`` privileges.


.. _generate-agent-api-key:

.. include:: /includes/prerequisites-agent-api-key.rst

