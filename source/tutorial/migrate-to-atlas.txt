.. _migrate-to-atlas:
.. _migrate-to-atlas-cm:

===========================
Migrate from |mms| to Atlas
===========================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol


.. cond:: onprem

   *New in Ops Manager version 5.0*

Overview
--------

To live migrate data from the |mms|-managed deployments to
clusters in |service-short|, you:

1. Prepare a cluster in |service|.
#. Provision a migration host in |mms| and connect |mms| to |service-short|.
#. Start the live migration process in |service-short|.

You begin the process in |service-short|, by running the live migration wizard.
Depending on the stage in the process, you perform the live migration steps either
in |service-short| or in |mms|. See :ref:`lm-workflow`. 

To live migrate your MongoDB Community deployments to 
|service-short| using |mms|, see :ref:`migrate-community-to-atlas`.

Restrictions
------------

.. include:: /includes/migrate-to-atlas-restrictions.rst

.. _lm-prereqs:

Prerequisites
-------------

Before you begin the live migration process, follow these prerequisites.

.. cond:: onprem

   Request an External IP Address
   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
   
   Request an external IP address for |mms| from your network administrator.
   When you are ready to live migrate data, |service-short|
   uses this address for a :term:`link-token` it generates.
   When you run live migration, you push the data from a live deployment
   in |mms| to a provisioned cluster in |service-short| using the
   link-token. You generate this link-token in
   |service-short| in Stage 1 of the live migration process.
   To learn more, see
   :atlas:`Live Migrate Your Data from Ops Manager or Cloud Manager </migration-from-com>`.

Consider Configuring a VPC Peering Connection or Private Endpoints
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The following table lists the current support status for
:atlas:`VPC peering </security-vpc-peering>` and :atlas:`private endpoints </security-private-endpoint>`
for source and target clusters that you live migrate to |service|.

.. note::

   If you choose not to use VPC peering or private endpoints, the live
   migration process runs over public IP addresses that you add to the
   |service| project's :atlas:`IP access list </security/ip-access-list/#std-label-access-list>`
   as part of the live migration procedure. To learn more, see
   :atlas:`Live Migrate Your Data from Ops Manager or Cloud Manager
   </migration-from-com>`.

.. list-table::
   :widths: 20 20 60
   :header-rows: 1

   * - Cloud Provider
     - VPC Peering
     - Private Endpoints

   * - |azure|
     - :icon-fa5:`check`
     - :icon-fa5:`check` :icon-fa5:`star`
  
   * - |aws|
     - :icon-fa5:`check`
     - :icon-fa5:`check` :icon-fa5:`star`

   * - |gcp|
     - :icon-fa5:`check`
     - :icon-fa5:`check` :icon-fa5:`star`

.. important::

   :icon-fa5:`star` Sharded clusters, multi-region clusters, and multi-cloud
   clusters don't support live migration through private endpoints.
   Private endpoints are supported ONLY for live migration of replica sets
   deployed within a single cloud provider and single region.

To enable private endpoints with live migration on |azure|, |aws|, or |gcp|
on replica sets deployed within a single cloud provider and single region:

- Configure a :atlas:`private endpoint </security-private-endpoint>`
  between the migration host and the target |service| cluster and then
  choose the :guilabel:`Private Endpoint` connection type in |service| in
  the :atlas:`live migration procedure for replica sets </import/migrate-from-com-rs/>`.

To enable VPC peering with live migration on |azure|, |aws|, or |gcp| on
replica sets or sharded clusters:

- Configure a :atlas:`VPC peering connection </security-vpc-peering>`
  between the migration host and the target |service| cluster, and then
  choose the :guilabel:`VPC Peering` connection type when running live
  migration for replica sets or sharded clusters. To learn more, see
  :atlas:`Live Migrate Your Data from Ops Manager or Cloud Manager </migration-from-com>`.

.. _lm-create-atlas-cluster:

Create a Cluster in Atlas
~~~~~~~~~~~~~~~~~~~~~~~~~

Perform these tasks in |service-short|:

- :atlas:`Create an Atlas account </tutorial/create-atlas-account>`.
- :atlas:`Create an Atlas organization </tutorial/manage-organizations/#std-label-create-organization>`.
- :atlas:`Create a project </tutorial/manage-projects/#std-label-create-project>`
  in this organization.
- :atlas:`Create a new cluster </tutorial/create-new-cluster>`
  in your project.

.. _lm-workflow:

.. cond:: onprem

   Workflow for Live Migration
   ---------------------------

   The following diagram describes the stages in the live migration workflow.

   .. image:: /images/live-migration-stages.png
      :alt: "To live migrate your deployment to Atlas, generate a link-token,
            provision a migration host, and start live migration."
      :width: 700px
      :align: center

   The stages in the live migration workflow are:

   - **Stage 1: Link with Atlas**. Perform this step in |service-short|,
     after :ref:`provisioning a cluster <lm-create-atlas-cluster>`.


     a. In the left-side panel of your organization's page, click 
        :guilabel:`Live Migration`.
     #. Select :guilabel:`Migrate from Ops Manager or Cloud Manager` and start
        the live migration wizard.
     #. If you are migrating from MongoDB Community using |onprem|, read and
        accept the |onprem| Migration Agreement.
     #. In the :guilabel:`Generate Link-Token` step of the wizard, specify
        the external IP address for |onprem| that you obtained from your
        service administrator. See :ref:`Prerequisites <lm-prereqs>`.

   - **Stage 2: Provision Migration Host**.
  
     - In |mms|, :doc:`provision a Migration Host </tutorial/provision-migration-host>`.
       A migration host is a dedicated {+mdbagent+} that orchestrates the
       live migration process from |mms| to |service-short|.

     - In the :guilabel:`Live Migration: Connect to Atlas` section of your
       |mms| organization's :guilabel:`Settings` page, select
       :ref:`Connect to Atlas <connect-to-atlas-lm>` and enter the
       the link-token that you created in |service-short|.

   - **Stage 3: Start the Migration**. In |service-short|, follow the
     steps in the wizard to start the live migration process.

   To learn more, see :atlas:`Live Migrate Your Data from Ops Manager or
   Cloud Manager </migration-from-com>`.

.. cond:: cloud

   Workflow for Live Migration
   ---------------------------

   The following diagram describes the stages in the live migration workflow.

   .. image:: /images/live-migration-stages.png
      :alt: "To live migrate your deployment to Atlas, generate a link-token,
            provision a migration host, and start live migration."
      :width: 700px
      :align: center

   The stages in the live migration workflow are:

   - **Stage 1: Link with Atlas**. Perform this step in |service-short|,
     after :ref:`provisioning a cluster <lm-create-atlas-cluster>`.


     a. In the left-side panel of your organization's page in |service|,
        click :guilabel:`Live Migration`.
     #. Select :guilabel:`Migrate from Ops Manager or Cloud Manager` and start
        the live migration wizard.
     #. In the :guilabel:`Generate Link-Token` step of the wizard, create
        the link-token. You will use this link-token in the next stage.

   - **Stage 2: Provision Migration Host**.
  
     - In |mms|, :doc:`provision a Migration Host </tutorial/provision-migration-host>`.
       A migration host is a dedicated {+mdbagent+} that orchestrates the
       live migration process from |mms| to |service-short|.

     - In the :guilabel:`Live Migration: Connect to Atlas` section of your
       |mms| organization's :guilabel:`Settings` page, select
       :ref:`Connect to Atlas <connect-to-atlas-lm>` and enter the
       the link-token that you created in |service-short|.

   - **Stage 3: Start the Migration**. In |service-short|, follow the
     steps in the wizard to start the live migration process.

   To learn more, see :atlas:`Live Migrate Your Data from Ops Manager or Cloud Manager </migration-from-com>`.


Supported Platforms
~~~~~~~~~~~~~~~~~~~

Live migration to |service-short| is supported for all platforms on
which you can provision a migration host. Provisioning of the migration
host :ref:`is supported <live-migration-host-supported-platforms>` on
all platforms except for Windows or macOS. You can still live migrate
your data from a Windows-based deployment to |service-short|
if you provision your migration host on one of its supported platforms. 
You can't live migrate your data from a macOS-based deployment to 
|service-short|.

.. seealso::

   - :ref:`live-migration-host-resource-requirements`
   - :ref:`live-migration-host-supported-platforms`
   - :ref:`provision-migration-host`

