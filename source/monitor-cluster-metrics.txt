.. _monitor-cluster-metrics:

======================================
Review {+Database-Deployment+} Metrics
======================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

|service| collects and displays metrics for your servers, databases,
and MongoDB processes. 

.. include:: /includes/fact-cluster-metrics.rst

.. note::

   The number of servers that |service| displays on the 
   :guilabel:`Metrics` page at any given time depends on the browser 
   screen size. Use the :guilabel:`Toggle Members` section to control 
   which servers |service| displays. Hover over the ``S`` and ``P`` 
   icons to find out which servers they represent.

View Metrics
------------

:ref:`View Project Overview <review-all-cluster-metrics>`
   The :guilabel:`Database Deployments` view displays all the 
   {+database-deployments+} in an |service| project and features core 
   metrics per {+database-deployment+}. You can also view core metrics 
   for a specific {+database-deployment+} on the :guilabel:`Overview` 
   tab.

:ref:`View Atlas {+Serverless-Instance+} Metrics <review-serverless-metrics>`
   View the metrics for a specific {+serverless-instance+} in an 
   |service| project.

:ref:`View Atlas Replica Set Metrics <review-replica-set-metrics>`
   View the metrics for a specific replica set in an |service| 
   project.

:ref:`View Atlas Sharded Cluster Metrics <review-sharded-cluster-metrics>`
   View the metrics for a specific sharded cluster in an |service|
   project.

:ref:`View MongoDB Processes <review-mongodb-process-metrics>`
   View the metrics for a specific MongoDB process in an 
   |service| cluster.

:ref:`View Real-Time Performance Metrics <review-real-time-metrics>`
   View real-time performance metrics for a specific |service| 
   {+database-deployment+} in a project.

:ref:`View Atlas Search Metrics <review-atlas-search-metrics>`
   View |fts| metrics for |service| clusters with at least one active 
   |fts| index.

Important Metrics
-----------------

You can monitor the following metrics to quickly gauge the health of 
your {+database-deployment+}.

.. list-table::
   :widths: 30 70
   :header-rows: 1
        
   * - Chart

     - Description
  
   * - :guilabel:`Connections`

     - Number that indicates the total active connections to the 
       {+database-deployment+}.
       
       .. include:: /includes/fact-connections.rst

       To learn more, see :ref:`Fix Connection Issues 
       <connection-alerts>` and :ref:`Fix Lost Primary <no-primary>`.

   * - :guilabel:`Disk IOPS`
  
     - Number that indicates the input operations per second.

       .. include:: /includes/fact-disk-iops.rst

       To learn more, see :ref:`Fix IOPS Issues <disk-io-util>` and 
       :ref:`Fix Lost Primary <no-primary>`.

   * - :guilabel:`Disk Usage`
  
     - Number that indicates the total bytes of used disk space for the 
       cluster.

       .. include:: /includes/fact-disk-usage.rst

       To learn more, see :ref:`Fix Storage Issues <disk-space-used>`.

   * - :guilabel:`Query Targeting`
    
     - Number that indicates the efficiency of read operations run on   
       MongoDB.
       
       Monitor query targeting metrics to identify inefficent queries.

       .. include:: /includes/fact-query-targeting-mongot.rst

       To learn more, see :ref:`Fix Query Issues 
       <query-targeting-resolution>`.

   * - :guilabel:`Normalized System CPU`

     - Number that indicates CPU usage of all processes on the node, 
       scaled to a range of 0-100% by dividing by the number of CPU 
       cores.

       .. include:: /includes/fact-system-cpu.rst

       To learn more, see :ref:`Fix IOPS Issues <disk-io-util>`, 
       :ref:`Fix Lost Primary <no-primary>`, and :ref:`Fix CPU Usage 
       Issues <system-cpu>`.

   * - :guilabel:`Oplog GB/Hour`
     
     - Number that indicates the average rate in gigabytes of 
       :term:`oplog` data that the primary generates per hour.

       .. include:: /includes/fact-oplog-gb-hour.rst

       To learn more, see :ref:`Fix Oplog Issues 
       <replication-oplog-alerts>`.

   * - :guilabel:`Util %`

     - Percentage of time that requests are issued to and serviced 
       by disk. This metric includes requests from any process, not 
       just MongoDB processes.
         
       .. include:: /includes/fact-util-percent.rst
  
       To learn more, see :ref:`Fix IOPS Issues <disk-io-util>`.

.. _monitoring-storage-granularity:

Monitoring Data Storage Granularity
-----------------------------------

|service| stores metrics data at increasing granularity levels. For each
increasing granularity level, |service| computes the metrics data based
on the averages from the previous granularity level. The length of
retention depends on the granularity. |service| computes the metrics 
data based on the averages from the previous granularity level.

|service| gathers metrics data at a 1-minute granularity unless you qualify for
premium monitoring.

.. example::

   After 48 hours' worth of data is collected, each group of
   60 minutes is compacted into a single unit of an hour. After 63 days,
   each group of 24 hours is compacted into a single unit of a day.

.. _premium-monitoring:

Premium Monitoring Granularity
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

If you have at least one {+cluster+} that's ``M40`` or larger, |service|
automatically enables premium monitoring for all {+clusters+} in the project. With
premium monitoring enabled, |service| gathers metrics data at a 10-second
granularity. Premium monitoring remains enabled for all {+clusters+} in the project until you
downgrade or terminate your last ``M40`` cluster.

Metrics Data Retention
~~~~~~~~~~~~~~~~~~~~~~

|service| retains metrics data for a period of time that depends on the granularity of the data:

.. list-table::
   :header-rows: 1

   * - Data Period
     - Duration of Retention

   * - 10 seconds :icon-fa5:`star`
     - 8 hours :icon-fa5:`star`
  
   * - 1 minute
     - 48 hours

   * - 5 minutes
     - 48 hours

   * - 1 hour
     - 63 days

   * - 1 day
     - Forever

:icon-fa5:`star` :ref:`Premium monitoring <premium-monitoring>` only.

|service| retains all database-specific statistics. MongoDB log data is
retained at a maximum rate of 2000 lines per 2 minutes.

{+Free-Cluster+} and {+Shared-Cluster+} Monitoring Considerations
-----------------------------------------------------------------

- ``M0`` {+free-clusters+} and ``M2/M5`` {+shared-clusters+} support a subset of
  the metrics and charts available. For complete documentation on
  the limitations of ``M0/M2/M5`` {+clusters+},
  see :ref:`atlas-free-tier`.
  
- .. include:: /includes/fact-free-tier-monitoring-pause.rst

{+Serverless-Instance+} Monitoring Considerations
-------------------------------------------------

- {+Serverless-instances+} support a subset of the metrics and charts 
  available. For complete documentation on
  the limitations of {+serverless-instances+},
  see :doc:`/reference/serverless-instance-limitations/`.

Manage Tags
-----------

You can add a tag, view existing tags, and manage tags from the 
:guilabel:`{+Database-Deployments+}` page or the :guilabel:`Overview` 
page. To learn more, see :ref:`manage-tags-database-deployment-card` 
and :ref:`manage-tags-overview-page`.

.. include:: /includes/fact-sensitive-info-resource-tags.rst

.. toctree::
   :titlesonly:
   :hidden:

   /review-all-cluster-metrics
   /review-serverless-metrics
   /review-replica-set-metrics
   /review-sharded-cluster-metrics
   /review-mongodb-process-metrics
   /review-real-time-metrics
   /review-atlas-search-metrics
   /review-available-metrics
