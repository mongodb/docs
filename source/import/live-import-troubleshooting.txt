:noprevnext:

==============================
Live Migration Troubleshooting
==============================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

Before the :ref:`Live Migration <live-import-replica>` process begins,
Atlas performs a validation check to ensure that all the necessary
form fields and parameters are functional and correct. If any
parameters are invalid, Atlas returns an error and Live Migration does
not proceed. 

Listed below are some common Live Migration validation errors and
suggestions for what to check if you encounter them.

Common Live Migration Validation Errors
---------------------------------------

.. list-table::
   :header-rows: 1
   :stub-columns: 1

   * - Error
     - Remediation

   * - Could not reach specified source
     - 1. Ensure that you added the correct subnet ranges to the IP
          access list on the source cluster. The four required subnet
          ranges can be found in the Live Migration modal window.

       2. Confirm that the hostname provided is resolvable to a public
          IP address. At a command prompt, use one of the following
          commands:

          .. code-block:: shell

             nslookup <hostname>
             ping <hostname>

       3. Ensure that you are not using a :doc:`VPC Peering Connection
          </security-vpc-peering>`, which is not compatible with Live
          Migration. If a VPC Peering Connection is your only option,
          use :doc:`mongomirror </import/mongomirror>` instead.

   * - Could not resolve hostname
     - No IP address was found for the given hostname. Confirm that
       the given hostname is correct and publicly accessible.

   * - Invalid SSL options provided
     - If you are using SSL:

       - Confirm that your SSL certificate is complete and correctly
         copied to the Live Migration modal window.

       - Confirm that the :guilabel:`Is SSL enabled?` toggle switch
         is in the ``Yes`` position.

       If you are not using SSL:

       - Check your connection string and confirm that the ``ssl``
         query parameter is not present. If ``--ssl`` is part of your
         connection string, your cluster requires an SSL connection.

       - Confirm that the :guilabel:`Is SSL enabled?` toggle switch
         is in the ``No`` position.

   * - The username or password is not correct
     - Confirm your credentials in the |mongo| shell with the
       following commands:

       .. code-block:: javascript

          use admin
          db.getUser("<username>");

       If the issue persists, :manual:`update
       </tutorial/change-own-password-and-custom-data>` the MongoDB
       user's password.

   * - User not authorized to execute command
     - In order to perform the Live Migration procedure, the MongoDB
       user must have sufficient system privileges. See :ref:`Source
       Cluster Security <live-import-security>` for details.

   * - Source disk usage is too large for destination
     - Different Atlas service tiers have different amounts of disk
       space available. Ensure that your Atlas cluster has enough
       disk space for all the data on your source cluster. See
       :ref:`Create a New Cluster <create-cluster-instance>` for
       details on cluster sizing.

   * - Source appears to be a standalone
     - Your source deployment must be a MongoDB :manual:`replica set
       </replication>`. If your source deployment is currently a
       standalone node, :manual:`convert it
       </tutorial/convert-standalone-to-replica-set>` to a single-node
       replica set before performing Live Migration.

   * - Unable to process the provided CA file
     - Confirm that your CA file is complete and correctly pasted into
       the Live Migration modal window.

Common Post-Validation Errors
-----------------------------

.. list-table::
   :header-rows: 1

   * - Error
     - Remediation

   * - Could not retrieve the latest oplog entry from the source:
       not found
     - - If the source is a replica set, make sure you have read
         access on the :manual:`local database
         </reference/local-database>`.
       - If the source is a standalone instance, :manual:`convert it
         to a replica set
         </tutorial/convert-standalone-to-replica-set/>` before
         proceeding with the migration.
       - Confirm that the source cluster has a readable oplog. On
         some hosted services, such as Compose.io, the oplog is a
         feature which must be `enabled
         <https://www.compose.com/articles/connecting-to-the-oplog-on-the-new-mongodb/>`_.
       - If you still cannot access the oplog, use :doc:`mongorestore
         </import/mongorestore>` instead to import your data into
         |service|.

   * - Could not determine if --host is a replica set: error
       connecting to db server: no reachable servers
     - - Ensure that you added every IP address the Live Migration
         service requires to the :doc:`IP access list
         </security/ip-access-list>` for your source cluster.
       - Confirm that the IP address or DNS hostname you provided
         resolves to an IP address that is publicly accessible.

   * - Error applying oplog entries during initial sync:
       renameCollection command encountered during initial sync.
       Please restart mongomirror.
     - Renaming a collection on the source cluster during Live
       migration may trigger this error.

       - Ensure that no users or applications rename any collections
         while the Live Migration is taking place.
       - Aggregation operations which use :manual:`$out
         </reference/operator/aggregation/out>` may trigger this error.
         Ensure that no ``$out`` operations occur during the Live
         Migration procedure.

   * - Unsupported index error
     - Certain types and configurations of indexes which were
       allowable in earlier versions of MongoDB are no longer
       supported in more recent versions. Check the release notes
       for the MongoDB version on your destination cluster for
       possible conflicts. If necessary, drop any indexes which
       cause errors and rebuild them after migration is complete.

   * - Error while tailing the oplog on the source: Checkpoint not
       available in oplog
     - Live Migrate uses the source :manual:`oplog
       </core/replica-set-oplog/>` to sync operations which occur on
       the source cluster during the Live Migration procedure. If the
       source cluster oplog size is too small, it might not be able to
       record all the operations that occur on the source cluster
       during the sync, and Live Migrate falls too far behind to catch
       up.

       If you see this error, check the size of the source cluster
       oplog using the :manual:`rs.printReplicationInfo()
       </reference/method/rs.printReplicationInfo/>` command. You can
       :manual:`increase the size of the source oplog
       </tutorial/change-oplog-size/>` to support a replication window
       that is long enough to complete the Live Migration procedure.
