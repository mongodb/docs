===========================================
|onprem| Hardware and Software Requirements
===========================================

.. default-domain:: mongodb

This page describes the hardware and software requirements for the servers
that run the :doc:`/core/system-overview`, including the servers that run
the backing MongoDB replica sets.

The servers that run the Backup Daemon and the backing replica sets **must**
also meet the configuration requirements in the :manual:`MongoDB Production
Notes </administration/production-notes>` in addition to the requirements on
this page. The Production Notes include information on
:manual:`ulimits </reference/ulimit>`, :manual:`NUMA
</administration/production-notes#production-numa>`,
:manual:`Transparent Huge Pages (THP)
</reference/transparent-huge-pages>`, and other configuration options.

.. warning::

   Failure to configure servers according to the :manual:`MongoDB
   Production Notes </administration/production-notes>` can lead to
   production failure.

This page also includes requirements for the EC2 security group used when
installing on AWS servers.

.. _hardware-requirements:

Hardware Requirements
---------------------

Each server must meet the sum of the requirements for all its components.

|onprem| Monitoring and Automation require servers for the following
components:

- :ref:`application`.

- :ref:`mms-application-database` replica set members

  .. note:: Usually the |application| runs on the same server as one of the
            replica set members for the |application| Database.

If you run Backup, |onprem| also requires servers for the following:

- :ref:`backup-daemon`

- :ref:`backup-database` replica set members

.. note::

   The following requirements are specific to a given component. You must add
   together the requirements for the components you will install. For example,
   the requirements for the |application| do not cover the |application|
   Database.

.. _application-hardware-requirements:

|application| Hardware
~~~~~~~~~~~~~~~~~~~~~~

The |application| requires the hardware listed here.

.. list-table::
   :header-rows: 1

   * - **Number of Monitored Hosts**
     - **CPU Cores**
     - **RAM**
   * - Up to 400 monitored hosts
     - 4+
     - 15 GB
   * - Up to 2000 monitored hosts
     - 8+
     - 15 GB
   * - More than 2000 hosts
     - Contact MongoDB Account Manager
     - Contact MongoDB Account Manager

.. _mms-application-database-specifications:

|application| Database Hardware
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The :ref:`mms-application-database` holds monitoring and other metadata
for the :ref:`mms-application-package`.

The database runs as a three-member :term:`replica set`. If you cannot
allocate space for three data-bearing members, the third member can be an
arbiter, but keep in mind that |mms| uses ``w:2`` :manual:`write concern
</reference/write-concern>`, which reports a write operation as successful
after acknowledgement from the primary and one secondary. If you use a replica
set with fewer than 3 data-bearing members, and if you lose one of the
data-bearing members, MongoDB blocks write operations, meaning the
:ref:`mms-application-database` has redundancy but not high availability.

Run the replica set on dedicated servers. You can optionally run one
member of the replica set on the same physical server as the |application|.

For a :doc:`test deployment </tutorial/install-simple-test-deployment>`,
you can use a MongoDB standalone in place of a replica set.

Each server that hosts a MongoDB process for the |application|
Database **must** comply with the :manual:`Production Notes
</administration/production-notes>` in the MongoDB manual. The
Production Notes include important information on :manual:`ulimits
</reference/ulimit>`, :manual:`NUMA
</administration/production-notes#production-numa>`,
:manual:`Transparent Huge Pages (THP)
</reference/transparent-huge-pages>`, and other configuration options.

.. warning::

   Failure to configure servers according to the :manual:`MongoDB
   Production Notes </administration/production-notes>` can lead to
   production failure.

Each server also requires the following:

.. list-table::
   :header-rows: 1

   * - **Number of Monitored Hosts**
     - **RAM**
     - **Disk Space**
   * - Up to 400 monitored hosts
     - 8 GB additional RAM beyond the RAM required for the |application|
     - 200 GB of storage space
   * - Up to 2000 monitored hosts
     - 15 GB additional RAM beyond the RAM required for the |application|
     - 500 GB of storage space
   * - More than 2000 hosts
     - Contact MongoDB account manager
     - Contact MongoDB account manager

For the best results use SSD-backed storage.


.. _backup-hardware-requirements:

Backup Daemon Hardware
~~~~~~~~~~~~~~~~~~~~~~

The Backup Daemon server must meet the requirements in the table below and
**also must meet** the configuration requirements in the :manual:`MongoDB
Production Notes </administration/production-notes>`. The Production Notes
include information on :manual:`ulimits </reference/ulimit>`,
:manual:`NUMA </administration/production-notes#production-numa>`,
:manual:`Transparent Huge Pages (THP)
</reference/transparent-huge-pages>`, and other options.

.. warning::

   Failure to configure servers according to the :manual:`MongoDB
   Production Notes </administration/production-notes>` can lead to
   production failure.

If you wish activate the Backup Daemon on an |onprem| server, the server
must satisfy these requirements separately
from the requirements in :ref:`application-hardware-requirements`.

The server running the Backup Daemon acts like a hidden secondary for
every replica set assigned to it, receiving the streamed :term:`oplog`
entries each replica set's :term:`primary`. However, the Backup Daemon
differs from a hidden secondary in that the replica set is not aware of
it.

The server must have the disk space and write
capacity to maintain the replica sets plus the space to store an additional
copy of the data to support point-in-time restore. Typically, the Backup
Daemon must be able to store 2 to 2.5 times the sum of the size on disk of all
the backed-up replica sets, as it also needs space locally to build
:term:`point-in-time restore` restores.

Before installing the Backup Daemon, we recommend contacting your MongoDB Account
Manager for assistance in estimating the storage requirements for your Backup
Daemon server.

.. list-table::
   :header-rows: 1
   :widths: 20, 12, 8, 15, 15

   * - **Number of Hosts**
     - **CPU Cores**
     - **RAM**
     - **Disk Space**
     - **Storage IOPS/s**
   * - Up to 200 hosts
     - 4+ 2Ghz+
     - 15 GB additional RAM
     - Contact MongoDB Account Manager
     - Contact MongoDB Account Manager

.. _backup-database-specifications:

Backup Database Hardware
~~~~~~~~~~~~~~~~~~~~~~~~

Provision :ref:`backup-database` servers only if you are deploying |mms|
Backup.

Replica Set for the Backup Database
+++++++++++++++++++++++++++++++++++

Backup requires a separate, **dedicated** MongoDB replica set to hold
backup data, which include snapshots, oplog data and temporary sync data.
This cannot be a replica set used for any
purpose other than holding the backup data.

For redundancy, the replica set must have at least two data-bearing
members. For high availability, the replica set must have
at least three data-bearing members.

.. note::

   |mms| uses ``w:2`` :manual:`write concern </reference/write-concern>`,
   which reports a write operation as successful after acknowledgement
   from the primary and one secondary. If you use a replica set with two
   data-bearing members and an arbiter, and you lose one of the
   data-bearing members, write operations will be blocked.

For *testing only* you may use a standalone MongoDB deployment in place of a
replica set.

Server Size for the Backup Database
+++++++++++++++++++++++++++++++++++

Snapshots are compressed and de-duplicated at the block level in the
:term:`Backup Blockstore Database`. Typically, depending on data compressibility and
change rate, the replica set must run on servers with enough capacity to
store 2 to 3 times the total backed-up production data size. 

**Contact your MongoDB Account Manager** for assistance in estimating the
use-case and workload-dependent storage requirements for your Blockstore
servers.

Configuration Requirements from the MongoDB Production Notes
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

Each server that hosts a MongoDB process for the Backup Database
**must** comply with the :manual:`Production Notes
</administration/production-notes>` in the MongoDB manual. The
Production Notes include important information on :manual:`ulimits
</reference/ulimit>`, :manual:`NUMA
</administration/production-notes#production-numa>`,
:manual:`Transparent Huge Pages (THP)
</reference/transparent-huge-pages>`, and other configuration options.

.. warning::

   Failure to configure servers according to the :manual:`MongoDB
   Production Notes </administration/production-notes>` can lead to
   production failure.

Other Requirements for the Backup Database
++++++++++++++++++++++++++++++++++++++++++

For each data-bearing member of the replica set member

.. list-table::
   :header-rows: 1

   * - **CPU Cores**
     - **RAM**
     - **Disk Space**
     - **Storage IOPS**
   * - 4 x 2ghz+ 
     - 8 GB of RAM for every 1 TB disk of Blockstore to provide good
       snapshot and restore speed. |mms| defines 1 TB of Blockstore as
       1024\ :sup:`4` bytes.
     - Contact your MongoDB Account Manager.
     - Medium grade HDDs should have enough I/O throughput to handle the
       load of the Blockstore.

.. _aws-security-groups:

EC2 Security Groups
-------------------

.. include:: /includes/requirements-aws-security.rst

Software Requirements
---------------------

Operating System
~~~~~~~~~~~~~~~~

The |application| and Backup Daemon(s) can run on 64-bit versions of the following operating systems:

- CentOS 5 or later

- Red Hat Enterprise Linux 5 or later

- SUSE 11 or Later

- Amazon Linux AMI (latest version only)

- Ubuntu 12.04 or later

- Windows Server 2008 R2 or later

.. _onprem-config-ulimits:

Ulimits
~~~~~~~

The |onprem| package automatically raises the open file, max user processes, and
virtual memory ulimits. On Red Hat, be sure to check for a
``/etc/security/limits.d/90-nproc.conf`` file that may override the max user
processes limit. If the ``/etc/security/limits.d/90-nproc.conf`` file exists,
remove it before continuing.

See :manual:`MongoDB ulimit Settings </reference/ulimit>` for recommended
ulimit settings.

.. warning::

   Always refer to the :manual:`MongoDB Production Notes
   </administration/production-notes>` to ensure healthy server configurations.

.. _authentication-requirements:

Authentication
~~~~~~~~~~~~~~

If you are using LDAP for user authentication to |onprem| (as described in
:doc:`/tutorial/configure-for-ldap-authentication`), you must enable LDAP
**before setting up** |mms|.

.. important::

   You **cannot** enable LDAP once you have opened the |onprem| user
   interface and registered the first user. You can enable LDAP **only**
   on a completely blank, no-hosts, no-users installation.

MongoDB
~~~~~~~

.. versionchanged:: 1.8

   The :ref:`mms-application-database` and
   :ref:`backup-database` must run MongoDB version 2.6.0
   or later. |onprem| 1.8 does not support backing databases running
   earlier versions of MongoDB.

Your **backed-up** sharded cluster deployments must run at least MongoDB 2.4.3 or
later. Your backed-up replica set deployments must run at least MongoDB
2.2 or later.

Web Browsers
~~~~~~~~~~~~

|onprem| supports clients using the following browsers:

.. include:: /includes/list-supported-browsers.rst

|onprem| will display a warning on non-supported browsers.

SMTP
~~~~

|onprem| requires email for fundamental server functionality such as
password reset and alerts.

Many Linux server-oriented distributions include a local SMTP server by
default, for example, Postfix, Exim, or Sendmail. You also may configure |onprem|
to send mail via third party providers, including Gmail and Sendgrid.

SNMP
~~~~

If your environment includes SNMP, you can configure an SMNP trap receiver
with periodic heartbeat traps to monitor the internal health of |mms|.
|onprem| uses SNMP v2c.

For more information, see :ref:`Configure SNMP Heartbeat Support
<snmp-heartbeat-configure>`.
