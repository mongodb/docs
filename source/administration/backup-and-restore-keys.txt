=================================
Back Up and Restore Security Keys
=================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. include:: /includes/backup-restore-intro.rst

To prevent this from occurring, you should back up the encryption keys
after the initial deployment and store them in a safe location. For a
production Charts deployment you should also back up the data in the
Charts metadata database using :manual:`MongoDB backup methods
</core/backups>`.

Back Up Keys
------------

.. include:: /includes/backup-keys.rst

Restore Keys
------------

.. tabs::

   tabs:

     - id: windows
       name: Windows PowerShell
       content: |

         To restore the keys on the host of the new Charts deployment, first
         copy the keys from the external location to the target host. For
         example, ``C:\temp\charts-keys-backup``. Then run the following commands
         before deploying |charts-short| from the docker-compose file:

         .. code-block:: sh

            docker volume create mongodb-charts_keys
            docker run -it `
              --volume mongodb-charts_keys:/volume `
              --volume /c/temp/charts-keys-backup:/backup `
              alpine sh -c 'cp /backup/* /volume'

         .. include:: /includes/fact-docker-unix-paths-windows.rst

     - id: macos
       name: macOS
       content: |

         To restore the keys on the host of the new Charts deployment, first
         copy the keys from the external location to the target host. For
         example, ``/tmp/charts-keys-backup``. Then run the following commands
         before deploying |charts-short| from the docker-compose file:

         .. code-block:: sh

            docker volume create mongodb-charts_keys
            docker run -it \
              --volume mongodb-charts_keys:/volume \
              --volume /tmp/charts-keys-backup:/backup \
              alpine sh -c 'cp /backup/* /volume'

     - id: linux
       name: Linux
       content: |

         To restore the keys on the host of the new Charts deployment, first
         copy the keys from the external location to the target host. For
         example, ``/tmp/charts-keys-backup``. Then run the following commands
         before deploying |charts-short| from the docker-compose file:

         .. code-block:: sh

            docker volume create mongodb-charts_keys
            docker run -it \
              --volume mongodb-charts_keys:/volume \
              --volume /tmp/charts-keys-backup:/backup \
              alpine sh -c 'cp /backup/* /volume'
