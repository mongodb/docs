.. _voyage-semantic-search:

=========================================
Semantic Search with Voyage AI Embeddings
=========================================

.. facet::
   :name: genre
   :values: tutorial

.. meta::
   :keywords: semantic search, embeddings, vector search, RAG, retrieval-augmented generation, AI, LLM, vector database, generative search, sample dataset, code example
   :description: Learn how to use Voyage AI embeddings for semantic search.

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

This guide describes how to perform semantic search with {+voyageai+} models. 
This page includes examples for basic and advanced semantic search use cases, 
including search with reranking, as well as multilingual, multimodal, 
contextualized chunk, and large corpus retrieval.

.. figure:: /images/semantic-search-diagram.png
   :figwidth: 1444px
   :alt: Diagram of semantic search workflow

Perform Semantic Search
-----------------------

This section provides code examples for
various semantic search use cases with different
{+voyageai+} models. For each example, you perform the 
same basic steps:

1. **Embed the documents**: Convert your data into vector 
   embeddings that capture their meaning. This data can be
   text, images, document chunks, or a large corpus of text.

2. **Embed the query**: Transform your search query into the same 
   vector representation as your documents.

3. **Find similar documents**: Compare the query vector against your 
   document vectors to identify the most semantically similar results.

.. cta-banner::
   :url: https://github.com/mongodb/docs-notebooks/blob/main/voyageai/notebooks/semantic-search.ipynb
   :icon: Code

   Work with a runnable version of this tutorial as a :github:`Python notebook <mongodb/docs-notebooks/blob/main/voyageai/notebooks/semantic-search.ipynb>`.

.. procedure::
   :style: normal

   .. step:: Set up your environment.

      Before you begin, create a project directory, install libraries, and
      set your model API key.

      a. Run the following commands in your terminal to create a new directory for this tutorial and install the required libraries:

         .. code-block:: bash

           mkdir voyage-semantic-search
           cd voyage-semantic-search
           pip install --upgrade voyageai numpy datasets

      #. If you haven't already, follow the steps to :ref:`create a model API key
         <voyage-manage-api-keys>`, then run the following command in your terminal to export it as an environment variable:

         .. code-block:: bash

            export VOYAGE_API_KEY="your-model-api-key"

   .. step:: Run semantic search queries.

      Expand each section to get code examples
      for each type of semantic search.

      .. collapsible::
         :heading: Basic Semantic Search
         :sub_heading: Find similar documents using simple vector similarity.
         :expanded: false

         a. Create a file named ``semantic_search_basic.py`` in your project and paste the following code into it:

         .. literalinclude:: /includes/semantic-search/semantic_search_basic.py
            :language: python

         b. Run the following command in your terminal:

         .. io-code-block::
            :copyable:

            .. input::
               :language: bash

               python semantic_search_basic.py

            .. output:: /includes/semantic-search/basic-output.md
               :language: none
               :visible: false

      .. collapsible::
         :heading: Semantic Search with Reranker
         :sub_heading: Improve search accuracy with reranking models.
         :expanded: false

         a. Create a file named ``semantic_search_reranker.py`` in your project and paste the following code into it:

         .. literalinclude:: /includes/semantic-search/semantic_search_reranker.py
            :language: python

         b. Run the following command in your terminal:

         .. io-code-block::
            :copyable:

            .. input::
               :language: bash

               python semantic_search_reranker.py

            .. output:: /includes/semantic-search/reranker-output.md
               :language: none
               :visible: false

      .. collapsible::
         :heading: Multilingual Semantic Search
         :sub_heading: Search across documents in different languages.
         :expanded: false

         a. Create a file named ``semantic_search_multilingual.py`` in your project and paste the following code into it:

         .. literalinclude:: /includes/semantic-search/semantic_search_multilingual.py
            :language: python

         b. Run the following command in your terminal:

         .. io-code-block::
            :copyable:

            .. input::
               :language: bash

               python semantic_search_multilingual.py

            .. output:: /includes/semantic-search/multilingual-output.md
               :language: none
               :visible: false

      .. collapsible::
         :heading: Multimodal Semantic Search
         :sub_heading: Search text, image, and video data.
         :expanded: false

         a. Search for sample images and save them in your project directory.
            The following code example assumes you have images of a cat, dog, and banana.

         b. Create a file named ``semantic_search_multimodal.py`` in your project and paste the following code into it:

         .. literalinclude:: /includes/semantic-search/semantic_search_multimodal.py
            :language: python

         c. Run the following command in your terminal:

         .. io-code-block::
            :copyable:

            .. input::
               :language: bash

               python semantic_search_multimodal.py

            .. output:: /includes/semantic-search/multimodal-output.md
               :language: none
               :visible: false

      .. collapsible::
         :heading: Search with Contextualized Chunk Embeddings
         :sub_heading: Generate embeddings with additional context for better results.
         :expanded: false

         a. Create a file named ``semantic_search_contextualized.py`` in your project and paste the following code into it:

         .. literalinclude:: /includes/semantic-search/semantic_search_contextualized.py
            :language: python

         b. Run the following command in your terminal:

         .. io-code-block::
            :copyable:

            .. input::
               :language: bash

               python semantic_search_contextualized.py

            .. output:: /includes/semantic-search/contextualized-output.md
               :language: none
               :visible: false

      .. collapsible::
         :heading: Semantic Search with Large Corpus
         :sub_heading: Find similar documents from a larger dataset.
         :expanded: false

         a. Create a file named ``semantic_search_large_corpus.py`` in your project and paste the following code into it:

         .. literalinclude:: /includes/semantic-search/semantic_search_large_corpus.py
            :language: python

         b. Run the following command in your terminal:

         .. io-code-block::
            :copyable:

            .. input::
               :language: bash

               python semantic_search_large_corpus.py

            .. output:: /includes/semantic-search/large-corpus-output.md
               :language: none
               :visible: false
               
About The Examples
~~~~~~~~~~~~~~~~~~

The following table summarizes the examples on this page:

.. list-table::
   :header-rows: 1
   :widths: 20 20 60

   * - Example
     - Model Used
     - Understanding Results

   * - Basic Semantic Search
     - ``voyage-4-large``
     - The Apple conference call document ranks first, significantly
       higher than unrelated documents, demonstrating accurate
       semantic matching.

   * - Semantic Search with Reranker
     - ``voyage-4-large`` and ``rerank-2.5``
     - Reranking improves search accuracy by analyzing the full
       query-document relationship. While embedding similarity alone
       ranks the correct document first with a moderate score,
       the reranker significantly boosts its relevance score
       which better separates it from irrelevant results.

   * - Multilingual Semantic Search
     - ``voyage-4-large``
     - {+voyage+} models perform semantic search effectively across
       different languages. The example demonstrates three separate
       searches in English, Spanish, and Chinese, each correctly
       identifying the most relevant documents about tech company
       earnings within their respective languages.

   * - Multimodal Semantic Search
     - ``voyage-multimodal-3.5``
     - The model supports interleaved text, image, and video, as well as
       image-only and video-only search. In both cases, pet images (cat and dog) rank
       significantly higher than the unrelated banana image,
       demonstrating accurate visual content retrieval. Interleaved
       inputs with descriptive text produce slightly higher similarity
       scores than image-only inputs.

   * - Contextualized Chunk Embeddings
     - ``voyage-context-3``
     - The 15% revenue growth chunk ranks first because it's linked to 
       the Leafy Inc. document. The similar 7% growth chunk from 
       Greenery Corp. scores lower, showing how the model accurately 
       considers document context to distinguish between otherwise 
       similar chunks.

   * - Semantic Search with Large Corpus
     - ``voyage-4-large``
     - The ground truth document about user content ranks first
       among 154 documents, demonstrating effective retrieval at
       scale despite semantic complexity.

.. collapsible::
   :heading: Usage Details
   :sub_heading: Review usage details for the code examples on this page
   :expanded: false

   **Accessing Embeddings**
     The examples use the Python Client,  ``voyageai.Client()``, which automatically
     reads your API key from the ``VOYAGE_API_KEY`` environment variable.
     The API returns a response object. Use the ``.embeddings`` attribute to access
     the actual embedding vectors:

     .. code-block:: python

        result = vo.embed(texts=["example"], model="voyage-4-large", input_type="document")
        embeddings = result.embeddings  # List of embedding vectors

   **Calculating Similarity**
     The examples calculate similarity scores between query and document embeddings
     using Numpy's dot product function: ``np.dot()``. Since {+voyageai+} embeddings are
     normalized to length 1, the dot product is mathematically equivalent to
     cosine similarity.

     To rank results by similarity, the examples use Numpy's ``argsort()`` function
     to display the top N results. The negative sign sorts in descending order,
     so the highest similarity scores appear first.

   **Input Type Parameter**
     The ``input_type`` parameter is set to ``query`` or ``document`` to
     optimize how {+voyageai+} models create the vectors. Do not omit this parameter.
     To learn more, see :ref:`voyage-input-type`.

   To learn more, see :ref:`voyage-api-client` or
   explore the `full API specification <https://www.mongodb.com/docs/api/doc/atlas-embedding-and-reranking-api/>`__.


What is Semantic Search?
------------------------

Semantic search is a search method that returns results based on
your data's semantic, or underlying, meaning. Unlike traditional
full-text search which finds text matches, semantic search finds
:term:`vectors <vector embeddings>` that are close to your search query
in multi-dimensional space. The closer the vectors are to your query,
the more similar they are in meaning.

.. example::

   Traditional text search returns only exact matches, limiting results
   when users search with different terms than those in your data.
   For example, if your data contains documents about
   computer mice and animal mice, searching for "mouse" when you intend
   to find information about computer mice results in incorrect matches.

   Semantic search, however, captures the underlying relationship
   between words or phrases even when there is no lexical overlap.
   Searching for "mouse" when indicating that you are looking for 
   computer products results in more relevant results. This is because
   semantic search compares the semantic meaning of the search query
   against your data to return only the most relevant results, regardless
   of the exact search terms.

   .. figure:: /images/semantic-similarity.png
      :figwidth: 720px
      :alt: Diagram that demonstrates semantic similarity

.. collapsible::
   :heading: What are Similarity Functions?
   :expanded: false

   :term:`Similarity functions <similarity function>` 
   measure how close two vectors are to each other,
   and therefore how similar they are. Common functions
   include dot product, cosine similarity, and Euclidean distance.
   {+voyageai+} embeddings are normalized to length 1, which means that:

   - Cosine similarity is equivalent to dot product similarity, while
     the latter can be computed more quickly.
   - Cosine similarity and Euclidean distance result in identical
     rankings.

Semantic Search in Production
-----------------------------

While storing your vectors in memory and implementing your own search pipelines
is suitable for prototyping and experimentation,
use a vector database and enterprise search solution for production applications 
so you can perform efficient retrieval from a larger corpus.

MongoDB has native support for vector storage and retrieval, making it a 
convenient choice for storing and searching vector embeddings alongside your
other data. To complete a tutorial on performing semantic search with MongoDB Vector Search, see
:ref:`vector-search-tutorial`.

Next Steps
----------

Combine semantic search with an LLM to implement
a :ref:`RAG application <voyage-rag>`.
