=======================================================
Configure Local Mode if |onprem| has No Internet Access
=======================================================

.. default-domain:: mongodb

Overview
--------

The Automation Agent requires access to MongoDB binaries in order to
install MongoDB on new deployments or change MongoDB versions on existing
ones. In a default configuration, the agents access the binaries over the
internet from MongoDB Inc. If you deploy MongoDB on servers that have no
internet access, you can run Automation by configuring |onprem| to run in
"local" mode, in which case the Automation Agents access the binaries from
a directory on the |application| server.

You specify the directory in the :ref:`conf-mms.properties` configuration
file and then place ``.tgz`` archives of the binaries in that directory.
The Automation Agents use the archives for all MongoDB installs. The
"mongodb-mms" user must be able to read the ``.tgz`` files in this
directory.

The following shows the ``ls -l`` output of the "binaries" directory for
an example |onprem| install that deploys only the versions of MongoDB
listed:

.. code-block:: sh

   $ cd /opt/mongodb/mms/mongodb-releases
   $ ls -l
   total 930552
   -rw-r-----@ 1 mongodb-mms  staff   95266560 Apr 16 21:09 mongodb-linux-x86_64-2.4.13.tgz
   -rw-r-----@ 1 mongodb-mms  staff  116513825 Apr 16 21:09 mongodb-linux-x86_64-2.6.9.tgz
   -rw-r-----@ 1 mongodb-mms  staff   50106057 Apr 16 21:04 mongodb-linux-x86_64-rhel70-3.0.2.tgz
   -rw-r-----@ 1 mongodb-mms  staff   76799502 Apr  3 19:22 mongodb-sunos5-x86_64-2.4.13.tgz
   -rw-r-----@ 1 mongodb-mms  staff  137749621 Apr 16 21:10 mongodb-win32-x86_64-2008plus-2.6.9.zip

Prerequisites
-------------

Download Binaries Before Importing a Deployment
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

You must populate the binaries directory with all required MongoDB
versions before you import the deployment. If a version is missing, the
Automation Agents will not be able to take control of the deployment.

.. warning::

   The directory must include binaries for all MongoDB versions used by a
   deployment **before you import the deployment**, or the Automation
   Agents will fail to take control of the deployment.

.. _local-mode-determine-versions:

Determine Which Binaries to Store
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Your binaries directory will require archives of following versions:

- versions used by existing deployments that you will import

- versions you will use to create new deployments

- versions you will use during an intermediary step in an upgrade. For
  example, if you will import an existing MongoDB 2.6 Community deployment
  and upgrade it first to MongoDB 3.0 Community and then to MongoDB 3.0
  Enterprise, you must include all those editions and versions.

If you use both the MongoDB Community edition and the MongoDB Enterprise
subscription edition, you must include the required versions of both.

The following table describes the archives required for specific versions:

.. list-table::
   :widths: 30 30 60
   :header-rows: 1

   * - Edition
     - Version
     - Archive
   * - Community
     - 2.6+, 2.4+
     - Linux archive at `<http://www.mongodb.org/downloads>`_.
   * - Community
     - 3.0+
     - ``Linux 64-bit legacy`` version at `<http://www.mongodb.org/downloads>`_.
   * - Enterprise
     - 3.0+, 2.6+, 2.4+
     - Platform-specific archive available from `<http://mongodb.com/download>`_.

.. warning::

   If you run |onprem| 1.6 and use Automation to deploy :term:`MongoDB
   Enterprise`, then you must **pre-install** the :ref:`MongoDB Enterprise
   Dependencies <mongodb-enterprise-dependencies>` on your servers.

   If your MongoDB Enterprise deployments use Enterprise's advanced
   security features (SSL, LDAP, Kerberos, and auditing), you can use
   |onprem| for Monitoring and Backup only. You cannot currently use
   Automation with the advanced security features. Automation will support
   these features in the next major |onprem| release.

.. _mongodb-enterprise-dependencies:

Prerequisite Packages Required for MongoDB Enterprise
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

If you use :term:`MongoDB Enterprise` you must install the following
prerequisite packages to each server that will run MongoDB Enterprise:

- ``net-snmp``
- ``net-snmp-libs``
-  ``openssl``
-  ``net-snmp-utils``
-  ``cyrus-sasl``
- ``cyrus-sasl-lib``
- ``cyrus-sasl-devel``
- ``cyrus-sasl-gssapi``

To install these packages on RHEL, CentOS and Amazon Linux, you can issue the following command:

.. code-block:: sh

   sudo yum install openssl net-snmp net-snmp-libs net-snmp-utils cyrus-sasl cyrus-sasl-lib cyrus-sasl-devel cyrus-sasl-gssapi

.. _version-manifest:

Version Manifest
~~~~~~~~~~~~~~~~

When you run in local mode, you must provide |onprem| with the MongoDB
version manifest, which lists all released MongoDB versions. You provide
the manifest to make |onprem| aware of MongoDB versions, but to make a
version available to the Automation Agent, you must install the versionâ€™s
archive on the |application| server and then select it for use in the
associated group's Version Manager.

To provide |onprem| with the manifest, , in the |onprem| web interface,
click :guilabel:`Admin` in the upper right, then click
:guilabel:`General`, and then click :guilabel:`Version Manifest`. Here,
you can update the manifest directly, if your browser has internet access.
Otherwise, copy the manifest from
`<https://opsmanager.mongodb.com/static/version_manifest/1.6.json>`_ and
click the link for pasting in the manifest.

When MongoDB releases new versions, update the manifest.

Required Access
---------------

You must have :ref:`Global Automation Admin
<global-automation-admin-role>` or :ref:`Global Owner <global-owner-role>`
access to perform this procedure.

Procedure
---------

.. include:: /includes/steps/configure-local-mode.rst
