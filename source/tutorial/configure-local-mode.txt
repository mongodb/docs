=======================================================
Configure Local Mode if |onprem| has No Internet Access
=======================================================

.. default-domain:: mongodb

Overview
--------

The Automation Agent requires access to MongoDB binaries in order to
install MongoDB on new deployments or change MongoDB versions on existing
ones. In a default configuration, the agents access the binaries over the
internet from MongoDB Inc. If you deploy MongoDB on servers that have no
internet access, you can run Automation by configuring |onprem| to run in
"local" mode, in which case you must store archives of the desired MongoDB
versions on the |application| server for access by the Automation Agent.

Prerequisites
-------------

.. _local-mode-determine-versions:

Determine Which Binaries to Store
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

When |onprem| runs in local mode, the Automation Agents retrieve MongoDB
binaries from a directory on the |application| server. You specify the
directory in the conf-mms.properties configuration file and then install
``.tar`` archives of the binaries to the directory. The agents use these
archives for all MongoDB installs.

.. warning::

   This directory must include binaries for all MongoDB versions used by a
   deployment **before you import the deployment**. If a version is
   missing, the Automation Agents will not be able to take control of the
   deployment.

If you use both the MongoDB Community edition and the MongoDB Enterprise
subscription edition, you must include the required versions of both.

You will require archives of following versions:

- versions used by existing deployments that you will import

- versions you will use to create new deployments

- versions you will use during an intermediary step in an upgrade. For
  example, if you will import an existing MongoDB 2.6 Community deployment
  and upgrade it first to MongoDB 3.0 Community and then to MongoDB 3.0
  Enterprise, you must include all those editions and versions.

The following table describes the archives required for specific versions:

.. list-table::
   :widths: 30 30 60
   :header-rows: 1

   * - Edition
     - Version
     - Archive
   * - Community
     - 2.6+, 2.4+
     - Linux archive at `<http://www.mongodb.org/downloads>`_.
   * - Community
     - 3.0+
     - ``Linux 64-bit legacy`` version at `<http://www.mongodb.org/downloads>`_.
   * - Enterprise
     - 3.0+, 2.6+, 2.4+
     - Platform-specific archive available from `<http://mongodb.com/download>`_.

.. warning::

   If you run |onprem| 1.6 and use Automation to deploy :term:`MongoDB
   Enterprise`, then you must **pre-install** the :ref:`MongoDB Enterprise
   Dependencies <mongodb-enterprise-dependencies>` on your servers.

   If your MongoDB Enterprise deployments use Enterprise's advanced
   security features (SSL, LDAP, Kerberos, and auditing), you can use
   |onprem| for Monitoring and Backup only. You cannot currently use
   Automation with the advanced security features. Automation will support
   these features in the next major |onprem| release.

.. _mongodb-enterprise-dependencies:

Prerequisite Packages Required for MongoDB Enterprise
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

If you use :term:`MongoDB Enterprise` you must install the following
prerequisite packages to each server that will run MongoDB Enterprise:

- ``net-snmp``
- ``net-snmp-libs``
-  ``openssl``
-  ``net-snmp-utils``
-  ``cyrus-sasl``
- ``cyrus-sasl-lib``
- ``cyrus-sasl-devel``
- ``cyrus-sasl-gssapi``

To install these packages on RHEL, CentOS and Amazon Linux, you can issue the following command:

.. code-block:: sh

   sudo yum install openssl net-snmp net-snmp-libs net-snmp-utils cyrus-sasl cyrus-sasl-lib cyrus-sasl-devel cyrus-sasl-gssapi

.. _version-manifest:

Version Manifest
~~~~~~~~~~~~~~~~

When you run in local mode, you must provide |onprem| with the MongoDB
version manifest, which lists all released MongoDB versions. You provide
the manifest to make |onprem| aware of MongoDB versions, but to make a
version available to the Automation Agent, you must install the versionâ€™s
archive on the |application| server and then select it for use in the
associated group's Version Manager.

To provide |onprem| with the manifest, , in the |onprem| web interface,
click :guilabel:`Admin` in the upper right, then click
:guilabel:`General`, and then click :guilabel:`Version Manifest`. Here,
you can update the manifest directly, if your browser has internet access.
Otherwise, copy the manifest from
`<https://opsmanager.mongodb.com/static/version_manifest/1.6.json>`_ and
click the link for pasting in the manifest.

When MongoDB releases new versions, update the manifest.

Required Access
---------------

You must have :ref:`Global Automation Admin
<global-automation-admin-role>` or :ref:`Global Owner <global-owner-role>`
access to perform this procedure.

Procedure
---------

.. include:: /includes/steps/configure-local-mode.rst
