:orphan:

==============================================
Configure Backup Agent for LDAP Authentication
==============================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. include:: /includes/legacy-agents/fact-backup-agent-deprecated.rst

.. include:: /includes/extracts/intro-configure-backup-agent-ldap.rst

.. include:: /includes/extracts/note-manage-agent-auth-with-automation-ldap.rst

Considerations
--------------

You must configure LDAP authentication separately for each agent.
See :doc:`/tutorial/configure-monitoring-agent-for-ldap` for
configuration instructions for the Monitoring Agent.

You can configure LDAP authentication when activating backup or by
editing the an existing host's configuration.
:doc:`/tutorial/enable-ldap-authentication-for-group` for instructions.

Procedures
----------

Create User in MongoDB
~~~~~~~~~~~~~~~~~~~~~~

To back up MongoDB 2.6+ instances that are using LDAP authentication,
add a user that possess the required roles to the ``$external`` database
in MongoDB. The ``$external`` database allows :program:`mongod` to
consult an external source, such as an LDAP server, to authenticate.

Use the following commands to create the users from a 
|mongo| shell connected to your MongoDB deployment:

MongoDB 3.0 or later
````````````````````

.. code-block:: javascript

   db.getSiblingDB("$external").createUser(
       {
         user : "<username>",
         roles: [ { role: "backup", db: "admin" } ]
       }
   )

MongoDB 2.6
```````````

.. code-block:: javascript

   db.getSiblingDB("$external").createUser(
      {
        user: "<username>",
        roles: [ 
           "clusterAdmin",
           "readAnyDatabase",
           "userAdminAnyDatabase",
           { role: "readWrite", db: "admin" },
           { role: "readWrite", db: "local" },
        ]
      }
   )

See :doc:`/reference/required-access-backup-agent` for more information on the required access.

Host Settings
~~~~~~~~~~~~~

.. include:: /includes/fact-access-control-host-settings.rst
