.. _fts-about-indexing:

===============================
Create and Manage |fts| Indexes
===============================

.. default-domain:: mongodb

.. meta::
   :description: Learn how to create an manage an Atlas Search Index using the Atlas User Interface, Atlas Search API, or the Atlas CLI.

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. include:: /includes/facts/fts-index-description.rst

You can specify the fields to index using the following methods: 

- :ref:`Dynamic mappings <static-dynamic-mappings>`, which enables 
  |fts| to automatically index all the fields of :ref:`supported types 
  <bson-data-chart>` in each document. This might waste disk space to
  index fields that you would never search and negatively impact
  {+cluster+} performance.  
- :ref:`Static mappings <static-dynamic-mappings>`, which allows you to 
  selectively identify the fields to index. If fields contain
  polymorphic data, |fts| indexes only documents that correspond to the
  mapping in the index definition and ignores documents that contain
  values that don't correspond to the mapping specified in the index
  definition for the fields.

Considerations
--------------

When creating and managing |fts| indexes, 
consider the following:

Analyzers and Field Mappings
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

|fts| provides built-in analyzers for creating indexable terms that 
correct for differences in punctuation, capitalization, stop words, 
and more. Analyzers apply parsing and language rules to the query. You 
can also create a custom analyzer using available built-in character 
filters, tokenizers, and token filters. To learn more about the 
built-in and custom analyzers, see :ref:`analyzers-ref`.

To learn which data types |fts| supports for field mappings, see 
:ref:`bson-data-types`. The ``mongot`` process stores the indexed fields
and the ``_id`` field on disk per index for the collections on the
{+cluster+}.

.. note::

   |fts| doesn't support encrypting |fts| indexes with 
   :ref:`encryption keys using Customer Key Management 
   <security-kms-encryption>` in the {+atlas-ui+}.

**Prefer to learn by watching?**

Watch this video for an overview of |fts| indexes. In this video, you
can learn more about :ref:`analyzers <analyzers-ref>` and |fts|
:ref:`autocomplete <autocomplete-ref>` field type. 

*Duration: 8 Minutes*

.. video:: https://youtu.be/XrJG994YxD8
 
Disk, Memory, and Resource Usage
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Although the data stored on |fts| isn't an identical copy of data from
the collection on your |service| {+cluster+}, |fts| indexes still take
some disk space and memory. If you enable the ``store`` option for
fields that contain :ref:`string <bson-data-types-string>` values or if
you configure the :ref:`stored source fields <fts-stored-source-definition>`
in your index, |fts| stores an identical copy of the specified fields on
disk, which can take disk space.

.. |search-type| replace:: |fts|

.. include:: /includes/fact-fts-avs-index-resource-consumption.rst

.. note::
   
   .. include:: /includes/fact-fts-document-size.rst

Index Consistency and Rebuilding
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

If you make changes to the collection for which you defined |fts| 
indexes, the latest data might not be available immediately for 
queries. However, ``mongot`` monitors the change streams, which allows 
it to update stored copies of data, and |fts| indexes are eventually 
consistent.

When you change an index definition, ``mongot`` automatically rebuilds
the new index in the background, while continuing to serve queries with
the old index to make sure there is no downtime. This happens when you
deploy ``mongot`` and ``mongod`` processes on the same node and when you 
deploy the processes on different nodes. |service| also rebuilds indexes
when you enable or disable :ref:`Encryption at Rest <security-kms-encryption>`.

If you change the topology of your search deployment, |fts| provisions
and builds indexes on any new nodes before removing old nodes, to ensure
there is no query downtime. 

For deployments where both the ``mongod`` and ``mongot`` processes run on
the same node, if |fts| introduces changes that require rebuilding
your indexes (such as some |fts| features that require an :ref:`index
update <fts-index-rebuild>`), |service| automatically deploys additional
nodes for free to build the indexes, while the old nodes continue to
serve your queries.

Dedicated Search Nodes
~~~~~~~~~~~~~~~~~~~~~~

You can deploy :ref:`dedicated Search Nodes <what-is-search-node>` to
improve performance, scalability, and resource isolation.
If you've deployed Search Nodes, consider the following:

- Adding and adjusting :manual:`shards </sharding/>` triggers a
  rebuild of the |fts| index. During this index rebuild, the index
  might not have the most current data. Therefore, queries against data
  on those shards might fail or return incorrect results.

- If you :manual:`reshard </core/sharding-reshard-a-collection/>` a
  collection with |fts| indexes,|fts| indexes on the collection
  become unavailable when the resharding operation completes. You 
  *must* delete and create new |fts| indexes once the operation 
  is complete.  

- If you issue the command to :manual:`change the primary shard 
  </reference/command/movePrimary/>` of a database, the |fts| indexes
  for any unsharded collection under this database become unavailable
  once the operation completes. You *must* delete and create new |fts|
  indexes once the :dbcommand:`movePrimary` operation is complete.

.. _ref-index-management:

Supported Clients
-----------------

You can create and manage |fts| indexes from the {+atlas-ui+}, |fts|
API, {+atlas-cli+}, {+mongosh+}, |compass|, and :driver:`MongoDB drivers </>`. 

{+atlas-cli+} 
~~~~~~~~~~~~~

To create and manage |fts| indexes using the {+atlas-cli+}, your
|service| {+cluster+} must run MongoDB 6.0+ or 7.0+.

``mongosh``
~~~~~~~~~~~

To create and manage |fts| indexes using {+mongosh+}, 
your |service| {+cluster+} must run MongoDB 6.0+ or 7.0+.

|compass|
~~~~~~~~~

To create and manage |fts| indexes using {+Compass+}, 
your |service| {+cluster+} must run MongoDB 7.0+.

.. _fts-index-supported-drivers:

MongoDB Drivers 
~~~~~~~~~~~~~~~

To create and manage |fts| indexes programmatically on any
{+cluster+} tier, you can use any of the following
:driver:`MongoDB Drivers </>`: 

.. include:: /includes/list-table-index-supported-drivers-fts.rst

Next Steps 
----------

To learn how to create an |fts| index, see :ref:`ref-create-index`. 
For hands-on experience creating |fts| indexes for the :doc:`sample
datasets </sample-data>` and running |fts| queries against the indexed
data, try the tutorials in the following pages:

- :ref:`fts-tutorial-ref`
- :ref:`fts-tutorials`

.. toctree::
   :titlesonly:

   Create a Search Index </atlas-search/create-index>
   Resume or Delete a Draft </atlas-search/resume-index>
   View </atlas-search/view-index>
   Edit </atlas-search/edit-index>
   Delete </atlas-search/delete-index>
   Update </atlas-search/rebuild-index>
