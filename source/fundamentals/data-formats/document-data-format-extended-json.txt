===================================
Document Data Format: Extended JSON
===================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol


Overview
--------

JSON is a data format that represents data as objects that contain one or
more key/value pairs. The **Extended JSON** format adds special syntax to
JSON objects to represent field type information that directly corresponds
to each type in BSON, the format that MongoDB uses to store data.

This guide explains the following topics:

- the different MongoDB Extended JSON formats
- how to use the BSON library to convert between Extended JSON and Java objects

For more information on the difference between these formats, see our
`article on JSON and BSON <https://www.mongodb.com/json-and-bson>`__.

Extended JSON Formats
---------------------

MongoDB Extended JSON represents BSON in different formats to handle
specific use cases. These formats differ in the level of prioritization of
preserving BSON type information and how closely they resemble ordinary,
human-readable JSON.

See the table below to see a description of each format:


.. list-table::
   :header-rows: 1
   :stub-columns: 1
   :widths: 20 20

   * - Name
     - Description

   * - **Extended**
     - | Also known as the *canonical* format, this JSON representation avoids loss of BSON type information.
       | This format prioritizes type preservation at the loss of human-readability and interoperability with older formats.
       |
       | For more information on this format, see the server manual page on :manual:`MongoDB Extended JSON (v2) </reference/mongodb-extended-json/>`.

   * - **Relaxed**
     - | JSON representation that describes BSON documents with some type information loss.
       | This format prioritizes human-readability and interoperability at the loss of certain type information.
       |
       | For more information on this format, see the server manual page on :manual:`MongoDB Extended JSON (v2) </reference/mongodb-extended-json/>`.

   * - **Shell**
     - | JSON representation that matches the syntax used in the MongoDB shell.
       | This format prioritizes for compatibility with the MongoDB shell which often uses JavaScript functions to represent types.
       |
       | For more information on this format, see the server manual page on :manual:`Data Types in the mongo shell </core/shell-types/>`.

   * - **Strict**
     - | Deprecated. This representation is the legacy format that fully conforms to the `JSON RFC <http://www.json.org/>`__ which allows any JSON parser to read the type information.
       | This format prioritizes for compatibility at the loss of certain type information introduced in newer versions of BSON.
       |
       | For more information on this format, see the server manaul page on :manual:`Extended JSON v1 </reference/mongodb-extended-json-v1/>`.

Extended JSON Examples
~~~~~~~~~~~~~~~~~~~~~~

The following examples show a document containing an ObjectId, date, and long
number field represented in each Extended JSON format. Click the tab that
corresponds to the format of the example you want to see:

.. tabs::

   .. tab:: Extended
      :tabid: extended-format

      .. code-block:: json

         {
           "_id": { "$oid": "573a1391f29313caabcd9637" },
           "createdAt": { "$date": { "$numberLong": "1601499609" }},
           "numViews": { "$numberLong": "36520312" }
         }

   .. tab:: Relaxed
      :tabid: relaxed-format

      .. code-block:: json

         {
           "_id": { "$oid": "573a1391f29313caabcd9637" },
           "createdAt": { "$date": "2020-09-30T18:22:51.648Z" },
           "numViews": 36520312
         }

   .. tab:: Shell
      :tabid: shell-format

      .. code-block:: json

         {
           "_id:": ObjectId("573a1391f29313caabcd9637"),
           "createdAt": ISODate("2020-09-30T18:22:51.648Z"),
           "numViews": NumberLong("36520312")
         }

   .. tab:: Strict
      :tabid: strict-format

      .. code-block:: json

         {
           "_id": { "$oid": "573a1391f29313caabcd9637" },
           "createdAt": { "$date": "2020-09-30T18:22:51.648Z" },
           "numViews": { "$numberLong": "36520312" }}
         }


Read JSON
---------

You can read an Extended JSON string into Java objects with the BSON library
by using an instance of the ``JsonReader`` class. This class contains methods
to sequentially parse the fields and values in the Extended JSON object, and
returns them as Java objects. The ``JsonReader`` class automatically handles
any of the Extended JSON formats.

The following code example shows how you can use ``JsonReader`` to convert
an Extended JSON string into Java objects:

.. code-block:: java

   String ejsonStr = "{ \"_id\": { \"$oid\": \"507f1f77bcf86cd799439011\"}," +
                     "\"myNumber\": {\"$numberLong\": \"4794261\" }}}";

   JsonReader jsonReader = new JsonReader(ejsonStr);

   jsonReader.readStartDocument();

   jsonReader.readName("_id");
   ObjectId id = jsonReader.readObjectId();
   jsonReader.readName("myNumber");
   Long myNumber = jsonReader.readInt64();

   jsonReader.readEndDocument();

   System.out.println(id + " is type: " + id.getClass().getName());
   System.out.println(myNumber + " is type: " + myNumber.getClass().getName());

   jsonReader.close();

The output of this code example resembles the following:

.. code-block:: none
   :copyable: False

   507f1f77bcf86cd799439011 is type: org.bson.types.ObjectId
   4794261 is type: java.lang.Long

To construct an instance of a ``Document`` from Extended JSON, you can call
the ``parse()`` static factory method of the ``Document`` or ``BsonDocument``
class. This method instantiates a ``JsonReader``, parses the Extended JSON
string, and returns an instance of that class containing the data.

The following example shows how you can use the ``Document`` class to read
the same example Extended JSON string into a ``Document`` object using the
``parse()`` method:

.. code-block:: java

   String ejsonStr = "{ \"_id\": { \"$oid\": \"507f1f77bcf86cd799439011\"}," +
                     "\"myNumber\": {\"$numberLong\": \"4794261\" }}}";

   Document doc = new Document(Document.parse(ejsonStr));
   System.out.println(doc);

The output of the code above resembles the following:

.. code-block:: none
   :copyable: False

   Document{{_id=507f1f77bcf86cd799439011, myNumber=4794261}}

For more information on the driver document classes, see our Fundamentals page
on :doc:`Documents </fundamentals/data-formats/documents>`.

Write JSON
----------

You can convert Java objects into Extended JSON with the BSON library by using
the ``JsonWriter`` class. To construct an instance of ``JsonWriter``, pass a
subclass of a Java ``Writer`` to specify how you want to output the Extended
JSON. You can optionally pass a ``JsonWriterSettings`` to specify options such
as the Extended JSON format. By default, the ``JsonWriter`` uses the
"Strict" Extended JSON format to guarantee backwards compatibility.

The following code example shows how you can use ``JsonWriter`` to create an
Extended JSON string and output it to ``System.out``. We specify the format
by passing the ``outputMode()`` builder method the ``JsonMode.EXTENDED``
constant:

.. code-block:: java

   JsonWriterSettings settings = JsonWriterSettings.builder().outputMode(JsonMode.EXTENDED).build();

   try (JsonWriter jsonWriter = new JsonWriter(new BufferedWriter(new OutputStreamWriter(System.out)), settings)) {
       jsonWriter.writeStartDocument();
       jsonWriter.writeObjectId("_id", new ObjectId("507f1f77bcf86cd799439012"));
       jsonWriter.writeInt64("myNumber", 11223344);
       jsonWriter.writeEndDocument();
       jsonWriter.flush();
   }

The output of this code example resembles the following:

.. code-block:: none
   :copyable: false

   {"_id": {"$oid": "507f1f77bcf86cd799439012"}, "myNumber": {"$numberLong": "11223344"}}

To write Extended JSON from an instance of a ``Document``, you can call the
``toJson()`` method, passing it an instance of ``JsonWriterSettings`` to
specify the Extended JSON format. In this example, we use the "Relaxed" format.

.. code-block:: java

   Document myDoc = new Document();
   myDoc.append("_id", new ObjectId("507f1f77bcf86cd799439012")).append("myNumber", 11223344);

   JsonWriterSettings settings = JsonWriterSettings.builder().outputMode(JsonMode.RELAXED).build();
   System.out.println(doc.toJson(settings));

The output of this code example resembles the following:

.. code-block:: none
   :copyable: false

   {"_id": {"$oid": "507f1f77bcf86cd799439012"}, "myNumber": 11223344}


