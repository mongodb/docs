using System.Collections.Generic;
using System.Reflection.Emit;
using MongoDB.Bson;
using MongoDB.Bson.Serialization.Attributes;
using MongoDB.Bson.Serialization.Conventions;
using MongoDB.Driver;
using MongoDB.Driver.Search;

public class vectorSearchFilterQuery 
{
  // define connection to your Atlas cluster
  private const string MongoConnectionString = "<connection-string>";

  public static void Main(string[] args){
    var camelCaseConvention = new ConventionPack { new CamelCaseElementNameConvention() };
    ConventionRegistry.Register("CamelCase", camelCaseConvention, type => true);

    // connect to your Atlas cluster
    var mongoClient = new MongoClient(MongoConnectionString);

    // define namespace
    var moviesDatabase = mongoClient.GetDatabase("sample_mflix");
    var moviesCollection = moviesDatabase.GetCollection<EmbeddedMovie>("embedded_movies");

    // define vector embeddings to search
    var vector = new[] {-0.016465975,-0.0036450154,0.001644484,-0.028249683,-0.02077106,0.00031438665,-0.02351539,-0.017519485,-0.0025362284,-0.038888834,0.023489377,0.022695992,0.009481592,0.009995341,-0.0043506073,-0.0021297815,0.033972453,0.00070193375,0.007335553,-0.017909674,0.015191358,0.015360439,-0.00020505243,-0.023801528,-0.013539557,-0.0015290531,0.009631164,-0.026493832,-0.0245689,-0.02481602,0.02832772,-0.012473041,-0.006538917,-0.021707514,-0.01676512,-0.005865841,0.010359517,-0.013246916,0.014710125,0.0060869483,0.016192842,0.0026484078,0.002417546,-0.007764761,-0.0053781047,0.0016843157,0.009071894,0.0026158919,-0.016465975,0.019054228,0.030720878,0.028145632,-0.0124340225,-0.011491066,-0.01273967,-0.0076542073,0.00685432,0.002936172,0.03194347,-0.030798918,-0.004961903,0.012661632,-0.024646938,0.0085256295,-0.01133499,0.016648063,-0.017857648,0.01627088,-0.020823086,-0.002233832,0.008330535,0.024894057,0.008558145,0.013786677,0.027235191,-0.0075046346,-0.015308415,-0.0031442728,0.009136925,0.010548109,0.009455579,-0.0070624207,-0.001147806,0.008928824,0.011042348,-0.019314354,-0.0035702293,0.019691538,0.013929747,-0.00071615935,-0.0016477356,-0.0029556816,0.009592146,0.011699166,-0.045183886,0.018533977,-0.025063138,0.002194813,-0.013968766,0.0037848332,-0.014775156,0.0138777215,-0.023112195,-0.019288342,-0.02252691,-0.009813253,-0.0030792414,0.00088036386,0.0048285886,-0.019691538,-0.021863589,0.0068413136,0.01641395,-0.04494977,-0.0027475806,-0.014710125,0.0077192388,-0.0030954992,0.005417124,-0.008219982,0.014046803,0.01662205,0.027235191,0.0015266144,0.036261562,0.02006872,-0.032489736,-0.0019379386,0.004106739,-0.006808798,0.048825648,0.0096766865,0.0132794315,0.0066722315,-0.026116649,0.019912645,-0.017441448,-0.0014128092,-0.041880284,-0.018599007,0.018729072,0.00619425,-0.01947043,-0.009748221,-0.012121871,0.0001831043,0.037198015,0.03451872,-0.0045684627,-0.0040742233,0.022708999,-0.028847972,0.027287217,0.0008214291,0.018156795,-0.007816786,-0.017519485,0.00501718,-0.0013811064,-0.0148401875,0.012752676,-0.01686917,-0.0018013725,-0.014645093,-0.0064218603,0.016426956,0.008558145,0.013207897,-0.012518563,-0.00018208819,0.022643967,0.020745048,-0.018143788,0.0123169655,-0.018039737,0.019626506,-0.009162938,0.0030255904,-0.02942025,-0.007511138,0.0050139283,-0.006408854,0.04065769,0.011419531,0.000562116,0.032775875,-0.012043833,0.009410057,-0.012694148,-0.019041222,0.015646579,0.021109223,-0.010749706,-0.01915828,-0.6842354,-0.022748018,0.010444058,-0.013090841,0.031241132,0.0032792133,0.030772904,-0.0061389734,-0.018013725,-0.0103335045,0.0075046346,0.012395004,-0.0035442165,-0.011256952,0.017064264,-0.00813544,0.014319936,-0.044559583,0.0053065703,0.00027028716,-0.014892213,0.012499054,0.002056621,-0.006860823,-0.020875111,-0.0028890243,-0.01048958,0.0043993806,-0.004360362,0.01922331,-0.031501256,0.025882537,0.0032922195,-0.0058300737,0.053117726,0.0013900483,-0.029784426,0.055875063,0.02417871,0.038888834,-0.00365477,-0.0024793257,0.0005182197,-0.008805265,-0.007589176,0.013643608,0.03685985,-0.024152698,0.00400594,-0.0148401875,0.01971755,0.0002887805,-0.0050594504,-0.020120746,0.00209564,0.00084947393,0.004688771,-0.013526551,0.016140817,0.024191717,0.0020354858,0.008200472,-0.014463005,-0.012453532,0.0034596757,0.0014843439,-0.0266369,0.0069648735,-0.0044318964,-0.015620566,0.0060154134,0.018937172,-0.01588069,-0.0025882535,0.03251575,0.062118087,0.017805625,-0.0098522715,-0.013968766,-0.016153824,0.01641395,0.0018794102,-0.019964669,0.012290953,0.024855038,-0.015334427,-0.012017821,0.007647704,-0.01402079,-0.0008665447,0.0069778794,0.014007784,-0.009709203,-0.011022839,-0.017311385,-0.0050139283,-0.0033393675,0.0025573636,0.010463567,-0.028691897,-0.016752115,0.008974346,0.024373805,-0.003908393,-0.026142662,0.015906705,-0.012440525,0.006808798,0.033998467,-0.006808798,0.011764198,0.0033913925,0.003986431,0.0067632757,0.012154386,-0.025609404,0.008616674,0.0023037407,0.028093606,-0.02762538,0.0077127353,-0.015828667,0.014033797,0.009039378,0.0032905939,0.011829229,-0.020133752,-0.0066137034,0.008902812,-0.020667009,0.008655692,0.020693023,0.022266785,-0.01216089,0.03620954,-0.0069973893,0.0014347574,-0.0002489487,0.020536946,0.0008933702,-0.021135237,-0.0017704825,-0.007875314,-0.0022078194,0.005384608,-0.030200627,-0.010821241,-0.0011136644,-0.013383482,0.01986062,0.007647704,0.010353014,-0.0065454203,0.0041490095,0.005170004,-0.0070949364,-0.04031953,-0.0148401875,-0.0075826724,-0.020510934,0.0012607982,0.006425112,-0.017441448,0.011165908,-0.0019606997,-0.017532492,-0.017649548,0.019548468,-0.023593428,-0.027989557,0.014944238,-0.007589176,0.018039737,0.014593068,-0.000074125746,0.029342212,-0.0027589612,0.00043571103,-0.017207334,0.003755569,-0.008896309,-0.027677406,-0.0058365767,-0.010665165,0.0009974206,0.01662205,-0.0016526129,0.005726023,-0.012193406,0.013526551,-0.027183166,0.032567773,-0.01203733,-0.004792821,0.009540121,0.006899842,-0.010918789,0.022006659,0.020953149,0.0073745716,0.011022839,-0.025505353,0.018937172,0.0181698,0.013292438,-0.038706746,-0.0021818068,-0.025050133,0.041984335,-0.004565211,0.00012589691,-0.004968406,-0.004835092,-0.023788521,0.008785755,0.013578577,-0.012473041,0.008473604,-0.01922331,0.012499054,0.016218856,-0.018338881,0.024295768,-0.0015688848,0.012687645,0.037198015,-0.004158764,0.023294283,-0.010918789,-0.01405981,-0.015412465,0.0056187212,-0.010235958,0.007114446,0.01170567,0.015048289,0.027547343,-0.039461114,0.034856882,0.004243305,0.006025168,0.012941268,0.02853582,0.004786318,0.015022276,-0.0034531725,0.04073573,-0.027313229,-0.006386093,0.0016266003,-0.034102518,-0.0015705107,-0.020836093,-0.0064218603,0.007933843,-0.028769935,0.009936812,0.0038303551,0.022682985,0.020797072,0.0044253934,0.020406883,0.012082852,-0.0028955275,0.007972862,-0.0057032625,0.002684175,0.0074526095,-0.022344822,0.0052838093,-0.004965155,-0.0088312775,0.023333302,-0.009566133,0.013266426,0.0070168986,0.008850787,-0.0021525426,-0.0006653535,0.016192842,-0.0039409087,-0.049527988,0.0058008097,-0.01205684,-0.010268473,-0.016518,-0.030954992,-0.0022159482,-0.038914848,0.010730197,-0.0006629148,0.012902249,-0.0037880847,0.0011136644,-0.036079474,0.010645656,0.012785193,-0.0056122183,0.007888321,-0.0036059965,-0.013435507,-0.004327846,-0.02762538,-0.0006722631,0.02428276,0.024724975,-0.007790773,0.00027557096,0.00685432,-0.025440322,0.011634135,0.011068361,-0.003983179,0.020901123,0.019210305,0.011035845,-0.006737263,-0.01405981,0.01205684,-0.000036885052,-0.011185418,-0.02287808,-0.010340008,-0.017805625,0.10004445,-0.0103920335,-0.0067112506,0.0101579195,-0.019587487,-0.023658458,-0.014996263,-0.0056252247,0.003189795,0.011022839,-0.009462083,-0.017155308,-0.010053869,0.0041977833,0.0023427596,0.01216089,-0.004285576,-0.003175163,0.0022809797,-0.006376338,0.028431771,-0.023112195,0.03280189,0.025843518,0.028509809,0.0067437664,0.000053498567,0.009527114,0.008259,-0.03293195,-0.0032401944,0.0038108458,0.0053553437,0.013734652,-0.0080443965,-0.0177536,0.014931232,0.006051181,0.034128528,-0.030408729,0.015659584,0.04341503,0.00082183554,-0.01831287,0.012421016,-0.024048647,-0.01655702,0.01627088,-0.0214734,-0.025856523,0.019821601,0.01191377,-0.026337756,-0.030044552,0.0096051525,0.026090637,-0.00149166,0.019275336,-0.0049586515,-0.011120386,-0.0010518845,-0.020549953,0.020927135,0.0032922195,0.004054714,-0.020836093,0.00082102267,-0.015763635,-0.0068478165,-0.0015916459,-0.014124841,-0.008870296,0.010951304,-0.019678531,0.0029410494,-0.008070408,0.03092898,-0.008141943,0.0028093606,0.017129296,-0.02671494,-0.017766604,-0.028587846,-0.028249683,0.010053869,0.0061129606,0.0047700605,-0.012128375,-0.011627631,0.010424549,0.020640997,0.017831637,0.024477856,0.000978724,0.00071412715,-0.014306929,0.00279798,0.012733167,0.014645093,0.013149369,-0.006447873,-0.033582266,0.011465053,0.00060560583,-0.0015802654,-0.01620585,0.010795228,0.021798559,-0.0015022276,0.0061292187,0.03553321,-0.01666107,0.029056072,-0.003648267,0.020393878,0.021083212,-0.00060519937,0.020016694,-0.00827851,-0.023034155,0.023203239,-0.016296893,-0.017207334,0.051504947,-0.010144914,-0.019392392,0.020445902,-0.022982132,0.0019330613,0.01441098,-0.031189106,0.02393159,-0.0031020024,-0.006073942,-0.025492348,-0.01866404,-0.01121143,0.01567259,0.01143904,-0.0037360594,-0.008941831,-0.00005959527,0.018820114,-0.00044790443,0.012791695,-0.021512419,0.0009762854,0.0043180916,-0.02091413,0.007790773,-0.030876955,0.006200753,0.00017294314,-0.0009608404,-0.021356344,-0.031371195,-0.02256593,-0.025752474,0.0216815,0.016609045,0.04312889,0.0022078194,0.031657334,0.0011949538,-0.01013841,-0.0037490658,-0.019652518,-0.0024354295,-0.039513137,0.01662205,0.03784833,0.006431615,0.003113383,-0.010613141,-0.0014875955,0.012551079,0.0010844002,0.0006515343,-0.004106739,-0.023775516,-0.0042042863,0.0001352452,0.008213478,-0.01108787,-0.017207334,-0.008480107,0.02733924,0.016426956,0.013383482,-0.009045881,0.017181322,-0.003466179,-0.005248042,-0.0060609356,0.010593631,0.011484562,-0.00082508713,-0.0064673824,0.008473604,0.0074005844,0.015932716,-0.0062755393,-0.0064056027,-0.012648626,-0.011452046,0.010626147,-0.008460598,-0.040163454,-0.00718598,-0.022708999,-0.010105895,-0.020940142,-0.008272006,-0.0464585,0.005696759,0.0025866278,-0.020640997,0.024555894,0.0016339164,-0.010704185,0.021317326,-0.0064608795,0.038758773,0.005072457,0.022513904,0.0088312775,0.009377542,-0.0055634445,0.016960215,0.014254904,-0.016426956,0.004965155,0.012876237,-0.000355641,-0.0117186755,0.016817145,-0.00048367176,-0.034180555,-0.024490861,0.021746533,0.007836295,0.016361924,-0.014749143,-0.012447028,-0.034128528,0.02492007,-0.0076672137,0.019249324,-0.024503868,-0.009546624,-0.028275695,0.030200627,-0.01887214,0.008746737,0.015594553,-0.018911159,-0.0045847204,-0.008603667,-0.0030646094,0.0016030264,0.0022078194,0.04083978,0.016036768,0.005995904,0.011016335,0.014788163,-0.0020094733,-0.0012624239,-0.012258437,0.026740951,-0.01736341,-0.008746737,-0.0126811415,-0.0026906782,0.0028126123,0.011868248,-0.002944301,-0.006912848,-0.019743562,0.0008844284,-0.00002194813,0.023567414,-0.025674434,-0.002485829,-0.028015569,-0.022266785,0.0009779112,-0.025570385,0.009572636,-0.017324392,-0.030512778,-0.008245993,-0.024972094,0.0067567728,-0.012590098,-0.022513904,0.00848661,0.04435148,-0.0326198,-0.0048318403,-0.031501256,0.0071534645,-0.010359517,0.01947043,-0.013032312,-0.032879926,0.03423258,-0.019314354,-0.007972862,-0.022409854,0.0067567728,-0.0072315023,-0.0031979238,0.0042725694,0.02133033,-0.013487533,-0.0018859134,-0.023593428,-0.0148401875,0.00803139,0.0037815815,-0.00084540946,0.0021249042,-0.040111426,0.0071924836,0.010235958,0.022630962,-0.009000359,-0.017272366,0.010008347,-0.035377134,0.010541606,-0.026506837,-0.01273967,-0.0088312775,0.019873625,-0.012212915,0.040111426,-0.008896309,0.013981772,0.022487892,0.014319936,-0.0062170113,0.01228445,-0.02140837,-0.0048448467,0.0011030968,-0.006470634,-0.003449921,0.004136003,-0.016400944,0.013851709,0.024061654,-0.020693023,-0.0083500445,0.009364536,-0.040345542,0.0068868357,-0.0042693177,0.012830715,0.0004094952,0.009058887,-0.008811768,0.008577654,0.00048367176,-0.0020582469,-0.0035507197,0.00032942518,0.010424549,-0.0032954712,0.0057065138,-0.0014046803,-0.018403914,-0.023905579,0.021291312,-0.01275918,0.021213274,0.00069502415,-0.006951867,-0.011777204,-0.009819756,0.00071981736,-0.0017298379,0.011959292,0.011881255,-0.039357062,-0.0025102159,-0.0062917974,-0.0142418975,-0.017194327,-0.008057402,0.010444058,-0.0011526833,0.013578577,-0.0041262484,-0.003625506,0.0016648063,-0.028249683,0.021421375,0.0153214205,-0.0074526095,0.019652518,0.016465975,-0.004158764,-0.020354858,-0.022227766,-0.016244868,-0.019353373,-0.00365477,-0.015399459,0.013201394,-0.029992526,0.010372524,-0.013292438,0.010457065,-0.0030824929,0.017428441,-0.0009746596,0.0005300067,0.009299504,-0.028379746,-0.003012584,-0.002593131,-0.0071209488,-0.016114805,-0.009403555,-0.010502587,-0.001316075,0.0075826724,0.027781455,-0.005582954,0.00104782,-0.021447388,0.0058690924,-0.001032375,0.01911926,0.18895552,-0.006295049,-0.010587128,0.047264893,-0.00097547245,0.032437712,0.035819348,-0.010769216,-0.013734652,0.01588069,0.0024500617,0.00061251543,-0.009130422,-0.0040937327,-0.0014339446,-0.0073550623,-0.017805625,0.0035734808,-0.0117186755,-0.019873625,-0.013272929,0.00425306,-0.011640638,-0.0027296972,0.008024887,0.0060154134,0.0070949364,0.010040863,0.006376338,-0.0058073127,-0.010522096,0.012486047,0.015932716,-0.019054228,-0.02502412,0.0069973893,-0.01335747,-0.012492551,0.010652159,0.0032548264,-0.015503509,0.008649189,0.009598649,0.0056122183,-0.009162938,0.023788521,-0.011595116,0.009988838,0.008005377,0.004841595,-0.02632475,-0.009735215,0.029966515,0.028093606,-0.0068933386,-0.0024972095,0.0046465006,0.0058333254,0.017142303,0.011243946,-0.0013030686,0.020680016,-0.012102362,0.028847972,-0.008226484,0.0035051976,-0.01461908,0.0073550623,0.002163923,-0.016895182,-0.001193328,-0.017025245,0.0024988353,-0.012843721,-0.022839062,-0.031475246,0.025674434,0.022370836,0.011972299,0.02382754,-0.011900764,-0.03204752,0.00695837,-0.008915818,-0.01781863,0.0044156387,-0.0011502446,0.017688567,-0.013194891,0.0021314074,0.0012225922,-0.027001077,-0.00074583,0.012271443,0.010294486,0.014710125,0.01641395,0.009540121,-0.008330535,0.0005958511,-0.026662914,-0.0019444418,0.024737982,0.012147884,-0.0067892885,0.016335912,-0.017558504,-0.0058170673,-0.0009689693,0.0025866278,0.0105676185,-0.02442583,-0.01170567,-0.005397614,-0.018078756,-0.019704543,0.005498413,0.016648063,0.024490861,-0.013942753,0.015867686,-0.002645156,0.008805265,-0.007296534,0.0083500445,-0.0025362284,-0.031553283,0.0077517545,0.0035832354,-0.041594144,0.006704747,-0.011185418,0.0037913362,-0.012011318,-0.025830511,0.041802246,-0.01003436,0.0097937435,0.003641764,0.022787036,-0.0017867404,-0.0026110145,0.028145632,0.011152902,0.004311588,-0.021915615,-0.009182448,0.02077106,-0.006171489,-0.0055309287,-0.019379387,0.0022647218,-0.021213274,-0.014983257,0.01158211,-0.0149572445,-0.021278305,-0.011725179,-0.021798559,0.019691538,-0.04835742,0.011536588,0.029082086,-0.0006828307,-0.020003688,-0.0067957914,-0.16679278,0.015646579,0.037119977,-0.026480826,0.0109317945,0.0053488407,0.013825696,-0.00035117008,-0.0013892354,-0.0014022416,0.021915615,0.008974346,-0.03274986,-0.0078688115,0.023034155,0.003518204,-0.017857648,0.025037127,0.0137606645,0.02411368,0.025765479,0.0024338039,-0.00607069,-0.005114727,-0.009071894,-0.0094295675,0.021096218,0.016400944,-0.013175381,-0.0047440478,-0.015789647,-0.006548672,0.017766604,0.0077452515,0.0044221417,0.00838256,0.0007568041,-0.015386452,-0.017649548,0.014306929,-0.003066235,0.02783348,-0.006984383,-0.02586953,0.005108224,0.02432178,0.00885729,0.0023297535,0.007166471,-0.0021281557,-0.0052740546,-0.0035149525,0.014085822,0.00063893443,0.031215118,-0.00425306,0.014202879,-0.018351888,-0.0032158075,-0.0055081677,0.003999437,-0.0017753599,0.022748018,-0.023684472,-0.007946849,-0.019145273,-0.022487892,0.018247837,-0.004535947,0.008993856,-0.0043018335,0.005498413,-0.0022647218,-0.023112195,0.0055114194,0.008818271,-0.00536835,0.022604948,-0.020406883,-0.024386812,-0.014931232,0.01761053,0.0037588205,-0.0034986946,0.01831287,0.036001436,-0.000008446474,-0.024907064,-0.0036612733,-0.011725179,0.023047162,-0.029758412,-0.014554049,-0.012934765,0.015412465,0.021850582,-0.011523581,-0.0022858572,-0.0040742233,-0.0056187212,0.010307493,-0.019184291,0.005192765,0.008018384,0.022722006,-0.0058138156,0.03771827,0.01028148,0.029212149,-0.0054366332,0.0014079319,-0.0009974206,0.011627631,0.026480826,0.0025346025,0.018937172,0.0085971635,-0.012395004,0.011608122,0.00065397297,0.040085416,0.008883302,-0.0013339586,-0.0064413697,-0.007296534,0.0028467537,-0.092917,-0.00801188,0.016192842,0.027469303,-0.033166062,0.017662555,-0.002692304,0.036079474,-0.0144760115,0.020445902,-0.00036641184,-0.018442933,-0.008493113,-0.01476215,0.018703058,0.001552627,0.0065876907,-0.017974706,-0.0076542073,0.022149729,-0.010066876,0.004932639,-0.0061292187,0.0016436711,-0.007959855,0.0031393955,-0.0324117,0.037093967,0.007114446,0.019821601,-0.016518,-0.0034596757,0.021668496,-0.03332214,0.012785193,-0.007810283,-0.018833121,-0.0029963262,0.0210572,-0.019392392,0.0021135237,0.015685597,0.013116853,-0.027495317,0.011250449,-0.0071924836,-0.019106254,0.0107562095,0.014007784,-0.034492705,-0.03394644,-0.024750987,-0.041047882,-0.006685238,0.0068868357,0.008694711,0.019093247,0.01261611,-0.009748221,-0.0027394518,0.014918226,-0.0032710843,-0.0044936766,0.01546449,0.018208819,0.004288827,-0.021538433,-0.026897028,0.023879565,-0.018299863,-0.012245431,0.015516515,-0.040891804,-0.011816223,-0.02221476,0.012082852,-0.02417871,-0.009338523,0.010047366,-0.027079115,-0.016010754,-0.021863589,-0.004305085,-0.027261203,0.024100672,0.000711282,0.001071394,-0.0037263047,-0.007829792,-0.0049456456,-0.021603463,0.03274986,0.01866404,-0.032567773,-0.0044318964,0.017935688,0.018638028,-0.015282402,-0.009377542,0.03012259,0.015178352,-0.004792821,-0.048305396,0.007075427,0.020784067,0.010678172,0.0019509449,0.0045684627,0.02242286,-0.011374009,0.024477856,-0.0021736778,-0.021291312,-0.009188951,0.02692304,-0.0038628709,-0.02442583,-0.029394237,0.019054228,0.01606278,-0.0035051976,-0.00012284856,0.01911926,0.0088768,0.007036408,0.0015461239,-0.0030711126,0.0034629272,-0.015152339,0.02097916,-0.031163093,0.0061909985,0.012694148,-0.021902608,-0.030044552,0.031553283,0.0002003783,-0.037119977,0.0003367412,0.015347433,0.003105254,0.034102518,0.001911926,-0.008102925,0.0003306445,0.011647142,-0.004288827,0.019665524,-0.011907267,0.01391674,0.0014428863,-0.01655702,-0.0020387375,0.009975832,-0.0009982334,-0.018586002,-0.0137606645,-0.031787395,0.02481602,0.0059308726,-0.0011941409,-0.009598649,0.0126811415,0.015828667,-0.0058918535,-0.0040807263,-0.00406772,-0.0015233628,-0.01402079,-0.0052577965,0.0018290109,-0.018182807,-0.014736137,0.014423986,-0.001820882,-0.013799684,0.0029085337,0.009949819,0.02407466,0.01992565,-0.01986062,0.02892601,0.0029768168,0.00044018193,-0.012882739,0.022487892,0.0061682374,0.014528036,0.0021785551,0.006304804,0.0010722068,-0.0075696665,-0.0040417076,0.0097937435,-0.01216089,-0.0044026324,-0.018494958,0.053898104,-0.0037100469,-0.013929747,0.0210572,0.014293923,0.028613858,-0.005791055,-0.008863793,-0.021668496,0.0011803217,0.0053781047,-0.020588972,-0.030304678,-0.015893698,-0.0041295,0.04705679,0.020198783,-0.007010395,0.0039344057,0.00019905735,0.010587128,0.0026549108,-0.015165345,-0.023996623,0.01476215,-0.0021200269,0.0458342,0.02221476,-0.021174256,0.009000359,0.027573355,-0.007634698,-0.0053520924,-0.0032190592,0.010196939,0.014033797,0.01203733,-0.032307647,-0.00873373,-0.016609045,-0.014593068,-0.014658099,0.015828667,-0.024087666,0.03043474,-0.0020598727,0.006327565,0.0019850864,-0.004236802,0.015932716,0.00049139425,-0.0023232503,-0.018351888,-0.025466334,-0.010457065,-0.00039587924,0.0017330894,-0.024334786,-0.018599007,-0.0031442728,-0.030564804,0.036807828,0.0051895133,-0.015620566,0.020680016,0.021239286,0.019171285,-0.00803139,-0.027963543,-0.0049261358,0.018429926,0.011217933,-0.015984742,-0.020575965,-0.007472119,-0.0071924836,-0.035975423,-0.028405758,0.027573355,0.0015770138,-0.009279994,-0.007634698,0.007810283,0.039929338,-0.029186135,0.025245227,-0.02446485,-0.011770701,0.009611655,-0.0033718832,-0.015451483,0.007829792,-0.018403914};

    // define filter
    var firstCriteria = Builders<EmbeddedMovie>.Filter.AnyNe(movie => movie.Genres, "Crime");
    var secondCriteria = Builders<EmbeddedMovie>.Filter.And(
                Builders<EmbeddedMovie>.Filter.Lte(movie => movie.Year, 2015),
                Builders<EmbeddedMovie>.Filter.AnyEq(movie => movie.Genres, "Action")
            );

    // define options 
    var options = new VectorSearchOptions<EmbeddedMovie>() {
        Filter = Builders<EmbeddedMovie>.Filter.Or(firstCriteria, secondCriteria),
        IndexName = "default",
        NumberOfCandidates = 200
    };

    // run query
    var results = moviesCollection.Aggregate()
                .VectorSearch(m => m.Embedding, vector, 10, options)
                .Project(Builders<EmbeddedMovie>.Projection
                  .Include(movie => movie.Title)
                  .Include(movie => movie.Plot)
                  .Include(movie => movie.Year)
                  .Include(movie => movie.Genres)
                  .Exclude(movie => movie.Id))
                .ToList();

    // print results
    foreach (var movie in results)
      {
        Console.WriteLine(movie.ToJson());
      }
  }
}

[BsonIgnoreExtraElements]
public class EmbeddedMovie
{
    [BsonIgnoreIfDefault]
    public ObjectId Id { get; set; }
    public string Title { get; set; }
    public string Plot { get; set; }
    public int Year { get; set; }
    [BsonElement("genres")]
    public string [] Genres { get; set; } 
    [BsonElement("plot_embedding")]
    public double[] Embedding { get; set; }
}