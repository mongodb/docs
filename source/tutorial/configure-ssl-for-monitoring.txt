.. _configure-ssl-monitoring:

======================================================
Configure Monitoring to Connect with MongoDB using SSL
======================================================

|monitoring| can monitor MongoDB instances running with SSL.


Prerequisite
------------

The MongoDB instance must use SSL. To use SSL with a ``mongod`` and
``mongos`` instance, you must enable it at compile time, or use `MongoDB
Enterprise <https://www.mongodb.com/products/downloads/mongodb-enterprise>`_.

Procedures
----------

Configure the Monitoring Agent with the Trusted CA Certificate
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Configure the Backup Agent with the trusted CA certificates used to sign
the certificates used by any MongoDB instances running with SSL.

Edit the Monitoring Agent's ``monitoring-agent.config`` file, located in
the agent install directory, to set ``sslTrustedServerCertificates`` to
the path of a file containing one or more certificates in PEM format.

By default, the Monitoring Agent only connects to MongoDB instances using
a trusted certificate. For testing purposes, you can set the
``sslRequireValidServerCertificates`` setting to ``False`` to bypass this
check. This configuration is NOT recommended for production use as it
makes the connection insecure.

For reference information on both settings, see :ref:`ssl-settings-monitoring`.

Activate SSL for the Monitoring Agent Connection with MongoDB
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

To monitor a host with SSL enabled, you can either:

- Edit the ``monitoring-agent.config`` file in your agent installation,
  so that the ``useSslForAllConnections`` value is ``True``, as follows:

  .. code-block:: ini

     useSslForAllConnections = True

  Then restart the Monitoring Agent. After restarting the agent you
  may observe a five minute delay before |monitoring| receives data
  from the agent.

- Enable support on a per-host basis in the MMS console by clicking
  on the edit (i.e. "Pencil") button on the right hand-side of the
  "Hosts" page. In the dialogue that pops up, click the check-box on
  the SSL tab.

  If you enable SSL support globally you **will not** be able to
  override this setting on a per-host basis.
