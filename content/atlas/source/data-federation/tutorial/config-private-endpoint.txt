.. _config-private-endpoint:

============================================================
Set Up a Private Endpoint for a {+FDI+} 
============================================================

.. meta::
   :keywords: atlas api, atlas cli, atlas ui
   :description: Set up AWS PrivateLink endpoints for a federated database instance using Atlas CLI, UI, or API.

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. composable-tutorial::
   :options: cloud-provider, interface
   :defaults: aws, atlas-ui

   MongoDB supports |aws| and |azure| private endpoints for your {+fdi+}. You 
   can set up the private endpoints from the {+atlas-cli+}, {+atlas-ui+}, and 
   and {+atlas-admin-api+}.

   .. note::

      You can't use your |service| cluster :ref:`private endpoint ID
      <private-endpoint>` for {+adf+}. The {+adf+} endpoint ID must be
      different from your |service| cluster endpoint ID, if you have one. 

   Required Access
   ---------------

   To set up a private endpoint, you must have :authrole:`Project Owner` access to the project.
   Users with :authrole:`Organization Owner` access must add themselves as a ``Project Owner``
   to the project before setting up a private endpoint.

   Prerequisites 
   -------------

   .. selected-content::
      :selections: aws, atlas-ui
      
      .. include:: /includes/prereqs-config-private-endpoint-aws.rst

   .. selected-content::
      :selections: aws, atlas-cli

      .. include:: /includes/prereqs-config-private-endpoint-aws.rst
   
   .. selected-content::
      :selections: aws, atlas-api

      .. include:: /includes/prereqs-config-private-endpoint-aws.rst

   .. selected-content::
      :selections: azure, atlas-ui

      .. include:: /includes/prereqs-config-private-endpoint-azure.rst

   .. selected-content::
      :selections: azure, atlas-cli

      .. include:: /includes/prereqs-config-private-endpoint-azure.rst

   .. selected-content::
      :selections: azure, atlas-api

      .. include:: /includes/prereqs-config-private-endpoint-azure.rst

   Procedure
   ---------

   .. selected-content::
      :selections: aws, atlas-ui
 
      To set up a private endpoint for your {+fdi+} using the {+atlas-ui+}, follow these steps:

      .. tabs::

         .. tab:: Create New Endpoint
            :tabid: create-new

            .. include:: /includes/steps-adf-aws-create-new-privatelink.rst

         .. tab:: Add Existing Endpoint
            :tabid: add-existing

            .. include:: /includes/steps-adf-add-existing-privatelink-aws.rst

   .. selected-content::
      :selections: azure, atlas-ui

      .. include:: /includes/steps-adf-create-privatelink-azure.rst

   .. selected-content::
      :selections: aws, atlas-cli

      .. include:: /includes/extracts/atlas-dataFederation-privateEndpoints-create.rst

   .. selected-content::
      :selections: azure, atlas-cli

      .. include:: /includes/extracts/atlas-dataFederation-privateEndpoints-create.rst

   .. selected-content::
      :selections: aws, atlas-api

      To configure a private endpoint from the API, send a ``POST`` request
      with the private endpoint ID to the ``privateNetworkSettings``
      endpoint.

      - If the endpoint ID already exists and there is no change to 
        the comment associated with the endpoint, |service| makes no change 
        to the endpoint ID list.
      - If the endpoint ID already exists and there is a change to the 
        associated comment, |service| updates the ``comment`` value only in 
        the endpoint ID list.
      - If the endpoint ID doesn't exist, |service| appends the new endpoint 
        to the list of endpoints in the endpoint ID list.

      To learn more about the syntax and options, see :oas-bump-atlas-op:`API 
      <creategroupprivatenetworksettingendpointid>`.

   .. selected-content::
      :selections: azure, atlas-api

      To configure a private endpoint from the API, send a ``POST`` request
      with the private endpoint ID to the ``privateNetworkSettings``
      endpoint.

      - If the endpoint ID already exists and there is no change to
        the comment associated with the endpoint, |service| makes no change
        to the endpoint ID list.
      - If the endpoint ID already exists and there is a change to the
        associated comment, |service| updates the ``comment`` value only in
        the endpoint ID list.
      - If the endpoint ID doesn't exist, |service| appends the new endpoint
        to the list of endpoints in the endpoint ID list.

      To learn more about the syntax and options, see :oas-atlas-op:`API
      </createOneDataFederationPrivateEndpointForOneProject>`.

   To verify whether the private endpoint setup is successful:

   .. procedure::
      :style: normal

      .. include:: /includes/nav/steps-network-access.rst

      .. step:: Click the :guilabel:`Private Endpoint` tab.

      .. step:: Click the :guilabel:`Federated Database Instance / Online Archive` tab.

      .. step:: Review the details.

         Review the :guilabel:`Cloud Provider`, :guilabel:`Region`, :guilabel:`Endpoint Status`, :guilabel:`VPC ID / Virtual Network Name` and :guilabel:`Description`.

         To learn more, see :ref:`view-private-endpoints`.

