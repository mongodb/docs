:noprevnext:

.. _deploy-om-container-local-mode:

================================================
Configure an |onprem| Resource to use Local Mode
================================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

.. include:: /includes/styles/corrections.rst

.. important::

   Configuring |onprem| to use Local Mode in |k8s| is not recommended.
   Consider :ref:`configuring Ops Manager to use Remote Mode <deploy-om-container-remote-mode>` instead.

In a default configuration, the {+mdbagent+}\s and Backup Daemons
access MongoDB installation archives over the Internet from |company|

You can configure |onprem| to run in **Local Mode** with the 
|k8s-op-short| if the nodes in your |k8s| cluster don't have access to
the Internet. The Backup Daemons and managed MongoDB resources download
installation archives only from a |k8s-pv| that you create for
the |onprem| StatefulSet.

This procedure covers uploading installation archives to |onprem|.

Considerations
--------------

When you upgrade the version of an |onprem| resource in Local
Mode, you might need to install the latest version of the :dl:`MongoDB
Database Tools <database-tools>`. 

.. list-table::
   :header-rows: 1
   :widths: 30 70

   * - |onprem| Version
     - Action

   * - 4.4.4+
     - No installation necessary.

   * - 4.4.0 - 4.4.3
     - Install the latest version of the :dl:`MongoDB Database Tools
       <database-tools>`.
       ``automation.versions.directory`` specifies
       the location of the Database Tools, which defaults to
       ``/mongodb-ops-manager/mongodb-releases/``.

Prerequisites
-------------

- :ref:`deploy-om-container`. The following procedure shows you how to 
  update your |onprem| |k8s| |k8s-obj| to enable Local Mode.

- To avoid downtime when you enable Local Mode, ensure that you set 
  :opsmgrkube:`spec.replicas` to a value greater than ``1`` in your 
  |onprem| resource definition.

  If you updated your |onprem| resource definition to make |onprem| 
  highly available, apply your changes before you begin this tutorial:

  .. code-block:: sh

     kubectl apply -f <opsmgr-resource>.yaml -n <namespace>

Procedure
---------

.. include:: /includes/steps/deploy-k8s-opsmgr-local-mode.rst
