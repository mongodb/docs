==============================
Monitoring Agent Configuration
==============================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. warning::

   Do **not** edit these settings for a Monitoring Agent that is managed by an Automation Agent.
   If you do, the Automation Agent will overwrite any changes you make.  

Configuration File
------------------

The location of the Monitoring Agent configuration file depends on your
operating system:

- RHEL, CentOS, Amazon Linux, and Ubuntu all use a package manager to
  install the agent. The package manager creates the following agent
  configuration file:

  ``/etc/mongodb-mms/monitoring-agent.config``

- OS X, Windows, and other Linux systems use either a ``tar`` or ``msi``
  file for the installation. The Monitoring Agent stores its configuration
  in the following file:

  ``<installation directory>/monitoring-agent.config``

Settings
--------

.. _monitoring-agent-connection-settings:

Connection Settings
~~~~~~~~~~~~~~~~~~~

For the Monitoring Agent communication with the |mms| servers, the following
connection settings are **required**:

.. msetting:: mmsApiKey

   *Type*: string

   The |mms| agent API key for a |mms| group. To retrieve the key from the |mms|
   interface, click :guilabel:`Settings`, then the
   :guilabel:`Agents` page, and then the link for your operating system.
   |mms| will display the |mms| API key used by your |mms| group.

   For example:

   .. code-block:: ini

      mmsApiKey=abc123

.. msetting:: mmsBaseUrl

   *Type*: string

   The URL of the |mms| Web Server.

.. only:: onprem

   Set this to the |mms| URL.
   For example:

   .. code-block:: ini

      mmsBaseUrl=http://example.com:8080

HTTP Proxy Settings
~~~~~~~~~~~~~~~~~~~

.. msetting:: httpProxy

   *Type*: string

   To connect to |mms| via a proxy, specify the URL of
   the proxy. For example:

   .. code-block:: ini

      httpProxy=http://example-proxy.com:8080

.. _monitoring-agent-ssl-settings:

MongoDB SSL Settings
~~~~~~~~~~~~~~~~~~~~

Specify these settings when the Monitoring Agent is connecting to MongoDB
instances with SSL.

.. msetting:: useSslForAllConnections

   *Type*: boolean

   Set to ``true`` to enable SSL support globally and to use SSL for all
   MongoDB connections. Setting this to ``true`` overrides any per-host
   SSL settings configured in the |mms| interface.

   When ``true``, use :msetting:`useSslForAllConnections` with the
   :msetting:`sslTrustedServerCertificates` setting to specify the
   certificates that |mms| should accept.

   .. note::

      If :msetting:`useSslForAllConnections` is ``true`` **and** you set
      :msetting:`sslRequireValidServerCertificates` to ``false``, |mms|
      will accept any connection regardless of the certificate provided.
      This is only recommended for testing purposes as it makes
      connections susceptible to man-in-the-middle attacks.

.. msetting:: sslClientCertificate

   *Type*: string

   The path to the private key, client certificate, and
   optional intermediate certificates in PEM format. The agent will
   use the client certificate when connecting to any configured MongoDB that
   uses SSL and requires a client certificate, i.e., that is running using the
   :option:`--sslCAFile <mongod --sslCAFile>` option.

   For example, if you would use the following command to connect through
   the :program:`mongo` shell to a MongoDB process that uses both SSL and
   certificate validation:

   .. code-block:: sh

      mongo --ssl --sslPEMKeyFile /etc/ssl/client.pem --sslCAFile /etc/ssl/ca.pem example.net:27017

   Then set the following in your Monitoring Agent configuration file:

   .. code-block:: ini

      sslTrustedServerCertificates=/etc/ssl/ca.pem
      sslClientCertificate=/etc/ssl/client.pem

.. msetting:: sslClientCertificatePassword

   *Type*: string

   The password needed to decrypt the private key in the file specified in
   :msetting:`sslClientCertificate`.
   This setting is necessary only if the client certificate PEM file is
   encrypted.

.. msetting:: sslTrustedServerCertificates

   *Type*: string

   The path on disk that contains the trusted certificate authority certificates
   in PEM format. These certificates will verify the server certificate
   returned from any MongoDB instances running with SSL. For example:

   .. code-block:: ini

      sslTrustedServerCertificates=/etc/ssl/ca.pem

.. msetting:: sslRequireValidServerCertificates

   *Type*: boolean

   Use this option to disable certificate verification by setting this
   value to ``false``. That configuration is only recommended for
   testing purposes as it makes connections susceptible to man-in-the-middle
   attacks.

.. _mongodb-kerberos-settings:

MongoDB Kerberos Settings
~~~~~~~~~~~~~~~~~~~~~~~~~

See :doc:`/tutorial/configure-monitoring-agent-for-kerberos`

.. msetting:: krb5Principal

   *Type*: string

   The Kerberos principal used by the agent. For example:

   .. code-block:: ini

      krb5Principal=mmsagent/myhost@EXAMPLE.COM

.. msetting:: krb5Keytab

   *Type*: string

   The *absolute* path to Kerberos principal's keytab file. For
   example:

   .. code-block:: ini

      krb5Keytab=/etc/mongodb-mms/mms-monitoring-agent.keytab

.. msetting:: krb5ConfigLocation

   *Type*: string

   The *absolute* path to an non-system-standard location for the Kerberos configuration file. For
   example:

   .. code-block:: ini

      krb5ConfigLocation=/etc/krb_custom.conf

.. msetting:: gsappiServiceName

   *Type*: string

   The default service name used by MongoDB is ``mongodb`` can specify
   a custom service name with the :msetting:`gssapiServiceName` option.

.. _server-monitoring-ssl:

|mms| Server SSL Settings
~~~~~~~~~~~~~~~~~~~~~~~~~

.. only:: onprem

   Advanced SSL settings used by the Monitoring Agent when communicating to the
   |mms| HTTP Service.

.. msetting:: sslTrustedMMSServerCertificate

   By default the Monitoring Agent will use the trusted root CAs installed on the
   system. If the agent cannot find the trusted root CAs, configure
   these settings manually.

   .. only:: onprem

      If the |mms| HTTP Service uses a self-signed SSL certificate, you
      *must* specify :msetting:`sslTrustedMMSServerCertificate`.

   The path on disk that contains the trusted certificate authority certificates
   in PEM format. The agent will use this certificate to verify that
   the agent is communicating with the designated |mms| HTTP
   Service. For example:

   .. code-block:: ini

      sslTrustedMMSServerCertificate=/etc/mongodb-mms/mms-certs.pem

.. only:: onprem

   .. msetting:: sslRequireValidMMSServerCertificates

      *Type*: boolean

      You can disable certificate verification by setting this value
      to  ``false``. That configuration is only recommended for
      testing purposes as it makes connections susceptible to
      *man-in-the-middle* attacks.

Munin Settings
~~~~~~~~~~~~~~

See :doc:`/tutorial/configure-monitoring-munin-node` for information on
configuring Munin-node.

.. msetting:: enableMunin

   *Type*: boolean

   Set to ``false`` if you do not with the Monitoring Agent to
   collect hardware statistics via Munin-node. The default is
   ``true``. If the agent detects ``munin-node``, |mms| will collect
   hardware statistics.

Deprecated Settings
~~~~~~~~~~~~~~~~~~~

MongoDB Authentication Settings
+++++++++++++++++++++++++++++++

If all monitored MongoDB instances use the same MONGODB-CR
credentials, you may use these settings. Setting the username and
password here will override any configuration in the |mms| UI.

See :doc:`/reference/required-access-monitoring-agent` for information
on the privileges needed for this user.

.. msetting:: globalAuthUsername

   *Type*: string

   The MongoDB username that the Monitoring Agent will use to connect.
   **This value overrides all other usernames configured for the
   Monitoring Agent.**

   Example:

   .. code-block:: ini

      globalAuthUsername=mms-monitoring-agent

.. msetting:: globalAuthPassword

   *Type*: string

   The password for the ``globalAuthUsername`` user. **This value
   overrides all other passwords configured for the Monitoring Agent.**

   Example:

   .. code-block:: ini

      globalAuthPassword=somePassword
