=================================
Required Access for MongoDB Agent
=================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

If your MongoDB deployment enforces access control, the |mms|
{+mdbagent+} must authenticate to MongoDB as a
:manual:`user with the proper access </core/security-users>`.

.. note::

   The instructions on this page are for deployments that do not use {+aagent+}. If you use {+aagent+}, |mms| manages authentication for you and the following instructions do not apply.

To authenticate, create a user with the appropriate roles in MongoDB.
The following tutorials include instructions and examples for creating
the {+mdbagent+} user in your MongoDB deployment:

- :doc:`/tutorial/configure-mongodb-agent-for-scram`.

- :doc:`/tutorial/configure-mongodb-agent-for-ldap`.

- :doc:`/tutorial/configure-mongodb-agent-for-kerberos`.

- :doc:`/tutorial/configure-mongodb-agent-for-x509`.

MongoDB user roles are separate from |mms|
:doc:`user roles </reference/user-roles>`. These roles and their
privileges are described in the MongoDB manual beginning with the
:manual:`Authorization </core/authorization>` page.

Considerations
--------------

.. include:: /includes/considerations-mongodb-agent-access-control.rst

.. important::

   Every ``mongod`` and ``mongos`` process in your |mms| deployment
   must use the same username and roles for the {+mdbagent+} user.

Automation
----------

.. include:: /includes/prerequisites-create-user-for-agent.rst

To automate MongoDB instances, the {+mdbagent+} must authenticate
to the database as a MongoDB user with the following access:

.. list-table::
   :header-rows: 1

   * - Required Role
     - Database
   * - :authrole:`clusterAdmin`
     - ``admin``
   * - :authrole:`readWriteAnyDatabase`
     - ``admin``
   * - :authrole:`userAdminAnyDatabase`
     - ``admin``
   * - :authrole:`dbAdminAnyDatabase`
     - ``admin``
   * - :authrole:`backup`
     - ``admin``
   * - :authrole:`restore`
     - ``admin``

Backup
------

.. tabs::

   .. tab:: FCV 4.2 or later
      :tabid: fcv-4.2

      To backup MongoDB instances running FCV 4.2 and later, the
      {+mdbagent+} must authenticate as a user with the following role:

      .. list-table::
         :header-rows: 1

         * - Required Role
           - Database
         * - :authrole:`clusterAdmin`
           - ``admin``

   .. tab:: FCV 4.0 or earlier
      :tabid: fcv-4.0

      To backup MongoDB instances running FCV 4.0 and earlier, the
      {+mdbagent+} must authenticate as a user with the following role:

      .. list-table::
         :header-rows: 1

         * - Required Role
           - Database
         * - :authrole:`backup`
           - ``admin``

Monitoring
----------

To monitor MongoDB instances, including :dbcommand:`dbStats`
and :doc:`database profiling </tutorial/profile-database>`
information, the {+mdbagent+} must authenticate to the database
as a user with the following role:

.. list-table::
   :header-rows: 1

   * - Required Role
     - Database
   * - :authrole:`clusterMonitor`
     - ``admin``

Authentication Mechanisms
-------------------------

To authenticate, create the user in MongoDB with the appropriate
access. The authentication method that the MongoDB deployment uses
determines which options to set when creating the user as well as
determining any additional {+mdbagent+} configuration:

.. include:: /includes/ref-configure-mdbagent-access-control-verbose.rst
