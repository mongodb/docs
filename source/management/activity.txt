.. index:: alerts

===========================
Activity: Alerts and Events
===========================

Activity Page
-------------

The *Activity* tab includes information and elements previously
available in the *Events* and *Alerts* pages in the MMS interface.

The *Activity* page has three sections:

#. *All Activity*, which shows a feed of all MMS events as well as all
   open alerts.

#. *Closed Alerts*, which shows a list of alerts that users have
   closed explicitly or where the metric has dropped below the
   threshold of the alert.

#. *Settings*, which provides an interface to create new alerts and
   manage existing alerts.

Procedures
----------

Create an Alert
~~~~~~~~~~~~~~~

To create an alert:

1. Click the :guilabel:`Activity` section, on the left side of |mms|, then 
   click the *Alert Settings* tab. A page with a list of alert settings will
   appear.

2. Click the :guilabel:`Add Alert` button in the top right of the Alert
   Settings page. A pop-up window appears where you can configure the alert.

3. In the first section, choose the target category to monitor. Target
   categories refer to the monitored target and include: hosts, agents
   and backups.

   - If you select a host, choose the host type and then the condition
     or metric. 

   - If you select an agent, choose the agent to monitor.

   .. only:: saas

      - If you select backup, choose which condition to use for the alert.

4. In the second section, choose to create an alert for
   *either* any monitored target (i.e. host, agent, or backup) *or* a
   subset of the monitored targets.

   If you want to specify a subset of monitored targets, you can
   specify the criteria used to select targets here.

.. only:: saas

   5. In the third section, you may add recipients (i.e. users or groups)
      and specify the distribution method (i.e. email addresses, and
      SMS) to define the distribution list of the alert.

.. only:: hosted

   5. In the third section, you may add recipients (i.e. users or groups)
      and specify the distribution method (i.e. email addresses, SNMP, and
      SMS) to define the distribution list of the alert.
          
      For SNMP alerts, specify the hostname that will receive
      the v2c trap on standard port ``162``.

The MIB file for SNMP is `available for download here
<http://downloads.mongodb.com/on-prem-monitoring/MMS-10GEN-MIB.txt>`_.

.. important::

   Users must ensure that they have entered the correct number into
   the :guilabel:`Alerts` interface. MMS removes all punctuation and
   letters and only uses the digits for the telephone number.

   .. include:: /includes/fact-intl-phone-numbers.rst

You may also create multiple alerts with different minimum times
before notification to implement alert escalation.

.. important:: The time between re-notifications increases by the
   frequency amount every alert cycle (e.g. 5 minutes, 10 minutes,
   15 minutes, 20 minutes,) up to a maximum of 24 hours.

.. START-COMMENT

   - If you select **Group** and check the **SMS** box, then MMS sends
     alert text messages to all users in the group who have filled
     in their Mobile Number in the Settings page.

   - If you select **User** and check the **SMS** box, then MMS sends
     alert text messages to the user's Mobile Number specified in
     their Settings page. 

   - MMS sends alert emails as multipart messages containing both HTML
     and plain text content. This way, the recipient's email client
     can choose the appropriate message format for display. 

.. END-COMMENT

Configure Existing Alerts
~~~~~~~~~~~~~~~~~~~~~~~~~

To modify an existing alert, select the *Settings* tab to view all of
the available alerts. In the settings drop down on the right side of
each alert, you can edit, clone, disable, or delete the alert.

Each alert has a distribution list that you can edit *and* a frequency
setting that controls how often MMS will distribute the alert.

Alerts are processed on a 5 minute interval.

.. START-COMMENT

   Per Mike Benoit 12/17/2013, mms-docs Pull 80: The reason for the 5 minute
   minimum is that our alert processing job only executes every five minutes.
   Thus, setting this lower than 5 minutes wouldn't have any impact. This also
   means that only multiples of 5 make sense for this value.

.. END-COMMENT

View Open Alerts
~~~~~~~~~~~~~~~~

To view open alerts visit the *All Activity* tab. Open alerts appear
above the "Feed" section in an "Open Alerts" section that only appears
if there are open alerts. From this interface you can acknowledge an
alert and select the duration of the acknowledgment.

Once a user acknowledges an alert in the interface, MMS sends no
further notifications to the alert's distribution list until the
acknowledgement period has passed.

The distribution list receives *no* notification of alert
acknowledgment.

Event and Alert Types
---------------------

Events
~~~~~~

The activity feed presents the following event types:

- "**new host**" occurs when the agent identifies a new MongoDB host.

- "**restart**" occurs when a ``mongod`` or other monitored
  instance restarts.

- "**upgrade**" occurs after upgrading ``mongod`` to a new
  version.

- "**now secondary**" occurs when a ``mongod`` instance becomes
  secondary in a replica set.

- "**now primary**" occurs when a ``mongod`` instance becomes
  primary in a replica set.

- "**opened alert**" occurs when MMS creates a new alert. 

- "**closed alert**" occurs when a user closes an alert *or* when the
  triggering event passes below the threshold of the alert.

.. _alerts: 

Alerts
~~~~~~

.. only:: saas

   There are five possible alert types:

   - "**Old Host Version**" activates in response to ``mongod`` running
     an out of date version of MongoDB.

   - "**Host Down**" activates in response to a ``mongod`` or other
     monitored instance restarts or fails to check in to MMS within 7
     minutes. There are no "host down" alerts if the agent is down.

   - "**Agent Down**" activates in response to an agent that fails to
     report to MMS within 8 minutes.

   - "**Host Recovering**" activates when a replica set member enters
     ``RECOVERING`` status.

   - "**Metric Outside Threshold**" activates when a monitored metric
     passes a specified threshold.

.. only:: hosted

   There are four possible alert types.
   |monitoring|:

   - "**Host Down**" activates in response to a ``mongod`` or other
     monitored instance restarts or fails to check in to MMS within 5
     minutes. There are no "host down" alerts if the agent is down.

   - "**Agent Down**" activates in response to an agent that fails to
     report to MMS within 3 minutes.

   - "**Host Recovering**" activates when a replica set member enters
     ``RECOVERING`` status.

   - "**Metric Outside Threshold**" activates when a monitored metric
     passes a specified threshold.
