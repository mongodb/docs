{
  "type": "page",
  "data": {
    "_id": "64b05c8b8d53f9c4afd2875f",
    "page_id": "docs/docsworker-xlarge/v6.0/reference/operator/aggregation/merge",
    "ast": {
      "type": "root",
      "position": { "start": { "line": 0 } },
      "children": [
        {
          "type": "target",
          "position": { "start": { "line": 0 } },
          "children": [
            {
              "type": "target_identifier",
              "position": { "start": { "line": 0 } },
              "children": [
                {
                  "type": "text",
                  "position": { "start": { "line": 4 } },
                  "value": "$merge (aggregation)"
                }
              ],
              "ids": ["agg-merge"]
            }
          ],
          "domain": "std",
          "name": "label",
          "html_id": "std-label-agg-merge"
        },
        {
          "type": "section",
          "position": { "start": { "line": 4 } },
          "children": [
            {
              "type": "heading",
              "position": { "start": { "line": 4 } },
              "children": [
                {
                  "type": "text",
                  "position": { "start": { "line": 4 } },
                  "value": "$merge (aggregation)"
                }
              ],
              "id": "-merge--aggregation-"
            },
            {
              "type": "directive",
              "position": { "start": { "line": 6 } },
              "children": [],
              "domain": "",
              "name": "default-domain",
              "argument": [
                {
                  "type": "text",
                  "position": { "start": { "line": 6 } },
                  "value": "mongodb"
                }
              ]
            },
            {
              "type": "directive",
              "position": { "start": { "line": 8 } },
              "children": [],
              "domain": "",
              "name": "contents",
              "argument": [
                {
                  "type": "text",
                  "position": { "start": { "line": 8 } },
                  "value": "On this page"
                }
              ],
              "options": {
                "local": true,
                "backlinks": "none",
                "depth": 1,
                "class": "twocols"
              }
            },
            {
              "type": "directive",
              "position": { "start": { "line": 14 } },
              "children": [],
              "domain": "",
              "name": "meta",
              "argument": [],
              "options": {
                "description": "MongoDB on-demand materialized view, SELECT INTO",
                "keywords": "MongoDB, materialized view, SELECT INTO, INSERT INTO"
              }
            },
            {
              "type": "section",
              "position": { "start": { "line": 19 } },
              "children": [
                {
                  "type": "heading",
                  "position": { "start": { "line": 19 } },
                  "children": [
                    {
                      "type": "text",
                      "position": { "start": { "line": 19 } },
                      "value": "Definition"
                    }
                  ],
                  "id": "definition"
                },
                {
                  "type": "directive",
                  "position": { "start": { "line": 21 } },
                  "children": [
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 23 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 23 } },
                          "value": "This page describes the "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 23 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 23 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 23 } },
                                  "value": "$merge"
                                }
                              ]
                            }
                          ],
                          "domain": "mongodb",
                          "name": "pipeline",
                          "target": "pipe.$merge",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "mongodb-pipeline-pipe.-merge"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 23 } },
                          "value": " stage, which outputs the\naggregation pipeline results to a collection. For the\n"
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 23 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 23 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 23 } },
                                  "value": "$mergeObjects"
                                }
                              ]
                            }
                          ],
                          "domain": "mongodb",
                          "name": "expression",
                          "target": "exp.$mergeObjects",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/mergeObjects",
                            "mongodb-expression-exp.-mergeObjects"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 23 } },
                          "value": " operator, which merges documents into a\nsingle document, see "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 23 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 23 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 23 } },
                                  "value": "$mergeObjects"
                                }
                              ]
                            }
                          ],
                          "domain": "mongodb",
                          "name": "expression",
                          "target": "exp.$mergeObjects",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/mergeObjects",
                            "mongodb-expression-exp.-mergeObjects"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 23 } },
                          "value": "."
                        }
                      ]
                    }
                  ],
                  "domain": "",
                  "name": "note",
                  "argument": []
                },
                {
                  "type": "target",
                  "position": { "start": { "line": 28 } },
                  "children": [
                    {
                      "type": "directive_argument",
                      "position": { "start": { "line": 75 } },
                      "children": [
                        {
                          "type": "literal",
                          "position": { "start": { "line": 75 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 75 } },
                              "value": "$merge"
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "type": "target_identifier",
                      "position": { "start": { "line": 75 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 75 } },
                          "value": "$merge"
                        }
                      ],
                      "ids": ["pipe.$merge"]
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 30 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 30 } },
                          "value": "Writes the results of the "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 30 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 30 } },
                              "value": "aggregation pipeline"
                            }
                          ],
                          "domain": "std",
                          "name": "doc",
                          "target": "",
                          "flag": "",
                          "fileid": ["/core/aggregation-pipeline", ""]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 30 } },
                          "value": " to a specified collection. The\n"
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 30 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 30 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 30 } },
                                  "value": "$merge"
                                }
                              ]
                            }
                          ],
                          "domain": "mongodb",
                          "name": "pipeline",
                          "target": "pipe.$merge",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "mongodb-pipeline-pipe.-merge"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 30 } },
                          "value": " operator must be the "
                        },
                        {
                          "type": "strong",
                          "position": { "start": { "line": 30 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 30 } },
                              "value": "last"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 30 } },
                          "value": " stage in the\npipeline."
                        }
                      ]
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 35 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 35 } },
                          "value": "The "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 35 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 35 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 35 } },
                                  "value": "$merge"
                                }
                              ]
                            }
                          ],
                          "domain": "mongodb",
                          "name": "pipeline",
                          "target": "pipe.$merge",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "mongodb-pipeline-pipe.-merge"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 35 } },
                          "value": " stage:"
                        }
                      ]
                    },
                    {
                      "type": "list",
                      "position": { "start": { "line": 37 } },
                      "children": [
                        {
                          "type": "listItem",
                          "position": { "start": { "line": 37 } },
                          "children": [
                            {
                              "type": "paragraph",
                              "position": { "start": { "line": 37 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 37 } },
                                  "value": "Can output to a collection in the same or different database."
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "type": "listItem",
                          "position": { "start": { "line": 37 } },
                          "children": [
                            {
                              "type": "paragraph",
                              "position": { "start": { "line": 39 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 39 } },
                                  "value": "Starting in MongoDB 4.4:"
                                }
                              ]
                            },
                            {
                              "type": "list",
                              "position": { "start": { "line": 41 } },
                              "children": [
                                {
                                  "type": "listItem",
                                  "position": { "start": { "line": 41 } },
                                  "children": [
                                    {
                                      "type": "paragraph",
                                      "position": { "start": { "line": 41 } },
                                      "children": [
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 41 }
                                          },
                                          "children": [
                                            {
                                              "type": "literal",
                                              "position": {
                                                "start": { "line": 41 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 41 }
                                                  },
                                                  "value": "$merge"
                                                }
                                              ]
                                            }
                                          ],
                                          "domain": "mongodb",
                                          "name": "pipeline",
                                          "target": "pipe.$merge",
                                          "flag": "",
                                          "fileid": [
                                            "reference/operator/aggregation/merge",
                                            "mongodb-pipeline-pipe.-merge"
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 41 }
                                          },
                                          "value": " can output to the\nsame collection that is being aggregated. For more\ninformation, see "
                                        },
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 41 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 41 }
                                              },
                                              "value": "Output to the Same Collection that is Being Aggregated"
                                            }
                                          ],
                                          "domain": "std",
                                          "name": "label",
                                          "target": "merge-behavior-same-collection",
                                          "flag": "",
                                          "fileid": [
                                            "reference/operator/aggregation/merge",
                                            "std-label-merge-behavior-same-collection"
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 41 }
                                          },
                                          "value": "."
                                        }
                                      ]
                                    }
                                  ]
                                },
                                {
                                  "type": "listItem",
                                  "position": { "start": { "line": 41 } },
                                  "children": [
                                    {
                                      "type": "paragraph",
                                      "position": { "start": { "line": 45 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 45 }
                                          },
                                          "value": "Pipelines with the "
                                        },
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 45 }
                                          },
                                          "children": [
                                            {
                                              "type": "literal",
                                              "position": {
                                                "start": { "line": 45 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 45 }
                                                  },
                                                  "value": "$merge"
                                                }
                                              ]
                                            }
                                          ],
                                          "domain": "mongodb",
                                          "name": "pipeline",
                                          "target": "pipe.$merge",
                                          "flag": "",
                                          "fileid": [
                                            "reference/operator/aggregation/merge",
                                            "mongodb-pipeline-pipe.-merge"
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 45 }
                                          },
                                          "value": " stage can run on\nreplica set secondary nodes if all the nodes in cluster have\n"
                                        },
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 45 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 45 }
                                              },
                                              "value": "featureCompatibilityVersion"
                                            }
                                          ],
                                          "domain": "std",
                                          "name": "label",
                                          "target": "view-fcv",
                                          "flag": "",
                                          "fileid": [
                                            "reference/command/setFeatureCompatibilityVersion",
                                            "std-label-view-fcv"
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 45 }
                                          },
                                          "value": " set\nto "
                                        },
                                        {
                                          "type": "literal",
                                          "position": {
                                            "start": { "line": 45 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 45 }
                                              },
                                              "value": "4.4"
                                            }
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 45 }
                                          },
                                          "value": " or higher and the "
                                        },
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 45 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 8 }
                                              },
                                              "value": "Read Preference"
                                            }
                                          ],
                                          "domain": "std",
                                          "name": "doc",
                                          "target": "",
                                          "flag": "",
                                          "fileid": [
                                            "/core/read-preference",
                                            ""
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 45 }
                                          },
                                          "value": "\nallows secondary reads."
                                        }
                                      ]
                                    },
                                    {
                                      "type": "list",
                                      "position": { "start": { "line": 51 } },
                                      "children": [
                                        {
                                          "type": "listItem",
                                          "position": {
                                            "start": { "line": 51 }
                                          },
                                          "children": [
                                            {
                                              "type": "paragraph",
                                              "position": {
                                                "start": { "line": 51 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 51 }
                                                  },
                                                  "value": "Read operations of the "
                                                },
                                                {
                                                  "type": "ref_role",
                                                  "position": {
                                                    "start": { "line": 51 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "literal",
                                                      "position": {
                                                        "start": { "line": 51 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "text",
                                                          "position": {
                                                            "start": {
                                                              "line": 51
                                                            }
                                                          },
                                                          "value": "$merge"
                                                        }
                                                      ]
                                                    }
                                                  ],
                                                  "domain": "mongodb",
                                                  "name": "pipeline",
                                                  "target": "pipe.$merge",
                                                  "flag": "",
                                                  "fileid": [
                                                    "reference/operator/aggregation/merge",
                                                    "mongodb-pipeline-pipe.-merge"
                                                  ]
                                                },
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 51 }
                                                  },
                                                  "value": " statement are sent to\nsecondary nodes, while the write operations occur only on the\nprimary node."
                                                }
                                              ]
                                            }
                                          ]
                                        },
                                        {
                                          "type": "listItem",
                                          "position": {
                                            "start": { "line": 51 }
                                          },
                                          "children": [
                                            {
                                              "type": "paragraph",
                                              "position": {
                                                "start": { "line": 55 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 55 }
                                                  },
                                                  "value": "Not all driver versions support targeting of "
                                                },
                                                {
                                                  "type": "ref_role",
                                                  "position": {
                                                    "start": { "line": 55 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "literal",
                                                      "position": {
                                                        "start": { "line": 55 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "text",
                                                          "position": {
                                                            "start": {
                                                              "line": 55
                                                            }
                                                          },
                                                          "value": "$merge"
                                                        }
                                                      ]
                                                    }
                                                  ],
                                                  "domain": "mongodb",
                                                  "name": "pipeline",
                                                  "target": "pipe.$merge",
                                                  "flag": "",
                                                  "fileid": [
                                                    "reference/operator/aggregation/merge",
                                                    "mongodb-pipeline-pipe.-merge"
                                                  ]
                                                },
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 55 }
                                                  },
                                                  "value": "\noperations to replica set secondary nodes. Check your\n"
                                                },
                                                {
                                                  "type": "reference",
                                                  "position": {
                                                    "start": { "line": 55 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 55 }
                                                      },
                                                      "value": "driver"
                                                    }
                                                  ],
                                                  "refuri": "https://www.mongodb.com/docs/drivers/"
                                                },
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 55 }
                                                  },
                                                  "value": " documentation to see when your driver added\nsupport for "
                                                },
                                                {
                                                  "type": "ref_role",
                                                  "position": {
                                                    "start": { "line": 55 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "literal",
                                                      "position": {
                                                        "start": { "line": 55 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "text",
                                                          "position": {
                                                            "start": {
                                                              "line": 55
                                                            }
                                                          },
                                                          "value": "$merge"
                                                        }
                                                      ]
                                                    }
                                                  ],
                                                  "domain": "mongodb",
                                                  "name": "pipeline",
                                                  "target": "pipe.$merge",
                                                  "flag": "",
                                                  "fileid": [
                                                    "reference/operator/aggregation/merge",
                                                    "mongodb-pipeline-pipe.-merge"
                                                  ]
                                                },
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 55 }
                                                  },
                                                  "value": " read operations running on\nsecondary nodes."
                                                }
                                              ]
                                            }
                                          ]
                                        }
                                      ],
                                      "enumtype": "unordered"
                                    }
                                  ]
                                }
                              ],
                              "enumtype": "unordered"
                            }
                          ]
                        },
                        {
                          "type": "listItem",
                          "position": { "start": { "line": 37 } },
                          "children": [
                            {
                              "type": "paragraph",
                              "position": { "start": { "line": 61 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 61 } },
                                  "value": "Creates a new collection if the output collection does not already\nexist."
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "type": "listItem",
                          "position": { "start": { "line": 37 } },
                          "children": [
                            {
                              "type": "paragraph",
                              "position": { "start": { "line": 64 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 64 } },
                                  "value": "Can incorporate results (insert new documents, merge documents,\nreplace documents, keep existing documents, fail the operation,\nprocess documents with a custom update pipeline) into an existing\ncollection."
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "type": "listItem",
                          "position": { "start": { "line": 37 } },
                          "children": [
                            {
                              "type": "paragraph",
                              "position": { "start": { "line": 69 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 69 } },
                                  "value": "Can output to a sharded collection. Input collection can\nalso be sharded."
                                }
                              ]
                            }
                          ]
                        }
                      ],
                      "enumtype": "unordered"
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 72 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 72 } },
                          "value": "For a comparison with the "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 72 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 72 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 72 } },
                                  "value": "$out"
                                }
                              ]
                            }
                          ],
                          "domain": "mongodb",
                          "name": "pipeline",
                          "target": "pipe.$out",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/out",
                            "mongodb-pipeline-pipe.-out"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 72 } },
                          "value": " stage which also outputs\nthe aggregation results to a collection, see\n"
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 72 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 72 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 72 } },
                                  "value": "$merge"
                                }
                              ]
                            },
                            {
                              "type": "text",
                              "position": { "start": { "line": 72 } },
                              "value": " and "
                            },
                            {
                              "type": "literal",
                              "position": { "start": { "line": 72 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 72 } },
                                  "value": "$out"
                                }
                              ]
                            },
                            {
                              "type": "text",
                              "position": { "start": { "line": 72 } },
                              "value": " Comparison"
                            }
                          ],
                          "domain": "std",
                          "name": "label",
                          "target": "merge-out-comparison",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "std-label-merge-out-comparison"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 72 } },
                          "value": "."
                        }
                      ]
                    }
                  ],
                  "domain": "mongodb",
                  "name": "pipeline",
                  "html_id": "mongodb-pipeline-pipe.-merge"
                },
                {
                  "type": "directive",
                  "position": { "start": { "line": 76 } },
                  "children": [
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 78 } },
                      "children": [
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 78 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 78 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 78 } },
                                  "value": "$merge"
                                }
                              ]
                            }
                          ],
                          "domain": "mongodb",
                          "name": "pipeline",
                          "target": "pipe.$merge",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "mongodb-pipeline-pipe.-merge"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 78 } },
                          "value": " can incorporate the pipeline results into an\nexisting output collection rather than perform a full replacement of\nthe collection. This functionality allows users to create on-demand\nmaterialized views, where the content of the output collection is\nincrementally updated when the pipeline is run."
                        }
                      ]
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 84 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 84 } },
                          "value": "For more information on this use case, see\n"
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 84 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 4 } },
                              "value": "On-Demand Materialized Views"
                            }
                          ],
                          "domain": "std",
                          "name": "doc",
                          "target": "",
                          "flag": "",
                          "fileid": ["/core/materialized-views", ""]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 84 } },
                          "value": " as well as the examples on this page."
                        }
                      ]
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 87 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 87 } },
                          "value": "Materialized views are separate from read-only views. For\ninformation on creating read-only views, see "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 87 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 87 } },
                              "value": "read-only views"
                            }
                          ],
                          "domain": "std",
                          "name": "doc",
                          "target": "",
                          "flag": "",
                          "fileid": ["/core/views", ""]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 87 } },
                          "value": "."
                        }
                      ]
                    }
                  ],
                  "domain": "",
                  "name": "note",
                  "argument": [
                    {
                      "type": "text",
                      "position": { "start": { "line": 76 } },
                      "value": "On-Demand Materialized Views"
                    }
                  ]
                }
              ]
            },
            {
              "type": "section",
              "position": { "start": { "line": 92 } },
              "children": [
                {
                  "type": "heading",
                  "position": { "start": { "line": 92 } },
                  "children": [
                    {
                      "type": "text",
                      "position": { "start": { "line": 92 } },
                      "value": "Syntax"
                    }
                  ],
                  "id": "syntax"
                },
                {
                  "type": "paragraph",
                  "position": { "start": { "line": 94 } },
                  "children": [
                    {
                      "type": "ref_role",
                      "position": { "start": { "line": 94 } },
                      "children": [
                        {
                          "type": "literal",
                          "position": { "start": { "line": 94 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 94 } },
                              "value": "$merge"
                            }
                          ]
                        }
                      ],
                      "domain": "mongodb",
                      "name": "pipeline",
                      "target": "pipe.$merge",
                      "flag": "",
                      "fileid": [
                        "reference/operator/aggregation/merge",
                        "mongodb-pipeline-pipe.-merge"
                      ]
                    },
                    {
                      "type": "text",
                      "position": { "start": { "line": 94 } },
                      "value": " has the following syntax:"
                    }
                  ]
                },
                {
                  "type": "code",
                  "position": { "start": { "line": 96 } },
                  "lang": "javascript",
                  "copyable": true,
                  "emphasize_lines": [],
                  "value": "{ $merge: {\n     into: <collection> -or- { db: <db>, coll: <collection> },\n     on: <identifier field> -or- [ <identifier field1>, ...],  // Optional\n     let: <variables>,                                         // Optional\n     whenMatched: <replace|keepExisting|merge|fail|pipeline>,  // Optional\n     whenNotMatched: <insert|discard|fail>                     // Optional\n} }",
                  "linenos": false
                },
                {
                  "type": "paragraph",
                  "position": { "start": { "line": 106 } },
                  "children": [
                    {
                      "type": "text",
                      "position": { "start": { "line": 106 } },
                      "value": "For example:"
                    }
                  ]
                },
                {
                  "type": "code",
                  "position": { "start": { "line": 108 } },
                  "lang": "javascript",
                  "copyable": true,
                  "emphasize_lines": [],
                  "value": "{ $merge: { into: \"myOutput\", on: \"_id\", whenMatched: \"replace\", whenNotMatched: \"insert\" } }",
                  "linenos": false
                },
                {
                  "type": "paragraph",
                  "position": { "start": { "line": 112 } },
                  "children": [
                    {
                      "type": "text",
                      "position": { "start": { "line": 112 } },
                      "value": "If using all default options for "
                    },
                    {
                      "type": "ref_role",
                      "position": { "start": { "line": 112 } },
                      "children": [
                        {
                          "type": "literal",
                          "position": { "start": { "line": 112 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 112 } },
                              "value": "$merge"
                            }
                          ]
                        }
                      ],
                      "domain": "mongodb",
                      "name": "pipeline",
                      "target": "pipe.$merge",
                      "flag": "",
                      "fileid": [
                        "reference/operator/aggregation/merge",
                        "mongodb-pipeline-pipe.-merge"
                      ]
                    },
                    {
                      "type": "text",
                      "position": { "start": { "line": 112 } },
                      "value": ", including writing\nto a collection in the same database, you can use the simplified form:"
                    }
                  ]
                },
                {
                  "type": "code",
                  "position": { "start": { "line": 115 } },
                  "lang": "javascript",
                  "copyable": true,
                  "emphasize_lines": [],
                  "value": "{ $merge: <collection> } // Output collection is in the same database",
                  "linenos": false
                },
                {
                  "type": "paragraph",
                  "position": { "start": { "line": 119 } },
                  "children": [
                    {
                      "type": "text",
                      "position": { "start": { "line": 119 } },
                      "value": "The "
                    },
                    {
                      "type": "ref_role",
                      "position": { "start": { "line": 119 } },
                      "children": [
                        {
                          "type": "literal",
                          "position": { "start": { "line": 119 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 119 } },
                              "value": "$merge"
                            }
                          ]
                        }
                      ],
                      "domain": "mongodb",
                      "name": "pipeline",
                      "target": "pipe.$merge",
                      "flag": "",
                      "fileid": [
                        "reference/operator/aggregation/merge",
                        "mongodb-pipeline-pipe.-merge"
                      ]
                    },
                    {
                      "type": "text",
                      "position": { "start": { "line": 119 } },
                      "value": " takes a document with the following fields:"
                    }
                  ]
                },
                {
                  "type": "directive",
                  "position": { "start": { "line": 121 } },
                  "children": [
                    {
                      "type": "list",
                      "position": { "start": { "line": 125 } },
                      "children": [
                        {
                          "type": "listItem",
                          "position": { "start": { "line": 125 } },
                          "children": [
                            {
                              "type": "list",
                              "position": { "start": { "line": 125 } },
                              "children": [
                                {
                                  "type": "listItem",
                                  "position": { "start": { "line": 125 } },
                                  "children": [
                                    {
                                      "type": "paragraph",
                                      "position": { "start": { "line": 125 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 125 }
                                          },
                                          "value": "Field"
                                        }
                                      ]
                                    }
                                  ]
                                },
                                {
                                  "type": "listItem",
                                  "position": { "start": { "line": 125 } },
                                  "children": [
                                    {
                                      "type": "paragraph",
                                      "position": { "start": { "line": 126 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 126 }
                                          },
                                          "value": "Description"
                                        }
                                      ]
                                    }
                                  ]
                                }
                              ],
                              "enumtype": "unordered"
                            }
                          ]
                        },
                        {
                          "type": "listItem",
                          "position": { "start": { "line": 125 } },
                          "children": [
                            {
                              "type": "list",
                              "position": { "start": { "line": 128 } },
                              "children": [
                                {
                                  "type": "listItem",
                                  "position": { "start": { "line": 128 } },
                                  "children": [
                                    {
                                      "type": "paragraph",
                                      "position": { "start": { "line": 128 } },
                                      "children": [
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 128 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 128 }
                                              },
                                              "value": "into"
                                            }
                                          ],
                                          "domain": "std",
                                          "name": "label",
                                          "target": "merge-into",
                                          "flag": "",
                                          "fileid": [
                                            "reference/operator/aggregation/merge",
                                            "std-label-merge-into"
                                          ]
                                        }
                                      ]
                                    }
                                  ]
                                },
                                {
                                  "type": "listItem",
                                  "position": { "start": { "line": 128 } },
                                  "children": [
                                    {
                                      "type": "target",
                                      "position": { "start": { "line": 130 } },
                                      "children": [
                                        {
                                          "type": "target_identifier",
                                          "position": {
                                            "start": { "line": 130 }
                                          },
                                          "children": [],
                                          "ids": ["merge-into"]
                                        }
                                      ],
                                      "domain": "std",
                                      "name": "label",
                                      "html_id": "std-label-merge-into"
                                    },
                                    {
                                      "type": "paragraph",
                                      "position": { "start": { "line": 132 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 132 }
                                          },
                                          "value": "The output collection. Specify either:"
                                        }
                                      ]
                                    },
                                    {
                                      "type": "list",
                                      "position": { "start": { "line": 134 } },
                                      "children": [
                                        {
                                          "type": "listItem",
                                          "position": {
                                            "start": { "line": 134 }
                                          },
                                          "children": [
                                            {
                                              "type": "paragraph",
                                              "position": {
                                                "start": { "line": 134 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 134 }
                                                  },
                                                  "value": "The collection name as a string to output to a collection in\nthe same database where the aggregation is run. For example:"
                                                }
                                              ]
                                            },
                                            {
                                              "type": "line_block",
                                              "position": {
                                                "start": { "line": 134 }
                                              },
                                              "children": [
                                                {
                                                  "type": "line",
                                                  "position": {
                                                    "start": { "line": 134 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "literal",
                                                      "position": {
                                                        "start": { "line": 134 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "text",
                                                          "position": {
                                                            "start": {
                                                              "line": 134
                                                            }
                                                          },
                                                          "value": "into: \"myOutput\""
                                                        }
                                                      ]
                                                    }
                                                  ]
                                                },
                                                {
                                                  "type": "line",
                                                  "position": {
                                                    "start": { "line": 134 }
                                                  },
                                                  "children": []
                                                }
                                              ]
                                            }
                                          ]
                                        },
                                        {
                                          "type": "listItem",
                                          "position": {
                                            "start": { "line": 134 }
                                          },
                                          "children": [
                                            {
                                              "type": "paragraph",
                                              "position": {
                                                "start": { "line": 140 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 140 }
                                                  },
                                                  "value": "The database and collection name in a document to output to a\ncollection in the specified database. For example:"
                                                }
                                              ]
                                            },
                                            {
                                              "type": "line_block",
                                              "position": {
                                                "start": { "line": 134 }
                                              },
                                              "children": [
                                                {
                                                  "type": "line",
                                                  "position": {
                                                    "start": { "line": 134 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "literal",
                                                      "position": {
                                                        "start": { "line": 134 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "text",
                                                          "position": {
                                                            "start": {
                                                              "line": 134
                                                            }
                                                          },
                                                          "value": "into: { db:\"myDB\", coll:\"myOutput\" }"
                                                        }
                                                      ]
                                                    }
                                                  ]
                                                }
                                              ]
                                            }
                                          ]
                                        }
                                      ],
                                      "enumtype": "unordered"
                                    },
                                    {
                                      "type": "directive",
                                      "position": { "start": { "line": 145 } },
                                      "children": [
                                        {
                                          "type": "list",
                                          "position": {
                                            "start": { "line": 147 }
                                          },
                                          "children": [
                                            {
                                              "type": "listItem",
                                              "position": {
                                                "start": { "line": 147 }
                                              },
                                              "children": [
                                                {
                                                  "type": "paragraph",
                                                  "position": {
                                                    "start": { "line": 147 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 147 }
                                                      },
                                                      "value": "If the output collection does not exist, "
                                                    },
                                                    {
                                                      "type": "ref_role",
                                                      "position": {
                                                        "start": { "line": 147 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "literal",
                                                          "position": {
                                                            "start": {
                                                              "line": 147
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "text",
                                                              "position": {
                                                                "start": {
                                                                  "line": 147
                                                                }
                                                              },
                                                              "value": "$merge"
                                                            }
                                                          ]
                                                        }
                                                      ],
                                                      "domain": "mongodb",
                                                      "name": "pipeline",
                                                      "target": "pipe.$merge",
                                                      "flag": "",
                                                      "fileid": [
                                                        "reference/operator/aggregation/merge",
                                                        "mongodb-pipeline-pipe.-merge"
                                                      ]
                                                    },
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 147 }
                                                      },
                                                      "value": "\ncreates the collection:"
                                                    }
                                                  ]
                                                },
                                                {
                                                  "type": "list",
                                                  "position": {
                                                    "start": { "line": 150 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "listItem",
                                                      "position": {
                                                        "start": { "line": 150 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "paragraph",
                                                          "position": {
                                                            "start": {
                                                              "line": 150
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "text",
                                                              "position": {
                                                                "start": {
                                                                  "line": 150
                                                                }
                                                              },
                                                              "value": "For a "
                                                            },
                                                            {
                                                              "type": "ref_role",
                                                              "position": {
                                                                "start": {
                                                                  "line": 150
                                                                }
                                                              },
                                                              "children": [
                                                                {
                                                                  "type": "text",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 150
                                                                    }
                                                                  },
                                                                  "value": "replica set"
                                                                }
                                                              ],
                                                              "domain": "std",
                                                              "name": "label",
                                                              "target": "replica-set",
                                                              "flag": "",
                                                              "fileid": [
                                                                "replication",
                                                                "std-label-replica-set"
                                                              ]
                                                            },
                                                            {
                                                              "type": "text",
                                                              "position": {
                                                                "start": {
                                                                  "line": 150
                                                                }
                                                              },
                                                              "value": " or a standalone, if\nthe output database does not exist, "
                                                            },
                                                            {
                                                              "type": "ref_role",
                                                              "position": {
                                                                "start": {
                                                                  "line": 150
                                                                }
                                                              },
                                                              "children": [
                                                                {
                                                                  "type": "literal",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 150
                                                                    }
                                                                  },
                                                                  "children": [
                                                                    {
                                                                      "type": "text",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 150
                                                                        }
                                                                      },
                                                                      "value": "$merge"
                                                                    }
                                                                  ]
                                                                }
                                                              ],
                                                              "domain": "mongodb",
                                                              "name": "pipeline",
                                                              "target": "pipe.$merge",
                                                              "flag": "",
                                                              "fileid": [
                                                                "reference/operator/aggregation/merge",
                                                                "mongodb-pipeline-pipe.-merge"
                                                              ]
                                                            },
                                                            {
                                                              "type": "text",
                                                              "position": {
                                                                "start": {
                                                                  "line": 150
                                                                }
                                                              },
                                                              "value": "\nalso creates the database."
                                                            }
                                                          ]
                                                        }
                                                      ]
                                                    },
                                                    {
                                                      "type": "listItem",
                                                      "position": {
                                                        "start": { "line": 150 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "paragraph",
                                                          "position": {
                                                            "start": {
                                                              "line": 154
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "text",
                                                              "position": {
                                                                "start": {
                                                                  "line": 154
                                                                }
                                                              },
                                                              "value": "For a "
                                                            },
                                                            {
                                                              "type": "ref_role",
                                                              "position": {
                                                                "start": {
                                                                  "line": 154
                                                                }
                                                              },
                                                              "children": [
                                                                {
                                                                  "type": "text",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 154
                                                                    }
                                                                  },
                                                                  "value": "sharded cluster"
                                                                }
                                                              ],
                                                              "domain": "std",
                                                              "name": "label",
                                                              "target": "sharded-cluster",
                                                              "flag": "",
                                                              "fileid": [
                                                                "sharding",
                                                                "std-label-sharded-cluster"
                                                              ]
                                                            },
                                                            {
                                                              "type": "text",
                                                              "position": {
                                                                "start": {
                                                                  "line": 154
                                                                }
                                                              },
                                                              "value": ", the\nspecified output database must already exist."
                                                            }
                                                          ]
                                                        }
                                                      ]
                                                    }
                                                  ],
                                                  "enumtype": "unordered"
                                                }
                                              ]
                                            },
                                            {
                                              "type": "listItem",
                                              "position": {
                                                "start": { "line": 147 }
                                              },
                                              "children": [
                                                {
                                                  "type": "paragraph",
                                                  "position": {
                                                    "start": { "line": 157 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 157 }
                                                      },
                                                      "value": "The output collection can be a sharded collection."
                                                    }
                                                  ]
                                                }
                                              ]
                                            }
                                          ],
                                          "enumtype": "unordered"
                                        }
                                      ],
                                      "domain": "",
                                      "name": "note",
                                      "argument": []
                                    }
                                  ]
                                }
                              ],
                              "enumtype": "unordered"
                            }
                          ]
                        },
                        {
                          "type": "listItem",
                          "position": { "start": { "line": 125 } },
                          "children": [
                            {
                              "type": "list",
                              "position": { "start": { "line": 159 } },
                              "children": [
                                {
                                  "type": "listItem",
                                  "position": { "start": { "line": 159 } },
                                  "children": [
                                    {
                                      "type": "paragraph",
                                      "position": { "start": { "line": 159 } },
                                      "children": [
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 159 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 159 }
                                              },
                                              "value": "on"
                                            }
                                          ],
                                          "domain": "std",
                                          "name": "label",
                                          "target": "merge-on",
                                          "flag": "",
                                          "fileid": [
                                            "reference/operator/aggregation/merge",
                                            "std-label-merge-on"
                                          ]
                                        }
                                      ]
                                    }
                                  ]
                                },
                                {
                                  "type": "listItem",
                                  "position": { "start": { "line": 159 } },
                                  "children": [
                                    {
                                      "type": "target",
                                      "position": { "start": { "line": 161 } },
                                      "children": [
                                        {
                                          "type": "target_identifier",
                                          "position": {
                                            "start": { "line": 161 }
                                          },
                                          "children": [],
                                          "ids": ["merge-on"]
                                        }
                                      ],
                                      "domain": "std",
                                      "name": "label",
                                      "html_id": "std-label-merge-on"
                                    },
                                    {
                                      "type": "paragraph",
                                      "position": { "start": { "line": 163 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 163 }
                                          },
                                          "value": "Optional. Field or fields that act as a unique identifier for a\ndocument. The identifier determines if a results document\n"
                                        },
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 163 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 163 }
                                              },
                                              "value": "matches"
                                            }
                                          ],
                                          "domain": "std",
                                          "name": "label",
                                          "target": "merge-whenMatched",
                                          "flag": "",
                                          "fileid": [
                                            "reference/operator/aggregation/merge",
                                            "std-label-merge-whenMatched"
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 163 }
                                          },
                                          "value": " an existing document in the\noutput collection. Specify either:"
                                        }
                                      ]
                                    },
                                    {
                                      "type": "list",
                                      "position": { "start": { "line": 168 } },
                                      "children": [
                                        {
                                          "type": "listItem",
                                          "position": {
                                            "start": { "line": 168 }
                                          },
                                          "children": [
                                            {
                                              "type": "paragraph",
                                              "position": {
                                                "start": { "line": 168 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 168 }
                                                  },
                                                  "value": "A single field name as a string. For example:"
                                                }
                                              ]
                                            },
                                            {
                                              "type": "line_block",
                                              "position": {
                                                "start": { "line": 168 }
                                              },
                                              "children": [
                                                {
                                                  "type": "line",
                                                  "position": {
                                                    "start": { "line": 168 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "literal",
                                                      "position": {
                                                        "start": { "line": 168 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "text",
                                                          "position": {
                                                            "start": {
                                                              "line": 168
                                                            }
                                                          },
                                                          "value": "on: \"_id\""
                                                        }
                                                      ]
                                                    }
                                                  ]
                                                },
                                                {
                                                  "type": "line",
                                                  "position": {
                                                    "start": { "line": 168 }
                                                  },
                                                  "children": []
                                                }
                                              ]
                                            }
                                          ]
                                        },
                                        {
                                          "type": "listItem",
                                          "position": {
                                            "start": { "line": 168 }
                                          },
                                          "children": [
                                            {
                                              "type": "paragraph",
                                              "position": {
                                                "start": { "line": 173 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 173 }
                                                  },
                                                  "value": "A combination of fields in an array. For example:"
                                                }
                                              ]
                                            },
                                            {
                                              "type": "line_block",
                                              "position": {
                                                "start": { "line": 168 }
                                              },
                                              "children": [
                                                {
                                                  "type": "line",
                                                  "position": {
                                                    "start": { "line": 168 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "literal",
                                                      "position": {
                                                        "start": { "line": 168 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "text",
                                                          "position": {
                                                            "start": {
                                                              "line": 168
                                                            }
                                                          },
                                                          "value": "on: [ \"date\", \"customerId\" ]"
                                                        }
                                                      ]
                                                    }
                                                  ]
                                                }
                                              ]
                                            },
                                            {
                                              "type": "line_block",
                                              "position": {
                                                "start": { "line": 168 }
                                              },
                                              "children": [
                                                {
                                                  "type": "line",
                                                  "position": {
                                                    "start": { "line": 168 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 168 }
                                                      },
                                                      "value": "The order of the fields in the array does not matter, and you\ncannot specify the same field multiple times."
                                                    }
                                                  ]
                                                }
                                              ]
                                            }
                                          ]
                                        }
                                      ],
                                      "enumtype": "unordered"
                                    },
                                    {
                                      "type": "paragraph",
                                      "position": { "start": { "line": 180 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 180 }
                                          },
                                          "value": "For the specified field or fields:"
                                        }
                                      ]
                                    },
                                    {
                                      "type": "list",
                                      "position": { "start": { "line": 182 } },
                                      "children": [
                                        {
                                          "type": "listItem",
                                          "position": {
                                            "start": { "line": 182 }
                                          },
                                          "children": [
                                            {
                                              "type": "paragraph",
                                              "position": {
                                                "start": { "line": 182 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 182 }
                                                  },
                                                  "value": "The aggregation results documents must contain the field(s)\nspecified in the "
                                                },
                                                {
                                                  "type": "literal",
                                                  "position": {
                                                    "start": { "line": 182 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 182 }
                                                      },
                                                      "value": "on"
                                                    }
                                                  ]
                                                },
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 182 }
                                                  },
                                                  "value": ", unless the "
                                                },
                                                {
                                                  "type": "literal",
                                                  "position": {
                                                    "start": { "line": 182 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 182 }
                                                      },
                                                      "value": "on"
                                                    }
                                                  ]
                                                },
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 182 }
                                                  },
                                                  "value": " field is the\n"
                                                },
                                                {
                                                  "type": "literal",
                                                  "position": {
                                                    "start": { "line": 182 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 182 }
                                                      },
                                                      "value": "_id"
                                                    }
                                                  ]
                                                },
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 182 }
                                                  },
                                                  "value": " field. If the "
                                                },
                                                {
                                                  "type": "literal",
                                                  "position": {
                                                    "start": { "line": 182 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 182 }
                                                      },
                                                      "value": "_id"
                                                    }
                                                  ]
                                                },
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 182 }
                                                  },
                                                  "value": " field is missing from a\nresults document, MongoDB adds it automatically."
                                                }
                                              ]
                                            }
                                          ]
                                        },
                                        {
                                          "type": "listItem",
                                          "position": {
                                            "start": { "line": 182 }
                                          },
                                          "children": [
                                            {
                                              "type": "paragraph",
                                              "position": {
                                                "start": { "line": 187 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 187 }
                                                  },
                                                  "value": "The specified field or fields cannot contain a null or an array\nvalue."
                                                }
                                              ]
                                            }
                                          ]
                                        }
                                      ],
                                      "enumtype": "unordered"
                                    },
                                    {
                                      "type": "paragraph",
                                      "position": { "start": { "line": 190 } },
                                      "children": [
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 190 }
                                          },
                                          "children": [
                                            {
                                              "type": "literal",
                                              "position": {
                                                "start": { "line": 190 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 190 }
                                                  },
                                                  "value": "$merge"
                                                }
                                              ]
                                            }
                                          ],
                                          "domain": "mongodb",
                                          "name": "pipeline",
                                          "target": "pipe.$merge",
                                          "flag": "",
                                          "fileid": [
                                            "reference/operator/aggregation/merge",
                                            "mongodb-pipeline-pipe.-merge"
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 190 }
                                          },
                                          "value": " requires a "
                                        },
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 190 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 190 }
                                              },
                                              "value": "unique"
                                            }
                                          ],
                                          "domain": "std",
                                          "name": "label",
                                          "target": "index-type-unique",
                                          "flag": "",
                                          "fileid": [
                                            "core/index-unique",
                                            "std-label-index-type-unique"
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 190 }
                                          },
                                          "value": ",\nindex with keys that correspond to the "
                                        },
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 190 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 190 }
                                              },
                                              "value": "on"
                                            }
                                          ],
                                          "domain": "std",
                                          "name": "label",
                                          "target": "merge-on",
                                          "flag": "",
                                          "fileid": [
                                            "reference/operator/aggregation/merge",
                                            "std-label-merge-on"
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 190 }
                                          },
                                          "value": " identifier fields. Although the order of the index key\nspecification does not matter, the unique index must only contain\nthe "
                                        },
                                        {
                                          "type": "literal",
                                          "position": {
                                            "start": { "line": 190 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 190 }
                                              },
                                              "value": "on"
                                            }
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 190 }
                                          },
                                          "value": " fields as its keys."
                                        }
                                      ]
                                    },
                                    {
                                      "type": "list",
                                      "position": { "start": { "line": 196 } },
                                      "children": [
                                        {
                                          "type": "listItem",
                                          "position": {
                                            "start": { "line": 196 }
                                          },
                                          "children": [
                                            {
                                              "type": "paragraph",
                                              "position": {
                                                "start": { "line": 196 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 196 }
                                                  },
                                                  "value": "The index must also have the same "
                                                },
                                                {
                                                  "type": "ref_role",
                                                  "position": {
                                                    "start": { "line": 196 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 196 }
                                                      },
                                                      "value": "collation"
                                                    }
                                                  ],
                                                  "domain": "std",
                                                  "name": "doc",
                                                  "target": "",
                                                  "flag": "",
                                                  "fileid": [
                                                    "/reference/collation",
                                                    ""
                                                  ]
                                                },
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 196 }
                                                  },
                                                  "value": " as the aggregation's collation."
                                                }
                                              ]
                                            }
                                          ]
                                        },
                                        {
                                          "type": "listItem",
                                          "position": {
                                            "start": { "line": 196 }
                                          },
                                          "children": [
                                            {
                                              "type": "paragraph",
                                              "position": {
                                                "start": { "line": 199 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 199 }
                                                  },
                                                  "value": "The unique index can be a "
                                                },
                                                {
                                                  "type": "ref_role",
                                                  "position": {
                                                    "start": { "line": 199 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 199 }
                                                      },
                                                      "value": "sparse"
                                                    }
                                                  ],
                                                  "domain": "std",
                                                  "name": "label",
                                                  "target": "index-type-sparse",
                                                  "flag": "",
                                                  "fileid": [
                                                    "core/index-sparse",
                                                    "std-label-index-type-sparse"
                                                  ]
                                                },
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 199 }
                                                  },
                                                  "value": "\nindex."
                                                }
                                              ]
                                            }
                                          ]
                                        },
                                        {
                                          "type": "listItem",
                                          "position": {
                                            "start": { "line": 196 }
                                          },
                                          "children": [
                                            {
                                              "type": "paragraph",
                                              "position": {
                                                "start": { "line": 202 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 202 }
                                                  },
                                                  "value": "The unique index cannot be a "
                                                },
                                                {
                                                  "type": "ref_role",
                                                  "position": {
                                                    "start": { "line": 202 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 202 }
                                                      },
                                                      "value": "partial"
                                                    }
                                                  ],
                                                  "domain": "std",
                                                  "name": "label",
                                                  "target": "index-type-partial",
                                                  "flag": "",
                                                  "fileid": [
                                                    "core/index-partial",
                                                    "std-label-index-type-partial"
                                                  ]
                                                },
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 202 }
                                                  },
                                                  "value": "\nindex."
                                                }
                                              ]
                                            }
                                          ]
                                        },
                                        {
                                          "type": "listItem",
                                          "position": {
                                            "start": { "line": 196 }
                                          },
                                          "children": [
                                            {
                                              "type": "paragraph",
                                              "position": {
                                                "start": { "line": 205 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 205 }
                                                  },
                                                  "value": "For output collections that already exist, the corresponding\nindex must already exist."
                                                }
                                              ]
                                            }
                                          ]
                                        }
                                      ],
                                      "enumtype": "unordered"
                                    },
                                    {
                                      "type": "paragraph",
                                      "position": { "start": { "line": 208 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 208 }
                                          },
                                          "value": "The default value for "
                                        },
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 208 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 208 }
                                              },
                                              "value": "on"
                                            }
                                          ],
                                          "domain": "std",
                                          "name": "label",
                                          "target": "merge-on",
                                          "flag": "",
                                          "fileid": [
                                            "reference/operator/aggregation/merge",
                                            "std-label-merge-on"
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 208 }
                                          },
                                          "value": " depends on the output collection:"
                                        }
                                      ]
                                    },
                                    {
                                      "type": "list",
                                      "position": { "start": { "line": 210 } },
                                      "children": [
                                        {
                                          "type": "listItem",
                                          "position": {
                                            "start": { "line": 210 }
                                          },
                                          "children": [
                                            {
                                              "type": "paragraph",
                                              "position": {
                                                "start": { "line": 210 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 210 }
                                                  },
                                                  "value": "If the output collection does not exist, the "
                                                },
                                                {
                                                  "type": "ref_role",
                                                  "position": {
                                                    "start": { "line": 210 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 210 }
                                                      },
                                                      "value": "on"
                                                    }
                                                  ],
                                                  "domain": "std",
                                                  "name": "label",
                                                  "target": "merge-on",
                                                  "flag": "",
                                                  "fileid": [
                                                    "reference/operator/aggregation/merge",
                                                    "std-label-merge-on"
                                                  ]
                                                },
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 210 }
                                                  },
                                                  "value": "\nidentifier must be and defaults to the "
                                                },
                                                {
                                                  "type": "literal",
                                                  "position": {
                                                    "start": { "line": 210 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 210 }
                                                      },
                                                      "value": "_id"
                                                    }
                                                  ]
                                                },
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 210 }
                                                  },
                                                  "value": " field. The\ncorresponding unique "
                                                },
                                                {
                                                  "type": "literal",
                                                  "position": {
                                                    "start": { "line": 210 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 210 }
                                                      },
                                                      "value": "_id"
                                                    }
                                                  ]
                                                },
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 210 }
                                                  },
                                                  "value": " index is automatically created."
                                                }
                                              ]
                                            },
                                            {
                                              "type": "directive",
                                              "position": {
                                                "start": { "line": 214 }
                                              },
                                              "children": [
                                                {
                                                  "type": "paragraph",
                                                  "position": {
                                                    "start": { "line": 216 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 216 }
                                                      },
                                                      "value": "To use a different "
                                                    },
                                                    {
                                                      "type": "ref_role",
                                                      "position": {
                                                        "start": { "line": 216 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "text",
                                                          "position": {
                                                            "start": {
                                                              "line": 216
                                                            }
                                                          },
                                                          "value": "on"
                                                        }
                                                      ],
                                                      "domain": "std",
                                                      "name": "label",
                                                      "target": "merge-on",
                                                      "flag": "",
                                                      "fileid": [
                                                        "reference/operator/aggregation/merge",
                                                        "std-label-merge-on"
                                                      ]
                                                    },
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 216 }
                                                      },
                                                      "value": " identifier field(s)\nfor a collection that does not exist, you can create the\ncollection first by creating a unique index on the desired\nfield(s). See the "
                                                    },
                                                    {
                                                      "type": "ref_role",
                                                      "position": {
                                                        "start": { "line": 216 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "text",
                                                          "position": {
                                                            "start": {
                                                              "line": 216
                                                            }
                                                          },
                                                          "value": "section on non-existent output\ncollection"
                                                        }
                                                      ],
                                                      "domain": "std",
                                                      "name": "label",
                                                      "target": "merge-use-different-on",
                                                      "flag": "",
                                                      "fileid": [
                                                        "reference/operator/aggregation/merge",
                                                        "std-label-merge-use-different-on"
                                                      ]
                                                    },
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 216 }
                                                      },
                                                      "value": " for an example."
                                                    }
                                                  ]
                                                }
                                              ],
                                              "domain": "",
                                              "name": "tip",
                                              "argument": []
                                            }
                                          ]
                                        },
                                        {
                                          "type": "listItem",
                                          "position": {
                                            "start": { "line": 210 }
                                          },
                                          "children": [
                                            {
                                              "type": "paragraph",
                                              "position": {
                                                "start": { "line": 222 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 222 }
                                                  },
                                                  "value": "If the existing output collection is unsharded, the "
                                                },
                                                {
                                                  "type": "literal",
                                                  "position": {
                                                    "start": { "line": 222 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 222 }
                                                      },
                                                      "value": "on"
                                                    }
                                                  ]
                                                },
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 222 }
                                                  },
                                                  "value": "\nidentifier defaults to the "
                                                },
                                                {
                                                  "type": "literal",
                                                  "position": {
                                                    "start": { "line": 222 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 222 }
                                                      },
                                                      "value": "_id"
                                                    }
                                                  ]
                                                },
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 222 }
                                                  },
                                                  "value": " field."
                                                }
                                              ]
                                            }
                                          ]
                                        },
                                        {
                                          "type": "listItem",
                                          "position": {
                                            "start": { "line": 210 }
                                          },
                                          "children": [
                                            {
                                              "type": "paragraph",
                                              "position": {
                                                "start": { "line": 225 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 225 }
                                                  },
                                                  "value": "If the existing output collection is a sharded collection, the\n"
                                                },
                                                {
                                                  "type": "ref_role",
                                                  "position": {
                                                    "start": { "line": 225 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 225 }
                                                      },
                                                      "value": "on"
                                                    }
                                                  ],
                                                  "domain": "std",
                                                  "name": "label",
                                                  "target": "merge-on",
                                                  "flag": "",
                                                  "fileid": [
                                                    "reference/operator/aggregation/merge",
                                                    "std-label-merge-on"
                                                  ]
                                                },
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 225 }
                                                  },
                                                  "value": " identifier defaults to all the shard\nkey fields and the "
                                                },
                                                {
                                                  "type": "literal",
                                                  "position": {
                                                    "start": { "line": 225 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 225 }
                                                      },
                                                      "value": "_id"
                                                    }
                                                  ]
                                                },
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 225 }
                                                  },
                                                  "value": " field. If specifying a different\n"
                                                },
                                                {
                                                  "type": "literal",
                                                  "position": {
                                                    "start": { "line": 225 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 225 }
                                                      },
                                                      "value": "on"
                                                    }
                                                  ]
                                                },
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 225 }
                                                  },
                                                  "value": " identifier, the "
                                                },
                                                {
                                                  "type": "literal",
                                                  "position": {
                                                    "start": { "line": 225 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 225 }
                                                      },
                                                      "value": "on"
                                                    }
                                                  ]
                                                },
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 225 }
                                                  },
                                                  "value": " must contain all the shard key\nfields."
                                                }
                                              ]
                                            }
                                          ]
                                        }
                                      ],
                                      "enumtype": "unordered"
                                    }
                                  ]
                                }
                              ],
                              "enumtype": "unordered"
                            }
                          ]
                        },
                        {
                          "type": "listItem",
                          "position": { "start": { "line": 125 } },
                          "children": [
                            {
                              "type": "list",
                              "position": { "start": { "line": 231 } },
                              "children": [
                                {
                                  "type": "listItem",
                                  "position": { "start": { "line": 231 } },
                                  "children": [
                                    {
                                      "type": "paragraph",
                                      "position": { "start": { "line": 231 } },
                                      "children": [
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 231 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 231 }
                                              },
                                              "value": "whenMatched"
                                            }
                                          ],
                                          "domain": "std",
                                          "name": "label",
                                          "target": "merge-whenMatched",
                                          "flag": "",
                                          "fileid": [
                                            "reference/operator/aggregation/merge",
                                            "std-label-merge-whenMatched"
                                          ]
                                        }
                                      ]
                                    }
                                  ]
                                },
                                {
                                  "type": "listItem",
                                  "position": { "start": { "line": 231 } },
                                  "children": [
                                    {
                                      "type": "target",
                                      "position": { "start": { "line": 233 } },
                                      "children": [
                                        {
                                          "type": "target_identifier",
                                          "position": {
                                            "start": { "line": 233 }
                                          },
                                          "children": [],
                                          "ids": ["merge-whenMatched"]
                                        }
                                      ],
                                      "domain": "std",
                                      "name": "label",
                                      "html_id": "std-label-merge-whenMatched"
                                    },
                                    {
                                      "type": "paragraph",
                                      "position": { "start": { "line": 235 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 235 }
                                          },
                                          "value": "Optional. The behavior of "
                                        },
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 235 }
                                          },
                                          "children": [
                                            {
                                              "type": "literal",
                                              "position": {
                                                "start": { "line": 235 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 235 }
                                                  },
                                                  "value": "$merge"
                                                }
                                              ]
                                            }
                                          ],
                                          "domain": "mongodb",
                                          "name": "pipeline",
                                          "target": "pipe.$merge",
                                          "flag": "",
                                          "fileid": [
                                            "reference/operator/aggregation/merge",
                                            "mongodb-pipeline-pipe.-merge"
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 235 }
                                          },
                                          "value": " if a result document\nand an existing document in the collection have the same value\nfor the specified "
                                        },
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 235 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 235 }
                                              },
                                              "value": "on"
                                            }
                                          ],
                                          "domain": "std",
                                          "name": "label",
                                          "target": "merge-on",
                                          "flag": "",
                                          "fileid": [
                                            "reference/operator/aggregation/merge",
                                            "std-label-merge-on"
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 235 }
                                          },
                                          "value": " field(s)."
                                        }
                                      ]
                                    },
                                    {
                                      "type": "paragraph",
                                      "position": { "start": { "line": 239 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 239 }
                                          },
                                          "value": "You can specify either:"
                                        }
                                      ]
                                    },
                                    {
                                      "type": "list",
                                      "position": { "start": { "line": 241 } },
                                      "children": [
                                        {
                                          "type": "listItem",
                                          "position": {
                                            "start": { "line": 241 }
                                          },
                                          "children": [
                                            {
                                              "type": "paragraph",
                                              "position": {
                                                "start": { "line": 241 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 241 }
                                                  },
                                                  "value": "One of the pre-defined action strings:"
                                                }
                                              ]
                                            },
                                            {
                                              "type": "directive",
                                              "position": {
                                                "start": { "line": 243 }
                                              },
                                              "children": [
                                                {
                                                  "type": "list",
                                                  "position": {
                                                    "start": { "line": 247 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "listItem",
                                                      "position": {
                                                        "start": { "line": 247 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "list",
                                                          "position": {
                                                            "start": {
                                                              "line": 247
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "listItem",
                                                              "position": {
                                                                "start": {
                                                                  "line": 247
                                                                }
                                                              },
                                                              "children": [
                                                                {
                                                                  "type": "paragraph",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 247
                                                                    }
                                                                  },
                                                                  "children": [
                                                                    {
                                                                      "type": "text",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 247
                                                                        }
                                                                      },
                                                                      "value": "Action"
                                                                    }
                                                                  ]
                                                                }
                                                              ]
                                                            },
                                                            {
                                                              "type": "listItem",
                                                              "position": {
                                                                "start": {
                                                                  "line": 247
                                                                }
                                                              },
                                                              "children": [
                                                                {
                                                                  "type": "paragraph",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 248
                                                                    }
                                                                  },
                                                                  "children": [
                                                                    {
                                                                      "type": "text",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 248
                                                                        }
                                                                      },
                                                                      "value": "Description"
                                                                    }
                                                                  ]
                                                                }
                                                              ]
                                                            }
                                                          ],
                                                          "enumtype": "unordered"
                                                        }
                                                      ]
                                                    },
                                                    {
                                                      "type": "listItem",
                                                      "position": {
                                                        "start": { "line": 247 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "list",
                                                          "position": {
                                                            "start": {
                                                              "line": 250
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "listItem",
                                                              "position": {
                                                                "start": {
                                                                  "line": 250
                                                                }
                                                              },
                                                              "children": [
                                                                {
                                                                  "type": "paragraph",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 250
                                                                    }
                                                                  },
                                                                  "children": [
                                                                    {
                                                                      "type": "ref_role",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 250
                                                                        }
                                                                      },
                                                                      "children": [
                                                                        {
                                                                          "type": "text",
                                                                          "position": {
                                                                            "start": {
                                                                              "line": 250
                                                                            }
                                                                          },
                                                                          "value": "\"replace\""
                                                                        }
                                                                      ],
                                                                      "domain": "std",
                                                                      "name": "label",
                                                                      "target": "merge-whenMatched-replace",
                                                                      "flag": "",
                                                                      "fileid": [
                                                                        "reference/operator/aggregation/merge",
                                                                        "std-label-merge-whenMatched-replace"
                                                                      ]
                                                                    }
                                                                  ]
                                                                }
                                                              ]
                                                            },
                                                            {
                                                              "type": "listItem",
                                                              "position": {
                                                                "start": {
                                                                  "line": 250
                                                                }
                                                              },
                                                              "children": [
                                                                {
                                                                  "type": "target",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 252
                                                                    }
                                                                  },
                                                                  "children": [
                                                                    {
                                                                      "type": "target_identifier",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 252
                                                                        }
                                                                      },
                                                                      "children": [],
                                                                      "ids": [
                                                                        "merge-whenMatched-replace"
                                                                      ]
                                                                    }
                                                                  ],
                                                                  "domain": "std",
                                                                  "name": "label",
                                                                  "html_id": "std-label-merge-whenMatched-replace"
                                                                },
                                                                {
                                                                  "type": "paragraph",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 254
                                                                    }
                                                                  },
                                                                  "children": [
                                                                    {
                                                                      "type": "text",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 254
                                                                        }
                                                                      },
                                                                      "value": "Replace the existing document in the "
                                                                    },
                                                                    {
                                                                      "type": "ref_role",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 254
                                                                        }
                                                                      },
                                                                      "children": [
                                                                        {
                                                                          "type": "text",
                                                                          "position": {
                                                                            "start": {
                                                                              "line": 254
                                                                            }
                                                                          },
                                                                          "value": "output\ncollection"
                                                                        }
                                                                      ],
                                                                      "domain": "std",
                                                                      "name": "label",
                                                                      "target": "merge-into",
                                                                      "flag": "",
                                                                      "fileid": [
                                                                        "reference/operator/aggregation/merge",
                                                                        "std-label-merge-into"
                                                                      ]
                                                                    },
                                                                    {
                                                                      "type": "text",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 254
                                                                        }
                                                                      },
                                                                      "value": " with the matching results\ndocument."
                                                                    }
                                                                  ]
                                                                },
                                                                {
                                                                  "type": "paragraph",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 258
                                                                    }
                                                                  },
                                                                  "children": [
                                                                    {
                                                                      "type": "text",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 258
                                                                        }
                                                                      },
                                                                      "value": "When performing a replace, the replacement document\ncannot result in a modification of the "
                                                                    },
                                                                    {
                                                                      "type": "literal",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 258
                                                                        }
                                                                      },
                                                                      "children": [
                                                                        {
                                                                          "type": "text",
                                                                          "position": {
                                                                            "start": {
                                                                              "line": 258
                                                                            }
                                                                          },
                                                                          "value": "_id"
                                                                        }
                                                                      ]
                                                                    },
                                                                    {
                                                                      "type": "text",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 258
                                                                        }
                                                                      },
                                                                      "value": " value or,\nif the output collection is sharded, the shard key\nvalue. Otherwise, the operation generates an error."
                                                                    }
                                                                  ]
                                                                },
                                                                {
                                                                  "type": "directive",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 263
                                                                    }
                                                                  },
                                                                  "children": [
                                                                    {
                                                                      "type": "paragraph",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 265
                                                                        }
                                                                      },
                                                                      "children": [
                                                                        {
                                                                          "type": "text",
                                                                          "position": {
                                                                            "start": {
                                                                              "line": 265
                                                                            }
                                                                          },
                                                                          "value": "To avoid this error, if the "
                                                                        },
                                                                        {
                                                                          "type": "ref_role",
                                                                          "position": {
                                                                            "start": {
                                                                              "line": 265
                                                                            }
                                                                          },
                                                                          "children": [
                                                                            {
                                                                              "type": "text",
                                                                              "position": {
                                                                                "start": {
                                                                                  "line": 265
                                                                                }
                                                                              },
                                                                              "value": "on"
                                                                            }
                                                                          ],
                                                                          "domain": "std",
                                                                          "name": "label",
                                                                          "target": "merge-on",
                                                                          "flag": "",
                                                                          "fileid": [
                                                                            "reference/operator/aggregation/merge",
                                                                            "std-label-merge-on"
                                                                          ]
                                                                        },
                                                                        {
                                                                          "type": "text",
                                                                          "position": {
                                                                            "start": {
                                                                              "line": 265
                                                                            }
                                                                          },
                                                                          "value": "\nfield does not include the "
                                                                        },
                                                                        {
                                                                          "type": "literal",
                                                                          "position": {
                                                                            "start": {
                                                                              "line": 265
                                                                            }
                                                                          },
                                                                          "children": [
                                                                            {
                                                                              "type": "text",
                                                                              "position": {
                                                                                "start": {
                                                                                  "line": 265
                                                                                }
                                                                              },
                                                                              "value": "_id"
                                                                            }
                                                                          ]
                                                                        },
                                                                        {
                                                                          "type": "text",
                                                                          "position": {
                                                                            "start": {
                                                                              "line": 265
                                                                            }
                                                                          },
                                                                          "value": " field, remove the\n"
                                                                        },
                                                                        {
                                                                          "type": "literal",
                                                                          "position": {
                                                                            "start": {
                                                                              "line": 265
                                                                            }
                                                                          },
                                                                          "children": [
                                                                            {
                                                                              "type": "text",
                                                                              "position": {
                                                                                "start": {
                                                                                  "line": 265
                                                                                }
                                                                              },
                                                                              "value": "_id"
                                                                            }
                                                                          ]
                                                                        },
                                                                        {
                                                                          "type": "text",
                                                                          "position": {
                                                                            "start": {
                                                                              "line": 265
                                                                            }
                                                                          },
                                                                          "value": " field in the aggregation results to avoid the\nerror, such as with a preceding "
                                                                        },
                                                                        {
                                                                          "type": "ref_role",
                                                                          "position": {
                                                                            "start": {
                                                                              "line": 265
                                                                            }
                                                                          },
                                                                          "children": [
                                                                            {
                                                                              "type": "literal",
                                                                              "position": {
                                                                                "start": {
                                                                                  "line": 265
                                                                                }
                                                                              },
                                                                              "children": [
                                                                                {
                                                                                  "type": "text",
                                                                                  "position": {
                                                                                    "start": {
                                                                                      "line": 265
                                                                                    }
                                                                                  },
                                                                                  "value": "$unset"
                                                                                }
                                                                              ]
                                                                            }
                                                                          ],
                                                                          "domain": "mongodb",
                                                                          "name": "pipeline",
                                                                          "target": "pipe.$unset",
                                                                          "flag": "",
                                                                          "fileid": [
                                                                            "reference/operator/aggregation/unset",
                                                                            "mongodb-pipeline-pipe.-unset"
                                                                          ]
                                                                        },
                                                                        {
                                                                          "type": "text",
                                                                          "position": {
                                                                            "start": {
                                                                              "line": 265
                                                                            }
                                                                          },
                                                                          "value": "\nstage, and so on."
                                                                        }
                                                                      ]
                                                                    }
                                                                  ],
                                                                  "domain": "",
                                                                  "name": "tip",
                                                                  "argument": []
                                                                }
                                                              ]
                                                            }
                                                          ],
                                                          "enumtype": "unordered"
                                                        }
                                                      ]
                                                    },
                                                    {
                                                      "type": "listItem",
                                                      "position": {
                                                        "start": { "line": 247 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "list",
                                                          "position": {
                                                            "start": {
                                                              "line": 271
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "listItem",
                                                              "position": {
                                                                "start": {
                                                                  "line": 271
                                                                }
                                                              },
                                                              "children": [
                                                                {
                                                                  "type": "paragraph",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 271
                                                                    }
                                                                  },
                                                                  "children": [
                                                                    {
                                                                      "type": "ref_role",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 271
                                                                        }
                                                                      },
                                                                      "children": [
                                                                        {
                                                                          "type": "text",
                                                                          "position": {
                                                                            "start": {
                                                                              "line": 271
                                                                            }
                                                                          },
                                                                          "value": "\"keepExisting\""
                                                                        }
                                                                      ],
                                                                      "domain": "std",
                                                                      "name": "label",
                                                                      "target": "merge-whenMatched-keepExisting",
                                                                      "flag": "",
                                                                      "fileid": [
                                                                        "reference/operator/aggregation/merge",
                                                                        "std-label-merge-whenMatched-keepExisting"
                                                                      ]
                                                                    }
                                                                  ]
                                                                }
                                                              ]
                                                            },
                                                            {
                                                              "type": "listItem",
                                                              "position": {
                                                                "start": {
                                                                  "line": 271
                                                                }
                                                              },
                                                              "children": [
                                                                {
                                                                  "type": "target",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 273
                                                                    }
                                                                  },
                                                                  "children": [
                                                                    {
                                                                      "type": "target_identifier",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 273
                                                                        }
                                                                      },
                                                                      "children": [],
                                                                      "ids": [
                                                                        "merge-whenMatched-keepExisting"
                                                                      ]
                                                                    }
                                                                  ],
                                                                  "domain": "std",
                                                                  "name": "label",
                                                                  "html_id": "std-label-merge-whenMatched-keepExisting"
                                                                },
                                                                {
                                                                  "type": "paragraph",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 275
                                                                    }
                                                                  },
                                                                  "children": [
                                                                    {
                                                                      "type": "text",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 275
                                                                        }
                                                                      },
                                                                      "value": "Keep the existing document in the "
                                                                    },
                                                                    {
                                                                      "type": "ref_role",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 275
                                                                        }
                                                                      },
                                                                      "children": [
                                                                        {
                                                                          "type": "text",
                                                                          "position": {
                                                                            "start": {
                                                                              "line": 275
                                                                            }
                                                                          },
                                                                          "value": "output\ncollection"
                                                                        }
                                                                      ],
                                                                      "domain": "std",
                                                                      "name": "label",
                                                                      "target": "merge-into",
                                                                      "flag": "",
                                                                      "fileid": [
                                                                        "reference/operator/aggregation/merge",
                                                                        "std-label-merge-into"
                                                                      ]
                                                                    },
                                                                    {
                                                                      "type": "text",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 275
                                                                        }
                                                                      },
                                                                      "value": "."
                                                                    }
                                                                  ]
                                                                }
                                                              ]
                                                            }
                                                          ],
                                                          "enumtype": "unordered"
                                                        }
                                                      ]
                                                    },
                                                    {
                                                      "type": "listItem",
                                                      "position": {
                                                        "start": { "line": 247 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "list",
                                                          "position": {
                                                            "start": {
                                                              "line": 278
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "listItem",
                                                              "position": {
                                                                "start": {
                                                                  "line": 278
                                                                }
                                                              },
                                                              "children": [
                                                                {
                                                                  "type": "paragraph",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 278
                                                                    }
                                                                  },
                                                                  "children": [
                                                                    {
                                                                      "type": "ref_role",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 278
                                                                        }
                                                                      },
                                                                      "children": [
                                                                        {
                                                                          "type": "text",
                                                                          "position": {
                                                                            "start": {
                                                                              "line": 278
                                                                            }
                                                                          },
                                                                          "value": "\"merge\""
                                                                        }
                                                                      ],
                                                                      "domain": "std",
                                                                      "name": "label",
                                                                      "target": "merge-whenMatched-merge",
                                                                      "flag": "",
                                                                      "fileid": [
                                                                        "reference/operator/aggregation/merge",
                                                                        "std-label-merge-whenMatched-merge"
                                                                      ]
                                                                    },
                                                                    {
                                                                      "type": "text",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 278
                                                                        }
                                                                      },
                                                                      "value": " (Default)"
                                                                    }
                                                                  ]
                                                                }
                                                              ]
                                                            },
                                                            {
                                                              "type": "listItem",
                                                              "position": {
                                                                "start": {
                                                                  "line": 278
                                                                }
                                                              },
                                                              "children": [
                                                                {
                                                                  "type": "target",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 280
                                                                    }
                                                                  },
                                                                  "children": [
                                                                    {
                                                                      "type": "target_identifier",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 280
                                                                        }
                                                                      },
                                                                      "children": [],
                                                                      "ids": [
                                                                        "merge-whenMatched-merge"
                                                                      ]
                                                                    }
                                                                  ],
                                                                  "domain": "std",
                                                                  "name": "label",
                                                                  "html_id": "std-label-merge-whenMatched-merge"
                                                                },
                                                                {
                                                                  "type": "paragraph",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 282
                                                                    }
                                                                  },
                                                                  "children": [
                                                                    {
                                                                      "type": "text",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 282
                                                                        }
                                                                      },
                                                                      "value": "Merge the matching documents (similar to the\n"
                                                                    },
                                                                    {
                                                                      "type": "ref_role",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 282
                                                                        }
                                                                      },
                                                                      "children": [
                                                                        {
                                                                          "type": "literal",
                                                                          "position": {
                                                                            "start": {
                                                                              "line": 282
                                                                            }
                                                                          },
                                                                          "children": [
                                                                            {
                                                                              "type": "text",
                                                                              "position": {
                                                                                "start": {
                                                                                  "line": 282
                                                                                }
                                                                              },
                                                                              "value": "$mergeObjects"
                                                                            }
                                                                          ]
                                                                        }
                                                                      ],
                                                                      "domain": "mongodb",
                                                                      "name": "expression",
                                                                      "target": "exp.$mergeObjects",
                                                                      "flag": "",
                                                                      "fileid": [
                                                                        "reference/operator/aggregation/mergeObjects",
                                                                        "mongodb-expression-exp.-mergeObjects"
                                                                      ]
                                                                    },
                                                                    {
                                                                      "type": "text",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 282
                                                                        }
                                                                      },
                                                                      "value": " operator)."
                                                                    }
                                                                  ]
                                                                },
                                                                {
                                                                  "type": "list",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 285
                                                                    }
                                                                  },
                                                                  "children": [
                                                                    {
                                                                      "type": "listItem",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 285
                                                                        }
                                                                      },
                                                                      "children": [
                                                                        {
                                                                          "type": "paragraph",
                                                                          "position": {
                                                                            "start": {
                                                                              "line": 285
                                                                            }
                                                                          },
                                                                          "children": [
                                                                            {
                                                                              "type": "text",
                                                                              "position": {
                                                                                "start": {
                                                                                  "line": 285
                                                                                }
                                                                              },
                                                                              "value": "If the results document contains fields not in the\nexisting document, add these new fields to the\nexisting document."
                                                                            }
                                                                          ]
                                                                        }
                                                                      ]
                                                                    },
                                                                    {
                                                                      "type": "listItem",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 285
                                                                        }
                                                                      },
                                                                      "children": [
                                                                        {
                                                                          "type": "paragraph",
                                                                          "position": {
                                                                            "start": {
                                                                              "line": 289
                                                                            }
                                                                          },
                                                                          "children": [
                                                                            {
                                                                              "type": "text",
                                                                              "position": {
                                                                                "start": {
                                                                                  "line": 289
                                                                                }
                                                                              },
                                                                              "value": "If the results document contains fields in the existing\ndocument, replace the existing field values with those\nfrom the results document."
                                                                            }
                                                                          ]
                                                                        }
                                                                      ]
                                                                    }
                                                                  ],
                                                                  "enumtype": "unordered"
                                                                },
                                                                {
                                                                  "type": "paragraph",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 293
                                                                    }
                                                                  },
                                                                  "children": [
                                                                    {
                                                                      "type": "text",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 293
                                                                        }
                                                                      },
                                                                      "value": "For example, if the output collection has the document:"
                                                                    }
                                                                  ]
                                                                },
                                                                {
                                                                  "type": "paragraph",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 295
                                                                    }
                                                                  },
                                                                  "children": [
                                                                    {
                                                                      "type": "literal",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 295
                                                                        }
                                                                      },
                                                                      "children": [
                                                                        {
                                                                          "type": "text",
                                                                          "position": {
                                                                            "start": {
                                                                              "line": 295
                                                                            }
                                                                          },
                                                                          "value": "{ _id: 1, a: 1, b: 1 }"
                                                                        }
                                                                      ]
                                                                    }
                                                                  ]
                                                                },
                                                                {
                                                                  "type": "paragraph",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 297
                                                                    }
                                                                  },
                                                                  "children": [
                                                                    {
                                                                      "type": "text",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 297
                                                                        }
                                                                      },
                                                                      "value": "And the aggregation results has the document:"
                                                                    }
                                                                  ]
                                                                },
                                                                {
                                                                  "type": "paragraph",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 299
                                                                    }
                                                                  },
                                                                  "children": [
                                                                    {
                                                                      "type": "literal",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 299
                                                                        }
                                                                      },
                                                                      "children": [
                                                                        {
                                                                          "type": "text",
                                                                          "position": {
                                                                            "start": {
                                                                              "line": 299
                                                                            }
                                                                          },
                                                                          "value": "{ _id: 1, b: 5, z: 1 }"
                                                                        }
                                                                      ]
                                                                    }
                                                                  ]
                                                                },
                                                                {
                                                                  "type": "paragraph",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 301
                                                                    }
                                                                  },
                                                                  "children": [
                                                                    {
                                                                      "type": "text",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 301
                                                                        }
                                                                      },
                                                                      "value": "Then, the merged document is:"
                                                                    }
                                                                  ]
                                                                },
                                                                {
                                                                  "type": "paragraph",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 303
                                                                    }
                                                                  },
                                                                  "children": [
                                                                    {
                                                                      "type": "literal",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 303
                                                                        }
                                                                      },
                                                                      "children": [
                                                                        {
                                                                          "type": "text",
                                                                          "position": {
                                                                            "start": {
                                                                              "line": 303
                                                                            }
                                                                          },
                                                                          "value": "{ _id: 1, a: 1, b: 5, z: 1 }"
                                                                        }
                                                                      ]
                                                                    }
                                                                  ]
                                                                },
                                                                {
                                                                  "type": "paragraph",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 305
                                                                    }
                                                                  },
                                                                  "children": [
                                                                    {
                                                                      "type": "text",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 305
                                                                        }
                                                                      },
                                                                      "value": "When performing a merge, the merged document cannot\nresult in a modification of the "
                                                                    },
                                                                    {
                                                                      "type": "literal",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 305
                                                                        }
                                                                      },
                                                                      "children": [
                                                                        {
                                                                          "type": "text",
                                                                          "position": {
                                                                            "start": {
                                                                              "line": 305
                                                                            }
                                                                          },
                                                                          "value": "_id"
                                                                        }
                                                                      ]
                                                                    },
                                                                    {
                                                                      "type": "text",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 305
                                                                        }
                                                                      },
                                                                      "value": " value or, if the\noutput collection is sharded, the shard key value.\nOtherwise, the operation generates an error."
                                                                    }
                                                                  ]
                                                                },
                                                                {
                                                                  "type": "directive",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 310
                                                                    }
                                                                  },
                                                                  "children": [
                                                                    {
                                                                      "type": "paragraph",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 312
                                                                        }
                                                                      },
                                                                      "children": [
                                                                        {
                                                                          "type": "text",
                                                                          "position": {
                                                                            "start": {
                                                                              "line": 312
                                                                            }
                                                                          },
                                                                          "value": "To avoid this error, if the "
                                                                        },
                                                                        {
                                                                          "type": "ref_role",
                                                                          "position": {
                                                                            "start": {
                                                                              "line": 312
                                                                            }
                                                                          },
                                                                          "children": [
                                                                            {
                                                                              "type": "text",
                                                                              "position": {
                                                                                "start": {
                                                                                  "line": 312
                                                                                }
                                                                              },
                                                                              "value": "on"
                                                                            }
                                                                          ],
                                                                          "domain": "std",
                                                                          "name": "label",
                                                                          "target": "merge-on",
                                                                          "flag": "",
                                                                          "fileid": [
                                                                            "reference/operator/aggregation/merge",
                                                                            "std-label-merge-on"
                                                                          ]
                                                                        },
                                                                        {
                                                                          "type": "text",
                                                                          "position": {
                                                                            "start": {
                                                                              "line": 312
                                                                            }
                                                                          },
                                                                          "value": "\nfield does not include the "
                                                                        },
                                                                        {
                                                                          "type": "literal",
                                                                          "position": {
                                                                            "start": {
                                                                              "line": 312
                                                                            }
                                                                          },
                                                                          "children": [
                                                                            {
                                                                              "type": "text",
                                                                              "position": {
                                                                                "start": {
                                                                                  "line": 312
                                                                                }
                                                                              },
                                                                              "value": "_id"
                                                                            }
                                                                          ]
                                                                        },
                                                                        {
                                                                          "type": "text",
                                                                          "position": {
                                                                            "start": {
                                                                              "line": 312
                                                                            }
                                                                          },
                                                                          "value": " field, remove the\n"
                                                                        },
                                                                        {
                                                                          "type": "literal",
                                                                          "position": {
                                                                            "start": {
                                                                              "line": 312
                                                                            }
                                                                          },
                                                                          "children": [
                                                                            {
                                                                              "type": "text",
                                                                              "position": {
                                                                                "start": {
                                                                                  "line": 312
                                                                                }
                                                                              },
                                                                              "value": "_id"
                                                                            }
                                                                          ]
                                                                        },
                                                                        {
                                                                          "type": "text",
                                                                          "position": {
                                                                            "start": {
                                                                              "line": 312
                                                                            }
                                                                          },
                                                                          "value": " field in the aggregation results to avoid the\nerror, such as with a preceding "
                                                                        },
                                                                        {
                                                                          "type": "ref_role",
                                                                          "position": {
                                                                            "start": {
                                                                              "line": 312
                                                                            }
                                                                          },
                                                                          "children": [
                                                                            {
                                                                              "type": "literal",
                                                                              "position": {
                                                                                "start": {
                                                                                  "line": 312
                                                                                }
                                                                              },
                                                                              "children": [
                                                                                {
                                                                                  "type": "text",
                                                                                  "position": {
                                                                                    "start": {
                                                                                      "line": 312
                                                                                    }
                                                                                  },
                                                                                  "value": "$unset"
                                                                                }
                                                                              ]
                                                                            }
                                                                          ],
                                                                          "domain": "mongodb",
                                                                          "name": "pipeline",
                                                                          "target": "pipe.$unset",
                                                                          "flag": "",
                                                                          "fileid": [
                                                                            "reference/operator/aggregation/unset",
                                                                            "mongodb-pipeline-pipe.-unset"
                                                                          ]
                                                                        },
                                                                        {
                                                                          "type": "text",
                                                                          "position": {
                                                                            "start": {
                                                                              "line": 312
                                                                            }
                                                                          },
                                                                          "value": "\nstage, and so on."
                                                                        }
                                                                      ]
                                                                    }
                                                                  ],
                                                                  "domain": "",
                                                                  "name": "tip",
                                                                  "argument": []
                                                                }
                                                              ]
                                                            }
                                                          ],
                                                          "enumtype": "unordered"
                                                        }
                                                      ]
                                                    },
                                                    {
                                                      "type": "listItem",
                                                      "position": {
                                                        "start": { "line": 247 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "list",
                                                          "position": {
                                                            "start": {
                                                              "line": 318
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "listItem",
                                                              "position": {
                                                                "start": {
                                                                  "line": 318
                                                                }
                                                              },
                                                              "children": [
                                                                {
                                                                  "type": "paragraph",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 318
                                                                    }
                                                                  },
                                                                  "children": [
                                                                    {
                                                                      "type": "ref_role",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 318
                                                                        }
                                                                      },
                                                                      "children": [
                                                                        {
                                                                          "type": "text",
                                                                          "position": {
                                                                            "start": {
                                                                              "line": 318
                                                                            }
                                                                          },
                                                                          "value": "\"fail\""
                                                                        }
                                                                      ],
                                                                      "domain": "std",
                                                                      "name": "label",
                                                                      "target": "merge-whenMatched-fail",
                                                                      "flag": "",
                                                                      "fileid": [
                                                                        "reference/operator/aggregation/merge",
                                                                        "std-label-merge-whenMatched-fail"
                                                                      ]
                                                                    }
                                                                  ]
                                                                }
                                                              ]
                                                            },
                                                            {
                                                              "type": "listItem",
                                                              "position": {
                                                                "start": {
                                                                  "line": 318
                                                                }
                                                              },
                                                              "children": [
                                                                {
                                                                  "type": "target",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 320
                                                                    }
                                                                  },
                                                                  "children": [
                                                                    {
                                                                      "type": "target_identifier",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 320
                                                                        }
                                                                      },
                                                                      "children": [],
                                                                      "ids": [
                                                                        "merge-whenMatched-fail"
                                                                      ]
                                                                    }
                                                                  ],
                                                                  "domain": "std",
                                                                  "name": "label",
                                                                  "html_id": "std-label-merge-whenMatched-fail"
                                                                },
                                                                {
                                                                  "type": "paragraph",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 322
                                                                    }
                                                                  },
                                                                  "children": [
                                                                    {
                                                                      "type": "text",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 322
                                                                        }
                                                                      },
                                                                      "value": "Stop and fail the aggregation operation. Any changes to\nthe output collection from previous documents are not\nreverted."
                                                                    }
                                                                  ]
                                                                }
                                                              ]
                                                            }
                                                          ],
                                                          "enumtype": "unordered"
                                                        }
                                                      ]
                                                    }
                                                  ],
                                                  "enumtype": "unordered"
                                                }
                                              ],
                                              "domain": "",
                                              "name": "list-table",
                                              "argument": [],
                                              "options": {
                                                "header-rows": 1,
                                                "widths": "20 80"
                                              }
                                            }
                                          ]
                                        },
                                        {
                                          "type": "listItem",
                                          "position": {
                                            "start": { "line": 241 }
                                          },
                                          "children": [
                                            {
                                              "type": "target",
                                              "position": {
                                                "start": { "line": 326 }
                                              },
                                              "children": [
                                                {
                                                  "type": "target_identifier",
                                                  "position": {
                                                    "start": { "line": 326 }
                                                  },
                                                  "children": [],
                                                  "ids": [
                                                    "merge-whenMatched-pipeline"
                                                  ]
                                                }
                                              ],
                                              "domain": "std",
                                              "name": "label",
                                              "html_id": "std-label-merge-whenMatched-pipeline"
                                            },
                                            {
                                              "type": "paragraph",
                                              "position": {
                                                "start": { "line": 328 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 328 }
                                                  },
                                                  "value": "An aggregation pipeline to update the document in the\ncollection."
                                                }
                                              ]
                                            },
                                            {
                                              "type": "paragraph",
                                              "position": {
                                                "start": { "line": 331 }
                                              },
                                              "children": [
                                                {
                                                  "type": "literal",
                                                  "position": {
                                                    "start": { "line": 331 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 331 }
                                                      },
                                                      "value": "[ <stage1>, <stage2> ... ]"
                                                    }
                                                  ]
                                                }
                                              ]
                                            },
                                            {
                                              "type": "paragraph",
                                              "position": {
                                                "start": { "line": 333 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 333 }
                                                  },
                                                  "value": "The pipeline can only consist of the following stages:"
                                                }
                                              ]
                                            },
                                            {
                                              "type": "list",
                                              "position": {
                                                "start": { "line": 335 }
                                              },
                                              "children": [
                                                {
                                                  "type": "listItem",
                                                  "position": {
                                                    "start": { "line": 335 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "paragraph",
                                                      "position": {
                                                        "start": { "line": 335 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "ref_role",
                                                          "position": {
                                                            "start": {
                                                              "line": 335
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "literal",
                                                              "position": {
                                                                "start": {
                                                                  "line": 335
                                                                }
                                                              },
                                                              "children": [
                                                                {
                                                                  "type": "text",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 335
                                                                    }
                                                                  },
                                                                  "value": "$addFields"
                                                                }
                                                              ]
                                                            }
                                                          ],
                                                          "domain": "mongodb",
                                                          "name": "pipeline",
                                                          "target": "pipe.$addFields",
                                                          "flag": "",
                                                          "fileid": [
                                                            "reference/operator/aggregation/addFields",
                                                            "mongodb-pipeline-pipe.-addFields"
                                                          ]
                                                        },
                                                        {
                                                          "type": "text",
                                                          "position": {
                                                            "start": {
                                                              "line": 335
                                                            }
                                                          },
                                                          "value": " and its alias "
                                                        },
                                                        {
                                                          "type": "ref_role",
                                                          "position": {
                                                            "start": {
                                                              "line": 335
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "literal",
                                                              "position": {
                                                                "start": {
                                                                  "line": 335
                                                                }
                                                              },
                                                              "children": [
                                                                {
                                                                  "type": "text",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 335
                                                                    }
                                                                  },
                                                                  "value": "$set"
                                                                }
                                                              ]
                                                            }
                                                          ],
                                                          "domain": "mongodb",
                                                          "name": "pipeline",
                                                          "target": "pipe.$set",
                                                          "flag": "",
                                                          "fileid": [
                                                            "reference/operator/aggregation/set",
                                                            "mongodb-pipeline-pipe.-set"
                                                          ]
                                                        }
                                                      ]
                                                    }
                                                  ]
                                                },
                                                {
                                                  "type": "listItem",
                                                  "position": {
                                                    "start": { "line": 335 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "paragraph",
                                                      "position": {
                                                        "start": { "line": 336 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "ref_role",
                                                          "position": {
                                                            "start": {
                                                              "line": 336
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "literal",
                                                              "position": {
                                                                "start": {
                                                                  "line": 336
                                                                }
                                                              },
                                                              "children": [
                                                                {
                                                                  "type": "text",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 336
                                                                    }
                                                                  },
                                                                  "value": "$project"
                                                                }
                                                              ]
                                                            }
                                                          ],
                                                          "domain": "mongodb",
                                                          "name": "pipeline",
                                                          "target": "pipe.$project",
                                                          "flag": "",
                                                          "fileid": [
                                                            "reference/operator/aggregation/project",
                                                            "mongodb-pipeline-pipe.-project"
                                                          ]
                                                        },
                                                        {
                                                          "type": "text",
                                                          "position": {
                                                            "start": {
                                                              "line": 336
                                                            }
                                                          },
                                                          "value": " and its alias "
                                                        },
                                                        {
                                                          "type": "ref_role",
                                                          "position": {
                                                            "start": {
                                                              "line": 336
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "literal",
                                                              "position": {
                                                                "start": {
                                                                  "line": 336
                                                                }
                                                              },
                                                              "children": [
                                                                {
                                                                  "type": "text",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 336
                                                                    }
                                                                  },
                                                                  "value": "$unset"
                                                                }
                                                              ]
                                                            }
                                                          ],
                                                          "domain": "mongodb",
                                                          "name": "pipeline",
                                                          "target": "pipe.$unset",
                                                          "flag": "",
                                                          "fileid": [
                                                            "reference/operator/aggregation/unset",
                                                            "mongodb-pipeline-pipe.-unset"
                                                          ]
                                                        }
                                                      ]
                                                    }
                                                  ]
                                                },
                                                {
                                                  "type": "listItem",
                                                  "position": {
                                                    "start": { "line": 335 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "paragraph",
                                                      "position": {
                                                        "start": { "line": 337 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "ref_role",
                                                          "position": {
                                                            "start": {
                                                              "line": 337
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "literal",
                                                              "position": {
                                                                "start": {
                                                                  "line": 337
                                                                }
                                                              },
                                                              "children": [
                                                                {
                                                                  "type": "text",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 337
                                                                    }
                                                                  },
                                                                  "value": "$replaceRoot"
                                                                }
                                                              ]
                                                            }
                                                          ],
                                                          "domain": "mongodb",
                                                          "name": "pipeline",
                                                          "target": "pipe.$replaceRoot",
                                                          "flag": "",
                                                          "fileid": [
                                                            "reference/operator/aggregation/replaceRoot",
                                                            "mongodb-pipeline-pipe.-replaceRoot"
                                                          ]
                                                        },
                                                        {
                                                          "type": "text",
                                                          "position": {
                                                            "start": {
                                                              "line": 337
                                                            }
                                                          },
                                                          "value": " and its alias "
                                                        },
                                                        {
                                                          "type": "ref_role",
                                                          "position": {
                                                            "start": {
                                                              "line": 337
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "literal",
                                                              "position": {
                                                                "start": {
                                                                  "line": 337
                                                                }
                                                              },
                                                              "children": [
                                                                {
                                                                  "type": "text",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 337
                                                                    }
                                                                  },
                                                                  "value": "$replaceWith"
                                                                }
                                                              ]
                                                            }
                                                          ],
                                                          "domain": "mongodb",
                                                          "name": "pipeline",
                                                          "target": "pipe.$replaceWith",
                                                          "flag": "",
                                                          "fileid": [
                                                            "reference/operator/aggregation/replaceWith",
                                                            "mongodb-pipeline-pipe.-replaceWith"
                                                          ]
                                                        }
                                                      ]
                                                    }
                                                  ]
                                                }
                                              ],
                                              "enumtype": "unordered"
                                            },
                                            {
                                              "type": "paragraph",
                                              "position": {
                                                "start": { "line": 339 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 339 }
                                                  },
                                                  "value": "The pipeline cannot modify the "
                                                },
                                                {
                                                  "type": "ref_role",
                                                  "position": {
                                                    "start": { "line": 339 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 339 }
                                                      },
                                                      "value": "on"
                                                    }
                                                  ],
                                                  "domain": "std",
                                                  "name": "label",
                                                  "target": "merge-on",
                                                  "flag": "",
                                                  "fileid": [
                                                    "reference/operator/aggregation/merge",
                                                    "std-label-merge-on"
                                                  ]
                                                },
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 339 }
                                                  },
                                                  "value": " field's\nvalue. For example, if you are matching on the field "
                                                },
                                                {
                                                  "type": "literal",
                                                  "position": {
                                                    "start": { "line": 339 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 339 }
                                                      },
                                                      "value": "month"
                                                    }
                                                  ]
                                                },
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 339 }
                                                  },
                                                  "value": ",\nthe pipeline cannot modify the "
                                                },
                                                {
                                                  "type": "literal",
                                                  "position": {
                                                    "start": { "line": 339 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 339 }
                                                      },
                                                      "value": "month"
                                                    }
                                                  ]
                                                },
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 339 }
                                                  },
                                                  "value": " field."
                                                }
                                              ]
                                            },
                                            {
                                              "type": "paragraph",
                                              "position": {
                                                "start": { "line": 343 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 343 }
                                                  },
                                                  "value": "The whenMatched "
                                                },
                                                {
                                                  "type": "literal",
                                                  "position": {
                                                    "start": { "line": 343 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 343 }
                                                      },
                                                      "value": "pipeline"
                                                    }
                                                  ]
                                                },
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 343 }
                                                  },
                                                  "value": " can directly access the fields of\nthe existing documents in the "
                                                },
                                                {
                                                  "type": "strong",
                                                  "position": {
                                                    "start": { "line": 343 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 343 }
                                                      },
                                                      "value": "output"
                                                    }
                                                  ]
                                                },
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 343 }
                                                  },
                                                  "value": " collection using\n"
                                                },
                                                {
                                                  "type": "literal",
                                                  "position": {
                                                    "start": { "line": 343 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 343 }
                                                      },
                                                      "value": "$<field>"
                                                    }
                                                  ]
                                                },
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 343 }
                                                  },
                                                  "value": "."
                                                }
                                              ]
                                            },
                                            {
                                              "type": "paragraph",
                                              "position": {
                                                "start": { "line": 347 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 347 }
                                                  },
                                                  "value": "To access the fields from the aggregation results documents,\nuse either:"
                                                }
                                              ]
                                            },
                                            {
                                              "type": "list",
                                              "position": {
                                                "start": { "line": 350 }
                                              },
                                              "children": [
                                                {
                                                  "type": "listItem",
                                                  "position": {
                                                    "start": { "line": 350 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "paragraph",
                                                      "position": {
                                                        "start": { "line": 350 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "text",
                                                          "position": {
                                                            "start": {
                                                              "line": 350
                                                            }
                                                          },
                                                          "value": "The built-in "
                                                        },
                                                        {
                                                          "type": "literal",
                                                          "position": {
                                                            "start": {
                                                              "line": 350
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "text",
                                                              "position": {
                                                                "start": {
                                                                  "line": 350
                                                                }
                                                              },
                                                              "value": "$$new"
                                                            }
                                                          ]
                                                        },
                                                        {
                                                          "type": "text",
                                                          "position": {
                                                            "start": {
                                                              "line": 350
                                                            }
                                                          },
                                                          "value": " variable to access the field.\nSpecifically, "
                                                        },
                                                        {
                                                          "type": "literal",
                                                          "position": {
                                                            "start": {
                                                              "line": 350
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "text",
                                                              "position": {
                                                                "start": {
                                                                  "line": 350
                                                                }
                                                              },
                                                              "value": "$$new.<field>"
                                                            }
                                                          ]
                                                        },
                                                        {
                                                          "type": "text",
                                                          "position": {
                                                            "start": {
                                                              "line": 350
                                                            }
                                                          },
                                                          "value": ". The "
                                                        },
                                                        {
                                                          "type": "literal",
                                                          "position": {
                                                            "start": {
                                                              "line": 350
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "text",
                                                              "position": {
                                                                "start": {
                                                                  "line": 350
                                                                }
                                                              },
                                                              "value": "$$new"
                                                            }
                                                          ]
                                                        },
                                                        {
                                                          "type": "text",
                                                          "position": {
                                                            "start": {
                                                              "line": 350
                                                            }
                                                          },
                                                          "value": " variable is\nonly available if the "
                                                        },
                                                        {
                                                          "type": "ref_role",
                                                          "position": {
                                                            "start": {
                                                              "line": 350
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "text",
                                                              "position": {
                                                                "start": {
                                                                  "line": 350
                                                                }
                                                              },
                                                              "value": "let"
                                                            }
                                                          ],
                                                          "domain": "std",
                                                          "name": "label",
                                                          "target": "merge-let",
                                                          "flag": "",
                                                          "fileid": [
                                                            "reference/operator/aggregation/merge",
                                                            "std-label-merge-let"
                                                          ]
                                                        },
                                                        {
                                                          "type": "text",
                                                          "position": {
                                                            "start": {
                                                              "line": 350
                                                            }
                                                          },
                                                          "value": " specification is\nomitted."
                                                        }
                                                      ]
                                                    },
                                                    {
                                                      "type": "directive",
                                                      "position": {
                                                        "start": { "line": 355 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "root",
                                                          "position": {
                                                            "start": {
                                                              "line": 0
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "directive",
                                                              "position": {
                                                                "start": {
                                                                  "line": 0
                                                                }
                                                              },
                                                              "children": [
                                                                {
                                                                  "type": "directive",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 0
                                                                    }
                                                                  },
                                                                  "children": [
                                                                    {
                                                                      "type": "paragraph",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 2
                                                                        }
                                                                      },
                                                                      "children": [
                                                                        {
                                                                          "type": "text",
                                                                          "position": {
                                                                            "start": {
                                                                              "line": 2
                                                                            }
                                                                          },
                                                                          "value": "Starting in MongoDB 4.2.2, the "
                                                                        },
                                                                        {
                                                                          "type": "literal",
                                                                          "position": {
                                                                            "start": {
                                                                              "line": 2
                                                                            }
                                                                          },
                                                                          "children": [
                                                                            {
                                                                              "type": "text",
                                                                              "position": {
                                                                                "start": {
                                                                                  "line": 2
                                                                                }
                                                                              },
                                                                              "value": "$$new"
                                                                            }
                                                                          ]
                                                                        },
                                                                        {
                                                                          "type": "text",
                                                                          "position": {
                                                                            "start": {
                                                                              "line": 2
                                                                            }
                                                                          },
                                                                          "value": " variable is\nreserved, and cannot be overridden."
                                                                        }
                                                                      ]
                                                                    }
                                                                  ],
                                                                  "domain": "",
                                                                  "name": "note",
                                                                  "argument": []
                                                                }
                                                              ],
                                                              "domain": "",
                                                              "name": "extract",
                                                              "argument": []
                                                            }
                                                          ],
                                                          "fileid": "includes/extracts-4.2-changes.yaml"
                                                        }
                                                      ],
                                                      "domain": "",
                                                      "name": "include",
                                                      "argument": [
                                                        {
                                                          "type": "text",
                                                          "position": {
                                                            "start": {
                                                              "line": 355
                                                            }
                                                          },
                                                          "value": "/includes/extracts/4.2-changes-new-variable-reserved.rst"
                                                        }
                                                      ]
                                                    }
                                                  ]
                                                },
                                                {
                                                  "type": "listItem",
                                                  "position": {
                                                    "start": { "line": 350 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "paragraph",
                                                      "position": {
                                                        "start": { "line": 357 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "text",
                                                          "position": {
                                                            "start": {
                                                              "line": 357
                                                            }
                                                          },
                                                          "value": "The user-defined variables in the "
                                                        },
                                                        {
                                                          "type": "ref_role",
                                                          "position": {
                                                            "start": {
                                                              "line": 357
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "text",
                                                              "position": {
                                                                "start": {
                                                                  "line": 357
                                                                }
                                                              },
                                                              "value": "let"
                                                            }
                                                          ],
                                                          "domain": "std",
                                                          "name": "label",
                                                          "target": "merge-let",
                                                          "flag": "",
                                                          "fileid": [
                                                            "reference/operator/aggregation/merge",
                                                            "std-label-merge-let"
                                                          ]
                                                        },
                                                        {
                                                          "type": "text",
                                                          "position": {
                                                            "start": {
                                                              "line": 357
                                                            }
                                                          },
                                                          "value": "\nfield."
                                                        }
                                                      ]
                                                    },
                                                    {
                                                      "type": "directive",
                                                      "position": {
                                                        "start": { "line": 360 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "root",
                                                          "position": {
                                                            "start": {
                                                              "line": 0
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "paragraph",
                                                              "position": {
                                                                "start": {
                                                                  "line": 0
                                                                }
                                                              },
                                                              "children": [
                                                                {
                                                                  "type": "text",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 0
                                                                    }
                                                                  },
                                                                  "value": "Specify the double dollar sign ($$) prefix together with the variable\nname in the form "
                                                                },
                                                                {
                                                                  "type": "literal",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 0
                                                                    }
                                                                  },
                                                                  "children": [
                                                                    {
                                                                      "type": "text",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 0
                                                                        }
                                                                      },
                                                                      "value": "$$<variable_name>"
                                                                    }
                                                                  ]
                                                                },
                                                                {
                                                                  "type": "text",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 0
                                                                    }
                                                                  },
                                                                  "value": ". For example, "
                                                                },
                                                                {
                                                                  "type": "literal",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 0
                                                                    }
                                                                  },
                                                                  "children": [
                                                                    {
                                                                      "type": "text",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 0
                                                                        }
                                                                      },
                                                                      "value": "$$year"
                                                                    }
                                                                  ]
                                                                },
                                                                {
                                                                  "type": "text",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 0
                                                                    }
                                                                  },
                                                                  "value": ". If the\nvariable is set to a document, you can also include a document field in\nthe form "
                                                                },
                                                                {
                                                                  "type": "literal",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 0
                                                                    }
                                                                  },
                                                                  "children": [
                                                                    {
                                                                      "type": "text",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 0
                                                                        }
                                                                      },
                                                                      "value": "$$<variable_name>.<field>"
                                                                    }
                                                                  ]
                                                                },
                                                                {
                                                                  "type": "text",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 0
                                                                    }
                                                                  },
                                                                  "value": ". For example, "
                                                                },
                                                                {
                                                                  "type": "literal",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 0
                                                                    }
                                                                  },
                                                                  "children": [
                                                                    {
                                                                      "type": "text",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 0
                                                                        }
                                                                      },
                                                                      "value": "$$year.month"
                                                                    }
                                                                  ]
                                                                },
                                                                {
                                                                  "type": "text",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 0
                                                                    }
                                                                  },
                                                                  "value": "."
                                                                }
                                                              ]
                                                            }
                                                          ],
                                                          "fileid": "includes/merge-stage-variables.rst"
                                                        }
                                                      ],
                                                      "domain": "",
                                                      "name": "include",
                                                      "argument": [
                                                        {
                                                          "type": "text",
                                                          "position": {
                                                            "start": {
                                                              "line": 360
                                                            }
                                                          },
                                                          "value": "/includes/merge-stage-variables.rst"
                                                        }
                                                      ]
                                                    },
                                                    {
                                                      "type": "paragraph",
                                                      "position": {
                                                        "start": { "line": 362 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "text",
                                                          "position": {
                                                            "start": {
                                                              "line": 362
                                                            }
                                                          },
                                                          "value": "For more examples, see "
                                                        },
                                                        {
                                                          "type": "ref_role",
                                                          "position": {
                                                            "start": {
                                                              "line": 362
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "text",
                                                              "position": {
                                                                "start": {
                                                                  "line": 362
                                                                }
                                                              },
                                                              "value": "Use Variables to Customize the Merge"
                                                            }
                                                          ],
                                                          "domain": "std",
                                                          "name": "label",
                                                          "target": "merge-variables-example",
                                                          "flag": "",
                                                          "fileid": [
                                                            "reference/operator/aggregation/merge",
                                                            "std-label-merge-variables-example"
                                                          ]
                                                        },
                                                        {
                                                          "type": "text",
                                                          "position": {
                                                            "start": {
                                                              "line": 362
                                                            }
                                                          },
                                                          "value": "."
                                                        }
                                                      ]
                                                    }
                                                  ]
                                                }
                                              ],
                                              "enumtype": "unordered"
                                            }
                                          ]
                                        }
                                      ],
                                      "enumtype": "unordered"
                                    }
                                  ]
                                }
                              ],
                              "enumtype": "unordered"
                            }
                          ]
                        },
                        {
                          "type": "listItem",
                          "position": { "start": { "line": 125 } },
                          "children": [
                            {
                              "type": "list",
                              "position": { "start": { "line": 364 } },
                              "children": [
                                {
                                  "type": "listItem",
                                  "position": { "start": { "line": 364 } },
                                  "children": [
                                    {
                                      "type": "paragraph",
                                      "position": { "start": { "line": 364 } },
                                      "children": [
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 364 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 364 }
                                              },
                                              "value": "let"
                                            }
                                          ],
                                          "domain": "std",
                                          "name": "label",
                                          "target": "merge-let",
                                          "flag": "",
                                          "fileid": [
                                            "reference/operator/aggregation/merge",
                                            "std-label-merge-let"
                                          ]
                                        }
                                      ]
                                    }
                                  ]
                                },
                                {
                                  "type": "listItem",
                                  "position": { "start": { "line": 364 } },
                                  "children": [
                                    {
                                      "type": "target",
                                      "position": { "start": { "line": 366 } },
                                      "children": [
                                        {
                                          "type": "target_identifier",
                                          "position": {
                                            "start": { "line": 366 }
                                          },
                                          "children": [],
                                          "ids": ["merge-let"]
                                        }
                                      ],
                                      "domain": "std",
                                      "name": "label",
                                      "html_id": "std-label-merge-let"
                                    },
                                    {
                                      "type": "paragraph",
                                      "position": { "start": { "line": 368 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 368 }
                                          },
                                          "value": "Optional. Specifies variables for use in the "
                                        },
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 368 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 368 }
                                              },
                                              "value": "whenMatched\npipeline"
                                            }
                                          ],
                                          "domain": "std",
                                          "name": "label",
                                          "target": "merge-whenMatched-pipeline",
                                          "flag": "",
                                          "fileid": [
                                            "reference/operator/aggregation/merge",
                                            "std-label-merge-whenMatched-pipeline"
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 368 }
                                          },
                                          "value": "."
                                        }
                                      ]
                                    },
                                    {
                                      "type": "paragraph",
                                      "position": { "start": { "line": 371 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 371 }
                                          },
                                          "value": "Specify a document with the variable names and value expressions:"
                                        }
                                      ]
                                    },
                                    {
                                      "type": "code",
                                      "position": { "start": { "line": 373 } },
                                      "lang": "javascript",
                                      "copyable": false,
                                      "emphasize_lines": [],
                                      "value": "{ <variable_name_1>: <expression_1>,\n  ...,\n  <variable_name_n>: <expression_n> }",
                                      "linenos": false
                                    },
                                    {
                                      "type": "paragraph",
                                      "position": { "start": { "line": 380 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 380 }
                                          },
                                          "value": "If unspecified, defaults to "
                                        },
                                        {
                                          "type": "literal",
                                          "position": {
                                            "start": { "line": 380 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 380 }
                                              },
                                              "value": "{ new: \"$$ROOT\" }"
                                            }
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 380 }
                                          },
                                          "value": " (see\n"
                                        },
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 380 }
                                          },
                                          "children": [
                                            {
                                              "type": "literal",
                                              "position": {
                                                "start": { "line": 380 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 380 }
                                                  },
                                                  "value": "ROOT"
                                                }
                                              ]
                                            }
                                          ],
                                          "domain": "mongodb",
                                          "name": "variable",
                                          "target": "variable.ROOT",
                                          "flag": "",
                                          "fileid": [
                                            "reference/aggregation-variables",
                                            "mongodb-variable-variable.ROOT"
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 380 }
                                          },
                                          "value": "). The "
                                        },
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 380 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 380 }
                                              },
                                              "value": "whenMatched pipeline"
                                            }
                                          ],
                                          "domain": "std",
                                          "name": "label",
                                          "target": "merge-whenMatched-pipeline",
                                          "flag": "",
                                          "fileid": [
                                            "reference/operator/aggregation/merge",
                                            "std-label-merge-whenMatched-pipeline"
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 380 }
                                          },
                                          "value": " can access the "
                                        },
                                        {
                                          "type": "literal",
                                          "position": {
                                            "start": { "line": 380 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 380 }
                                              },
                                              "value": "$$new"
                                            }
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 380 }
                                          },
                                          "value": " variable."
                                        }
                                      ]
                                    },
                                    {
                                      "type": "directive",
                                      "position": { "start": { "line": 384 } },
                                      "children": [
                                        {
                                          "type": "root",
                                          "position": {
                                            "start": { "line": 0 }
                                          },
                                          "children": [
                                            {
                                              "type": "directive",
                                              "position": {
                                                "start": { "line": 0 }
                                              },
                                              "children": [
                                                {
                                                  "type": "directive",
                                                  "position": {
                                                    "start": { "line": 0 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "paragraph",
                                                      "position": {
                                                        "start": { "line": 2 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "text",
                                                          "position": {
                                                            "start": {
                                                              "line": 2
                                                            }
                                                          },
                                                          "value": "Starting in MongoDB 4.2.2, the "
                                                        },
                                                        {
                                                          "type": "literal",
                                                          "position": {
                                                            "start": {
                                                              "line": 2
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "text",
                                                              "position": {
                                                                "start": {
                                                                  "line": 2
                                                                }
                                                              },
                                                              "value": "$$new"
                                                            }
                                                          ]
                                                        },
                                                        {
                                                          "type": "text",
                                                          "position": {
                                                            "start": {
                                                              "line": 2
                                                            }
                                                          },
                                                          "value": " variable is\nreserved, and cannot be overridden."
                                                        }
                                                      ]
                                                    }
                                                  ],
                                                  "domain": "",
                                                  "name": "note",
                                                  "argument": []
                                                }
                                              ],
                                              "domain": "",
                                              "name": "extract",
                                              "argument": []
                                            }
                                          ],
                                          "fileid": "includes/extracts-4.2-changes.yaml"
                                        }
                                      ],
                                      "domain": "",
                                      "name": "include",
                                      "argument": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 384 }
                                          },
                                          "value": "/includes/extracts/4.2-changes-new-variable-reserved.rst"
                                        }
                                      ]
                                    },
                                    {
                                      "type": "paragraph",
                                      "position": { "start": { "line": 386 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 386 }
                                          },
                                          "value": "To access the variables in the "
                                        },
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 386 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 386 }
                                              },
                                              "value": "whenMatched pipeline"
                                            }
                                          ],
                                          "domain": "std",
                                          "name": "label",
                                          "target": "merge-whenMatched-pipeline",
                                          "flag": "",
                                          "fileid": [
                                            "reference/operator/aggregation/merge",
                                            "std-label-merge-whenMatched-pipeline"
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 386 }
                                          },
                                          "value": ":"
                                        }
                                      ]
                                    },
                                    {
                                      "type": "directive",
                                      "position": { "start": { "line": 389 } },
                                      "children": [
                                        {
                                          "type": "root",
                                          "position": {
                                            "start": { "line": 0 }
                                          },
                                          "children": [
                                            {
                                              "type": "paragraph",
                                              "position": {
                                                "start": { "line": 0 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 0 }
                                                  },
                                                  "value": "Specify the double dollar sign ($$) prefix together with the variable\nname in the form "
                                                },
                                                {
                                                  "type": "literal",
                                                  "position": {
                                                    "start": { "line": 0 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 0 }
                                                      },
                                                      "value": "$$<variable_name>"
                                                    }
                                                  ]
                                                },
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 0 }
                                                  },
                                                  "value": ". For example, "
                                                },
                                                {
                                                  "type": "literal",
                                                  "position": {
                                                    "start": { "line": 0 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 0 }
                                                      },
                                                      "value": "$$year"
                                                    }
                                                  ]
                                                },
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 0 }
                                                  },
                                                  "value": ". If the\nvariable is set to a document, you can also include a document field in\nthe form "
                                                },
                                                {
                                                  "type": "literal",
                                                  "position": {
                                                    "start": { "line": 0 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 0 }
                                                      },
                                                      "value": "$$<variable_name>.<field>"
                                                    }
                                                  ]
                                                },
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 0 }
                                                  },
                                                  "value": ". For example, "
                                                },
                                                {
                                                  "type": "literal",
                                                  "position": {
                                                    "start": { "line": 0 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 0 }
                                                      },
                                                      "value": "$$year.month"
                                                    }
                                                  ]
                                                },
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 0 }
                                                  },
                                                  "value": "."
                                                }
                                              ]
                                            }
                                          ],
                                          "fileid": "includes/merge-stage-variables.rst"
                                        }
                                      ],
                                      "domain": "",
                                      "name": "include",
                                      "argument": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 389 }
                                          },
                                          "value": "/includes/merge-stage-variables.rst"
                                        }
                                      ]
                                    },
                                    {
                                      "type": "paragraph",
                                      "position": { "start": { "line": 391 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 391 }
                                          },
                                          "value": "For examples, see "
                                        },
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 391 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 391 }
                                              },
                                              "value": "Use Variables to Customize the Merge"
                                            }
                                          ],
                                          "domain": "std",
                                          "name": "label",
                                          "target": "merge-variables-example",
                                          "flag": "",
                                          "fileid": [
                                            "reference/operator/aggregation/merge",
                                            "std-label-merge-variables-example"
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 391 }
                                          },
                                          "value": "."
                                        }
                                      ]
                                    }
                                  ]
                                }
                              ],
                              "enumtype": "unordered"
                            }
                          ]
                        },
                        {
                          "type": "listItem",
                          "position": { "start": { "line": 125 } },
                          "children": [
                            {
                              "type": "list",
                              "position": { "start": { "line": 393 } },
                              "children": [
                                {
                                  "type": "listItem",
                                  "position": { "start": { "line": 393 } },
                                  "children": [
                                    {
                                      "type": "paragraph",
                                      "position": { "start": { "line": 393 } },
                                      "children": [
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 393 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 393 }
                                              },
                                              "value": "whenNotMatched"
                                            }
                                          ],
                                          "domain": "std",
                                          "name": "label",
                                          "target": "merge-whenNotMatched",
                                          "flag": "",
                                          "fileid": [
                                            "reference/operator/aggregation/merge",
                                            "std-label-merge-whenNotMatched"
                                          ]
                                        }
                                      ]
                                    }
                                  ]
                                },
                                {
                                  "type": "listItem",
                                  "position": { "start": { "line": 393 } },
                                  "children": [
                                    {
                                      "type": "target",
                                      "position": { "start": { "line": 395 } },
                                      "children": [
                                        {
                                          "type": "target_identifier",
                                          "position": {
                                            "start": { "line": 395 }
                                          },
                                          "children": [],
                                          "ids": ["merge-whenNotMatched"]
                                        }
                                      ],
                                      "domain": "std",
                                      "name": "label",
                                      "html_id": "std-label-merge-whenNotMatched"
                                    },
                                    {
                                      "type": "paragraph",
                                      "position": { "start": { "line": 397 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 397 }
                                          },
                                          "value": "Optional. The behavior of "
                                        },
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 397 }
                                          },
                                          "children": [
                                            {
                                              "type": "literal",
                                              "position": {
                                                "start": { "line": 397 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 397 }
                                                  },
                                                  "value": "$merge"
                                                }
                                              ]
                                            }
                                          ],
                                          "domain": "mongodb",
                                          "name": "pipeline",
                                          "target": "pipe.$merge",
                                          "flag": "",
                                          "fileid": [
                                            "reference/operator/aggregation/merge",
                                            "mongodb-pipeline-pipe.-merge"
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 397 }
                                          },
                                          "value": " if a result document\ndoes not match an existing document in the out collection."
                                        }
                                      ]
                                    },
                                    {
                                      "type": "paragraph",
                                      "position": { "start": { "line": 400 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 400 }
                                          },
                                          "value": "You can specify one of the pre-defined action strings:"
                                        }
                                      ]
                                    },
                                    {
                                      "type": "directive",
                                      "position": { "start": { "line": 402 } },
                                      "children": [
                                        {
                                          "type": "list",
                                          "position": {
                                            "start": { "line": 406 }
                                          },
                                          "children": [
                                            {
                                              "type": "listItem",
                                              "position": {
                                                "start": { "line": 406 }
                                              },
                                              "children": [
                                                {
                                                  "type": "list",
                                                  "position": {
                                                    "start": { "line": 406 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "listItem",
                                                      "position": {
                                                        "start": { "line": 406 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "paragraph",
                                                          "position": {
                                                            "start": {
                                                              "line": 406
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "text",
                                                              "position": {
                                                                "start": {
                                                                  "line": 406
                                                                }
                                                              },
                                                              "value": "Action"
                                                            }
                                                          ]
                                                        }
                                                      ]
                                                    },
                                                    {
                                                      "type": "listItem",
                                                      "position": {
                                                        "start": { "line": 406 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "paragraph",
                                                          "position": {
                                                            "start": {
                                                              "line": 407
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "text",
                                                              "position": {
                                                                "start": {
                                                                  "line": 407
                                                                }
                                                              },
                                                              "value": "Description"
                                                            }
                                                          ]
                                                        }
                                                      ]
                                                    }
                                                  ],
                                                  "enumtype": "unordered"
                                                }
                                              ]
                                            },
                                            {
                                              "type": "listItem",
                                              "position": {
                                                "start": { "line": 406 }
                                              },
                                              "children": [
                                                {
                                                  "type": "list",
                                                  "position": {
                                                    "start": { "line": 409 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "listItem",
                                                      "position": {
                                                        "start": { "line": 409 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "paragraph",
                                                          "position": {
                                                            "start": {
                                                              "line": 409
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "ref_role",
                                                              "position": {
                                                                "start": {
                                                                  "line": 409
                                                                }
                                                              },
                                                              "children": [
                                                                {
                                                                  "type": "text",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 409
                                                                    }
                                                                  },
                                                                  "value": "\"insert\""
                                                                }
                                                              ],
                                                              "domain": "std",
                                                              "name": "label",
                                                              "target": "merge-whenNotMatched-insert",
                                                              "flag": "",
                                                              "fileid": [
                                                                "reference/operator/aggregation/merge",
                                                                "std-label-merge-whenNotMatched-insert"
                                                              ]
                                                            },
                                                            {
                                                              "type": "text",
                                                              "position": {
                                                                "start": {
                                                                  "line": 409
                                                                }
                                                              },
                                                              "value": " (Default)"
                                                            }
                                                          ]
                                                        }
                                                      ]
                                                    },
                                                    {
                                                      "type": "listItem",
                                                      "position": {
                                                        "start": { "line": 409 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "target",
                                                          "position": {
                                                            "start": {
                                                              "line": 411
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "target_identifier",
                                                              "position": {
                                                                "start": {
                                                                  "line": 411
                                                                }
                                                              },
                                                              "children": [],
                                                              "ids": [
                                                                "merge-whenNotMatched-insert"
                                                              ]
                                                            }
                                                          ],
                                                          "domain": "std",
                                                          "name": "label",
                                                          "html_id": "std-label-merge-whenNotMatched-insert"
                                                        },
                                                        {
                                                          "type": "paragraph",
                                                          "position": {
                                                            "start": {
                                                              "line": 413
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "text",
                                                              "position": {
                                                                "start": {
                                                                  "line": 413
                                                                }
                                                              },
                                                              "value": "Insert the document into the output collection."
                                                            }
                                                          ]
                                                        }
                                                      ]
                                                    }
                                                  ],
                                                  "enumtype": "unordered"
                                                }
                                              ]
                                            },
                                            {
                                              "type": "listItem",
                                              "position": {
                                                "start": { "line": 406 }
                                              },
                                              "children": [
                                                {
                                                  "type": "list",
                                                  "position": {
                                                    "start": { "line": 415 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "listItem",
                                                      "position": {
                                                        "start": { "line": 415 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "paragraph",
                                                          "position": {
                                                            "start": {
                                                              "line": 415
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "ref_role",
                                                              "position": {
                                                                "start": {
                                                                  "line": 415
                                                                }
                                                              },
                                                              "children": [
                                                                {
                                                                  "type": "text",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 415
                                                                    }
                                                                  },
                                                                  "value": "\"discard\""
                                                                }
                                                              ],
                                                              "domain": "std",
                                                              "name": "label",
                                                              "target": "merge-whenNotMatched-discard",
                                                              "flag": "",
                                                              "fileid": [
                                                                "reference/operator/aggregation/merge",
                                                                "std-label-merge-whenNotMatched-discard"
                                                              ]
                                                            }
                                                          ]
                                                        }
                                                      ]
                                                    },
                                                    {
                                                      "type": "listItem",
                                                      "position": {
                                                        "start": { "line": 415 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "target",
                                                          "position": {
                                                            "start": {
                                                              "line": 417
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "target_identifier",
                                                              "position": {
                                                                "start": {
                                                                  "line": 417
                                                                }
                                                              },
                                                              "children": [],
                                                              "ids": [
                                                                "merge-whenNotMatched-discard"
                                                              ]
                                                            }
                                                          ],
                                                          "domain": "std",
                                                          "name": "label",
                                                          "html_id": "std-label-merge-whenNotMatched-discard"
                                                        },
                                                        {
                                                          "type": "paragraph",
                                                          "position": {
                                                            "start": {
                                                              "line": 419
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "text",
                                                              "position": {
                                                                "start": {
                                                                  "line": 419
                                                                }
                                                              },
                                                              "value": "Discard the document. Specifically, "
                                                            },
                                                            {
                                                              "type": "ref_role",
                                                              "position": {
                                                                "start": {
                                                                  "line": 419
                                                                }
                                                              },
                                                              "children": [
                                                                {
                                                                  "type": "literal",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 419
                                                                    }
                                                                  },
                                                                  "children": [
                                                                    {
                                                                      "type": "text",
                                                                      "position": {
                                                                        "start": {
                                                                          "line": 419
                                                                        }
                                                                      },
                                                                      "value": "$merge"
                                                                    }
                                                                  ]
                                                                }
                                                              ],
                                                              "domain": "mongodb",
                                                              "name": "pipeline",
                                                              "target": "pipe.$merge",
                                                              "flag": "",
                                                              "fileid": [
                                                                "reference/operator/aggregation/merge",
                                                                "mongodb-pipeline-pipe.-merge"
                                                              ]
                                                            },
                                                            {
                                                              "type": "text",
                                                              "position": {
                                                                "start": {
                                                                  "line": 419
                                                                }
                                                              },
                                                              "value": " does\nnot insert the document into the output collection."
                                                            }
                                                          ]
                                                        }
                                                      ]
                                                    }
                                                  ],
                                                  "enumtype": "unordered"
                                                }
                                              ]
                                            },
                                            {
                                              "type": "listItem",
                                              "position": {
                                                "start": { "line": 406 }
                                              },
                                              "children": [
                                                {
                                                  "type": "list",
                                                  "position": {
                                                    "start": { "line": 422 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "listItem",
                                                      "position": {
                                                        "start": { "line": 422 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "paragraph",
                                                          "position": {
                                                            "start": {
                                                              "line": 422
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "ref_role",
                                                              "position": {
                                                                "start": {
                                                                  "line": 422
                                                                }
                                                              },
                                                              "children": [
                                                                {
                                                                  "type": "text",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 422
                                                                    }
                                                                  },
                                                                  "value": "\"fail\""
                                                                }
                                                              ],
                                                              "domain": "std",
                                                              "name": "label",
                                                              "target": "merge-whenNotMatched-fail",
                                                              "flag": "",
                                                              "fileid": [
                                                                "reference/operator/aggregation/merge",
                                                                "std-label-merge-whenNotMatched-fail"
                                                              ]
                                                            }
                                                          ]
                                                        }
                                                      ]
                                                    },
                                                    {
                                                      "type": "listItem",
                                                      "position": {
                                                        "start": { "line": 422 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "target",
                                                          "position": {
                                                            "start": {
                                                              "line": 424
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "target_identifier",
                                                              "position": {
                                                                "start": {
                                                                  "line": 424
                                                                }
                                                              },
                                                              "children": [],
                                                              "ids": [
                                                                "merge-whenNotMatched-fail"
                                                              ]
                                                            }
                                                          ],
                                                          "domain": "std",
                                                          "name": "label",
                                                          "html_id": "std-label-merge-whenNotMatched-fail"
                                                        },
                                                        {
                                                          "type": "paragraph",
                                                          "position": {
                                                            "start": {
                                                              "line": 426
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "text",
                                                              "position": {
                                                                "start": {
                                                                  "line": 426
                                                                }
                                                              },
                                                              "value": "Stop and fail the aggregation operation. Any changes\nalready written to the output collection are not\nreverted."
                                                            }
                                                          ]
                                                        }
                                                      ]
                                                    }
                                                  ],
                                                  "enumtype": "unordered"
                                                }
                                              ]
                                            }
                                          ],
                                          "enumtype": "unordered"
                                        }
                                      ],
                                      "domain": "",
                                      "name": "list-table",
                                      "argument": [],
                                      "options": {
                                        "header-rows": 1,
                                        "widths": "20 80"
                                      }
                                    }
                                  ]
                                }
                              ],
                              "enumtype": "unordered"
                            }
                          ]
                        }
                      ],
                      "enumtype": "unordered"
                    }
                  ],
                  "domain": "",
                  "name": "list-table",
                  "argument": [],
                  "options": { "header-rows": 1, "widths": "17 83" }
                },
                {
                  "type": "target",
                  "position": { "start": { "line": 431 } },
                  "children": [
                    {
                      "type": "target_identifier",
                      "position": { "start": { "line": 431 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 434 } },
                          "value": "Considerations"
                        }
                      ],
                      "ids": ["aggregation-merge-behavior"]
                    }
                  ],
                  "domain": "std",
                  "name": "label",
                  "html_id": "std-label-aggregation-merge-behavior"
                }
              ]
            },
            {
              "type": "section",
              "position": { "start": { "line": 434 } },
              "children": [
                {
                  "type": "heading",
                  "position": { "start": { "line": 434 } },
                  "children": [
                    {
                      "type": "text",
                      "position": { "start": { "line": 434 } },
                      "value": "Considerations"
                    }
                  ],
                  "id": "considerations"
                },
                {
                  "type": "section",
                  "position": { "start": { "line": 437 } },
                  "children": [
                    {
                      "type": "heading",
                      "position": { "start": { "line": 437 } },
                      "children": [
                        {
                          "type": "literal",
                          "position": { "start": { "line": 437 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 437 } },
                              "value": "_id"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 437 } },
                          "value": " Field Generation"
                        }
                      ],
                      "id": "_id-field-generation"
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 439 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 439 } },
                          "value": "If the "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 439 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 439 } },
                              "value": "_id"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 439 } },
                          "value": " field is not present in a document from the\naggregation pipeline results, the "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 439 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 439 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 439 } },
                                  "value": "$merge"
                                }
                              ]
                            }
                          ],
                          "domain": "mongodb",
                          "name": "pipeline",
                          "target": "pipe.$merge",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "mongodb-pipeline-pipe.-merge"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 439 } },
                          "value": " stage generates\nit automatically."
                        }
                      ]
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 443 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 443 } },
                          "value": "For example, in the following aggregation pipeline,\n"
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 443 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 443 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 443 } },
                                  "value": "$project"
                                }
                              ]
                            }
                          ],
                          "domain": "mongodb",
                          "name": "pipeline",
                          "target": "pipe.$project",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/project",
                            "mongodb-pipeline-pipe.-project"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 443 } },
                          "value": " excludes the "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 443 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 443 } },
                              "value": "_id"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 443 } },
                          "value": " field from the documents\npassed into "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 443 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 443 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 443 } },
                                  "value": "$merge"
                                }
                              ]
                            }
                          ],
                          "domain": "mongodb",
                          "name": "pipeline",
                          "target": "pipe.$merge",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "mongodb-pipeline-pipe.-merge"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 443 } },
                          "value": ". When "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 443 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 443 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 443 } },
                                  "value": "$merge"
                                }
                              ]
                            }
                          ],
                          "domain": "mongodb",
                          "name": "pipeline",
                          "target": "pipe.$merge",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "mongodb-pipeline-pipe.-merge"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 443 } },
                          "value": " writes these\ndocuments to the "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 443 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 443 } },
                              "value": "\"newCollection\""
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 443 } },
                          "value": ", "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 443 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 443 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 443 } },
                                  "value": "$merge"
                                }
                              ]
                            }
                          ],
                          "domain": "mongodb",
                          "name": "pipeline",
                          "target": "pipe.$merge",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "mongodb-pipeline-pipe.-merge"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 443 } },
                          "value": " generates a\nnew "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 443 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 443 } },
                              "value": "_id"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 443 } },
                          "value": " field and value."
                        }
                      ]
                    },
                    {
                      "type": "code",
                      "position": { "start": { "line": 449 } },
                      "lang": "javascript",
                      "copyable": true,
                      "emphasize_lines": [],
                      "value": "db.sales.aggregate( [\n   { $project: { _id: 0 } },\n   { $merge : { into : \"newCollection\" } }\n] )",
                      "linenos": false
                    },
                    {
                      "type": "target",
                      "position": { "start": { "line": 456 } },
                      "children": [
                        {
                          "type": "target_identifier",
                          "position": { "start": { "line": 456 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 459 } },
                              "value": "Create a New Collection if Output Collection is Non-Existent"
                            }
                          ],
                          "ids": ["merge-behavior-create-collection"]
                        }
                      ],
                      "domain": "std",
                      "name": "label",
                      "html_id": "std-label-merge-behavior-create-collection"
                    }
                  ]
                },
                {
                  "type": "section",
                  "position": { "start": { "line": 459 } },
                  "children": [
                    {
                      "type": "heading",
                      "position": { "start": { "line": 459 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 459 } },
                          "value": "Create a New Collection if Output Collection is Non-Existent"
                        }
                      ],
                      "id": "create-a-new-collection-if-output-collection-is-non-existent"
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 461 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 461 } },
                          "value": "The "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 461 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 461 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 461 } },
                                  "value": "$merge"
                                }
                              ]
                            }
                          ],
                          "domain": "mongodb",
                          "name": "pipeline",
                          "target": "pipe.$merge",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "mongodb-pipeline-pipe.-merge"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 461 } },
                          "value": " operation creates a new collection if the\nspecified output collection does not exist."
                        }
                      ]
                    },
                    {
                      "type": "list",
                      "position": { "start": { "line": 464 } },
                      "children": [
                        {
                          "type": "listItem",
                          "position": { "start": { "line": 464 } },
                          "children": [
                            {
                              "type": "paragraph",
                              "position": { "start": { "line": 464 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 464 } },
                                  "value": "The output collection is created when "
                                },
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 464 } },
                                  "children": [
                                    {
                                      "type": "literal",
                                      "position": { "start": { "line": 464 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 464 }
                                          },
                                          "value": "$merge"
                                        }
                                      ]
                                    }
                                  ],
                                  "domain": "mongodb",
                                  "name": "pipeline",
                                  "target": "pipe.$merge",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/merge",
                                    "mongodb-pipeline-pipe.-merge"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 464 } },
                                  "value": " writes\nthe first document into the collection and is immediately visible."
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "type": "listItem",
                          "position": { "start": { "line": 464 } },
                          "children": [
                            {
                              "type": "paragraph",
                              "position": { "start": { "line": 467 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 467 } },
                                  "value": "If the aggregation fails, any writes completed by the\n"
                                },
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 467 } },
                                  "children": [
                                    {
                                      "type": "literal",
                                      "position": { "start": { "line": 467 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 467 }
                                          },
                                          "value": "$merge"
                                        }
                                      ]
                                    }
                                  ],
                                  "domain": "mongodb",
                                  "name": "pipeline",
                                  "target": "pipe.$merge",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/merge",
                                    "mongodb-pipeline-pipe.-merge"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 467 } },
                                  "value": " before the error will not be rolled back."
                                }
                              ]
                            }
                          ]
                        }
                      ],
                      "enumtype": "unordered"
                    },
                    {
                      "type": "directive",
                      "position": { "start": { "line": 470 } },
                      "children": [
                        {
                          "type": "paragraph",
                          "position": { "start": { "line": 472 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 472 } },
                              "value": "For a "
                            },
                            {
                              "type": "ref_role",
                              "position": { "start": { "line": 472 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 472 } },
                                  "value": "replica set"
                                }
                              ],
                              "domain": "std",
                              "name": "label",
                              "target": "replica-set",
                              "flag": "",
                              "fileid": ["replication", "std-label-replica-set"]
                            },
                            {
                              "type": "text",
                              "position": { "start": { "line": 472 } },
                              "value": " or a standalone, if the\noutput database does not exist, "
                            },
                            {
                              "type": "ref_role",
                              "position": { "start": { "line": 472 } },
                              "children": [
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 472 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 472 } },
                                      "value": "$merge"
                                    }
                                  ]
                                }
                              ],
                              "domain": "mongodb",
                              "name": "pipeline",
                              "target": "pipe.$merge",
                              "flag": "",
                              "fileid": [
                                "reference/operator/aggregation/merge",
                                "mongodb-pipeline-pipe.-merge"
                              ]
                            },
                            {
                              "type": "text",
                              "position": { "start": { "line": 472 } },
                              "value": " also creates\nthe database."
                            }
                          ]
                        },
                        {
                          "type": "paragraph",
                          "position": { "start": { "line": 476 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 476 } },
                              "value": "For a "
                            },
                            {
                              "type": "ref_role",
                              "position": { "start": { "line": 476 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 476 } },
                                  "value": "sharded cluster"
                                }
                              ],
                              "domain": "std",
                              "name": "label",
                              "target": "sharded-cluster",
                              "flag": "",
                              "fileid": [
                                "sharding",
                                "std-label-sharded-cluster"
                              ]
                            },
                            {
                              "type": "text",
                              "position": { "start": { "line": 476 } },
                              "value": ", the specified\noutput database must already exist."
                            }
                          ]
                        }
                      ],
                      "domain": "",
                      "name": "note",
                      "argument": []
                    },
                    {
                      "type": "target",
                      "position": { "start": { "line": 479 } },
                      "children": [
                        {
                          "type": "target_identifier",
                          "position": { "start": { "line": 479 } },
                          "children": [],
                          "ids": ["merge-use-different-on"]
                        }
                      ],
                      "domain": "std",
                      "name": "label",
                      "html_id": "std-label-merge-use-different-on"
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 481 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 481 } },
                          "value": "If the output collection does not exist, "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 481 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 481 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 481 } },
                                  "value": "$merge"
                                }
                              ]
                            }
                          ],
                          "domain": "mongodb",
                          "name": "pipeline",
                          "target": "pipe.$merge",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "mongodb-pipeline-pipe.-merge"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 481 } },
                          "value": " requires\nthe "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 481 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 481 } },
                              "value": "on"
                            }
                          ],
                          "domain": "std",
                          "name": "label",
                          "target": "merge-on",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "std-label-merge-on"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 481 } },
                          "value": " identifier to be the "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 481 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 481 } },
                              "value": "_id"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 481 } },
                          "value": " field. To use a\ndifferent "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 481 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 481 } },
                              "value": "on"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 481 } },
                          "value": " field value for a collection that does not exist, you\ncan create the collection first by creating a unique index on the\ndesired field(s) first. For example, if the output collection\n"
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 481 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 481 } },
                              "value": "newDailySales201905"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 481 } },
                          "value": " does not exist and you want to specify the\n"
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 481 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 481 } },
                              "value": "salesDate"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 481 } },
                          "value": " field as the "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 481 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 481 } },
                              "value": "on"
                            }
                          ],
                          "domain": "std",
                          "name": "label",
                          "target": "merge-on",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "std-label-merge-on"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 481 } },
                          "value": " identifier:"
                        }
                      ]
                    },
                    {
                      "type": "code",
                      "position": { "start": { "line": 489 } },
                      "lang": "javascript",
                      "copyable": true,
                      "emphasize_lines": [],
                      "value": "db.newDailySales201905.createIndex( { salesDate: 1 }, { unique: true } )\n\ndb.sales.aggregate( [\n   { $match: { date: { $gte: new Date(\"2019-05-01\"), $lt: new Date(\"2019-06-01\") } } },\n   { $group: { _id: { $dateToString: { format: \"%Y-%m-%d\", date: \"$date\" } }, totalqty: { $sum: \"$quantity\" } } },\n   { $project: { _id: 0, salesDate: { $toDate: \"$_id\" }, totalqty: 1 } },\n   { $merge : { into : \"newDailySales201905\", on: \"salesDate\" } }\n] )",
                      "linenos": false
                    }
                  ]
                },
                {
                  "type": "section",
                  "position": { "start": { "line": 501 } },
                  "children": [
                    {
                      "type": "heading",
                      "position": { "start": { "line": 501 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 501 } },
                          "value": "Output to a Sharded Collection"
                        }
                      ],
                      "id": "output-to-a-sharded-collection"
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 503 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 503 } },
                          "value": "The "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 503 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 503 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 503 } },
                                  "value": "$merge"
                                }
                              ]
                            }
                          ],
                          "domain": "mongodb",
                          "name": "pipeline",
                          "target": "pipe.$merge",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "mongodb-pipeline-pipe.-merge"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 503 } },
                          "value": " stage can output to a sharded collection.\nWhen the output collection is sharded, "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 503 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 503 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 503 } },
                                  "value": "$merge"
                                }
                              ]
                            }
                          ],
                          "domain": "mongodb",
                          "name": "pipeline",
                          "target": "pipe.$merge",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "mongodb-pipeline-pipe.-merge"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 503 } },
                          "value": " uses\nthe "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 503 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 503 } },
                              "value": "_id"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 503 } },
                          "value": " field and all the "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 503 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 503 } },
                              "value": "shard key"
                            }
                          ],
                          "domain": "std",
                          "name": "label",
                          "target": "sharding-shard-key-creation",
                          "flag": "",
                          "fileid": [
                            "core/sharding-shard-a-collection",
                            "std-label-sharding-shard-key-creation"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 503 } },
                          "value": " fields as the default "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 503 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 503 } },
                              "value": "on"
                            }
                          ],
                          "domain": "std",
                          "name": "label",
                          "target": "merge-on",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "std-label-merge-on"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 503 } },
                          "value": " identifier. If you override the default, the "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 503 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 503 } },
                              "value": "on"
                            }
                          ],
                          "domain": "std",
                          "name": "label",
                          "target": "merge-on",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "std-label-merge-on"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 503 } },
                          "value": " identifier must include all the "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 503 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 503 } },
                              "value": "shard key"
                            }
                          ],
                          "domain": "std",
                          "name": "label",
                          "target": "sharding-shard-key-creation",
                          "flag": "",
                          "fileid": [
                            "core/sharding-shard-a-collection",
                            "std-label-sharding-shard-key-creation"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 503 } },
                          "value": " fields:"
                        }
                      ]
                    },
                    {
                      "type": "code",
                      "position": { "start": { "line": 511 } },
                      "lang": "javascript",
                      "copyable": true,
                      "emphasize_lines": [],
                      "value": "{ $merge: {\n   into: \"<shardedColl>\" or { db:\"<sharding enabled db>\", coll: \"<shardedColl>\" },\n   on: [ \"<shardkeyfield1>\", \"<shardkeyfield2>\",... ], // Shard key fields and any additional fields\n   let: <variables>,                                         // Optional\n   whenMatched: <replace|keepExisting|merge|fail|pipeline>,  // Optional\n   whenNotMatched: <insert|discard|fail>                     // Optional\n} }",
                      "linenos": false
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 521 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 521 } },
                          "value": "For example, use the "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 521 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 521 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 521 } },
                                  "value": "sh.shardCollection()"
                                }
                              ]
                            }
                          ],
                          "domain": "mongodb",
                          "name": "method",
                          "target": "sh.shardCollection",
                          "flag": "",
                          "fileid": [
                            "reference/method/sh.shardCollection",
                            "mongodb-method-sh.shardCollection"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 521 } },
                          "value": " method\nto create a new sharded collection "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 521 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 521 } },
                              "value": "newrestaurants"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 521 } },
                          "value": " with the\n"
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 521 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 521 } },
                              "value": "postcode"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 521 } },
                          "value": " field as the shard key."
                        }
                      ]
                    },
                    {
                      "type": "code",
                      "position": { "start": { "line": 525 } },
                      "lang": "javascript",
                      "copyable": true,
                      "emphasize_lines": [],
                      "value": "sh.shardCollection(\n   \"exampledb.newrestaurants\",      // Namespace of the collection to shard\n   { postcode: 1 },                 // Shard key\n);",
                      "linenos": false
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 532 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 532 } },
                          "value": "The "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 532 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 532 } },
                              "value": "newrestaurants"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 532 } },
                          "value": " collection will contain documents with\ninformation on new restaurant openings by month ("
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 532 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 532 } },
                              "value": "date"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 532 } },
                          "value": " field) and\npostcode (shard key); specifically, the "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 532 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 532 } },
                              "value": "on"
                            }
                          ],
                          "domain": "std",
                          "name": "label",
                          "target": "merge-on",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "std-label-merge-on"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 532 } },
                          "value": "\nidentifier is "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 532 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 532 } },
                              "value": "[\"date\", \"postcode\"]"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 532 } },
                          "value": " (the ordering of the fields\ndoes not matter). Because "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 532 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 532 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 532 } },
                                  "value": "$merge"
                                }
                              ]
                            }
                          ],
                          "domain": "mongodb",
                          "name": "pipeline",
                          "target": "pipe.$merge",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "mongodb-pipeline-pipe.-merge"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 532 } },
                          "value": " requires a unique\nindex with keys that correspond to the "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 532 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 532 } },
                              "value": "on"
                            }
                          ],
                          "domain": "std",
                          "name": "label",
                          "target": "merge-on",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "std-label-merge-on"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 532 } },
                          "value": " identifier fields, create the unique index\n(the ordering of the fields do not matter): "
                        },
                        {
                          "type": "footnote_reference",
                          "position": { "start": { "line": 532 } },
                          "children": [],
                          "id": "id1",
                          "refname": "uniqueoption"
                        }
                      ]
                    },
                    {
                      "type": "code",
                      "position": { "start": { "line": 541 } },
                      "lang": "javascript",
                      "copyable": true,
                      "emphasize_lines": [],
                      "value": "use exampledb\ndb.newrestaurants.createIndex( { postcode: 1, date: 1 }, { unique: true } )",
                      "linenos": false
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 546 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 546 } },
                          "value": "With the sharded collection "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 546 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 546 } },
                              "value": "restaurants"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 546 } },
                          "value": " and the unique index\ncreated, you can use "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 546 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 546 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 546 } },
                                  "value": "$merge"
                                }
                              ]
                            }
                          ],
                          "domain": "mongodb",
                          "name": "pipeline",
                          "target": "pipe.$merge",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "mongodb-pipeline-pipe.-merge"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 546 } },
                          "value": " to output the aggregation\nresults to this collection, matching on "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 546 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 546 } },
                              "value": "[ \"date\", \"postcode\" ]"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 546 } },
                          "value": "\nas in this example:"
                        }
                      ]
                    },
                    {
                      "type": "code",
                      "position": { "start": { "line": 551 } },
                      "lang": "javascript",
                      "copyable": true,
                      "emphasize_lines": [],
                      "value": "use exampledb\n\ndb.openings.aggregate([\n   { $group: {\n      _id: { date: { $dateToString: { format: \"%Y-%m\", date: \"$date\" } }, postcode: \"$postcode\" },\n      restaurants: { $push: \"$restaurantName\" } } },\n   { $project: { _id: 0, postcode: \"$_id.postcode\", date: \"$_id.date\", restaurants: 1 } },\n   { $merge: { into: \"newrestaurants\", \"on\": [ \"date\", \"postcode\" ], whenMatched: \"replace\", whenNotMatched: \"insert\" } }\n])",
                      "linenos": false
                    },
                    {
                      "type": "footnote",
                      "position": { "start": { "line": 563 } },
                      "children": [
                        {
                          "type": "paragraph",
                          "position": { "start": { "line": 565 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 565 } },
                              "value": "The "
                            },
                            {
                              "type": "ref_role",
                              "position": { "start": { "line": 565 } },
                              "children": [
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 565 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 565 } },
                                      "value": "sh.shardCollection()"
                                    }
                                  ]
                                }
                              ],
                              "domain": "mongodb",
                              "name": "method",
                              "target": "sh.shardCollection",
                              "flag": "",
                              "fileid": [
                                "reference/method/sh.shardCollection",
                                "mongodb-method-sh.shardCollection"
                              ]
                            },
                            {
                              "type": "text",
                              "position": { "start": { "line": 565 } },
                              "value": " method can also create a\nunique index on the shard key when passed the "
                            },
                            {
                              "type": "literal",
                              "position": { "start": { "line": 565 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 565 } },
                                  "value": "{ unique: true\n}"
                                }
                              ]
                            },
                            {
                              "type": "text",
                              "position": { "start": { "line": 565 } },
                              "value": " option if: the shard key is "
                            },
                            {
                              "type": "ref_role",
                              "position": { "start": { "line": 565 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 565 } },
                                  "value": "range-based"
                                }
                              ],
                              "domain": "std",
                              "name": "doc",
                              "target": "",
                              "flag": "",
                              "fileid": ["/core/ranged-sharding", ""]
                            },
                            {
                              "type": "text",
                              "position": { "start": { "line": 565 } },
                              "value": ", the collection is empty, and a unique\nindex on the shard key doesn't already exist."
                            }
                          ]
                        },
                        {
                          "type": "paragraph",
                          "position": { "start": { "line": 571 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 571 } },
                              "value": "In the previous example, because the "
                            },
                            {
                              "type": "literal",
                              "position": { "start": { "line": 571 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 571 } },
                                  "value": "on"
                                }
                              ]
                            },
                            {
                              "type": "text",
                              "position": { "start": { "line": 571 } },
                              "value": " identifier is the\nshard key and another field, a separate operation to create the\ncorresponding index is required."
                            }
                          ]
                        }
                      ],
                      "id": "uniqueoption",
                      "name": "uniqueoption"
                    },
                    {
                      "type": "target",
                      "position": { "start": { "line": 575 } },
                      "children": [
                        {
                          "type": "target_identifier",
                          "position": { "start": { "line": 575 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 578 } },
                              "value": "Replace Documents ("
                            },
                            {
                              "type": "literal",
                              "position": { "start": { "line": 578 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 578 } },
                                  "value": "$merge"
                                }
                              ]
                            },
                            {
                              "type": "text",
                              "position": { "start": { "line": 578 } },
                              "value": ") vs Replace Collection ("
                            },
                            {
                              "type": "literal",
                              "position": { "start": { "line": 578 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 578 } },
                                  "value": "$out"
                                }
                              ]
                            },
                            {
                              "type": "text",
                              "position": { "start": { "line": 578 } },
                              "value": ")"
                            }
                          ],
                          "ids": ["merge-behavior-replaceCollection"]
                        }
                      ],
                      "domain": "std",
                      "name": "label",
                      "html_id": "std-label-merge-behavior-replaceCollection"
                    }
                  ]
                },
                {
                  "type": "section",
                  "position": { "start": { "line": 578 } },
                  "children": [
                    {
                      "type": "heading",
                      "position": { "start": { "line": 578 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 578 } },
                          "value": "Replace Documents ("
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 578 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 578 } },
                              "value": "$merge"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 578 } },
                          "value": ") vs Replace Collection ("
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 578 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 578 } },
                              "value": "$out"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 578 } },
                          "value": ")"
                        }
                      ],
                      "id": "replace-documents---merge--vs-replace-collection---out-"
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 580 } },
                      "children": [
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 580 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 580 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 580 } },
                                  "value": "$merge"
                                }
                              ]
                            }
                          ],
                          "domain": "mongodb",
                          "name": "pipeline",
                          "target": "pipe.$merge",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "mongodb-pipeline-pipe.-merge"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 580 } },
                          "value": " can replace an existing document in the output\ncollection if the aggregation results contain a document or\ndocuments that match based on the "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 580 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 580 } },
                              "value": "on"
                            }
                          ],
                          "domain": "std",
                          "name": "label",
                          "target": "merge-on",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "std-label-merge-on"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 580 } },
                          "value": "\nspecification. As such, "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 580 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 580 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 580 } },
                                  "value": "$merge"
                                }
                              ]
                            }
                          ],
                          "domain": "mongodb",
                          "name": "pipeline",
                          "target": "pipe.$merge",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "mongodb-pipeline-pipe.-merge"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 580 } },
                          "value": " can replace all documents\nin the existing collection if the aggregation results include\nmatching documents for all existing documents in the collection and\nyou specify "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 580 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 580 } },
                              "value": "\"replace\""
                            }
                          ],
                          "domain": "std",
                          "name": "label",
                          "target": "merge-whenMatched-replace",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "std-label-merge-whenMatched-replace"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 580 } },
                          "value": " for\n"
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 580 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 580 } },
                              "value": "whenMatched"
                            }
                          ],
                          "domain": "std",
                          "name": "label",
                          "target": "merge-whenMatched",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "std-label-merge-whenMatched"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 580 } },
                          "value": "."
                        }
                      ]
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 589 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 589 } },
                          "value": "However, "
                        },
                        {
                          "type": "strong",
                          "position": { "start": { "line": 589 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 589 } },
                              "value": "to replace an existing collection"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 589 } },
                          "value": " regardless of the\naggregation results, use "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 589 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 589 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 589 } },
                                  "value": "$out"
                                }
                              ]
                            }
                          ],
                          "domain": "mongodb",
                          "name": "pipeline",
                          "target": "pipe.$out",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/out",
                            "mongodb-pipeline-pipe.-out"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 589 } },
                          "value": " instead."
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "section",
                  "position": { "start": { "line": 593 } },
                  "children": [
                    {
                      "type": "heading",
                      "position": { "start": { "line": 593 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 593 } },
                          "value": "Existing Documents and "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 593 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 593 } },
                              "value": "_id"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 593 } },
                          "value": " and Shard Key Values"
                        }
                      ],
                      "id": "existing-documents-and-_id-and-shard-key-values"
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 595 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 595 } },
                          "value": "The "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 595 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 595 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 595 } },
                                  "value": "$merge"
                                }
                              ]
                            }
                          ],
                          "domain": "mongodb",
                          "name": "pipeline",
                          "target": "pipe.$merge",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "mongodb-pipeline-pipe.-merge"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 595 } },
                          "value": " errors if the "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 595 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 595 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 595 } },
                                  "value": "$merge"
                                }
                              ]
                            }
                          ],
                          "domain": "mongodb",
                          "name": "pipeline",
                          "target": "pipe.$merge",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "mongodb-pipeline-pipe.-merge"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 595 } },
                          "value": " results in a\nchange to an existing document's "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 595 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 595 } },
                              "value": "_id"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 595 } },
                          "value": " value."
                        }
                      ]
                    },
                    {
                      "type": "directive",
                      "position": { "start": { "line": 598 } },
                      "children": [
                        {
                          "type": "paragraph",
                          "position": { "start": { "line": 600 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 600 } },
                              "value": "To avoid this error, if the "
                            },
                            {
                              "type": "ref_role",
                              "position": { "start": { "line": 600 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 600 } },
                                  "value": "on"
                                }
                              ],
                              "domain": "std",
                              "name": "label",
                              "target": "merge-on",
                              "flag": "",
                              "fileid": [
                                "reference/operator/aggregation/merge",
                                "std-label-merge-on"
                              ]
                            },
                            {
                              "type": "text",
                              "position": { "start": { "line": 600 } },
                              "value": " field does not\ninclude the "
                            },
                            {
                              "type": "literal",
                              "position": { "start": { "line": 600 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 600 } },
                                  "value": "_id"
                                }
                              ]
                            },
                            {
                              "type": "text",
                              "position": { "start": { "line": 600 } },
                              "value": " field, remove the "
                            },
                            {
                              "type": "literal",
                              "position": { "start": { "line": 600 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 600 } },
                                  "value": "_id"
                                }
                              ]
                            },
                            {
                              "type": "text",
                              "position": { "start": { "line": 600 } },
                              "value": " field in the\naggregation results to avoid the error, such as with a preceding\n"
                            },
                            {
                              "type": "ref_role",
                              "position": { "start": { "line": 600 } },
                              "children": [
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 600 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 600 } },
                                      "value": "$unset"
                                    }
                                  ]
                                }
                              ],
                              "domain": "mongodb",
                              "name": "pipeline",
                              "target": "pipe.$unset",
                              "flag": "",
                              "fileid": [
                                "reference/operator/aggregation/unset",
                                "mongodb-pipeline-pipe.-unset"
                              ]
                            },
                            {
                              "type": "text",
                              "position": { "start": { "line": 600 } },
                              "value": " stage, and so on."
                            }
                          ]
                        },
                        {
                          "type": "paragraph",
                          "position": { "start": { "line": 605 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 605 } },
                              "value": "Additionally, for a sharded collection, "
                            },
                            {
                              "type": "ref_role",
                              "position": { "start": { "line": 605 } },
                              "children": [
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 605 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 605 } },
                                      "value": "$merge"
                                    }
                                  ]
                                }
                              ],
                              "domain": "mongodb",
                              "name": "pipeline",
                              "target": "pipe.$merge",
                              "flag": "",
                              "fileid": [
                                "reference/operator/aggregation/merge",
                                "mongodb-pipeline-pipe.-merge"
                              ]
                            },
                            {
                              "type": "text",
                              "position": { "start": { "line": 605 } },
                              "value": " also\ngenerates an error if it results in a change to the shard key value\nof an exising document."
                            }
                          ]
                        },
                        {
                          "type": "paragraph",
                          "position": { "start": { "line": 609 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 609 } },
                              "value": "Any writes completed by the "
                            },
                            {
                              "type": "ref_role",
                              "position": { "start": { "line": 609 } },
                              "children": [
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 609 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 609 } },
                                      "value": "$merge"
                                    }
                                  ]
                                }
                              ],
                              "domain": "mongodb",
                              "name": "pipeline",
                              "target": "pipe.$merge",
                              "flag": "",
                              "fileid": [
                                "reference/operator/aggregation/merge",
                                "mongodb-pipeline-pipe.-merge"
                              ]
                            },
                            {
                              "type": "text",
                              "position": { "start": { "line": 609 } },
                              "value": " before the error will\nnot be rolled back."
                            }
                          ]
                        }
                      ],
                      "domain": "",
                      "name": "tip",
                      "argument": []
                    },
                    {
                      "type": "target",
                      "position": { "start": { "line": 612 } },
                      "children": [
                        {
                          "type": "target_identifier",
                          "position": { "start": { "line": 612 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 615 } },
                              "value": "Unique Index Constraints"
                            }
                          ],
                          "ids": ["merge-unique-index-constraints"]
                        }
                      ],
                      "domain": "std",
                      "name": "label",
                      "html_id": "std-label-merge-unique-index-constraints"
                    }
                  ]
                },
                {
                  "type": "section",
                  "position": { "start": { "line": 615 } },
                  "children": [
                    {
                      "type": "heading",
                      "position": { "start": { "line": 615 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 615 } },
                          "value": "Unique Index Constraints"
                        }
                      ],
                      "id": "unique-index-constraints"
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 617 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 617 } },
                          "value": "If the unique index used by "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 617 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 617 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 617 } },
                                  "value": "$merge"
                                }
                              ]
                            }
                          ],
                          "domain": "mongodb",
                          "name": "pipeline",
                          "target": "pipe.$merge",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "mongodb-pipeline-pipe.-merge"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 617 } },
                          "value": " for "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 617 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 617 } },
                              "value": "on"
                            }
                          ],
                          "domain": "std",
                          "name": "label",
                          "target": "merge-on",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "std-label-merge-on"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 617 } },
                          "value": " field(s) is dropped mid-aggregation, there is no\nguarantee that the aggregation will be killed. If the aggregation\ncontinues, there is no guarantee that documents do not have\nduplicate "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 617 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 617 } },
                              "value": "on"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 617 } },
                          "value": " field values."
                        }
                      ]
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 623 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 623 } },
                          "value": "If the "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 623 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 623 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 623 } },
                                  "value": "$merge"
                                }
                              ]
                            }
                          ],
                          "domain": "mongodb",
                          "name": "pipeline",
                          "target": "pipe.$merge",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "mongodb-pipeline-pipe.-merge"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 623 } },
                          "value": " attempts to write a document that violates\nany unique index on the output collection, the operation generates an\nerror. For example:"
                        }
                      ]
                    },
                    {
                      "type": "list",
                      "position": { "start": { "line": 627 } },
                      "children": [
                        {
                          "type": "listItem",
                          "position": { "start": { "line": 627 } },
                          "children": [
                            {
                              "type": "paragraph",
                              "position": { "start": { "line": 627 } },
                              "children": [
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 627 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 627 } },
                                      "value": "Insert a non-matching document"
                                    }
                                  ],
                                  "domain": "std",
                                  "name": "label",
                                  "target": "merge-whenNotMatched-insert",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/merge",
                                    "std-label-merge-whenNotMatched-insert"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 627 } },
                                  "value": " that violates a unique index other\nthan the index on the "
                                },
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 627 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 627 } },
                                      "value": "on"
                                    }
                                  ],
                                  "domain": "std",
                                  "name": "label",
                                  "target": "merge-on",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/merge",
                                    "std-label-merge-on"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 627 } },
                                  "value": " field(s)."
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "type": "listItem",
                          "position": { "start": { "line": 627 } },
                          "children": [
                            {
                              "type": "paragraph",
                              "position": { "start": { "line": 631 } },
                              "children": [
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 631 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 631 } },
                                      "value": "Fail"
                                    }
                                  ],
                                  "domain": "std",
                                  "name": "label",
                                  "target": "merge-whenMatched-fail",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/merge",
                                    "std-label-merge-whenMatched-fail"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 631 } },
                                  "value": " if there is a matching\ndocument in the collection. Specifically, the operation attempts\nto insert the matching document which violates the unique index on\nthe "
                                },
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 631 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 631 } },
                                      "value": "on"
                                    }
                                  ],
                                  "domain": "std",
                                  "name": "label",
                                  "target": "merge-on",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/merge",
                                    "std-label-merge-on"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 631 } },
                                  "value": " field(s)."
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "type": "listItem",
                          "position": { "start": { "line": 627 } },
                          "children": [
                            {
                              "type": "paragraph",
                              "position": { "start": { "line": 636 } },
                              "children": [
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 636 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 636 } },
                                      "value": "Replace an existing document"
                                    }
                                  ],
                                  "domain": "std",
                                  "name": "label",
                                  "target": "merge-whenMatched-replace",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/merge",
                                    "std-label-merge-whenMatched-replace"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 636 } },
                                  "value": " with a new document that\nviolates a unique index other than the index on the "
                                },
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 636 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 636 } },
                                      "value": "on"
                                    }
                                  ],
                                  "domain": "std",
                                  "name": "label",
                                  "target": "merge-on",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/merge",
                                    "std-label-merge-on"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 636 } },
                                  "value": " field(s)."
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "type": "listItem",
                          "position": { "start": { "line": 627 } },
                          "children": [
                            {
                              "type": "paragraph",
                              "position": { "start": { "line": 641 } },
                              "children": [
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 641 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 641 } },
                                      "value": "Merge the matching documents"
                                    }
                                  ],
                                  "domain": "std",
                                  "name": "label",
                                  "target": "merge-whenMatched-merge",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/merge",
                                    "std-label-merge-whenMatched-merge"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 641 } },
                                  "value": " that\nresults in a document that violates a unique index other than the\nindex on the "
                                },
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 641 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 641 } },
                                      "value": "on"
                                    }
                                  ],
                                  "domain": "std",
                                  "name": "label",
                                  "target": "merge-on",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/merge",
                                    "std-label-merge-on"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 641 } },
                                  "value": " field(s)."
                                }
                              ]
                            }
                          ]
                        }
                      ],
                      "enumtype": "unordered"
                    }
                  ]
                },
                {
                  "type": "section",
                  "position": { "start": { "line": 646 } },
                  "children": [
                    {
                      "type": "heading",
                      "position": { "start": { "line": 646 } },
                      "children": [
                        {
                          "type": "literal",
                          "position": { "start": { "line": 646 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 646 } },
                              "value": "whenMatched"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 646 } },
                          "value": " Pipeline Behavior"
                        }
                      ],
                      "id": "whenmatched-pipeline-behavior"
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 648 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 648 } },
                          "value": "Starting in MongoDB 4.2.2, if all of the following are true for a\n"
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 648 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 648 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 648 } },
                                  "value": "$merge"
                                }
                              ]
                            }
                          ],
                          "domain": "mongodb",
                          "name": "pipeline",
                          "target": "pipe.$merge",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "mongodb-pipeline-pipe.-merge"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 648 } },
                          "value": " stage:"
                        }
                      ]
                    },
                    {
                      "type": "list",
                      "position": { "start": { "line": 651 } },
                      "children": [
                        {
                          "type": "listItem",
                          "position": { "start": { "line": 651 } },
                          "children": [
                            {
                              "type": "paragraph",
                              "position": { "start": { "line": 651 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 651 } },
                                  "value": "The value of "
                                },
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 651 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 651 } },
                                      "value": "whenMatched"
                                    }
                                  ],
                                  "domain": "std",
                                  "name": "label",
                                  "target": "merge-whenMatched",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/merge",
                                    "std-label-merge-whenMatched"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 651 } },
                                  "value": " is an\naggregation pipeline,"
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "type": "listItem",
                          "position": { "start": { "line": 651 } },
                          "children": [
                            {
                              "type": "paragraph",
                              "position": { "start": { "line": 654 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 654 } },
                                  "value": "The value of "
                                },
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 654 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 654 } },
                                      "value": "whenNotMatched"
                                    }
                                  ],
                                  "domain": "std",
                                  "name": "label",
                                  "target": "merge-whenNotMatched",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/merge",
                                    "std-label-merge-whenNotMatched"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 654 } },
                                  "value": " is\n"
                                },
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 654 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 654 } },
                                      "value": "insert"
                                    }
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 654 } },
                                  "value": ", and"
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "type": "listItem",
                          "position": { "start": { "line": 651 } },
                          "children": [
                            {
                              "type": "paragraph",
                              "position": { "start": { "line": 657 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 657 } },
                                  "value": "There is no match for a document in the output collection,"
                                }
                              ]
                            }
                          ]
                        }
                      ],
                      "enumtype": "unordered"
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 659 } },
                      "children": [
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 659 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 659 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 659 } },
                                  "value": "$merge"
                                }
                              ]
                            }
                          ],
                          "domain": "mongodb",
                          "name": "pipeline",
                          "target": "pipe.$merge",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "mongodb-pipeline-pipe.-merge"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 659 } },
                          "value": " inserts the document directly into the output\ncollection."
                        }
                      ]
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 662 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 662 } },
                          "value": "Prior to MongoDB 4.2.2, when these conditions for a\n"
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 662 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 662 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 662 } },
                                  "value": "$merge"
                                }
                              ]
                            }
                          ],
                          "domain": "mongodb",
                          "name": "pipeline",
                          "target": "pipe.$merge",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "mongodb-pipeline-pipe.-merge"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 662 } },
                          "value": " stage are met, the pipeline specified in the\n"
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 662 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 662 } },
                              "value": "whenMatched"
                            }
                          ],
                          "domain": "std",
                          "name": "label",
                          "target": "merge-whenMatched",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "std-label-merge-whenMatched"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 662 } },
                          "value": " field is executed with an\nempty input document. The resulting document from the pipeline is\ninserted into the output collection."
                        }
                      ]
                    },
                    {
                      "type": "directive",
                      "position": { "start": { "line": 668 } },
                      "children": [
                        {
                          "type": "paragraph",
                          "position": { "start": { "line": 670 } },
                          "children": [
                            {
                              "type": "ref_role",
                              "position": { "start": { "line": 670 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 670 } },
                                  "value": "4.2.2 Release Notes"
                                }
                              ],
                              "domain": "std",
                              "name": "label",
                              "target": "4.2.2-release-notes",
                              "flag": "",
                              "fileid": [
                                "release-notes/4.2",
                                "std-label-4.2.2-release-notes"
                              ]
                            }
                          ]
                        }
                      ],
                      "domain": "",
                      "name": "seealso",
                      "argument": []
                    },
                    {
                      "type": "target",
                      "position": { "start": { "line": 672 } },
                      "children": [
                        {
                          "type": "target_identifier",
                          "position": { "start": { "line": 672 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 675 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 675 } },
                                  "value": "$merge"
                                }
                              ]
                            },
                            {
                              "type": "text",
                              "position": { "start": { "line": 675 } },
                              "value": " and "
                            },
                            {
                              "type": "literal",
                              "position": { "start": { "line": 675 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 675 } },
                                  "value": "$out"
                                }
                              ]
                            },
                            {
                              "type": "text",
                              "position": { "start": { "line": 675 } },
                              "value": " Comparison"
                            }
                          ],
                          "ids": ["merge-out-comparison"]
                        }
                      ],
                      "domain": "std",
                      "name": "label",
                      "html_id": "std-label-merge-out-comparison"
                    }
                  ]
                },
                {
                  "type": "section",
                  "position": { "start": { "line": 675 } },
                  "children": [
                    {
                      "type": "heading",
                      "position": { "start": { "line": 675 } },
                      "children": [
                        {
                          "type": "literal",
                          "position": { "start": { "line": 675 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 675 } },
                              "value": "$merge"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 675 } },
                          "value": " and "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 675 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 675 } },
                              "value": "$out"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 675 } },
                          "value": " Comparison"
                        }
                      ],
                      "id": "-merge-and--out-comparison"
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 677 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 677 } },
                          "value": "With the introduction of "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 677 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 677 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 677 } },
                                  "value": "$merge"
                                }
                              ]
                            }
                          ],
                          "domain": "mongodb",
                          "name": "pipeline",
                          "target": "pipe.$merge",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "mongodb-pipeline-pipe.-merge"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 677 } },
                          "value": ", MongoDB provides two\nstages, "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 677 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 677 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 677 } },
                                  "value": "$merge"
                                }
                              ]
                            }
                          ],
                          "domain": "mongodb",
                          "name": "pipeline",
                          "target": "pipe.$merge",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "mongodb-pipeline-pipe.-merge"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 677 } },
                          "value": " and "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 677 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 677 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 677 } },
                                  "value": "$out"
                                }
                              ]
                            }
                          ],
                          "domain": "mongodb",
                          "name": "pipeline",
                          "target": "pipe.$out",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/out",
                            "mongodb-pipeline-pipe.-out"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 677 } },
                          "value": ", for writing the\nresults of the aggregation pipeline to a collection:"
                        }
                      ]
                    },
                    {
                      "type": "directive",
                      "position": { "start": { "line": 681 } },
                      "children": [
                        {
                          "type": "list",
                          "position": { "start": { "line": 685 } },
                          "children": [
                            {
                              "type": "listItem",
                              "position": { "start": { "line": 685 } },
                              "children": [
                                {
                                  "type": "list",
                                  "position": { "start": { "line": 685 } },
                                  "children": [
                                    {
                                      "type": "listItem",
                                      "position": { "start": { "line": 685 } },
                                      "children": [
                                        {
                                          "type": "paragraph",
                                          "position": {
                                            "start": { "line": 685 }
                                          },
                                          "children": [
                                            {
                                              "type": "ref_role",
                                              "position": {
                                                "start": { "line": 685 }
                                              },
                                              "children": [
                                                {
                                                  "type": "literal",
                                                  "position": {
                                                    "start": { "line": 685 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 685 }
                                                      },
                                                      "value": "$merge"
                                                    }
                                                  ]
                                                }
                                              ],
                                              "domain": "mongodb",
                                              "name": "pipeline",
                                              "target": "pipe.$merge",
                                              "flag": "",
                                              "fileid": [
                                                "reference/operator/aggregation/merge",
                                                "mongodb-pipeline-pipe.-merge"
                                              ]
                                            }
                                          ]
                                        }
                                      ]
                                    },
                                    {
                                      "type": "listItem",
                                      "position": { "start": { "line": 685 } },
                                      "children": [
                                        {
                                          "type": "paragraph",
                                          "position": {
                                            "start": { "line": 686 }
                                          },
                                          "children": [
                                            {
                                              "type": "ref_role",
                                              "position": {
                                                "start": { "line": 686 }
                                              },
                                              "children": [
                                                {
                                                  "type": "literal",
                                                  "position": {
                                                    "start": { "line": 686 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 686 }
                                                      },
                                                      "value": "$out"
                                                    }
                                                  ]
                                                }
                                              ],
                                              "domain": "mongodb",
                                              "name": "pipeline",
                                              "target": "pipe.$out",
                                              "flag": "",
                                              "fileid": [
                                                "reference/operator/aggregation/out",
                                                "mongodb-pipeline-pipe.-out"
                                              ]
                                            }
                                          ]
                                        }
                                      ]
                                    }
                                  ],
                                  "enumtype": "unordered"
                                }
                              ]
                            },
                            {
                              "type": "listItem",
                              "position": { "start": { "line": 685 } },
                              "children": [
                                {
                                  "type": "list",
                                  "position": { "start": { "line": 688 } },
                                  "children": [
                                    {
                                      "type": "listItem",
                                      "position": { "start": { "line": 688 } },
                                      "children": [
                                        {
                                          "type": "list",
                                          "position": {
                                            "start": { "line": 688 }
                                          },
                                          "children": [
                                            {
                                              "type": "listItem",
                                              "position": {
                                                "start": { "line": 688 }
                                              },
                                              "children": [
                                                {
                                                  "type": "paragraph",
                                                  "position": {
                                                    "start": { "line": 688 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 688 }
                                                      },
                                                      "value": "Can output to a collection in the same or different database."
                                                    }
                                                  ]
                                                }
                                              ]
                                            }
                                          ],
                                          "enumtype": "unordered"
                                        }
                                      ]
                                    },
                                    {
                                      "type": "listItem",
                                      "position": { "start": { "line": 688 } },
                                      "children": [
                                        {
                                          "type": "list",
                                          "position": {
                                            "start": { "line": 689 }
                                          },
                                          "children": [
                                            {
                                              "type": "listItem",
                                              "position": {
                                                "start": { "line": 689 }
                                              },
                                              "children": [
                                                {
                                                  "type": "paragraph",
                                                  "position": {
                                                    "start": { "line": 689 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 689 }
                                                      },
                                                      "value": "Can output to a collection in the same or, starting in\nMongoDB 4.4, different database."
                                                    }
                                                  ]
                                                }
                                              ]
                                            }
                                          ],
                                          "enumtype": "unordered"
                                        }
                                      ]
                                    }
                                  ],
                                  "enumtype": "unordered"
                                }
                              ]
                            },
                            {
                              "type": "listItem",
                              "position": { "start": { "line": 685 } },
                              "children": [
                                {
                                  "type": "list",
                                  "position": { "start": { "line": 692 } },
                                  "children": [
                                    {
                                      "type": "listItem",
                                      "position": { "start": { "line": 692 } },
                                      "children": [
                                        {
                                          "type": "list",
                                          "position": {
                                            "start": { "line": 692 }
                                          },
                                          "children": [
                                            {
                                              "type": "listItem",
                                              "position": {
                                                "start": { "line": 692 }
                                              },
                                              "children": [
                                                {
                                                  "type": "paragraph",
                                                  "position": {
                                                    "start": { "line": 692 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 692 }
                                                      },
                                                      "value": "Creates a new collection if the output collection does not\nalready exist."
                                                    }
                                                  ]
                                                }
                                              ]
                                            }
                                          ],
                                          "enumtype": "unordered"
                                        }
                                      ]
                                    },
                                    {
                                      "type": "listItem",
                                      "position": { "start": { "line": 692 } },
                                      "children": [
                                        {
                                          "type": "list",
                                          "position": {
                                            "start": { "line": 695 }
                                          },
                                          "children": [
                                            {
                                              "type": "listItem",
                                              "position": {
                                                "start": { "line": 695 }
                                              },
                                              "children": [
                                                {
                                                  "type": "paragraph",
                                                  "position": {
                                                    "start": { "line": 695 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 695 }
                                                      },
                                                      "value": "Creates a new collection if the output collection does not\nalready exist."
                                                    }
                                                  ]
                                                }
                                              ]
                                            }
                                          ],
                                          "enumtype": "unordered"
                                        }
                                      ]
                                    }
                                  ],
                                  "enumtype": "unordered"
                                }
                              ]
                            },
                            {
                              "type": "listItem",
                              "position": { "start": { "line": 685 } },
                              "children": [
                                {
                                  "type": "list",
                                  "position": { "start": { "line": 698 } },
                                  "children": [
                                    {
                                      "type": "listItem",
                                      "position": { "start": { "line": 698 } },
                                      "children": [
                                        {
                                          "type": "list",
                                          "position": {
                                            "start": { "line": 698 }
                                          },
                                          "children": [
                                            {
                                              "type": "listItem",
                                              "position": {
                                                "start": { "line": 698 }
                                              },
                                              "children": [
                                                {
                                                  "type": "paragraph",
                                                  "position": {
                                                    "start": { "line": 698 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 698 }
                                                      },
                                                      "value": "Can incorporate results (insert new documents, merge\ndocuments, replace documents, keep existing documents, fail\nthe operation, process documents with a custom update pipeline) into\nan existing collection."
                                                    }
                                                  ]
                                                },
                                                {
                                                  "type": "line_block",
                                                  "position": {
                                                    "start": { "line": 698 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "line",
                                                      "position": {
                                                        "start": { "line": 698 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "text",
                                                          "position": {
                                                            "start": {
                                                              "line": 698
                                                            }
                                                          },
                                                          "value": "See also "
                                                        },
                                                        {
                                                          "type": "ref_role",
                                                          "position": {
                                                            "start": {
                                                              "line": 698
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "text",
                                                              "position": {
                                                                "start": {
                                                                  "line": 698
                                                                }
                                                              },
                                                              "value": "Replace Documents ("
                                                            },
                                                            {
                                                              "type": "literal",
                                                              "position": {
                                                                "start": {
                                                                  "line": 698
                                                                }
                                                              },
                                                              "children": [
                                                                {
                                                                  "type": "text",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 698
                                                                    }
                                                                  },
                                                                  "value": "$merge"
                                                                }
                                                              ]
                                                            },
                                                            {
                                                              "type": "text",
                                                              "position": {
                                                                "start": {
                                                                  "line": 698
                                                                }
                                                              },
                                                              "value": ") vs Replace Collection ("
                                                            },
                                                            {
                                                              "type": "literal",
                                                              "position": {
                                                                "start": {
                                                                  "line": 698
                                                                }
                                                              },
                                                              "children": [
                                                                {
                                                                  "type": "text",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 698
                                                                    }
                                                                  },
                                                                  "value": "$out"
                                                                }
                                                              ]
                                                            },
                                                            {
                                                              "type": "text",
                                                              "position": {
                                                                "start": {
                                                                  "line": 698
                                                                }
                                                              },
                                                              "value": ")"
                                                            }
                                                          ],
                                                          "domain": "std",
                                                          "name": "label",
                                                          "target": "merge-behavior-replaceCollection",
                                                          "flag": "",
                                                          "fileid": [
                                                            "reference/operator/aggregation/merge",
                                                            "std-label-merge-behavior-replaceCollection"
                                                          ]
                                                        },
                                                        {
                                                          "type": "text",
                                                          "position": {
                                                            "start": {
                                                              "line": 698
                                                            }
                                                          },
                                                          "value": "."
                                                        }
                                                      ]
                                                    }
                                                  ]
                                                }
                                              ]
                                            }
                                          ],
                                          "enumtype": "unordered"
                                        }
                                      ]
                                    },
                                    {
                                      "type": "listItem",
                                      "position": { "start": { "line": 698 } },
                                      "children": [
                                        {
                                          "type": "list",
                                          "position": {
                                            "start": { "line": 705 }
                                          },
                                          "children": [
                                            {
                                              "type": "listItem",
                                              "position": {
                                                "start": { "line": 705 }
                                              },
                                              "children": [
                                                {
                                                  "type": "paragraph",
                                                  "position": {
                                                    "start": { "line": 705 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 705 }
                                                      },
                                                      "value": "Replaces the output collection completely if it already exists."
                                                    }
                                                  ]
                                                }
                                              ]
                                            }
                                          ],
                                          "enumtype": "unordered"
                                        }
                                      ]
                                    }
                                  ],
                                  "enumtype": "unordered"
                                }
                              ]
                            },
                            {
                              "type": "listItem",
                              "position": { "start": { "line": 685 } },
                              "children": [
                                {
                                  "type": "list",
                                  "position": { "start": { "line": 707 } },
                                  "children": [
                                    {
                                      "type": "listItem",
                                      "position": { "start": { "line": 707 } },
                                      "children": [
                                        {
                                          "type": "list",
                                          "position": {
                                            "start": { "line": 707 }
                                          },
                                          "children": [
                                            {
                                              "type": "listItem",
                                              "position": {
                                                "start": { "line": 707 }
                                              },
                                              "children": [
                                                {
                                                  "type": "paragraph",
                                                  "position": {
                                                    "start": { "line": 707 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 707 }
                                                      },
                                                      "value": "Can output to a sharded collection. Input collection can\nalso be sharded."
                                                    }
                                                  ]
                                                }
                                              ]
                                            }
                                          ],
                                          "enumtype": "unordered"
                                        }
                                      ]
                                    },
                                    {
                                      "type": "listItem",
                                      "position": { "start": { "line": 707 } },
                                      "children": [
                                        {
                                          "type": "list",
                                          "position": {
                                            "start": { "line": 710 }
                                          },
                                          "children": [
                                            {
                                              "type": "listItem",
                                              "position": {
                                                "start": { "line": 710 }
                                              },
                                              "children": [
                                                {
                                                  "type": "paragraph",
                                                  "position": {
                                                    "start": { "line": 710 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 710 }
                                                      },
                                                      "value": "Cannot output to a sharded collection. Input collection,\nhowever, can be sharded."
                                                    }
                                                  ]
                                                }
                                              ]
                                            }
                                          ],
                                          "enumtype": "unordered"
                                        }
                                      ]
                                    }
                                  ],
                                  "enumtype": "unordered"
                                }
                              ]
                            },
                            {
                              "type": "listItem",
                              "position": { "start": { "line": 685 } },
                              "children": [
                                {
                                  "type": "list",
                                  "position": { "start": { "line": 713 } },
                                  "children": [
                                    {
                                      "type": "listItem",
                                      "position": { "start": { "line": 713 } },
                                      "children": [
                                        {
                                          "type": "list",
                                          "position": {
                                            "start": { "line": 713 }
                                          },
                                          "children": [
                                            {
                                              "type": "listItem",
                                              "position": {
                                                "start": { "line": 713 }
                                              },
                                              "children": [
                                                {
                                                  "type": "paragraph",
                                                  "position": {
                                                    "start": { "line": 713 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 713 }
                                                      },
                                                      "value": "Corresponds to SQL statements:"
                                                    }
                                                  ]
                                                },
                                                {
                                                  "type": "list",
                                                  "position": {
                                                    "start": { "line": 715 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "listItem",
                                                      "position": {
                                                        "start": { "line": 715 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "paragraph",
                                                          "position": {
                                                            "start": {
                                                              "line": 715
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "literal",
                                                              "position": {
                                                                "start": {
                                                                  "line": 715
                                                                }
                                                              },
                                                              "children": [
                                                                {
                                                                  "type": "text",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 715
                                                                    }
                                                                  },
                                                                  "value": "MERGE"
                                                                }
                                                              ]
                                                            },
                                                            {
                                                              "type": "text",
                                                              "position": {
                                                                "start": {
                                                                  "line": 715
                                                                }
                                                              },
                                                              "value": "."
                                                            }
                                                          ]
                                                        }
                                                      ]
                                                    },
                                                    {
                                                      "type": "listItem",
                                                      "position": {
                                                        "start": { "line": 715 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "paragraph",
                                                          "position": {
                                                            "start": {
                                                              "line": 717
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "literal",
                                                              "position": {
                                                                "start": {
                                                                  "line": 717
                                                                }
                                                              },
                                                              "children": [
                                                                {
                                                                  "type": "text",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 717
                                                                    }
                                                                  },
                                                                  "value": "INSERT INTO T2 SELECT FROM T1"
                                                                }
                                                              ]
                                                            },
                                                            {
                                                              "type": "text",
                                                              "position": {
                                                                "start": {
                                                                  "line": 717
                                                                }
                                                              },
                                                              "value": "."
                                                            }
                                                          ]
                                                        }
                                                      ]
                                                    },
                                                    {
                                                      "type": "listItem",
                                                      "position": {
                                                        "start": { "line": 715 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "paragraph",
                                                          "position": {
                                                            "start": {
                                                              "line": 719
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "literal",
                                                              "position": {
                                                                "start": {
                                                                  "line": 719
                                                                }
                                                              },
                                                              "children": [
                                                                {
                                                                  "type": "text",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 719
                                                                    }
                                                                  },
                                                                  "value": "SELECT INTO T2 FROM T1"
                                                                }
                                                              ]
                                                            },
                                                            {
                                                              "type": "text",
                                                              "position": {
                                                                "start": {
                                                                  "line": 719
                                                                }
                                                              },
                                                              "value": "."
                                                            }
                                                          ]
                                                        }
                                                      ]
                                                    },
                                                    {
                                                      "type": "listItem",
                                                      "position": {
                                                        "start": { "line": 715 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "paragraph",
                                                          "position": {
                                                            "start": {
                                                              "line": 721
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "text",
                                                              "position": {
                                                                "start": {
                                                                  "line": 721
                                                                }
                                                              },
                                                              "value": "Create/Refresh Materialized Views."
                                                            }
                                                          ]
                                                        }
                                                      ]
                                                    }
                                                  ],
                                                  "enumtype": "unordered"
                                                }
                                              ]
                                            }
                                          ],
                                          "enumtype": "unordered"
                                        }
                                      ]
                                    },
                                    {
                                      "type": "listItem",
                                      "position": { "start": { "line": 713 } },
                                      "children": [
                                        {
                                          "type": "list",
                                          "position": {
                                            "start": { "line": 723 }
                                          },
                                          "children": [
                                            {
                                              "type": "listItem",
                                              "position": {
                                                "start": { "line": 723 }
                                              },
                                              "children": [
                                                {
                                                  "type": "paragraph",
                                                  "position": {
                                                    "start": { "line": 723 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 723 }
                                                      },
                                                      "value": "Corresponds to SQL statement:"
                                                    }
                                                  ]
                                                },
                                                {
                                                  "type": "list",
                                                  "position": {
                                                    "start": { "line": 725 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "listItem",
                                                      "position": {
                                                        "start": { "line": 725 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "paragraph",
                                                          "position": {
                                                            "start": {
                                                              "line": 725
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "literal",
                                                              "position": {
                                                                "start": {
                                                                  "line": 725
                                                                }
                                                              },
                                                              "children": [
                                                                {
                                                                  "type": "text",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 725
                                                                    }
                                                                  },
                                                                  "value": "INSERT INTO T2 SELECT FROM T1"
                                                                }
                                                              ]
                                                            },
                                                            {
                                                              "type": "text",
                                                              "position": {
                                                                "start": {
                                                                  "line": 725
                                                                }
                                                              },
                                                              "value": "."
                                                            }
                                                          ]
                                                        }
                                                      ]
                                                    },
                                                    {
                                                      "type": "listItem",
                                                      "position": {
                                                        "start": { "line": 725 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "paragraph",
                                                          "position": {
                                                            "start": {
                                                              "line": 727
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "literal",
                                                              "position": {
                                                                "start": {
                                                                  "line": 727
                                                                }
                                                              },
                                                              "children": [
                                                                {
                                                                  "type": "text",
                                                                  "position": {
                                                                    "start": {
                                                                      "line": 727
                                                                    }
                                                                  },
                                                                  "value": "SELECT INTO T2 FROM T1"
                                                                }
                                                              ]
                                                            },
                                                            {
                                                              "type": "text",
                                                              "position": {
                                                                "start": {
                                                                  "line": 727
                                                                }
                                                              },
                                                              "value": "."
                                                            }
                                                          ]
                                                        }
                                                      ]
                                                    }
                                                  ],
                                                  "enumtype": "unordered"
                                                }
                                              ]
                                            }
                                          ],
                                          "enumtype": "unordered"
                                        }
                                      ]
                                    }
                                  ],
                                  "enumtype": "unordered"
                                }
                              ]
                            }
                          ],
                          "enumtype": "unordered"
                        }
                      ],
                      "domain": "",
                      "name": "list-table",
                      "argument": [],
                      "options": { "header-rows": 1, "class": "border-table" }
                    },
                    {
                      "type": "target",
                      "position": { "start": { "line": 729 } },
                      "children": [
                        {
                          "type": "target_identifier",
                          "position": { "start": { "line": 729 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 732 } },
                              "value": "Output to the Same Collection that is Being Aggregated"
                            }
                          ],
                          "ids": ["merge-behavior-same-collection"]
                        }
                      ],
                      "domain": "std",
                      "name": "label",
                      "html_id": "std-label-merge-behavior-same-collection"
                    }
                  ]
                },
                {
                  "type": "section",
                  "position": { "start": { "line": 732 } },
                  "children": [
                    {
                      "type": "heading",
                      "position": { "start": { "line": 732 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 732 } },
                          "value": "Output to the Same Collection that is Being Aggregated"
                        }
                      ],
                      "id": "output-to-the-same-collection-that-is-being-aggregated"
                    },
                    {
                      "type": "directive",
                      "position": { "start": { "line": 734 } },
                      "children": [
                        {
                          "type": "root",
                          "position": { "start": { "line": 0 } },
                          "children": [
                            {
                              "type": "directive",
                              "position": { "start": { "line": 0 } },
                              "children": [
                                {
                                  "type": "paragraph",
                                  "position": { "start": { "line": 2 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 2 } },
                                      "value": "When "
                                    },
                                    {
                                      "type": "ref_role",
                                      "position": { "start": { "line": 2 } },
                                      "children": [
                                        {
                                          "type": "literal",
                                          "position": {
                                            "start": { "line": 2 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 2 }
                                              },
                                              "value": "$merge"
                                            }
                                          ]
                                        }
                                      ],
                                      "domain": "mongodb",
                                      "name": "pipeline",
                                      "target": "pipe.$merge",
                                      "flag": "",
                                      "fileid": [
                                        "reference/operator/aggregation/merge",
                                        "mongodb-pipeline-pipe.-merge"
                                      ]
                                    },
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 2 } },
                                      "value": " outputs to the same collection that is being\naggregated, documents may get updated multiple times or the operation\nmay result in an infinite loop. This behavior occurs when the update\nperformed by "
                                    },
                                    {
                                      "type": "ref_role",
                                      "position": { "start": { "line": 2 } },
                                      "children": [
                                        {
                                          "type": "literal",
                                          "position": {
                                            "start": { "line": 2 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 2 }
                                              },
                                              "value": "$merge"
                                            }
                                          ]
                                        }
                                      ],
                                      "domain": "mongodb",
                                      "name": "pipeline",
                                      "target": "pipe.$merge",
                                      "flag": "",
                                      "fileid": [
                                        "reference/operator/aggregation/merge",
                                        "mongodb-pipeline-pipe.-merge"
                                      ]
                                    },
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 2 } },
                                      "value": " changes the physical location of\ndocuments stored on disk. When the physical location of a document\nchanges, "
                                    },
                                    {
                                      "type": "ref_role",
                                      "position": { "start": { "line": 2 } },
                                      "children": [
                                        {
                                          "type": "literal",
                                          "position": {
                                            "start": { "line": 2 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 2 }
                                              },
                                              "value": "$merge"
                                            }
                                          ]
                                        }
                                      ],
                                      "domain": "mongodb",
                                      "name": "pipeline",
                                      "target": "pipe.$merge",
                                      "flag": "",
                                      "fileid": [
                                        "reference/operator/aggregation/merge",
                                        "mongodb-pipeline-pipe.-merge"
                                      ]
                                    },
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 2 } },
                                      "value": " may view it as an entirely new document,\nresulting in additional updates. For more information on this\nbehavior, see "
                                    },
                                    {
                                      "type": "reference",
                                      "position": { "start": { "line": 2 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 2 }
                                          },
                                          "value": "Halloween Problem"
                                        }
                                      ],
                                      "refuri": "https://en.wikipedia.org/wiki/Halloween_Problem"
                                    },
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 2 } },
                                      "value": "."
                                    }
                                  ]
                                }
                              ],
                              "domain": "",
                              "name": "warning",
                              "argument": []
                            }
                          ],
                          "fileid": "includes/fact-merge-same-collection-warning.rst"
                        }
                      ],
                      "domain": "",
                      "name": "include",
                      "argument": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 734 } },
                          "value": "/includes/fact-merge-same-collection-warning.rst"
                        }
                      ]
                    },
                    {
                      "type": "directive",
                      "position": { "start": { "line": 736 } },
                      "children": [
                        {
                          "type": "root",
                          "position": { "start": { "line": 0 } },
                          "children": [
                            {
                              "type": "paragraph",
                              "position": { "start": { "line": 0 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 0 } },
                                  "value": "Starting in MongoDB 4.4, "
                                },
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 0 } },
                                  "children": [
                                    {
                                      "type": "literal",
                                      "position": { "start": { "line": 0 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 0 }
                                          },
                                          "value": "$merge"
                                        }
                                      ]
                                    }
                                  ],
                                  "domain": "mongodb",
                                  "name": "pipeline",
                                  "target": "pipe.$merge",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/merge",
                                    "mongodb-pipeline-pipe.-merge"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 0 } },
                                  "value": " can output to the same\ncollection that is being aggregated. You can also output to a\ncollection which appears in other stages of the pipeline, such as\n"
                                },
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 0 } },
                                  "children": [
                                    {
                                      "type": "literal",
                                      "position": { "start": { "line": 0 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 0 }
                                          },
                                          "value": "$lookup"
                                        }
                                      ]
                                    }
                                  ],
                                  "domain": "mongodb",
                                  "name": "pipeline",
                                  "target": "pipe.$lookup",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/lookup",
                                    "mongodb-pipeline-pipe.-lookup"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 0 } },
                                  "value": "."
                                }
                              ]
                            },
                            {
                              "type": "paragraph",
                              "position": { "start": { "line": 5 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 5 } },
                                  "value": "Versions of MongoDB prior to 4.4 did not allow "
                                },
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 5 } },
                                  "children": [
                                    {
                                      "type": "literal",
                                      "position": { "start": { "line": 5 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 5 }
                                          },
                                          "value": "$merge"
                                        }
                                      ]
                                    }
                                  ],
                                  "domain": "mongodb",
                                  "name": "pipeline",
                                  "target": "pipe.$merge",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/merge",
                                    "mongodb-pipeline-pipe.-merge"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 5 } },
                                  "value": " to\noutput to the same collection as the collection being aggregated."
                                }
                              ]
                            }
                          ],
                          "fileid": "includes/fact-merge-same-collection-behavior.rst"
                        }
                      ],
                      "domain": "",
                      "name": "include",
                      "argument": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 736 } },
                          "value": "/includes/fact-merge-same-collection-behavior.rst"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "section",
              "position": { "start": { "line": 739 } },
              "children": [
                {
                  "type": "heading",
                  "position": { "start": { "line": 739 } },
                  "children": [
                    {
                      "type": "text",
                      "position": { "start": { "line": 739 } },
                      "value": "Restrictions"
                    }
                  ],
                  "id": "restrictions"
                },
                {
                  "type": "directive",
                  "position": { "start": { "line": 741 } },
                  "children": [
                    {
                      "type": "list",
                      "position": { "start": { "line": 745 } },
                      "children": [
                        {
                          "type": "listItem",
                          "position": { "start": { "line": 745 } },
                          "children": [
                            {
                              "type": "list",
                              "position": { "start": { "line": 745 } },
                              "children": [
                                {
                                  "type": "listItem",
                                  "position": { "start": { "line": 745 } },
                                  "children": [
                                    {
                                      "type": "paragraph",
                                      "position": { "start": { "line": 745 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 745 }
                                          },
                                          "value": "Restrictions"
                                        }
                                      ]
                                    }
                                  ]
                                },
                                {
                                  "type": "listItem",
                                  "position": { "start": { "line": 745 } },
                                  "children": [
                                    {
                                      "type": "paragraph",
                                      "position": { "start": { "line": 746 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 746 }
                                          },
                                          "value": "Description"
                                        }
                                      ]
                                    }
                                  ]
                                }
                              ],
                              "enumtype": "unordered"
                            }
                          ]
                        },
                        {
                          "type": "listItem",
                          "position": { "start": { "line": 745 } },
                          "children": [
                            {
                              "type": "list",
                              "position": { "start": { "line": 748 } },
                              "children": [
                                {
                                  "type": "listItem",
                                  "position": { "start": { "line": 748 } },
                                  "children": [
                                    {
                                      "type": "paragraph",
                                      "position": { "start": { "line": 748 } },
                                      "children": [
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 748 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 748 }
                                              },
                                              "value": "Transactions"
                                            }
                                          ],
                                          "domain": "std",
                                          "name": "doc",
                                          "target": "",
                                          "flag": "",
                                          "fileid": ["/core/transactions", ""]
                                        }
                                      ]
                                    }
                                  ]
                                },
                                {
                                  "type": "listItem",
                                  "position": { "start": { "line": 748 } },
                                  "children": [
                                    {
                                      "type": "paragraph",
                                      "position": { "start": { "line": 750 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 750 }
                                          },
                                          "value": "An aggregation pipeline cannot use "
                                        },
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 750 }
                                          },
                                          "children": [
                                            {
                                              "type": "literal",
                                              "position": {
                                                "start": { "line": 750 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 750 }
                                                  },
                                                  "value": "$merge"
                                                }
                                              ]
                                            }
                                          ],
                                          "domain": "mongodb",
                                          "name": "pipeline",
                                          "target": "pipe.$merge",
                                          "flag": "",
                                          "fileid": [
                                            "reference/operator/aggregation/merge",
                                            "mongodb-pipeline-pipe.-merge"
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 750 }
                                          },
                                          "value": " inside a\n"
                                        },
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 750 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 750 }
                                              },
                                              "value": "transaction"
                                            }
                                          ],
                                          "domain": "std",
                                          "name": "label",
                                          "target": "transactions-operations-crud",
                                          "flag": "",
                                          "fileid": [
                                            "core/transactions-operations",
                                            "std-label-transactions-operations-crud"
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 750 }
                                          },
                                          "value": "."
                                        }
                                      ]
                                    }
                                  ]
                                }
                              ],
                              "enumtype": "unordered"
                            }
                          ]
                        },
                        {
                          "type": "listItem",
                          "position": { "start": { "line": 745 } },
                          "children": [
                            {
                              "type": "list",
                              "position": { "start": { "line": 753 } },
                              "children": [
                                {
                                  "type": "listItem",
                                  "position": { "start": { "line": 753 } },
                                  "children": [
                                    {
                                      "type": "paragraph",
                                      "position": { "start": { "line": 753 } },
                                      "children": [
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 753 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 753 }
                                              },
                                              "value": "Time Series Collections"
                                            }
                                          ],
                                          "domain": "std",
                                          "name": "doc",
                                          "target": "",
                                          "flag": "",
                                          "fileid": [
                                            "/core/timeseries-collections",
                                            ""
                                          ]
                                        }
                                      ]
                                    }
                                  ]
                                },
                                {
                                  "type": "listItem",
                                  "position": { "start": { "line": 753 } },
                                  "children": [
                                    {
                                      "type": "paragraph",
                                      "position": { "start": { "line": 755 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 755 }
                                          },
                                          "value": "An aggregation pipeline cannot use "
                                        },
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 755 }
                                          },
                                          "children": [
                                            {
                                              "type": "literal",
                                              "position": {
                                                "start": { "line": 755 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 755 }
                                                  },
                                                  "value": "$merge"
                                                }
                                              ]
                                            }
                                          ],
                                          "domain": "mongodb",
                                          "name": "pipeline",
                                          "target": "pipe.$merge",
                                          "flag": "",
                                          "fileid": [
                                            "reference/operator/aggregation/merge",
                                            "mongodb-pipeline-pipe.-merge"
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 755 }
                                          },
                                          "value": " to output to\na time series collection."
                                        }
                                      ]
                                    }
                                  ]
                                }
                              ],
                              "enumtype": "unordered"
                            }
                          ]
                        },
                        {
                          "type": "listItem",
                          "position": { "start": { "line": 745 } },
                          "children": [
                            {
                              "type": "list",
                              "position": { "start": { "line": 758 } },
                              "children": [
                                {
                                  "type": "listItem",
                                  "position": { "start": { "line": 758 } },
                                  "children": [
                                    {
                                      "type": "line_block",
                                      "position": { "start": { "line": 758 } },
                                      "children": [
                                        {
                                          "type": "line",
                                          "position": {
                                            "start": { "line": 758 }
                                          },
                                          "children": [
                                            {
                                              "type": "ref_role",
                                              "position": {
                                                "start": { "line": 758 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 758 }
                                                  },
                                                  "value": "View definition"
                                                }
                                              ],
                                              "domain": "std",
                                              "name": "doc",
                                              "target": "",
                                              "flag": "",
                                              "fileid": ["/core/views", ""]
                                            }
                                          ]
                                        },
                                        {
                                          "type": "line",
                                          "position": {
                                            "start": { "line": 758 }
                                          },
                                          "children": [
                                            {
                                              "type": "emphasis",
                                              "position": {
                                                "start": { "line": 758 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 758 }
                                                  },
                                                  "value": "Separate from materialized view"
                                                }
                                              ]
                                            }
                                          ]
                                        }
                                      ]
                                    }
                                  ]
                                },
                                {
                                  "type": "listItem",
                                  "position": { "start": { "line": 758 } },
                                  "children": [
                                    {
                                      "type": "paragraph",
                                      "position": { "start": { "line": 761 } },
                                      "children": [
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 761 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 761 }
                                              },
                                              "value": "View definition"
                                            }
                                          ],
                                          "domain": "std",
                                          "name": "doc",
                                          "target": "",
                                          "flag": "",
                                          "fileid": ["/core/views", ""]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 761 }
                                          },
                                          "value": " cannot include the\n"
                                        },
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 761 }
                                          },
                                          "children": [
                                            {
                                              "type": "literal",
                                              "position": {
                                                "start": { "line": 761 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 761 }
                                                  },
                                                  "value": "$merge"
                                                }
                                              ]
                                            }
                                          ],
                                          "domain": "mongodb",
                                          "name": "pipeline",
                                          "target": "pipe.$merge",
                                          "flag": "",
                                          "fileid": [
                                            "reference/operator/aggregation/merge",
                                            "mongodb-pipeline-pipe.-merge"
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 761 }
                                          },
                                          "value": " stage. If the view definition includes nested\npipeline (for example, the view definition includes\n"
                                        },
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 761 }
                                          },
                                          "children": [
                                            {
                                              "type": "literal",
                                              "position": {
                                                "start": { "line": 761 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 761 }
                                                  },
                                                  "value": "$facet"
                                                }
                                              ]
                                            }
                                          ],
                                          "domain": "mongodb",
                                          "name": "pipeline",
                                          "target": "pipe.$facet",
                                          "flag": "",
                                          "fileid": [
                                            "reference/operator/aggregation/facet",
                                            "mongodb-pipeline-pipe.-facet"
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 761 }
                                          },
                                          "value": " stage), this "
                                        },
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 761 }
                                          },
                                          "children": [
                                            {
                                              "type": "literal",
                                              "position": {
                                                "start": { "line": 761 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 761 }
                                                  },
                                                  "value": "$merge"
                                                }
                                              ]
                                            }
                                          ],
                                          "domain": "mongodb",
                                          "name": "pipeline",
                                          "target": "pipe.$merge",
                                          "flag": "",
                                          "fileid": [
                                            "reference/operator/aggregation/merge",
                                            "mongodb-pipeline-pipe.-merge"
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 761 }
                                          },
                                          "value": " stage\nrestriction applies to the nested pipelines as well."
                                        }
                                      ]
                                    }
                                  ]
                                }
                              ],
                              "enumtype": "unordered"
                            }
                          ]
                        },
                        {
                          "type": "listItem",
                          "position": { "start": { "line": 745 } },
                          "children": [
                            {
                              "type": "list",
                              "position": { "start": { "line": 767 } },
                              "children": [
                                {
                                  "type": "listItem",
                                  "position": { "start": { "line": 767 } },
                                  "children": [
                                    {
                                      "type": "paragraph",
                                      "position": { "start": { "line": 767 } },
                                      "children": [
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 767 }
                                          },
                                          "children": [
                                            {
                                              "type": "literal",
                                              "position": {
                                                "start": { "line": 767 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 767 }
                                                  },
                                                  "value": "$lookup"
                                                }
                                              ]
                                            }
                                          ],
                                          "domain": "mongodb",
                                          "name": "pipeline",
                                          "target": "pipe.$lookup",
                                          "flag": "",
                                          "fileid": [
                                            "reference/operator/aggregation/lookup",
                                            "mongodb-pipeline-pipe.-lookup"
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 767 }
                                          },
                                          "value": " stage"
                                        }
                                      ]
                                    }
                                  ]
                                },
                                {
                                  "type": "listItem",
                                  "position": { "start": { "line": 767 } },
                                  "children": [
                                    {
                                      "type": "paragraph",
                                      "position": { "start": { "line": 769 } },
                                      "children": [
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 769 }
                                          },
                                          "children": [
                                            {
                                              "type": "literal",
                                              "position": {
                                                "start": { "line": 769 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 769 }
                                                  },
                                                  "value": "$lookup"
                                                }
                                              ]
                                            }
                                          ],
                                          "domain": "mongodb",
                                          "name": "pipeline",
                                          "target": "pipe.$lookup",
                                          "flag": "",
                                          "fileid": [
                                            "reference/operator/aggregation/lookup",
                                            "mongodb-pipeline-pipe.-lookup"
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 769 }
                                          },
                                          "value": " stage's "
                                        },
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 769 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 769 }
                                              },
                                              "value": "nested pipeline"
                                            }
                                          ],
                                          "domain": "std",
                                          "name": "label",
                                          "target": "lookup-syntax-let-pipeline",
                                          "flag": "",
                                          "fileid": [
                                            "reference/operator/aggregation/lookup",
                                            "std-label-lookup-syntax-let-pipeline"
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 769 }
                                          },
                                          "value": " cannot include the\n"
                                        },
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 769 }
                                          },
                                          "children": [
                                            {
                                              "type": "literal",
                                              "position": {
                                                "start": { "line": 769 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 769 }
                                                  },
                                                  "value": "$merge"
                                                }
                                              ]
                                            }
                                          ],
                                          "domain": "mongodb",
                                          "name": "pipeline",
                                          "target": "pipe.$merge",
                                          "flag": "",
                                          "fileid": [
                                            "reference/operator/aggregation/merge",
                                            "mongodb-pipeline-pipe.-merge"
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 769 }
                                          },
                                          "value": " stage."
                                        }
                                      ]
                                    }
                                  ]
                                }
                              ],
                              "enumtype": "unordered"
                            }
                          ]
                        },
                        {
                          "type": "listItem",
                          "position": { "start": { "line": 745 } },
                          "children": [
                            {
                              "type": "list",
                              "position": { "start": { "line": 773 } },
                              "children": [
                                {
                                  "type": "listItem",
                                  "position": { "start": { "line": 773 } },
                                  "children": [
                                    {
                                      "type": "paragraph",
                                      "position": { "start": { "line": 773 } },
                                      "children": [
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 773 }
                                          },
                                          "children": [
                                            {
                                              "type": "literal",
                                              "position": {
                                                "start": { "line": 773 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 773 }
                                                  },
                                                  "value": "$facet"
                                                }
                                              ]
                                            }
                                          ],
                                          "domain": "mongodb",
                                          "name": "pipeline",
                                          "target": "pipe.$facet",
                                          "flag": "",
                                          "fileid": [
                                            "reference/operator/aggregation/facet",
                                            "mongodb-pipeline-pipe.-facet"
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 773 }
                                          },
                                          "value": " stage"
                                        }
                                      ]
                                    }
                                  ]
                                },
                                {
                                  "type": "listItem",
                                  "position": { "start": { "line": 773 } },
                                  "children": [
                                    {
                                      "type": "paragraph",
                                      "position": { "start": { "line": 775 } },
                                      "children": [
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 775 }
                                          },
                                          "children": [
                                            {
                                              "type": "literal",
                                              "position": {
                                                "start": { "line": 775 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 775 }
                                                  },
                                                  "value": "$facet"
                                                }
                                              ]
                                            }
                                          ],
                                          "domain": "mongodb",
                                          "name": "pipeline",
                                          "target": "pipe.$facet",
                                          "flag": "",
                                          "fileid": [
                                            "reference/operator/aggregation/facet",
                                            "mongodb-pipeline-pipe.-facet"
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 775 }
                                          },
                                          "value": " stage's "
                                        },
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 775 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 775 }
                                              },
                                              "value": "nested pipeline"
                                            }
                                          ],
                                          "domain": "std",
                                          "name": "label",
                                          "target": "lookup-syntax-let-pipeline",
                                          "flag": "",
                                          "fileid": [
                                            "reference/operator/aggregation/lookup",
                                            "std-label-lookup-syntax-let-pipeline"
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 775 }
                                          },
                                          "value": " cannot include the\n"
                                        },
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 775 }
                                          },
                                          "children": [
                                            {
                                              "type": "literal",
                                              "position": {
                                                "start": { "line": 775 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 775 }
                                                  },
                                                  "value": "$merge"
                                                }
                                              ]
                                            }
                                          ],
                                          "domain": "mongodb",
                                          "name": "pipeline",
                                          "target": "pipe.$merge",
                                          "flag": "",
                                          "fileid": [
                                            "reference/operator/aggregation/merge",
                                            "mongodb-pipeline-pipe.-merge"
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 775 }
                                          },
                                          "value": " stage."
                                        }
                                      ]
                                    }
                                  ]
                                }
                              ],
                              "enumtype": "unordered"
                            }
                          ]
                        },
                        {
                          "type": "listItem",
                          "position": { "start": { "line": 745 } },
                          "children": [
                            {
                              "type": "list",
                              "position": { "start": { "line": 779 } },
                              "children": [
                                {
                                  "type": "listItem",
                                  "position": { "start": { "line": 779 } },
                                  "children": [
                                    {
                                      "type": "paragraph",
                                      "position": { "start": { "line": 779 } },
                                      "children": [
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 779 }
                                          },
                                          "children": [
                                            {
                                              "type": "literal",
                                              "position": {
                                                "start": { "line": 779 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 779 }
                                                  },
                                                  "value": "$unionWith"
                                                }
                                              ]
                                            }
                                          ],
                                          "domain": "mongodb",
                                          "name": "pipeline",
                                          "target": "pipe.$unionWith",
                                          "flag": "",
                                          "fileid": [
                                            "reference/operator/aggregation/unionWith",
                                            "mongodb-pipeline-pipe.-unionWith"
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 779 }
                                          },
                                          "value": " stage"
                                        }
                                      ]
                                    }
                                  ]
                                },
                                {
                                  "type": "listItem",
                                  "position": { "start": { "line": 779 } },
                                  "children": [
                                    {
                                      "type": "paragraph",
                                      "position": { "start": { "line": 781 } },
                                      "children": [
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 781 }
                                          },
                                          "children": [
                                            {
                                              "type": "literal",
                                              "position": {
                                                "start": { "line": 781 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 781 }
                                                  },
                                                  "value": "$unionWith"
                                                }
                                              ]
                                            }
                                          ],
                                          "domain": "mongodb",
                                          "name": "pipeline",
                                          "target": "pipe.$unionWith",
                                          "flag": "",
                                          "fileid": [
                                            "reference/operator/aggregation/unionWith",
                                            "mongodb-pipeline-pipe.-unionWith"
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 781 }
                                          },
                                          "value": " stage's "
                                        },
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 781 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 781 }
                                              },
                                              "value": "nested pipeline"
                                            }
                                          ],
                                          "domain": "std",
                                          "name": "label",
                                          "target": "unionWith-pipeline",
                                          "flag": "",
                                          "fileid": [
                                            "reference/operator/aggregation/unionWith",
                                            "std-label-unionWith-pipeline"
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 781 }
                                          },
                                          "value": " cannot include the\n"
                                        },
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 781 }
                                          },
                                          "children": [
                                            {
                                              "type": "literal",
                                              "position": {
                                                "start": { "line": 781 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 781 }
                                                  },
                                                  "value": "$merge"
                                                }
                                              ]
                                            }
                                          ],
                                          "domain": "mongodb",
                                          "name": "pipeline",
                                          "target": "pipe.$merge",
                                          "flag": "",
                                          "fileid": [
                                            "reference/operator/aggregation/merge",
                                            "mongodb-pipeline-pipe.-merge"
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 781 }
                                          },
                                          "value": " stage."
                                        }
                                      ]
                                    }
                                  ]
                                }
                              ],
                              "enumtype": "unordered"
                            }
                          ]
                        },
                        {
                          "type": "listItem",
                          "position": { "start": { "line": 745 } },
                          "children": [
                            {
                              "type": "list",
                              "position": { "start": { "line": 785 } },
                              "children": [
                                {
                                  "type": "listItem",
                                  "position": { "start": { "line": 785 } },
                                  "children": [
                                    {
                                      "type": "paragraph",
                                      "position": { "start": { "line": 785 } },
                                      "children": [
                                        {
                                          "type": "ref_role",
                                          "position": {
                                            "start": { "line": 785 }
                                          },
                                          "children": [
                                            {
                                              "type": "literal",
                                              "position": {
                                                "start": { "line": 785 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 785 }
                                                  },
                                                  "value": "\"linearizable\""
                                                }
                                              ]
                                            }
                                          ],
                                          "domain": "mongodb",
                                          "name": "readconcern",
                                          "target": "readconcern.\"linearizable\"",
                                          "flag": "",
                                          "fileid": [
                                            "reference/read-concern-linearizable",
                                            "mongodb-readconcern-readconcern.-linearizable-"
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 785 }
                                          },
                                          "value": " read concern"
                                        }
                                      ]
                                    }
                                  ]
                                },
                                {
                                  "type": "listItem",
                                  "position": { "start": { "line": 785 } },
                                  "children": [
                                    {
                                      "type": "directive",
                                      "position": { "start": { "line": 787 } },
                                      "children": [
                                        {
                                          "type": "root",
                                          "position": {
                                            "start": { "line": 0 }
                                          },
                                          "children": [
                                            {
                                              "type": "directive",
                                              "position": {
                                                "start": { "line": 0 }
                                              },
                                              "children": [
                                                {
                                                  "type": "paragraph",
                                                  "position": {
                                                    "start": { "line": 0 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 0 }
                                                      },
                                                      "value": "The "
                                                    },
                                                    {
                                                      "type": "ref_role",
                                                      "position": {
                                                        "start": { "line": 0 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "literal",
                                                          "position": {
                                                            "start": {
                                                              "line": 0
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "text",
                                                              "position": {
                                                                "start": {
                                                                  "line": 0
                                                                }
                                                              },
                                                              "value": "$merge"
                                                            }
                                                          ]
                                                        }
                                                      ],
                                                      "domain": "mongodb",
                                                      "name": "pipeline",
                                                      "target": "pipe.$merge",
                                                      "flag": "",
                                                      "fileid": [
                                                        "reference/operator/aggregation/merge",
                                                        "mongodb-pipeline-pipe.-merge"
                                                      ]
                                                    },
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 0 }
                                                      },
                                                      "value": " stage cannot be used in conjunction with read\nconcern "
                                                    },
                                                    {
                                                      "type": "ref_role",
                                                      "position": {
                                                        "start": { "line": 0 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "literal",
                                                          "position": {
                                                            "start": {
                                                              "line": 0
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "text",
                                                              "position": {
                                                                "start": {
                                                                  "line": 0
                                                                }
                                                              },
                                                              "value": "\"linearizable\""
                                                            }
                                                          ]
                                                        }
                                                      ],
                                                      "domain": "mongodb",
                                                      "name": "readconcern",
                                                      "target": "readconcern.\"linearizable\"",
                                                      "flag": "",
                                                      "fileid": [
                                                        "reference/read-concern-linearizable",
                                                        "mongodb-readconcern-readconcern.-linearizable-"
                                                      ]
                                                    },
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 0 }
                                                      },
                                                      "value": ". That is, if you specify\n"
                                                    },
                                                    {
                                                      "type": "ref_role",
                                                      "position": {
                                                        "start": { "line": 0 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "literal",
                                                          "position": {
                                                            "start": {
                                                              "line": 0
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "text",
                                                              "position": {
                                                                "start": {
                                                                  "line": 0
                                                                }
                                                              },
                                                              "value": "\"linearizable\""
                                                            }
                                                          ]
                                                        }
                                                      ],
                                                      "domain": "mongodb",
                                                      "name": "readconcern",
                                                      "target": "readconcern.\"linearizable\"",
                                                      "flag": "",
                                                      "fileid": [
                                                        "reference/read-concern-linearizable",
                                                        "mongodb-readconcern-readconcern.-linearizable-"
                                                      ]
                                                    },
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 0 }
                                                      },
                                                      "value": " read concern for\n"
                                                    },
                                                    {
                                                      "type": "ref_role",
                                                      "position": {
                                                        "start": { "line": 0 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "literal",
                                                          "position": {
                                                            "start": {
                                                              "line": 0
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "text",
                                                              "position": {
                                                                "start": {
                                                                  "line": 0
                                                                }
                                                              },
                                                              "value": "db.collection.aggregate()"
                                                            }
                                                          ]
                                                        }
                                                      ],
                                                      "domain": "mongodb",
                                                      "name": "method",
                                                      "target": "db.collection.aggregate",
                                                      "flag": "",
                                                      "fileid": [
                                                        "reference/method/db.collection.aggregate",
                                                        "mongodb-method-db.collection.aggregate"
                                                      ]
                                                    },
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 0 }
                                                      },
                                                      "value": ", you cannot include the\n"
                                                    },
                                                    {
                                                      "type": "ref_role",
                                                      "position": {
                                                        "start": { "line": 0 }
                                                      },
                                                      "children": [
                                                        {
                                                          "type": "literal",
                                                          "position": {
                                                            "start": {
                                                              "line": 0
                                                            }
                                                          },
                                                          "children": [
                                                            {
                                                              "type": "text",
                                                              "position": {
                                                                "start": {
                                                                  "line": 0
                                                                }
                                                              },
                                                              "value": "$merge"
                                                            }
                                                          ]
                                                        }
                                                      ],
                                                      "domain": "mongodb",
                                                      "name": "pipeline",
                                                      "target": "pipe.$merge",
                                                      "flag": "",
                                                      "fileid": [
                                                        "reference/operator/aggregation/merge",
                                                        "mongodb-pipeline-pipe.-merge"
                                                      ]
                                                    },
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": { "line": 0 }
                                                      },
                                                      "value": " stage in the pipeline."
                                                    }
                                                  ]
                                                }
                                              ],
                                              "domain": "",
                                              "name": "extract",
                                              "argument": []
                                            }
                                          ],
                                          "fileid": "includes/extracts-4.2-changes.yaml"
                                        }
                                      ],
                                      "domain": "",
                                      "name": "include",
                                      "argument": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 787 }
                                          },
                                          "value": "/includes/extracts/4.2-changes-linearizable-merge-restriction.rst"
                                        }
                                      ]
                                    }
                                  ]
                                }
                              ],
                              "enumtype": "unordered"
                            }
                          ]
                        }
                      ],
                      "enumtype": "unordered"
                    }
                  ],
                  "domain": "",
                  "name": "list-table",
                  "argument": [],
                  "options": { "header-rows": 1, "widths": "30 70" }
                },
                {
                  "type": "target",
                  "position": { "start": { "line": 789 } },
                  "children": [
                    {
                      "type": "target_identifier",
                      "position": { "start": { "line": 789 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 792 } },
                          "value": "Examples"
                        }
                      ],
                      "ids": ["merge-examples"]
                    }
                  ],
                  "domain": "std",
                  "name": "label",
                  "html_id": "std-label-merge-examples"
                }
              ]
            },
            {
              "type": "section",
              "position": { "start": { "line": 792 } },
              "children": [
                {
                  "type": "heading",
                  "position": { "start": { "line": 792 } },
                  "children": [
                    {
                      "type": "text",
                      "position": { "start": { "line": 792 } },
                      "value": "Examples"
                    }
                  ],
                  "id": "examples"
                },
                {
                  "type": "target",
                  "position": { "start": { "line": 794 } },
                  "children": [
                    {
                      "type": "target_identifier",
                      "position": { "start": { "line": 794 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 797 } },
                          "value": "On-Demand Materialized View: Initial Creation"
                        }
                      ],
                      "ids": ["merge-mat-view-init-creation"]
                    }
                  ],
                  "domain": "std",
                  "name": "label",
                  "html_id": "std-label-merge-mat-view-init-creation"
                },
                {
                  "type": "section",
                  "position": { "start": { "line": 797 } },
                  "children": [
                    {
                      "type": "heading",
                      "position": { "start": { "line": 797 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 797 } },
                          "value": "On-Demand Materialized View: Initial Creation"
                        }
                      ],
                      "id": "on-demand-materialized-view--initial-creation"
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 799 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 799 } },
                          "value": "If the output collection does not exist, the "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 799 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 799 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 799 } },
                                  "value": "$merge"
                                }
                              ]
                            }
                          ],
                          "domain": "mongodb",
                          "name": "pipeline",
                          "target": "pipe.$merge",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "mongodb-pipeline-pipe.-merge"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 799 } },
                          "value": " creates\nthe collection."
                        }
                      ]
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 802 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 802 } },
                          "value": "For example, a collection named "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 802 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 802 } },
                              "value": "salaries"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 802 } },
                          "value": " in the "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 802 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 802 } },
                              "value": "zoo"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 802 } },
                          "value": " database\nis populated with the employee salary and department history:"
                        }
                      ]
                    },
                    {
                      "type": "code",
                      "position": { "start": { "line": 805 } },
                      "lang": "javascript",
                      "copyable": true,
                      "emphasize_lines": [],
                      "value": "db.getSiblingDB(\"zoo\").salaries.insertMany([\n   { \"_id\" : 1, employee: \"Ant\", dept: \"A\", salary: 100000, fiscal_year: 2017 },\n   { \"_id\" : 2, employee: \"Bee\", dept: \"A\", salary: 120000, fiscal_year: 2017 },\n   { \"_id\" : 3, employee: \"Cat\", dept: \"Z\", salary: 115000, fiscal_year: 2017 },\n   { \"_id\" : 4, employee: \"Ant\", dept: \"A\", salary: 115000, fiscal_year: 2018 },\n   { \"_id\" : 5, employee: \"Bee\", dept: \"Z\", salary: 145000, fiscal_year: 2018 },\n   { \"_id\" : 6, employee: \"Cat\", dept: \"Z\", salary: 135000, fiscal_year: 2018 },\n   { \"_id\" : 7, employee: \"Gecko\", dept: \"A\", salary: 100000, fiscal_year: 2018 },\n   { \"_id\" : 8, employee: \"Ant\", dept: \"A\", salary: 125000, fiscal_year: 2019 },\n   { \"_id\" : 9, employee: \"Bee\", dept: \"Z\", salary: 160000, fiscal_year: 2019 },\n   { \"_id\" : 10, employee: \"Cat\", dept: \"Z\", salary: 150000, fiscal_year: 2019 }\n])",
                      "linenos": false
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 820 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 820 } },
                          "value": "You can use the "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 820 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 820 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 820 } },
                                  "value": "$group"
                                }
                              ]
                            }
                          ],
                          "domain": "mongodb",
                          "name": "pipeline",
                          "target": "pipe.$group",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/group",
                            "mongodb-pipeline-pipe.-group"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 820 } },
                          "value": " and "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 820 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 820 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 820 } },
                                  "value": "$merge"
                                }
                              ]
                            }
                          ],
                          "domain": "mongodb",
                          "name": "pipeline",
                          "target": "pipe.$merge",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "mongodb-pipeline-pipe.-merge"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 820 } },
                          "value": " stages to\ninitially create a collection named "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 820 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 820 } },
                              "value": "budgets"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 820 } },
                          "value": " (in the "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 820 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 820 } },
                              "value": "reporting"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 820 } },
                          "value": "\ndatabase) from the data currently in the "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 820 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 820 } },
                              "value": "salaries"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 820 } },
                          "value": " collection:"
                        }
                      ]
                    },
                    {
                      "type": "directive",
                      "position": { "start": { "line": 824 } },
                      "children": [
                        {
                          "type": "paragraph",
                          "position": { "start": { "line": 826 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 826 } },
                              "value": "For a replica set or a standalone deployment, if the output\ndatabase does not exist, "
                            },
                            {
                              "type": "ref_role",
                              "position": { "start": { "line": 826 } },
                              "children": [
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 826 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 826 } },
                                      "value": "$merge"
                                    }
                                  ]
                                }
                              ],
                              "domain": "mongodb",
                              "name": "pipeline",
                              "target": "pipe.$merge",
                              "flag": "",
                              "fileid": [
                                "reference/operator/aggregation/merge",
                                "mongodb-pipeline-pipe.-merge"
                              ]
                            },
                            {
                              "type": "text",
                              "position": { "start": { "line": 826 } },
                              "value": " also creates the\ndatabase."
                            }
                          ]
                        },
                        {
                          "type": "paragraph",
                          "position": { "start": { "line": 830 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 830 } },
                              "value": "For a sharded cluster deployment, the specified output database\nmust already exist."
                            }
                          ]
                        }
                      ],
                      "domain": "",
                      "name": "note",
                      "argument": []
                    },
                    {
                      "type": "code",
                      "position": { "start": { "line": 833 } },
                      "lang": "javascript",
                      "copyable": true,
                      "emphasize_lines": [],
                      "value": "db.getSiblingDB(\"zoo\").salaries.aggregate( [\n   { $group: { _id: { fiscal_year: \"$fiscal_year\", dept: \"$dept\" }, salaries: { $sum: \"$salary\" } } },\n   { $merge : { into: { db: \"reporting\", coll: \"budgets\" }, on: \"_id\",  whenMatched: \"replace\", whenNotMatched: \"insert\" } }\n] )",
                      "linenos": false
                    },
                    {
                      "type": "list",
                      "position": { "start": { "line": 840 } },
                      "children": [
                        {
                          "type": "listItem",
                          "position": { "start": { "line": 840 } },
                          "children": [
                            {
                              "type": "paragraph",
                              "position": { "start": { "line": 840 } },
                              "children": [
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 840 } },
                                  "children": [
                                    {
                                      "type": "literal",
                                      "position": { "start": { "line": 840 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 840 }
                                          },
                                          "value": "$group"
                                        }
                                      ]
                                    }
                                  ],
                                  "domain": "mongodb",
                                  "name": "pipeline",
                                  "target": "pipe.$group",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/group",
                                    "mongodb-pipeline-pipe.-group"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 840 } },
                                  "value": " stage to group the salaries by the "
                                },
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 840 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 840 } },
                                      "value": "fiscal_year"
                                    }
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 840 } },
                                  "value": "\nand "
                                },
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 840 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 840 } },
                                      "value": "dept"
                                    }
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 840 } },
                                  "value": "."
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "type": "listItem",
                          "position": { "start": { "line": 840 } },
                          "children": [
                            {
                              "type": "paragraph",
                              "position": { "start": { "line": 843 } },
                              "children": [
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 843 } },
                                  "children": [
                                    {
                                      "type": "literal",
                                      "position": { "start": { "line": 843 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 843 }
                                          },
                                          "value": "$merge"
                                        }
                                      ]
                                    }
                                  ],
                                  "domain": "mongodb",
                                  "name": "pipeline",
                                  "target": "pipe.$merge",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/merge",
                                    "mongodb-pipeline-pipe.-merge"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 843 } },
                                  "value": " stage writes the output of the preceding\n"
                                },
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 843 } },
                                  "children": [
                                    {
                                      "type": "literal",
                                      "position": { "start": { "line": 843 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 843 }
                                          },
                                          "value": "$group"
                                        }
                                      ]
                                    }
                                  ],
                                  "domain": "mongodb",
                                  "name": "pipeline",
                                  "target": "pipe.$group",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/group",
                                    "mongodb-pipeline-pipe.-group"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 843 } },
                                  "value": " stage to the "
                                },
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 843 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 843 } },
                                      "value": "budgets"
                                    }
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 843 } },
                                  "value": " collection in the\n"
                                },
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 843 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 843 } },
                                      "value": "reporting"
                                    }
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 843 } },
                                  "value": " database."
                                }
                              ]
                            }
                          ]
                        }
                      ],
                      "enumtype": "unordered"
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 847 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 847 } },
                          "value": "To view the documents in the new "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 847 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 847 } },
                              "value": "budgets"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 847 } },
                          "value": " collection:"
                        }
                      ]
                    },
                    {
                      "type": "code",
                      "position": { "start": { "line": 849 } },
                      "lang": "javascript",
                      "copyable": true,
                      "emphasize_lines": [],
                      "value": "db.getSiblingDB(\"reporting\").budgets.find().sort( { _id: 1 } )",
                      "linenos": false
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 853 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 853 } },
                          "value": "The "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 853 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 853 } },
                              "value": "budgets"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 853 } },
                          "value": " collection contains the following documents:"
                        }
                      ]
                    },
                    {
                      "type": "code",
                      "position": { "start": { "line": 855 } },
                      "lang": "javascript",
                      "copyable": true,
                      "emphasize_lines": [],
                      "value": "{ \"_id\" : { \"fiscal_year\" : 2017, \"dept\" : \"A\" }, \"salaries\" : 220000 }\n{ \"_id\" : { \"fiscal_year\" : 2017, \"dept\" : \"Z\" }, \"salaries\" : 115000 }\n{ \"_id\" : { \"fiscal_year\" : 2018, \"dept\" : \"A\" }, \"salaries\" : 215000 }\n{ \"_id\" : { \"fiscal_year\" : 2018, \"dept\" : \"Z\" }, \"salaries\" : 280000 }\n{ \"_id\" : { \"fiscal_year\" : 2019, \"dept\" : \"A\" }, \"salaries\" : 125000 }\n{ \"_id\" : { \"fiscal_year\" : 2019, \"dept\" : \"Z\" }, \"salaries\" : 310000 }",
                      "linenos": false
                    },
                    {
                      "type": "directive",
                      "position": { "start": { "line": 864 } },
                      "children": [
                        {
                          "type": "paragraph",
                          "position": { "start": { "line": 866 } },
                          "children": [
                            {
                              "type": "ref_role",
                              "position": { "start": { "line": 866 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 4 } },
                                  "value": "On-Demand Materialized Views"
                                }
                              ],
                              "domain": "std",
                              "name": "doc",
                              "target": "",
                              "flag": "",
                              "fileid": ["/core/materialized-views", ""]
                            }
                          ]
                        }
                      ],
                      "domain": "",
                      "name": "seealso",
                      "argument": []
                    },
                    {
                      "type": "target",
                      "position": { "start": { "line": 868 } },
                      "children": [
                        {
                          "type": "target_identifier",
                          "position": { "start": { "line": 868 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 871 } },
                              "value": "On-Demand Materialized View: Update/Replace Data"
                            }
                          ],
                          "ids": ["merge-mat-view-refresh"]
                        }
                      ],
                      "domain": "std",
                      "name": "label",
                      "html_id": "std-label-merge-mat-view-refresh"
                    }
                  ]
                },
                {
                  "type": "section",
                  "position": { "start": { "line": 871 } },
                  "children": [
                    {
                      "type": "heading",
                      "position": { "start": { "line": 871 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 871 } },
                          "value": "On-Demand Materialized View: Update/Replace Data"
                        }
                      ],
                      "id": "on-demand-materialized-view--update-replace-data"
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 873 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 873 } },
                          "value": "The following example uses the collections in the previous example."
                        }
                      ]
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 875 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 875 } },
                          "value": "The example "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 875 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 875 } },
                              "value": "salaries"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 875 } },
                          "value": " collection contains the\nemployee salary and department history:"
                        }
                      ]
                    },
                    {
                      "type": "code",
                      "position": { "start": { "line": 878 } },
                      "lang": "javascript",
                      "copyable": true,
                      "emphasize_lines": [],
                      "value": "{ \"_id\" : 1, employee: \"Ant\", dept: \"A\", salary: 100000, fiscal_year: 2017 },\n{ \"_id\" : 2, employee: \"Bee\", dept: \"A\", salary: 120000, fiscal_year: 2017 },\n{ \"_id\" : 3, employee: \"Cat\", dept: \"Z\", salary: 115000, fiscal_year: 2017 },\n{ \"_id\" : 4, employee: \"Ant\", dept: \"A\", salary: 115000, fiscal_year: 2018 },\n{ \"_id\" : 5, employee: \"Bee\", dept: \"Z\", salary: 145000, fiscal_year: 2018 },\n{ \"_id\" : 6, employee: \"Cat\", dept: \"Z\", salary: 135000, fiscal_year: 2018 },\n{ \"_id\" : 7, employee: \"Gecko\", dept: \"A\", salary: 100000, fiscal_year: 2018 },\n{ \"_id\" : 8, employee: \"Ant\", dept: \"A\", salary: 125000, fiscal_year: 2019 },\n{ \"_id\" : 9, employee: \"Bee\", dept: \"Z\", salary: 160000, fiscal_year: 2019 },\n{ \"_id\" : 10, employee: \"Cat\", dept: \"Z\", salary: 150000, fiscal_year: 2019 }",
                      "linenos": false
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 891 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 891 } },
                          "value": "The example "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 891 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 891 } },
                              "value": "budgets"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 891 } },
                          "value": " collection contains the cumulative yearly\nbudgets:"
                        }
                      ]
                    },
                    {
                      "type": "code",
                      "position": { "start": { "line": 894 } },
                      "lang": "javascript",
                      "copyable": true,
                      "emphasize_lines": [],
                      "value": "{ \"_id\" : { \"fiscal_year\" : 2017, \"dept\" : \"A\" }, \"salaries\" : 220000 }\n{ \"_id\" : { \"fiscal_year\" : 2017, \"dept\" : \"Z\" }, \"salaries\" : 115000 }\n{ \"_id\" : { \"fiscal_year\" : 2018, \"dept\" : \"A\" }, \"salaries\" : 215000 }\n{ \"_id\" : { \"fiscal_year\" : 2018, \"dept\" : \"Z\" }, \"salaries\" : 280000 }\n{ \"_id\" : { \"fiscal_year\" : 2019, \"dept\" : \"A\" }, \"salaries\" : 125000 }\n{ \"_id\" : { \"fiscal_year\" : 2019, \"dept\" : \"Z\" }, \"salaries\" : 310000 }",
                      "linenos": false
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 903 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 903 } },
                          "value": "During the current fiscal year ("
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 903 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 903 } },
                              "value": "2019"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 903 } },
                          "value": " in this example), new employees\nare added to the "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 903 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 903 } },
                              "value": "salaries"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 903 } },
                          "value": " collection and new head counts are\npre-allocated for the next year:"
                        }
                      ]
                    },
                    {
                      "type": "code",
                      "position": { "start": { "line": 907 } },
                      "lang": "javascript",
                      "copyable": true,
                      "emphasize_lines": [],
                      "value": "db.getSiblingDB(\"zoo\").salaries.insertMany([\n   { \"_id\" : 11,  employee: \"Wren\", dept: \"Z\", salary: 100000, fiscal_year: 2019 },\n   { \"_id\" : 12,  employee: \"Zebra\", dept: \"A\", salary: 150000, fiscal_year: 2019 },\n   { \"_id\" : 13,  employee: \"headcount1\", dept: \"Z\", salary: 120000, fiscal_year: 2020 },\n   { \"_id\" : 14,  employee: \"headcount2\", dept: \"Z\", salary: 120000, fiscal_year: 2020 }\n])",
                      "linenos": false
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 916 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 916 } },
                          "value": "To update the "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 916 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 916 } },
                              "value": "budgets"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 916 } },
                          "value": " collection to reflect the new\nsalary information, the following aggregation pipeline uses:"
                        }
                      ]
                    },
                    {
                      "type": "list",
                      "position": { "start": { "line": 919 } },
                      "children": [
                        {
                          "type": "listItem",
                          "position": { "start": { "line": 919 } },
                          "children": [
                            {
                              "type": "paragraph",
                              "position": { "start": { "line": 919 } },
                              "children": [
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 919 } },
                                  "children": [
                                    {
                                      "type": "literal",
                                      "position": { "start": { "line": 919 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 919 }
                                          },
                                          "value": "$match"
                                        }
                                      ]
                                    }
                                  ],
                                  "domain": "mongodb",
                                  "name": "pipeline",
                                  "target": "pipe.$match",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/match",
                                    "mongodb-pipeline-pipe.-match"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 919 } },
                                  "value": " stage to find all documents with "
                                },
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 919 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 919 } },
                                      "value": "fiscal_year"
                                    }
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 919 } },
                                  "value": "\ngreater than or equal to "
                                },
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 919 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 919 } },
                                      "value": "2019"
                                    }
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 919 } },
                                  "value": "."
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "type": "listItem",
                          "position": { "start": { "line": 919 } },
                          "children": [
                            {
                              "type": "paragraph",
                              "position": { "start": { "line": 922 } },
                              "children": [
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 922 } },
                                  "children": [
                                    {
                                      "type": "literal",
                                      "position": { "start": { "line": 922 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 922 }
                                          },
                                          "value": "$group"
                                        }
                                      ]
                                    }
                                  ],
                                  "domain": "mongodb",
                                  "name": "pipeline",
                                  "target": "pipe.$group",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/group",
                                    "mongodb-pipeline-pipe.-group"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 922 } },
                                  "value": " stage to group the salaries by the "
                                },
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 922 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 922 } },
                                      "value": "fiscal_year"
                                    }
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 922 } },
                                  "value": "\nand "
                                },
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 922 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 922 } },
                                      "value": "dept"
                                    }
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 922 } },
                                  "value": "."
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "type": "listItem",
                          "position": { "start": { "line": 919 } },
                          "children": [
                            {
                              "type": "paragraph",
                              "position": { "start": { "line": 925 } },
                              "children": [
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 925 } },
                                  "children": [
                                    {
                                      "type": "literal",
                                      "position": { "start": { "line": 925 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 925 }
                                          },
                                          "value": "$merge"
                                        }
                                      ]
                                    }
                                  ],
                                  "domain": "mongodb",
                                  "name": "pipeline",
                                  "target": "pipe.$merge",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/merge",
                                    "mongodb-pipeline-pipe.-merge"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 925 } },
                                  "value": " to write the result set to the "
                                },
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 925 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 925 } },
                                      "value": "budgets"
                                    }
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 925 } },
                                  "value": "\ncollection, "
                                },
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 925 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 925 } },
                                      "value": "replacing documents"
                                    }
                                  ],
                                  "domain": "std",
                                  "name": "label",
                                  "target": "merge-whenMatched-replace",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/merge",
                                    "std-label-merge-whenMatched-replace"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 925 } },
                                  "value": " with the same "
                                },
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 925 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 925 } },
                                      "value": "_id"
                                    }
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 925 } },
                                  "value": " value (in\nthis example, a document with the fiscal year and dept). For\ndocuments that do not have matches in the collection,\n"
                                },
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 925 } },
                                  "children": [
                                    {
                                      "type": "literal",
                                      "position": { "start": { "line": 925 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 925 }
                                          },
                                          "value": "$merge"
                                        }
                                      ]
                                    }
                                  ],
                                  "domain": "mongodb",
                                  "name": "pipeline",
                                  "target": "pipe.$merge",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/merge",
                                    "mongodb-pipeline-pipe.-merge"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 925 } },
                                  "value": " inserts the new documents."
                                }
                              ]
                            }
                          ]
                        }
                      ],
                      "enumtype": "unordered"
                    },
                    {
                      "type": "code",
                      "position": { "start": { "line": 932 } },
                      "lang": "javascript",
                      "copyable": true,
                      "emphasize_lines": [],
                      "value": "db.getSiblingDB(\"zoo\").salaries.aggregate( [\n   { $match : { fiscal_year:  { $gte : 2019 } } },\n   { $group: { _id: { fiscal_year: \"$fiscal_year\", dept: \"$dept\" }, salaries: { $sum: \"$salary\" } } },\n   { $merge : { into: { db: \"reporting\", coll: \"budgets\" }, on: \"_id\",  whenMatched: \"replace\", whenNotMatched: \"insert\" } }\n] )",
                      "linenos": false
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 940 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 940 } },
                          "value": "After the aggregation is run, view the documents in the "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 940 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 940 } },
                              "value": "budgets"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 940 } },
                          "value": "\ncollection:"
                        }
                      ]
                    },
                    {
                      "type": "code",
                      "position": { "start": { "line": 943 } },
                      "lang": "javascript",
                      "copyable": true,
                      "emphasize_lines": [],
                      "value": "db.getSiblingDB(\"reporting\").budgets.find().sort( { _id: 1 } )",
                      "linenos": false
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 947 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 947 } },
                          "value": "The "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 947 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 947 } },
                              "value": "budgets"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 947 } },
                          "value": " collection incorporates the new salary data for fiscal\nyear 2019 and adds new documents for fiscal year 2020:"
                        }
                      ]
                    },
                    {
                      "type": "code",
                      "position": { "start": { "line": 950 } },
                      "lang": "javascript",
                      "copyable": true,
                      "emphasize_lines": [[5, 7]],
                      "value": "{ \"_id\" : { \"fiscal_year\" : 2017, \"dept\" : \"A\" }, \"salaries\" : 220000 }\n{ \"_id\" : { \"fiscal_year\" : 2017, \"dept\" : \"Z\" }, \"salaries\" : 115000 }\n{ \"_id\" : { \"fiscal_year\" : 2018, \"dept\" : \"A\" }, \"salaries\" : 215000 }\n{ \"_id\" : { \"fiscal_year\" : 2018, \"dept\" : \"Z\" }, \"salaries\" : 280000 }\n{ \"_id\" : { \"fiscal_year\" : 2019, \"dept\" : \"A\" }, \"salaries\" : 275000 }\n{ \"_id\" : { \"fiscal_year\" : 2019, \"dept\" : \"Z\" }, \"salaries\" : 410000 }\n{ \"_id\" : { \"fiscal_year\" : 2020, \"dept\" : \"Z\" }, \"salaries\" : 240000 }",
                      "linenos": false
                    },
                    {
                      "type": "directive",
                      "position": { "start": { "line": 961 } },
                      "children": [
                        {
                          "type": "paragraph",
                          "position": { "start": { "line": 963 } },
                          "children": [
                            {
                              "type": "ref_role",
                              "position": { "start": { "line": 963 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 4 } },
                                  "value": "On-Demand Materialized Views"
                                }
                              ],
                              "domain": "std",
                              "name": "doc",
                              "target": "",
                              "flag": "",
                              "fileid": ["/core/materialized-views", ""]
                            }
                          ]
                        }
                      ],
                      "domain": "",
                      "name": "seealso",
                      "argument": []
                    },
                    {
                      "type": "target",
                      "position": { "start": { "line": 965 } },
                      "children": [
                        {
                          "type": "target_identifier",
                          "position": { "start": { "line": 965 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 968 } },
                              "value": "Only Insert New Data"
                            }
                          ],
                          "ids": ["merge-mat-view-insert-only"]
                        }
                      ],
                      "domain": "std",
                      "name": "label",
                      "html_id": "std-label-merge-mat-view-insert-only"
                    }
                  ]
                },
                {
                  "type": "section",
                  "position": { "start": { "line": 968 } },
                  "children": [
                    {
                      "type": "heading",
                      "position": { "start": { "line": 968 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 968 } },
                          "value": "Only Insert New Data"
                        }
                      ],
                      "id": "only-insert-new-data"
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 970 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 970 } },
                          "value": "To ensure that the "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 970 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 970 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 970 } },
                                  "value": "$merge"
                                }
                              ]
                            }
                          ],
                          "domain": "mongodb",
                          "name": "pipeline",
                          "target": "pipe.$merge",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "mongodb-pipeline-pipe.-merge"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 970 } },
                          "value": " does not overwrite existing data\nin the collection, set "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 970 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 970 } },
                              "value": "whenMatched"
                            }
                          ],
                          "domain": "std",
                          "name": "label",
                          "target": "merge-whenMatched",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "std-label-merge-whenMatched"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 970 } },
                          "value": " to\n"
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 970 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 970 } },
                              "value": "keepExisting"
                            }
                          ],
                          "domain": "std",
                          "name": "label",
                          "target": "merge-whenMatched-keepExisting",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "std-label-merge-whenMatched-keepExisting"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 970 } },
                          "value": " or "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 970 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 970 } },
                              "value": "fail"
                            }
                          ],
                          "domain": "std",
                          "name": "label",
                          "target": "merge-whenMatched-fail",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "std-label-merge-whenMatched-fail"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 970 } },
                          "value": "."
                        }
                      ]
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 975 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 975 } },
                          "value": "The example "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 975 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 975 } },
                              "value": "salaries"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 975 } },
                          "value": " collection in the "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 975 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 975 } },
                              "value": "zoo"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 975 } },
                          "value": " database contains\nthe employee salary and department history:"
                        }
                      ]
                    },
                    {
                      "type": "code",
                      "position": { "start": { "line": 978 } },
                      "lang": "javascript",
                      "copyable": true,
                      "emphasize_lines": [],
                      "value": "{ \"_id\" : 1, employee: \"Ant\", dept: \"A\", salary: 100000, fiscal_year: 2017 },\n{ \"_id\" : 2, employee: \"Bee\", dept: \"A\", salary: 120000, fiscal_year: 2017 },\n{ \"_id\" : 3, employee: \"Cat\", dept: \"Z\", salary: 115000, fiscal_year: 2017 },\n{ \"_id\" : 4, employee: \"Ant\", dept: \"A\", salary: 115000, fiscal_year: 2018 },\n{ \"_id\" : 5, employee: \"Bee\", dept: \"Z\", salary: 145000, fiscal_year: 2018 },\n{ \"_id\" : 6, employee: \"Cat\", dept: \"Z\", salary: 135000, fiscal_year: 2018 },\n{ \"_id\" : 7, employee: \"Gecko\", dept: \"A\", salary: 100000, fiscal_year: 2018 },\n{ \"_id\" : 8, employee: \"Ant\", dept: \"A\", salary: 125000, fiscal_year: 2019 },\n{ \"_id\" : 9, employee: \"Bee\", dept: \"Z\", salary: 160000, fiscal_year: 2019 },\n{ \"_id\" : 10, employee: \"Cat\", dept: \"Z\", salary: 150000, fiscal_year: 2019 }",
                      "linenos": false
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 991 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 991 } },
                          "value": "A collection "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 991 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 991 } },
                              "value": "orgArchive"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 991 } },
                          "value": " in the "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 991 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 991 } },
                              "value": "reporting"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 991 } },
                          "value": " database\ncontains historical departmental organization records for the past\nfiscal years. Archived records should not be modified."
                        }
                      ]
                    },
                    {
                      "type": "code",
                      "position": { "start": { "line": 995 } },
                      "lang": "javascript",
                      "copyable": true,
                      "emphasize_lines": [],
                      "value": "{ \"_id\" : ObjectId(\"5cd8c68261baa09e9f3622be\"), \"employees\" : [ \"Ant\", \"Gecko\" ], \"dept\" : \"A\", \"fiscal_year\" : 2018 }\n{ \"_id\" : ObjectId(\"5cd8c68261baa09e9f3622bf\"), \"employees\" : [ \"Ant\", \"Bee\" ], \"dept\" : \"A\", \"fiscal_year\" : 2017 }\n{ \"_id\" : ObjectId(\"5cd8c68261baa09e9f3622c0\"), \"employees\" : [ \"Bee\", \"Cat\" ], \"dept\" : \"Z\", \"fiscal_year\" : 2018 }\n{ \"_id\" : ObjectId(\"5cd8c68261baa09e9f3622c1\"), \"employees\" : [ \"Cat\" ], \"dept\" : \"Z\", \"fiscal_year\" : 2017 }",
                      "linenos": false
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 1002 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 1002 } },
                          "value": "The "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 1002 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1002 } },
                              "value": "orgArchive"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 1002 } },
                          "value": " collection has a unique compound index on the\n"
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 1002 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1002 } },
                              "value": "fiscal_year"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 1002 } },
                          "value": " and "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 1002 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1002 } },
                              "value": "dept"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 1002 } },
                          "value": " fields. Specifically, there should be at\nmost one record for the same fiscal year and department combination:"
                        }
                      ]
                    },
                    {
                      "type": "code",
                      "position": { "start": { "line": 1006 } },
                      "lang": "javascript",
                      "copyable": true,
                      "emphasize_lines": [],
                      "value": "db.getSiblingDB(\"reporting\").orgArchive.createIndex ( { fiscal_year: 1, dept: 1 }, { unique: true } )",
                      "linenos": false
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 1010 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 1010 } },
                          "value": "At the end of current fiscal year ("
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 1010 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1010 } },
                              "value": "2019"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 1010 } },
                          "value": " in this example), the\n"
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 1010 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1010 } },
                              "value": "salaries"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 1010 } },
                          "value": " collection contain the following documents:"
                        }
                      ]
                    },
                    {
                      "type": "code",
                      "position": { "start": { "line": 1013 } },
                      "lang": "javascript",
                      "copyable": true,
                      "emphasize_lines": [],
                      "value": "{ \"_id\" : 1, \"employee\" : \"Ant\", \"dept\" : \"A\", \"salary\" : 100000, \"fiscal_year\" : 2017 }\n{ \"_id\" : 2, \"employee\" : \"Bee\", \"dept\" : \"A\", \"salary\" : 120000, \"fiscal_year\" : 2017 }\n{ \"_id\" : 3, \"employee\" : \"Cat\", \"dept\" : \"Z\", \"salary\" : 115000, \"fiscal_year\" : 2017 }\n{ \"_id\" : 4, \"employee\" : \"Ant\", \"dept\" : \"A\", \"salary\" : 115000, \"fiscal_year\" : 2018 }\n{ \"_id\" : 5, \"employee\" : \"Bee\", \"dept\" : \"Z\", \"salary\" : 145000, \"fiscal_year\" : 2018 }\n{ \"_id\" : 6, \"employee\" : \"Cat\", \"dept\" : \"Z\", \"salary\" : 135000, \"fiscal_year\" : 2018 }\n{ \"_id\" : 7, \"employee\" : \"Gecko\", \"dept\" : \"A\", \"salary\" : 100000, \"fiscal_year\" : 2018 }\n{ \"_id\" : 8, \"employee\" : \"Ant\", \"dept\" : \"A\", \"salary\" : 125000, \"fiscal_year\" : 2019 }\n{ \"_id\" : 9, \"employee\" : \"Bee\", \"dept\" : \"Z\", \"salary\" : 160000, \"fiscal_year\" : 2019 }\n{ \"_id\" : 10, \"employee\" : \"Cat\", \"dept\" : \"Z\", \"salary\" : 150000, \"fiscal_year\" : 2019 }\n{ \"_id\" : 11, \"employee\" : \"Wren\", \"dept\" : \"Z\", \"salary\" : 100000, \"fiscal_year\" : 2019 }\n{ \"_id\" : 12, \"employee\" : \"Zebra\", \"dept\" : \"A\", \"salary\" : 150000, \"fiscal_year\" : 2019 }\n{ \"_id\" : 13, \"employee\" : \"headcount1\", \"dept\" : \"Z\", \"salary\" : 120000, \"fiscal_year\" : 2020 }\n{ \"_id\" : 14, \"employee\" : \"headcount2\", \"dept\" : \"Z\", \"salary\" : 120000, \"fiscal_year\" : 2020 }",
                      "linenos": false
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 1030 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 1030 } },
                          "value": "To update the "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 1030 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1030 } },
                              "value": "orgArchive"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 1030 } },
                          "value": " collection to include the fiscal\nyear "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 1030 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1030 } },
                              "value": "2019"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 1030 } },
                          "value": " that has just ended, the following aggregation pipeline\nuses:"
                        }
                      ]
                    },
                    {
                      "type": "list",
                      "position": { "start": { "line": 1034 } },
                      "children": [
                        {
                          "type": "listItem",
                          "position": { "start": { "line": 1034 } },
                          "children": [
                            {
                              "type": "paragraph",
                              "position": { "start": { "line": 1034 } },
                              "children": [
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 1034 } },
                                  "children": [
                                    {
                                      "type": "literal",
                                      "position": { "start": { "line": 1034 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 1034 }
                                          },
                                          "value": "$match"
                                        }
                                      ]
                                    }
                                  ],
                                  "domain": "mongodb",
                                  "name": "pipeline",
                                  "target": "pipe.$match",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/match",
                                    "mongodb-pipeline-pipe.-match"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1034 } },
                                  "value": " stage to find all documents with "
                                },
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 1034 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1034 } },
                                      "value": "fiscal_year"
                                    }
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1034 } },
                                  "value": "\nequal to "
                                },
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 1034 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1034 } },
                                      "value": "2019"
                                    }
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1034 } },
                                  "value": "."
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "type": "listItem",
                          "position": { "start": { "line": 1034 } },
                          "children": [
                            {
                              "type": "paragraph",
                              "position": { "start": { "line": 1037 } },
                              "children": [
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 1037 } },
                                  "children": [
                                    {
                                      "type": "literal",
                                      "position": { "start": { "line": 1037 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 1037 }
                                          },
                                          "value": "$group"
                                        }
                                      ]
                                    }
                                  ],
                                  "domain": "mongodb",
                                  "name": "pipeline",
                                  "target": "pipe.$group",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/group",
                                    "mongodb-pipeline-pipe.-group"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1037 } },
                                  "value": " stage to group the employees by the "
                                },
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 1037 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1037 } },
                                      "value": "fiscal_year"
                                    }
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1037 } },
                                  "value": "\nand "
                                },
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 1037 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1037 } },
                                      "value": "dept"
                                    }
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1037 } },
                                  "value": "."
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "type": "listItem",
                          "position": { "start": { "line": 1034 } },
                          "children": [
                            {
                              "type": "paragraph",
                              "position": { "start": { "line": 1040 } },
                              "children": [
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 1040 } },
                                  "children": [
                                    {
                                      "type": "literal",
                                      "position": { "start": { "line": 1040 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 1040 }
                                          },
                                          "value": "$project"
                                        }
                                      ]
                                    }
                                  ],
                                  "domain": "mongodb",
                                  "name": "pipeline",
                                  "target": "pipe.$project",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/project",
                                    "mongodb-pipeline-pipe.-project"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1040 } },
                                  "value": " stage to suppress the "
                                },
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 1040 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1040 } },
                                      "value": "_id"
                                    }
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1040 } },
                                  "value": " field and add\nseparate "
                                },
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 1040 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1040 } },
                                      "value": "dept"
                                    }
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1040 } },
                                  "value": " and "
                                },
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 1040 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1040 } },
                                      "value": "fiscal_year"
                                    }
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1040 } },
                                  "value": " field. When the documents\nare passed to "
                                },
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 1040 } },
                                  "children": [
                                    {
                                      "type": "literal",
                                      "position": { "start": { "line": 1040 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 1040 }
                                          },
                                          "value": "$merge"
                                        }
                                      ]
                                    }
                                  ],
                                  "domain": "mongodb",
                                  "name": "pipeline",
                                  "target": "pipe.$merge",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/merge",
                                    "mongodb-pipeline-pipe.-merge"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1040 } },
                                  "value": ", "
                                },
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 1040 } },
                                  "children": [
                                    {
                                      "type": "literal",
                                      "position": { "start": { "line": 1040 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 1040 }
                                          },
                                          "value": "$merge"
                                        }
                                      ]
                                    }
                                  ],
                                  "domain": "mongodb",
                                  "name": "pipeline",
                                  "target": "pipe.$merge",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/merge",
                                    "mongodb-pipeline-pipe.-merge"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1040 } },
                                  "value": " automatically\ngenerates a new "
                                },
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 1040 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1040 } },
                                      "value": "_id"
                                    }
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1040 } },
                                  "value": " field for the documents."
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "type": "listItem",
                          "position": { "start": { "line": 1034 } },
                          "children": [
                            {
                              "type": "paragraph",
                              "position": { "start": { "line": 1045 } },
                              "children": [
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 1045 } },
                                  "children": [
                                    {
                                      "type": "literal",
                                      "position": { "start": { "line": 1045 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 1045 }
                                          },
                                          "value": "$merge"
                                        }
                                      ]
                                    }
                                  ],
                                  "domain": "mongodb",
                                  "name": "pipeline",
                                  "target": "pipe.$merge",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/merge",
                                    "mongodb-pipeline-pipe.-merge"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1045 } },
                                  "value": " to write the result set to "
                                },
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 1045 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1045 } },
                                      "value": "orgArchive"
                                    }
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1045 } },
                                  "value": "."
                                }
                              ]
                            },
                            {
                              "type": "paragraph",
                              "position": { "start": { "line": 1047 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1047 } },
                                  "value": "The "
                                },
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 1047 } },
                                  "children": [
                                    {
                                      "type": "literal",
                                      "position": { "start": { "line": 1047 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 1047 }
                                          },
                                          "value": "$merge"
                                        }
                                      ]
                                    }
                                  ],
                                  "domain": "mongodb",
                                  "name": "pipeline",
                                  "target": "pipe.$merge",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/merge",
                                    "mongodb-pipeline-pipe.-merge"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1047 } },
                                  "value": " stage matches documents "
                                },
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 1047 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1047 } },
                                      "value": "on"
                                    }
                                  ],
                                  "domain": "std",
                                  "name": "label",
                                  "target": "merge-on",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/merge",
                                    "std-label-merge-on"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1047 } },
                                  "value": " the "
                                },
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 1047 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1047 } },
                                      "value": "dept"
                                    }
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1047 } },
                                  "value": " and "
                                },
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 1047 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1047 } },
                                      "value": "fiscal_year"
                                    }
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1047 } },
                                  "value": " fields and "
                                },
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 1047 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1047 } },
                                      "value": "fails"
                                    }
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1047 } },
                                  "value": "\nwhen matched. That is, if a document already exists for the same\ndepartment and fiscal year, the "
                                },
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 1047 } },
                                  "children": [
                                    {
                                      "type": "literal",
                                      "position": { "start": { "line": 1047 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 1047 }
                                          },
                                          "value": "$merge"
                                        }
                                      ]
                                    }
                                  ],
                                  "domain": "mongodb",
                                  "name": "pipeline",
                                  "target": "pipe.$merge",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/merge",
                                    "mongodb-pipeline-pipe.-merge"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1047 } },
                                  "value": " errors."
                                }
                              ]
                            }
                          ]
                        }
                      ],
                      "enumtype": "unordered"
                    },
                    {
                      "type": "code",
                      "position": { "start": { "line": 1052 } },
                      "lang": "javascript",
                      "copyable": true,
                      "emphasize_lines": [],
                      "value": "db.getSiblingDB(\"zoo\").salaries.aggregate( [\n    { $match: { fiscal_year: 2019 }},\n    { $group: { _id: { fiscal_year: \"$fiscal_year\", dept: \"$dept\" }, employees: { $push: \"$employee\" } } },\n    { $project: { _id: 0, dept: \"$_id.dept\", fiscal_year: \"$_id.fiscal_year\", employees: 1 } },\n    { $merge : { into : { db: \"reporting\", coll: \"orgArchive\" }, on: [ \"dept\", \"fiscal_year\" ], whenMatched: \"fail\" } }\n] )",
                      "linenos": false
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 1061 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 1061 } },
                          "value": "After the operation, the "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 1061 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1061 } },
                              "value": "orgArchive"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 1061 } },
                          "value": " collection contains the following\ndocuments:"
                        }
                      ]
                    },
                    {
                      "type": "code",
                      "position": { "start": { "line": 1064 } },
                      "lang": "javascript",
                      "copyable": true,
                      "emphasize_lines": [
                        [3, 3],
                        [6, 6]
                      ],
                      "value": "{ \"_id\" : ObjectId(\"5caccc6a66b22dd8a8cc419f\"), \"employees\" : [ \"Ahn\", \"Bess\" ], \"dept\" : \"A\", \"fiscal_year\" : 2017 }\n{ \"_id\" : ObjectId(\"5caccc6a66b22dd8a8cc419e\"), \"employees\" : [ \"Ahn\", \"Gee\" ], \"dept\" : \"A\", \"fiscal_year\" : 2018 }\n{ \"_id\" : ObjectId(\"5caccd0b66b22dd8a8cc438e\"), \"employees\" : [ \"Ahn\", \"Zeb\" ], \"dept\" : \"A\", \"fiscal_year\" : 2019 }\n{ \"_id\" : ObjectId(\"5caccc6a66b22dd8a8cc41a0\"), \"employees\" : [ \"Carl\" ], \"dept\" : \"Z\", \"fiscal_year\" : 2017 }\n{ \"_id\" : ObjectId(\"5caccc6a66b22dd8a8cc41a1\"), \"employees\" : [ \"Bess\", \"Carl\" ], \"dept\" : \"Z\", \"fiscal_year\" : 2018 }\n{ \"_id\" : ObjectId(\"5caccd0b66b22dd8a8cc438d\"), \"employees\" : [ \"Bess\", \"Carl\", \"Wen\" ], \"dept\" : \"Z\", \"fiscal_year\" : 2019 }",
                      "linenos": false
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 1074 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 1074 } },
                          "value": "If the "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 1074 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1074 } },
                              "value": "orgArchive"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 1074 } },
                          "value": " collection already contained a document for\n2019 for department "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 1074 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1074 } },
                              "value": "\"A\""
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 1074 } },
                          "value": " and/or "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 1074 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1074 } },
                              "value": "\"B\""
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 1074 } },
                          "value": ", the aggregation\n"
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 1074 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1074 } },
                              "value": "fails because of the duplicate key error"
                            }
                          ],
                          "domain": "std",
                          "name": "label",
                          "target": "merge-unique-index-constraints",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "std-label-merge-unique-index-constraints"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 1074 } },
                          "value": ". However, any document inserted\nbefore the error will not be rolled back."
                        }
                      ]
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 1080 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 1080 } },
                          "value": "If you specify "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 1080 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1080 } },
                              "value": "keepExisting"
                            }
                          ],
                          "domain": "std",
                          "name": "label",
                          "target": "merge-whenMatched-replace",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "std-label-merge-whenMatched-replace"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 1080 } },
                          "value": " for the matching document, the\naggregation does not affect the matching document and does not error\nwith duplicate key error. Similarly, if you specify\n"
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 1080 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1080 } },
                              "value": "replace"
                            }
                          ],
                          "domain": "std",
                          "name": "label",
                          "target": "merge-whenMatched-replace",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "std-label-merge-whenMatched-replace"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 1080 } },
                          "value": ", the\noperation would not fail; however, the operation would replace the\nexisting document."
                        }
                      ]
                    },
                    {
                      "type": "target",
                      "position": { "start": { "line": 1088 } },
                      "children": [
                        {
                          "type": "target_identifier",
                          "position": { "start": { "line": 1088 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1091 } },
                              "value": "Merge Results from Multiple Collections"
                            }
                          ],
                          "ids": ["merge-mat-view-merge"]
                        }
                      ],
                      "domain": "std",
                      "name": "label",
                      "html_id": "std-label-merge-mat-view-merge"
                    }
                  ]
                },
                {
                  "type": "section",
                  "position": { "start": { "line": 1091 } },
                  "children": [
                    {
                      "type": "heading",
                      "position": { "start": { "line": 1091 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 1091 } },
                          "value": "Merge Results from Multiple Collections"
                        }
                      ],
                      "id": "merge-results-from-multiple-collections"
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 1093 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 1093 } },
                          "value": "By default, if a document in the aggregation results matches a\ndocument in the collection, the "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 1093 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 1093 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1093 } },
                                  "value": "$merge"
                                }
                              ]
                            }
                          ],
                          "domain": "mongodb",
                          "name": "pipeline",
                          "target": "pipe.$merge",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "mongodb-pipeline-pipe.-merge"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 1093 } },
                          "value": " stage\n"
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 1093 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1093 } },
                              "value": "merges"
                            }
                          ],
                          "domain": "std",
                          "name": "label",
                          "target": "merge-whenMatched-merge",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "std-label-merge-whenMatched-merge"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 1093 } },
                          "value": " the documents."
                        }
                      ]
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 1097 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 1097 } },
                          "value": "An example collection "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 1097 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1097 } },
                              "value": "purchaseorders"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 1097 } },
                          "value": " is populated with the\npurchase order information by quarter and regions:"
                        }
                      ]
                    },
                    {
                      "type": "code",
                      "position": { "start": { "line": 1100 } },
                      "lang": "javascript",
                      "copyable": true,
                      "emphasize_lines": [],
                      "value": "db.purchaseorders.insertMany( [\n   { _id: 1, quarter: \"2019Q1\", region: \"A\", qty: 200, reportDate: new Date(\"2019-04-01\") },\n   { _id: 2, quarter: \"2019Q1\", region: \"B\", qty: 300, reportDate: new Date(\"2019-04-01\") },\n   { _id: 3, quarter: \"2019Q1\", region: \"C\", qty: 700, reportDate: new Date(\"2019-04-01\") },\n   { _id: 4, quarter: \"2019Q2\", region: \"B\", qty: 300, reportDate: new Date(\"2019-07-01\") },\n   { _id: 5, quarter: \"2019Q2\", region: \"C\", qty: 1000, reportDate: new Date(\"2019-07-01\") },\n   { _id: 6, quarter: \"2019Q2\", region: \"A\", qty: 400, reportDate: new Date(\"2019-07-01\") },\n] )",
                      "linenos": false
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 1111 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 1111 } },
                          "value": "Another example collection "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 1111 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1111 } },
                              "value": "reportedsales"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 1111 } },
                          "value": " is populated with the\nreported sales information by quarter and regions:"
                        }
                      ]
                    },
                    {
                      "type": "code",
                      "position": { "start": { "line": 1114 } },
                      "lang": "javascript",
                      "copyable": true,
                      "emphasize_lines": [],
                      "value": "db.reportedsales.insertMany( [\n   { _id: 1, quarter: \"2019Q1\", region: \"A\", qty: 400, reportDate: new Date(\"2019-04-02\") },\n   { _id: 2, quarter: \"2019Q1\", region: \"B\", qty: 550, reportDate: new Date(\"2019-04-02\") },\n   { _id: 3, quarter: \"2019Q1\", region: \"C\", qty: 1000, reportDate: new Date(\"2019-04-05\") },\n   { _id: 4, quarter: \"2019Q2\", region: \"B\", qty: 500, reportDate: new Date(\"2019-07-02\") },\n] )",
                      "linenos": false
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 1124 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 1124 } },
                          "value": "Assume that, for reporting purposes, you want to view the data by\nquarter in the following format:"
                        }
                      ]
                    },
                    {
                      "type": "code",
                      "position": { "start": { "line": 1127 } },
                      "lang": "javascript",
                      "copyable": true,
                      "emphasize_lines": [],
                      "value": "{ \"_id\" : \"2019Q1\", \"sales\" : 1950, \"purchased\" : 1200 }\n{ \"_id\" : \"2019Q2\", \"sales\" : 500, \"purchased\" : 1700 }",
                      "linenos": false
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 1132 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 1132 } },
                          "value": "You can use the "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 1132 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 1132 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1132 } },
                                  "value": "$merge"
                                }
                              ]
                            }
                          ],
                          "domain": "mongodb",
                          "name": "pipeline",
                          "target": "pipe.$merge",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "mongodb-pipeline-pipe.-merge"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 1132 } },
                          "value": " to merge in results from the\n"
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 1132 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1132 } },
                              "value": "purchaseorders"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 1132 } },
                          "value": " collection and the "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 1132 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1132 } },
                              "value": "reportedsales"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 1132 } },
                          "value": " collection\nto create a new collection "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 1132 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1132 } },
                              "value": "quarterlyreport"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 1132 } },
                          "value": "."
                        }
                      ]
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 1136 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 1136 } },
                          "value": "To create the "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 1136 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1136 } },
                              "value": "quarterlyreport"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 1136 } },
                          "value": " collection, you can use the\nfollowing pipeline:"
                        }
                      ]
                    },
                    {
                      "type": "code",
                      "position": { "start": { "line": 1139 } },
                      "lang": "javascript",
                      "copyable": true,
                      "emphasize_lines": [],
                      "value": "db.purchaseorders.aggregate( [\n   { $group: { _id: \"$quarter\", purchased: { $sum: \"$qty\" } } },  // group purchase orders by quarter\n   { $merge : { into: \"quarterlyreport\", on: \"_id\",  whenMatched: \"merge\", whenNotMatched: \"insert\" } }\n])",
                      "linenos": false
                    },
                    {
                      "type": "definitionList",
                      "position": { "start": { "line": 1091 } },
                      "children": [
                        {
                          "type": "definitionListItem",
                          "position": { "start": { "line": 1158 } },
                          "children": [
                            {
                              "type": "paragraph",
                              "position": { "start": { "line": 1147 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1147 } },
                                  "value": "The "
                                },
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 1147 } },
                                  "children": [
                                    {
                                      "type": "literal",
                                      "position": { "start": { "line": 1147 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 1147 }
                                          },
                                          "value": "$group"
                                        }
                                      ]
                                    }
                                  ],
                                  "domain": "mongodb",
                                  "name": "pipeline",
                                  "target": "pipe.$group",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/group",
                                    "mongodb-pipeline-pipe.-group"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1147 } },
                                  "value": " stage groups by the quarter and uses\n"
                                },
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 1147 } },
                                  "children": [
                                    {
                                      "type": "literal",
                                      "position": { "start": { "line": 1147 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 1147 }
                                          },
                                          "value": "$sum"
                                        }
                                      ]
                                    }
                                  ],
                                  "domain": "mongodb",
                                  "name": "group",
                                  "target": "grp.$sum",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/sum",
                                    "mongodb-group-grp.-sum"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1147 } },
                                  "value": " to add the "
                                },
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 1147 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1147 } },
                                      "value": "qty"
                                    }
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1147 } },
                                  "value": " fields into a new\n"
                                },
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 1147 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1147 } },
                                      "value": "purchased"
                                    }
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1147 } },
                                  "value": " field. For example:"
                                }
                              ]
                            },
                            {
                              "type": "paragraph",
                              "position": { "start": { "line": 1151 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1151 } },
                                  "value": "To create the "
                                },
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 1151 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1151 } },
                                      "value": "quarterlyreport"
                                    }
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1151 } },
                                  "value": " collection, you can use this\npipeline:"
                                }
                              ]
                            },
                            {
                              "type": "code",
                              "position": { "start": { "line": 1154 } },
                              "lang": "javascript",
                              "copyable": false,
                              "emphasize_lines": [],
                              "value": "{ \"_id\" : \"2019Q2\", \"purchased\" : 1700 }\n{ \"_id\" : \"2019Q1\", \"purchased\" : 1200 }",
                              "linenos": false
                            }
                          ],
                          "term": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1158 } },
                              "value": "First stage:"
                            }
                          ]
                        },
                        {
                          "type": "definitionListItem",
                          "position": { "start": { "line": 1166 } },
                          "children": [
                            {
                              "type": "paragraph",
                              "position": { "start": { "line": 1161 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1161 } },
                                  "value": "The "
                                },
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 1161 } },
                                  "children": [
                                    {
                                      "type": "literal",
                                      "position": { "start": { "line": 1161 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 1161 }
                                          },
                                          "value": "$merge"
                                        }
                                      ]
                                    }
                                  ],
                                  "domain": "mongodb",
                                  "name": "pipeline",
                                  "target": "pipe.$merge",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/merge",
                                    "mongodb-pipeline-pipe.-merge"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1161 } },
                                  "value": " stage writes the documents to the\n"
                                },
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 1161 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1161 } },
                                      "value": "quarterlyreport"
                                    }
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1161 } },
                                  "value": " collection in the same database. If the stage\nfinds an existing document in the collection that "
                                },
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 1161 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1161 } },
                                      "value": "matches\non"
                                    }
                                  ],
                                  "domain": "std",
                                  "name": "label",
                                  "target": "merge-on",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/merge",
                                    "std-label-merge-on"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1161 } },
                                  "value": " the "
                                },
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 1161 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1161 } },
                                      "value": "_id"
                                    }
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1161 } },
                                  "value": " field, the stage merges the matching\ndocuments. Otherwise, the stage inserts the document. For the\ninitial creation, no documents should match."
                                }
                              ]
                            }
                          ],
                          "term": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1166 } },
                              "value": "Second stage:"
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 1168 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 1168 } },
                          "value": "To view the documents in the collection, run the following operation:"
                        }
                      ]
                    },
                    {
                      "type": "code",
                      "position": { "start": { "line": 1170 } },
                      "lang": "javascript",
                      "copyable": true,
                      "emphasize_lines": [],
                      "value": "db.quarterlyreport.find().sort( { _id: 1 } )",
                      "linenos": false
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 1174 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 1174 } },
                          "value": "The collection contains the following documents:"
                        }
                      ]
                    },
                    {
                      "type": "code",
                      "position": { "start": { "line": 1176 } },
                      "lang": "javascript",
                      "copyable": false,
                      "emphasize_lines": [],
                      "value": "{ \"_id\" : \"2019Q1\", \"sales\" : 1200, \"purchased\" : 1200 }\n{ \"_id\" : \"2019Q2\", \"sales\" : 1700, \"purchased\" : 1700 }",
                      "linenos": false
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 1182 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 1182 } },
                          "value": "Similarly, run the following aggregation pipeline against the\n"
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 1182 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1182 } },
                              "value": "reportedsales"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 1182 } },
                          "value": " collection to merge the sales results into the\n"
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 1182 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1182 } },
                              "value": "quarterlyreport"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 1182 } },
                          "value": " collection."
                        }
                      ]
                    },
                    {
                      "type": "code",
                      "position": { "start": { "line": 1186 } },
                      "lang": "javascript",
                      "copyable": true,
                      "emphasize_lines": [],
                      "value": "db.reportedsales.aggregate( [\n   { $group: { _id: \"$quarter\", sales: { $sum: \"$qty\" } } },  // group sales by quarter\n   { $merge : { into: \"quarterlyreport\", on: \"_id\",  whenMatched: \"merge\", whenNotMatched: \"insert\" } }\n])",
                      "linenos": false
                    },
                    {
                      "type": "definitionList",
                      "position": { "start": { "line": 1091 } },
                      "children": [
                        {
                          "type": "definitionListItem",
                          "position": { "start": { "line": 1202 } },
                          "children": [
                            {
                              "type": "paragraph",
                              "position": { "start": { "line": 1194 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1194 } },
                                  "value": "The "
                                },
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 1194 } },
                                  "children": [
                                    {
                                      "type": "literal",
                                      "position": { "start": { "line": 1194 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 1194 }
                                          },
                                          "value": "$group"
                                        }
                                      ]
                                    }
                                  ],
                                  "domain": "mongodb",
                                  "name": "pipeline",
                                  "target": "pipe.$group",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/group",
                                    "mongodb-pipeline-pipe.-group"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1194 } },
                                  "value": " stage groups by the quarter and uses\n"
                                },
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 1194 } },
                                  "children": [
                                    {
                                      "type": "literal",
                                      "position": { "start": { "line": 1194 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 1194 }
                                          },
                                          "value": "$sum"
                                        }
                                      ]
                                    }
                                  ],
                                  "domain": "mongodb",
                                  "name": "group",
                                  "target": "grp.$sum",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/sum",
                                    "mongodb-group-grp.-sum"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1194 } },
                                  "value": " to add the "
                                },
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 1194 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1194 } },
                                      "value": "qty"
                                    }
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1194 } },
                                  "value": " fields into a new\n"
                                },
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 1194 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1194 } },
                                      "value": "sales"
                                    }
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1194 } },
                                  "value": " field. For example:"
                                }
                              ]
                            },
                            {
                              "type": "code",
                              "position": { "start": { "line": 1198 } },
                              "lang": "javascript",
                              "copyable": false,
                              "emphasize_lines": [],
                              "value": "{ \"_id\" : \"2019Q2\", \"sales\" : 500 }\n{ \"_id\" : \"2019Q1\", \"sales\" : 1950 }",
                              "linenos": false
                            }
                          ],
                          "term": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1202 } },
                              "value": "First stage:"
                            }
                          ]
                        },
                        {
                          "type": "definitionListItem",
                          "position": { "start": { "line": 1209 } },
                          "children": [
                            {
                              "type": "paragraph",
                              "position": { "start": { "line": 1205 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1205 } },
                                  "value": "The "
                                },
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 1205 } },
                                  "children": [
                                    {
                                      "type": "literal",
                                      "position": { "start": { "line": 1205 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 1205 }
                                          },
                                          "value": "$merge"
                                        }
                                      ]
                                    }
                                  ],
                                  "domain": "mongodb",
                                  "name": "pipeline",
                                  "target": "pipe.$merge",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/merge",
                                    "mongodb-pipeline-pipe.-merge"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1205 } },
                                  "value": " stage writes the documents to the\n"
                                },
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 1205 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1205 } },
                                      "value": "quarterlyreport"
                                    }
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1205 } },
                                  "value": " collection in the same database. If the stage\nfinds an existing document in the collection that "
                                },
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 1205 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1205 } },
                                      "value": "matches\non"
                                    }
                                  ],
                                  "domain": "std",
                                  "name": "label",
                                  "target": "merge-on",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/merge",
                                    "std-label-merge-on"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1205 } },
                                  "value": " the "
                                },
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 1205 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1205 } },
                                      "value": "_id"
                                    }
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1205 } },
                                  "value": " field (the quarter), the stage merges\nthe matching documents. Otherwise, the stage inserts the document."
                                }
                              ]
                            }
                          ],
                          "term": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1209 } },
                              "value": "Second stage:"
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 1211 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 1211 } },
                          "value": "To view the documents in the "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 1211 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1211 } },
                              "value": "quarterlyreport"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 1211 } },
                          "value": " collection after\nthe data has been merged, run the following operation:"
                        }
                      ]
                    },
                    {
                      "type": "code",
                      "position": { "start": { "line": 1214 } },
                      "lang": "javascript",
                      "copyable": true,
                      "emphasize_lines": [],
                      "value": "db.quarterlyreport.find().sort( { _id: 1 } )",
                      "linenos": false
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 1218 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 1218 } },
                          "value": "The collection contains the following documents:"
                        }
                      ]
                    },
                    {
                      "type": "code",
                      "position": { "start": { "line": 1220 } },
                      "lang": "javascript",
                      "copyable": false,
                      "emphasize_lines": [],
                      "value": "{ \"_id\" : \"2019Q1\", \"sales\" : 1950, \"purchased\" : 1200 }\n{ \"_id\" : \"2019Q2\", \"sales\" : 500, \"purchased\" : 1700 }",
                      "linenos": false
                    }
                  ]
                },
                {
                  "type": "section",
                  "position": { "start": { "line": 1227 } },
                  "children": [
                    {
                      "type": "heading",
                      "position": { "start": { "line": 1227 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 1227 } },
                          "value": "Use the Pipeline to Customize the Merge"
                        }
                      ],
                      "id": "use-the-pipeline-to-customize-the-merge"
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 1229 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 1229 } },
                          "value": "The "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 1229 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 1229 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1229 } },
                                  "value": "$merge"
                                }
                              ]
                            }
                          ],
                          "domain": "mongodb",
                          "name": "pipeline",
                          "target": "pipe.$merge",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "mongodb-pipeline-pipe.-merge"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 1229 } },
                          "value": " can use a "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 1229 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1229 } },
                              "value": "custom update pipeline"
                            }
                          ],
                          "domain": "std",
                          "name": "label",
                          "target": "merge-whenMatched-pipeline",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "std-label-merge-whenMatched-pipeline"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 1229 } },
                          "value": " when documents match. The\n"
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 1229 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1229 } },
                              "value": "whenMatched pipeline"
                            }
                          ],
                          "domain": "std",
                          "name": "label",
                          "target": "merge-whenMatched-pipeline",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "std-label-merge-whenMatched-pipeline"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 1229 } },
                          "value": " can have\nthe following stages:"
                        }
                      ]
                    },
                    {
                      "type": "list",
                      "position": { "start": { "line": 1234 } },
                      "children": [
                        {
                          "type": "listItem",
                          "position": { "start": { "line": 1234 } },
                          "children": [
                            {
                              "type": "paragraph",
                              "position": { "start": { "line": 1234 } },
                              "children": [
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 1234 } },
                                  "children": [
                                    {
                                      "type": "literal",
                                      "position": { "start": { "line": 1234 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 1234 }
                                          },
                                          "value": "$addFields"
                                        }
                                      ]
                                    }
                                  ],
                                  "domain": "mongodb",
                                  "name": "pipeline",
                                  "target": "pipe.$addFields",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/addFields",
                                    "mongodb-pipeline-pipe.-addFields"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1234 } },
                                  "value": " and its alias "
                                },
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 1234 } },
                                  "children": [
                                    {
                                      "type": "literal",
                                      "position": { "start": { "line": 1234 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 1234 }
                                          },
                                          "value": "$set"
                                        }
                                      ]
                                    }
                                  ],
                                  "domain": "mongodb",
                                  "name": "pipeline",
                                  "target": "pipe.$set",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/set",
                                    "mongodb-pipeline-pipe.-set"
                                  ]
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "type": "listItem",
                          "position": { "start": { "line": 1234 } },
                          "children": [
                            {
                              "type": "paragraph",
                              "position": { "start": { "line": 1235 } },
                              "children": [
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 1235 } },
                                  "children": [
                                    {
                                      "type": "literal",
                                      "position": { "start": { "line": 1235 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 1235 }
                                          },
                                          "value": "$project"
                                        }
                                      ]
                                    }
                                  ],
                                  "domain": "mongodb",
                                  "name": "pipeline",
                                  "target": "pipe.$project",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/project",
                                    "mongodb-pipeline-pipe.-project"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1235 } },
                                  "value": " and its alias "
                                },
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 1235 } },
                                  "children": [
                                    {
                                      "type": "literal",
                                      "position": { "start": { "line": 1235 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 1235 }
                                          },
                                          "value": "$unset"
                                        }
                                      ]
                                    }
                                  ],
                                  "domain": "mongodb",
                                  "name": "pipeline",
                                  "target": "pipe.$unset",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/unset",
                                    "mongodb-pipeline-pipe.-unset"
                                  ]
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "type": "listItem",
                          "position": { "start": { "line": 1234 } },
                          "children": [
                            {
                              "type": "paragraph",
                              "position": { "start": { "line": 1236 } },
                              "children": [
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 1236 } },
                                  "children": [
                                    {
                                      "type": "literal",
                                      "position": { "start": { "line": 1236 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 1236 }
                                          },
                                          "value": "$replaceRoot"
                                        }
                                      ]
                                    }
                                  ],
                                  "domain": "mongodb",
                                  "name": "pipeline",
                                  "target": "pipe.$replaceRoot",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/replaceRoot",
                                    "mongodb-pipeline-pipe.-replaceRoot"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1236 } },
                                  "value": " and its alias "
                                },
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 1236 } },
                                  "children": [
                                    {
                                      "type": "literal",
                                      "position": { "start": { "line": 1236 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 1236 }
                                          },
                                          "value": "$replaceWith"
                                        }
                                      ]
                                    }
                                  ],
                                  "domain": "mongodb",
                                  "name": "pipeline",
                                  "target": "pipe.$replaceWith",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/replaceWith",
                                    "mongodb-pipeline-pipe.-replaceWith"
                                  ]
                                }
                              ]
                            }
                          ]
                        }
                      ],
                      "enumtype": "unordered"
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 1238 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 1238 } },
                          "value": "An example collection "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 1238 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1238 } },
                              "value": "votes"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 1238 } },
                          "value": " is populated with the daily vote\ntally. Create the collection with the following documents:s"
                        }
                      ]
                    },
                    {
                      "type": "code",
                      "position": { "start": { "line": 1241 } },
                      "lang": "javascript",
                      "copyable": true,
                      "emphasize_lines": [],
                      "value": "db.votes.insertMany( [\n   { date: new Date(\"2019-05-01\"), \"thumbsup\" : 1, \"thumbsdown\" : 1 },\n   { date: new Date(\"2019-05-02\"), \"thumbsup\" : 3, \"thumbsdown\" : 1 },\n   { date: new Date(\"2019-05-03\"), \"thumbsup\" : 1, \"thumbsdown\" : 1 },\n   { date: new Date(\"2019-05-04\"), \"thumbsup\" : 2, \"thumbsdown\" : 2 },\n   { date: new Date(\"2019-05-05\"), \"thumbsup\" : 6, \"thumbsdown\" : 10 },\n   { date: new Date(\"2019-05-06\"), \"thumbsup\" : 13, \"thumbsdown\" : 16 }\n] )",
                      "linenos": false
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 1252 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 1252 } },
                          "value": "Another example collection "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 1252 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1252 } },
                              "value": "monthlytotals"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 1252 } },
                          "value": " has the up-to-date\nmonthly vote totals. Create the collection with the following\ndocument:"
                        }
                      ]
                    },
                    {
                      "type": "code",
                      "position": { "start": { "line": 1256 } },
                      "lang": "javascript",
                      "copyable": true,
                      "emphasize_lines": [],
                      "value": "db.monthlytotals.insertOne(\n   { \"_id\" : \"2019-05\", \"thumbsup\" : 26, \"thumbsdown\" : 31 }\n)",
                      "linenos": false
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 1262 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 1262 } },
                          "value": "At the end of each day, that day's votes is inserted into the\n"
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 1262 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1262 } },
                              "value": "votes"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 1262 } },
                          "value": " collection:"
                        }
                      ]
                    },
                    {
                      "type": "code",
                      "position": { "start": { "line": 1265 } },
                      "lang": "javascript",
                      "copyable": true,
                      "emphasize_lines": [],
                      "value": "db.votes.insertOne(\n   { date: new Date(\"2019-05-07\"), \"thumbsup\" : 14, \"thumbsdown\" : 10 }\n)",
                      "linenos": false
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 1271 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 1271 } },
                          "value": "You can use "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 1271 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 1271 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1271 } },
                                  "value": "$merge"
                                }
                              ]
                            }
                          ],
                          "domain": "mongodb",
                          "name": "pipeline",
                          "target": "pipe.$merge",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "mongodb-pipeline-pipe.-merge"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 1271 } },
                          "value": " with an custom pipeline to update the\nexisting document in the collection "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 1271 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1271 } },
                              "value": "monthlytotals"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 1271 } },
                          "value": ":"
                        }
                      ]
                    },
                    {
                      "type": "code",
                      "position": { "start": { "line": 1274 } },
                      "lang": "javascript",
                      "copyable": true,
                      "emphasize_lines": [],
                      "value": "db.votes.aggregate([\n   { $match: { date: { $gte: new Date(\"2019-05-07\"), $lt: new Date(\"2019-05-08\") } } },\n   { $project: { _id: { $dateToString: { format: \"%Y-%m\", date: \"$date\" } }, thumbsup: 1, thumbsdown: 1 } },\n   { $merge: {\n         into: \"monthlytotals\",\n         on: \"_id\",\n         whenMatched:  [\n            { $addFields: {\n                thumbsup: { $add:[ \"$thumbsup\", \"$$new.thumbsup\" ] },\n                thumbsdown: { $add: [ \"$thumbsdown\", \"$$new.thumbsdown\" ] }\n            } } ],\n         whenNotMatched: \"insert\"\n   } }\n])",
                      "linenos": false
                    },
                    {
                      "type": "definitionList",
                      "position": { "start": { "line": 1227 } },
                      "children": [
                        {
                          "type": "definitionListItem",
                          "position": { "start": { "line": 1298 } },
                          "children": [
                            {
                              "type": "paragraph",
                              "position": { "start": { "line": 1292 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1292 } },
                                  "value": "The "
                                },
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 1292 } },
                                  "children": [
                                    {
                                      "type": "literal",
                                      "position": { "start": { "line": 1292 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 1292 }
                                          },
                                          "value": "$match"
                                        }
                                      ]
                                    }
                                  ],
                                  "domain": "mongodb",
                                  "name": "pipeline",
                                  "target": "pipe.$match",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/match",
                                    "mongodb-pipeline-pipe.-match"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1292 } },
                                  "value": " stage finds the specific day's votes. For\nexample:"
                                }
                              ]
                            },
                            {
                              "type": "code",
                              "position": { "start": { "line": 1295 } },
                              "lang": "javascript",
                              "copyable": false,
                              "emphasize_lines": [],
                              "value": "{ \"_id\" : ObjectId(\"5ce6097c436eb7e1203064a6\"), \"date\" : ISODate(\"2019-05-07T00:00:00Z\"), \"thumbsup\" : 14, \"thumbsdown\" : 10 }",
                              "linenos": false
                            }
                          ],
                          "term": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1298 } },
                              "value": "First stage:"
                            }
                          ]
                        },
                        {
                          "type": "definitionListItem",
                          "position": { "start": { "line": 1307 } },
                          "children": [
                            {
                              "type": "paragraph",
                              "position": { "start": { "line": 1301 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1301 } },
                                  "value": "The "
                                },
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 1301 } },
                                  "children": [
                                    {
                                      "type": "literal",
                                      "position": { "start": { "line": 1301 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 1301 }
                                          },
                                          "value": "$project"
                                        }
                                      ]
                                    }
                                  ],
                                  "domain": "mongodb",
                                  "name": "pipeline",
                                  "target": "pipe.$project",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/project",
                                    "mongodb-pipeline-pipe.-project"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1301 } },
                                  "value": " stage sets the "
                                },
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 1301 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1301 } },
                                      "value": "_id"
                                    }
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1301 } },
                                  "value": " field to a\nyear-month string. For example:"
                                }
                              ]
                            },
                            {
                              "type": "code",
                              "position": { "start": { "line": 1304 } },
                              "lang": "javascript",
                              "copyable": false,
                              "emphasize_lines": [],
                              "value": "{ \"thumbsup\" : 14, \"thumbsdown\" : 10, \"_id\" : \"2019-05\" }",
                              "linenos": false
                            }
                          ],
                          "term": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1307 } },
                              "value": "Second stage:"
                            }
                          ]
                        },
                        {
                          "type": "definitionListItem",
                          "position": { "start": { "line": 1326 } },
                          "children": [
                            {
                              "type": "paragraph",
                              "position": { "start": { "line": 1310 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1310 } },
                                  "value": "The "
                                },
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 1310 } },
                                  "children": [
                                    {
                                      "type": "literal",
                                      "position": { "start": { "line": 1310 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 1310 }
                                          },
                                          "value": "$merge"
                                        }
                                      ]
                                    }
                                  ],
                                  "domain": "mongodb",
                                  "name": "pipeline",
                                  "target": "pipe.$merge",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/merge",
                                    "mongodb-pipeline-pipe.-merge"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1310 } },
                                  "value": " stage writes the documents to the\n"
                                },
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 1310 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1310 } },
                                      "value": "monthlytotals"
                                    }
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1310 } },
                                  "value": " collection in the same database. If the stage\nfinds an existing document in the collection that "
                                },
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 1310 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1310 } },
                                      "value": "matches\non"
                                    }
                                  ],
                                  "domain": "std",
                                  "name": "label",
                                  "target": "merge-on",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/merge",
                                    "std-label-merge-on"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1310 } },
                                  "value": " the "
                                },
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 1310 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1310 } },
                                      "value": "_id"
                                    }
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1310 } },
                                  "value": " field, the stage uses a pipeline to\nadd the "
                                },
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 1310 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1310 } },
                                      "value": "thumbsup"
                                    }
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1310 } },
                                  "value": " votes and the "
                                },
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 1310 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1310 } },
                                      "value": "thumbsdown"
                                    }
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1310 } },
                                  "value": " votes."
                                }
                              ]
                            },
                            {
                              "type": "list",
                              "position": { "start": { "line": 1316 } },
                              "children": [
                                {
                                  "type": "listItem",
                                  "position": { "start": { "line": 1316 } },
                                  "children": [
                                    {
                                      "type": "paragraph",
                                      "position": { "start": { "line": 1316 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 1316 }
                                          },
                                          "value": "This pipeline cannot directly accesses the fields from the\nresults document. To access the "
                                        },
                                        {
                                          "type": "literal",
                                          "position": {
                                            "start": { "line": 1316 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 1316 }
                                              },
                                              "value": "thumbsup"
                                            }
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 1316 }
                                          },
                                          "value": " field and the\n"
                                        },
                                        {
                                          "type": "literal",
                                          "position": {
                                            "start": { "line": 1316 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 1316 }
                                              },
                                              "value": "thumbsdown"
                                            }
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 1316 }
                                          },
                                          "value": " field in the results document, the pipeline uses\nthe "
                                        },
                                        {
                                          "type": "literal",
                                          "position": {
                                            "start": { "line": 1316 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 1316 }
                                              },
                                              "value": "$$new"
                                            }
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 1316 }
                                          },
                                          "value": " variable; i.e. "
                                        },
                                        {
                                          "type": "literal",
                                          "position": {
                                            "start": { "line": 1316 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 1316 }
                                              },
                                              "value": "$$new.thumbsup"
                                            }
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 1316 }
                                          },
                                          "value": " and\n"
                                        },
                                        {
                                          "type": "literal",
                                          "position": {
                                            "start": { "line": 1316 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 1316 }
                                              },
                                              "value": "$new.thumbsdown"
                                            }
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 1316 }
                                          },
                                          "value": "."
                                        }
                                      ]
                                    }
                                  ]
                                },
                                {
                                  "type": "listItem",
                                  "position": { "start": { "line": 1316 } },
                                  "children": [
                                    {
                                      "type": "paragraph",
                                      "position": { "start": { "line": 1322 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 1322 }
                                          },
                                          "value": "This pipeline can directly accesses the "
                                        },
                                        {
                                          "type": "literal",
                                          "position": {
                                            "start": { "line": 1322 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 1322 }
                                              },
                                              "value": "thumbsup"
                                            }
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 1322 }
                                          },
                                          "value": " field\nand the "
                                        },
                                        {
                                          "type": "literal",
                                          "position": {
                                            "start": { "line": 1322 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 1322 }
                                              },
                                              "value": "thumbsdown"
                                            }
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 1322 }
                                          },
                                          "value": " field in the existing document in the\ncollection; i.e. "
                                        },
                                        {
                                          "type": "literal",
                                          "position": {
                                            "start": { "line": 1322 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 1322 }
                                              },
                                              "value": "$thumbsup"
                                            }
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 1322 }
                                          },
                                          "value": " and "
                                        },
                                        {
                                          "type": "literal",
                                          "position": {
                                            "start": { "line": 1322 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 1322 }
                                              },
                                              "value": "$thumbsdown"
                                            }
                                          ]
                                        },
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 1322 }
                                          },
                                          "value": "."
                                        }
                                      ]
                                    }
                                  ]
                                }
                              ],
                              "enumtype": "unordered"
                            },
                            {
                              "type": "paragraph",
                              "position": { "start": { "line": 1326 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1326 } },
                                  "value": "The resulting document replaces the existing document."
                                }
                              ]
                            }
                          ],
                          "term": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1326 } },
                              "value": "Third stage:"
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 1328 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 1328 } },
                          "value": "To view documents in the "
                        },
                        {
                          "type": "literal",
                          "position": { "start": { "line": 1328 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1328 } },
                              "value": "monthlytotals"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 1328 } },
                          "value": " collection after the merge\noperation, run the following operation:"
                        }
                      ]
                    },
                    {
                      "type": "code",
                      "position": { "start": { "line": 1331 } },
                      "lang": "javascript",
                      "copyable": true,
                      "emphasize_lines": [],
                      "value": "db.monthlytotals.find()",
                      "linenos": false
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 1335 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 1335 } },
                          "value": "The collection contains the following document:"
                        }
                      ]
                    },
                    {
                      "type": "code",
                      "position": { "start": { "line": 1337 } },
                      "lang": "javascript",
                      "copyable": false,
                      "emphasize_lines": [],
                      "value": "{ \"_id\" : \"2019-05\", \"thumbsup\" : 40, \"thumbsdown\" : 41 }",
                      "linenos": false
                    },
                    {
                      "type": "target",
                      "position": { "start": { "line": 1342 } },
                      "children": [
                        {
                          "type": "target_identifier",
                          "position": { "start": { "line": 1342 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1345 } },
                              "value": "Use Variables to Customize the Merge"
                            }
                          ],
                          "ids": ["merge-variables-example"]
                        }
                      ],
                      "domain": "std",
                      "name": "label",
                      "html_id": "std-label-merge-variables-example"
                    }
                  ]
                },
                {
                  "type": "section",
                  "position": { "start": { "line": 1345 } },
                  "children": [
                    {
                      "type": "heading",
                      "position": { "start": { "line": 1345 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 1345 } },
                          "value": "Use Variables to Customize the Merge"
                        }
                      ],
                      "id": "use-variables-to-customize-the-merge"
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 1347 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 1347 } },
                          "value": "You can use variables in the "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 1347 } },
                          "children": [
                            {
                              "type": "literal",
                              "position": { "start": { "line": 1347 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1347 } },
                                  "value": "$merge"
                                }
                              ]
                            }
                          ],
                          "domain": "mongodb",
                          "name": "pipeline",
                          "target": "pipe.$merge",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "mongodb-pipeline-pipe.-merge"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 1347 } },
                          "value": " stage\n"
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 1347 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1347 } },
                              "value": "whenMatched"
                            }
                          ],
                          "domain": "std",
                          "name": "label",
                          "target": "merge-whenMatched-pipeline",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "std-label-merge-whenMatched-pipeline"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 1347 } },
                          "value": " field. Variables must\nbe defined before they can be used."
                        }
                      ]
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 1351 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 1351 } },
                          "value": "Define variables in one or both of the following:"
                        }
                      ]
                    },
                    {
                      "type": "list",
                      "position": { "start": { "line": 1353 } },
                      "children": [
                        {
                          "type": "listItem",
                          "position": { "start": { "line": 1353 } },
                          "children": [
                            {
                              "type": "paragraph",
                              "position": { "start": { "line": 1353 } },
                              "children": [
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 1353 } },
                                  "children": [
                                    {
                                      "type": "literal",
                                      "position": { "start": { "line": 1353 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 1353 }
                                          },
                                          "value": "$merge"
                                        }
                                      ]
                                    }
                                  ],
                                  "domain": "mongodb",
                                  "name": "pipeline",
                                  "target": "pipe.$merge",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/merge",
                                    "mongodb-pipeline-pipe.-merge"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1353 } },
                                  "value": " stage "
                                },
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 1353 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1353 } },
                                      "value": "let"
                                    }
                                  ],
                                  "domain": "std",
                                  "name": "label",
                                  "target": "merge-let",
                                  "flag": "",
                                  "fileid": [
                                    "reference/operator/aggregation/merge",
                                    "std-label-merge-let"
                                  ]
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "type": "listItem",
                          "position": { "start": { "line": 1353 } },
                          "children": [
                            {
                              "type": "paragraph",
                              "position": { "start": { "line": 1355 } },
                              "children": [
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 1355 } },
                                  "children": [
                                    {
                                      "type": "literal",
                                      "position": { "start": { "line": 1355 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 1355 }
                                          },
                                          "value": "aggregate"
                                        }
                                      ]
                                    }
                                  ],
                                  "domain": "mongodb",
                                  "name": "dbcommand",
                                  "target": "dbcmd.aggregate",
                                  "flag": "",
                                  "fileid": [
                                    "reference/command/aggregate",
                                    "mongodb-dbcommand-dbcmd.aggregate"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1355 } },
                                  "value": " command\n"
                                },
                                {
                                  "type": "ref_role",
                                  "position": { "start": { "line": 1355 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1355 } },
                                      "value": "let"
                                    }
                                  ],
                                  "domain": "std",
                                  "name": "label",
                                  "target": "aggregate-let-option",
                                  "flag": "",
                                  "fileid": [
                                    "reference/command/aggregate",
                                    "std-label-aggregate-let-option"
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 1355 } },
                                  "value": " (starting in MongoDB 5.0)"
                                }
                              ]
                            }
                          ]
                        }
                      ],
                      "enumtype": "unordered"
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 1358 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 1358 } },
                          "value": "To use variables in "
                        },
                        {
                          "type": "ref_role",
                          "position": { "start": { "line": 1358 } },
                          "children": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1358 } },
                              "value": "whenMatched"
                            }
                          ],
                          "domain": "std",
                          "name": "label",
                          "target": "merge-whenMatched-pipeline",
                          "flag": "",
                          "fileid": [
                            "reference/operator/aggregation/merge",
                            "std-label-merge-whenMatched-pipeline"
                          ]
                        },
                        {
                          "type": "text",
                          "position": { "start": { "line": 1358 } },
                          "value": ":"
                        }
                      ]
                    },
                    {
                      "type": "directive",
                      "position": { "start": { "line": 1360 } },
                      "children": [
                        {
                          "type": "root",
                          "position": { "start": { "line": 0 } },
                          "children": [
                            {
                              "type": "paragraph",
                              "position": { "start": { "line": 0 } },
                              "children": [
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 0 } },
                                  "value": "Specify the double dollar sign ($$) prefix together with the variable\nname in the form "
                                },
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 0 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 0 } },
                                      "value": "$$<variable_name>"
                                    }
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 0 } },
                                  "value": ". For example, "
                                },
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 0 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 0 } },
                                      "value": "$$year"
                                    }
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 0 } },
                                  "value": ". If the\nvariable is set to a document, you can also include a document field in\nthe form "
                                },
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 0 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 0 } },
                                      "value": "$$<variable_name>.<field>"
                                    }
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 0 } },
                                  "value": ". For example, "
                                },
                                {
                                  "type": "literal",
                                  "position": { "start": { "line": 0 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 0 } },
                                      "value": "$$year.month"
                                    }
                                  ]
                                },
                                {
                                  "type": "text",
                                  "position": { "start": { "line": 0 } },
                                  "value": "."
                                }
                              ]
                            }
                          ],
                          "fileid": "includes/merge-stage-variables.rst"
                        }
                      ],
                      "domain": "",
                      "name": "include",
                      "argument": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 1360 } },
                          "value": "/includes/merge-stage-variables.rst"
                        }
                      ]
                    },
                    {
                      "type": "paragraph",
                      "position": { "start": { "line": 1362 } },
                      "children": [
                        {
                          "type": "text",
                          "position": { "start": { "line": 1362 } },
                          "value": "The tabs below demonstrate behavior when variables are defined in the\nmerge stage, the aggregate command, or both."
                        }
                      ]
                    },
                    {
                      "type": "directive",
                      "position": { "start": { "line": 1365 } },
                      "children": [
                        {
                          "type": "directive",
                          "position": { "start": { "line": 1367 } },
                          "children": [
                            {
                              "type": "section",
                              "position": { "start": { "line": 1371 } },
                              "children": [
                                {
                                  "type": "heading",
                                  "position": { "start": { "line": 1371 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1371 } },
                                      "value": "Use Variables Defined in the Merge Stage"
                                    }
                                  ],
                                  "id": "use-variables-defined-in-the-merge-stage"
                                },
                                {
                                  "type": "paragraph",
                                  "position": { "start": { "line": 1373 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1373 } },
                                      "value": "You can define variables in the "
                                    },
                                    {
                                      "type": "ref_role",
                                      "position": { "start": { "line": 1373 } },
                                      "children": [
                                        {
                                          "type": "literal",
                                          "position": {
                                            "start": { "line": 1373 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 1373 }
                                              },
                                              "value": "$merge"
                                            }
                                          ]
                                        }
                                      ],
                                      "domain": "mongodb",
                                      "name": "pipeline",
                                      "target": "pipe.$merge",
                                      "flag": "",
                                      "fileid": [
                                        "reference/operator/aggregation/merge",
                                        "mongodb-pipeline-pipe.-merge"
                                      ]
                                    },
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1373 } },
                                      "value": " stage\n"
                                    },
                                    {
                                      "type": "ref_role",
                                      "position": { "start": { "line": 1373 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 1373 }
                                          },
                                          "value": "let"
                                        }
                                      ],
                                      "domain": "std",
                                      "name": "label",
                                      "target": "merge-let",
                                      "flag": "",
                                      "fileid": [
                                        "reference/operator/aggregation/merge",
                                        "std-label-merge-let"
                                      ]
                                    },
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1373 } },
                                      "value": " and use the variables in the\n"
                                    },
                                    {
                                      "type": "ref_role",
                                      "position": { "start": { "line": 1373 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 1373 }
                                          },
                                          "value": "whenMatched"
                                        }
                                      ],
                                      "domain": "std",
                                      "name": "label",
                                      "target": "merge-whenMatched-pipeline",
                                      "flag": "",
                                      "fileid": [
                                        "reference/operator/aggregation/merge",
                                        "std-label-merge-whenMatched-pipeline"
                                      ]
                                    },
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1373 } },
                                      "value": " field."
                                    }
                                  ]
                                },
                                {
                                  "type": "paragraph",
                                  "position": { "start": { "line": 1377 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1377 } },
                                      "value": "Example:"
                                    }
                                  ]
                                },
                                {
                                  "type": "code",
                                  "position": { "start": { "line": 1379 } },
                                  "lang": "javascript",
                                  "copyable": true,
                                  "emphasize_lines": [],
                                  "value": "db.cakeSales.insertOne( [\n   { _id: 1, flavor: \"chocolate\", salesTotal: 1580,\n     salesTrend: \"up\" }\n] )\n\ndb.runCommand( {\n   aggregate: db.cakeSales.getName(),\n   pipeline: [ {\n      $merge: {\n         into: db.cakeSales.getName(),\n         let : { year: \"2020\" },\n         whenMatched: [ {\n            $addFields: { \"salesYear\": \"$$year\" }\n         } ]\n      }\n   } ],\n   cursor: {}\n} )\n\ndb.cakeSales.find()",
                                  "linenos": false
                                },
                                {
                                  "type": "paragraph",
                                  "position": { "start": { "line": 1402 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1402 } },
                                      "value": "The example:"
                                    }
                                  ]
                                },
                                {
                                  "type": "list",
                                  "position": { "start": { "line": 1404 } },
                                  "children": [
                                    {
                                      "type": "listItem",
                                      "position": { "start": { "line": 1404 } },
                                      "children": [
                                        {
                                          "type": "paragraph",
                                          "position": {
                                            "start": { "line": 1404 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 1404 }
                                              },
                                              "value": "creates a collection named "
                                            },
                                            {
                                              "type": "literal",
                                              "position": {
                                                "start": { "line": 1404 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 1404 }
                                                  },
                                                  "value": "cakeSales"
                                                }
                                              ]
                                            }
                                          ]
                                        }
                                      ]
                                    },
                                    {
                                      "type": "listItem",
                                      "position": { "start": { "line": 1404 } },
                                      "children": [
                                        {
                                          "type": "paragraph",
                                          "position": {
                                            "start": { "line": 1406 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 1406 }
                                              },
                                              "value": "runs an "
                                            },
                                            {
                                              "type": "ref_role",
                                              "position": {
                                                "start": { "line": 1406 }
                                              },
                                              "children": [
                                                {
                                                  "type": "literal",
                                                  "position": {
                                                    "start": { "line": 1406 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": {
                                                          "line": 1406
                                                        }
                                                      },
                                                      "value": "aggregate"
                                                    }
                                                  ]
                                                }
                                              ],
                                              "domain": "mongodb",
                                              "name": "dbcommand",
                                              "target": "dbcmd.aggregate",
                                              "flag": "",
                                              "fileid": [
                                                "reference/command/aggregate",
                                                "mongodb-dbcommand-dbcmd.aggregate"
                                              ]
                                            },
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 1406 }
                                              },
                                              "value": " command that defines a\n"
                                            },
                                            {
                                              "type": "literal",
                                              "position": {
                                                "start": { "line": 1406 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 1406 }
                                                  },
                                                  "value": "year"
                                                }
                                              ]
                                            },
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 1406 }
                                              },
                                              "value": " variable in the "
                                            },
                                            {
                                              "type": "ref_role",
                                              "position": {
                                                "start": { "line": 1406 }
                                              },
                                              "children": [
                                                {
                                                  "type": "literal",
                                                  "position": {
                                                    "start": { "line": 1406 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": {
                                                          "line": 1406
                                                        }
                                                      },
                                                      "value": "$merge"
                                                    }
                                                  ]
                                                }
                                              ],
                                              "domain": "mongodb",
                                              "name": "pipeline",
                                              "target": "pipe.$merge",
                                              "flag": "",
                                              "fileid": [
                                                "reference/operator/aggregation/merge",
                                                "mongodb-pipeline-pipe.-merge"
                                              ]
                                            },
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 1406 }
                                              },
                                              "value": " "
                                            },
                                            {
                                              "type": "ref_role",
                                              "position": {
                                                "start": { "line": 1406 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 1406 }
                                                  },
                                                  "value": "let"
                                                }
                                              ],
                                              "domain": "std",
                                              "name": "label",
                                              "target": "merge-let",
                                              "flag": "",
                                              "fileid": [
                                                "reference/operator/aggregation/merge",
                                                "std-label-merge-let"
                                              ]
                                            },
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 1406 }
                                              },
                                              "value": " and adds the year to "
                                            },
                                            {
                                              "type": "literal",
                                              "position": {
                                                "start": { "line": 1406 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 1406 }
                                                  },
                                                  "value": "cakeSales"
                                                }
                                              ]
                                            },
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 1406 }
                                              },
                                              "value": " using\n"
                                            },
                                            {
                                              "type": "ref_role",
                                              "position": {
                                                "start": { "line": 1406 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 1406 }
                                                  },
                                                  "value": "whenMatched"
                                                }
                                              ],
                                              "domain": "std",
                                              "name": "label",
                                              "target": "merge-whenMatched-pipeline",
                                              "flag": "",
                                              "fileid": [
                                                "reference/operator/aggregation/merge",
                                                "std-label-merge-whenMatched-pipeline"
                                              ]
                                            }
                                          ]
                                        }
                                      ]
                                    },
                                    {
                                      "type": "listItem",
                                      "position": { "start": { "line": 1404 } },
                                      "children": [
                                        {
                                          "type": "paragraph",
                                          "position": {
                                            "start": { "line": 1411 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 1411 }
                                              },
                                              "value": "retrieves the "
                                            },
                                            {
                                              "type": "literal",
                                              "position": {
                                                "start": { "line": 1411 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 1411 }
                                                  },
                                                  "value": "cakeSales"
                                                }
                                              ]
                                            },
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 1411 }
                                              },
                                              "value": " document"
                                            }
                                          ]
                                        }
                                      ]
                                    }
                                  ],
                                  "enumtype": "unordered"
                                },
                                {
                                  "type": "paragraph",
                                  "position": { "start": { "line": 1413 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1413 } },
                                      "value": "Output:"
                                    }
                                  ]
                                },
                                {
                                  "type": "code",
                                  "position": { "start": { "line": 1415 } },
                                  "lang": "javascript",
                                  "copyable": false,
                                  "emphasize_lines": [],
                                  "value": "{ \"_id\" : 1, \"flavor\" : \"chocolate\", \"salesTotal\" : 1580,\n  \"salesTrend\" : \"up\", \"salesYear\" : \"2020\" }",
                                  "linenos": false
                                }
                              ]
                            }
                          ],
                          "domain": "",
                          "name": "tab",
                          "argument": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1367 } },
                              "value": "Merge Stage"
                            }
                          ],
                          "options": {
                            "tabid": "merge-variables-in-merge-stage"
                          }
                        },
                        {
                          "type": "directive",
                          "position": { "start": { "line": 1421 } },
                          "children": [
                            {
                              "type": "section",
                              "position": { "start": { "line": 1425 } },
                              "children": [
                                {
                                  "type": "heading",
                                  "position": { "start": { "line": 1425 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1425 } },
                                      "value": "Use Variables Defined in the Aggregate Command"
                                    }
                                  ],
                                  "id": "use-variables-defined-in-the-aggregate-command"
                                },
                                {
                                  "type": "directive",
                                  "position": { "start": { "line": 1427 } },
                                  "children": [],
                                  "domain": "",
                                  "name": "versionadded",
                                  "argument": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1427 } },
                                      "value": "5.0"
                                    }
                                  ]
                                },
                                {
                                  "type": "paragraph",
                                  "position": { "start": { "line": 1429 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1429 } },
                                      "value": "You can define variables in the "
                                    },
                                    {
                                      "type": "ref_role",
                                      "position": { "start": { "line": 1429 } },
                                      "children": [
                                        {
                                          "type": "literal",
                                          "position": {
                                            "start": { "line": 1429 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 1429 }
                                              },
                                              "value": "aggregate"
                                            }
                                          ]
                                        }
                                      ],
                                      "domain": "mongodb",
                                      "name": "dbcommand",
                                      "target": "dbcmd.aggregate",
                                      "flag": "",
                                      "fileid": [
                                        "reference/command/aggregate",
                                        "mongodb-dbcommand-dbcmd.aggregate"
                                      ]
                                    },
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1429 } },
                                      "value": "\ncommand "
                                    },
                                    {
                                      "type": "ref_role",
                                      "position": { "start": { "line": 1429 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 1429 }
                                          },
                                          "value": "let"
                                        }
                                      ],
                                      "domain": "std",
                                      "name": "label",
                                      "target": "aggregate-let-option",
                                      "flag": "",
                                      "fileid": [
                                        "reference/command/aggregate",
                                        "std-label-aggregate-let-option"
                                      ]
                                    },
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1429 } },
                                      "value": " and use the\nvariables in the "
                                    },
                                    {
                                      "type": "ref_role",
                                      "position": { "start": { "line": 1429 } },
                                      "children": [
                                        {
                                          "type": "literal",
                                          "position": {
                                            "start": { "line": 1429 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 1429 }
                                              },
                                              "value": "$merge"
                                            }
                                          ]
                                        }
                                      ],
                                      "domain": "mongodb",
                                      "name": "pipeline",
                                      "target": "pipe.$merge",
                                      "flag": "",
                                      "fileid": [
                                        "reference/operator/aggregation/merge",
                                        "mongodb-pipeline-pipe.-merge"
                                      ]
                                    },
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1429 } },
                                      "value": " stage "
                                    },
                                    {
                                      "type": "ref_role",
                                      "position": { "start": { "line": 1429 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 1429 }
                                          },
                                          "value": "whenMatched"
                                        }
                                      ],
                                      "domain": "std",
                                      "name": "label",
                                      "target": "merge-whenMatched-pipeline",
                                      "flag": "",
                                      "fileid": [
                                        "reference/operator/aggregation/merge",
                                        "std-label-merge-whenMatched-pipeline"
                                      ]
                                    },
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1429 } },
                                      "value": " field."
                                    }
                                  ]
                                },
                                {
                                  "type": "paragraph",
                                  "position": { "start": { "line": 1434 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1434 } },
                                      "value": "Example:"
                                    }
                                  ]
                                },
                                {
                                  "type": "code",
                                  "position": { "start": { "line": 1436 } },
                                  "lang": "javascript",
                                  "copyable": true,
                                  "emphasize_lines": [],
                                  "value": "db.cakeSales.insertOne(\n   { _id: 1, flavor: \"chocolate\", salesTotal: 1580,\n     salesTrend: \"up\" }\n)\n\ndb.runCommand( {\n   aggregate: db.cakeSales.getName(),\n      pipeline: [ {\n         $merge: {\n            into: db.cakeSales.getName(),\n            whenMatched: [ {\n               $addFields: { \"salesYear\": \"$$year\" } }\n            ] }\n         }\n   ],\n   cursor: {},\n   let : { year: \"2020\" }\n} )\n\ndb.cakeSales.find()",
                                  "linenos": false
                                },
                                {
                                  "type": "paragraph",
                                  "position": { "start": { "line": 1459 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1459 } },
                                      "value": "The example:"
                                    }
                                  ]
                                },
                                {
                                  "type": "list",
                                  "position": { "start": { "line": 1461 } },
                                  "children": [
                                    {
                                      "type": "listItem",
                                      "position": { "start": { "line": 1461 } },
                                      "children": [
                                        {
                                          "type": "paragraph",
                                          "position": {
                                            "start": { "line": 1461 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 1461 }
                                              },
                                              "value": "creates a collection named "
                                            },
                                            {
                                              "type": "literal",
                                              "position": {
                                                "start": { "line": 1461 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 1461 }
                                                  },
                                                  "value": "cakeSales"
                                                }
                                              ]
                                            }
                                          ]
                                        }
                                      ]
                                    },
                                    {
                                      "type": "listItem",
                                      "position": { "start": { "line": 1461 } },
                                      "children": [
                                        {
                                          "type": "paragraph",
                                          "position": {
                                            "start": { "line": 1463 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 1463 }
                                              },
                                              "value": "runs an "
                                            },
                                            {
                                              "type": "ref_role",
                                              "position": {
                                                "start": { "line": 1463 }
                                              },
                                              "children": [
                                                {
                                                  "type": "literal",
                                                  "position": {
                                                    "start": { "line": 1463 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": {
                                                          "line": 1463
                                                        }
                                                      },
                                                      "value": "aggregate"
                                                    }
                                                  ]
                                                }
                                              ],
                                              "domain": "mongodb",
                                              "name": "dbcommand",
                                              "target": "dbcmd.aggregate",
                                              "flag": "",
                                              "fileid": [
                                                "reference/command/aggregate",
                                                "mongodb-dbcommand-dbcmd.aggregate"
                                              ]
                                            },
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 1463 }
                                              },
                                              "value": " command that defines a\n"
                                            },
                                            {
                                              "type": "literal",
                                              "position": {
                                                "start": { "line": 1463 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 1463 }
                                                  },
                                                  "value": "year"
                                                }
                                              ]
                                            },
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 1463 }
                                              },
                                              "value": " variable in the "
                                            },
                                            {
                                              "type": "ref_role",
                                              "position": {
                                                "start": { "line": 1463 }
                                              },
                                              "children": [
                                                {
                                                  "type": "literal",
                                                  "position": {
                                                    "start": { "line": 1463 }
                                                  },
                                                  "children": [
                                                    {
                                                      "type": "text",
                                                      "position": {
                                                        "start": {
                                                          "line": 1463
                                                        }
                                                      },
                                                      "value": "aggregate"
                                                    }
                                                  ]
                                                }
                                              ],
                                              "domain": "mongodb",
                                              "name": "dbcommand",
                                              "target": "dbcmd.aggregate",
                                              "flag": "",
                                              "fileid": [
                                                "reference/command/aggregate",
                                                "mongodb-dbcommand-dbcmd.aggregate"
                                              ]
                                            },
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 1463 }
                                              },
                                              "value": " command\n"
                                            },
                                            {
                                              "type": "ref_role",
                                              "position": {
                                                "start": { "line": 1463 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 1463 }
                                                  },
                                                  "value": "let"
                                                }
                                              ],
                                              "domain": "std",
                                              "name": "label",
                                              "target": "aggregate-let-option",
                                              "flag": "",
                                              "fileid": [
                                                "reference/command/aggregate",
                                                "std-label-aggregate-let-option"
                                              ]
                                            },
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 1463 }
                                              },
                                              "value": " and adds the year to\n"
                                            },
                                            {
                                              "type": "literal",
                                              "position": {
                                                "start": { "line": 1463 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 1463 }
                                                  },
                                                  "value": "cakeSales"
                                                }
                                              ]
                                            },
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 1463 }
                                              },
                                              "value": " using "
                                            },
                                            {
                                              "type": "ref_role",
                                              "position": {
                                                "start": { "line": 1463 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 1463 }
                                                  },
                                                  "value": "whenMatched"
                                                }
                                              ],
                                              "domain": "std",
                                              "name": "label",
                                              "target": "merge-whenMatched-pipeline",
                                              "flag": "",
                                              "fileid": [
                                                "reference/operator/aggregation/merge",
                                                "std-label-merge-whenMatched-pipeline"
                                              ]
                                            }
                                          ]
                                        }
                                      ]
                                    },
                                    {
                                      "type": "listItem",
                                      "position": { "start": { "line": 1461 } },
                                      "children": [
                                        {
                                          "type": "paragraph",
                                          "position": {
                                            "start": { "line": 1469 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 1469 }
                                              },
                                              "value": "retrieves the "
                                            },
                                            {
                                              "type": "literal",
                                              "position": {
                                                "start": { "line": 1469 }
                                              },
                                              "children": [
                                                {
                                                  "type": "text",
                                                  "position": {
                                                    "start": { "line": 1469 }
                                                  },
                                                  "value": "cakeSales"
                                                }
                                              ]
                                            },
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 1469 }
                                              },
                                              "value": " document"
                                            }
                                          ]
                                        }
                                      ]
                                    }
                                  ],
                                  "enumtype": "unordered"
                                },
                                {
                                  "type": "paragraph",
                                  "position": { "start": { "line": 1471 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1471 } },
                                      "value": "Output:"
                                    }
                                  ]
                                },
                                {
                                  "type": "code",
                                  "position": { "start": { "line": 1473 } },
                                  "lang": "javascript",
                                  "copyable": false,
                                  "emphasize_lines": [],
                                  "value": "{ \"_id\" : 1, \"flavor\" : \"chocolate\", \"salesTotal\" : 1580,\n  \"salesTrend\" : \"up\", \"salesYear\" : \"2020\" }",
                                  "linenos": false
                                }
                              ]
                            }
                          ],
                          "domain": "",
                          "name": "tab",
                          "argument": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1421 } },
                              "value": "Aggregate Command"
                            }
                          ],
                          "options": {
                            "tabid": "merge-variables-in-aggregate-command"
                          }
                        },
                        {
                          "type": "directive",
                          "position": { "start": { "line": 1479 } },
                          "children": [
                            {
                              "type": "section",
                              "position": { "start": { "line": 1483 } },
                              "children": [
                                {
                                  "type": "heading",
                                  "position": { "start": { "line": 1483 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1483 } },
                                      "value": "Use Variables Defined in the Merge Stage and Aggregate Command"
                                    }
                                  ],
                                  "id": "use-variables-defined-in-the-merge-stage-and-aggregate-command"
                                },
                                {
                                  "type": "paragraph",
                                  "position": { "start": { "line": 1485 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1485 } },
                                      "value": "You can define variables in the "
                                    },
                                    {
                                      "type": "ref_role",
                                      "position": { "start": { "line": 1485 } },
                                      "children": [
                                        {
                                          "type": "literal",
                                          "position": {
                                            "start": { "line": 1485 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 1485 }
                                              },
                                              "value": "$merge"
                                            }
                                          ]
                                        }
                                      ],
                                      "domain": "mongodb",
                                      "name": "pipeline",
                                      "target": "pipe.$merge",
                                      "flag": "",
                                      "fileid": [
                                        "reference/operator/aggregation/merge",
                                        "mongodb-pipeline-pipe.-merge"
                                      ]
                                    },
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1485 } },
                                      "value": " stage\nand, starting in MongoDB 5.0, the "
                                    },
                                    {
                                      "type": "ref_role",
                                      "position": { "start": { "line": 1485 } },
                                      "children": [
                                        {
                                          "type": "literal",
                                          "position": {
                                            "start": { "line": 1485 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 1485 }
                                              },
                                              "value": "aggregate"
                                            }
                                          ]
                                        }
                                      ],
                                      "domain": "mongodb",
                                      "name": "dbcommand",
                                      "target": "dbcmd.aggregate",
                                      "flag": "",
                                      "fileid": [
                                        "reference/command/aggregate",
                                        "mongodb-dbcommand-dbcmd.aggregate"
                                      ]
                                    },
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1485 } },
                                      "value": "\ncommand."
                                    }
                                  ]
                                },
                                {
                                  "type": "paragraph",
                                  "position": { "start": { "line": 1489 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1489 } },
                                      "value": "If two variables with the same name are defined in the\n"
                                    },
                                    {
                                      "type": "ref_role",
                                      "position": { "start": { "line": 1489 } },
                                      "children": [
                                        {
                                          "type": "literal",
                                          "position": {
                                            "start": { "line": 1489 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 1489 }
                                              },
                                              "value": "$merge"
                                            }
                                          ]
                                        }
                                      ],
                                      "domain": "mongodb",
                                      "name": "pipeline",
                                      "target": "pipe.$merge",
                                      "flag": "",
                                      "fileid": [
                                        "reference/operator/aggregation/merge",
                                        "mongodb-pipeline-pipe.-merge"
                                      ]
                                    },
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1489 } },
                                      "value": " stage and the "
                                    },
                                    {
                                      "type": "ref_role",
                                      "position": { "start": { "line": 1489 } },
                                      "children": [
                                        {
                                          "type": "literal",
                                          "position": {
                                            "start": { "line": 1489 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 1489 }
                                              },
                                              "value": "aggregate"
                                            }
                                          ]
                                        }
                                      ],
                                      "domain": "mongodb",
                                      "name": "dbcommand",
                                      "target": "dbcmd.aggregate",
                                      "flag": "",
                                      "fileid": [
                                        "reference/command/aggregate",
                                        "mongodb-dbcommand-dbcmd.aggregate"
                                      ]
                                    },
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1489 } },
                                      "value": "\ncommand, the "
                                    },
                                    {
                                      "type": "ref_role",
                                      "position": { "start": { "line": 1489 } },
                                      "children": [
                                        {
                                          "type": "literal",
                                          "position": {
                                            "start": { "line": 1489 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 1489 }
                                              },
                                              "value": "$merge"
                                            }
                                          ]
                                        }
                                      ],
                                      "domain": "mongodb",
                                      "name": "pipeline",
                                      "target": "pipe.$merge",
                                      "flag": "",
                                      "fileid": [
                                        "reference/operator/aggregation/merge",
                                        "mongodb-pipeline-pipe.-merge"
                                      ]
                                    },
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1489 } },
                                      "value": " stage variable is used."
                                    }
                                  ]
                                },
                                {
                                  "type": "paragraph",
                                  "position": { "start": { "line": 1493 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1493 } },
                                      "value": "In this example, the "
                                    },
                                    {
                                      "type": "literal",
                                      "position": { "start": { "line": 1493 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 1493 }
                                          },
                                          "value": "year: \"2020\""
                                        }
                                      ]
                                    },
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1493 } },
                                      "value": " "
                                    },
                                    {
                                      "type": "ref_role",
                                      "position": { "start": { "line": 1493 } },
                                      "children": [
                                        {
                                          "type": "literal",
                                          "position": {
                                            "start": { "line": 1493 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 1493 }
                                              },
                                              "value": "$merge"
                                            }
                                          ]
                                        }
                                      ],
                                      "domain": "mongodb",
                                      "name": "pipeline",
                                      "target": "pipe.$merge",
                                      "flag": "",
                                      "fileid": [
                                        "reference/operator/aggregation/merge",
                                        "mongodb-pipeline-pipe.-merge"
                                      ]
                                    },
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1493 } },
                                      "value": "\nstage variable is used instead of the "
                                    },
                                    {
                                      "type": "literal",
                                      "position": { "start": { "line": 1493 } },
                                      "children": [
                                        {
                                          "type": "text",
                                          "position": {
                                            "start": { "line": 1493 }
                                          },
                                          "value": "year: \"2019\""
                                        }
                                      ]
                                    },
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1493 } },
                                      "value": "\n"
                                    },
                                    {
                                      "type": "ref_role",
                                      "position": { "start": { "line": 1493 } },
                                      "children": [
                                        {
                                          "type": "literal",
                                          "position": {
                                            "start": { "line": 1493 }
                                          },
                                          "children": [
                                            {
                                              "type": "text",
                                              "position": {
                                                "start": { "line": 1493 }
                                              },
                                              "value": "aggregate"
                                            }
                                          ]
                                        }
                                      ],
                                      "domain": "mongodb",
                                      "name": "dbcommand",
                                      "target": "dbcmd.aggregate",
                                      "flag": "",
                                      "fileid": [
                                        "reference/command/aggregate",
                                        "mongodb-dbcommand-dbcmd.aggregate"
                                      ]
                                    },
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1493 } },
                                      "value": " command variable:"
                                    }
                                  ]
                                },
                                {
                                  "type": "code",
                                  "position": { "start": { "line": 1497 } },
                                  "lang": "javascript",
                                  "copyable": true,
                                  "emphasize_lines": [],
                                  "value": "db.cakeSales.insertOne(\n   { _id: 1, flavor: \"chocolate\", salesTotal: 1580,\n     salesTrend: \"up\" }\n)\n\ndb.runCommand( {\n   aggregate: db.cakeSales.getName(),\n      pipeline: [ {\n         $merge: {\n            into: db.cakeSales.getName(),\n            let : { year: \"2020\" },\n            whenMatched: [ {\n               $addFields: { \"salesYear\": \"$$year\" }\n            } ]\n         }\n      } ],\n   cursor: {},\n   let : { year: \"2019\" }\n} )\n\ndb.cakeSales.find()",
                                  "linenos": false
                                },
                                {
                                  "type": "paragraph",
                                  "position": { "start": { "line": 1521 } },
                                  "children": [
                                    {
                                      "type": "text",
                                      "position": { "start": { "line": 1521 } },
                                      "value": "Output:"
                                    }
                                  ]
                                },
                                {
                                  "type": "code",
                                  "position": { "start": { "line": 1523 } },
                                  "lang": "javascript",
                                  "copyable": false,
                                  "emphasize_lines": [],
                                  "value": "{\n  _id: 1,\n  flavor: 'chocolate',\n  salesTotal: 1580,\n  salesTrend: 'up',\n  salesYear: '2020'\n}",
                                  "linenos": false
                                }
                              ]
                            }
                          ],
                          "domain": "",
                          "name": "tab",
                          "argument": [
                            {
                              "type": "text",
                              "position": { "start": { "line": 1479 } },
                              "value": "Merge and Aggregate"
                            }
                          ],
                          "options": { "tabid": "merge-variables-scope" }
                        }
                      ],
                      "domain": "",
                      "name": "tabs",
                      "argument": []
                    }
                  ]
                }
              ]
            }
          ]
        }
      ],
      "fileid": "reference/operator/aggregation/merge.txt",
      "options": {
        "headings": [
          {
            "depth": 2,
            "id": "definition",
            "title": [
              {
                "type": "text",
                "position": { "start": { "line": 19 } },
                "value": "Definition"
              }
            ]
          },
          {
            "depth": 2,
            "id": "syntax",
            "title": [
              {
                "type": "text",
                "position": { "start": { "line": 92 } },
                "value": "Syntax"
              }
            ]
          },
          {
            "depth": 2,
            "id": "considerations",
            "title": [
              {
                "type": "text",
                "position": { "start": { "line": 434 } },
                "value": "Considerations"
              }
            ]
          },
          {
            "depth": 2,
            "id": "restrictions",
            "title": [
              {
                "type": "text",
                "position": { "start": { "line": 739 } },
                "value": "Restrictions"
              }
            ]
          },
          {
            "depth": 2,
            "id": "examples",
            "title": [
              {
                "type": "text",
                "position": { "start": { "line": 792 } },
                "value": "Examples"
              }
            ]
          }
        ]
      }
    },
    "created_at": "2023-07-13T20:20:21.094Z",
    "deleted": false,
    "filename": "reference/operator/aggregation/merge.txt",
    "static_assets": [],
    "updated_at": "2023-07-13T20:20:21.094Z"
  }
}
