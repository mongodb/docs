====================
Monitor a Deployment
====================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

|mms| collects and displays metrics for your servers, databases,
and MongoDB processes in your |mms| deployments.

.. tabs::

   tabs:

   - id: replica-metrics

     name: "Replica Set Metrics"

     content: |

       View Metrics for a Replica Set
       ------------------------------

       To view the metrics for a specific |mms| replica set deployment
       in a :ref:`project <projects>`, click the :guilabel:`Metrics`
       button for that deployment. Alternatively, click on the name of
       the deployment to open the deployment overview, then click the
       :guilabel:`Metrics` tab.

       The :guilabel:`Metrics` view has three distinct sections:

       Chart Controls
       ~~~~~~~~~~~~~~

       |mms| provides the following controls for the :guilabel:`Metric`
       view. Adjusting any of these options affects all charts
       displayed under the :guilabel:`Metrics` view:

       .. list-table::
          :widths: 35 65
          :header-rows: 1

          * - Control
            - Function

          * .. include:: /includes/extracts/monitor-view-control-granularity.rst

          * .. include:: /includes/extracts/monitor-view-control-zoom.rst

          * .. include:: /includes/extracts/monitor-view-control-current-display.rst

          * .. include:: /includes/extracts/monitor-view-control-toggle-members.rst

          * .. include:: /includes/extracts/monitor-view-control-add-chart.rst

          * .. include:: /includes/extracts/monitor-view-control-display-opcounters.rst

          * .. include:: /includes/extracts/monitor-view-control-display-annotations.rst

       Chart Display
       ~~~~~~~~~~~~~

       When viewing charts, you can do the following:

       .. list-table::
          :widths: 35 65
          :header-rows: 1

          * - Task
            - Action

          * .. include:: /includes/extracts/monitor-chart-controls-description.rst

          * .. include:: /includes/extracts/monitor-chart-controls-expand.rst

          * .. include:: /includes/extracts/monitor-chart-controls-zoom.rst

          * .. include:: /includes/extracts/monitor-chart-controls-point.rst

          * .. include:: /includes/extracts/monitor-chart-controls-move.rst

          * .. include:: /includes/extracts/monitor-chart-controls-share.rst

       Chart Selection
       ~~~~~~~~~~~~~~~

       |mms| displays the available metrics to chart for the selected
       deployment under the :guilabel:`Toggle Charts` header. Metrics
       are grouped into two sections:

       :guilabel:`MongoDB Metrics`
         Metrics associated with the MongoDB process. For metrics
         related to database performance, such as
         :guilabel:`DB Storage`, |mms| presents the sum total across
         all databases in the deployment.

         If you enable
         :guilabel:`Display Opcounters on Separate Charts`,
         |mms| replaces the :guilabel:`Opcounters` option with the
         individual components of that chart.

       :guilabel:`Hardware Metrics`
         Metrics associated with the host machines supporting the
         deployment.

         - Charts marked with :icon:`plus` are inactive.
         - Charts marked with  :icon:`minus` are active.

         Click on any chart to toggle the chart state.

   - id: sharded-metrics

     name: "Sharded Cluster Metrics"

     content: |

       View Metrics for a Sharded Cluster deployment
       ---------------------------------------------

       To view the metrics for a specific |mms| deployment in a
       :ref:`project <projects>`, click the :guilabel:`Metrics` button
       for that deployment. Alternatively, click on the name of the
       deployment to open the deployment overview, then click the
       :guilabel:`Metrics` tab.

       The :guilabel:`Metrics` view has three distinct sections:

       Chart Controls
       ~~~~~~~~~~~~~~

       |mms| provides the following controls for the
       :guilabel:`Metric` view:

       .. list-table::
          :widths: 35 65
          :header-rows: 1

          * - Control
            - Function

          * .. include:: /includes/extracts/monitor-view-control-granularity-sharded.rst

          * .. include:: /includes/extracts/monitor-view-control-zoom.rst

          * .. include:: /includes/extracts/monitor-view-control-display-data.rst

          * .. include:: /includes/extracts/monitor-view-control-current-display.rst

          * .. include:: /includes/extracts/monitor-view-control-display.rst

          * .. include:: /includes/extracts/monitor-view-control-view.rst

       Chart Display
       ~~~~~~~~~~~~~

       When viewing charts, you can do the following:

       .. list-table::
          :widths: 35 65
          :header-rows: 1

          * - Task

            - Action

          * .. include:: /includes/extracts/monitor-chart-controls-zoom.rst

          * .. include:: /includes/extracts/monitor-chart-controls-point.rst

       Data Sources
       ~~~~~~~~~~~~

       |mms| displays each data source that contributes to the metric
       chart in a table below the chart. The table consists of the
       following:

       .. list-table::
          :widths: 35 65
          :header-rows: 1

          * - Column
            - Description

          * - :guilabel:`Shard Name`
            - When :guilabel:`View` is set to ``SHARDS``, displays the name
              of each shard in the sharded cluster deployment.

              When :guilabel:`View` is set to ``MONGOS`` or ``CONFIGS``,
              displays the name of each :binary:`mongos <bin.mongos>` or
              config server :binary:`mongod <bin.mongod>` process in the
              sharded cluster deployment.

              Click on a listed component to open the
              :guilabel:`Metrics` view for that component.

          * - :guilabel:`Alerts`
            - Indicates if there are any open alerts for the listed
              shard or process. Click on the alert icon to open the
              :guilabel:`Alerts` view for that shard or process. To learn more about responding to open alerts, see
              :doc:`/tutorial/manage-alerts-and-events`.

          * - :guilabel:`Data Size`
            - Only visible if :guilabel:`View` is set to ``SHARDS``.

              Indicates the logical size of all documents and indexes
              on the shard.

          * - :guilabel:`Show`
            - Only visible if :guilabel:`View` is set to ``SHARDS``

              Indicates which replica set members to show on the selected
              chart. Select ``Primaries``, ``Secondaries`` or ``All``.

          * - :guilabel:`Read`, :guilabel:`Write`, and :guilabel:`Queued`
            - Metric data related to the displayed chart. Hover over
              the corresponding column for a pop up with detailed
              information on the metrics shown.

   - id: process-metrics

     name: "MongoDB Process Metrics"

     content: |

       View Metrics for a Single MongoDB Process
       -----------------------------------------

       To view the metrics for a specific MongoDB process in a
       |mms| deployment, click on that process from the
       :guilabel:`Cluster` view. The |mms| process view displays
       three tabs for monitoring metrics for the process:

       - The :guilabel:`Status` tab displays the process metrics |mms|
         collects from the selected :binary:`mongod <bin.mongod>` or
         :binary:`mongos <bin.mongos>` process.

       - The :guilabel:`Hardware` tab displays hardware metrics for
         the host machine supporting the selected
         :binary:`mongod <bin.mongod>` or :binary:`mongos <bin.mongos>`
         process.

       - The :guilabel:`DB Stats` tab displays the database metrics for the
         selected database.

         |mms| retrieves database metrics every 20 minutes by default but
         adjusts frequency when necessary to reduce the impact on database
         performance. If the collection of database statistics still affects
         performance, you can disable collection by clicking
         :guilabel:`Settings` from the left-hand navigation,
         then :guilabel:`Project Settings`, and then setting
         :guilabel:`Collect Database Specific Statistics` to :guilabel:`No`.

       The view for each tab has three distinct sections:

       Chart Controls
       ~~~~~~~~~~~~~~

       |mms| provides the following controls for the :guilabel:`Status`,
       :guilabel:`Hardware`, and :guilabel:`DB Stats`
       views. Adjusting any of these options affects all charts displayed under
       the selected view:

       .. list-table::
          :widths: 35 65
          :header-rows: 1

          * - Control
            - Function

          * .. include:: /includes/extracts/monitor-view-control-granularity.rst

          * .. include:: /includes/extracts/monitor-view-control-zoom.rst

          * .. include:: /includes/extracts/monitor-view-control-current-display.rst

          * .. include:: /includes/extracts/monitor-view-control-add-chart.rst

          * .. include:: /includes/extracts/monitor-view-control-select-database.rst

          * .. include:: /includes/extracts/monitor-view-control-display-opcounters.rst

          * .. include:: /includes/extracts/monitor-view-control-display-annotations.rst

       Chart Display
       ~~~~~~~~~~~~~

       When viewing charts, you can do the following:

       .. list-table::
          :widths: 35 65
          :header-rows: 1

          * - Task

            - Action

          * .. include:: /includes/extracts/monitor-chart-controls-description.rst

          * .. include:: /includes/extracts/monitor-chart-controls-expand.rst

          * .. include:: /includes/extracts/monitor-chart-controls-zoom.rst

          * .. include:: /includes/extracts/monitor-chart-controls-point.rst

          * .. include:: /includes/extracts/monitor-chart-controls-move.rst

          * .. include:: /includes/extracts/monitor-chart-controls-share.rst

       Chart Selection
       ~~~~~~~~~~~~~~~

       |mms| displays the available metrics to chart for the
       selected deployment under the :guilabel:`Toggle Charts` header.


       - Charts marked with :icon:`plus` are inactive.
       - Charts marked with  :icon:`minus` are active.

       Click on any chart to toggle the chart state.

   - id: realtime-metrics

     name: "Real Time Metrics"

     content: |

       .. cond:: cloud

          Enable or Disable Real-Time Performance Panel for a Project
          -----------------------------------------------------------

          .. admonition:: Required Privileges
             :class: important

             To enable :guilabel:`Real-Time Performance Panel` for a project, you
             must have the :authrole:`Project Owner` role for the project.

          ``Real-Time Performance Panel`` is enabled by default. To disable
          or enable the ``Real-Time Performance Panel``:

          .. include:: /includes/steps/enable-rtpp.rst

       View Real Time Metrics
       ----------------------

       .. _real-time-metrics-status-tab:

       .. admonition:: Availability
          :class: note

          :guilabel:`Real Time` metrics are available for MongoDB
          deployments managed by Automation, using {+aagent+}
          version 3.3.1 or later.

          :guilabel:`Real Time` metrics are also available for
          `MongoDB Atlas <https://cloud.mongodb.com?jmp=docs>`_.

          |mms| supports :guilabel:`Real Time` metrics for
          :binary:`~bin.mongod` or :binary:`~bin.mongos` processes and
          replica set deployments. For sharded cluster deployments,
          you can view :guilabel:`Real Time` metrics for each shard
          replica set.

       To view Real Time metrics for a specific |mms| deployment in a
       :ref:`project <projects>`, click the :guilabel:`Metrics` button
       for that deployment. Alternatively, click on the name of the
       deployment to open the deployment overview, then click the
       :guilabel:`Metrics` tab. From the :guilabel:`Metrics` tab, click
       the :guilabel:`Real Time`.

       .. include:: /includes/extracts/admonition-pii-user-role.rst

       You can view the stats in either :guilabel:`Table` view or the
       :guilabel:`Graph` view.


       Table View
       ~~~~~~~~~~

       .. list-table::
          :header-rows: 1
          :widths: 25 75

          * - Fields

            - Description

          * - | :guilabel:`Commands`
              | :guilabel:`Queries`
              | :guilabel:`Updates`
              | :guilabel:`Deletes`
              | :guilabel:`Inserts`
              | :guilabel:`GetMores`

            - Displays the number of the specified operations
              (commands, queries, etc.) that
              :manual:`mongostat </reference/program/mongostat/#fields>`
              has reported.


          * - | :guilabel:`Time / Read`
              | :guilabel:`Time / Write`
              | :guilabel:`Time / Command`

            - Displays latency statistics for current read requests,
              write requests, and other database commands. Available
              only for MongoDB 3.4+. To learn more, see ``opLatencies``
              at
              :manual:`serverStatus </reference/command/serverStatus>`.

          * - | :guilabel:`Scanned / Returned`
              | :guilabel:`Scanned Objects / Returned`

            - Displays the ratio of documents and objects scanned to
              documents and objects returned in current queries. These
              statistics are useful in determining if and how a query
              uses an index. To learn more, see 
              :manual:`Analyze Query Performance </tutorial/analyze-query-plan>`.

          * - | :guilabel:`Active Readers`
              | :guilabel:`Active Writers`
              | :guilabel:`Queued Readers`
              | :guilabel:`Queued Writers`

            - Displays the number of active reads, queued reads, active
              writes, and queued writes that
              :manual:`mongostat </reference/program/mongostat/#fields>`
              has reported.

          * - | :guilabel:`Lag Time`

            - Available only for secondary members of a replica set.
              Displays the time required to replicate operations from
              the primary to the secondary members of a replica set.
              To learn more, see
              :manual:`Replica Set Secondary Members </core/replica-set-secondary>`.

          * - | :guilabel:`CPU`
              | :guilabel:`Disk Util`
              | :guilabel:`Sys Mem`

            - The displayed statistic depends on the operating system of the
              nodes in your cluster:

              .. include:: /includes/fact-sys-mem-by-os-rtpp.rst

          * - | :guilabel:`Connections`
              | :guilabel:`Bytes In`
              | :guilabel:`Bytes Out`

            - Displays the number of current connections to the
              machine hosting MongoDB and the number of inbound and
              outbound bytes that
              :manual:`mongostat</reference/program/mongostat/#fields>`
              has reported.

       Click on :icon:`ellipsis-h` to hide or display fields from
       the table.

       Graph View
       ~~~~~~~~~~

       .. list-table::
          :header-rows: 1
          :widths: 25 75

          * - Chart/Location
            - Description

          * - | :guilabel:`Connections, Network In, Network Out`
              | (Top of panel)

            - Displays the number of current connections to the machine
              hosting MongoDB and the number of inbound and outbound
              bytes that
              :manual:`mongostat</reference/program/mongostat/#fields>`
              has reported.


          * - :guilabel:`CPU, Disk Util, and Sys Mem` (Top of panel)

            - The displayed statistic depends on the operating system of the
              nodes in your cluster:

              .. include:: /includes/fact-sys-mem-by-os-rtpp.rst

          * - :guilabel:`Operations`

            - Displays the number of operations as reported by
              :manual:`mongostat </reference/program/mongostat/#fields>`.

          * - :guilabel:`Query Execution Times`

            - Displays latency statistics for current read requests,
              write requests, and other database commands. Available
              only for MongoDB 3.4+. To learn more, see ``opLatencies``
              at
              :manual:`serverStatus </reference/command/serverStatus>`.

          * - :guilabel:`Query Targeting`

            - Displays the ratio of documents and objects scanned to
              documents and objects returned in current queries. These
              statistics are useful in determining if and how a query
              uses an index. To learn more, see
              :manual:`Analyze Query Performance </tutorial/analyze-query-plan>`.

          * - :guilabel:`Reads & Writes`

            - Displays the number of active reads, queued reads, active
              writes, and queued writes as reported by
              :manual:`mongostat </reference/program/mongostat/#fields>`.

          * - :guilabel:`Replication Lag`

            - Available only for secondary members of a replica set.
              Displays the time required to replicate operations from
              the primary to the secondary members of a replica set.
              To learn more, see
              :manual:`Replica Set Secondary Members </core/replica-set-secondary>`.

          * - :guilabel:`Hottest Collections`

            - Displays the collections with the most operations that
              :manual:`mongotop </reference/program/mongotop/#fields>`
              has reported. For each hot collection, the table also
              displays the :guilabel:`Utilization Percent` for the
              collection.

              :guilabel:`Utilization Percent` is calculated from the 
              read and write times that 
              :manual:`mongotop </reference/program/mongostat/#fields>`
              has reported during a sample period. Specifically, the
              :guilabel:`Utilization Percent` is the percentage
              (rounded to the nearest 0.1%) of the read and write
              times for a collection relative to the read and write
              times for all collections in the deployment during the
              sample period. If no read and write operation occur
              during this period, the :guilabel:`Utilization Percent`
              may be 0%.

              The hottest collections correspond to the most current
              time displayed in the charts. That is, if the display is
              running (i.e. not paused), the collections correspond to
              the hottest collections at the current timestamp. If the
              display is paused, the collections correspond to the
              hottest collections at the paused time.

          * - :guilabel:`Slowest Operations`

            - Displays the slowest operations that the
              :manual:`db.currentOp() </reference/method/db.currentOp>`
              has reported.

              The operations correspond to the most current time
              displayed in the charts. That is, if the display is
              running (i.e. not paused), the operations correspond to
              the slowest operations at the current timestamp. If the
              display is paused, the operations correspond to the
              slowest operations at the paused time.

              Click on the operation to view the detailed JSON
              document that 
              :manual:`db.currentOp() </reference/method/db.currentOp>`
              has reported for the operation.

              Users with the
              :ref:`Data Access Admin <data-access-admin-role>`
              role can access buttons to force stop an operation or
              an inactive transaction in the operation details panel:

              To stop a slow operation:

              #. Click the operation in the :guilabel:`Slowest Operations` pane.

              #. Click :guilabel:`Kill Op` in the :guilabel:`Operation Details` pane.

                 Alternatively, click :guilabel:`Kill Session` if the
                 operation is  an inactive transaction.

              #. Click :guilabel:`Yes, terminate this operation` in the
                 :guilabel:`Confirm Operation` modal.

              To learn more about
              :manual:`transactions </core/transactions>`, refer to
              the MongoDB manual.

       To hide/show a metric in the graph, click on the color box for
       the metric.

       Read Exact Metrics from Graph View
       ``````````````````````````````````

       If you pause the :guilabel:`Graph` view of the Real-Time
       Performance Panel, you can hover over a line graph to see its
       exact value, along with the slowest operations and hottest
       collections, at a given moment in time.

       Stop and Restart Display
       ------------------------

       To stop the update of the stats displayed, click the
       :guilabel:`Pause` button. The :guilabel:`Pause` button only
       stops the update of the displays and does not pause the
       collection of the underlying data.

       To restart the display updates, click :guilabel:`Play`.
