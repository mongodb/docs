=====================
Administer the System
=====================

The *Administration* section of the |mms| application
provides a tool to view system status, set cron jobs, manage users and
groups, and perform other administrative functions.

If you have administrative privileges for the |mms| deployment, click
the :guilabel:`Admin` link in the top right corner of |mms| to access
the system administration tool.

This page describes the :guilabel:`Admin` section's tabs and pages.

General Tab
-----------

The :guilabel:`General` tab provides overview information, messages,
reports, and access to users.

.. _overview-page:

Overview Page
~~~~~~~~~~~~~

The :guilabel:`Overview` page provides reports on system use and
activity.

This page displays the summary table and :guilabel:`Total Pages Viewed`
and :guilabel:`Total Chart Requests` charts.

A summary table reports totals for:

- groups
- active groups
- active hosts
- users
- users active
- ping spillover queue
- increment spillover queue

Additionally two charts report:

- total page views
- total chart requests

.. _users-page:

Users Page
~~~~~~~~~~

The :guilabel:`Users` page displays a list of user information for all
people with permission to use the |mms| application as well as provides
an interface to manage users. Use the search box on the upper right corner
to find a user record.

Users Information
``````````````````

For each user, the users table reports:

- the username

- the available :doc:`roles </reference/user-roles>`, if any

- the date and time of the last login.

- the date and time of the last access event.

- the total number of login.

- the user's configured timezone.

- the creation date and time.

Edit a User Record
``````````````````

To edit a user record:

#. Click the pencil icon at the far right of the user record.

#. In the :guilabel:`Edit User` interface, you can:

   - Edit the user's email.

   - Select the user's groups and :doc:`roles </reference/user-roles>`.

   - Lock or unlock the account.

   - Specify the user's global roles.

#. When finished, click the :guilabel:`Save` button to save any changes
   and exit.

.. _groups-page:

Groups Page
~~~~~~~~~~~

The :guilabel:`Groups` page lists all groups created with their date
created and the last date and time an agent for the group pinged |mms|. At
the top right of the page is a search box to find a group by name.
Click a group name to view the group's details.

.. _logs-page-gernal-tab:

Logs Page
~~~~~~~~~

The :guilabel:`Logs` page in :guilabel:`General` tab
lists backup logs by job and class with messages
grouped and counted by last hour, 6 hours, and last 2 days. Click a
count number to see all messages in the group.

.. tech-writing-note: The Agent Dashboard page that sits between the Logs and
   Messages pages is for internal use only and shouldn't be documented.

.. _messages-page:

Messages Page
~~~~~~~~~~~~~

You can display a short message on any page of the |mms| application to
notify or remind users, such as impending maintenance windows. Messages
may be *active*, i.e. visible, on all pages or a subset of pages.

The :guilabel:`Messages` page provides information on existing messages
as well as an interface to add new messages or manage existing messages.

UI Messages Table
`````````````````

The :guilabel:`UI Messages` table holds all available messages. Use the
search box on the top right to filter the list of messages.

For each message, the table reports:

- which page or page prefix the message will appear on.

- the text of the message.

- whether the message is active or inactive. Active messages are also
  highlighted in orange.

- the creation date and time for the message.

- the date and time of the last modification for the message.

Add a Message
`````````````

.. Does Add Message functionality still exist?

To add a message which appears on one page, or on all pages,

#. Click the:guilabel:`Add Message` button.

#. In the :guilabel:`Add Message` interface, enter

   - the message, and

   - the page URL or optionally, page prefix in the :guilabel:`Add
     Message` interface.

     The page prefix allows you to specify a path of a single page or
     the URL prefix of a group of pages. The prefix must begin with a
     ``/`` character.

     .. Is this example referring to the |mms| UI? |mms| no longer has a Settings tab.

        For example, entering the page prefix ``/settings/profile`` will
        display a message on the default :guilabel:`Settings` tab and
        :guilabel:`Profile` page but not on any other tab or page in the
        application.

#. Click the :guilabel:`Active` checkbox to make the message live.
   Optionally, you can leave the box unchecked to disable the message.

#. Click the :guilabel:`Add` button to add the message.

Once added, active messages take 60 seconds before they display.

Disable a Message
`````````````````

.. Does Disable Message functionality still exist?

To disable a message, click the orange square button to the right of
any alert listed on the :guilabel:`Messages` page. The orange button
will change to a grey button.

To re-enable a disabled message, click the grey button; the grey button
will change to back to an orange button.

Delete a Message
````````````````

To delete a message, click the garbage can icon to the right of any alert
listed on the :guilabel:`Messages` page.

.. tech-writing-note: The Reports page is for internal use only and shouldn't
   be documented.

Audits Page
~~~~~~~~~~~

The :guilabel:`Audits` page displays all events tracked by |mms|.
This includes the group events as well as internal and system events, which
are not tracked at a group level.

.. _backup-tab:

Backup Tab
----------

The :guilabel:`Backup` tab provides information on Backup resources,
including jobs, daemons, and blockstores.

Jobs Page
~~~~~~~~~

You can see all active and stopped Backup jobs on the
:guilabel:`Jobs` page. For each backup job, the tab lists job group, name,
last agent conf, last oplog, head time, last snapshot, what the agent is
working on, the daemon, and the blockstore.

|mms| puts a yellow background on the following fields if they are delayed:

- :guilabel:`Last Agent Conf`, if older than 1 hour.

- :guilabel:`Last Oplog`, if older than 1 hour before the :guilabel:`Last Agent Conf`.

- :guilabel:`Head Time`, if older than 1 hour before :guilabel:`Last Oplog`.

- :guilabel:`Last Snapshot`, if older than the snapshot interval multiplied by 1.5.

Click the group name to go directly to the backup job page for the group.
Click the job name to see the results of the job on a detail page. On the
job detail page, click links to see the logs, conf call,
and download a zipped archive file containing complete diagnostic
information for the specified job.

Job Timeline Page
~~~~~~~~~~~~~~~~~

The :guilabel:`Job Timeline` page displays a graphical representation of
information found on other :guilabel:`Admin` pages, in particular the
:guilabel:`Jobs` page. The :guilabel:`Job Timeline` page displays critical
timestamps (head, last snapshot, next snapshot) and offers a way to assign a
daemon to a given job.

Click the :guilabel:`Auto refresh` checkbox to update the list automatically
every 10 seconds. Click the :guilabel:`Refresh` button to refresh data
manually.

To view the backup job JSON, click the :guilabel:`Show JSON` link under
the :guilabel:`Group` heading for any backup job. When the JSON displays,
click the :guilabel:`View raw runtime data` link under the code to view
the raw data. To hide the daemon JSON, click the :guilabel:`Hide JSON` link.

To move the job to a new Backup Daemon, click the :guilabel:`Move head`
link under the :guilabel:`Machine` heading for a backup job. Select the
location and click the :guilabel:`Move head` button to move the job to a
new Backup Daemon.

You can bind a backup job to a head by clicking the Set binding button
under the :guilabel:`Machine` heading for any backup job.

.. tech-writing-note: The "Break Job" option is internal only and shouldn't
   be documented.

Logs Page
~~~~~~~~~

The :guilabel:`Logs` page on the backup tab lists backup logs by job and class with messages
grouped and counted by last 2 hours, last day, and last 3 days. Click a
count number to see all messages in the group.

Restores Page
~~~~~~~~~~~~~

The :guilabel:`Restores` page displays the last 100 requested restores and their
progress. To show all restores ever requested, click :guilabel:`Show All`.

Resource Usage Page
~~~~~~~~~~~~~~~~~~~

The :guilabel:`Resource Usage` page provides key size and throughput
statistics on a per-job basis for all groups for which Backup is enabled. The
page displays such throughput statistics as the size of the data set, how
active it is, and how much space is being used on the blockstore.

To export the information, click :guilabel:`EXPORT AS CSV`.

.. _grooms-page:

Grooms Page
~~~~~~~~~~~

.. versionadded:: 1.4

|mms| performs periodic garbage collection on blockstores through groom
jobs that remove unused blocks to reclaim space. Unused blocks are those
that are no longer referenced by a live snapshot. An |mms|
scheduling process determines when grooms are necessary.

This page lists active and recent groom jobs.

A groom job forces the backup process to:

- write all new data to a new location,

- copy all existing, needed data from the old location to the new one,

- update references, to maintain data relationships, and

- drop the old database.

During groom operations, you may notice that blockstore file size will
fluctuate, sometimes dramatically.

You can manually direct |mms| to move blocks between Blockstores through
the :ref:`groom-priority-page`.

.. _groom-priority-page:

Groom Priority
~~~~~~~~~~~~~~

.. versionadded:: 1.6

The :guilabel:`Groom Priority` page allows you to manually schedule jobs to move a backup's blocks
to a different blockstore
and to manually schedule :ref:`grooms <grooms-page>`. The page lists
each backup by its replica set and highlights a backup in blue if a groom
is in progress.

To move a backup's chunks to a different blockstore, select the destination
blockstore in the backup's :guilabel:`Blockstore List` column.
You might want to do this, for example, if you add a new blockstore and would
like to balance data.

Typically, you should not need to manually schedule groom jobs. |mms|
:ref:`runs the jobs automatically <grooms-page>`. If you do need to
initiate a job, click the :guilabel:`Schedule` button for the backup's
replica set.

.. tech-writing-note: The "Provisioning" page is internal only and shouldn't
   be documented.

.. _daemons-interface:

Daemons Page
~~~~~~~~~~~~

The :guilabel:`Daemons` page lists all active backup daemons and provides
the ability to pre-configure a new Backup Daemon.

For each Backup Daemon, this page lists the server name, configuration,
head space used, head space free, the number of replica sets backed up,
the percentage of time the Backup Daemon Service was busy, and job runtime counts
by 1 minute, 10 minutes, 60 minutes, less than or equal to 180 minutes,
and greater than 180 minutes.

Click the :guilabel:`Show Detailed JSON` link to view the Backup Daemon JSON. When
JSON displays, click the :guilabel:`View raw runtime data` link under the
code to view raw data. To hide the daemon JSON, click the :guilabel:`Hide
JSON` link.

Click the :guilabel:`Move all heads` link to move the Backup Daemon head
location. Select the location and click the :guilabel:`Move all heads`
button to move all jobs that live on this daemon to a new daemon.

For each Backup Daemon, you can select or deselect the assignment, backup
jobs, restore jobs, and garbage collection configuration,
as well as indicate whether the disk type is SSD or HDD. If selected, the
algorithm that assigns jobs to daemons uses disk type to assign jobs with
high oplog churn to HHD daemons.

To pre-configure a new Backup Daemon, scroll to the bottom of this page and
type the ``<machine>:<root head path>`` in the text field above the
:guilabel:`Pre-Configure New Daemon` button. Click the button to
pre-configure the new Backup Daemon.

.. _blockstores-page:

Blockstores Page
~~~~~~~~~~~~~~~~

The :guilabel:`Blockstores` page lists all Backup blockstores and provides
the ability to add a new blockstore.

To update an existing blockstore, edit the :guilabel:`<hostname>:<port>`
field, :guilabel:`MongoDD Auth Username` field, and :guilabel:`MongoDB
Auth Password` field. If the username and password had used the
``credentialstool`` for encryption, click the :guilabel:`Encrypted
Credentials` checkbox.

To add a blockstore, enter the ``<id>`` and ``<hostname:port>`` in the
text fields above the :guilabel:`Add New Blockstore` button. For replica
sets, enter a comma-separated list for ``<hostname:port>``. Then click the
button to save and add the blockstore. A newly configured blockstore
becomes active when you select the assignment checkbox.

To delete a blockstore, click the :guilabel:`Delete blockstore` link for
the blockstore.

Sync Stores Page
~~~~~~~~~~~~~~~~

.. important:: Do not modify this page. Modifying information on this
   page requires all |mms| components to be restarted. Existing data
   will not be copied automatically.

This page configures which :program:`mongod` instances are used to temporarily
store sync slices. Use this page only to view information on your sync slices.
Sync slices are temporary backups of your data stored in your Backup Blockstore
database until an initial sync completes.

Oplog Stores Page
~~~~~~~~~~~~~~~~~

.. important:: Do not modify this page. Modifying information on this
   page requires all |mms| components to be restarted. Existing data
   will not be copied automatically.

This page configures where oplog slices are stored. Oplog slices are
compressed slices of the tailed oplogs of your replica sets. Backup uses the
slices to keep the copy of the data in sync with the original replica set.

.. _control-panel:

Control Panel Tab
-----------------

The :guilabel:`Control Panel` tab provides access to Cron jobs and email history.

Email History Page
~~~~~~~~~~~~~~~~~~

The :guilabel:`Email History` page displays all alerts emails sent, the
subject, and the recipient. To view an email, click the subject link. To
filter the list, click :guilabel:`FILTER BY RECIPIENT`.

Cron Jobs Page
~~~~~~~~~~~~~~

The :guilabel:`Cron Jobs` page displays all scheduled processes and their
statuses. To disable a job, uncheck its box in the :guilabel:`ENABLED` column.
To run a job, click :guilabel:`RUN NOW`.

.. tech-writing-note: The Billing Tab is for internal use only and shouldn't
   be documented.
