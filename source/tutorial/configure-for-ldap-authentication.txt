.. _security-ldap:

================================================
Configure users and groups using LDAP with |mms|
================================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

Overview
--------

You can configure |mms| to use a Lightweight Directory Access Protocol
(LDAP) service to manage user authentication. Users log in through
|mms|, then |mms| searches the LDAP directory for the user and
synchronizes the user's name and email addresses in the |mms| user
records with the values in the LDAP user records.

LDAP is now configured within |mms| and not through a properties file.
Go to
:guilabel:`Admin` > :guilabel:`General` > :guilabel:`Ops Manager Config` >
:guilabel:`User Authentication` to configure these settings.

.. note::

   This page is about user authentication into the |mms| web interface.
   Separately, if your MongoDB deployment uses LDAP for external
   authentication of database users, see the related page for creating
   MongoDB database users for the |mms| agents. For more information,
   see :doc:`/tutorial/configure-monitoring-agent-for-ldap` and
   :doc:`/tutorial/configure-backup-agent-for-ldap`.

This tutorial describes how to configure LDAP authentication for |mms|,
map LDAP groups to global |mms| roles and to group-level |mms| roles.

User Authentication
~~~~~~~~~~~~~~~~~~~

When a user logs in, |mms| searches for a matching user using an LDAP
query.

- |mms| logs into LDAP as the ``search`` user, using the credentials
  specified in the :guilabel:`LDAP Bind Dn` and :guilabel:`LDAP Bind
  Password` fields.

- |mms| searches only under the base distinguished name specified in
  the :guilabel:`LDAP User Base Dn` field and matches the user
  according to the LDAP attribute specified in the :guilabel:`LDAP User
  Search Attribute` field.

- If a matching user is found, |mms| authenticates the supplied
  password against the LDAP password for the provided user.

Access Control
~~~~~~~~~~~~~~

LDAP groups let you control access to |mms|. You map LDAP groups to
|mms| roles and assign the LDAP groups to the users who should have
those roles.

LDAP entries map to |mms| records as follows: 

.. list-table:: 
   :header-rows: 1

   * - LDAP
     - |mms|

   * - User
     - User

   * - Group
     - Role

To use LDAP groups effectively, :doc:`create additional groups </tutorial/create-group>` 
within |mms| to control access to specific deployments in your
organization, such as creating separate |mms| groups for development
and production environments. You can then map an LDAP group to a role
in the |mms| group to provide access to a deployment.

.. note::

   Changes made to LDAP groups can take up to an hour to appear in
   |mms|.

.. _ldap-over-ssl:

LDAP Over SSL
~~~~~~~~~~~~~

Use of LDAP over an SSL connection (LDAPS), is specified in the ``conf-mms.properties`` file in the fields :setting:`LDAP SSL CA File`, :setting:`LDAP SSL PEM Key File`, and :setting:`LDAP SSL PEM Key File Password`.


Using LDAP from the Fresh Install vs. Converting to LDAP
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

All prerequisites apply to either scenario. The additional requirements are:

.. list-table:: 
   :header-rows: 1
   :widths: 50 50

   * - Fresh LDAP Install

     - Conversion to LDAP

   * - The Global Owner to be the first user created.
    
     - The Global Owner exist in both LDAP and |mms| and belong to the
       LDAP group that will map to the |mms| Global Owner role.

.. important:: 

   Once |mms| is converted to LDAP Authentication, only the user with
   the Global Owner role changing the authentication method remains
   logged into |mms|. All other users are logged off and need to log
   back into |mms| using their LDAP username and password. Any users
   without an LDAP username and password can no longer log into |mms|.

Prerequisites
-------------

The LDAP server must:

- Be installed, configured and accessible to |mms|.

- Embed each user's group memberships as an attribute of each user's
  LDAP Entry.

- Include a user that can search the needed base distinguished name(s)
  that have the users and groups that use |mms|.

- Include a group that you can specify in the |mms| 
  :guilabel:`LDAP Global Role Owner` field. 

  - The first user to log into |mms| with LDAP authentication must
    belong to this LDAP group.

  - This user will also create the initial |mms| group.

  .. example:: 
     If LDAP has an ``admin`` group for use by |mms| administrators,
     enter ``admin`` in the :guilabel:`LDAP Global Role Owner` field.

Procedure
---------

To configure LDAP authentication:

.. include:: /includes/steps/configure-ldap-authentication.rst
