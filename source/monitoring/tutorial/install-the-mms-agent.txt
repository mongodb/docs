==========================================
Install the Monitoring Agent on UNIX/Linux
==========================================

.. index:: requirements; full
.. _mms-requirements:

Requirements and Prerequisites
------------------------------

.. start-requirements-content

|monitoring| has a series of prerequisite requirements. The following
sections will guide you through the requirements and provide basic
instructions for fulfilling them.

Basic |monitoring| Requirements
```````````````````````````````

- All MongoDB instances (i.e. ``mongod`` and ``mongos``) must be
  version 1.6 or newer.

.. index:: requirements; Python
.. index:: requirements; setuptools

- You must have Python 2.4 or greater and Python's
  `setuptools <http://pypi.python.org/pypi/setuptools>`_.

  .. note::

     The Monitoring agent does not provide support the PyPy implementation
     of Python, and does not support the Python 3.x series of Python.

  Most operating systems package setuptools. For example, Debian and
  Ubuntu users can use the following command to install the package:

  .. code-block:: sh

     sudo apt-get install python-setuptools

  For Red Hat Enterprise Linux (RHEL) CentOS, or Fedora users, the
  following command will install the package:

  .. code-block:: sh

     sudo yum install python-setuptools

.. index:: requirements; PyMongo Installation

- All users must install `PyMongo  <http://pypi.python.org/pypi/pymongo/>`_,
  the Python driver for MongoDB.

  For optimal speed and stability, use the most recent version of
  PyMongo. The agent is not compatible with versions of PyMongo before
  1.9. For instructions for installing PyMongo, see :doc:`Installing
  PyMongo </monitoring/tutorial/install-pymongo>`.

.. index:: troubleshooting; proxies

- Users whose datacenter requires that they proxy outbound connections
  through a gateway have additional requirements. See ":ref:`Working
  with Proxies <troubleshooting-proxies>`" for more information.

The ``README`` file distributed with the agent provides more
information. When all dependencies are successfully installed, you may
proceed to installing the agent.

Additional Requirements for Python 2.4 and Legacy Agent Installations
`````````````````````````````````````````````````````````````````````

.. index:: hmac
   single: requirements; Python 2.4 Installation

- If your system is running Python 2.4, you will need to install the
  ``hmac`` and ``hashlib`` Python modules. You can do so using
  ``easy_install`` as in the following:

  .. code-block:: sh

     sudo easy_install hmac hashlib

.. index:: simplejson
   single: requirements; For Python 2.5

- Legacy Monitoring agent installations (version 1.4) require you to
  install the ``simplejson`` module.

  Users of Python 2.4 should install ``simplejson``
  version 2.1.0 using the following command:

  .. code-block:: sh

     sudo easy_install simplejson==2.1.0

  For optimal speed and stability, use the most recent version of
  PyMongo. The agent is not compatible with versions of PyMongo before
  1.9. For instructions for installing PyMongo, see :doc:`Installing
  PyMongo </monitoring/tutorial/install-pymongo>`.

  .. code-block:: sh

     sudo easy_install simplejson

- Do not use ``pip`` to install modules when using Python 2.4 or 2.5,
  as there are some compatibility issues. Some users have reported
  problems installing ``hmac``, if ``easy_install`` produces an error
  or you suspect a problem with these libraries see :ref:`instructions
  for installing hmac manually <troubleshooting-hmac>`.

.. end-requirements-content

.. index:: installation; UNIX/Linux

Install Monitoring Agent Software
---------------------------------

.. start-install-content

Download the Monitoring Agent
`````````````````````````````

.. include:: /includes/install-saas-registration.rst

If you have not downloaded the Monitoring agent already, you can click
the "Settings" link immediately after you sign into MMS, and then
select :guilabel:`Monitoring Agent` from the left-hand list to
download an up-to-date agent specifically configured for your account.

You can run the agent on any system that can connect to the MongoDB
instances you want to monitor. As long as it can connect to each
instance, you may use a single agent to do all the monitoring. Do be
sure that the agent can make outgoing connections via HTTPS on port
``443``.

.. note::

   The Monitoring agent has some resource requirements and should run
   on a separate system to avoid impacting ``mongod`` or ``mongos``
   performance. To monitor five or fewer nodes, you can safely deploy
   on an AWS "micro instance".  Running PyMongo with the native
   extensions, which requires GCC, provides significant performance
   improvements.

Start the Monitoring Agent
``````````````````````````

Unzip the archive and then run the agent with the following command:

.. code-block:: sh

   python agent.py

This starts two processes: a parent to monitor the agent daemon and
perform automatic upgrades and a child process to collect data.

.. warning:: If your MongoDB instance has thousands of databases or
   collections, you should disable database statistics
   collection. See ":ref:`Database and Collection statistics
   <db-stats-warning>`" for more information.

.. end-install-content

.. _automated-agent-installation:

Automate Agent Deployments
--------------------------

The agent you downloaded from the |mms| site is automatically
configured with the credentials for your account. You can download a
configured copy of the Monitoring agent by from the
:guilabel:`Monitoring Agent` section of the :guilabel:`Settings` page
by selecting :guilabel:`Download Monitoring Agent (zip)` or
:guilabel:`Download Monitoring Agent (tar.gz)`.

Alternately, you may automate Monitoring agent deployments using an
unconfigured agent, and the API and secret keys from the :guilabel`API
Key` and :guilabel:`Secret Key sections of the :guilabel:`Settings`
page. The unconfigured agent is available at the following URLs:

- <https://mms.mongodb.com/settings/mms-monitoring-agent.zip>
- <https://mms.mongodb.com/settings/mms-monitoring-agent.tar.gz>

Unzip this archive and edit the ``settings.py`` file, replacing the
strings "``@API_KEY@``" and "``@SECRET_KEY@``" with the "API" and
"Secret Keys" defined for your account.

You may embed this process in your existing deployment scripts to
automatically install or redeploy new agents.

Next Steps
----------

Now that you have installed the Monitoring agent software, you can
:doc:`deploy the Monitoring agent in production
</monitoring/tutorial/deploy-mms-in-production>`.
