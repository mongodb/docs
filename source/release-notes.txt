:noprevnext:

===============================
Release Notes for |k8s-op-full|
===============================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. _ent-op-0.12:

|k8s-op-full| 0.12
------------------

*Released 2019-06-07*

- Rolling upgrades of MongoDB resources ensure that :method:`rs.stepDown() <rs.stepDown>`
  is called for the primary member. Requires MongoDB patch version 4.0.8 and
  later or MongoDB patch version 4.1.10 and later.
- During a MongoDB major version upgrade, the
  ``featureCompatibilityVersion`` field can be set.
- Fixed a bug where replica sets with more than seven members could
  not be created.
- X.509 Authentication can be enabled at the
  :ref:`Project level <create-k8s-project>`. Requires |cloud-short|, |onprem|
  patch version 4.0.11 and later, or |onprem| patch version 4.1.7 and later.
- Internal cluster authentication based on X.509 can be enabled at the
  :doc:`deployment </deploy>` level.
- MongoDB users with X.509 authentication can be created, using the
  new ``MongoDBUser`` custom resource.

.. _ent-op-0.11:

|k8s-op-full| 0.11
------------------

*Released 2019-04-29*

- ``NodePort`` service creation can be disabled.

- TLS can be enabled for internal authentication between MongoDB in
  replica sets and sharded clusters. The TLS certificates are created
  automatically by the |k8s-op-short|. Please refer to the sample
  ``.yaml`` files in the
  `GitHub repository <https://github.com/mongodb/mongodb-enterprise-kubernetes/tree/master/samples/extended>`__
  for examples.

- Wide or asterisk roles have been replaced with strict listing of
  verbs in ``roles.yaml``.

- Printing ``mdb`` objects with ``kubectl`` will provide more
  information about the MongoDB object: type, state, and MongoDB server
  version.

.. _ent-op-0.10:

|k8s-op-full| 0.10
------------------

*Released 2019-04-02*

- The |k8s-op-short| and database images are now based on ubuntu:16.04.

- The |k8s-op-short| now uses a single |k8s-crd| named ``MongoDB``
  instead of the ``MongoDbReplicaSet``, ``MongoDbShardedCluster``, and
  ``MongoDbStandalone`` CRDs.

  .. important::

     Follow the :ref:`upgrade procedure <upgrade-k8s-operator>` to
     transfer existing ``MongoDbReplicaSet``, ``MongoDbShardedCluster``,
     and ``MongoDbStandalone`` resources to the new format.

- For a list of the packages installed and any security vulnerabilities
  detected in our build process, see:

  - `MongoDB Enterprise Operator <https://quay.io/repository/mongodb/mongodb-enterprise-operator?tab=tags>`__

  - `MongoDB Enterprise Database <https://quay.io/repository/mongodb/mongodb-enterprise-database?tab=tags>`__

.. _ent-op-0.9:

|k8s-op-full| 0.9
-----------------

*Released 2019-03-19*

- The Operator and Database images are now based on
  ``debian:stretch-slim`` which is the latest and up-to-date Docker
  image for Debian 9.

.. _ent-op-0.8:

|k8s-op-full| 0.8
-----------------

*Released 2019-02-26*

- Perform |onprem| clean-up on deletion of MongoDB resource without the
  use of finalisers.

- **Bug fix:** Race conditions when communicating with |onprem|.

- **Bug fix:** ``ImagePullSecrets`` being incorrectly initialized in
  OpenShift.

- **Bug fix:** Unintended fetching of closed projects.

- **Bug fix:** Creation of duplicate organizations.

- **Bug fix:** Reconciliation could fail for the MongoDB resource if
  some other resources in |onprem| were in error state.


.. _ent-op-0.7:

|k8s-op-full| 0.7
-----------------

*Released 2019-02-01*

- Improved detailed status field for MongoDB resources.

- The |k8s-op-short| watches changes to configuration parameters in a
  project configMap and the credentials secret then performs a rolling
  upgrade for relevant Kubernetes resources.

- Added |json| structured logging for Automation Agent pods.

- Support |dns-srv| records for MongoDB access.

- Bug fix: Avoiding unnecessary reconciliation.

- Bug fix: Improved Ops Manager/Cloud Manager state management for
  deleted resources.

.. _ent-op-0.6:

|k8s-op-full| 0.6
-----------------

*Released 2018-12-17*

.. _controller-runtime: https://github.com/kubernetes-sigs/controller-runtime/

- Refactored code to use the controller-runtime_ library to fix issues
  where Operator could leave resources in inconsistent state. This also
  introduced a proper reconciliation process.

- Added new ``status`` field for all MongoDB Kubernetes resources.

- Can configure Operator to watch any single namespace or all
  namespaces in a cluster (requires cluster role).

- Improved database logging by adding a new configuration property
  ``logLevel``. This property is set to ``INFO`` by default.
  Automation Agent and MongoDB logs are merged in to a single log
  stream.

- Added new configuration Operator timeout. It defines waiting time
  for database pods start while updating |k8s-mdbrscs|.

- **Fix:** Fixed failure detection for ``mongos``.

.. _ent-op-0.5:

|k8s-op-full| 0.5
-----------------

*Released 2018-11-14*

- Image for database no longer includes the binary for the Automation
  Agent. The container downloads the Automation Agent binary from
  |mms| when it starts.

- **Fix:** Communication with |mms| failed if the project with the same
  name existed in different organization.

.. _ent-op-0.4:

|k8s-op-full| 0.4
-----------------

*Released 2018-10-04*

- If a backup was enabled in |onprem| for a Replica Set or Sharded
  Cluster that the |k8s-op-short| created, then the |k8s-op-short|
  disables the backup before removing a resource.

- Improved persistence support:

  - The data, journal and log directories are mounted to three
    mountpoints in one or three volumes depending upon the
    ``podSpec.persistence`` setting.

    .. list-table::
       :widths: 40 60
       :header-rows: 1

       * - Setting
         - Mount Directories to
       * - ``podSpec.persistence.single``
         - One volume
       * - ``podSpec.persistence.multiple``
         - Three volumes

    Prior to this release, only the data directory was mounted to
    persistent storage.

  - A new parameter, ``labelSelector``, allows you to specify the
    selector for volumes that |k8s-op-short| should consider mounting.

  - If |k8s-sc| is not specified in the ``persistence``
    configuration, then the default ``StorageClass`` for the cluster is
    used. In most of public cloud providers, this results in dynamic
    volume provisioning.

.. _ent-op-0.3:

|k8s-op-full| 0.3
-----------------

*Released 2018-08-07*

- The Operator no longer creates the CustomResourceDefinition objects.
  The user needs to create them manually. Download and apply
  `this new yaml file <https://github.com/mongodb/mongodb-enterprise-kubernetes/blob/master/crds.yaml>`__
  (``crd.yaml``) to create/configure these objects.

- ClusterRoles are no longer required. How the Operator watches
  resources has changed. Until the last release, the Operator would
  watch for any resource on any |k8s-ns|. With 0.3, the Operator
  watches for resources in the same namespace in which it was created.
  To support multiple namespaces, multiple Operators can be installed.
  This allows isolation of MongoDB deployments.

- Permissions changes were made to how PersistentVolumes are mounted.

- Added configuration to Operator to not create
  `SecurityContexts <https://kubernetes.io/docs/tasks/configure-pod-container/security-context/>`__
  for |k8s-pods|. This solves an issue with OpenShift which does not
  allow this setting when ``SecurityContextContraints`` are used.

  If you are using Helm, set ``managedSecurityContext`` to ``true``.
  This tells the Operator to not create ``SecurityContext`` for
  |k8s-pods|, satisfying the OpenShift requirement.

- The combination of ``projectName`` and ``orgId`` replaces
  ``projectId`` alone to configure the connection to |onprem|.
  The project is created if it doesn't exist.

.. _ent-op-0.2:

|k8s-op-full| 0.2
-----------------

*Released 2018-08-03*

- Calculates WiredTiger memory cache.

.. _ent-op-0.1:

|k8s-op-full| 0.1
-----------------

*Released 2018-06-27*

**Initial Release**

- Can deploy standalone instances, replica sets, sharded clusters
  using |k8s| configuration files.
