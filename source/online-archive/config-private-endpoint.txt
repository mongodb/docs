.. _oa-config-private-endpoint:

=============================================
Set Up a Private Endpoint for Online Archives
=============================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. include:: /includes/serverless-preview-dont-use.rst

MongoDB supports |aws| private endpoints using the `{+aws-pl+} 
<https://aws.amazon.com/privatelink/>`__ feature for Online Archives. 
You can set up the private endpoints from the |service| User Interface 
and |api|.

.. note:: 

   You can set up private endpoints for a dedicated cluster. To learn 
   more, see :ref:`private-endpoint`.

Prerequisites 
-------------

1. Have either the :authrole:`Project Owner` (``GROUP_ATLAS_ADMIN``) or 
   higher role in |service|.

#. Have an |aws| user account with an |iam| user policy that grants 
   permissions to create, modify, describe, and delete endpoints. For 
   more information on controlling the use of interface endpoints, see 
   the :aws:`AWS Documentation 
   </vpc/latest/userguide/vpc-endpoints.html>`.

#. :aws:`Install the AWS CLI 
   </cli/latest/userguide/cli-chap-install.html>`.

#. If you have not already done so, create your |vpc| and EC2 instances 
   in |aws|. See the :aws:`AWS documentation </index.html>` for 
   guidance.


Set Up Private Endpoint Through the User Interface 
--------------------------------------------------

You can create a new private endpoint or add an existing private 
endpoint for the online archives through your |service| User 
Interface. To set up the private endpoint:

.. tabs:: 

   .. tab:: Create New Endpoint 
      :tabid: create-new 

      .. include:: /includes/steps/oa-create-new-privatelink.rst

   .. tab:: Add Existing Endpoint 
      :tabid: add-existing

      .. include:: /includes/steps/oa-add-existing-privatelink.rst

Set Up Private Endpoint Through the API 
---------------------------------------

To configure a private endpoint for an online archive from the API, 
send a ``POST`` request with the private endpoint ID to the 
:oas-atlas-op:`privateNetworkSettings 
</createOneDataFederationPrivateEndpointForOneProject>` endpoint. 

- If the endpoint ID already exists and there is no change to 
  the comment associated with the endpoint, |service| makes no change 
  to the endpoint ID list.
- If the endpoint ID already exists and there is a change to the 
  associated comment, |service| updates the ``comment`` value only in 
  the endpoint ID list.
- If the endpoint ID doesn't exist, |service| appends the new endpoint 
  to the list of endpoints in the endpoint ID list.

To learn more about the syntax and options, see :oas-atlas-op:`API 
</createOneDataFederationPrivateEndpointForOneProject>`.
