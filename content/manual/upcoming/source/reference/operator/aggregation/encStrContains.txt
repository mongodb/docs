.. _qe-encstrcontains:

=====================================
$encStrContains (expression operator)
=====================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

Definition
----------

.. versionadded:: 8.2

.. |command| replace:: ``$encStrContains``

.. include:: /includes/queryable-encryption/qe-aggregation-operator.rst

.. expression:: $encStrContains

   Returns ``true`` if a subset of characters in a string value match the
   characters in the specified string. The queried field must have
   :ref:`substring queries enabled <qe-encryption-schema>`, and the length of
   the query string must be between the configured minimum and maximum number
   of characters, inclusive.

   By default, strings must match case and diacritical marks. 
   
   - Set :parameter:`caseSensitive` to ``false`` in the encryption schema for
     case-insensitive matching.
   
   - Set :parameter:`diacriticSensitive` to ``false`` in the encryption schema
     to disregard diacritic variations when matching.

   The :expression:`$encStrContains` expression has the following
   :ref:`operator expression syntax <aggregation-expressions>`:

   .. code-block:: javascript

      { $encStrContains: { input: ’$fieldname’, substring: <target search key> } }


Behavior
--------

.. include:: includes/queryable-encryption/qe-substring-search-behavior.rst

Example
--------

In :binary:`~bin.mongosh`:

.. code-block:: shell

   db.collection('MyCollection').aggregate([
      {
         $match: {
            $expr: {
               $encStrContains: {
                  input: '$employeeLastName',
                  substring: 'earso'
               }
            }
         }
      }
   ])

To match multiple fields:

.. code-block:: shell

   db.collection('MyCollection').aggregate([
      {
         $match: {
            $expr: {
               $and: [
                  {
                     $encStrContains: {
                        input: '$employeeLastName',
                        substring: 'earso'
                     }
                  },
                  {
                     $encStrContains: {
                        input: '$employeeFirstName',
                        substring: 'John'
                     }
                  }
               ]
            }
         }
      }
   ])