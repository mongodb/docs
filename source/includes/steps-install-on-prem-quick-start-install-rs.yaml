title: Set up the server that will run the MongoDB replica set.
stepnum: 1
ref: set-up-server
content: |
  Use a RHEL 6+ or Amazon Linux Server with at least:

  - 3 GB of memory.

  - 50 GB of disk space for the root partition.

  For example, you can meet the size requirements by using an AWS EC2
  ``m3.medium`` instance and changing the size of the root partition from
  8 to 50 gigabytes. When you log into the instance, use "``df -h``" to
  verify the root partition has 50 gigabytes of space.
---
stepnum: 2
source:
  file: steps-install-on-prem-quick-start-install-service.yaml
  ref: ulimits
---
title: Install MongoDB.
stepnum: 3
ref: install-mongodb
pre: |
  Use the following series of commands to install MongoDB.
action:
  - pre: |
      Set up a repository definition by issuing the following command:
    language: sh
    code: |
      echo "[MongoDB]
      name=MongoDB Repository
      baseurl=http://downloads-distro.mongodb.org/repo/redhat/os/x86_64
      gpgcheck=0
      enabled=1" | sudo tee -a /etc/yum.repos.d/mongodb.repo
  - pre: |
      Install MongoDB by issuing the following two commands:
    language: sh
    code: |
      sudo yum install -y mongodb-org mongodb-org-shell
---
title: Create the data directories for the replica set.
stepnum: 4
ref: data-directories
pre: |
  Create a data directory for each replica set member and set
  ``mongod.mongod`` as each data directory's owner.
action:
  - pre: |
      The following command creates the directory ``/data`` and then
      creates a data directory for each member of the replica set. You can
      use different directory names:
    language: sh
    code: |
      sudo mkdir -p /data /data/nodea /data/nodeb /data/nodec
  - pre: |
      The following command sets ``mongod.mongod`` as owner of the new
      directories:
    language: sh
    code: |
      sudo chown mongod:mongod /data /data/nodea /data/nodeb /data/nodec
---
title: Start a separate MongoDB instance for each replica set member.
stepnum: 5
ref: mongod-instances
pre: |
  Use the :program:`mongod` daemon to start each instance on its own
  dedicated port number and with the data directory you created in the
  last step. For each instance, specify ``mongod`` as the user. Start each
  instance with the replSet :manual:`command-line option
  </reference/program/mongod>` specifying the name of the replica set.
action:
  pre: |
    The following three commands start separate instances for each member
    of a new replica set named ``example``:
  language: sh
  code: |
    sudo -u mongod mongod --port 27017 --dbpath /data/nodea --replSet example --logpath /data/nodea/mongodb.log --fork

    sudo -u mongod mongod --port 27018 --dbpath /data/nodeb --replSet example --logpath /data/nodeb/mongodb.log --fork

    sudo -u mongod mongod --port 27019 --dbpath /data/nodec --replSet example --logpath /data/nodec/mongodb.log --fork
---
title: Initiate the replica set.
stepnum: 6
ref: initiate
pre: |
  Connect to one of the members and initiate the replica set using the
  :manual:`rs.initiate() </reference/method/rs.initiate>` method. Add the
  other members using the :manual:`rs.add() </reference/method/rs.add>`
  method. The :manual:`rs.add() </reference/method/rs.add>` method
  requires the hostame of the server: if necessary, first execute the
  ``hostname`` command to determine the name.
action:
  pre: |
    Use the following sequence of commands to initiate the replica set and
    add members. Replace ``<hostname>`` with the hostname of your server.
    The commands use the :program:`mongod` running on port ``27017`` to
    initiate the set and add the other members.
  language: sh
  code: |
    mongo --port 27017 --eval "rs.initiate()";

    mongo --port 27017 --eval "rs.add("<hostname>:27018")";

    mongo --port 27017 --eval "rs.add("<hostname>:27019")";
---
title: Connect to the replica set and verify the replica set configuration.
stepnum: 7
ref: verify-configuration
action:
  - pre: |
      To connect to the replica set, issue the :program:`mongo` command:
    language: sh
    code: |
      mongo
  - pre: |
      To verify the configuration, issue the :manual:`rs.status()
      </reference/method/rs.status>` method:
    language: sh
    code: |
      rs.status()
    post:
      Verify that the ``members`` array lists the three members. For a
      full description of the output, see the explanation in
      :manual:`replSetGetStatus </reference/command/replSetGetStatus>`.
---
title: Add data to the replica set.
stepnum: 8
ref: add-data
action:
  pre: |
    While still connected to the replica set, issue the following ``for``
    loop to create a collection titled ``testData`` and populate it with
    25,000 documents, each with an ``_id`` field and a field ``x`` set to
    a random string.
  language: javascript
  code: |
    for (var i = 1; i <= 25000; i++) {
      db.testData.insert( { x : Math.random().toString(36).substr(2, 15) } );
      sleep(0.1);
    }
---
title: Log into MMS.
stepnum: 9
ref: log-in
action:
  pre: |
    In a browser running on the same server as the replica set, enter the
    following URL, where ``<public_ip>`` is the public IP address of
    the server that runs MMS On Prem.
  language: none
  code: |
    http://<public_ip>:8080
  post: |
    Log in as the user you registered in the first procedure in this
    tutorial.
---
title: Set up the Monitoring Service for the replica set.
stepnum: 10
ref: set-up-monitoring
pre: |
content: |
  On the ``Welcome`` page, click the :guilabel:`Get Started` button for
  Monitoring. If the ``Welcome`` page is not visible, click the
  :guilabel:`Settings` tab to refresh MMS and then click the
  :guilabel:`Setup` tab to display the ``Welcome`` page.

  After you click :guilabel:`Get Started`, follow the instructions, which
  will take you through steps to download, configure, and run the
  Monitoring Agent.

  When the agent is running, the instructions prompt you to add a host. On
  the :guilabel:`Add a Host` page, enter the hostname and port of the
  replica set member running on port ``27017``. For example, enter
  ``<hostname>:27017``, replacing ``<hostname>`` with the hostname of the
  server running the replica set.

  When you finish the instructions, the Monitoring Agent is running and
  monitoring the replica set.
---
title: Set up the Backup Service for the replica set.
stepnum: 11
ref: set-up-backup
content: |
  On the ``Welcome`` page, click the :guilabel:`Get Started` button for
  Backup. If the ``Welcome`` page is not visible, click the
  :guilabel:`Settings` tab to refresh MMS and then click the
  :guilabel:`Setup` tab to display the ``Welcome`` page.

  After you click :guilabel:`Get Started`, follow the instructions to set
  up the Backup Service. When you reach the :guilabel:`Enable Backup`
  page, select the ``example`` replica set, which is the set you created
  when initializing the replica set members. If you chose a different name
  when initializing the members, choose that name here instead.

  When you finish the instructions, the Backup Agent is running and
  backing up the replica set. It may take up to 30 minutes for the first
  snapshot to complete, even for a very small replica set.

  While you are waiting, this is a good time to take a tour of your MMS
  Backup environment.
...
