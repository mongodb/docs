.. _enable-oidc-auth:

=================================================
Enable OIDC Authentication for your |mms| Project
=================================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

.. _enable-oidc-authentication:

.. include:: /includes/enable-auth-intro.rst

.. include:: /includes/authentication-oidc-intro.rst

Configure An External Identity Provider Application
---------------------------------------------------

|oidc| application registration steps can vary based on your
|idp|. Ensure that you complete the following items during
your registration process:

.. include:: /includes/steps/oidc-registration.rst

Once you register your application, save the ``issuer``, 
``clientId`` and ``audience`` values to use in the next stage of the
:ref:`OIDC IdP configuration <create-oidc-user>`.

Configure Microsoft Entra ID as an Identity Provider 
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

To register your |oidc| or OAuth application with |azure-ad|:

.. include:: /includes/steps/configure-oidc-azure.rst

Prerequisites
-------------

To enable OIDC authentication, you must:

- Use {+mongosh+} 1.9.1 or later.
- Use MongoDB 7.0 or later.
- Configure at least one other authentication mechanism with {+mdbagent+}.

  .. note:: 
     
     The {+mdbagent+} cannot connect to your cluster via |oidc|. You must
     enable an additional auth mechanism for the {+mdbagent+}. If |mms| 
     doesn't manage {+magent+} or {+bagent+}, you must manually configure
     them to use the alternative authentication mechanism.

Procedures
----------

.. include:: /includes/note-reset-auth.rst

Configure OIDC Authentication
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/steps-enable-authentication-oidc.rst

.. _create-oidc-user:

Configure OIDC Authorization
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

MongoDB does not explicitly create database users for |oidc|. It maps
|oidc| users to MongoDB roles based on their groups.

To create a database role for an |oidc| group:

.. include:: /includes/steps-configure-oidc-user.rst

.. _revoke-jwks-token:

Revoke JWKS
~~~~~~~~~~~

.. note::
   
   Don't use this feature to rotate your signing keys. When you rotate 
   your |oidc| |idp| signing keys, MongoDB fetches the JWKS automatically
   upon expiration of the existing access tokens.

If your private key is compromised, you can immediately revoke your JSON
Web Key Sets (JWKS) cached in MongoDB nodes:

.. include:: /includes/steps-remove-oidc-jwks-token.rst
