============================================================
Install or Upgrade |onprem| Monitoring with ``deb`` Packages
============================================================

.. default-domain:: mongodb

Overview
--------

At a high level, the installation involves the following:

#. Configure an |application| server that meets the :doc:`hardware
   requirements </core/requirements>`.

#. Install a single MongoDB replica set to be used for the |onprem|
   Application database, as described in
   :doc:`/tutorial/prepare-backing-mongodb-instances`.
   You **cannot** use a replica set that is being used to store other data.

#. Install an SMTP email server as appropriate for your environment.

#. Install the |mms| Application.

#. Configure the |mms| server's URL, email addresses, and Mongo URI connection strings.
   See :doc:`/reference/configuration` for more information.

#. Start up the |mms| Application. See
   :doc:`/tutorial/start-and-stop-application` for more information.

#. Optionally install the |mms| Backup Service.

Prerequisites
-------------

Configure an |application| server that meets the :doc:`hardware
requirements and software requirements </core/requirements>`.

Ensure that you have :doc:`deployed the backing MongoDB instances
</tutorial/prepare-backing-mongodb-instances>` that |mms| uses to store
application data. For additional information on installing MongoDB,
see the :manual:`MongoDB Installation tutorials </installation>`.

Procedures
----------

Install and Start the |onprem| Service
+++++++++++++++++++++++++++++++++++++++++

.. include:: /includes/steps/install-on-prem-with-deb-packages.rst

Optional: Install Backup Component
++++++++++++++++++++++++++++++++++

.. include:: /includes/steps/backup-install-backend-with-deb-packages.rst

Upgrade |mms| from 1.3 and Later
++++++++++++++++++++++++++++++++

If you have an existing |onprem| deployment, use the following
procedure to upgrade to the latest release. There are no supported
downgrade paths for |onprem|.

.. include:: /includes/steps/upgrade-on-prem-with-deb-packages.rst

Upgrade |mms| from 1.2 and Earlier
++++++++++++++++++++++++++++++++++

.. COMMENT: This procedure is intentionally left in the old steps format for now.

Due to the `company name change
<http://www.mongodb.com/press/10gen-announces-company-name-change-mongodb-inc>`_,
the name of the |mms| package changed between versions 1.2 and 1.3.
Therefore, to upgrade the |mms| server from *any* version before 1.3,
use the following procedure:

#. *Recommended.* Take a full backup of the |mms| database before
   beginning the upgrade procedure.

#. Shut down MMS, using the following command:

   .. code-block:: sh

      /etc/init.d/10gen-mms stop

#. Download the latest package from
   `the downloads page <http://www.mongodb.com/subscription/downloads/mms>`_
   and proceed with the instructions
   for a fresh install. Do not attempt to use your package manager
   to do an upgrade.

   When complete, |mms| is installed in the ``/opt/mongodb/mms``
   directory.

#. Follow all procedures for a new install, including configuring the
   options in ``/opt/mongodb/mms/conf/conf-mms.properties``. If you
   used encrypted authentication credentials you will need to
   regenerate these manually.  *Do not copy the credentials from
   your old properties file. Old credentials will not work.*

#. Start |mms| using the new package name:

   .. code-block:: sh

      sudo /etc/init.d/mongodb-mms start

#. Update any Monitoring Agent. See :doc:`/tutorial/nav/install-monitoring-agent` for
   more information.

Additional Information
----------------------

.. include:: /includes/additional-information-onprem-install-tutorial.rst
