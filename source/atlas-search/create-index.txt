.. _ref-create-index:
.. _default-index-definition:

============================
Create an Atlas Search Index
============================

.. default-domain:: mongodb

.. meta::
   :keywords: atlas search, create an atlas search index, create a search index, create a search index using the atlas ui, create a search index using the atlas search ui, create a search index using the atlas cli, create a search index using Terraform, video tutorial to create a search index, search index status
   :description: Create an Atlas Search index using the Atlas UI, Atlas Search API, Atlas CLI, or Terraform.

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. include:: /includes/facts/fts-index-description.rst

You can create an |fts| index for all collections except :manual:`time 
series </core/timeseries-collections/>` collections on your |service|
{+cluster+} through the {+atlas-ui+}, :oas-atlas-op:`API
</createAtlasSearchIndex>`, :atlas:`Atlas CLI 
</cli/stable/command/atlas-clusters-search-indexes-create/>`, and 
`Terraform
<https://registry.terraform.io/providers/mongodb/mongodbatlas/latest/docs/resources/search_index>`__. 

.. include:: /includes/atlas-search-out-agg.rst

Prerequisites
-------------

To create an |fts| index, you must have an |service| cluster with:

- MongoDB version ``4.2`` or higher
- Collection to create the |fts| index for


Required Access
---------------

.. include:: /includes/fact-fts-required-roles.rst

.. note::

  .. include:: /includes/fact-fts-shared-tier-limitations.rst


Create an |fts| Index Using the |service| UI 
--------------------------------------------

When you create a new |fts| index, choose a configuration method. 

.. figure:: /images/create-fts-index.png
     :alt: Screenshot of Create an Atlas Search Index modal window
     :figwidth: 650px
     :border:

You can use either the default index definition or specify a custom
definition for the index. The default index definition is :ref:`dynamic 
mapping <static-dynamic-mappings>` of fields in the documents and will 
work with any collection. If you wish to create a custom index 
definition for :ref:`static mapping <static-dynamic-mappings>`, you 
can specify which fields to index with which analyzer and as which data 
type. 

The index name defaults to :guilabel:`default`. You can leave
the default name in place or choose one of your own.

.. include:: /includes/default-fts-index-name.rst

Index names must be unique within their namespace.

Prefer to Learn by Watching?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Follow along with this video tutorial walk-through that demonstrates 
how to create |fts| indexes of various complexity.

*Duration: 15 Minutes*

.. video:: https://youtu.be/o2ss2LJNZVE 

Procedure 
~~~~~~~~~

To create an |fts| index from the |service| UI:

.. include:: /includes/steps/create-fts-index.rst

Create an |fts| Index Using the |fts| API 
-----------------------------------------

To create an |fts| index, send a ``POST`` request to the 
``fts/indexes`` :oas-atlas-op:`endpoint 
</createAtlasSearchIndex>`. To learn more about the 
syntax and parameters for this endpoint, see 
:oas-atlas-op:`Create One </createAtlasSearchIndex>`.

.. note:: 

   |service| doesn't create the index if the collection doesn't exist, 
   but it still returns a ``200`` status.

Create an |fts| Index Using the {+atlas-cli+} 
---------------------------------------------

.. include:: /includes/fact-atlas-cli-local-deployment-for-fts.rst

Create an |fts| Index for a Cloud Deployment 
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/extracts/atlas-clusters-search-indexes-create.rst

Create an |fts| Index for a Local Deployment 
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/extracts/atlas-deployments-search-indexes-create.rst

.. _ref-create-index-programmatically:

Create an |fts| Index Programmatically
--------------------------------------

You can create an |fts| index programmatically by using
{+mongosh+} or a supported :driver:`MongoDB Driver </>` 
in your preferred language. 

.. note:: 

   You can't use the {+mongosh+} command or driver helper methods to
   create |fts| indexes on ``M0``, ``M2``, or ``M5`` |service|
   {+clusters+}. To create |fts| indexes using {+mongosh+} or the
   driver, upgrade to a dedicated {+cluster+} tier. 

You must have at least the 
:atlasrole:`readWriteAnyDatabase` role or ``readWrite`` access to
the database that contains the indexes. To learn more, 
see :ref:`atlas-user-privileges` or :ref:`atlas-specific-privileges`.

----------

.. |arrow| unicode:: U+27A4

|arrow| Use the **Select your language** drop-down menu to set the 
language of the example in this section.

----------

.. tabs-selector:: drivers

.. tabs-drivers::

   .. tab::
      :tabid: shell

      .. include:: /includes/steps-fts-create-index-shell.rst

   .. tab::
      :tabid: nodejs

      .. include:: /includes/steps-fts-create-index-node.rst

   .. tab::
      :tabid: csharp

      .. include:: /includes/steps-fts-create-index-csharp.rst

   .. tab::
      :tabid: java-sync

      .. include:: /includes/steps-fts-create-index-java.rst


.. _node-status-ref:

Node Status
-----------

When you create the |fts| index, the |fts| Indexes tab in the 
right-side panel of the {+atlas-ui+} displays information about |fts| 
indexes for the selected namespace. The :guilabel:`Status` column shows 
the current state of the index on the primary node of the cluster. 
Click the :guilabel:`View status details` link below the status to view 
the state of the index on all the nodes of the cluster.

.. figure:: /images/fts-index-status.png
     :alt: Screenshot of Atlas Search Index information panel
     :figwidth: 700px

When the :guilabel:`Status` column reads :guilabel:`Active`, the index
is ready to use. In other states, queries against the index may return
incomplete results.

.. list-table::
   :header-rows: 1
   :widths: 25 75

   * - Status
     - Description

   * - Not Started 
     - |service| has not yet started building the index.

   * - Initial Sync 
     - |service| is building the index or re-building the 
       index after an edit. When the index is in this state:
       
       - For a new index, |fts| doesn't serve queries until the 
         index build is complete. 
       - For an existing index, you can continue to use the old index 
         for existing and new queries until the index rebuild 
         is complete.

   * - Active
     - Index is ready to use.

   * - Recovering
     - Replication encountered an error. This state commonly occurs 
       when the current replication point is no longer available on the 
       |mongod| oplog. You can still query the existing index until it 
       updates and its status changes to :guilabel:`Active`. Use the 
       error in the :guilabel:`View status details` modal window to 
       troubleshoot the issue. To learn more, see 
       :ref:`atlas-search-alerts`.

   * - Failed 
     - |service| could not build the index. Use the error  
       in the :guilabel:`View status details` modal window to 
       troubleshoot the issue. To learn more, see 
       :ref:`atlas-search-alerts`.

   * - Delete in Progress
     - |service| is deleting the index from the cluster nodes.

While |service| builds the index and after the build completes, the 
:guilabel:`Documents` column shows the percentage and number of 
documents indexed. The column also shows the total number of documents 
in the collection.

.. include:: /includes/fact-shardCollection-fts-indexes.rst

.. toctree::
   :titlesonly:

   Step 1: Process Data with Analyzers </atlas-search/analyzers>
   Step 2: Define Field Mappings </atlas-search/define-field-mappings>
   Step 3: Define Stored Source </atlas-search/stored-source-definition>
   Step 4: Define Synonym Mappings </atlas-search/synonyms> 
   Step 5: Review Index Syntax </atlas-search/index-definitions>
