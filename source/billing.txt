=======
Billing
=======

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

Billing is at the organization level while preserving visibility into
usage in each project.

|service| charges by the hour for your MongoDB clusters. |service|
tabulates costs daily and displays your current monthly costs in the
upper right corner. To view line-item charges, click the
:guilabel:`details` link to go to the invoice.

As you create or modify a cluster, you can compare the costs of different
options before applying them. |service| displays the costs, except for data
transfer, in a :guilabel:`Cluster Overview` box.

.. note::

   The :guilabel:`Cluster Overview` box does not display :ref:`data transfer
   costs <data-transfer-costs>`.

.. seealso:: `Atlas pricing page <https://www.mongodb.com/cloud/atlas/pricing>`_


.. _region-costs:

Cloud Service Provider and Region
---------------------------------

|service| supports deploying clusters onto :ref:`Amazon Web Services
<amazon-aws>`, the :ref:`Google Cloud Platform <google-gcp>`, and
:ref:`Microsoft Azure <microsoft-azure>`. The choice of cloud service provider
and region or regions for the |service| project affects the cost of running a
|service| cluster.

Multi-region cluster costs depend on the number of and location of additional
regions selected. When creating a cluster, |service| displays the
:ref:`instance size cost <instance-size-costs>` based on the
:guilabel:`Preferred Region` of the cluster. You can see the total cost of
running the cluster in the :guilabel:`Cluster Overview`.

.. _instance-size-costs:

Instance Size
-------------

|service| provides different instance sizes. Each instance size has a default
RAM capacity, storage capacity, and maximum storage speed. The cost of the
instance's per-hour charge includes these default values. |service| uses the
selected instance size when deploying all the data-bearing [#data-bearing]_
servers in your cluster.

Depending on the choice of cloud service provider, |service| provides
customization options for :ref:`instance storage capacity <storage-capacity>`
and the :ref:`speed <instance-storage-speed>` of that storage. If you add
capacity or speed, you incur additional costs on top of the base cost. For
multi-region clusters, the per-instance cost, including any selected
customizations, is relative to the :guilabel:`Preferred Region`. The
:guilabel:`Cluster Overview` box shows your overall charges.

.. _storage-capacity:
.. _instance-storage-capacity:

Storage Capacity
~~~~~~~~~~~~~~~~

|service| charges for storage capacity differently depending on whether you
use the instance default or specify a custom storage capacity. If you use the
default, storage is included in the instance's per-hour cost. If you
customize, |service| charges for the entire amount of storage, not the
difference from the default size.

For example, if the instance default is 80 GB and if you increase storage to
100 GB, the change in cost is the charge for 100 GB. If you then increase
storage to 120 GB, the change in cost is the charge for 20 GB.

.. note::

   Increasing storage capacity can change the max IOPS available
   with each :guilabel:`Custom Storage Speed`.

.. _storage-speed:
.. _instance-storage-speed:

Custom Storage Speed
~~~~~~~~~~~~~~~~~~~~

|service| measures storage speed as maximum Input/Output Operations Per Second
(IOPS). Each |service| :ref:`instance type <instance-size-costs>` offers a
default storage speed that is included in the instance's per-hour cost. The
choice of cloud service provider and instance size affects the available
storage speed customization options, as well as the cost of selecting a custom
storage speed.

:abbr:`AWS (Amazon Web Services)`
  For most instance types, you can increase storage speed from
  :guilabel:`Standard` to :guilabel:`Fast` or :guilabel:`Fastest`, which
  affects costs. Selecting a custom speed changes both :abbr:`IOPS
  (Input/Output Operations per Second)` and the type of storage used. The
  storage type changes from a general-purpose SSD to a provisioned-:abbr:`IOPS
  (Input/Output Operations per Second)` SSD. For more information on storage
  types, see
  `Amazon EBS Volume Types 
  <http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSVolumeTypes.html>`_.

:abbr:`GCP (Google Cloud Platform)`
  All instances use SSD persistent disks with fixed maximum :abbr:`IOPS
  (Input/Output Operations per Second)` based on the instance storage
  capacity. The maximum :abbr:`IOPS (Input/Output Operations per Second)`
  increases as storage capacity increases. The cost of the increased maximum
  :abbr:`IOPS (Input/Output Operations per Second)` is included in the cost of
  the increased storage capacity. For more information on the :abbr:`GCP
  (Google Cloud Platform)` persistent disks, see `Persistent Disks
  <https://cloud.google.com/compute/docs/disks/#pdspecs>`_.

:abbr:`Azure (Microsoft Azure)`
  All instances use premium SSD disks with fixed maximum :abbr:`IOPS
  (Input/Output Operations per Second)` based on the storage
  capacity. The maximum :abbr:`IOPS (Input/Output Operations per Second)`
  increases as storage capacity increases. The cost of the increased maximum
  :abbr:`IOPS (Input/Output Operations per Second)` is included in the cost of
  the increased storage capacity. For more information on the Azure Premium 
  disks, see `High-performance Premium Storage and managed disks for VMs
  <https://docs.microsoft.com/en-us/azure/storage/storage-premium-storage>`_.

.. _data-transfer-costs:

Data Transfer
-------------

|service| data transfer costs depend on the cloud service provider where you
deployed the cluster. Multi-region clusters may have higher data transfer
costs depending on the number and location of additional regions, as well as
the number of instances deployed to each region.

|service| tabulates data transfer costs daily.

:abbr:`AWS (Amazon Web Services)`
  |service| charges for data transfer between the |service| server and another
  server. Data transfer charges include traffic between cluster nodes,
  including an outgoing transfer from the source node and an incoming
  transfer to the destination node within the same AWS region. Charges for
  data transfer increase as follows, from lowest to highest:
  
  - Data transfer between the originating MongoDB |service| server and a
    server in the same AWS region.
  
  - Data transfer between the originating MongoDB |service| server and a
    server in a different AWS region.
  
  - Data transfer between the originating MongoDB |service| server and a
    server not in an AWS region.
  
:abbr:`GCP (Google Cloud Platform)`
  |service| charges for outgoing data transfers from an |service| server to
  another server. Incoming data transfers to an |service| server are free. 
  Data transfer charges for a |service| cluster are as follows, 
  from lowest to highest:
  
  - Outgoing data transfer between the originating MongoDB |service| node and:
    
    - a server that is in the same region but not in the same zone, or
    
    - a server where both the originating MongoDB |service| node and the
      destination server are in different regions in the United States of
      America.

  - Outgoing data transfer between the originating MongoDB |service| node and:
  
    - a server in a different continent, or 
    
    - a server in the same continent (excluding USA) but a different region, or
    
    - a server or machine not in a :abbr:`GCP (Google Cloud Platform)` data
      center.
 
:abbr:`Azure (Microsoft Azure)`
  |service| charges for outgoing data transfer from an |service| server to
  another server or machine *not* in the same region. Incoming data transfers
  to a |service| server are free. Data transfer charges for an |service|
  cluster depend on the geographic location of the source server.

.. _server-number-costs:

Number of Servers
-----------------

|service| charges the instance cost and data storage cost for each
data-bearing server [#data-bearing]_ in your cluster. For a replica set, the
number of data-bearing servers equals the replication factor. For a sharded
cluster, the number of data-bearing servers equals the replication factor
multiplied by the number of shards.

If you enable sharding, |service| will also run three :ref:`config servers
<sharding-config-server>` in addition to your data-bearing servers. Your
selections for instance size and data storage do not affect the costs of the
config servers. Config servers are charged at a separate rate. Their cost is
reflected in the cost of the cluster.

Backup
------

Backup costs are affected by both the size of your backed-up snapshots
and on your settings for snapshot frequency and retention.

Backup Cost Rate
~~~~~~~~~~~~~~~~

The backup cost per GB per month (US$2.50 / GB / month) is as specified
on the `Atlas pricing page
<https://www.mongodb.com/cloud/atlas/pricing?jmp=docs>`__. The monthly
rate is annualized and then divided by 365 to arrive at a Daily Backup
Rate per GB. The first 1GB of backup data is free.

The rate is based on your having 28 snapshots at steady state: 

- The six-hour snapshots are kept for two days; 

- The daily snapshots for one week,

- The weekly snapshots for one month,

- The monthly for one year. 

Adding that up, you get 8 + 5 + 3 + 12 = 28 snapshots. We adjust the
backup rate daily based on the following formula:

.. code-block:: none

   backupRatePerMonth = $1.25 + snapshotAtSteadyState/28 * $1.25

Size
~~~~

Monthly backup costs are based on the size per-gigabyte of the data to
back up. This size is roughly equivalent to the size of all documents
and all indexes for all the databases backed up. 

To retrieve the size in gigabyte of the documents and indexes for a
given database, you can issue the :manual:`db.stats()
</reference/method/db.stats>` method and sum the ``dataSize`` and
``indexSize`` fields.

.. code-block:: javascript

   db.stats(1024*1024*1024).dataSize + db.stats(1024*1024*1024).indexSize

|service| charges for each replica set in a cluster. For a replica set
deployment, backup costs is the cost to backup data for the replica
set. For a sharded cluster deployment, |service| sums the cost to
backup the data for each shard replica set *and* the config server
replica set.

.. example::

   For a three-member replica set with 30GB of data, |service| charges
   US$72.50 each month (using the deafault backup rate).

   ``(30GB - 1GB) × US$2.50 = US$72.50``

.. example::

   A sharded cluster with 3 shards contains 90GB of data, with each shard
   containing 30GB of data each. The config server replica set
   contains 5GB of data.

   For this sharded cluster, |service| charges US$227.50 per month
   (using the deafault backup rate).

   ``((30GB - 1GB) × US$2.50) × 3) + ((5GB - 1GB) × US$2.50) = US$227.50``

Lowering the Monthly Rate
~~~~~~~~~~~~~~~~~~~~~~~~~

Lowering snapshot frequency or lowering snapshot retention lowers the
cost per gigabyte. Increasing the snapshot frequency or the snapshot
retention increases the cost per gigabyte.

To modify the snapshot frequency or retention for a cluster, see
:ref:`modify-backup-schedule`.

|bic|
-----

If |bic| is enabled for your cluster:

- The billing rate for the |bic| will be described in the Cluster UI as
  a daily uplift on the cost of the associated cluster.

- |bic| has a sustained-usage pricing. That is, the daily rate is
  charged only up to a maximum for the month.

Billing Information
-------------------

Billing is at the organization level while preserving visibility into
usage in each project.

To access billing information, for the organization, click
:guilabel:`Settings`, then :guilabel:`Billing Overview`.

.. note::

   :guilabel:`Billing Profile` allows you to set an optional
   :guilabel:`Invoice Address` that is separate from the
   :guilabel:`Billing Address` set in the :guilabel:`Payment Method`.

   If you set an :guilabel:`Invoice Address`, you have the option to use this
   address for the :guilabel:`Billing Address` by selecting :guilabel:`same as
   Invoice Address` in the :guilabel:`Payment Method` screen.

Retry a Failed Payment
~~~~~~~~~~~~~~~~~~~~~~

If you receive notification of a failed payment, click :guilabel:`Settings`,
then :guilabel:`Billing Overview`, and check that your :guilabel:`Payment
Method` is correct.

To retry the payment, click :guilabel:`Settings`, then :guilabel:`Payment
History`. On the line for the failed payment, click :guilabel:`Retry`.

.. include:: /includes/footnote-databearing.rst


