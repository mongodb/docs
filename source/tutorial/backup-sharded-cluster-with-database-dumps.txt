============================================
Backup a Sharded Cluster with Database Dumps
============================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

Overview
--------

.. important:: The following procedure applies to MongoDB instances
   using the MMAPv1 storage engine.

This document describes a procedure for taking a backup of all
components of a sharded cluster. This procedure
uses :binary:`~bin.mongodump` to create dumps of the :binary:`~bin.mongod`
instance. An alternate procedure uses file system snapshots to capture
the backup data, and may be more efficient in some situations if your
system configuration allows file system backups. See
:doc:`/administration/backup-sharded-clusters` for more
information.

See :doc:`/core/backups` and
:doc:`/administration/backup-sharded-clusters` for complete
information on backups in MongoDB and backups of sharded clusters
in particular.

Prerequisites
-------------

.. include:: /includes/note-shard-cluster-backup.rst

Access Control
~~~~~~~~~~~~~~

The :authrole:`backup` role provides the required privileges to perform
backup on a sharded cluster that has access control enabled.

.. include:: /includes/fact-required-access-for-backup-profiling.rst

Consideration
-------------

To create these backups of a sharded cluster, you will stop the
cluster balancer and take a backup of the :term:`config database`,
and then take backups of each shard in the cluster using
:binary:`~bin.mongodump` to capture the backup data. To capture a more
exact moment-in-time snapshot of the system, you will need to stop all
application writes before taking the filesystem snapshots; otherwise
the snapshot will only approximate a moment in time.

For approximate point-in-time snapshots, taking the backup from a
single offline secondary member of the replica set that provides each
shard can improve the quality of the backup while minimizing impact on
the cluster.

Procedure
---------

.. important::

   The following procedure, which includes :method:`db.fsyncLock()` and
   :method:`db.fsyncUnlock()` operations, applies only to MongoDB
   instances using MMAPv1 storage engine.

.. include:: /includes/steps/backup-sharded-clusters-dumps.rst
