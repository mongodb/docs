stepnum: 1
level: 4
source:
  file: steps-source-upgrade-onprem.yaml
  ref: shutdown
pre: |
  For platforms that use `systemd <https://freedesktop.org/wiki/Software/systemd>`_ (RHEL, CentOS, SUSE12):
post: |
  For platforms that use ``SysVInit`` (Amazon Linux):

  .. code-block:: sh

     sudo /etc/init.d/mongodb-mms stop
---
stepnum: 2
level: 4
# Note: This step is borrowed from the rpm install procedure, not from steps-source-upgrade.
source:
  file: steps-install-on-prem-with-rpm-packages.yaml
  ref: download
---
title: "Install the |onprem| package on each |onprem| host."
stepnum: 3
level: 4
ref: install
content: |

  To install the ``.rpm`` package on each |application| host, issue
  the following command, where ``<version>`` is the version of the
  ``.rpm`` package:

  .. code-block:: sh

     sudo rpm -Uvh mongodb-mms-<version>.x86_64.rpm

  If you are running multiple hosts as one |onprem| instance, your
  |onprem| instance enters **Upgrade Mode**. You should not upgrade
  more than one |onprem| host at a time.

  .. admonition:: RPM Upgrade to 4.1+ modifies |mms| ``mms.conf`` file
     :class: important

     If you :doc:`modified the ports </tutorial/manage-ports>` or the
     JVM settings that Ops Manager uses, you need to re-apply those
     changes to the ``mms.conf`` file after |onprem| is upgraded.

     The upgrade to |onprem| 4.1 and 4.2 removed the ``-d64`` flag from
     the ``JAVA_MMS_UI_OPTS`` parameter.

---
stepnum: 4
level: 4
source:
  file: steps-source-upgrade-onprem.yaml
  ref: start
pre: |
  For platforms that use `systemd <https://freedesktop.org/wiki/Software/systemd>`_ (RHEL, CentOS, SUSE12):
post: |
  For platforms that use ``SysVInit`` (Amazon Linux):

  .. code-block:: sh

     sudo /etc/init.d/mongodb-mms start

---
stepnum: 5
level: 4
source:
  file: steps-source-upgrade-onprem.yaml
  ref: upgrade-install-agents

...
