---
stepnum: 1
level: 4
ref: nav-clusters
inherit:
  ref: project-nav-clusters-page
  file: steps-source-project-nav.yaml
---
stepnum: 2
level: 4
ref: add-ip-addresses-new-cluster-nodes
title: "Add IP addresses from your cluster nodes."
optional: true
content: |

  Depending on your Key Management Service configuration, you may have to add |service| 
  cluster node IP addresses to your cloud provider KMS list, so that the cluster can 
  communicate with your KMS. To enable communication between the cluster and KMS:

  a. Send a GET request to the ``ipAddresses`` endpoint. 
     The :oas-atlas-op:`API endpoint </returnAllIPAddresses>` returns 
     a list of IP addresses from the existing cluster nodes, similar 
     to the following:

     .. code-block:: json

        {
          "groupId": "xxx", // ObjectId
          "services": {
            "clusters": [
              {
                "clusterName": "Cluster0",
                "inbound": [
                  "3.92.113.229",
                  "3.208.110.31",
                  "107.22.44.69"
                  ], 
                "outbound": [
                  "3.92.113.229",
                  "3.208.110.31",
                  "107.22.44.69"
                ]
              }
            ]
          }
        }
  
  b. Add the returned IP addresses to your cloud provider's IP access list.
     See the prerequisites for managing customer keys with :ref:`AWS <aws-ksm-prereqs>`, 
     :ref:`Azure <azure-kms-prereqs>`, and :ref:`GCP <gcp-kms-prereqs>` for more information.
---
stepnum: 3
level: 4
ref: edit-cluster-config
title: "Modify the cluster's configuration."
content: |
  For the cluster that contains data that you want to encrypt, click the
  ellipses :guilabel:`...`, then select :guilabel:`Edit Configuration`.
---
stepnum: 4
level: 4
ref: toggle-customer-cm
title: "Enable cluster encryption."
content: |
  a. Expand the :guilabel:`Additional Settings` panel.

  b. Toggle the :guilabel:`Manage your own encryption keys` setting to
     :guilabel:`Yes`. 
---
stepnum: 5
level: 4
ref: verify
title: "Review and apply your changes."
content: |

  a. Click :guilabel:`Review Changes`.

  b. Review your changes, then click :guilabel:`Apply Changes` to update
     your cluster. 
...
