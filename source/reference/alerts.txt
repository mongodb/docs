================
Alert Conditions
================

.. default-domain:: mongodb

Overview
--------

.. only:: cloud

   When you create an :doc:`alert configuration
   </tutorial/manage-alert-configurations>`, specify the targets and alert
   conditions described here.

.. only:: onprem

   When you create a :doc:`group </tutorial/manage-alert-configurations>`
   or :doc:`global </tutorial/manage-global-alerts>` alert configuration,
   specify the targets and alert conditions described here.

Host Alerts
-----------

When configuring an alert that applies to hosts, you select the host type
as well as the alert condition.

Host Types
~~~~~~~~~~

For host type, you can apply the alerts to all MongoDB processes or to a
specific type of process:

.. list-table::
   :widths: 35 65
   :header-rows: 1

   * - Host Type

     - Applies To

   * - Any type

     - All the types described here.

   * - Standalone

     - Any :term:`mongod` instance that is **not** part of a replica
       set or sharded cluster and that is  **not** used as a config server.

   * - Primary

     - All replica set :term:`primaries <primary>`.

   * - Secondary

     - All replica set :term:`secondaries <secondary>`.

   * - Mongos

     - All :term:`mongos` instances.

   * - Conf

     - All :program:`mongod` instances used as :term:`config servers
       <config server>`.

Host Alert Conditions
~~~~~~~~~~~~~~~~~~~~~

Status
``````

The following conditions apply to a change in status for a
MongoDB process:

.. alert:: is added

   Sends an alert when |mms| starts monitoring or managing a
   :program:`mongod` or :program:`mongos` process for the first time.

.. alert:: is removed

   Sends an alert when |mms| stops monitoring or managing a
   :program:`mongod` or :program:`mongos` process for the first time.

.. alert:: is added to replica set

   Sends an alert when the specified type of :program:`mongod` process is
   added to a :term:`replica set`.

.. alert:: is removed from replica set

   Sends an alert when the specified type of :program:`mongod` process is
   removed from a :term:`replica set`.

.. alert:: is reactivated

   Sends an alert when a user :doc:`manually reactivates
   </tutorial/reactivate-hosts>` a MongoDB process that had been
   deactivated.

.. alert:: is deactivated

   Sends an alert when |mms| stops monitoring an unreachable MongoDB
   process.

.. alert:: is down

   Sends an alert when |mms| does not receive a ping from a host for more
   than 9 minutes. Under normal operation the Monitoring Agent connects to
   each monitored host about once per minute. |mms| will not alert
   immediately, however, but waits nine minutes in order to minimize false
   positives, as would occur, for example, during a host restart.

.. alert:: is recovering

   Sends an alert when a :term:`secondary` member of a :term:`replica set`
   enters the :replstate:`RECOVERING` state. For information on the
   :replstate:`RECOVERING` state, see :manual:`Replica Set Member
   States </reference/replica-states>`.

.. only:: cloud or classic

   .. alert:: does not have the latest version

      Sends an alert when the version of MongoDB running on a host is more
      than two releases behind. For example if the current production version
      of MongoDB is 2.6.0 and the previous release is 2.4.9 then a host
      running version 2.4.8 will trigger this alert but a host running 2.4.9
      (previous) 2.6.0 (current) or 2.6.1-rc2 (nightly) will not.

.. alert:: is exposed to the public Internet

   Sends an alert when the host is exposed to the public
   internet. When configured,
   |mms| periodically attempts to make a socket
   connection to your hosts. If |mms| is able to connect, |mms| triggers
   the alert. |mms| runs this check the 1st and 15th of the month *only.*

Asserts
```````

These alert conditions refer to the metrics found on the host's
``asserts`` chart. To view the chart, see
:ref:`access-host-statistics`.

.. alert:: Asserts: Regular is

   Sends an alert if the rate of regular asserts meets the specified
   threshold.

.. alert:: Asserts: Warning is

   Sends an alert if the rate of warnings meets the specified threshold.

.. alert:: Asserts: Msg is

   Sends an alert if the rate of message asserts meets the
   specified threshold. Message asserts are internal server errors. Stack
   traces are logged for these.

.. alert:: Asserts: User is

   Sends an alert if the rate of errors generated by users meets the
   specified threshold.

Opcounter
`````````

These alert conditions refer to the  metrics found on the host's ``opcounters``
chart. To view the chart, see :ref:`access-host-statistics`.

.. alert:: Opcounter: Cmd is

   Sends an alert if the rate of commands performed meets the specified
   threshold.

.. alert:: Opcounter: Query is

   Sends an alert if the rate of queries meets the specified threshold.

.. alert:: Opcounter: Update is

   Sends an alert if the rate of updates meets the specified threshold.

.. alert:: Opcounter: Delete is

   Sends an alert if the rate of deletes meets the specified threshold.

.. alert:: Opcounter: Insert is

   Sends an alert if the rate of inserts meets the specified threshold.

.. alert:: Opcounter: Getmores is

   Sends an alert if the rate of getmore (i.e. cursor batch) operations meets
   the specified threshold. For more information on getmore operations, see
   :manual:`the Cursors page </core/cursors>` in the MongoDB manual.

Opcounter - Repl
````````````````

These alert conditions apply to hosts that are :term:`secondary` members of
:term:`replica sets <replica set>`. The alerts use the metrics found on the host's
``opcounters - repl`` chart. To view the chart, see :ref:`access-host-statistics`.

.. alert:: Opcounter: Repl Cmd is

   Sends an alert if the rate of replicated commands meets the specified
   threshold.

.. alert:: Opcounter: Repl Update is

   Sends an alert if the rate of replicated updates meets the specified
   threshold.

.. alert:: Opcounter: Repl Delete is

   Sends an alert if the rate of replicated deletes meets the specified
   threshold.

.. alert:: Opcounter: Repl Insert is

   Sends an alert if the rate of replicated inserts meets the specified
   threshold.

Memory
``````

These alert conditions refer to the metrics found on the host's
``memory`` and ``non-mapped virtual memory`` charts. To view the
charts, see :ref:`access-host-statistics`. For additional information
about these metrics, click the :guilabel:`i` icon for each chart.

.. alert:: Memory: Resident is

   Sends an alert if the size of the resident memory meets the specified
   threshold. It is typical over time, on a dedicated database server, for
   the size of the resident memory to approach the amount of physical RAM
   on the box.

.. alert:: Memory: Virtual is

   Sends an alert if the size of virtual memory for the :manual:`mongod
   </reference/program/mongod>` process meets the specified threshold. You
   can use this alert to flag excessive memory outside of memory mapping.
   For more information, click the ``memory`` chart's :guilabel:`i` icon.

.. alert:: Memory: Mapped is

   Sends an alert if the size of mapped memory, which maps the data files,
   meets the specified threshold. As MongoDB memory-maps all the data
   files, the size of mapped memory is likely to approach total database
   size.

.. alert:: Memory: Computed is

   Sends an alert if the size of virtual memory that is not accounted for
   by memory-mapping meets the specified threshold. If this number is very
   high (multiple gigabytes), it indicates that excessive memory is being
   used outside of memory mapping. For more information on how to use this
   metric, view the ``non-mapped virtual memory`` chart and click the
   chart's :guilabel:`i` icon.

B-tree
``````

These alert conditions refer to the metrics found on the host's
``btree`` chart.  To view the chart, see
:ref:`access-host-statistics`.

.. alert:: B-tree: accesses is

   Sends an alert if the number of accesses to B-tree indexes meets the
   specified average.

.. alert:: B-tree: hits is

   Sends an alert if the number of times a B-tree page was in memory meets
   the specified average.

.. alert:: B-tree: misses is

   Sends an alert if the number of times a B-tree page was *not* in memory
   meets the specified average.

.. alert:: B-tree: miss ratio is

   Sends an alert if the ratio of misses to hits meets the specified
   threshold.

Lock %
``````

This alert condition refers to  metric found on the host's ``lock %`` chart.
To view the chart, see :ref:`access-host-statistics`.

.. alert:: Effective Lock % is

   Sends an alert if the amount of time the host is :term:`write locked
   <write lock>` meets the specified threshold. For details on this
   metric, view the ``lock %`` chart and click the chart's :guilabel:`i`
   icon.

Background
``````````

This alert condition refers to  metric found on the host's ``background flush
avg`` chart. To view the chart, see :ref:`access-host-statistics`.

.. alert:: Background Flush Average is

   Sends an alert if the average time for background flushes meets the
   specified threshold. For details on this metric, view the ``background
   flush avg`` chart and click the chart's :guilabel:`i` icon.

Connections
```````````

The following alert condition refers to a metric found on the host's ``connections``
chart. To view the chart, see :ref:`access-host-statistics`.

.. alert:: Connections is

   Sends an alert if the number of active connections to the host meets
   the specified average.

Queues
``````

These alert conditions refer to the metrics found on the host's ``queues`` chart.
To view the chart, see :ref:`access-host-statistics`.

.. alert:: Queues: Total is

   Sends an alert if the number of operations waiting on a
   :term:`lock` of any type meets the specified average.

.. alert:: Queues: Readers is

   Sends an alert if the number of operations waiting on a :term:`read
   lock` meets the specified average.

.. alert:: Queues: Writers is

   Sends an alert if the number of operations waiting on a :term:`write
   lock` meets the specified average.

Page Faults
```````````

These alert conditions refer to metrics found on the host's ``Record Stats``
and ``Page Faults`` charts. To view the charts, see :ref:`access-host-statistics`.

.. alert:: Accesses Not In Memory: Total is

   Sends an alert if the rate of disk accesses meets the specified threshold.
   MongoDB must access data on disk if your :term:`working set` does not fit
   in memory. This metric is found on the host's ``Record Stats`` chart.

.. alert:: Page Fault Exceptions Thrown: Total is

   Sends an alert if the rate of page fault exceptions thrown meets the
   specified threshold. This metric is found on the host's ``Record Stats``
   chart.

.. alert:: Page Faults is

   Sends an alert if the rate of page faults (whether or not an exception is
   thrown) meets the specified threshold. This metric is found on the host's
   ``Page Faults`` chart.

Cursors
```````

These alert conditions refer to the metrics found on the host's ``cursors``
chart. To view the chart, see :ref:`access-host-statistics`.

.. alert:: Cursors: Open is

   Sends an alert if the number of cursors the server is maintaining for
   clients meets the specified average.

.. alert:: Cursors: Timed Out is

   Sends an alert if the number of timed-out cursors the server is
   maintaining for clients meets the specified average.

.. alert:: Cursors: Client Cursors Size is

   Sends an alert if the cumulative size of the cursors the server is
   maintaining for clients meets the specified average.

Network
```````

These alert conditions refer to the metrics found on the host's ``network``
chart. To view the chart, see :ref:`access-host-statistics`.

.. alert:: Network: Bytes In is

   Sends an alert if the number of bytes sent *to* the database server
   meets the specified threshold.

.. alert:: Network: Bytes Out is

   Sends an alert if the number of bytes sent *from* the database server
   meets the specified threshold.

.. alert:: Network: Num Requests is

   Sends an alert if the number of requests sent to the database server
   meets the specified average.

Replication
```````````

These alert conditions refer to the metrics found on a :term:`primary's
<primary>` ``replication oplog window`` chart or a :term:`secondary's
<secondary>` ``replication lag`` chart. To view the charts, see
:ref:`access-host-statistics`.

.. alert:: Replication Oplog Window is

   Sends an alert if the approximate amount of time available in the
   primary's replication :term:`oplog` meets the specified threshold.

.. alert:: Replication Lag is

   Sends an alert if the approximate amount of time that the secondary is
   behind the primary meets the specified threshold.

.. alert:: Replication Headroom is

   Sends an alert when the difference between the primary oplog window and
   the replication lag time on a secondary meets the specified threshold.

.. alert:: Oplog Data per Hour is

   Sends an alert when the amount of data per hour being written to a
   primary's oplog meets the specified threshold.

DB Storage
``````````

This alert condition refers to the metric displayed on the host's ``db storage``
chart. To view the chart, see :ref:`access-host-statistics`.

.. alert:: DB Storage is

   Sends an alert if the amount of on-disk storage space used by extents
   meets the specified threshold. Extents are contiguously allocated
   chunks of datafile space. 

   DB storage size is larger than DB data size because storage size measures
   the entirety of each extent, including space not used by documents. For
   more information on extents, see the :manual:`collStats command
   </reference/command/collStats>`.

.. alert:: DB Data Size is

    Sends an alert if approximate size of all documents (and their paddings)
    meets the specified threshold.

Journaling
``````````

These alert conditions refer to the metrics found on the host's ``journal -
commits in write lock`` chart and ``journal stats`` chart. To view the
charts, see :ref:`access-host-statistics`.

.. alert:: Journaling Commits in Write Lock is

   Sends an alert if the rate of commits that occurred while the database
   was in :term:`write lock` meets the specified average.

.. alert:: Journaling MB is

   Sends an alert if the average amount of data written to the recovery
   log meets the specified threshold.

.. alert:: Journaling Write Data Files MB is

   Sends an alert if the average amount of data written to the data files
   meets the specified threshold.

WiredTiger Storage Engine
`````````````````````````

These alert conditions apply to the WiredTiger storage engine.

.. alert:: Tickets Available: Reads is

   Sends an alert if the number of read tickets available to the
   WiredTiger storage engine meet the specified threshold.

.. alert:: Tickets Available: Writes is

   Sends an alert if the number of write tickets available to the
   WiredTiger storage engine meet the specified threshold.

.. alert:: Cache: Dirty Bytes is

   Sends an alert when the number of dirty bytes in the WiredTiger cache
   meets the specified threshold.

.. alert:: Cache: Used Bytes is

   Sends an alert when the number of used bytes in the WiredTiger cache
   meets the specified threshold.

.. alert:: Cache: Bytes Read Into Cache is

   Sends an alert when the number of bytes read into the WiredTiger cache
   meets the specified threshold.

.. alert:: Cache: Bytes Written From Cache is

   Sends an alert when the number of bytes written from the WiredTiger
   cache meets the specified threshold.

Replica Set Alerts
------------------

These alert conditions apply to :term:`replica sets
<replica set>`.

.. alert:: Primary Elected

   Sends an alert when a set elects a new :term:`primary`. Each time |mms|
   receives a ping, it inspects the output of the replica set's
   :manual:`rs.status() </reference/method/rs.status>` method for the
   status of each replica set member. From this output, |mms| determines
   which replica set member is the primary. If the primary found in the
   ping data is different than the current primary known to |mms|, this
   alert triggers.

   :alert:`Primary Elected` does not always mean that the set elected
   a *new* primary. :alert:`Primary Elected` may also trigger when the
   same primary is re-elected. This can happen when |mms| processes a
   ping in the midst of an election.

.. alert:: No Primary

   Sends an alert when a replica set does not have a :term:`primary`.
   Specifically, when none of the members of a
   replica set have a status of ``PRIMARY``, the alert triggers. For
   example, this condition may arise when a set has an even number of
   voting members resulting in a tie.

   If the Monitoring Agent collects data during an :manual:`election for
   primary </core/replica-set-elections>`, this alert might send a false
   positive. To prevent such false positives, set the alert
   configuration's :guilabel:`after waiting` interval (in the
   configuration's :guilabel:`Send to` section).

.. alert:: Number of Healthy Members is

   Sends an alert when a replica set has fewer than the specified number
   of healthy members. If the replica set has the specified number of
   healthy members or more, |mms| triggers no alert.

   A replica set member is healthy if its state, as reported in the
   :manual:`rs.status() </reference/method/rs.status>` output, is either
   :replstate:`PRIMARY` or :replstate:`SECONDARY`. Hidden secondaries
   and arbiters are not counted.

   As an example, if you have a replica set with one member in the
   :replstate:`PRIMARY` state, two members in the
   :replstate:`SECONDARY` state, one hidden member in the
   :replstate:`SECONDARY`, one :replstate:`ARBITER`, and one member in
   the :replstate:`RECOVERING` state, then the healthy count is 3.

.. alert:: Number of Unhealthy Members is

   Sends an alert when a replica set has more than the specified number of
   unhealthy members. If the replica set has the specified number or
   fewer, |mms| sends no alert.

   Replica set members are unhealthy when the agent cannot connect to
   them, or the member is in a rollback or recovering state.

   Hidden secondaries are not counted.

Agent Alerts
------------

These alert conditions apply to Monitoring Agents
and Backup Agents.

.. alert:: Monitoring Agent is down

   Sends an alert if the Monitoring Agent has been down for at least 7
   minutes. Under normal operation, the Monitoring Agent sends a ping to
   |mms| roughly once per minute. If |mms| does not receive a ping for at
   least 7 minutes, this alert triggers. However, this alert will never
   trigger for a group that has no hosts configured.

   .. important::

      When the Monitoring Agent is down, |mms| will trigger no other alerts.
      For example, if a host is down there is no Monitoring Agent to send
      data to |mms| that could trigger new alerts.

.. alert:: Monitoring Agent is out of date

   Sends an alert when the Monitoring Agent is not running the latest
   version of the software.

.. alert:: Backup Agent is down

   Sends an alert when the Backup Agent for a group with at least one
   active replica set or cluster is down for more than 1 hour.

   To resolve this alert:

   1. Open the group in |mms| by typing the group's name in the
      :guilabel:`GROUP` box.

   2. Select the :guilabel:`Backup` tab and then the :guilabel:`Backup
      Agents` page to see what server the Backup Agent is hosted on.

   3. Check the Backup Agent log file on that server.

.. alert:: Backup Agent is out of date

   Sends an alert when the Backup Agent is not running the latest
   version of the software.

.. only:: onprem

   .. alert:: Backup Agent has too many conf call failures

      Available only as a :doc:`global alert </core/global-and-system-alerts>`.

      Sends an alert when the cluster topology as known by monitoring does
      not match the backup configuration from conf calls made by the
      Backup Agent.

.. _backup-alert-conditions:

Backup Alerts
-------------

These alert conditions apply to the |mms| Backup service.

.. alert:: Oplog Behind

   Sends an alert if the most recent :term:`oplog` data received by |mms| is
   more than 75 minutes old.

.. alert:: Resync Required

   Sends an alert if the replication process for a backup falls too far
   behind the :term:`oplog` to catch up. This occurs when the host
   overwrites oplog entries that backup has not yet replicated. When this
   happens, you must resync backup, as described in the procedure
   :doc:`/tutorial/resync-backup`.

   Also, check the corresponding Backup Agent log. If you see a "Failed
   Common Points" test, one of the following may have happened.

   - A significant rollback event occurred on the backed-up replica set.

   - The :manual:`oplog </core/replica-set-oplog/>` for the backed-up
     replica set was resized or deleted.

   - High oplog churn caused the agent to lose the tail of the oplog.

.. alert:: Cluster Mongos Is Missing

   Sends an alert if |mms| cannot reach a :program:`mongos` for the cluster.

.. only:: onprem

   .. alert:: Bind Error

      Available only as a :doc:`global alert </core/global-and-system-alerts>`.

      Sends an alert if a backup job fails to bind to a Backup Daemon. A
      job might fail to bind, for example, if:

      - No :manual:`primary </core/replica-set-primary>` is found for the
        backed-up replica set. At the time the binding occurred, no
        primary could be detected by the Monitoring Agent. Ensure that the
        replica set is healthy.

      - Not enough space is available on any Backup Daemon.

      In both cases, resolve the issue and then :doc:`restart the initial
      sync of the backup </tutorial/enable-backup>`.

      As an alternative, you can manually bind jobs to daemons through the
      :guilabel:`Admin` interface. See :ref:`jobs-page` for more
      information.

.. only:: onprem

   .. alert:: Backup has reached a high number of retries

      Available only as a :doc:`global alert </core/global-and-system-alerts>`.

      Sends an alert if the same task fails repeatedly. This could happen,
      for example, during maintenance. :ref:`Check the corresponding job
      log <jobs-page>` for an error message explaining the problem.
      Contact MongoDB Support if you need help interpreting the error
      message.

      In such cases, you must resync the Backup replica set, as described
      in the procedure :doc:`/tutorial/resync-backup`.

.. only:: onprem

   .. alert:: Backup is in an unexpected state

      Available only as a :doc:`global alert </core/global-and-system-alerts>`.

      Sends an alert when something very unexpected happened and the
      Backup state for the replica set is marked as "broken." You must
      resync the backed-up replica set, as described in the procedure
      :doc:`/tutorial/resync-backup`.

      Also, :ref:`check the corresponding job log <jobs-page>` for an
      error message explaining the problem. Contact MongoDB Support if you
      need help interpreting the error message.

.. only:: onprem

   .. alert:: Late Snapshot

      Available only as a :doc:`global alert </core/global-and-system-alerts>`.

      Sends an alert if a snapshot has failed to complete before the next
      snapshot is scheduled to begin. :ref:`Check the job log <jobs-page>`
      in the |mms| Admin interface for any obvious errors.

.. alert:: Bad Clustershot Count is

   Sends an alert if |mms| fails a consecutive number of times to
   successfully take a cluster snapshot. |mms| sends notification when the
   number exceeds the number specified in the alert
   configuration.

   The alert text should contain the reason for the problem. Common
   problems include the following:

   - There was no reachable :manual:`mongos </reference/program/mongos>`.
     To resolve this issue, ensure that there is at least one
     :program:`mongos` showing on the |mms| :guilabel:`Deployment` page.

   - The :manual:`balancer </core/sharding-balancing>` could not be
     stopped. To resolve this issue, check the log files for the first
     :manual:`config server </core/sharded-cluster-config-servers>` to
     determine why the balancer will not stop.

   - Could not insert a token in one or more :manual:`shards
     </core/sharded-cluster-shards>`. To resolve this issue, ensure
     connectivity between the Backup Agent and all shards.

.. only:: onprem

   .. alert:: Sync Slice Has Not Progressed in

      Available only as a :doc:`global alert </core/global-and-system-alerts>`.

      Sends an alert when an :ref:`initial sync <backup-initial-sync>` has
      started but then subsequently stalled. A number of issues can cause
      this, including:

      - processes that are down (agents, ingest, backing databases)
      - network issues
      - incorrect authentication credentials

      :ref:`Sync slices <sync-stores-page>` are temporary backups the
      Backup Agent creates during the initial sync.

User Alerts
-----------

These alert conditions apply to the |mms| Users.

.. alert:: Added to Group

   Sends an alert when a new user joins the group.

.. alert:: Removed from Group

   Sends an alert when a user leaves the group.

.. alert:: Changed Roles

   Sends an alert when a user's roles have been changed.

Group Alerts
------------

These alert conditions apply to group membership, group security, and the
group's subscription.

.. alert:: Users awaiting approval to join group

   Sends an alert if there are users who have asked to join the group. A user
   can ask to join a group when first registering for |mms|.

.. alert:: Users do not have two factor authentication enabled

   Sends an alert if the group has users who have not set up
   :doc:`two-factor authentication </core/two-factor-authentication>`.

.. alert:: Service suspended due to unpaid invoice(s) more than 30 days old

   Sends an alert if the group is suspended because of non-payment. A
   suspended group:

   - denies users access,

   - stops backups,

   - terminates stored snapshots 90 days after suspension.

.. only:: cloud or classic

   Billing Alert Condition
   -----------------------

   The following alert condition applies to |mms| billing.

   .. alert:: Credit card is about to expire

      Sends an alert if the credit card on file is about to expire. The
      alert is triggered at the beginning of the month that the card
      expires. |mms| enables this alert configuration when a credit card
      is added for the first time.
