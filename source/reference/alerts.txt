================
Alert Conditions
================

.. default-domain:: mongodb

Overview
--------

|mms| provides configurable alert conditions that you can apply to MMS
components, such as hosts, clusters, or agents. This document groups
the conditions according to the target components to which they apply.

Select alert conditions when configuring alerts, for more information
on configuring alerts, see the :doc:`/tutorial/create-alert` and
:doc:`/tutorial/manage-alerts-and-events` documents.

Host Alerts
-----------

The Host Alerts are applicable to MongoDB hosts (i.e. :program:`mongos`
and :program:`mongod` instances). and
are grouped here according to the category monitored.

Host Status
~~~~~~~~~~~

.. alert:: is down

   Sends an alert when MMS does not receive a ping from a host for more
   than 9 minutes. Under normal operation the Monitoring Agent connects to
   each monitored host about once per minute. MMS will not alert
   immediately, however, but waits nine minutes in order to minimize false
   positives, as would occur, for example, during a host restart.

.. alert:: is recovering

   Sends an alert when a :term:`secondary` member of a :term:`replica set`
   enters the :replstate:`RECOVERING` state. For information on the
   :replstate:`RECOVERING` state, see :manual:`Replica Set Member
   States </reference/replica-states>`.

.. alert:: does not have latest version

   This does not apply to On Prem MongoDB Management Service.

   Sends an alert when the version of MongoDB running on a host is more
   than two releases behind. For example if the current production version
   of MongoDB is 2.6.0 and the previous release is 2.4.9 then a host
   running version 2.4.8 will trigger this alert but a host running 2.4.9
   (previous) 2.6.0 (current) or 2.6.1-rc2 (nightly) will not.

.. alert:: is exposed to the public internet

   Sends an alert when the host is exposed to the public
   internet. When configured,
   MMS periodically attempts to make a socket
   connection to your hosts. If MMS is able to connect, MMS triggers
   the alert. MMS runs this check the 1st and 15th of the month *only.*

Asserts
~~~~~~~

These alert conditions refer to the metrics found on the host's
``asserts`` chart. To view the chart, see
:ref:`access-host-statistics`.

.. alert:: Asserts: Regular is

   Sends an alert if the rate of regular asserts meets the specified
   threshold.

.. alert:: Asserts: Warning is

   Sends an alert if the rate of warnings meets the specified threshold.

.. alert:: Asserts: Msg is

   Sends an alert if the rate of message asserts meets the
   specified threshold. Message asserts are internal server errors. Stack
   traces are logged for these.

.. alert:: Asserts: User is

   Sends an alert if the rate of errors generated by users meets the
   specified threshold.

Opcounter
~~~~~~~~~

These alert conditions refer to the  metrics found on the host's ``opcounters``
chart. To view the chart, see :ref:`access-host-statistics`.

.. alert:: Opcounter: Cmd is

   Sends an alert if the rate of commands performed meets the specified
   threshold.

.. alert:: Opcounter: Query is

   Sends an alert if the rate of queries meets the specified threshold.

.. alert:: Opcounter: Update is

   Sends an alert if the rate of updates meets the specified threshold.

.. alert:: Opcounter: Delete is

   Sends an alert if the rate of deletes meets the specified threshold.

.. alert:: Opcounter: Insert is

   Sends an alert if the rate of inserts meets the specified threshold.

Opcounter - Repl
~~~~~~~~~~~~~~~~

These alert conditions apply to hosts that are :term:`secondary` members of
:term:`replica sets <replica set>`. The alerts use the metrics found on the host's
``opcounters - repl`` chart. To view the chart, see :ref:`access-host-statistics`.

.. alert:: Opcounter: Repl Update is

   Sends an alert if the rate of replicated updates meets the specified
   threshold.

.. alert:: Opcounter: Repl Delete is

   Sends an alert if the rate of replicated deletes meets the specified
   threshold.

.. alert:: Opcounter: Repl Insert is

   Sends an alert if the rate of replicated inserts meets the specified
   threshold.

Memory
~~~~~~

These alert conditions refer to the metrics found on the host's
``memory`` and ``non-mapped virtual memory`` charts. To view the
charts, see :ref:`access-host-statistics`. For additional information
about these metrics, click the :guilabel:`i` icon for each chart.

.. alert:: Memory: Resident is

   Sends an alert if the size of the resident memory meets the specified
   threshold. It is typical over time, on a dedicated database server, for
   the size of the resident memory to approach the amount of physical RAM
   on the box.

.. alert:: Memory: Virtual is

   Sends an alert if the size of virtual memory for the :manual:`mongod
   </reference/program/mongod>` process meets the specified threshold. You
   can use this alert to flag excessive memory outside of memory mapping.
   For more information, click the ``memory`` chart's :guilabel:`i` icon.

.. alert:: Memory: Mapped is

   Sends an alert if the size of mapped memory, which maps the data files,
   meets the specified threshold. As MongoDB memory-maps all the data
   files, the size of mapped memory is likely to approach total database
   size.

.. alert:: Memory: Computed is

   Sends an alert if the size of virtual memory that is not accounted for
   by memory-mapping meets the specified threshold. If this number is very
   high (multiple gigabytes), it indicates that excessive memory is being
   used outside of memory mapping. For more information on how to use this
   metric, view the ``non-mapped virtual memory`` chart and click the
   chart's :guilabel:`i` icon.

B-tree
~~~~~~

These alert conditions refer to the metrics found on the host's
``btree`` chart.  To view the chart, see
:ref:`access-host-statistics`.

.. alert:: B-tree: accesses is

   Sends an alert if the number of accesses to B-tree indexes meets the
   specified average.

.. alert:: B-tree: hits is

   Sends an alert if the number of times a B-tree page was in memory meets
   the specified average.

.. alert:: B-tree: misses is

   Sends an alert if the number of times a B-tree page was *not* in memory
   meets the specified average.

.. alert:: B-tree: miss ratio is

   Sends an alert if the ratio of misses to hits meets the specified
   threshold.

Lock %
~~~~~~

This alert condition refers to  metric found on the host's ``lock %`` chart.
To view the chart, see :ref:`access-host-statistics`.

.. alert:: Lock % is

   Sends an alert if the amount of time the host is :term:`write locked
   <write lock>` meets the specified threshold. For details on this
   metric, view the ``lock %`` chart and click the chart's :guilabel:`i`
   icon.

Background
~~~~~~~~~~

This alert condition refers to  metric found on the host's ``background flush
avg`` chart. To view the chart, see :ref:`access-host-statistics`.

.. alert:: Background Flush Average is

   Sends an alert if the average time for background flushes meets the
   specified threshold. For details on this metric, view the ``background
   flush avg`` chart and click the chart's :guilabel:`i` icon.

Connections
~~~~~~~~~~~

The following alert conditions refer to the metrics found on the host's ``connections``
chart. To view the chart, see :ref:`access-host-statistics`.

.. alert:: Connections is

   Sends an alert if the number of active connections to the host meets
   the specified average.

.. alert:: Connections Max is

   Sends an alert if the sum of the total number of active connections
   plus the total number of remaining connections available on the server
   meets the specified threshold.

Queues
~~~~~~

These alert conditions refer to the metrics found on the host's ``queues`` chart.
To view the chart, see :ref:`access-host-statistics`.

.. alert:: Queues: Total is

   Sends an alert if the number of operations waiting on a :term:`lock
   <locks>` of any type meets the specified average.

.. alert:: Queues: Readers is

   Sends an alert if the number of operations waiting on a :term:`read
   lock` meets the specified average.

.. alert:: Queues: Writers is

   Sends an alert if the number of operations waiting on a :term:`write
   lock` meets the specified average.

Cursors
~~~~~~~

These alert conditions refer to the metrics found on the host's ``cursors``
chart. To view the chart, see :ref:`access-host-statistics`.

.. alert:: Cursors: Open is

   Sends an alert if the number of cursors the server is maintaining for
   clients meets the specified average.

.. alert:: Cursors: Timed Out is

   Sends an alert if the number of timed-out cursors the server is
   maintaining for clients meets the specified average.

.. alert:: Cursors: Client Cursors Size is

   Sends an alert if the cumulative size of the cursors the server is
   maintaining for clients meets the specified average.

Network
~~~~~~~

These alert conditions refer to the metrics found on the host's ``network``
chart. To view the chart, see :ref:`access-host-statistics`.

.. alert:: Network: Bytes In is

   Sends an alert if the number of bytes sent *to* the database server
   meets the specified threshold.

.. alert:: Network: Bytes Out is

   Sends an alert if the number of bytes sent *from* the database server
   meets the specified threshold.

.. alert:: Network: Num Requests is

   Sends an alert if the number of requests sent to the database server
   meets the specified average.

Replication
~~~~~~~~~~~

These alert conditions refer to the metrics found on a :term:`primary's
<primary>` ``replication oplog window`` chart or a :term:`secondary's
<secondary>` ``replication lag`` chart. To view the charts, see
:ref:`access-host-statistics`.

.. alert:: Replication Oplog Window is

   Sends an alert if the approximate amount of time available in the
   primary's replication :term:`oplog` meets the specified threshold.

.. alert:: Replication Lag is

   Sends an alert if the approximate amount of time that the secondary is
   behind the primary meets the specified threshold.

.. alert:: Replication Headroom is

   Sends an alert when the difference between the primary oplog window and
   the replication lag time on a secondary meets the specified threshold.

.. alert:: Oplog Data per Hour is

   Sends an alert when the amount of data per hour being written to a
   primary's oplog meets the specified threshold.

Page Faults
~~~~~~~~~~~

This alert condition refers to the metric displayed on the host's
``page faults`` chart. To view the chart, see
:ref:`access-host-statistics`.

.. alert:: Page Faults is

   Sends an alert if the rate of page faults meets the specified
   threshold.

DB Storage
~~~~~~~~~~

This alert condition refers to the metric displayed on the host's ``db storage``
chart. To view the chart, see :ref:`access-host-statistics`.

.. alert:: DB Storage is

   Sends an alert if the amount of on-disk storage space used by extents
   meets the specified threshold. Extents are contiguously allocated
   chunks of datafile space. For more information on extents, see the
   :manual:`collStats command </reference/command/collStats>`.

Journaling
~~~~~~~~~~

These alert conditions refer to the metrics found on the host's ``journal -
commits in write lock`` chart and ``journal stats`` chart. To view the
charts, see :ref:`access-host-statistics`.

.. alert:: Journaling Commits in Write Lock is

   Sends an alert if the rate of commits that occurred while the database
   was in :term:`write lock` meets the specified average.

.. alert:: Journaling MB is

   Sends an alert if the average amount of data written to the recovery
   log meets the specified threshold.

.. alert:: Journaling Write Data Files MB is

   Sends an alert if the average amount of data written to the data files
   meets the specified threshold.

Replica Set Alerts
------------------

These alert conditions are applicable to :term:`replica sets
<replica set>`.

.. alert:: Primary Elected

   Sends an alert when a set elects a new :term:`primary`. Each time MMS
   receives a ping, it inspects the output of the replica set's
   :manual:`rs.status() </reference/method/rs.status>` method for the
   status of each replica set member. From this output, MMS determines
   which replica set member is the primary. If the primary found in the
   ping data is different than the current primary known to MMS, this
   alert triggers.

   :alert:`Primary Elected` does not always mean that the set elected
   a *new* primary. :alert:`Primary Elected` may also trigger when the
   same primary is re-elected. This can happen when MMS processes a
   ping in the midst of an election.

.. alert:: No Primary

   Sends an alert when a replica set does not have a :term:`primary`.
   Specifically, when none of the members of a
   replica set have a status of ``PRIMARY``, the alert triggers. For
   example, this condition may arise when a set has an even number of
   voting members resulting in a tie.

   If the Monitoring Agent collects data during an :manual:`election for
   primary </core/replica-set-elections>`, this alert might send a false
   positive. To prevent such false positives, set the alert
   configuration's :guilabel:`after waiting` interval (in the
   configuration's :guilabel:`Send to` section).

.. alert:: Number of Healthy Members is below

   Sends an alert when a replica set has fewer than the specified number
   of healthy members. If the replica set has the specified number of
   healthy members or more, MMS triggers no alert.

   A replica set member is healthy if its state, as reported in the
   :manual:`rs.status() </reference/method/rs.status>` output, is either
   :replstate:`PRIMARY` or :replstate:`SECONDARY`. Hidden secondaries
   are not counted.

   As an example, if you have a replica set with one member in the
   :replstate:`PRIMARY` state, two members in the
   :replstate:`SECONDARY` state, one hidden member in the
   :replstate:`SECONDARY`, one :replstate:`ARBITER`, and one member in
   the :replstate:`RECOVERING` state, then the healthy count is 3.

.. alert:: Number of Unhealthy Members is above

   Sends an alert when a replica set has more than the specified number of
   unhealthy members. If the replica set has the specified number or fewer,
   no alert is sent.

   A replica set member is unhealthy if it is unreachable or in recovery
   or rollback.

   Hidden secondaries are not counted.

Agent Alerts
------------

These alert conditions are applicable to Monitoring Agents
and Backup Agents.

.. alert:: Monitoring Agent is down

   Sends an alert if the Monitoring Agent has been down for at least 7
   minutes. Under normal operation, the Monitoring Agent sends a ping to
   MMS roughly once per minute. If MMS does not receive a ping for at
   least 7 minutes, this alert triggers. However, this alert will never
   trigger for a group that has no hosts configured.

   .. important::

      When the Monitoring Agent is down, MMS will trigger no other alerts.
      For example, if a host is down there is no Monitoring Agent to send
      data to MMS that could trigger new alerts.

.. alert:: Backup Agent is down

   Sends an alert if the Backup Agent has been down for at least 15
   minutes. Under normal operation, the Backup Agent periodically sends
   data to MMS. This alert is never triggered for a group that has no
   running backups.

.. alert:: Monitoring Agent is out of date

   Sends an alert when the Monitoring Agent is not running the latest
   version of the software.

Backup Alerts
-------------

These alert conditions are applicable to the MMS Backup service.

.. alert:: Oplog Behind

   Sends an alert if the most recent :term:`oplog` data received by MMS is
   more than 75 minutes old.

.. alert:: Resync Required

   Sends an alert if the replication process for a backup falls too far
   behind the :term:`oplog` to catch up. This occurs when the host
   overwrites oplog entries that backup has not yet replicated. When this
   happens, backup must be fully resynced.

User Alerts
-----------

These alert conditions are applicable to the MMS Users.

.. alert:: Added to Group

   Sends an alert when a new user joins the group.

.. alert:: Removed from Group

   Sends an alert when a user leaves the group.

.. alert:: Changed Roles

   Sends an alert when a user's roles have been changed.
