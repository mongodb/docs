=============================================
Configure Monitoring Agent for Authentication
=============================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

MongoDB 4.0 supports the :manual:`SCRAM </core/security-scram/>`
authentication mechanism with the SHA-256 and SHA-1 hash functions.
``SCRAM-SHA-1`` (`RFC 5802 <https://tools.ietf.org/html/rfc5802>`_) and
``SCRAM-SHA-256`` (`RFC 7677 <https://tools.ietf.org/html/rfc7677>`_)
are IETF standards that define best practice methods for implementation of
challenge-response mechanisms for authenticating users with passwords.

In MongoDB 3.0 to 3.6, MongoDB's default authentication mechanism is
``SCRAM-SHA-1``. Prior to MongoDB 3.0, MongoDB used MongoDB Challenge
and Response (``MONGODB-CR``) as the default. ``MONGODB-CR`` is a
challenge-response mechanism that authenticates users through passwords.

The Monitoring Agent can use ``SCRAM-SHA-1`` or ``SCRAM-SHA-256``
to authenticate to hosts that enforce access control. To authenticate
using ``SCRAM-SHA-1`` or ``SCRAM-SHA-256``, create a user in the
``admin`` database with the appropriate roles in MongoDB.

.. include:: /includes/extracts/note-manage-agent-auth-with-automation-mongodbcr.rst

Procedures
----------

Create MongoDB User for the Agent
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/prerequisites-create-user-for-agent.rst

.. include:: /includes/considerations-agent-access-control.rst

MongoDB 2.6 and Later
`````````````````````

To monitor MongoDB 2.6 instances, create a user in the ``admin``
database with an operation that resembles the following:

.. code-block:: javascript

   use admin
   db.createUser(
      {
        user: "<username>",
        pwd: "<password>",
        roles: [ { role: "clusterMonitor", db: "admin" } ]
      }
   )

See :ref:`Access Control for MongoDB 2.6 <access-control-monitoring-agent-2.6>` for more
information on the required access.

MongoDB 2.4
```````````

To monitor MongoDB 2.4 instances, create a user in the ``admin``
database with an operation that resembles the following:

.. code-block:: javascript

   use admin
   db.addUser( 
      {
        user: "<username>",
        pwd: "<password>",
        roles: [ 
           "clusterAdmin",
           "readAnyDatabase"
        ]
      }
   )

Refer to the :ref:`Access Control for MongoDB 2.4 <access-control-2.4>` reference
to choose which MongoDB roles to provide for the Monitoring Agent.
For example, if you wish to monitoring with database profiling,
you will need to include the :authrole:`dbAdminAnyDatabase` role.

Host Settings
~~~~~~~~~~~~~

.. include:: /includes/fact-access-control-host-settings.rst

