.. _4.2.12-changelog:

4.2.12 Changelog
----------------

Sharding
~~~~~~~~

- :issue:`SERVER-46393` Always check client last operation time when computing operationTime to append to the response
- :issue:`SERVER-50900` Disable PeriodicShardedIndexConsistencyChecker for cursor_valid_after_shard_stepdown.js 
- :issue:`SERVER-52732` Uptime reporter disables autosplit during ShardingTest initialization
- :issue:`SERVER-53444` Make tests that run removeShard in assert.soon to wait for the state to become "completed" not error on ShardNotFound

Replication
~~~~~~~~~~~

- :issue:`SERVER-49187`  Make ReplSetTest .stepUp() robust to election failures.
- :issue:`SERVER-50049` assert.soonNoExcept() should not access TestData.traceExceptions for non-resmoke tests.
- :issue:`SERVER-50416` Change notMasterLegacyUnacknowledgedWrites to notPrimaryLegacyUnacknowledgedWrites in serverStatus
- :issue:`SERVER-50417` Change notMasterUnacknowledgedWrites to notPrimaryUnacknowledgedWrites in serverStatus
- :issue:`SERVER-50869` Background sync may erroneously set applied-through during step-up
- :issue:`SERVER-50901` RollbackTest should wait for secondaries before doing data consistency checks
- :issue:`SERVER-52560` oplog_writes_only_permitted_on_standalone.js must wait for insert to be in stable checkpoint
- :issue:`SERVER-52680` Removed node on startup stuck in STARTUP2 after being re-added into the replica set
- :issue:`SERVER-52744` rollback node's lastApplied > sync source's lastApplied in rollback_after_enabling_majority_reads.js
- :issue:`SERVER-53026` Secondary cannot restart replication
- :issue:`SERVER-53345` Excuse arbiter_new_hostname.js from multiversion tests

Query
~~~~~

- :issue:`SERVER-32960` $mod has inconsistent rounding/truncation behavior
- :issue:`SERVER-40361` Reduce memory footprint of plan cache entries
- :issue:`SERVER-50769` server restarted after exprï¼š{"expr":"_currentApplyOps.getArrayLength() > 0","file":"src/mongo/db/pipeline/document_source_change_stream_transform.cpp","line":535}}

Aggregation
~~~~~~~~~~~

- :issue:`SERVER-34741` Move $match in front of $group if condition is on group key
- :issue:`SERVER-40090` DISTINCT_SCAN in agg is only used when certain format of _id is specified
- :issue:`SERVER-51886` $lookup + $merge pipeline may fail to resolve views correctly when collection names collide

Storage
~~~~~~~

- :issue:`SERVER-47812` Secondaries persist wildcard multikeypaths out of order
- :issue:`SERVER-48471` Hashed indexes may be incorrectly marked multikey and be ineligible as a shard key
- :issue:`SERVER-51858` Investigate queryable issue on 4.0.20
- :issue:`SERVER-52950` recoverOplogAsStandalone mode must not start oplog truncater thread
- :issue:`SERVER-53703` [4.2] Opening a transaction at the all durable timestamp can go backwards

Build and Packaging
~~~~~~~~~~~~~~~~~~~

:issue:`SERVER-52891` Run PPC builds less frequently

Internals
~~~~~~~~~

- :issue:`SERVER-41836` Log thread ID as part of error in FSM tests
- :issue:`SERVER-43739` SNI name is not set on OSX if allowInvalidHostnames is enabled
- :issue:`SERVER-44375` fix merge_with_drop_shard.js when the curop command fails due to ShardNotFound
- :issue:`SERVER-47863` Initial Sync Progress Metrics
- :issue:`SERVER-48742` Log whenever profiler settings are changed via setProfilingLevel
- :issue:`SERVER-50267` Set output limit for 'rawMongoProgramOutput()'
- :issue:`SERVER-50445` Return the value as double when NumberLong subtraction overflows in ExpressionSubtract
- :issue:`SERVER-51526` Hybrid index builds can miss writes and crash in the event of a well-timed WriteConflictException
- :issue:`SERVER-51607` Upgrade Twisted dependency to at least twisted-19.7.0
- :issue:`SERVER-52618` Sparse hash index should not be used for equality to null match
- :issue:`SERVER-52646` Validate and possibly fix edge cases in regex rewrite rules for userToDNMapping
- :issue:`SERVER-52654` new signing keys not generated by the monitoring-keys-for-HMAC thread
- :issue:`SERVER-52806` deb install files assume systemd
- :issue:`SERVER-52879` Periodic operation latency spikes every 5 minutes due to closing idle cached WT sessions
- :issue:`SERVER-52919` Wire compression not enabled for initial sync
- :issue:`SERVER-52929` Correctly handle compound indexes with 32 keys
- :issue:`SERVER-52969` Disable Powercyle on non-master branches
- :issue:`SERVER-52975` Fix use of 'onRollback' callback for collection validator options in 'collection_impl.cpp'
- :issue:`SERVER-53233` Fix change_streams_update_lookup_shard_metadata_missing.js [4.2, 4.0]
- :issue:`SERVER-53234` jstests/core/profile2.js fails when background operations are run against test database
- :issue:`WT-6835` Add API to allow consolidating incremental backup info
- :issue:`WT-6839` Add API to query existing incremental backup IDs
- :issue:`WT-6882` Files created during incremental backup should be copied in full
- :issue:`WT-6922` Add random consolidate testing to incr_backup

