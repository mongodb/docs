=====================================
MMS Agent Authentication Requirements
=====================================

.. default-domain:: mongodb

If your MongoDB deployment requires authentication, |mms| requires
additional privileges to collect complete data from MongoDB 2.4
instances. If authentication is not enabled on your MongoDB instance,
this requirement does not apply.

The MMS Monitoring and MMS Backup agents authenticate to your MongoDB
instances using the username and password that you provide in the UI.
This document describes the requirements for those users.

Define all user accounts on the ``admin`` database.

.. only:: saas

   .. include:: /includes/fact-auth-backup-requirements.rst

MMS Backup
~~~~~~~~~~

MMS backup requires authenticated users to have these roles:

- :authrole:`clusterAdmin`
- :authrole:`readAnyDatabase`
- :authrole:`userAdminAnyDatabase`

And the following ``otherDBRoles``:

- :authrole:`readWrite` role on the ``local`` database
- :authrole:`readWrite` role on the ``admin`` database

To create a user account on the admin database for a hosted MongoDB deployment,
use an operation that resembles the following example:

.. code-block:: javascript

   use admin
   db.addUser( { user: "<username>",
                 pwd: "<password>",
                 roles: [ "clusterAdmin",
                          "readAnyDatabase",
                          "userAdminAnyDatabase"
                        ],
                  otherDBRoles: { local: ['readWrite'], 
                                  admin: ['readWrite']
                                 }
                 } )

MMS Monitoring
~~~~~~~~~~~~~~

MMS monitoring requires authenticated users to have these roles:

- :authrole:`clusterAdmin`
- :authrole:`readAnyDatabase`

To create a user account on the admin database for MMS monitoring, use an
operation that resembles the following example:

.. code-block:: javascript

   use admin
   db.addUser( { user: "<username>",
                 pwd: "<password>",
                 roles: [ "clusterAdmin",
                          "readAnyDatabase"
                        ]
               } )

Because user accounts created for basic monitoring do not require the 
:authrole:`dbAdminAnyDatabase`
role, the :program:`mongod` log file may report the following messages at the
default logging level:

.. code-block:: none

   command denied: { profile: -1 }

You can safely ignore this message if you do not want MMS to collect profile
data. If you want to collect profile data, configure MMS monitoring with
database profiling as described below.

MMS Monitoring with Database Profiling
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

:ref:`Profiling <database-profiler>` captures in-progress read and write
operations, cursor operations, and database command information about the
database.

MMS monitoring with database profiling requires authenticated users to have
these roles:

- :authrole:`clusterAdmin`
- :authrole:`readAnyDatabase`
- :authrole:`dbAdminAnyDatabase`

To create a user account on the admin database for MMS monitoring with database
profiling, use an operation that resembles the following example:

.. code-block:: javascript

   use admin
   db.addUser( { user: "<username>",
                 pwd: "<password>",
                 roles: [ "clusterAdmin",
                          "readAnyDatabase",
                          "dbAdminAnyDatabase"
                        ]
               } )

MMS Monitoring *without* ``dbStats``
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Monitoring without :dbcommand:`dbStats` will generate monitoring statistics
without database storage, records, indexes, and other statistics.

MMS monitoring *without* database profiling requires authenticated users to
have the :authrole:`clusterAdmin` role.

To create a user account on the admin database for MMS monitoring *without*
``dbstats``, use an operation that resembles the following example:

.. code-block:: javascript

   use admin
   db.addUser( { user: "<username>",
                 pwd: "<password>",
                 roles: [ "clusterAdmin"
                        ]
               } )
