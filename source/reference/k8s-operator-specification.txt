.. _k8s-specification:

=======================================
MongoDB Database Resource Specification
=======================================

.. include:: /includes/styles/corrections.rst

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecols

.. include:: /includes/admonitions/note-k8s-supported-in-om4.rst

The :gh:`MongoDB Enterprise Kubernetes Operator </mongodb/mongodb-enterprise-kubernetes>`
creates |k8s| |k8s-statefulsets| from specification files that you
wrote.

MongoDB resources are created in Kubernetes as
:k8sdocs:`custom resources </concepts/extend-kubernetes/api-extension/custom-resources/>`.
After you create or update a |k8s-mdbrsc| specification, you direct
|k8s-op-full| to apply this specification to your |k8s| environment.
|k8s-op-short| creates the defined |k8s-statefulsets|, services and
other Kubernetes resources. After the Operator finishes creating those
objects, it updates the |onprem-link| deployment configuration to
reflect changes.

.. list-table::
   :widths: 20 40 40
   :header-rows: 1
   :stub-columns: 1

   * - Deployment Type
     - StatefulSets
     - Size of StatefulSet

   * - Standalone
     - 1
     - 1 |k8s-pod|

   * - Replica Set
     - 1
     - 1 |k8s-pod| per member

   * - Sharded Cluster
     - <numberOfShards> + 2
     - 1 |k8s-pod| per |mongos|, shard, or config server member

Each |k8s-mdbrsc| uses an object specification in |yaml| to define the
characteristics and settings of the MongoDB object: standalone,
:term:`replica set`, and :term:`sharded cluster`.

Common Resource Settings
------------------------

Every resource type must use the following settings:

Required
~~~~~~~~

.. include:: /includes/option/setting-k8sSaConf-apiVersion.rst
.. include:: /includes/option/setting-k8sSaConf-kind.rst
.. include:: /includes/option/setting-k8sSaConf-metadata.name.rst
.. include:: /includes/option/setting-k8sSaConf-metadata.namespace.rst
.. include:: /includes/option/setting-k8sSaConf-spec.credentials.rst
.. include:: /includes/option/setting-k8sSaConf-spec.persistent.rst
.. include:: /includes/option/setting-k8sSaConf-spec.type.rst
.. include:: /includes/option/setting-k8sSaConf-spec.version.rst

Conditional
~~~~~~~~~~~

Every resource must use *one* of the following settings:

.. include:: /includes/option/setting-k8sSaConf-spec.opsManager.configMapRef.name.rst

.. include:: /includes/option/setting-k8sSaConf-spec.cloudManager.configMapRef.name.rst

Optional
~~~~~~~~

Every resource type may use the following settings:

.. include:: /includes/option/setting-k8sSaConf-spec.featureCompatibilityVersion.rst
.. include:: /includes/option/setting-k8sSaConf-spec.clusterDomain.rst
.. include:: /includes/option/setting-k8sSaConf-spec.clusterName.rst
.. include:: /includes/option/setting-k8sSaConf-spec.service.rst
.. include:: /includes/option/setting-k8sSaConf-spec.logLevel.rst
.. include:: /includes/option/setting-k8sSaConf-spec.security.authentication.ignoreUnknownUsers.rst

Deployment-Specific Resource Settings
-------------------------------------

Other settings you can and must use in a |k8s-mdbrsc| specification
depend upon which MongoDB deployment item you want to create:

- :ref:`standalone-settings`

- :ref:`replica-set-settings`

- :ref:`sharded-cluster-settings`

.. _standalone-settings:

Standalone Settings
~~~~~~~~~~~~~~~~~~~

.. include:: /includes/option/setting-k8sSaConf-spec.exposedExternally.rst
.. include:: /includes/option/setting-k8sSaConf-spec.podSpec.cpu.rst
.. include:: /includes/option/setting-k8sSaConf-spec.podSpec.cpuRequests.rst
.. include:: /includes/option/setting-k8sSaConf-spec.podSpec.memory.rst
.. include:: /includes/option/setting-k8sSaConf-spec.podSpec.memoryRequests.rst
.. include:: /includes/option/setting-k8sSaConf-spec.podSpec.nodeAffinity.rst
.. include:: /includes/option/setting-k8sSaConf-spec.podSpec.persistence.single.rst
.. include:: /includes/option/setting-k8sSaConf-spec.podSpec.persistence.multiple.data.rst
.. include:: /includes/option/setting-k8sSaConf-spec.podSpec.persistence.multiple.journal.rst
.. include:: /includes/option/setting-k8sSaConf-spec.podSpec.persistence.multiple.logs.rst
.. include:: /includes/option/setting-k8sSaConf-spec.podSpec.podAffinity.rst
.. include:: /includes/option/setting-k8sSaConf-spec.podSpec.podTemplate.rst
.. include:: /includes/option/setting-k8sSaConf-spec.podSpec.podTemplate.metadata.rst
.. include:: /includes/option/setting-k8sSaConf-spec.podSpec.podTemplate.spec.rst

.. _replica-set-settings:

Replica Set Settings
~~~~~~~~~~~~~~~~~~~~

.. note::

   All of the :ref:`standalone-settings` also apply to replica set
   resources.

The following settings only apply to replica set resource types:

.. include:: /includes/option/setting-k8sRsConf-spec.members.rst
.. include:: /includes/option/setting-k8sRsConf-spec.podSpec.podAntiAffinityTopologyKey.rst
.. include:: /includes/option/setting-k8sRsConf-spec.connectivity.replicaSetHorizons.rst

.. _sharded-cluster-settings:

Sharded Cluster Settings
~~~~~~~~~~~~~~~~~~~~~~~~

The following settings only apply to sharded cluster resource types:

.. include:: /includes/option/setting-k8sSaConf-spec.exposedExternally.rst
.. include:: /includes/option/setting-k8sScConf-spec.configServerCount.rst
.. include:: /includes/option/setting-k8sScConf-spec.configSrvPodSpec.cpu.rst
.. include:: /includes/option/setting-k8sScConf-spec.configSrvPodSpec.cpuRequests.rst
.. include:: /includes/option/setting-k8sScConf-spec.configSrvPodSpec.memory.rst
.. include:: /includes/option/setting-k8sScConf-spec.configSrvPodSpec.memoryRequests.rst
.. include:: /includes/option/setting-k8sScConf-spec.configSrvPodSpec.persistence.single.rst
.. include:: /includes/option/setting-k8sScConf-spec.configSrvPodSpec.persistence.multiple.data.rst
.. include:: /includes/option/setting-k8sScConf-spec.configSrvPodSpec.persistence.multiple.journal.rst
.. include:: /includes/option/setting-k8sScConf-spec.configSrvPodSpec.persistence.multiple.logs.rst
.. include:: /includes/option/setting-k8sScConf-spec.configSrvPodSpec.nodeAffinity.rst
.. include:: /includes/option/setting-k8sScConf-spec.configSrvPodSpec.podAffinity.rst
.. include:: /includes/option/setting-k8sScConf-spec.configSrvPodSpec.podAntiAffinityTopologyKey.rst
.. include:: /includes/option/setting-k8sScConf-spec.configSrvPodSpec.podTemplate.rst
.. include:: /includes/option/setting-k8sScConf-spec.configSrvPodSpec.podTemplate.metadata.rst
.. include:: /includes/option/setting-k8sScConf-spec.configSrvPodSpec.podTemplate.spec.rst
.. include:: /includes/option/setting-k8sScConf-spec.mongodsPerShardCount.rst
.. include:: /includes/option/setting-k8sScConf-spec.mongosCount.rst
.. include:: /includes/option/setting-k8sScConf-spec.mongosPodSpec.cpu.rst
.. include:: /includes/option/setting-k8sScConf-spec.mongosPodSpec.cpuRequests.rst
.. include:: /includes/option/setting-k8sScConf-spec.mongosPodSpec.memory.rst
.. include:: /includes/option/setting-k8sScConf-spec.mongosPodSpec.memoryRequests.rst
.. include:: /includes/option/setting-k8sScConf-spec.mongosPodSpec.nodeAffinity.rst
.. include:: /includes/option/setting-k8sScConf-spec.mongosPodSpec.podAffinity.rst
.. include:: /includes/option/setting-k8sScConf-spec.mongosPodSpec.podAntiAffinityTopologyKey.rst
.. include:: /includes/option/setting-k8sScConf-spec.mongosPodSpec.podTemplate.rst
.. include:: /includes/option/setting-k8sScConf-spec.mongosPodSpec.podTemplate.metadata.rst
.. include:: /includes/option/setting-k8sScConf-spec.mongosPodSpec.podTemplate.spec.rst
.. include:: /includes/option/setting-k8sScConf-spec.shardCount.rst
.. include:: /includes/option/setting-k8sScConf-spec.shardPodSpec.cpu.rst
.. include:: /includes/option/setting-k8sScConf-spec.shardPodSpec.cpuRequests.rst
.. include:: /includes/option/setting-k8sScConf-spec.shardPodSpec.memory.rst
.. include:: /includes/option/setting-k8sScConf-spec.shardPodSpec.memoryRequests.rst
.. include:: /includes/option/setting-k8sScConf-spec.shardPodSpec.nodeAffinity.rst
.. include:: /includes/option/setting-k8sScConf-spec.shardPodSpec.persistence.single.rst
.. include:: /includes/option/setting-k8sScConf-spec.shardPodSpec.persistence.multiple.data.rst
.. include:: /includes/option/setting-k8sScConf-spec.shardPodSpec.persistence.multiple.journal.rst
.. include:: /includes/option/setting-k8sScConf-spec.shardPodSpec.persistence.multiple.logs.rst
.. include:: /includes/option/setting-k8sScConf-spec.shardPodSpec.podAffinity.rst
.. include:: /includes/option/setting-k8sScConf-spec.shardPodSpec.podAntiAffinityTopologyKey.rst
.. include:: /includes/option/setting-k8sScConf-spec.shardPodSpec.podTemplate.rst
.. include:: /includes/option/setting-k8sScConf-spec.shardPodSpec.podTemplate.metadata.rst
.. include:: /includes/option/setting-k8sScConf-spec.shardPodSpec.podTemplate.spec.rst

.. _tls-settings:
.. _security-settings:

Security Settings
-----------------

The following |tls| settings only apply to replica set and sharded
cluster resource types:

.. include:: /includes/option/setting-k8sRsConf-spec.security.tls.enabled.rst
.. include:: /includes/option/setting-k8sRsConf-spec.security.tls.ca.rst
.. include:: /includes/option/setting-k8sRsConf-spec.additionalMongodConfig.net.ssl.mode.rst
.. include:: /includes/option/setting-k8sRsConf-spec.security.authentication.rst
.. include:: /includes/option/setting-k8sRsConf-spec.security.authentication.enabled.rst
.. include:: /includes/option/setting-k8sRsConf-spec.security.authentication.modes.rst
.. include:: /includes/option/setting-k8sRsConf-spec.security.authentication.internalCluster.rst
.. include:: /includes/option/setting-k8sRsConf-spec.security.tls.additionalCertificateDomains.rst

Examples
--------

.. tabs::

   tabs:
     - id: standalone
       name: Standalone Pod
       content: |

         The following example shows a resource specification for a
         standlone deployment with every setting provided:

         .. literalinclude:: /reference/k8s/standalonepodspec.yaml
            :language: yaml

     - id: replicaset
       name: Replica Set Pod
       content: |

         The following example shows a resource specification for a
         :term:`replica set` with every setting provided:

         .. literalinclude:: /reference/k8s/replicasetpodspec.yaml
            :language: yaml

     - id: shardedcluster
       name: Sharded Cluster Pod
       content: |

         The following example shows a resource specification for a
         :term:`sharded cluster` with every setting provided:

         .. literalinclude:: /reference/k8s/shardedclusterpodspec.yaml
            :language: yaml
