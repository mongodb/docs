========================
Deploy a Sharded Cluster
========================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. include:: /includes/styles/corrections.rst

.. include:: /includes/note-k8s-supported-in-om4.rst

:term:`Sharded clusters <sharded cluster>` provide horizontal scaling 
for large data sets and enable high throughput operations by 
distributing the data set across a group of servers. 

To learn more about sharding, see 
:manual:`Sharding Introduction </core/sharding-introduction>` in the 
MongoDB manual.

Use this procedure to deploy a new sharded cluster that |mms| manages. 
Later, you can use |mms| to add shards and perform other maintenance 
operations on the cluster.

Prerequisites
-------------

.. |deployment| replace:: sharded cluster

.. include:: /includes/prereqs-deploy-resource.rst

Considerations
--------------

Use unique names for the new cluster and its shards.

.. include:: /includes/important-unique-names-deployment-items.rst

Do Not Deploy Monitoring Agents inside and outside |k8s|
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Do not mix MongoDB deployments outside |k8s| with ones insider |k8s|
in the same Project.

Due to |k8s| network translation, a Monitoring Agent outside |k8s|
cannot monitor MongoDB instnaces inside |k8s|. For this reason, k8s
and non-k8s deployments in the same Project is not supported. Use
separate projects.


Procedure
---------

The procedure for deploying a sharded cluster depends on whether you
require the deployment to run with |tls| enabled for intra-cluster
communication and clients connecting to the database:

.. tabs::

   tabs:
     - id: tls-disabled
       name: Without TLS
       content: |
         .. include:: /includes/steps/deploy-k8s-sharded-cluster.rst

     - id: tls-enabled
       name: With TLS
       content: |
         The |k8s-op-full| can use |tls| certificates to encrypt
         communication between:

         - MongoDB hosts in a replica set or sharded cluster configuration
         - Clients (|mongo| shell, drivers, |compass|, and others)
           and the MongoDB deployment

         The following procedure walks you through deploying a replica
         set with |tls| enabled:

         .. include:: /includes/steps/deploy-k8s-sharded-cluster-tls.rst
