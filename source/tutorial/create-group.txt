=============
Manage Groups
=============

.. default-domain:: mongodb

.. index:: groups

Overview
--------

Groups associate |mms| users with MongoDB in the |mms| application. A group provides
access to a distinct |mms| environment or deployment. Each group has one
Monitoring Agent and Backup Agent.

You create the first |mms| group when you register the first |mms| user. Create
additional groups to manage segregated systems or environments.
For example, your deployment might have two or more environments separated by
firewalls. In this case, you would need two or more separate |mms| groups.

|mms| API and shared secret keys are unique to each group. Each group requires its
own Monitoring Agent with the appropriate API and shared secret keys. Within
each group, the agent needs to be able to connect to all hosts it monitors in
the group.

You can manage the users that have access to your |mms| :doc:`groups
</tutorial/create-group>` and assign :doc:`roles </reference/user-roles>` to
users to provide controlled access to |mms|.

Working with Multiple Environments
----------------------------------

If you have multiple MongoDB systems in distinct environments and cannot
monitor all systems with a single agent, you will need to add a new group.
Having a second group makes it possible to run two agents.

You may also use a second group and agent to monitor a different set of
MongoDB instances in the same environment if you want to segregate the hosts
within the |mms| console. A user can only view data from the hosts monitored in
a single group at once.

After adding a second group, the |mms| interface will have a drop-down list that
will allow you to change groups. Selecting a new group will refresh the
current page with the data available from the servers in this group.

Procedures
----------

.. _create-group:

Create a Group
++++++++++++++

When you create a new group, you are automatically added as the first user to
the group. The group is automatically assigned a set of :doc:`alert
configurations </tutorial/manage-alert-configurations>`.

.. include:: /includes/steps/add-group.rst

Remove a Group
++++++++++++++

.. include:: /includes/fact-remove-group.rst

.. _manage-group-settings:

Manage Group Settings
+++++++++++++++++++++

.. include:: /includes/steps/manage-group-settings.rst

.. _group-settings-page:

Group Settings
++++++++++++++

The following settings in the :guilabel:`Administration` tab's
:guilabel:`Group Settings` page apply to all users in the group:

- :guilabel:`Group Time Zone`: Sets your group's time zone.

- :guilabel:`Collect Logs For All Hosts`: Activates or deactivates the
  collection of log data for all hosts. This overwrites the statuses
  set on the individual hosts.

- :guilabel:`Collect Profiling Information for All Hosts`: Activates or deactivates the
  collection of profiling information for all hosts. |mms| Monitoring can collect
  data from MongoDBâ€™s profiler to provide statistics about performance and
  database operations. Ensure exposing profile data to |mms| Monitoring is
  consistent with your information security practices. Also be aware the
  profiler can consume resources which may adversely affect MongoDB performance.

- :guilabel:`Collect Database Specific Statistics`: Allows you to enable or disable the
  collection of database statistics. For more information, see ":ref:`How does
  |mms| gather database statistics? <db-stats-warning>`".

- :guilabel:`Enable Public API`: Allows you to :doc:`use the Public API
  </tutorial/enable-public-api>` with the group.

- :guilabel:`Reset Duplicates`: Allows you to reset and remove all detected duplicate
  hosts. This is useful if your server environment has drastically changed and
  you believe a host is incorrectly marked as a duplicate.

- :guilabel:`Preferred Hostnames`: Allows you to specify the hostname to use for
  servers with multiple aliases. This prevents servers from appearing multiple
  times under different names. By default, the Monitoring Agent tries to connect
  by resolving hostnames. If the agent cannot connect by resolving a hostname,
  you can force the Monitoring Agent to prefer an IP address over its
  corresponding hostname for a specific IP address. To override this
  default behavior, set an IP address as a preferred hostname. If your IP
  addresses have a common prefix, create a preferred hostname with the
  :guilabel:`ends-with` button or click the :guilabel:`regexp` button to use a
  regular expression.

- :guilabel:`Public Key for SCP Restores`: If you use |mms| :doc:`Backup
  </tutorial/nav/backup-use>`, this setting allows you to generate a
  public key for SCP backup restoration. If you restore a snapshot through
  SCP, |mms| uses the key to transmit the snapshot. For more information on
  restores, see :doc:`/tutorial/nav/backup-use-restore`, and :ref:`how to
  validate an SCP restore <backup-faq-scp-validation>` and other SCP FAQs.

- :guilabel:`PagerDuty Service Key`: Adds a service key for a
  `PagerDuty <http://www.pagerduty.com/?utm_source=mongodb&utm_medium=docs&utm_campaign=partner>`_
  account. This is the default key used if you :ref:`create an alert
  configuration <create-new-alert-configuration>` that uses PageDuty.

- :guilabel:`HipChat Settings`: Adds a room and API token for a HipChat
  account. These are the default settings used if you :ref:`create an
  alert configuration <create-new-alert-configuration>` that uses HipChat.

.. _admin-only-group-settings:

Admin Only Group Settings
+++++++++++++++++++++++++

.. versionadded 1.5.4, 1.6.1

The following group settings in the :guilabel:`Admin Only` section of the
:guilabel:`Administration` tab could, in certain situations, affect more
than the group. For example, setting logging to a high verbosity would
cause system logs to roll over faster. Only users with the
:ref:`global-owner-role` role can edit these settings:

- :guilabel:`Mongos Deactivation Threshold`: Change the amount of time
  before |mms| stops monitoring an unreachable :program:`mongos`. By
  default, the Monitoring Agent stops monitoring an unreachable
  :program:`mongos` after 24 hours. Set this to the amount of time in
  hours to wait before deactivation.

- :guilabel:`Monitoring Agent Log Level`: Change the verbosity of the
  Monitoring Agent log.

- :guilabel:`Automation Agent Log Level`: Change the verbosity of the
  Automation Agent log.
