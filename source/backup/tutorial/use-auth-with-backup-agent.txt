.. _use-auth-with-backup-agent:

==================================================
Use MongoDB Authentication with the |backup| Agent
==================================================

Overview
--------

The |backup| agent supports MongoDB deployments that require authentication.
The agent receives configurations from replica sets, sharded clusters, and
hosts, as well as credentials from the MMS :guilabel:`Backup` tab for replica
sets and sharded clusters.

If you use |backup| with a MongoDB instance with authentication enabled, there
are additional steps you will need to take before you can use |backup|. The
monitoring agent also will need to be updated to monitor databases using
authentication.

Prerequisites
-------------

You will need to create a new user for the backup agent then install the backup
agent.

Use the :program:`mongo` shell to connect to the :program:`mongod` or
:program:`mongos` instance you will be backing up. Create a new user
for the |backup| Agent using the appropriate command shown in the
:doc:`Authentication Requirements </management/permissions/>` page. Then
restart your replica set and sharded cluster with authentication enabled, as
appropriate.

You can now install the Backup agent, as described in the
:doc:`/backup/tutorial/install-and-start-backup-agent` page. You will need to
provide the username and password during the |backup| setup process.

Procedure
---------

For each replica set using authentication:

.. include:: /includes/steps/mms-update-replica-set-auth.rst

Update MMS with Sharded Cluster Username and Password
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

For each sharded cluster using authentication:

.. include:: /includes/steps/mms-update-sharded-cluster-auth.rst

Update Credentials Used by the Monitoring Agent
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Create a new user for the |monitoring| Agent using the appropriate command
shown in the :doc:`Authentication Requirements </management/permissions/>`
page.
