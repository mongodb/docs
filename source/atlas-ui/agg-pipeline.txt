.. _atlas-ui-agg-pipeline:

=========================
Run Aggregation Pipelines
=========================

.. meta::
   :description: Build and export aggregation pipelines using the Atlas UI, with options to configure settings and preview results.

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

You can use the {+atlas-ui+} to process your data by building
:manual:`aggregation pipelines </core/aggregation-pipeline/>`.
Aggregation pipelines transform your documents into aggregated results
based on selected
:manual:`pipeline stages </reference/operator/aggregation-pipeline/>`.

The |service| aggregation pipeline builder is primarily designed for
building pipelines, rather than executing them. The pipeline builder
provides an easy way to :ref:`export your pipeline <export-pipeline>`
to execute in a :driver:`driver </>`.

Required Roles
--------------

To create and execute aggregation pipelines in the
{+atlas-ui+}, you must have the 
:authrole:`Project Data Access Read Only` role or higher.

To utilize the :pipeline:`$out` stage in your pipeline, you must
have the :authrole:`Project Data Access Read/Write` role.

Access the Aggregation Pipeline Builder
---------------------------------------

.. include:: /includes/steps/atlas-ui-pipeline-open.rst
 
.. _agg-pipeline-create:

Create an Aggregation Pipeline
------------------------------

.. Attention writers: If you make changes to the following procedure
.. please check the related procedures in the following Server docs 
.. page(s) to see if they require changes as well: 
.. https://www.mongodb.com/docs/manual/core/materialized-views/#create-a-materialized-view-in-the-mongodb-atlas-ui
.. www.mongodb.com/docs/manual/tutorial/update-documents-with-aggregation-pipeline/
.. www.mongodb.com/docs/manual/geospatial-queries/

.. include:: /includes/steps/atlas-ui-pipeline-create.rst

Collation
~~~~~~~~~

Use :manual:`collation </reference/collation/>` to specify
language-specific rules for string comparison, such as rules for lettercase and accent marks.

To specify a collation document, click :guilabel:`Collation` at
the top of the pipeline builder.

A collation document has the following fields:

.. code-block:: javascript

   {
      locale: <string>,
      caseLevel: <boolean>,
      caseFirst: <string>,
      strength: <int>,
      numericOrdering: <boolean>,
      alternate: <string>,
      maxVariable: <string>,
      backwards: <boolean>
   }

The ``locale`` field is mandatory; all other collation fields are
optional. For descriptions of the fields, see
:manual:`Collation Document
</reference/collation/#collation-document-fields>`.

Import an Aggregation Pipeline from Text
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

You can import aggregation pipelines from plain text into the
pipeline builder to easily modify and verify your pipelines.

To import a pipeline from plain text:

.. include:: /includes/steps/atlas-ui-pipeline-import.rst

Reset Your Pipeline
~~~~~~~~~~~~~~~~~~~

To return your pipeline to the initial blank state, click the plus icon
at the top of the pipeline builder.

.. _export-pipeline:

Export an Aggregation Pipeline to Driver Language
-------------------------------------------------

You can use the aggregation pipeline builder to export your finished
pipeline to one of the supported :driver:`driver languages </>`; Java,
Node, C#, and Python 3. Use this feature to format and export pipelines
for use in your applications.

To export your aggregation pipeline:

.. include:: /includes/steps/atlas-ui-pipeline-export.rst

.. _pipeline-settings:

Configure Aggregation Pipeline Settings
---------------------------------------

You can configure aggregation pipeline settings in the {+atlas-ui+}.

Limitations
~~~~~~~~~~~

|service| limits the number of input documents for previews of the
following stages to 100,000:
     
- :pipeline:`$group`
- :pipeline:`$bucket`
- :pipeline:`$bucketAuto`
     
This limit allows the preview to run faster. |service| doesn't
apply a limit when the pipeline runs.

You can't change the limit for preview input documents in the
{+atlas-ui+}. To change the limit for input documents with
:compass:`Compass </>`, see 
:compass:`Aggregation Pipeline Builder Settings
</agg-pipeline-builder/aggregation-pipeline-builder-settings>`.

Modify Aggregation Pipeline Settings
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

To modify the aggregation pipeline builder settings:

.. include:: /includes/steps/atlas-ui-pipeline-settings.rst

