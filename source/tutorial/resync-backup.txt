===============
Resync a Backup
===============

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

Overview
--------

When a backup becomes out of sync with the MongoDB deployment, |mms|
produces a :alert:`Resync Required <Resync-Required>` alert. If you
receive this alert, you must resync the backup for the specified
MongoDB instance. This alert can be triggered in one of three
scenarios:

The Oplog has rolled over
  This is the most common case for the 
  :alert:`Resync Required <Resync-Required>` alert. It occurs whenever
  the Backup Agent’s :term:`tailing cursor <tailable cursor>`
  cannot keep up with the deployment's :term:`oplog`. This is similar 
  to when a :term:`secondary` falls too far behind the primary in a 
  replica set. Without a resync, the backups will not catch up.

Unsafe applyOps
  This occurs when a document that Backup does not have a copy of is
  indicated.

Data corruption or other illegal instruction
  This typically causes replication, and therefore the backup job, to
  break. When the daemon sees the broken job, it requests a resync.

During the resync, data is read from a secondary in each replica set
and |mms| does not produce any new snapshots.

.. note::
   For production deployments, you should resync all backups annually.

.. important::
   |mms| does not attempt to automatically recover from conditions that
   caused the :alert:`Resync Required <Resync-Required>` alert. This
   alert means there is not enough data to complete a restore. There is
   no way to automatically recover from not having enough data from the
   snapshots and the oplog. Resyncing the backup is the best option.

Considerations
--------------

To avoid the need for resyncs, ensure the Backup oplog does not fall
behind the deployment’s oplog. This requires that:

- Adequate machine resources are provisioned for the agent.

- You restart the |mms| agents in a timely manner following maintenance
  or other downtime.

To provide a buffer for maintenance and for occasional activity bursts,
ensure that the oplog on the :term:`primary` is large enough to contain
at least 24 hours of activity. 

.. seealso::
   For more information on the Backup oplog, see the :ref:`faq-backup`.

Procedure
---------

.. include:: /includes/steps/resync.rst
