=============
Resync Backup
=============

.. default-domain:: mongodb

Overview
--------

If you receive a ``Backup requires resync`` alert, you must resync the
backup for the specified MongoDB instance. It is also recommended that you
resync all backups annually for production deployments. The ``Backup
requires resync`` alert occurs in the case of three different scenarios:

- **The Oplog has rolled over.** This is by far the most common case for
  the ``Backup requires resync`` alert and occurs whenever the Backup
  Agent’s :term:`tailing cursor <tailable cursor>` cannot keep up with
  your deployment’s :term:`oplog`. This is similar to when a
  :term:`secondary` falls too far behind the primary in a replica set.
  Without a resync, the Backups will not catch up.

- **Unsafe applyOps**. This can occur when a document that backup does not
  have a copy of is indicated.

- **Data corruption or other illegal instruction.** This will typically
  cause replication, and therefore the backup job, to break. When the
  daemon sees that the job is broken, it will request a resync.

During the resync, data is read from a secondary in each replica set and
no new snapshots are generated.

Considerations
--------------

To prevent resyncs, ensure the Backup oplog does not fall behind the
deployment’s oplog. This requires that:

- adequate machine resources are provisioned for the agent, and that

- if the |mms| agents are down for maintenance or other reasons, you
  always restart them in a timely manner.

To provide a buffer for maintenance and for occasional activity bursts,
ensure that the oplog on the :term:`primary` is large enough to contain at
least 24 hours of activity. For more information on the Backup oplog, see
the :ref:`faq-backup`.

Procedures
----------

Use the appropriate procedure below for your deployment type, sharded cluster
or replica set.

Resync a Sharded Cluster
++++++++++++++++++++++++

.. include:: /includes/steps/resync-shard.rst

Resync a Replica Set
++++++++++++++++++++

.. include:: /includes/steps/resync-replica-set.rst
