=====================================
Add Monitored Processes to Automation
=====================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

Overview
--------

|mms| Automation lets you deploy, reconfigure and upgrade your MongoDB
databases directly from the |mms| console.

If |mms| is already monitoring your MongoDB processes, you can add them
to Automation.

Automation relies on the Automation Agent, which you install on each
server that hosts a process to be added to automated management. The
Automation Agents regularly poll |mms| to determine goal configuration
and deploy changes as needed.

Considerations
--------------

Automation supports most but not all available MongoDB options. See
:doc:`/reference/cluster-configuration-process-options` for supported
MongoDB deployment options.

When adding a MongoDB deployment requiring authentication, you have the
option of importing that process's users and roles. During import,
|mms| prompts you to resolve any conflicts that may occur between the
imported users and roles and the managed users and roles.

Automation and Updated Security Settings Upon Import
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/fact-imported-users-to-automation.rst

Prerequisites
-------------

|mms| is Monitoring the Processes
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

|mms| must be currently monitoring the MongoDB processes, and the
Monitoring Agent must be running. The processes must appear on the
|mms| :guilabel:`Deployment` page.

.. seealso::
   :doc:`/tutorial/add-existing-mongodb-processes` to add your MongoDB
   deployment to both monitoring and automation if
   |mms| does not currently monitor your deployment.

The Automation Agent must be:

- Installed only on 64-bit architectures.

- Granted permission to stop the MongoDB processes. The Automation
  Agent restarts the processes using the agent's own set of MongoDB
  binaries. If you had installed MongoDB with a package manager, use
  the same package manager to install the Automation Agent. This gives
  the agent the same owner as MongoDB.

- Granted ``Read`` and ``Write`` permissions on the MongoDB data
  directories and log directories.

MongoDB Process User and Group IDs Must Match the Automation Agent
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The user ID (UID) and group ID (GID) of the MongoDB process to be
automated must match that of the Automation Agent. If the MongoDB
processes to be automated are not running as the same user and group,
the Agent cannot manage those processes.

.. example::
   If your Automation Agent runs as the ``mongod`` user in the
   ``mongod`` group, the MongoDB process must also run as the
   ``mongod`` user in the ``mongod`` group.

.. note::
   On Microsoft Windows systems, the Automation Agent, and therefore
   the ``mongod`` or ``mongos`` services it manages, run as Windows
   services as the ``SYSTEM`` user. The existing MongoDB process should
   run as either ``SYSTEM`` or ``Administrator`` to add it to
   automation.

.. include:: /includes/prerequisites-automation-agent-servers.rst

Automation User for Authentication
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/prerequisite-for-adding-existing-deployment-to-automation.rst

Procedure
---------

Add Monitored Processes to Automation
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/steps/add-monitored-deployment-to-automation.rst

