=======================================
Modify Cloud Provider Snapshot Schedule
=======================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

.. include:: /includes/fact-projects-groups-synonyms.rst

.. include:: /includes/api-requirements.rst

.. include:: /includes/fact-api-whitelist-required.rst

.. include:: /includes/api-base-url.rst

Syntax
------

.. code-block:: none

   PATCH /groups/{GROUP-ID}/clusters/{CLUSTER-NAME}/backup/schedule

Request Path Parameters
~~~~~~~~~~~~~~~~~~~~~~~

.. list-table::
   :header-rows: 1
   :widths: 25 75

   * - Path Element
     - Description

   * - ``GROUP-ID``
     - The unique identifier of the :ref:`project <group-id>` for the
       |service| cluster.

   * - ``CLUSTER-NAME``
     - The name of the |service| cluster that contains the snapshot
       you want to retrieve. 

Request Query Parameters
~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/no-query-parameters.rst

Request Body Parameters
~~~~~~~~~~~~~~~~~~~~~~~

Each of the following parameters are optional:

.. list-table::
   :widths: 10 10 80
   :header-rows: 1
   :stub-columns: 1


   * - Name
     - Type
     - Description

   * - ``numOfSnapshotsToRetain``
     - int
     - Number of snapshots |service| retains for the cluster. If the
       provided value is lower than the currently configured
       ``numOfSnapshotsToRetain``, |service| automatically deletes
       the oldest stored snapshots until the total number of snapshots
       matches the configured value.

   * - ``referenceHourOfDay``
     - int
     - :abbr:`UTC (Coordinated Universal Time)`
       Hour of day between ``0`` and ``23`` representing which hour
       of the day that |service| takes a snapshot. The first snapshot
       taken after updating the snapshot schedule occurs within
       24 hours, breaking the default behavior of one snapshot every
       24 hours. All subsequent snapshots occur once every 24 hours at
       the configured point in time.

   * - ``restoreWindowDays``
     - int
     - Must be a number greater than ``0``. Specifies a restore window
       in days for the cloud provider backup to maintain.

   * - ``referenceMinuteOfHour``
     - int
     - :abbr:`UTC (Coordinated Universal Time)`
       Minute of day between ``0`` and ``59`` representing which minute
       of the ``referenceHourOfDay`` that |service| takes the snapshot.
       The first snapshot taken after updating the snapshot schedule 
       occurs within 24 hours, breaking the default behavior of one 
       snapshot every 24 hours. All subsequent snapshots occur once 
       every 24 hours at the configured point in time.

Response
--------

.. include:: /includes/list-table-cloud-provider-snapshot-schedule-response.rst

Example Request
---------------

.. code-block:: sh

   curl --user "{PUBLIC-KEY}:{PRIVATE-KEY}" --digest --include \
     --header "Accept: application/json" \
     --header "Content-Type: application/json" \
     --request PATCH "https://cloud.mongodb.com/api/atlas/v1.0/groups/5b6212af90dc76637950a2c6/clusters/MyCluster/backup/schedule" \
     --data '
       {
         "numOfSnapshotsToRetain" : 5
         "referenceHourOfDay" : 18
         "referenceMinuteOfDay" : 30
       }
     '

Example Response
----------------

.. code-block:: json

  {
      "clusterId": "5b6206f680eef53690a575b6",
      "clusterName": "MyCluster",
      "links": [
          {
              "href": "https://cloud.mongodb.com/api/atlas/v1.0/groups/5b6212af90dc76637950a2c6/clusters/MyCluster/backup/schedule",
              "rel": "self"
          },
          {
              "href": "https://cloud.mongodb.com/api/public/v1.0/groups/5b6212af90dc76637950a2c6",
              "rel": "http://mms.mongodb.com/group"
          }
      ],
      "nextSnapshot": "2018-08-02T20:01:58Z",
      "numOfSnapshotsToRetain": 5,
      "referenceHourOfDay": 18,
      "referenceMinuteOfHour": 30
  }
