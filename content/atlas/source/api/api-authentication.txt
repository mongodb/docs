.. _api-authentication:

===============================================
{+atlas-admin-api+} Authentication Methods
===============================================

.. meta::
   :description: Authenticate to the Atlas Administration API using either Service Accounts with OAuth 2.0 or API Keys with HTTP Digest Authentication.

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. _HTTP Digest Authentication: http://en.wikipedia.org/wiki/Digest_access_authentication

.. include:: /includes/api/admonitions/service-accounts.rst

To use the {+atlas-admin-api+} to manage your {+service+} clusters, you
must authenticate your |api| requests. The 
{+atlas-admin-api+} accepts the following authentication methods: 

- Service account access tokens ({+oauth-2+})
- API keys ({+http-digest+})

To learn how to use service accounts and |api| keys to configure
programmatic access to your {+service+} organizations and projects, see
the :ref:`{+atlas-admin-api+} Getting Started <atlas-admin-api-access>`
guide.

.. include:: includes/api/facts/api-no-access-to-data.rst

.. note::
   
   Many {+atlas-admin-api+} endpoint |urls| follow the format of
   ``/api/atlas/<version>/groups/<GROUP-ID>/``, where ``<GROUP-ID>`` is 
   your :ref:`project ID <project-id>`. For these resources, the service
   account or |api| keys that you use to authenticate the request must 
   be a member of the organization that hosts the project. Otherwise, 
   {+service+} responds with a `401 <https://httpstatuses.com/401>`__ 
   error.

The following sections describe the {+atlas-admin-api+} authentication
methods:

.. _service-accounts-overview:

Service Accounts Overview
-------------------------

Service accounts are the recommended method to manage authentication to
the {+atlas-admin-api+}. Service accounts provide improved security over
|api| keys by using the industry standard {+oauth-2+} protocol with the
`Client Credentials flow
<https://www.oauth.com/oauth2-servers/access-tokens/client-credentials/>`__.

A service account lets you manage permissions and create access tokens
that authenticate |api| requests. Each service account has a client ID
and a secret that function as a username and a password for creating
access tokens. To learn how to construct an |api| request with an access
token, see :ref:`example-api-request`.

.. include:: /includes/fact-service-account-token-ip-access.rst

Access tokens are only valid for 1 hour (3600 seconds) per the
{+oauth-2+} specification. This limited lifespan protects against replay
attacks, where an attacker uses a leaked access token without time
restriction.

Each service account belongs to exactly one organization, and you can
grant it access to any number of projects within that organization. To
give an organization-level service account access to a project, see
:ref:`Grant Existing Service Account Access to a Project <invite-org-app-api-keys>`.

|service| :ref:`roles <user-roles>` limit which operations a service
account can authenticate with its access token. You must assign roles to
service accounts as you would for users to ensure that the service
account generates access tokens with the necessary permissions for the
desired |api| calls.

You can't use a service account or its access token to log into
{+service+} through the {+atlas-ui+}. Service accounts only grant access
to the {+atlas-admin-api+}, which does not include UI access or access
to cluster data. To learn more about the limitations of service
accounts, see :ref:`server-limits-thresholds`.

.. _api-keys-overview:

API Keys Overview
----------------- 

.. include:: /includes/api/admonitions/service-accounts.rst

API keys are a legacy method of authenticating to the
{+atlas-admin-api+} that uses {+http-digest+}. 

|api| keys have two parts: a Public Key and a Private Key. These serve
the same function as a username and a password to authenticate |api|
requests. To learn how to construct an |api| request using |api| keys,
see :ref:`example-api-request`. 

{+service+} hashes the Public Key and Private Key using a unique value
called a **nonce**. The nonce is only valid for a short amount of time
as per the {+http-digest+} specification. This limited lifespan protects
against replay attacks, where an attacker caches a Private Key to use it
without time restriction.

Each pair of |api| keys belongs to only one organization, and can grant
access to any number of projects in that organization. To give
organization-level |api| keys access to a project, see
:ref:`Grant Existing Service Account Access to a Project <invite-org-app-api-keys>`.

|service| :ref:`roles <user-roles>` limit which operations |api| keys
can perform. You must assign roles to |api| keys as you would for users
to ensure the |api| keys have the necessary permissions for the desired
|api| calls.

You can't use |api| keys to log into |service| through the {+atlas-ui+}.
|api| keys only grant access to the {+atlas-admin-api+}, which does not
include UI access or access to cluster data.

Next Steps
----------

To learn how to use and manage service accounts and |api| keys, see the
following procedures:

- :ref:`create-org-api-key`
- :ref:`about-project-api-keys`
- :ref:`atlas-admin-api-access-org`
- :ref:`atlas-admin-api-access-project`
- :ref:`prog-access-mult-orgs`
- :ref:`generate-oauth2-token-atlas`
- :ref:`revoke-oauth2-token-atlas`

.. seealso::

   `Configure Digest Authentication for Node, Python, and Ruby  
   <https://www.mongodb.com/developer/products/atlas/nodejs-python-ruby-atlas-api/>`_
