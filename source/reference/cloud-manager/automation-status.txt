.. _mcli-cm-automation-status-command:

========================================
mongocli cloud-manager automation status
========================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

The ``automation status`` command retrieves the latest plan for MongoDB
processes in the specified |cloud-short| project. Plans are a set of
actions required to get a MongoDB deployment to the ``goalVersion``.

The command returns the ``goalVersion`` field to 
report the current version of the automation configuration and the 
``lastGoalVersionAchieved`` field to report the versions of the 
configuration running on each server.

.. _cm-automation-status-syntax:

Syntax 
------

.. code-block:: text 
   
   mongocli cloud-manager|cm automation status 
        [ --output|-o json ]
        [ --profile|-P <profile-name> ]
        [ --projectId projectId ]

.. include:: /includes/fact-command-line-help.rst

.. _cm-automation-status-options:

Options
-------

.. list-table:: 
   :header-rows: 1
   :widths: 20 10 60 10 

   * - Option 
     - Type 
     - Description 
     - Required?

   * - ``--output``, ``-o``
     - string 
     - .. include:: /includes/extracts/fact-basic-options-output.rst
     - no

   * - ``--profile``, ``-P``
     - string
     - Name of the profile where the public and private 
       keys for the project are saved. If omitted, uses the 
       {+default-profile+}. To learn more about creating a 
       profile, see :ref:`mcli-configure`.
     - no

   * - ``--projectId``
     - string
     - Unique identifier of the project that contains MongoDB processes
       for which you want the Automation status. If omitted, uses the
       project ID in the profile or the :ref:`environment variable
       <mcli-env-var>`.
     - no

.. _cm-automation-status-output: 

Output 
------

The command prints the following fields in |json| format to 
the terminal if the command succeeds. If the command returns 
errors, see :ref:`Troubleshooting <troubleshooting>` for 
recommended solutions.

.. list-table::
   :widths: 20 10 80
   :header-rows: 1

   * - Name
     - Type
     - Description
   * - goalVersion
     - number
     - The version of the most recently submitted :ref:`automation
       configuration <automation-configuration-sample-entity>`. If there
       is a :ref:`conflict in submissions of automation configurations
       <concurrent-cluster-config>`, this field lists the winning
       configuration.
   * - processes
     - array
     - The project's deployed MongoDB instances.
   * - process.errorCode
     - integer
     - The error code. Returns ``0`` if the process has no errors.
   * - process.errorCodeDescription
     - string
     - Detailed error description. Returns an empty string if the 
       process has no errors.
   * - process.errorCodeHumanReadable
     - string
     - Short error description. Returns an empty string if the 
       process has no errors.
   * - process.errorString
     - string
     - Output of the log line that contains the error. Examine this
       field for additional error context. 
       Returns an empty string if the process has no errors.
   * - processes.hostname
     - string
     - The fully qualified domain name (retrieved by issuing 
       ``hostname -f``) of the server on which the MongoDB process and
       {+aagent+} are hosted. 
   * - processes.name
     - string
     - The process name as specified in the automation configuration.
   * - processes.lastGoalVersionAchieved
     - number
     - The last version of the automation configuration with which this
       process had deployed as configured. If the ``processes.lastGoalVersionAchieved``
       number is not equal to the ``goalVersion`` number, the process has
       not yet deployed according to the current configuration.
   * - processes.plan
     - array
     - Describes how a process that is not yet up-to-date with the
       configuration will achieve the goal state.

.. _cm-automation-status-examples:

Example
-------

The following ``mongocli cm automation status`` command 
returns plans of MongoDB processes in the specified project in |json|
format. It uses the {+default-profile+} to access the specified
project.

.. code-block:: text
   :copyable: false

   mongocli cm automation status --projectId 5e2f06127a3e5a5700de8d8d

The command prints the following fields to the terminal. To 
learn more about these fields, see :ref:`cm-automation-status-output`.

.. code-block:: json
   :copyable: false

   {
    "processes": [
     {
      "plan": [
       "WaitRsInit",
       "WaitFeatureCompatibilityVersionCorrect"
      ],
      "lastGoalVersionAchieved": 6,
      "name": "k8s-repl-1",
      "hostname": "k8s-repl-1.k8s-repl-example"
     },
     {
      "plan": [
       "WaitRsInit",
       "WaitFeatureCompatibilityVersionCorrect"
      ],
      "lastGoalVersionAchieved": 6,
      "name": "k8s-repl-2",
      "hostname": "k8s-repl-2.k8s-repl-example"
     },
     {
      "plan": [
       "WaitAllRsMembersUp"
      ],
      "lastGoalVersionAchieved": 6,
      "name": "k8s-repl-0",
      "hostname": "k8s-repl-0.k8s-repl-example"
     }
    ],
    "goalVersion": 6
   }

