ref: queryable-backup-duration
edition: cloud
content: |

   |mms| provisions these queryable snapshots as *read-only* MongoDB
   instances.
  
   .. important::

      These instances are available for up to 24 hours.

---
ref: queryable-backup-duration
edition: onprem
content: |

   |mms| provisions these queryable snapshots as *read-only* MongoDB
   instances. Specifically, |mms| spins up a :program:`mongod` with
   data from the selected snapshot store.

   .. important::

      By default, these instances are available for up to 24 hours. You
      can configure the duration using :setting:`Expiration (Hours) <Expiration>`.
      For other queryable backup settings, see
      :ref:`queryable-snapshot-settings`.
---
ref: queryable-backup-prerequisites
edition: onprem
content: |

   MongoDB Version
   ~~~~~~~~~~~~~~~

   Queryable backups are available for:
      
   - MongoDB 3.2 or later replica sets or

   - MongoDB 3.2 or later sharded clusters with replica set config
     servers (CSRS).

   For queryable backups/restores of:
      
   - MongoDB 3.6 sharded clusters, backup daemons require MongoDB
     Enterprise 3.6.2 or later.

   - MongoDB 3.6 replica sets, backup daemons require:

     - MongoDB 3.4.11 Enterprise or later (Windows)

     - MongoDB 3.4.2 Enterprise or later (Linux/macOS)

   - MongoDB 3.4 replica sets or sharded clusters, backup daemons require:

     - MongoDB 3.4.11 Enterprise or later (Windows)

     - MongoDB 3.4.2 Enterprise or later (Linux/macOS)

   - MongoDB 3.2 replica sets, backup daemons require:
      
     - MongoDB 3.4.11 Enterprise or later (Windows)

     - MongoDB 3.4.2 Enterprise or later (Linux/macOS)

   PEM file
   ~~~~~~~~

   For the queryable backup host, you must specify the location of the
   PEM file (which contains both a public key certificate and its
   associated private key) using the :setting:`Proxy Server PEM File`
   setting. If you have not already set up the queryable backup
   settings:

   #. Click on :guilabel:`Admin` on the upper-right hand corner. From 
      the :guilabel:`Admin` screen, click on :guilabel:`General` >
      :guilabel:`Ops Manager Config` > :guilabel:`Backup`.

   #. Scroll to the :guilabel:`Queryable Snapshot Configuration` and
      specify the :setting:`Proxy Server PEM File` that the tunnel or
      clients can use to connect to the queryable :program:`mongod`
      instance. 
      
      If the file is encrypted, specify the :setting:`Proxy Server PEM File Password`.

   #. Optional.  Update other queryable snapshot settings as
      appropriate. For description of the settings, see
      :ref:`queryable-snapshot-settings`.

      .. note::

         .. include:: /includes/extracts/queryable-backup-proxy-requirements.rst

   App Server
   ~~~~~~~~~~

   - The app server requires that ports 27700-27719 be open for communication
     with queryable backup snapshots. See :doc:`Firewall Configuration 
     </reference/firewall-configuration>` for more information.

---
ref: queryable-backup-prerequisites
edition: cloud
content: |

   Queryable backups are available for MongoDB 3.2 or later replica
   sets or MongoDB 3.2 or later sharded clusters with replica set
   config servers (CSRS).

---
ref: queryable-backup-pem-restriction
edition: onprem
content: |

   :setting:`Proxy Server PEM File` has the following restrictions:

   - The PEM should use a key length greater than 512-bit. Using a
     2048-bit RSA key is recommended.

   - The PEM should use a message digest stronger than ``sha1``, such as ``sha256``. 

---
ref: queryable-backup-pem-restriction
edition: cloud
content: ""
---
ref: queryable-backup-certificate-duration
edition: cloud
content: |

   The X.509 certificates are valid for 24 hours. 

---
ref: queryable-backup-certificate-duration
edition: onprem
content: |

   The client X.509 certificate is valid for the same length of time as
   the queryable instance :setting:`Expiration (Hours) <Expiration>`,
   which is 24 hours by default.
---
ref: queryable-backup-proxy-requirements
edition: onprem
content: |
   
   - .. include:: /includes/extracts/queryable-backup-proxy-port.rst

   - .. include:: /includes/extracts/queryable-backup-proxy-pem-file.rst

   - .. include:: /includes/extracts/queryable-backup-proxy-pem-password.rst

---
ref: queryable-backup-proxy-requirements
edition: cloud
content: ""
---
ref: queryable-backup-proxy-port
edition: onprem
content: |
   After updating :setting:`Proxy Server Port`, the Web Server needs
   a restart for the new port to take effect.
---
ref: queryable-backup-proxy-port
edition: cloud
content: ""
---
ref: queryable-backup-proxy-pem-file
edition: onprem
content: |
   After updating :setting:`Proxy Server PEM File`, the Web Server needs
   a restart for the change  to take effect.
---
ref: queryable-backup-proxy-pem-file
edition: cloud
content: ""
---
ref: queryable-backup-proxy-pem-password
edition: onprem
content: |
   After updating :setting:`Proxy Server PEM File Password`, the Web Server needs
   a restart for the change  to take effect.
---
ref: queryable-backup-proxy-pem-password
edition: cloud
content: ""
...
