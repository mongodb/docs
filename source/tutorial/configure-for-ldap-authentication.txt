.. _security-ldap:

==============================================
Configure Users and Groups with LDAP for |mms|
==============================================

.. default-domain:: mongodb

.. important::

   You must start with a fresh installation of the latest version of |mms|.
   There is no method for converting an existing |mms| deployment to use LDAP
   user management.

Overview
--------

You can configure |mms| to use a Lightweight Directory Access Protocol (LDAP)
service to manage user authentication. Users log in using the standard |mms|
interface. |mms| synchronizes user name and email addresses in |mms| user records
with the values in LDAP user records.

.. note::

   If your MongoDB deployment uses LDAP, you must also create MongoDB
   users for the |mms| agents. For more information, see
   :doc:`/tutorial/configure-monitoring-agent-for-ldap` and
   :doc:`/tutorial/configure-backup-agent-for-ldap`.

   Additionally, and independently, the |application| can also use LDAP to
   authenticate to its :doc:`backing instances
   </tutorial/prepare-backing-mongodb-instances>`. To use LDAP with
   backing instances, set the :setting:`mongo.mongoUri` in addition to the
   :ref:`LDAP settings <ldap-settings>` described in the procedure below.

User Authentication
~~~~~~~~~~~~~~~~~~~

When a user logs in, |mms| searches LDAP for a matching user. To perform the
search, |mms| logs into LDAP as the "search" user, using the credentials
specified in the :setting:`mms.ldap.bindDn` and
:setting:`mms.ldap.bindPassword` settings in the |mms| :doc:`configuration file
</reference/configuration>`.

|mms| searches LDAP within the base distinguished name defined in the
:setting:`mms.ldap.user.baseDn` setting of the |mms| configuration file and
matches the user according to the LDAP attribute defined in the
:setting:`mms.ldap.user.searchAttribute` setting. If a matching user is found,
|mms| authenticates the supplied password against the LDAP password.

Access Control
~~~~~~~~~~~~~~

LDAP groups let you control access to |mms|. You map LDAP groups to |mms| roles
and assign the LDAP groups to the users who should have those roles.

To use LDAP groups effectively, :doc:`create additional |mms| groups
</tutorial/create-group>` to control access to specific deployments in your
organization. For example, create separate |mms| groups for development
environments and for production environments. Provide access to a deployment
by mapping an LDAP group to a role in the |mms| group.

This tutorial describes how to map LDAP groups to global |mms| roles and to
group-level |mms| roles. You do the former through the |mms| :doc:`configuration
file </reference/configuration>` and the latter through the |mms| interface.

.. note::

   Changes made to LDAP groups can take up to an hour to appear in |mms|.

Global Owner Access
~~~~~~~~~~~~~~~~~~~

Your LDAP installation must include a group that you can assign to the
|mms| :setting:`mms.ldap.global.role.owner` setting. The first user to log into |mms|
with LDAP authentication must belong to this LDAP group. This user will also create
the initial |mms| group.

For example, if LDAP has an ``admin`` group for use by |mms| administrators, set
the :setting:`mms.ldap.global.role.owner` property to ``admin`` during the
appropriate step in the procedure below.

Prerequisites
-------------

The :ref:`mms-application-package` must be installed
and configured. You must either start with a new |mms| installation or reset
your installation to a clean state. For assistance, contact your MongoDB
account manager.

The LDAP server must be installed, configured, and accessible to |mms|.

Procedure
---------

To configure LDAP authentication, define user records in LDAP, configure
:ref:`LDAP settings <ldap-settings>` in |mms|, and then associate LDAP
groups with |mms| group-level roles, as described here:

.. include:: /includes/steps/configure-ldap-authentication.rst
