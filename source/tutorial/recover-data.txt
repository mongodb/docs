==================
Recover Data Files
==================

.. default-domain:: mongodb

Overview
--------

If you suspect that some of your data files are invalid and if your
deployment uses :term:`replica sets <replica set>`, use the procedures in
:doc:`/tutorial/resync-replica-set-member` to resync the invalid data
files from valid files on one of the other members of the replica set.

If your deployment does *not* use replica sets, use the following
procedure to remove the invalid portions of your data files and to make
the remaining portions usable.

The best way to avoid data loss and ensure the most robust deployments is
to follow the recommendations in :doc:`maintain-valid-data-files`.

Considerations
--------------

.. warning::

   You can lose data as part of the recovery process.

This procedure removes the invalid parts of data files. On a capped
collection, this procedure truncates the collection to two documents. Do
not use :program:`mongodump` with the :option:`--repair <mongodump>` to
recover capped collections.

Do not perform this procedure on files that are currently opened by a
running :program:`mongod` instance. This procedure will not work on files
that are already open.

Prerequisite
------------

Use a recovery path with enough space to hold the recovered data files.

Procedure
---------

This procedure assumes a ``/data/db`` directory that contains data files
for a ``users`` database and a ``/data/recovery`` directory for recovered
files. Use the following sequence of operations with the relevant
directory and database names. Never remove the ``mongod.lock`` file from
the data directory.

.. include:: /includes/steps/recover-data-files.rst

Related Documents
-----------------

- :doc:`maintain-valid-data-files`

- :doc:`detect-invalid-data-files`

- :doc:`/tutorial/manage-journaling`

- :doc:`/core/backups`

- :doc:`/administration/backup`
