.. _config-online-archive:

========================
Configure Online Archive
========================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. include:: /includes/fact-online-archive-beta-message.rst

.. _config-online-archive-intro:

Overview
--------

You can configure data in a collection to be archived by specifying an 
archiving rule. The archiving rule is a combination of a date that is 
used to determine when to archive data and a numeric value representing 
the number of days that the |service| cluster stores the data. 
  
Data is archived when the current date is greater than the specified 
date plus the number of days.

To configure your |service| cluster for online archive: 

1. Create an archiving rule by providing the collection namespace, an already 
   indexed date field from the documents in the collection, and an age limit or 
   number of days for the collection data on the |service| cluster.

2. (Optional) Specify commonly queried fields to partition archived data. 

.. _config-online-archive-ui:

Configure Online Archive Through the UI  
---------------------------------------

To configure an :guilabel:`Online Archive`, in your |service| UI: 

.. include:: /includes/steps/config-online-archive.rst

.. _config-online-archive-api:

Configure Online Archive Through the API  
----------------------------------------

To configure an online archive from the API, send a ``POST`` request to 
the :ref:`onlineArchives <api-online-archive>` endpoint. If an ``Active`` 
online archive already exists for the cluster for the same database and 
collection with the same archiving rule, the operation will fail. 
Alternatively, if the existing online archive is in ``Paused`` or ``Deleted`` 
state, the new online archive is created and its status is set to ``Active``. 
To learn more about the |api| syntax and options, see 
:ref:`api-online-archive-create-one`.

Limitations 
-----------

You can create up to 50 online archives per cluster and up to 20 can be active 
per cluster. The following limitations apply:

- You can configure multiple online archives in the same namespace, but only 
  one can be active at any given time. 
- You cannot create multiple online archives on the same fields in the same 
  collection.
