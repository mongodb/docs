==============================
Configure |service| API Access
==============================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

To access the |service| |api|, you must generate an |api| key for
either :ref:`programmatic access <atlas-prog-api-key>` for an
organization or a
:ref:`Personal API Key (deprecated)<atlas-personal-api-key>` for an
|service| user.

.. admonition:: Preferred Method to Use API
   :class: important

   MongoDB recommends using
   :ref:`Programmatic API Keys <atlas-prog-api-key>` instead of
   :ref:`Personal API Keys (deprecated)<atlas-personal-api-key>`.

.. admonition:: Programmatic API Keys cannot use the |mms| User Interface
   :class: note

   |api| keys that are associated with an organization are not
   associated with user credentials and cannot log in to the |service|
   user interface.

Prerequisite
------------

.. _configure-access-to-whitelisted-ops:
.. _whitelist-for-api-operations:

Enable API Whitelisting for Your Organization
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

For |service| users with a non-empty |api| whitelist, all |api|
access must originate from a whitelisted |ipv4| address. Ensure your
configured whitelist entries provide appropriate coverage for all
clients which require |api| access. An empty |api| whitelist grants
access to all |api| endpoints except those that explicitly require
whitelisting.

You can configure |service| to require |api| whitelisting at the
organization level. When this setting is enabled, all |api| calls
within that organization must originate from an entry on each
respective |service| userâ€™s |api| whitelist. For organizations that
require |api| whitelisting, |service| users cannot access any |api|
operations until they define at least one |api| whitelist entry.

To require an |api| whitelist for an Organization:

1. Log into |service|.

#. Access the Organization using the :guilabel:`Context` picker in
   the top-left hand corner of the |service| UI.

#. Click :guilabel:`Settings` from the left hand navigation.

#. Toggle the :guilabel:`Require IP Whitelist for Public API`
   setting to :guilabel:`On`.

For a description of the |service| |api|'s principles and conventions,
see the :doc:`/api`.

.. _atlas-prog-api-key:

Programmatic API Keys
---------------------

To grant programmatic access to an organization or project using only
the :doc:`API </api>`, you can create an |api| key. |api| keys:

- Have two parts: a Public Key and a Private Key. These serve the same
  function as a username and Personal |api| Key when making |api|
  requests to |service|.

- Cannot be used to log into |service| through the user interface.

- Must be granted roles as you would Users to make sure the |api| Keys
  can call |api| endpoints without errors.

- Can belong to one organization, but may be granted access to
  any number of projects in that organization.

.. _about-org-app-api-keys:

Manage Programmatic Access to an Organization
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. admonition:: Required Permissions
   :class: note

   To perform any of the following actions, you must have the
   :authrole:`Organization Owner` role.

.. _create-org-app-api-key:

Create an API Key in an Organization
````````````````````````````````````

.. include:: /includes/app-api-key-create-in-org.rst

.. _view-org-app-api-key:

View the Details of an API Key in an Organization
`````````````````````````````````````````````````

.. include:: /includes/app-api-key-view-details-in-org.rst

.. _change-org-app-api-key-roles:

Change an API Key in an Organization
````````````````````````````````````

You can change the roles, description, or whitelist of an |api| Key in 
an Organization.

.. include:: /includes/app-api-key-change-in-org.rst

.. _delete-org-app-api-key:

Delete an API Key from an Organization
``````````````````````````````````````

.. include:: /includes/app-api-key-delete-from-org.rst

.. _about-project-app-api-keys:

Manage Programmatic Access to a Project
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. admonition:: Required Permissions
   :class: note

   To perform any of the following actions, you must have either the
   :authrole:`Project User Admin` role.

.. _create-project-app-api-key:

Create an API Key for a Project
```````````````````````````````

.. include:: /includes/app-api-key-create-in-project.rst

.. _view-project-app-api-key:

View the Details of an API Key in a Project
```````````````````````````````````````````

.. include:: /includes/app-api-key-view-details-in-project.rst

.. _change-project-app-api-key-roles:

Change an API Key's Roles in a Project
``````````````````````````````````````

.. include:: /includes/app-api-key-change-roles-in-project.rst

.. _delete-project-app-api-key:

Delete an API Key from a Project
````````````````````````````````

.. include:: /includes/app-api-key-delete-from-project.rst

.. _atlas-personal-api-key:

Personal API Keys (Deprecated)
------------------------------

.. include:: /includes/fact-personal-apikeys-deprecated-ui.rst

To access the |service| |api|, each user must generate an |api| key.
Each user can have up to 10 |api| keys associated with their account.
Each key can be either enabled or disabled but all count toward the 10
key limit.

An |api| key is like a password. Keep it secret.

When accessing |service| through the |api|, you have the same level of
access as you do through the |service| interface. Your |service| roles
apply to both the interface and the |api|.

.. _generate-personal-api-key:

Generate Personal API Keys
~~~~~~~~~~~~~~~~~~~~~~~~~~

.. important::

   When you generate a key, |service| displays it **one time only**.
   You must copy it. |service| will never display the full key again.

1. On the upper-right hand corner, click on your user name and select
   :guilabel:`Account`.  Click on :guilabel:`Public API Access`.

#. In the :guilabel:`API Keys` section, click :guilabel:`Generate`.

#. Type a description into the :guilabel:`Description` box.

#. Click :guilabel:`Generate`.

#. If prompted for two-factor authentication:

   a. Type the authentication code.
   #. Click :guilabel:`Verify`.
   #. Click :guilabel:`Generate`.

#. Copy and record the key.

   .. warning::

      **Copy the key immediately**. |service| displays the full key one
      time only. You will not be able to view the full key again.

   Record the key in a secure place. After you record the key, click
   :guilabel:`Close`.

Limit API Operations to Whitelisted IPv4 Addresses
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

To access whitelisted |api| operations, you must configure your
:ref:`API whitelist <whitelist-for-api-operations>` with the |ipv4|
addresses from which you will issue the whitelisted commands. You also
must have the :authrole:`Organization Owner` role to issue whitelisted
commands.

Address-based whitelists protect |api| operations. Only client requests
that originate from a whitelisted |ipv4| address are permitted to
perform the operations.

Users have their own whitelists and own |api| keys. When you issue an
|api| call, you must use an |api| key from your user account and must
issue the command from an address on your user account's whitelist. You
cannot use your key to issue a whitelisted |api| request from an
address on another user's whitelist, unless, of course, you've added
that address to your own whitelist.

On the :doc:`resources </reference/api-resources>` pages in this guide,
whitelisted operations are marked as such.

.. _add-personal-api-key-whitelist:

Add an IPv4 Address to the API Whitelist
````````````````````````````````````````

1. On the upper-right hand corner, click on your user name and select
   :guilabel:`Account`.  Click on :guilabel:`Public API Access`.

2. In the :guilabel:`API Whitelist` section, click :guilabel:`Add`.

3. Enter an |ipv4| address or |cidr| range. To add multiple entries to
   your whitelist, repeat this step. If you leave your whitelist empty,
   you have no access to whitelisted operations.

   You can enter any of the following:

   .. list-table::
      :header-rows: 1

      * - Entry

        - Grants

      * - An |ipv4| address

        - Access to whitelisted operations from that address.

      * - A |cidr|\-notated range of |ipv4| addresses

        - Access to whitelisted operations from those addresses.

.. _delete-personal-api-key-whitelist:

Delete an IPv4 Address from the API Whitelist
`````````````````````````````````````````````

1. On the upper-right hand corner, click on your user name and select
   :guilabel:`Account`.

#. Click on :guilabel:`Public API Access`.

#. In the :guilabel:`Whitelist` section, click the address's
   :guilabel:`gear icon` and select :guilabel:`Delete`.
