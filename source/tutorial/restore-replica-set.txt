===================================
Restore a Replica Set from a Backup
===================================

.. default-domain:: mongodb

Overview
--------

You can restore a replica set onto new hardware from the artifacts
captured by |backup|.

You can restore from a stored snapshot or from a point in time in the last
24 hours. For point-in-time recovery, MMS applies the :manual:`oplog
</core/replica-set-oplog/>` to the snapshot that is previous to the
selected point in order to create a custom snapshot. Point-in-time
recovery takes longer than recovery from a stored snapshot.

MMS provides restore files as downloadable archives; MMS can also
``scp`` files directly to your system. The ``scp`` delivery method
requires additional configuration but provides faster delivery.

Sequence
--------

The sequence to restore a replica set is to:

- download the restore file,

- distribute the restore file to to each server,

- start the :program:`mongod` instances, and

- initiate and configure the replica set.

For additional approaches to restoring replica sets, see the procedure
from the MongoDB
Manual to :manual:`Restore a Replica Set from a Backup
</tutorial/restore-replica-set-from-backup>`.

Consideration
-------------

.. include:: /includes/considerations-restore-in-isolation.rst

Procedures
----------

Select and Download the Snapshot
++++++++++++++++++++++++++++++++

When you select a snapshot to restore, MMS creates a link to download the
snapshot as a tar file. The link is available for one download only and
times out after an hour. Once you download the tar file, copy it to each
server to restore.

.. include:: /includes/steps/download-snapshot-replica-set.rst

Restore the Primary
+++++++++++++++++++

You must have a copy of the snapshot on the server that provides the
primary:

.. include:: /includes/steps/restore-primary.rst

Restore Each Secondary
++++++++++++++++++++++

After you have restored the primary you can restore all
secondaries. You must have a copy of the snapshot on all servers that
provide the secondaries:

.. include:: /includes/steps/restore-secondary.rst
