======================
|mms| Server Changelog
======================

.. default-domain:: mongodb

|onprem| Server 1.6.1
---------------------

*Released 2015-03-26*

- Upgraded Automation Agent to ``1.4.15.999``. See: the 
  :ref:`Automation Agent release notes <automation-1.4.15.999>`.

- **Security Update**: resolved an issue where users removed from LDAP groups
  were not always removed from corresponding Ops Manager groups.
  This upgrade is **highly recommended** for anyone using 
  LDAP authentication.

- Selecting wildcards in the Version Manager is no longer supported
  when ``automation.versions.source`` is set to ```local``.
  
- Adds a 1 hour timeout to kill a Backup ``HEAD DB`` if it does not shutdown cleanly.
  You must perform a resync following a hard kill.
  
- Windows support for Backup Daemon using Windows 64-bit 2008 R2+
  MongoDB builds.

- Fix for Backups stored in :ref:`WiredTiger <considerations-backup-storage-engine>`
  format in which a single collection grows from under 8 GB to over 8 GB in size.

- The time before an unreachable :program:`mongos` process is deactivated
  is now configurable on a per group basis. See
  :ref:`admin-only-group-settings`.

- The time before a standby Monitoring Agent takes over after the
  primary Monitoring Agent stops responding is now configurable to a
  minimum of 90 seconds. See the
  ``mms.monitoring.agent.session.timeoutMillis`` setting in
  :doc:`/reference/configuration`.

- For Backup HTTP pull restore, the link expiration and the number of
  allowed uses of a link are now configurable. See
  :ref:`advanced-backup-restore-settings`.

|onprem| Server 1.6.0
---------------------

*Released 2015-03-02*

New Features
~~~~~~~~~~~~

- Initial release of :ref:`Automation <automation>`. Automation manages
  many basic administrative tasks for MongoDB deployments, including
  version upgrades, adding replica set members, adding shards, and
  changing oplog size. You can both :doc:`import existing deployments into
  Automation </tutorial/add-existing-host-to-automation>` and :doc:`create
  new deployments on your provisioned hardware
  </tutorial/add-existing-hardware>`.

- Windows support (Monitoring and Backup only). You can
  :doc:`/tutorial/install-on-prem-windows` using MSI files. |onprem|
  supports Windows Server 2008 R2 and above.

- Support for MongoDB 3.0, including support for backups that use the
  :ref:`WiredTiger <considerations-backup-storage-engine>` storage engine.

  .. include:: /includes/compatibility-mongodb-3-0-and-monitoring-agent.rst

- Support for using the SSL and MONGODB-X509 authentication mechanisms for
  the backing MongoDB databases. See
  :doc:`/tutorial/configure-ssl-connection-to-backing-mongodb`.

- Public API endpoints to manage Automation configuration. For more
  information, see :ref:`Automation <api-automation>` in the API
  documentation.

Improvements
~~~~~~~~~~~~

- The |onprem|'s :doc:`Administration </core/administration-interface>`
  interface provides more information to make it easier to monitor the
  health of the |onprem| installation.

- The |onprem| Deployment tab now displays all deployment information on
  one page, with icons for selecting view options. The new Topology View
  groups all hosts by the replica set or sharded cluster they are part of.
  The new Servers View shows information about MongoDB processes and
  |onprem| agents grouped by server.

- Fixed an isssue (`MMS-2273 <https://jira.mongodb.org/browse/MMS-2273>`_)
  where, in certain situations, the Backup Agent was not reporting a
  cluster snapshot as potentially inconsistent.

- Improved handling of cursor timeouts by the Backup Agent. To use this
  improvement, upgrade to the latest Backup Agent, which is included with
  |onprem|. The improvement became available with Backup Agent version
  ``2.3.3.209-1``.

Considerations for Upgrade
~~~~~~~~~~~~~~~~~~~~~~~~~~

- |onprem| 1.8.0, when released, **will not** support MongoDB 2.4 for the
  :ref:`mms-application-database` and
  :ref:`mms-backup-blockstore-database`.
  |onprem| Server 1.8.0 *will* continue to support MongoDB 2.4 for your
  monitored and backed-up databases.

- |onprem| 1.6.0 supports direct upgrades only from MMS On Prem 1.3 and
  above.

- The procedure to configure |onprem| to run with HTTPS has changed and is
  greatly simplified. The previous procedure no longer works. For the new
  procedure, see
  :doc:`/tutorial/configure-ssl-connection-to-web-interface`.

- The connection string to the Backup Blockstore database is now
  configured through the Administration interface's :ref:`Blockstores page
  <blockstores-page>` and not through the ``mongo.backupdb.mongoUri``
  field in the ``conf-daemon.properties`` configuration file.

- |onprem| no longer requires you to supply the replica set name of the
  backing MongoDB instances. The ``mongo.replicaSet`` and
  ``mongo.backupdb.replicaSet`` properties have been removed from the
  configuration files. These properties had previously controlled whether
  |onprem| treated a connection to a backing instance as a standalone or
  replica set, for the purpose of setting the write concern. |onprem| now
  sets write concern based on how many hosts are supplied in the
  connection string.

- You can disable Automation for the entire |onprem| installation through
  the ``mms.featureFlag.automation`` setting in the
  ``conf-daemon.properties`` :doc:`configuration file
  </reference/configuration>`.

- Removed the :guilabel:`Dashboards` view from the |onprem| UI. You can
  view monitoring metrics from the :guilabel:`Deployment` tab.
  See: :doc:`/tutorial/nav/monitoring-metrics` for an overview
  of the available metrics and how to access them.

MMS Onprem Server 1.5.5
-----------------------

*Released 2015-03-26*

- **Security Update**: resolved issue where users removed from LDAP groups
  were not always removed from corresponding Ops Manager groups.
  This upgrade is **highly recommended** for anyone using 
  LDAP authentication.

MMS Onprem Server 1.5.4
-----------------------

*Released 2015-03-18*

- Fixed race condition that could cause the Backup Daemon to hang when
  the MongoDB process for a ``HEAD DB`` fails to start.

- Fixed an issue where a rollback occurring shortly after a terminate could
  step on the terminate.

- The time before an unreachable :program:`mongos` process is
  deactivated is now configurable on a per group basis. See
  :ref:`admin-only-group-settings`.

- The time before a standby Monitoring Agent takes over after the
  primary Monitoring Agent stops responding is now configurable to a
  minimum of 90 seconds. See the
  ``mms.monitoring.agent.session.timeoutMillis`` setting in
  :doc:`/reference/configuration`.

- For Backup HTTP pull restore, the link expiration and the number of
  allowed uses of a link are now configurable. See
  :ref:`advanced-backup-restore-settings`.

MMS OnPrem Server 1.5.3
-----------------------

*Released 2014-12-17*

Significant improvements in performance for the processing of MMS OnPrem
Monitoring data for MMS OnPrem Groups with a large number of hosts

MMS OnPrem Server 1.5.2
-----------------------

*Released 2014-11-18*

- Added Support for archive restores (``.tar.gz``) for databases whose
  filenames exceed 100 characters.

- API: Skip missed points in metrics data, instead of returning empty
  data.

- API: Return correct number of data points when querying metric data
  with the period option.

- Backup Agent update to ``2.3.3.209-1``

MMS OnPrem Server 1.5.1
-----------------------

*Released 2014-09-26*

- Fix cases where replica set member alerts (e.g. no primary, number
  of healthy members) could send false positives.

- Skip ``backup-daemon`` :setting:`rootDirectory` and
  :setting:`mongo.backupdb.mongoUri` overlap check when the
  :setting:`mongo.backupdb.mongoUri` is on a different
  host.

- ``mms-gen-key`` script handles user's effective group being
  different than the username.

- Security enhancements.

MMS OnPrem Server 1.5.0
-----------------------

*Released 2014-09-02*

Considerations for Upgrade
~~~~~~~~~~~~~~~~~~~~~~~~~~

- MMS OnPrem *only* supports direct upgrades from 1.3 and 1.4.

- Change in configurations and policy for 2FA:  Two-factor
  authentication must now be explicitly enabled using the
  :setting:`mms.multiFactorAuth.require` setting.

- The default LDAP group separator became ``;;``. Previously the
  separator was ``,``. See the :ref:`LDAP configuration
  <default-ldap-separator>` documentation for more information.

- Suppressed hosts will only remain suppressed for 30 minutes.

  Previously, if after deleting a host, from MMS OnPrem Monitoring the
  hostname and port combination would be added to a suppression list with an infinite
  lifetime. The suppression list prevented a race condition where host in a cluster would
  be auto-discovered by another member of a deployment before the host
  could was fully removed. Now, hostname and port combinations remain
  on the suppression list for only 30 minutes.

- Set the :setting:`mms.remoteIp.header` in the
  ``conf-mms.properties`` file  if clients access the MMS OnPrem Application
  via a load balancer.

- :setting:`mongo.backupdb.mongoUri` is no longer in
  ``conf-mms.properties``. This was previously a required field in this
  file. It remains in the backup daemons's ``conf-daemon.properties``.

- Stored MongoDB profile data is not transferred between OnPrem 1.4
  and OnPrem 1.5 during the upgrade process.

Improvements
~~~~~~~~~~~~

- When an MMS OnPrem Backup job fails to bind, the system will periodically
  and automatically retry.

- All MMS OnPrem Backup jobs will retry indefinitely.

- Point in Time restores are now available with one second granularity.

New Features
~~~~~~~~~~~~

- MMS OnPrem :doc:`Public API </reference/api>`.

- Explicit support for multiple MMS OnPrem Backup Blockstore Databases and
  the ability to pin MMS OnPrem Groups to specific backup daemons and
  databases. See :doc:`/tutorial/configure-backup-data-locality` for
  more information.

- MMS OnPrem can authenticate using LDAP to both the database backing MMS OnPrem and
  the monitored and backed up MongoDB deployments. See :ref:`security-ldap`.

- Enhanced auditing. See :doc:`/reference/audit-events` for more
  information.

- Ability to acknowledge alerts with comments.

- New cluster page that shows individual, sum or average metrics for
  all shards in a cluster.


MMS OnPrem Server 1.4.3
-----------------------

*Released 2014-07-22*

- Addressed issues related to Backup Job assignment for 2.6.x clusters
  that used the :authrole:`clusterMonitor` role to support MMS OnPrem
  Monitoring.

- Fixed problem importing email addresses for users for deployments
  that use LDAP integration.

- Fixed rare race condition caused high CPU usage in the MMS OnPrem HTTP
  Service if the application cannot connect to one of the backing databases.

- Additional security enhancements.

MMS OnPrem Server  ``1.4.2``
----------------------------

*Released 2014-05-29*

- Critical bug fix for backing up MongoDB 2.6 deployments that include
  user or custom role definitions:

  - The :data:`system.version` collection in the admin database will
    be included in all future snapshots.

  - The :data:`system.roles` collection in the admin database will be
    included after a new initial sync is performed.

  Users capturing backups of MongoDB 2.6 replica sets
  or clusters with MMS OnPrem that include custom role definitions should perform a
  new initial sync. Taking a new initial sync will ensure that the
  role definitions are included in the backup.

- Disable MongoDB :collflag:`usePowerOf2Sizes` for insert-only MMS OnPrem
  Backup collections.

- Speed optimization for MMS OnPrem Backup HTTP pull restores.

- Fix for LDAP integration, MMS OnPrem now passes full ``dn`` correctly when
  authenticating the user.

MMS OnPrem Server  ``1.4.1``
----------------------------

*Released 2014-04-28*

- Ability to Backup replica sets or clusters using Kerberos authentication

- Ability to Backup replica sets or clusters running specific custom
  MongoDB builds provided by MongoDB, Inc.

- Fix validation issue preventing Backup of MongoDB 2.6.0 clusters

- Reduced log noise from Monitoring Agent when monitoring MongoDB 2.0 or unreachable mongods

MMS OnPrem Server  ``1.4.0``
----------------------------

*Released 2014-04-08*

- Includes MMS OnPrem Backup: continuous backup with point-in-time recovery of replica
  sets and cluster-wide snapshots of sharded clusters.

- Finer-grained roles and permissions.

- Improved user interface for alerts.

- Enhanced Activity Feed for auditing of all activity.

- Monitoring Agent distributed as OS-specific binary. Python dependency removed.

- LDAP integration for managing users and groups.

MMS OnPrem 1.4.0 requires MongoDB 2.4.9+ instances for :doc:`backing
storage </tutorial/prepare-backing-mongodb-instances>`.

MMS OnPrem Server  ``1.3.0``
----------------------------

*Released 2013-12-01*

- Packaging/support for Debian and SUSE Linux.

- Kerberos authentication support between MMS OnPrem server and backing MongoDBs, as
  well as between Monitoring Agent and the MongoDBs it monitors.

- OnPrem users can be overall site administrators. (MMS OnPrem Admins)

- New admin section where MMS OnPrem Admins can manage user roles and message banners.

- Tunable advanced password and session management configurations.

- Encryption key rotation, more specific CORS policy, auth tokens removed from
  chart URLs, and other security enhancements.

MMS OnPrem Server  ``1.2.0``
----------------------------

*Released 2013-07-24*

- Redesigned user interface and enhanced algorithm to auto-discover hosts and
  derive host topology.

- SNMP monitoring.

- Ability to export charts.

- Option to store encrypted authentication credentials in the ``mmsDb``
  property in the configuration file.

- Ability to classify users within an MMS OnPrem Group as group administrators or
  read-only users.
