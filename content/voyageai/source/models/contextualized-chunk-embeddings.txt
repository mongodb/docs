:tabs-selector-position: main

.. _voyage-contextualized-chunk-embeddings:
.. _voyage-context-chunk-embeddings:

===============================
Contextualized Chunk Embeddings
===============================

.. facet::
   :name: genre
   :values: reference

.. meta::
   :description: Learn about Voyage AI's contextualized chunk embedding models for improved retrieval accuracy.
   :keywords: contextualized embeddings, voyage-context-3, chunk embeddings, document context
   
.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

``voyage-context-3`` is a contextualized chunk embedding model 
that produces vectors for chunks that capture the full document 
context without any manual metadata and context augmentation. This 
leads to higher retrieval accuracies than with or without 
augmentation. The model is also simpler, faster, and cheaper. It 
serves as a drop-in replacement for standard embeddings without 
downstream workflow changes and reduces chunking strategy 
sensitivity.

To learn more, see the :website:`blog post 
</company/blog/product-release-announcements/voyage-context-3-focused-chunk-level-details-global-document-context>`.

Available Models
----------------

.. include:: /includes/tables/contextualized-chunk-embeddings-table.rst

Tutorial
--------

For a tutorial on using contextualized chunk embeddings, 
see :ref:`voyage-semantic-search`.

Usage
-----

.. composable-tutorial::
   :options: client
   :defaults: python

   .. selected-content::
      :selections: python

      You can access {+voyage+} contextualized chunk embeddings in Python
      through the ``voyageai`` package. Install the ``voyageai``
      package, set up the API key, and use the
      ``voyageai.Client.contextualized_embed()`` function to vectorize
      your inputs.

      .. code-block:: python

         voyageai.Client.contextualized_embed(
             inputs: List[List[str]],
             model: str,
             input_type: Optional[str] = None,
             output_dimension: Optional[int] = None,
             output_dtype: Optional[str] = "float",
             chunk_fn: Optional[Callable[[str], List[str]]] = None
         )

      .. collapsible::
         :heading: Parameters
         :sub_heading: View the parameters for the contextualized_embed method.
         :expanded: false

         .. include:: /includes/tables/contextualized-chunk-embeddings-parameters.rst

      .. collapsible::
         :heading: Response
         :sub_heading: View the response for the contextualized_embed method.
         :expanded: false

         This method returns a ``ContextualizedEmbeddingsObject``, which contains the following attributes:

         .. include:: /includes/tables/contextualized-chunk-embeddings-returns.rst

      Example
      ~~~~~~~

      .. code-block:: python

         import voyageai

         vo = voyageai.Client()

         # Example input containing chunks from two documents
         inputs = [
             ["doc_1_chunk_1", "doc_1_chunk_2"],
             ["doc_2_chunk_1", "doc_2_chunk_2"]
         ]

         # Vectorize inputs with contextualized embeddings
         result = vo.contextualized_embed(inputs, model="voyage-context-3", input_type="document")

         # Access embeddings for each document
         for doc_result in result.results:
             for embedding in doc_result.embeddings:
                 print(embedding)

   .. selected-content::
      :selections: typescript

      You can access {+voyage+} contextualized chunk embeddings in
      JavaScript or TypeScript by sending HTTP requests using the Fetch API
      or other HTTP clients.

      Example
      ~~~~~~~

      .. code-block:: javascript

         const apiKey = process.env.VOYAGE_API_KEY;
         const url = "https://ai.mongodb.com/v1/contextualizedembeddings";

         const headers = {
             "Authorization": `Bearer ${apiKey}`,
             "Content-Type": "application/json"
         };

         const data = {
             inputs: [
                 ["doc_1_chunk_1", "doc_1_chunk_2"],
                 ["doc_2_chunk_1", "doc_2_chunk_2"]
             ],
             model: "voyage-context-3",
             input_type: "document"
         };

         const response = await fetch(url, {
             method: "POST",
             headers: headers,
             body: JSON.stringify(data)
         });

         const result = await response.json();

   .. selected-content::
      :selections: java

      You can access {+voyage+} contextualized chunk embeddings in Java
      by sending HTTP requests using the built-in ``HttpClient`` or other
      HTTP libraries.

      Example
      ~~~~~~~

      .. code-block:: java

         import java.net.URI;
         import java.net.http.HttpClient;
         import java.net.http.HttpRequest;
         import java.net.http.HttpResponse;

         String apiKey = System.getenv("VOYAGE_API_KEY");
         String url = "https://ai.mongodb.com/v1/contextualizedembeddings";

         String jsonBody = """
             {
                 "inputs": [
                     ["doc_1_chunk_1", "doc_1_chunk_2"],
                     ["doc_2_chunk_1", "doc_2_chunk_2"]
                 ],
                 "input_type": "document",
                 "model": "voyage-context-3"
             }
             """;

         HttpClient client = HttpClient.newHttpClient();
         HttpRequest request = HttpRequest.newBuilder()
             .uri(URI.create(url))
             .header("Authorization", "Bearer " + apiKey)
             .header("Content-Type", "application/json")
             .POST(HttpRequest.BodyPublishers.ofString(jsonBody))
             .build();

         HttpResponse<String> response = client.send(request,
             HttpResponse.BodyHandlers.ofString());
         System.out.println(response.body());

   .. selected-content::
      :selections: go

      You can access {+voyage+} contextualized chunk embeddings in Go
      by sending HTTP requests using the standard ``net/http`` package.

      Example
      ~~~~~~~

      .. code-block:: go

         package main

         import (
             "bytes"
             "encoding/json"
             "fmt"
             "io"
             "net/http"
             "os"
         )

         func main() {
             apiKey := os.Getenv("VOYAGE_API_KEY")
             url := "https://ai.mongodb.com/v1/contextualizedembeddings"

             // Example input containing chunks from two documents
             inputs := [][]string{
                 {"doc_1_chunk_1", "doc_1_chunk_2"},
                 {"doc_2_chunk_1", "doc_2_chunk_2"},
             }

             requestBody := map[string]interface{}{
                 "inputs":     inputs,
                 "input_type": "document",
                 "model":      "voyage-context-3",
             }

             jsonData, _ := json.Marshal(requestBody)

             req, _ := http.NewRequest("POST", url, bytes.NewBuffer(jsonData))
             req.Header.Set("Authorization", "Bearer "+apiKey)
             req.Header.Set("Content-Type", "application/json")

             client := &http.Client{}
             resp, _ := client.Do(req)
             defer resp.Body.Close()

             body, _ := io.ReadAll(resp.Body)
             fmt.Println(string(body))
         }

   .. selected-content::
      :selections: curl

      You can access {+voyage+} contextualized chunk embeddings by sending 
      a POST request using cURL to the endpoint 
      ``https://ai.mongodb.com/v1/contextualizedembeddings``. Please
      refer to the Contextualized Chunk Embeddings API Reference for
      the specification.

      Example
      ~~~~~~~

      .. code-block:: bash

         curl \
           --request POST 'https://ai.mongodb.com/v1/contextualizedembeddings' \
           --header "Authorization: Bearer $VOYAGE_API_KEY" \
           --header "Content-Type: application/json" \
           --data '{
             "inputs": [
               ["doc_1_chunk_1", "doc_1_chunk_2"],
               ["doc_2_chunk_1", "doc_2_chunk_2"]
             ],
             "input_type": "document",
             "model": "voyage-context-3"
           }'
