.. _api-update-one-endpoint:

==============================
Update One {+data-lake-short+} 
==============================

.. default-domain:: mongodb

.. meta::
   :keywords: |data-lake|

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

.. include:: /includes/fact-projects-groups-synonyms.rst

.. include:: /includes/api-requirements.rst

.. include:: /includes/api-base-url.rst

Use this endpoint to update a specific {+data-lake+} associated to an
|service| project. 

.. _api-update-one-endpoint-syntax:

Syntax
------

.. code-block:: none

   PATCH /groups/{GROUP-ID}/dataLakes/{NAME}

.. _api-update-one-endpoint-path-params:

Request Path Parameters
~~~~~~~~~~~~~~~~~~~~~~~

.. list-table::
   :header-rows: 1
   :widths: 15 10 75

   * - Path Element
     - Required/Optional
     - Description

   * - ``GROUP-ID``

     - Required.

     - The unique identifier for the :atlas:`project </api/#group-id>`.

   * - ``NAME``

     - Required

     - The name of the {+data-lake+} that you want to update.

       You can use the :doc:`/reference/api/dataLakes-get-all-tenants`
       endpoint to retrieve all {+data-lake+} associated to the
       project. The ``name`` field in the response of that endpoint
       corresponds to the ``NAME`` parameter.

.. _api-update-one-endpoint-query-params:

Request Query Parameters
~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/no-query-parameters.rst

.. _api-update-one-endpoint-body-params:

Request Body Parameters
~~~~~~~~~~~~~~~~~~~~~~~

.. list-table::
   :header-rows: 1
   :widths: 10 10 80

   * - Field
     - Required/Optional
     - Description

   * - ``cloudProviderConfig``
     - Optional
     - Configuration information related to the cloud service where 
       {+data-lake+} source data is stored. 
       
       Required if updating a {+data-lake-short+} in ``UNVERIFIED`` 
       state.

   * - ``cloudProviderConfig.<provider>``
     - Required
     - Name of the provider of the cloud service where {+data-lake-short+} 
       can access the S3 Bucket.

       {+data-lake+} supports only ``aws``.

       Required if specifying ``cloudProviderConfig``.

   * - ``cloudProviderConfig.aws.
       iamAssumedRoleARN``
     - Optional
     - .. note:: Deprecated 

          ``iamAssumedRoleARN`` is deprecated. Use ``roleId`` instead.
       
       Amazon Resource Name (ARN) of the role which
       {+data-lake+} uses for accessing the {+data-lake-stores+}. Use 
       the |service| :atlas:`UI </security/manage-iam-roles/>` or 
       :atlas:`API </reference/api/cloud-provider-access-get-roles/>` to 
       retrieve your list of configured |cpa| |aws| IAM Roles. You can 
       choose the ``iamAssumedRoleArn`` from the list of configured |cpa| 
       |aws| IAM Roles.
       
       The IAM Role must support the following actions against each
       S3 bucket:

       - ``s3:GetObject``
       - ``s3:ListBucket``
       - ``s3:GetObjectVersion``

       For more information on S3 actions, see
       `Actions, Resources, and Condition Keys for Amazon S3 
       <https://docs.aws.amazon.com/IAM/latest/UserGuide/list_amazons3.html>`_.

       Either ``iamAssumedRoleARN`` or ``roleId`` is required.

   * - ``cloudProviderConfig.aws.roleId``
     - Optional
     - Unique identifier of the role that {+dl+} can use for accessing the 
       {+data-lake-stores+}. If necessary, use the |service| :atlas:`UI 
       </security/manage-iam-roles/>` or :atlas:`API 
       </reference/api/cloud-provider-access-get-roles>` to retrieve the role 
       ID. 

       Either ``roleId`` or ``iamAssumedRoleARN`` is required.

   * - ``cloudProviderConfig.aws.
       testS3Bucket``
     - Required
     - Name of an S3 data bucket which 
       {+data-lake-short+} uses to validate the
       provided ``cloudProviderConfig.aws.
       iamAssumedRoleArn``.

       The provided ``iamAssumedRoleARN`` must grant read access
       to the S3 bucket for the |service| user ARN and external ID
       provided during 
       :doc:`tenant creation 
       </reference/api/dataLakes-create-one-tenant>`. Specifically, 
       the IAM Role must support the following actions against the
       S3 bucket:

       - ``s3:GetObject``
       - ``s3:ListBucket``
       - ``s3:GetObjectVersion``

       Required if specifying ``cloudProviderConfig``.

   * - ``dataProcessRegion``
     - Optional
     - The cloud provider region to which {+data-lake+} routes
       client connections for data processing.

       Set to ``null`` to direct {+data-lake+} to route client
       connections to the region nearest to the client
       based on DNS resolution.

   * - ``dataProcessRegion.cloudProvider``
     - Required
     - Name of the cloud service provider. 

       {+data-lake+} only supports ``AWS``.

       Required if specifying ``dataProcessRegion``.

   * - ``dataProcessRegion.region``
     - Required
     - Name of the region to which {+data-lake-short+} routes
       client connections for data processing.

       {+data-lake+} only supports the following regions:

       - ``SYDNEY_AUS`` (ap-southeast-2)
       - ``FRANKFURT_DEU`` (eu-central-1)
       - ``DUBLIN_IRL`` (eu-west-1)
       - ``LONDON_GBR`` (eu-west-2)
       - ``VIRGINIA_USA`` (us-east-1)
       - ``OREGON_USA`` (us-west-2)

       Required if specifying ``dataProcessRegion``.

.. _api-update-one-endpoint-response:

Response
--------

.. include:: /includes/fact-data-lake-api-response.rst

.. _api-update-one-endpoint-egs:

Example
-------

.. example:: Request

   .. code-block:: shell

      curl -u "username:apiKey" --digest \
       --header "Accept: application/json" \
       --header "Content-Type: application/json" \
       --request PATCH "https://cloud.mongodb.com/api/atlas/v1.0/groups/{GROUP-ID}/dataLakes/{NAME}?pretty=true"
       --data '{ 
         "cloudProviderConfig" : {
           "aws" : {
             "roleId" : "1a234bcd5e67f89a12b345c6",
             "testS3Bucket" : "user-metric-data-bucket"
           }
         },
         "dataProcessRegion" : {
           "cloudProvider" : "AWS",
           "region" : "OREGON_USA"
         }
       }'

The preceding request returns the following:

.. example:: Response

   .. code-block:: json
      :copyable: false

      {
        "cloudProviderConfig": {
          "aws": {
            "externalId": "12a3bc45-de6f-7890-12gh-3i45jklm6n7o",
            "iamAssumedRoleARN": "arn:aws:iam::123456789012:role/ReadS3BucketRole",
            "iamUserARN": "arn:aws:iam::1234567890123:root",
            "roleId": "1a234bcd5e67f89a12b345c6"
          }
        },
        "dataProcessRegion": {
          "cloudProvider" : "AWS",
          "region" : "OREGON_USA"
        },
        "groupId": "1ab23c4567def890gh12ij34",
        "hostnames": [
          "hardwaremetricdata.mongodb.example.net"
        ],
        "name": "UserMetricData",
        "state": "ACTIVE",
        "storage": {
          "databases": {},
          "stores": []
        }
      }
