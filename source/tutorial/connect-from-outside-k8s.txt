.. _connect-from-outside-k8s:

==============================================================
Connect to a MongoDB Database Resource from Outside Kubernetes
==============================================================

.. include:: /includes/styles/corrections.rst

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

The following procedure describes how to connect to a MongoDB resource
deployed by |k8s| from outside of the |k8s| cluster.

.. important::
   You can only connect to a :doc:`standalone
   </tutorial/deploy-standalone>` or a :doc:`sharded cluster
   </tutorial/deploy-sharded-cluster>` resource from outside of the
   |k8s| cluster.

Prerequisite
------------

For your databases to be accessed outside of |k8s|, they must run one
of the following versions of MongoDB:

- 3.6.17 or later
- 4.0.15 or later
- 4.2.3 or later

Procedure
---------

How you connect to a MongoDB resource that the |k8s-op-short| deployed
from outside of the |k8s| cluster depends on the resource.

.. tabs-deployments::

   .. tab::
      :tabid: standalone

      This procedure uses the following example:

      .. literalinclude:: /includes/code-examples/yaml-files/example-standalone.yaml
        :language: yaml
        :start-after: START-standalone-exposed-full
        :end-before: END-standalone-exposed-full
        :linenos:
        :lineno-start: 1
        :emphasize-lines: 15

      .. include:: /includes/steps/enable-external-standalone.rst

   .. tab::
      :tabid: repl

      .. important::

         This procedure explains the least complicated way to enable
         external connectivity. Other utilities can be used in
         production.

      This procedure uses the following example:

      .. literalinclude:: /includes/code-examples/yaml-files/example-replica-set.yaml
         :language: yaml
         :start-after: START-horizon-addcert-replset
         :end-before: END-horizon-addcert-replset
         :linenos:
         :lineno-start: 1
         :copyable: false
         :emphasize-lines: 16-22

      .. include:: /includes/steps/enable-split-horizon.rst

   .. tab::
      :tabid: shard

      .. tabs::

         .. tab:: Without TLS
            :tabid: k8s-without-tls

            .. literalinclude:: /includes/code-examples/yaml-files/example-sharded-cluster.yaml
               :language: yaml
               :start-after: START-exposed-sharded-upper
               :end-before: END-exposed-sharded-upper
               :linenos:
               :lineno-start: 1
               :copyable: false

            .. literalinclude:: /includes/code-examples/yaml-files/example-sharded-cluster.yaml
               :language: yaml
               :start-after: START-exposed-sharded-lower
               :end-before: END-exposed-sharded-lower
               :linenos:
               :lineno-start: 19
               :emphasize-lines: 1

         .. tab:: With TLS
            :tabid: k8s-with-tls

            .. literalinclude:: /includes/code-examples/yaml-files/example-sharded-cluster.yaml
               :language: yaml
               :start-after: START-exposed-sharded-upper
               :end-before: END-exposed-sharded-upper
               :linenos:
               :lineno-start: 1
               :copyable: false

            .. literalinclude:: /includes/code-examples/yaml-files/example-sharded-cluster.yaml
               :language: yaml
               :start-after: START-exposed-sharded-tls-lower
               :end-before: END-exposed-sharded-tls-lower
               :linenos:
               :lineno-start: 19
               :emphasize-lines: 1-6

      .. include:: /includes/steps/enable-external-sharded.rst
