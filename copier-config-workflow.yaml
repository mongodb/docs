# YAML configuration for the DevDocs GitHub Code Example Copier
# See documentation at https://github.com/mongodb/code-example-tooling/tree/main/examples-copier/docs

# Global defaults (apply to all workflows unless overridden)
defaults:
  commit_strategy:
    type: "pull_request"
    auto_merge: false
  deprecation_check:
    enabled: true
    file: "deprecated_examples.json"
  exclude:
    - "**/.env"
    - "**/.env.*"
    - "**/node_modules/**"
    - "**/__pycache__/**"

# ============================================================================
# WORKFLOWS
# ============================================================================
# Each workflow defines:
# - source: where files come from (repo + branch)
# - destination: where files go to (repo + branch - automatically batched into PRs)
# - transformations: how to copy/move files
# ============================================================================

workflows:
  # ==========================================================================
  # MongoDB Org: docs-sample-apps → sample app repos
  # ==========================================================================

  - name: "mflix-java"
    source:
      repo: "mongodb/docs-sample-apps"
      branch: "main"
    destination:
      repo: "mongodb/sample-app-java-mflix"
      branch: "main"
    transformations:
      - move: { from: "mflix/client", to: "client" }
      - move: { from: "mflix/server/java-spring", to: "server" }
      - copy: { from: "mflix/README-JAVA-SPRING.md", to: "README.md" }
      - copy: { from: "mflix/.gitignore-java", to: ".gitignore" }
    commit_strategy:
      type: "pull_request"
      pr_title: "Update MFlix client and Java server from docs-sample-apps"
      use_pr_template: true
      pr_body: |
        Automated update of MFlix Next.js client and Java Spring Boot server

        Source: ${source_repo}
        PR: #${pr_number}
        Commit: ${commit_sha}
      auto_merge: false

  - name: "mflix-nodejs"
    source:
      repo: "mongodb/docs-sample-apps"
      branch: "main"
    destination:
      repo: "mongodb/sample-app-nodejs-mflix"
      branch: "main"
    transformations:
      - move: { from: "mflix/client", to: "client" }
      - move: { from: "mflix/server/js-express", to: "server" }
      - copy: { from: "mflix/README-JAVASCRIPT-EXPRESS.md", to: "README.md" }
      - copy: { from: "mflix/.gitignore-js", to: ".gitignore" }
    commit_strategy:
      type: "pull_request"
      pr_title: "Update MFlix client and Express server from docs-sample-apps"
      use_pr_template: true
      pr_body: |
        Automated update of MFlix Next.js client and Express.js server

        Source: ${source_repo}
        PR: #${pr_number}
        Commit: ${commit_sha}
      auto_merge: false
    exclude:
      - "\\.gitignore$"
      - "README.md$"

  - name: "mflix-python"
    source:
      repo: "mongodb/docs-sample-apps"
      branch: "main"
    destination:
      repo: "mongodb/sample-app-python-mflix"
      branch: "main"
    transformations:
      - move: { from: "mflix/client", to: "client" }
      - move: { from: "mflix/server/python-fastapi", to: "server" }
      - copy: { from: "mflix/README-PYTHON-FASTAPI.md", to: "README.md" }
      - copy: { from: "mflix/.gitignore-python", to: ".gitignore" }
    commit_strategy:
      type: "pull_request"
      pr_title: "Update MFlix client and Python server from docs-sample-apps"
      use_pr_template: true
      pr_body: |
        Automated update of MFlix Next.js client and Python FastAPI server

        Source: ${source_repo}
        PR: #${pr_number}
        Commit: ${commit_sha}
      auto_merge: false
    exclude:
      - "\\.gitignore$"
      - "README.md$"

  # ==========================================================================
  # 10gen Org: Atlas SDK Go examples → Artifact repo
  # ==========================================================================

  - name: "atlas-sdk-go-project-examples"
    source:
      repo: "10gen/docs-mongodb-internal"
      branch: "main"
    destination:
      repo: "mongodb/atlas-architecture-go-sdk"
      branch: "main"
    transformations:
      - glob:
          pattern: "content/code-examples/tested/go/atlas-sdk/project-copy/**/*"
          transform: "${relative_path}"
    commit_strategy:
      type: "pull_request"
      pr_title: "Update Atlas SDK Go examples from ${source_repo} PR ${pr_number}"
      pr_body: |
        Automated update of Atlas SDK Go project examples

        **Source Details:**
        - Repository: ${source_repo}
        - Branch: ${source_branch}
        - Source PR: #${pr_number}
        - Commit: ${commit_sha}

        **Changes:**
        - Files updated: ${file_count}
      auto_merge: false

  # ==========================================================================
  # TEST: cbullinger Org: aggregation-tasks → sample app repos
  # ==========================================================================

  - name: "test-mflix-java"
    source:
      repo: "cbullinger/aggregation-tasks"
      branch: "main"
    destination:
      repo: "cbullinger/sample-app-java-mflix"
      branch: "main"
    transformations:
      - move: { from: "mflix/client", to: "client" }
      - move: { from: "mflix/server/java-spring", to: "server" }
      - copy: { from: "mflix/README-JAVA-SPRING.md", to: "README.md" }
      - copy: { from: "mflix/.gitignore-java", to: ".gitignore" }
    commit_strategy:
      type: "pull_request"
      pr_title: "Update MFlix client and Java server from docs-sample-apps"
      use_pr_template: true
      pr_body: |
        Automated update of MFlix Next.js client and Java Spring Boot server

        Source: ${source_repo}
        PR: #${pr_number}
        Commit: ${commit_sha}
      auto_merge: false
    exclude:
      - "\\.gitignore$"
      - "README.md$"

  - name: "test-mflix-nodejs"
    source:
      repo: "cbullinger/aggregation-tasks"
      branch: "main"
    destination:
      repo: "cbullinger/sample-app-nodejs-mflix"
      branch: "main"
    transformations:
      - move: { from: "mflix/client", to: "client" }
      - move: { from: "mflix/server/js-express", to: "server" }
      - copy: { from: "mflix/README-JAVASCRIPT-EXPRESS.md", to: "README.md" }
      - copy: { from: "mflix/.gitignore-js", to: ".gitignore" }
    commit_strategy:
      type: "pull_request"
      pr_title: "Update MFlix client and Express server from docs-sample-apps"
      use_pr_template: true
      pr_body: |
        Automated update of MFlix Next.js client and Express.js server

        Source: ${source_repo}
        PR: #${pr_number}
        Commit: ${commit_sha}
      auto_merge: false
    exclude:
      - "\\.gitignore$"
      - "README.md$"

  - name: "test-mflix-python"
    source:
      repo: "cbullinger/aggregation-tasks"
      branch: "main"
    destination:
      repo: "cbullinger/sample-app-python-mflix"
      branch: "main"
    transformations:
      - move: { from: "mflix/client", to: "client" }
      - move: { from: "mflix/server/python-fastapi", to: "server" }
      - copy: { from: "mflix/README-PYTHON-FASTAPI.md", to: "README.md" }
      - copy: { from: "mflix/.gitignore-python", to: ".gitignore" }
    commit_strategy:
      type: "pull_request"
      pr_title: "Update MFlix client and Python server from docs-sample-apps"
      use_pr_template: true
      pr_body: |
        Automated update of MFlix Next.js client and Python FastAPI server

        Source: ${source_repo}
        PR: #${pr_number}
        Commit: ${commit_sha}
      auto_merge: false
    exclude:
      - "\\.gitignore$"
      - "README.md$"
