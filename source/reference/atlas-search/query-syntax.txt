.. _query-syntax-ref:

=========================
$search (aggregation)
=========================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

Definition
----------

.. pipeline:: $search

   |fts| queries take the form of an
   :manual:`aggregation pipeline stage </aggregation>`. The
   :pipeline:`$search` stage performs a full-text search on the
   specified field or fields which must be covered by an |fts| index.

   A ``$search`` pipeline stage has the following prototype form:

   .. code-block:: javascript

      {
        $search: {
          <operator>: {
            <specification(s)>
          }
        }
      }

Behavior
--------

``$search`` must be the first stage of any pipeline it appears in.
``$search`` cannot be used in:

- a :manual:`view definition</core/views>`
- a :pipeline:`$lookup subpipeline <$lookup>`
- a :pipeline:`$facet` pipeline stage

.. _fts-operators:

The ``$search`` stage has the following operators:

.. list-table::
   :header-rows: 1
   :stub-columns: 1
   :widths: 15 85

   * - Operator
     - Description

   * - :ref:`autocomplete <autocomplete-ref>`
     - Performs a search-as-you-type query from an incomplete input
       string.

   * - :ref:`compound <compound-ref>`
     - Combines other operators into a single query.

   * - :ref:`exists <exists-ref>`
     - Tests for the presence of a specified field.

   * - :ref:`geoWithin <geowithin-ref>`
     - Finds search matches within specified geographic points.

   * - :ref:`geoShape <geoshape-ref>`
     - Finds search matches for specified geo shapes.

   * - :ref:`near <near-ref>`
     - Finds search matches near a specified number or date.

   * - :ref:`phrase <phrase-ref>`
     - Analyzed search.

   * - :ref:`range <range-ref>`
     - Finds search matches within a specific numeric or date range.

   * - :ref:`regex <regex-ref>`
     - Interprets the ``query`` field as a regular expression.

   * - :ref:`span <span-ref>`
     - Finds text search matches within specified regions of a text
       field.

   * - :ref:`text <text-ref>`
     - Analyzed search.

   * - :ref:`term <term-ref>`
     - Unanalyzed search.

   * - :ref:`wildcard <wildcard-ref>`
     - Finds search matches using special characters in the query
       string that can match any character.

.. class:: hidden

   .. toctree::
      :titlesonly:

      /reference/atlas-search/autocomplete
      /reference/atlas-search/compound
      /reference/atlas-search/exists
      /reference/atlas-search/geoShape
      /reference/atlas-search/geoWithin
      /reference/atlas-search/near
      /reference/atlas-search/phrase
      /reference/atlas-search/queryString
      /reference/atlas-search/range
      /reference/atlas-search/regex
      /reference/atlas-search/span
      /reference/atlas-search/term
      /reference/atlas-search/text
      /reference/atlas-search/wildcard
      /reference/atlas-search/deprecated
      /reference/atlas-search/path-construction
