.. _mcli-atlas-performanceadvisor-slowQueryLogs-cmd:

=================================================
mongocli atlas performanceAdvisor slowQueryLogs
=================================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. include:: /includes/styles/corrections.rst

The ``performanceAdvisor slowQueryLogs`` command 
retrieves a list of log lines for slow queries. You can also analyze slow queries through the |service| :atlas:`UI </analyze-slow-queries/>` or :atlas:`API </reference/api/pa-get-slow-query-logs/>`.

Syntax 
------

.. code-block:: text 

   mongocli atlas performanceadvisor slowQueryLog|s ls
          --processName <host-name>
        [ --since <unix-epoch-timestamp> ]
        [ --duration <milliseconds> ]
        [ --nLogs <max-log-lines> ]
        [ --namespace <namespaces> ]
        [ --projectId <project-ID> ]

.. include:: /includes/fact-command-line-help.rst

.. _atlas-performanceadvisor-slowQueryLogs-options:

Options 
-------

.. list-table::
   :widths: 20 10 60 10
   :header-rows: 1

   * - Option 
     - Type
     - Description
     - Required?

   * - ``--processName``
     - string 
     - The unique identifier of the host of a MongoDB process in the 
       following format: ``{hostname}:{port}``.
     - yes

   * - ``--since``
     - integer
     - Point in time, specified as a |epoch-time-ms|, from which you 
       want to retrieve results.
     - no

   * - ``--duration``
     - string 
     - Length of time from the ``since`` parameter, in milliseconds, 
       for which you want to retrieve results.
     - no

   * - ``--nLogs``
     - integer
     - Maximum number of log lines to return. Defaults to 20000.
     - no

   * - ``--namespace``
     - string
     - Namespace from which to retrieve slow query logs. A namespace consists of the database and collection resource separated by a ``.``, such as ``<database>.<collection>``.
     - no

   * - ``--projectId``
     - string
     - Unique identifier of the project that contains the host 
       for which you want to retrieve slow-running queries. If omitted, uses the project ID in the profile or :ref:`environment variable
       <mcli-env-var>`.
     - no

.. note::

   If ``since`` is indicated and ``duration`` is omitted, the response contains results from the since point up to the present time.

   If ``duration`` is indicated and ``since`` is omitted, the response contains results from duration ms ago through the present time.

   If both ``since`` and ``duration`` are omitted, the response contains results from the previous 24 hours up through the present time.

.. _atlas-performanceadvisor-slowQueryLogs-output:

Output
------

If the command succeeds, it returns the following output in the default
format. If the command returns errors, see
:ref:`Troubleshooting <troubleshooting>` for recommended solutions.

.. code-block:: sh
   :copyable: false

   NAMESPACE                          LINE
   <database>.<collection>            log line

.. include:: /includes/fact-default-output.rst

- :atlas:`Atlas API </reference/api/pa-get-slow-query-logs/>`

Example
-------

.. tabs::

   .. tab:: Default Output
      :tabid: default-output

      The following command retrieves the namespaces for collections 
      experiencing slow queries for a project using the 
      {+default-profile+}, which contains credentials to access the 
      project and the project ID. The output is returned in the default 
      format.

      .. code-block:: sh

         mongocli atlas performanceAdvisor slowQueryLogs ls --processName atlas-111ggi-shard-00-00.111xx.mongodb.net:27017

      The previous command prints the following to the terminal.

      .. code-block:: sh
         :copyable: false

         NAMESPACE   LINE
         myDB.users  "2018-08-16T22:53:43.447+0000 I COMMAND  [conn10614] command myDb.users appName: \"MongoDB Shell\" command: find { find: \"users\", filter: { emails: \"tocde@fijoow.to\" }, lsid: { id: UUID(\"832b4b0e-085a-480e-b470-16a0994dc7cb\") }, $clusterTime: { clusterTime: Timestamp(1534460016, 1)..."
         myDB.users  "2018-08-16T22:54:32.705+0000 I COMMAND  [conn10614] command myDb.users appName: \"MongoDB Shell\" command: find { find: \"users\", filter: { emails: \"la@sa.kp\" }, lsid: { id: UUID(\"832b4b0e-085a-480e-b470-16a0994dc7cb\") }, $clusterTime: { clusterTime: Timestamp(1534460056, 1), ..."
         
   .. tab:: JSON Output
      :tabid: json-output

      The following command retrieves the namespaces for collections 
      experiencing slow queries for a project using the 
      {+default-profile+}, which contains credentials to access the 
      project and the project ID. The output is returned in |json| 
      format.

      .. code-block:: sh

         mongocli atlas performanceAdvisor slowQueryLogs ls --processName atlas-111ggi-shard-00-00.111xx.mongodb.net:27017 --output json

      The previous command prints the following to the terminal in
      |json| format.

      .. code-block:: json
         :copyable: false

         {
           "slowQueries": [
             {
               "line" : "2018-08-16T22:53:43.447+0000 I COMMAND  [conn10614] command myDb.users appName: \"MongoDB Shell\" command: find { find: \"users\", filter: { emails: \"tocde@fijoow.to\" }, lsid: { id: UUID(\"832b4b0e-085a-480e-b470-16a0994dc7cb\") }, $clusterTime: { clusterTime: Timestamp(1534460016, 1)...",
               "namespace": "myDB.users"
             },
             {
               "line": "2018-08-16T22:54:32.705+0000 I COMMAND  [conn10614] command myDb.users appName: \"MongoDB Shell\" command: find { find: \"users\", filter: { emails: \"la@sa.kp\" }, lsid: { id: UUID(\"832b4b0e-085a-480e-b470-16a0994dc7cb\") }, $clusterTime: { clusterTime: Timestamp(1534460056, 1), ...",
               "namespace": "myDB.users"
             }
           ]
         }
