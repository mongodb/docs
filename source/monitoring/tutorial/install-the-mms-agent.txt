==========================================
Install the Monitoring Agent on UNIX/Linux
==========================================

.. contents::
   :local:
   :backlinks: none


.. index:: requirements; full
.. _mms-requirements:

.. only:: html

   Consider the following screencast of the MMS Agent installation process.

   .. raw:: html

      <iframe width="420" height="315" src="//www.youtube.com/embed/5qdK0F1f4jw" frameborder="0" allowfullscreen></iframe>

.. only:: latex

   Consider the `screencast of the MMS Agent installation process
   <http://www.youtube.com/watch?v=5qdK0F1f4jw>`_.

Process
-------

1. Install Monitoring agent :ref:`requirements <requirements-agent-linux>`. 
   
   - ``setuptools`` to install Python packages.
   - ``pymongo``, the Python driver for MongoDB that the agent depends
     upon.

2. :ref:`Download and install the Monitoring agent <download-monitoring-agent-linux>`.
   
3. :ref:`Start the Monitoring agent <start-mms-agent-linux>`

4. :doc:`Configure hosts in MMS </monitoring/tutorial/monitor-hosts-with-mms>`.   

.. _requirements-agent-linux:
   
Requirements
------------

.. start-requirements-content

|monitoring| has a series of prerequisite requirements. The following
sections will guide you through the requirements and provide basic
instructions for fulfilling them.

Basic |monitoring| Requirements
```````````````````````````````

To install the |monitoring| agent, your system must satisfy the
following requirements.

- All MongoDB instances (i.e. ``mongod`` and ``mongos``) must be
  version 1.6 or newer.

.. index:: requirements; Python
.. index:: requirements; setuptools

- You must have Python 2.4 or greater and install Python's
  `setuptools <http://pypi.python.org/pypi/setuptools>`_, which you
  will use to install the remaining dependencies.

  .. note::

     The Monitoring agent does not provide support the PyPy implementation
     of Python, and does not support the Python 3.x series of Python.

  Most operating systems provide packages for ``setuptools``.

  .. example::

     Debian and Ubuntu users can use the following command to
     install the package:

     .. code-block:: sh

        sudo apt-get install python-setuptools

     Red Hat Enterprise Linux (RHEL) CentOS, or Fedora users can use
     the following command to install the package:

     .. code-block:: sh

        sudo yum install python-setuptools

.. index:: requirements; PyMongo Installation

- All users must install `PyMongo  <http://pypi.python.org/pypi/pymongo/>`_,
  the Python driver for MongoDB.

  .. tip::

     For optimal speed and stability, use the most recent version of
     PyMongo. The agent is not compatible with versions of PyMongo
     before 1.9. For instructions for installing PyMongo, see
     :doc:`Installing PyMongo </monitoring/tutorial/install-pymongo>`.

.. index:: troubleshooting; proxies

.. important:: Users whose datacenter requires that they proxy
   outbound connections through a gateway have additional
   requirements. See ":ref:`Working with Proxies
   <troubleshooting-proxies>`" for more information.

The ``README`` file distributed with the agent provides more
information. When all dependencies are successfully installed, you may
proceed to installing the agent.

Additional Requirements for Python 2.4
``````````````````````````````````````

.. index:: hmac
   single: requirements; Python 2.4 Installation

If your system is running Python 2.4, you will need to install the
``hmac`` and ``hashlib`` Python modules. You can do so using
``easy_install`` as in the following:

.. code-block:: sh

   sudo easy_install hmac hashlib

.. important::

   Do not use ``pip`` to install modules when using Python 2.4 or 2.5,
   as there are some compatibility issues. Some users have reported
   problems installing ``hmac``, if ``easy_install`` produces an error
   or you suspect a problem with these libraries see
   :ref:`instructions for installing hmac manually
   <troubleshooting-hmac>`.

.. end-requirements-content

.. index:: installation; UNIX/Linux

Install Monitoring Agent Software
---------------------------------

.. _download-monitoring-agent-linux:

.. start-install-content

Download the Monitoring Agent
`````````````````````````````

.. include:: /includes/install-saas-registration.rst

If you have not downloaded the Monitoring agent already, you can click
the "Settings" link immediately after you sign into MMS, and then
select :guilabel:`Monitoring Agent` from the left-hand list to
download an up-to-date agent specifically configured for your account.

You can run the agent on any system that can connect to the MongoDB
instances you want to monitor. As long as it can connect to each
instance, you may use a single agent to do all the monitoring. Do be
sure that the agent can make outgoing connections via HTTPS on port
``443``.

.. note::

   The Monitoring agent has some resource requirements and should run
   on a separate system to avoid impacting ``mongod`` or ``mongos``
   performance. To monitor five or fewer nodes, you can safely deploy
   on an AWS "micro instance".  Running PyMongo with the native
   extensions, which requires GCC, provides significant performance
   improvements.

.. _start-mms-agent-linux:

Start the Monitoring Agent
``````````````````````````

Unzip the archive and then run the agent with the following command:

.. code-block:: sh

   python agent.py

This starts two processes: a parent to monitor the agent daemon and
perform automatic upgrades and a child process to collect data.

.. warning:: If your MongoDB instance has thousands of databases or
   collections, you should disable database statistics
   collection. See ":ref:`Database and Collection statistics
   <db-stats-warning>`" for more information.

.. end-install-content

.. _automated-agent-installation:

Automate Agent Deployments
--------------------------

The agent you downloaded from the |mms| site is automatically
configured with the credentials for your account. You can download a
configured copy of the Monitoring agent by copying the link available
in the "Group Settings" section of the "Settings" tab of the MMS
console. This link will resemble the following: ::

      https://mms.mongodb.com/settings/mmsAgent/<hash>/mms-monitoring-agent-<group-name>.zip

Alternately, you may automate Monitoring agent deployments using an
unconfigured agent, and the API and secret keys from the "API Key" and
"Secret Key" sections of the settings page. The unconfigured agent is
available at the following URL: ::

      https://mms.mongodb.com/settings/mms-monitoring-agent.zip

Unzip this archive and edit the ``settings.py`` file. Replace the
strings "``@API_KEY@``" and "``@SECRET_KEY@``" with the "API" and
"Secret Keys" defined for your account. You can find these
in the "Settings" page of the MMS console.

You may embed this process in your existing deployment scripts to
automatically install or redeploy new agents.

>>>>>>> 16dd1a8... DOCS-1911: updating filenames 10gen-mms -> mongodb-mms
Next Steps
----------

Now that you have installed the Monitoring agent software, you can
:doc:`deploy the Monitoring agent in production
</monitoring/tutorial/deploy-mms-in-production>`.
