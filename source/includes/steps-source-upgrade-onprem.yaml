title: "Take a full backup of the |onprem| backing databases before beginning the upgrade procedure."
stepnum: 0
level: 4
ref: backup
---
title: "Stop all existing |onprem| and Backup Daemon services."
stepnum: 0
level: 4
ref: shutdown
action:
  - pre: |
      To shut down the |onprem| Application, issue the following:
    language: sh
    code: |
      sudo service mongodb-mms stop
  - pre: |
      To shut down the Backup Daemon, issue the following:
    language: sh
    code: |
      sudo service mongodb-mms-backup-daemon stop
---
title: "On each Backup Daemon server, back up the configuration file and then uninstall the Backup Daemon package."
stepnum: 0
level: 4
ref: uninstall-daemon
content: |
  Do the following on **every server** where the Backup Daemon is installed:

  a. Create a backup copy of each ``conf-daemon.properties`` file to preserve the existing configuration.

  b. Uninstall the Backup Daemon package.

# ---
# Download step: Each upgrade procedure borrows this step from the OS-appropriate install procedure.
# ---
# Install step: Each upgrade procedure has its own step.
---
title: "Start |onprem| on every server."
stepnum: 0
level: 4
ref: start
content: |
  Issue the following command:
action:
  language: sh
  code: |
    sudo service mongodb-mms start
---
title: "Log into |onprem| as a user with the Global Owner role."
stepnum: 0
level: 4
ref: log-in-as-global-owner
content: |
  |onprem| displays a setup wizard for entering the |onprem| configuration in
  the Application Database.
---
title: "Enter the |onprem| configuration in Application Database."
stepnum: 0
level: 4
ref: configuration
content: |
  The setup wizard walks you through several pages for entering the
  configuration in the Application Database. Refer to your backed-up
  ``conf-mms.properties`` and ``conf-daemon.properties`` files as needed. For
  information on which fields in the properties files correspond to which
  fields on the page, see :doc:`/reference/configuration`.

  **Make sure you click** :guilabel:`Save` **on each tab**, even if you do not
  make any changes.
---
title: "Back up the old ``conf-mms.properties`` files on each server."
stepnum: 0
level: 4
ref: back-up-old-conf-file
content: |
  On servers where there had been an existing |onprem| Application installation,
  back up the old ``conf-mms.properties`` file by either renaming it (for example,
  ``conf-mms.properties.old``) or moving it to a different directory, or both.
  You will use information from the old file in the next step.
---
title: "Copy the connection string to the new properties file and rename the new file if necessary."
stepnum: 0
level: 4
ref: replace-old-conf-file
content: |
  The connection string is found in the :setting:`mongo.mongoUri` field. Copy
  the string from the backed-up ``conf-mms.properties`` file to the new file.
  On servers where there was only a Backup Daemon, copy the connection string
  from another server's backed-up ``conf-mms.properties`` file.

  If the new file is not currently named ``conf-mms.properties``, rename it to
  ``conf-mms.properties``.
---
title: "Restart all |onprem| services."
stepnum: 0
level: 4
ref: restart-ops-manager
---
title: "For any Backup Agents that were installed manually, update their configurations to use port 8080."
stepnum: 0
level: 4
ref: backup-agent-configuration
content: |
  Beginning with |onprem| 2.0, Backup Agents access |onprem| through port
  8080. The Automation Agent automatically updates the ports on managed Backup
  Agents. For any Backup Agents that were installed **manually**, you must
  edit the agent's :doc:`configuration file </reference/backup-agent>` and set
  the ``mothership`` property to access |onprem| on port 8080.
...
