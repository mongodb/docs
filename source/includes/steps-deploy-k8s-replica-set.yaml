---
title: "Create a resource definition for your replica set."
stepnum: 1
level: 4
ref: create-custom-resource
content: |

  a. Copy one of the following resource definition examples based on
     the scope of your service broker instance.

     If you registered the {+osb+} instance as a :ref:`cluster-scoped
     <osb-scope-cluster>` ``ClusterServiceBroker``, select
     Cluster-scoped Instance. If you registered the {+osb+} instance as
     a :ref:`namespace-scoped <osb-scope-namespace>` ``ServiceBroker``,
     select Namespace-scoped Instance.

     |

     .. tabs::

        .. tab:: Cluster-scoped Instance
           :tabid: clusterServiceBroker

           Copy the following |yaml| file, which you can modify to meet
           your desired configuration:

           .. literalinclude:: /reference/k8s/example-clusterServiceBroker-replica-set-minimal.yaml
              :language: yaml
              :emphasize-lines: 4-5,7-8,12

        .. tab:: Namespace-scoped Instance
           :tabid: serviceBroker

           Copy the following |yaml| file, which you can modify to meet
           your desired configuration:

           .. literalinclude:: /reference/k8s/example-serviceBroker-replica-set-minimal.yaml
              :language: yaml
              :emphasize-lines: 4-5,7-8,12

  #. Open your preferred text editor and paste the resource
     definition into a new text file.
---
title: "Configure the required settings."
stepnum: 2
level: 4
ref: configure-required-settings
content: |

  The highlighted settings are required to deploy a replica set:

  .. tabs::

     .. tab:: Cluster-scoped Instance
        :tabid: clusterServiceBroker

        .. list-table::
           :widths: 20 40 20
           :header-rows: 1

           * - Key
             - Description
             - Example

           * - ``metadata.name``
             - The name of the cluster in |k8s|. |service| randomly generates
               a corresponding replica set name.
             - ``my-atlas-cluster``

           * - ``metadata.namespace``
             - The |k8s| |k8s-ns| where this cluster is created.
             - ``atlas``

           * - ``spec.clusterServiceClassExternalName``
             - The |k8s| class which corresponds to your |service| cloud
               service provider.

               View the available classes by invoking the
               following command:

               .. code-block:: sh

                  svcat marketplace -n <NAMESPACE>

               The class names are listed in the ``CLASS`` column of the
               command output.

               .. note::

                  You must use the ``mongodb-atlas-tenant`` class to
                  deploy ``M2`` or ``M5`` replica sets. The value you
                  specify for the ``spec.regionName`` setting determines
                  which cloud provider the cluster is deployed to.

             - ``mongodb-atlas-aws``

           * - ``spec.clusterServicePlanExternalName``
             - The |k8s| service plan which corresponds to the desired
               |service| instance size.

               View the available plans by invoking the
               following command:

               .. code-block:: sh

                  svcat marketplace -n <NAMESPACE>

               The plan names are listed in the ``PLANS`` column of the
               command output.

             - ``M10``

           * - ``spec.regionName``
             - The |service| region where the replica set is created.

               .. important::

                  Make sure you use the |service| region name for the desired
                  region, not the cloud provider region name. If you
                  deploy ``M2`` or ``M5`` clusters, make sure the region
                  you select supports these cluster sizes.

               For a list of available regions, see the |service|
               documentation for your cloud service provider:

               - :atlas:`Amazon Web Services (AWS) <reference/amazon-aws>`
               - :atlas:`Google Cloud Platform (GCP)
                 <reference/google-gcp>`
               - :atlas:`Microsoft Azure <reference/microsoft-azure>`

             - ``EU_CENTRAL_1``

     .. tab:: Namespace-scoped Instance
        :tabid: serviceBroker

        .. list-table::
           :widths: 20 40 20
           :header-rows: 1

           * - Key
             - Description
             - Example

           * - ``metadata.name``
             - The name of the cluster in |k8s|. |service| randomly generates
               a corresponding replica set name.
             - ``my-atlas-cluster``

           * - ``metadata.namespace``
             - The |k8s| |k8s-ns| where this cluster is created.
             - ``atlas``

           * - ``spec.serviceClassExternalName``
             - The |k8s| class which corresponds to your |service| cloud
               service provider.

               View the available classes by invoking the
               following command:

               .. code-block:: sh

                  svcat marketplace -n <NAMESPACE>

               The class names are listed in the ``CLASS`` column of the
               command output.

               .. note::

                  You must use the ``mongodb-atlas-tenant`` class to
                  deploy ``M2`` or ``M5`` replica sets. The value you
                  specify for the ``spec.regionName`` setting determines
                  which cloud provider the cluster is deployed to.          

             - ``mongodb-atlas-aws``

           * - ``spec.servicePlanExternalName``
             - The |k8s| service plan which corresponds to the desired
               |service| instance size.

               View the available plans by invoking the
               following command:

               .. code-block:: sh

                  svcat marketplace -n <NAMESPACE>

               The plan names are listed in the ``PLANS`` column of the
               command output.

             - ``M10``

           * - ``spec.regionName``
             - The |service| region where the replica set is created.

               .. important::

                  Make sure you use the |service| region name for the desired
                  region, not the cloud provider region name. If you
                  deploy ``M2`` or ``M5`` clusters, make sure the region
                  you select supports these cluster sizes.

               For a list of available regions, see the |service|
               documentation for your cloud service provider:

               - :atlas:`Amazon Web Services (AWS) <reference/amazon-aws>`
               - :atlas:`Google Cloud Platform (GCP)
                 <reference/google-gcp>`
               - :atlas:`Microsoft Azure <reference/microsoft-azure>`

             - ``EU_CENTRAL_1``

---
title: "(Optional) Configure any additional settings for a replica set deployment."
stepnum: 3
level: 4
ref: add-additional-settings
content: |

  You can specify additional cluster settings under the
  ``spec.parameters.cluster`` key. These settings correspond to the
  :atlas:`request body parameters
  <reference/api/clusters-create-one/#request-body-parameters>` of
  the :atlas:`Create a Cluster <reference/api/clusters-create-one>`
  Public API method.

  .. important::

     The following |api| parameters are overwritten by the required
     {+osb+} settings from the previous step and should not be
     specified:

     - ``providerSettings.instanceSizeName``
     - ``providerSettings.providerName``
     - ``name``

  .. tabs::

     .. tab:: Cluster-scoped Instance
        :tabid: clusterServiceBroker

        .. example::

           This example resource definition creates a cluster called
           ``my-atlas-cluster`` in the ``atlas`` namespace that has the
           following configuration:

           - Managed by a cluster-scoped (``ClusterServiceBroker``) {+osb+}
           - AWS as a cloud service provider
           - An instance size of ``M10``
           - Located in the EU (Frankfurt) region
           - Auto-scaling disabled
           - |service| continuous backups enabled

           .. code-block:: yaml

              apiVersion: servicecatalog.k8s.io/v1beta1
              kind: ServiceInstance
              metadata:
                name: my-atlas-cluster
                namespace: atlas
              spec:
                clusterServiceClassExternalName: mongodb-atlas-aws
                clusterServicePlanExternalName: M10
                parameters:
                  cluster:
                    providerSettings:
                      regionName: EU_CENTRAL_1
                    autoscaling:
                      diskGBEnabled: false
                    backupEnabled: true

     .. tab:: Namespace-scoped Instance
        :tabid: serviceBroker

        .. example::

           This example resource definition creates a cluster called
           ``my-atlas-cluster`` in the ``atlas`` namespace that has the
           following configuration:

           - Managed by a namespace-scoped (``ServiceBroker``) {+osb+}
           - AWS as a cloud service provider
           - An instance size of ``M10``
           - Located in the EU (Frankfurt) region
           - Auto-scaling disabled
           - |service| continuous backups enabled

           .. code-block:: yaml

              apiVersion: servicecatalog.k8s.io/v1beta1
              kind: ServiceInstance
              metadata:
                name: my-atlas-cluster
                namespace: atlas
              spec:
                serviceClassExternalName: mongodb-atlas-aws
                servicePlanExternalName: M10
                parameters:
                  cluster:
                    providerSettings:
                      regionName: EU_CENTRAL_1
                    autoscaling:
                      diskGBEnabled: false
                    backupEnabled: true

---
title: "Save the file as ``replica-set.yaml``."
stepnum: 4
level: 4
ref: save-resource-definition

---
title: "Deploy the replica set."
stepnum: 5
level: 4
ref: deploy-replica-set
content: |

   Invoke the following |k8s| command to create your
   :term:`replica set`:

   .. code-block:: sh

      kubectl apply -f replica-set.yaml

---
title: "Track the status of your replica set deployment."
stepnum: 6
level: 4
ref: track-k8s-deployment
content: |

  To view the status of your deployment, pass the ``metadata.name``
  from ``replica-set.yaml`` into the following command:

  .. code-block:: sh

     svcat describe instance <METADATA.NAME> -n <NAMESPACE>

  As the replica set is being deployed, the command returns the
  following status:

  .. code-block:: sh
     :copyable: false

     Provisioning - The instance is being provisioned asynchronously

  Once the replica set deploys successfully, the command returns the
  following status:

  .. code-block:: sh
     :copyable: false

     Ready - The instance was provisioned successfully

...
