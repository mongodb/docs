========================================
Add Monitoring Agent User for MONGODB-CR
========================================

.. default-domain:: mongodb

|mms| Monitoring Agent can use the MongoDB Challenge-Response
(``MONGODB-CR``) to authenticate to hosts that enforce access control.

To authenticate using ``MONGODB-CR``, create a user in the ``admin``
database with the appropriate roles in MongoDB.

Prerequisites
-------------

.. include:: /includes/fact-auth-monitoring-requirements.rst

MongoDB 2.6
-----------

To monitor MongoDB 2.6 instances, create a user in the ``admin``
database with an operation that resembles the following:

.. code-block:: javascript

   use admin
   db.createUser(
      {
        user: "<username>",
        pwd: "<password>",
        roles: [ { role: "clusterMonitor", db: "admin" } ]
      }
   )

See :ref:`Access Control for MongoDB 2.6 <access-control-monitoring-agent-2.6>` for more
information on the required access.

MongoDB 2.4
-----------

To monitor MongoDB 2.4 instances, create a user in the ``admin``
database with an operation that resembles the following:

.. code-block:: javascript

   use admin
   db.addUser( 
      {
        user: "<username>",
        pwd: "<password>",
        roles: [ 
           "clusterAdmin",
           "readAnyDatabase"
        ]
      }
   )

See :ref:`Access Control for MongoDB 2.4 without Profiling
<access-control-2.4-no-profiling>` for more information on the required
access.

Monitor with Database Profiling
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

To monitor MongoDB 2.4 databases with database profiling, create a user
in the ``admin`` database with an operation that resembles the
following:

.. code-block:: javascript

   use admin
   db.addUser(
      {
        user: "<username>",
        pwd: "<password>",
        roles: [
           "clusterAdmin",
           "readAnyDatabase",
           "dbAdminAnyDatabase"
        ]
       }
   )

See :ref:`Access Control for MongoDB 2.4 with Profiling
<access-control-2.4-with-profiling>` for more information on the
required access.

Monitor without ``dbStats``
~~~~~~~~~~~~~~~~~~~~~~~~~~~

To monitor MongoDB 2.4 instance *without* :dbcommand:`dbStats`, create
a user in the ``admin`` database with an operation that resembles the
following:

.. code-block:: javascript

   use admin
   db.addUser(
      {
        user: "<username>",
        pwd: "<password>",
        roles: [ "clusterAdmin" ]
      }
   )

See :ref:`Access Control for MongoDB 2.4 without dbStats
<access-control-2.4-no-dbStats>` for more information on the
required access.

Host Settings
-------------

.. include:: /includes/fact-access-control-host-settings.rst

