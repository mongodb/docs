stepnum: 1
source:
  file: steps-source-admin-navigation.yaml
  ref:  admin-backup-snapshot
---
title: "Go to the row for the blockstore you want to edit."
stepnum: 2
level: 4
ref: select-blockstore
---
title: "In the :guilabel:`MongoDB Connection` column, edit the necessary fields:"
stepnum: 3
level: 4
ref: edit-blockstore
content: |

   .. list-table::
      :widths: 30 70
      :header-rows: 1

      * - Field
        - Contents

      * - :guilabel:`Name`
        - Type the name for the S3 blockstore.
        
      * - :guilabel:`AWS Access Key`
        - Type your AWS Access Key ID.
        
      * - :guilabel:`AWS Secret Key`
        - Type your AWS Secret Access Key.

          .. note:: The existing Secret Access Key is not displayed.
        
      * - :guilabel:`<hostname>:<port>`

        - Type in one or more hosts in the ``<hostname:port>`` format
          that comprise the S3 blockstore metadata database.

          - If the S3 blockstore metadata database is a Replica Set or
            Sharded Cluster, type a comma-separated list of
            :program:`mongod` instances (for a Replica Set) or
            :program:`mongos` instances (for a Sharded Cluster).

            .. example::

               .. code-block:: sh

                  host1.example.com:27017,
                  host2.example.com:27017,
                  host2.example.com:27018

          - If the S3 blockstore metadata database is a standalone
            MongoDB instance, type the ``hostname:port`` of the
            instance.
        
      * - :guilabel:`MongoDB Auth Username` (optional) 

        - If the S3 blockstore metadata database uses Username and Password
          (SCRAM-SHA-1) authentication, type the name of the user authorized
          to access the S3 blockstore metadata database.

          S3 Blockstore databases only support Username and Password
          (SCRAM-SHA-1) authentication.

          To enable Username and Password (SCRAM-SHA-1) authentication on your
          S3 blockstore metadata database, see :manual:`how to configure your
          database for SCRAM-SHA-1 authentication </core/security-scram-sha-1>` 
          in the MongoDB manual.
        
      * - :guilabel:`MongoDB Auth Password` (optional) 

        - If the database uses Username and Password (SCRAM-SHA-1)
          authentication, type the password associated with the username that
          can access the S3 blockstore metadata database.
        
          .. note:: The existing :guilabel:`MongoDB Auth Password` is not displayed.

      * - :guilabel:`Encrypted Credentials` (optional)

        - Select if the Username and Password for the database were encrypted
          using the ``credentialstool``. For details on the
          ``credentialstool``, see :ref:`encrypt-mongodb-user-credentials`.
        
      * - :guilabel:`Use TLS/SSL` (optional)

        - Select if the S3 blockstore metadata database only accepts connection
          encrypted using TLS.

          To enable TLS on the S3 blockstore metadata database, see 
          :manual:`Configure mongod and mongos for TLS/SSL </tutorial/configure-ssl>`.
        
      * - :guilabel:`Connection Options` (optional) 

        - Type any additional :manual:`configuration file options 
          </reference/configuration-options>` for the MongoDB instance. 
          This field supports unescaped values only.

          For proper syntax, see :manual:`Connection String URI
          Format </reference/connection-string>` in the MongoDB manual.
        
      * - :guilabel:`Assignment Labels` (Optional)

        - Type a comma-separated list of labels to assign the
          S3 blockstores to specific groups.

      * - :guilabel:`Load Factor` (Optional)

        - Type what proportion of backup work you want this snapshot
          store to handle. Backup work includes running backups,
          restoring snapshots or :term:`grooming <groom>` blockstores.
          The proportion of backup work assigned to a single snapshot
          store is called its *Load Factor*.

          .. important::
             Only set a :guilabel:`Load Factor` if you are managing the
             backups for a sharded cluster across more than one
             snapshot store. If you do not have more than one snapshot
             store, skip this setting.

          :guilabel:`Load Factor` must be any positive integer,
          including ``0``. By default, |mms| assigns each snapshot 
          store a :guilabel:`Load Factor` of ``1``. This means the
          backup workload would be split evenly among all snapshot
          stores.

          When one snapshot store's :guilabel:`Load Factor` is set to
          ``0``, all  jobs or tasks running on that snapshot store are
          allowed to finish. All future backup work is re-distributed
          among the remaining snapshot stores.

          Snapshot stores with greater compute or storage performance
          should be given a greater :guilabel:`Load Factor`:

          - A file system store with 16-cores and 128 GB of RAM can
            back up more databases in less time than a file system
            store with only 2 cores and 8 GB of RAM.

          - A blockstore backed by a 10-node sharded cluster can back
            up more databases and groom more databases than a
            blockstore backed by a single replica set.

          .. example:: **How the Load Factor affects backup work**

             Consider a sharded cluster with five shards with the
             following backup storage configuration:
             
             - File system store (``F``) manages the backup work for
               one shard in the cluster. ``F`` is running on a single
               two-core physical server.

             - Blockstore (``B``) manages the backup work for four shards in the cluster. ``B`` is running as a four-node sharded cluster on four physical servers with two cores on each server.

             ``B`` has four times the amount of storage and computing
             power than ``F``. With this difference in capability,
             ``B`` should get a Load Factor of ``4``. ``F`` should get
             a Load Factor of ``1``.


      * - :guilabel:`Write Concern`

        - Select your preferred :manual:`Write Concern</core/write-concern/>`:

          - Default
          - Journaled
          - Acknowledged
          - Replica Acknowledged
          - Majority

---
title: "Select the checkbox in the :guilabel:`Assignment Enabled` column."
stepnum: 4
level: 4
ref: assign-s3-blockstores
content: |

  Select if you want to assign backup jobs to this blockstore immediately
  after it has been created. By default, the blockstore can be assigned backup
  jobs. If you clear this checkbox, the blockstore is created but you cannot
  assign backups to the blockstore.

---
title: "Click :guilabel:`Save`."
stepnum: 5
level: 4
ref: save-s3-blockstore-changes
--- 
title: "If any Connection String values are changed, restart all the |onprem| instances, including those running activated Backup Daemons. (Optional)"
stepnum: 6 
level: 4
ref: restart-s3-blockstore-after-edits
content: |
  .. warning::
     If you change any of the connection string values (:guilabel:`MongoDB
     Host List`, :guilabel:`MongoDB Hostname`, :guilabel:`MongoDB Port`,
     :guilabel:`Username`, :guilabel:`Password`, :guilabel:`Connection
     Options` and/or :guilabel:`Use TLS/SSL`), you must restart all the
     |onprem| instances, including those running activated Backup Daemons,
     for the changes to take effect.

     .. seealso::
     
        For more details on the MongoDB connection string uri, see
        :manual:`Connection String URI Format </reference/connection-string>`
        in the MongoDB Manual.
...