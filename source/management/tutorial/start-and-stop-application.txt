==============================
Start and Stop MMS Application
==============================

.. default-domain:: mongodb

Start the On-Prem MMS Server
----------------------------

.. note::

   If you installed from a ``tar.gz`` or ``zip`` archive, you must create
   a symlink located at the path ``/etc/init.d/mongodb-mms`` that points
   to the ``<install_dir>/bin/mongodb-mms``.

After configuring your |monitoring| deployment, you can start the MMS
server with this command:

.. code-block:: sh

   sudo /etc/init.d/mongodb-mms start

In some situations, starting MongoDB *may* take several minutes to pre-allocate
the journal files. This is normal behavior.

You can now use the |monitoring| instance by visiting the URL specified
in the ``mms.centralUrl`` parameter (e.g. http://mms.example.com:8080)
to continue configuration:

Unlike the SaaS version of MMS, |monitoring| stores user accounts in the
local MongoDB instance. When you sign
into the |monitoring| instance for the first time, the system will
prompt you to register and create a new "group" for your deployment.

After completing the registration process, you will arrive at the "MMS
Hosts," page.

Because there are no Monitoring agents attached to your account, the
first page you see in |monitoring| will provide instructions for
downloading the Monitoring agent. Click the "download agent" link to
download a pre-configured agent for your account. Continue reading this
document for installation and configuration instructions for the MMS
agent.

Stop the On-Prem MMS Server
---------------------------

Enter the following command:

.. code-block:: sh

   sudo /etc/init.d/mongodb-mms stop

Startup Log File Output
-----------------------

The On-Prem MMS server logs its output to a ``logs`` directory inside
the installation directory. You can view this log information with the
following command:

.. code-block:: sh

   sudo less <install_dir>/logs/mms0.log

If the server starts successfully, you will see content in this file
that resembles the following:

.. code-block:: none

   [main] INFO  ServerMain:202 - Starting mms...
   [main] WARN  AbstractConnector:294 - Acceptors should be <=2*availableProcessors: SelectChannelConnector@0.0.0.0:0
   [null] LoginService=HashLoginService identityService=org.eclipse.jetty.security.DefaultIdentityService@1eb3319f
   [main] INFO  AppConfig:46 - Starting app for env: hosted
   [main] INFO  MmsAppConfig:67 - Not loading backup components
   [main] INFO  GraphiteSvcImpl:67 - Graphite service not configured, events will be ignored.
   [main] INFO  TwilioSvcImpl:48 - Twilio service not configured, SMS events will be ignored.
   [main] INFO  OpenDMKSnmpTrapAgentSvcImpl:91 - SNMP heartbeats hosts not configured, no heartbeat traps will be sent.
   [main] INFO  ServerMain:266 - Started mms in: 24979 (ms)

Optional: Run as Different User
-------------------------------

#. Edit ``<install_dir>/conf/mms.conf``:

   .. code-block:: ini

      MMS_USER=foo_user

#. Change Ownership of ``<install_dir>`` for new user: ::

    sudo chown -R foo_user:foo_group <install_dir>

#. Restart MMS server:

   .. code-block:: sh

      sudo <install_dir>/bin/mongodb-mms restart

Optional: MMS Application Server Port Number
--------------------------------------------

#. Edit ``<install_dir>/conf/conf-mms.properties``:

   .. code-block:: ini

      mms.centralUrl=http://mms.acmewidgets.com:<newport>

#. Edit ``<install_dir>/conf/mms.conf``

   .. code-block:: ini

      BASE_PORT=<newport>

#. Restart MMS server:

   .. code-block:: sh

      sudo <install_dir>/bin/mongodb-mms restart
