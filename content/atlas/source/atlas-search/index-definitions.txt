.. _ref-index-definitions:

===============
Index Reference
===============

.. default-domain:: mongodb

.. meta:: 
   :description: Learn the JSON syntax to include one or more analyzers, field mappings, or synonyms in your MongoDB Search index.

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 3
   :class: singlecol

A |fts| index is a data structure that maps documents from your {+cluster+} 
to the terms that are extracted from those documents.
|fts| indexes enable efficient full-text searches of your database. 

When you define a |fts| index, you can use :ref:`static or dynamic
mappings <fts-field-mappings>` to specify which fields or field types
you want to index in your collection. You can also use :ref:`analyzers
<analyzers-ref>` to define how |fts| extracts searchable tokens from
``string`` fields or query strings. Finally, you can apply additional
configuration options in your index definition to improve the
performance and accuracy of your |fts| query, including options to
:ref:`store source fields in your index <fts-stored-source-definition>`,
or :ref:`define synonym mappings <fts-field-mappings>`. 

To learn how to define a |fts| index according to your query
requirements, see :ref:`ref-create-index`. Once you define your |fts|
index, you can add the index to your {+cluster+} with the :ref:`Create
a {+fts+} Index <create-fts-index>` tutorial. To learn how to view,
edit, update, or delete your |fts| index, see :ref:`fts-manage-indexes`. 

This page describes the |json| syntax and definition options for a |fts| index. 

.. _index-definition-syntax:

Syntax 
------

.. tabs:: 

   .. tab:: Basic 
      :tabid: basic

      .. literalinclude:: /includes/fts/syntax/fts-index-definition-syntax-basic.json 
         :language: json
         :linenos:
         :copyable: false

   .. tab:: Expanded 
      :tabid: expanded 

      .. literalinclude:: /includes/fts/syntax/fts-index-definition-syntax-advanced.json
         :language: json
         :linenos:
         :copyable: false

.. _index-definition-options:

Options 
-------

.. list-table::
   :header-rows: 1
   :widths: 20 15 15 50

   * - Field
     - Type
     - Necessity
     - Description

   * - ``analyzer``
     - String 
     - Optional 
     - Specifies the :ref:`analyzer <analyzers-ref>` to apply to 
       string fields when indexing. 
       
       If you set this only at the top and 
       do not specify an analyzer for the fields in the index 
       definition, |fts| applies this analyzer to all the fields. To 
       use a different analyzer for each field, you must specify a 
       different analyzer for the field. 
       
       If omitted, defaults to 
       :ref:`ref-standard-analyzer`.

   * - ``analyzers``
     - Array of :ref:`custom-analyzers` 
     - Optional 
     - Specifies the :ref:`custom-analyzers` to use in this index.

   * - ``mappings``
     - Object
     - Required
     - Specifies how to index fields at different paths for this 
       index.

   * - | ``mappings.``
       | ``dynamic``
     - Boolean or Object
     - Optional
     - Enables dynamic mapping of field types or configures fields
       individually for this index. 

       Value must be one of the following: 

       - boolean - set to ``true`` to recursively index all indexable
         field types or set to ``false`` to not dynamically index any of
         the indexable field types. 
       - object - specify the ``typeSet`` to use for recursively
         indexing all indexable field types. To learn more, see
         ``mappings.dynamic.typeSet``. 
     
       If omitted, defaults to ``false``. If set to ``false``, you must
       define the individual fields to statically index using
       ``mappings.fields``. 
       
       You can also configure fields individually to override default
       settings using ``mappings.fields``. Settings for fields in
       ``mappings.fields`` override default settings.

       .. include:: /includes/fts/facts/dynamic-flag-considerations.rst

       To learn about the field types that you can enable for dynamic
       mappings, see :ref:`bson-data-types`.
       
       For example index configurations, see :ref:`index-config-example`

   * - | ``mappings.``
       | ``dynamic.``
       | ``typeSet``
     - String
     - Optional
     - References the name of the ``typeSets`` object that contains the
       list of field types to automatically and recursively index. 
       
       Mutually exclusive with ``mappings.dynamic`` boolean flag.

   * - | ``mappings.``
       | ``fields``
     - Object
     - Conditional
     - Specifies the fields that you want to index. Required only
       if dynamic mapping is ``false``. 
       
       .. include:: /includes/fts/facts/fact-fts-field-name-restriction.rst
       
       To learn more, see :ref:`fts-field-mappings`. 
      
   * - ``searchAnalyzer``
     - String 
     - Optional
     - Specifies the :ref:`analyzer <analyzers-ref>` to apply to query 
       text before searching with it. 
       
       If omitted, defaults to the
       analyzer that you specify for the ``analyzer`` option. If you 
       omit both the ``searchAnalyzer`` and the ``analyzer`` options, 
       defaults to the :ref:`ref-standard-analyzer`.

   * - ``numPartitions``
     - Integer
     - Optional
     - Specifies the number of sub-indexes to create if the document count 
       exceeds two billion. The following values are valid: ``1``,
       ``2``, ``4``. If omitted, defaults to ``1``. 

       To use index partitions, you must have search nodes deployed in
       your cluster. 

   * - ``storedSource`` 
     - Boolean or :ref:`Stored Source Definition  
       <fts-stored-source-definition>` 
     - Optional 
     - Specifies fields in the documents to store for query-time 
       look-ups using the :ref:`returnedStoredSource 
       <fts-return-stored-source-option>` option. You can store fields 
       of all :ref:`bson-data-chart` on |fts|. Value can be one of 
       the following:

       - ``true``, to store all fields  
       - ``false``, to not store any fields 
       - :ref:`Object <fts-stored-source-document>` that specifies 
         the fields to ``include`` or ``exclude`` from storage
       
       .. include:: /includes/fts/facts/fact-fts-stored-source-mdb-version.rst

       If omitted, defaults to ``false``. 
       
       To learn more, see :ref:`fts-stored-source-definition`.


   * - ``synonyms`` 
     - Array of :ref:`Synonym Mapping Definition <synonyms-ref>`
     - Optional 
     - Specifies the synonym mappings to use in your index. 

       .. include:: /includes/fts/facts/fact-fts-synonym-mapping-limitation.rst 
        
       To learn more, see :ref:`synonyms-ref`.

   * - ``typeSets`` 
     - Array of objects
     - Optional 
     - Specifies the :ref:`typeSets <fts-configure-dynamic-mappings>` to
       use in this index for dynamic mappings.

   * - | ``typeSets.``
       | ``[n].name`` 
     - String
     - Required 
     - Specifies the name of the ``typeSet`` configuration.  

   * - | ``typeSets.``
       | ``[n].types`` 
     - Array of objects
     - Required 
     - Specifies the field types, one per object, to index automatically
       using dynamic mappings. 

   * - | ``typeSets.``
       | ``[n].types.``
       | ``[n].type`` 
     - String
     - Required 
     - Specifies the field type to automatically index. To
       learn more about the field types that you can configure for
       dynamic mapping, see :ref:`fts-configure-dynamic-mappings`. 

.. _fts-troubleshoot-indexes: 

Troubleshoot Indexes
--------------------

.. _troubleshoot-mongot-process:

``mongot`` Process Not Installed or Running
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The following error is returned if you run ``$search`` queries when 
the |fts| ``mongot`` process isn't installed or running:

.. code-block:: shell 
   :copyable: false 

   MongoError: Remote error from mongot :: caused by :: Error connecting to localhost:28000.

The ``mongot`` process is installed only when the first |fts| index is 
defined. If you don't have any |fts| index in your cluster, 
create at least one |fts| index to resolve this error.

Learn More
----------

To learn how to define a {+fts+} index to meet your {+fts+} query needs, see :ref:`ref-create-index`. 

To learn how to add an index to your {+cluster+}, see :ref:`Create a {+fts+} Index <create-fts-index>`.  

To learn more about the available index configuration options, see the following reference pages: 

- :ref:`analyzers-ref`
- :ref:`fts-field-mappings` 
- :ref:`fts-stored-source-definition`
- :ref:`synonyms-ref`

.. toctree::
   :titlesonly:

   Analyzers </atlas-search/analyzers>
   Field Mappings </atlas-search/define-field-mappings>
   Stored Source </atlas-search/stored-source-definition>
   Synonym Mappings </atlas-search/synonyms>
   Index Partitions </atlas-search/index-partition>
