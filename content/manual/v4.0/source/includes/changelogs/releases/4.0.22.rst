.. _4.0.22-changelog:

4.0.22 Changelog
----------------

Sharding
~~~~~~~~

- :issue:`SERVER-36739` Use the mongos_manual_intervention_action hook in concurrency stepdown suites
- :issue:`SERVER-41192` Add a metric for the size of the SessionCatalog under `logicalSessionRecordCache`
- :issue:`SERVER-42632` Disable pinger threads that reach out to config server to make integration tests pass
- :issue:`SERVER-46393` Always check client last operation time when computing operationTime to append to the response
- :issue:`SERVER-48679` flushRoutingTableCacheUpdates should block on critical section with kWrite, not kRead
- :issue:`SERVER-51808` invariant failure: readConcern level != Available
- :issue:`SERVER-51885` Blacklist balancing_sessions_collection.js from sharding_csrs_continuous_config_stepdown
- :issue:`SERVER-52955` KeysCollectionClientDirect should check if majority read concern is supported by storage engine

Replication
~~~~~~~~~~~

- :issue:`SERVER-33747` Arbiter tries to start data replication if cannot find itself in config after restart
- :issue:`SERVER-50116` Forbid oplog writes when replication is enabled
- :issue:`SERVER-51262` Rename skipCheckingForNotMasterInCommandDispatch to skipCheckingForHelloInCommandDispatch
- :issue:`SERVER-51598` Add new test suites that test transaction expiration logic
- :issue:`SERVER-51887` "InvalidNamespace" in oplog tests on 4.0 branch
- :issue:`SERVER-52560` oplog_writes_only_permitted_on_standalone.js must wait for insert to be in stable checkpoint
- :issue:`SERVER-52680` Removed node on startup stuck in STARTUP2 after being re-added into the replica set
- :issue:`SERVER-53026` Secondary cannot restart replication

Query
~~~~~

:issue:`SERVER-32960` $mod has inconsistent rounding/truncation behavior

Aggregation
~~~~~~~~~~~

:issue:`SERVER-48523` Unconditionally check the first entry in the oplog when attempting to resume a change stream

Storage
~~~~~~~

- :issue:`SERVER-51858` Investigate queryable issue on 4.0.20
- :issue:`SERVER-52902` Remove assertion !haveJournalFiles() at dur_journal.cpp:265

Operations
~~~~~~~~~~

- :issue:`SERVER-46729` Make Windows shell soft-fail for unavailable OCSP responder
- :issue:`SERVER-51757` Collect /proc/vmstat numa_pages_migrated statistics in FTDC

Build and Packaging
~~~~~~~~~~~~~~~~~~~

:issue:`SERVER-52891` Run PPC builds less frequently

Internals
~~~~~~~~~

- :issue:`SERVER-45624` Pre-split and distribute chunks of sessions collection
- :issue:`SERVER-45992` InMemory engine startupwarnings confusing
- :issue:`SERVER-48742` Log whenever profiler settings are changed via setProfilingLevel
- :issue:`SERVER-49165` endSessions command in Client.Disconnect causes an authorization failure for an unauthed connection on a host that requires authentication
- :issue:`SERVER-50123` Record number of physical cores on all platforms
- :issue:`SERVER-50267` Set output limit for 'rawMongoProgramOutput()'
- :issue:`SERVER-50365` Stuck with long-running transactions that can't be timed out
- :issue:`SERVER-50445` Return the value as double when NumberLong subtraction overflows in ExpressionSubtract
- :issue:`SERVER-50605` Add {logMessage: "msg"} test-only command
- :issue:`SERVER-51303` Lookup stage followed by $match on type uses wrong field in matching condition 
- :issue:`SERVER-51607` Upgrade Twisted dependency to at least twisted-19.7.0
- :issue:`SERVER-51902` Check if storage engine supports Recover to Stable Timestamp rather than if eMRC=false in sync_tail.cpp 
- :issue:`SERVER-52646` Validate and possibly fix edge cases in regex rewrite rules for userToDNMapping
- :issue:`SERVER-52654` new signing keys not generated by the monitoring-keys-for-HMAC thread
- :issue:`SERVER-52806` deb install files assume systemd
- :issue:`SERVER-52969` Disable Powercyle on non-master branches
- :issue:`SERVER-53233` Fix change_streams_update_lookup_shard_metadata_missing.js [4.2, 4.0]
- :issue:`SERVER-53348` Pin PyOpenSSL
- :issue:`WT-6507` Exit cache eviction worker after our operation has timed out
- :issue:`WT-6602` Allow operation timeout ms to be passed to commit and rollback
- :issue:`WT-6666` Start op timer when we configure it in rollback and commit 

