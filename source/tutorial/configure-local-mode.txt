====================================================
Configure Deployment to Have Limited Internet Access
====================================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. |company| replace:: MongoDB, Inc.

In a default configuration, the Automation Agents and Backup Daemons
access MongoDB binaries over the internet from |company|

If your environment prevents granting all hosts in your managed MongoDB deployment access to the internet, you have two options:

1. Configure Backup Daemons and managed MongoDB hosts to download
   installers only from |onprem|. The installers need to uploaded to
   |onprem| separately.

2. Configure |onprem| to download installers from the internet. Backup
   Daemons and managed MongoDB hosts can then download installers from
   |onprem|.

.. tabs::

   tabs:
    - id: local
      name: All Hosts Use Local Downloads
      content: |

        To manage MongoDB hosts and run |onprem| without internet
        access, you must specify that:

        - :guilabel:`Agents get the installers from:`
          :guilabel:`Ops Manager Application Server`, and

        - :guilabel:`Ops Manager gets installers from:`
          :guilabel:`Ops Manager Application Server Hard Drive`.

        Neither the MongoDB hosts with Automation Agents nor |onprem|
        hosts with Backup Daemons can download and then install or
        upgrade MongoDB deployments until you:

        - Download the MongoDB installer binaries for each edition,
          version, and platform you need to support from another
          internet-connected device.
        - Load the MongoDB installer binaries to each |onprem| host.
        - Update the :term:`version manifest`.

        The following tutorial outlines the steps to run |onprem|
        without internet access.

    - id: hybrid
      name: Only Managed MongoDB Hosts Use Local Downloads
      content: |

        To manage MongoDB hosts without internet access, you must specify that:

        - :guilabel:`Agents get the installers from:` the
          :guilabel:`Ops Manager Application Server`, and

        - :guilabel:`Ops Manager gets installers from:` a
          :guilabel:`Direct connection to MongoDB`.

        |onprem| hosts download
        MongoDB installer binaries from the internet. MongoDB hosts
        with Automation Agents download these installers from the
        |onprem| hosts and then install or upgrade MongoDB deployments.

        The following tutorial outlines the steps to run |onprem| with
        internet access when MongoDB hosts do not.

Considerations
--------------

MongoDB Community for Windows with SSL Incompatibility
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The MongoDB Community Edition for Microsoft Windows with SSL support
is incompatible with :guilabel:`Local Mode`.

Prerequisites
-------------

Install Enterprise Dependencies (MongoDB Enterprise Only)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

If you plan on running :term:`MongoDB Enterprise` on Linux servers,
then you must manually install a set of dependencies to each server
**before installing MongoDB**. The MongoDB manual provides the
appropriate command to install the dependencies. See the link for the
server's platform:

.. include:: /includes/list-links-per-os-for-enterprise-dependencies.rst

.. tabs::

   hidden: true

   tabs:
    - id: local
      name: All Hosts Use Local Downloads
      content: |

        Required User Role to Change Mode
        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

        To configure internet access for |onprem| and its agents, you
        must have :ref:`Global Owner <global-owner-role>` access to
        |onprem|.

        .. _local-mode-determine-versions:

        Determine which Binaries to Store Locally and Download
        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

        Download the binaries associated to each MongoDB version you
        want to support in your |onprem|\-managed deployments:

        - To import existing deployments into |onprem|, you need
          versions of the binaries that correspond to these
          deployments.

        - To create via |onprem| Automation new deployments, you need
          versions of the binaries that correspond to these
          deployments.

        - To upgrade existing deployment to a new version via
          |onprem|, you need both the current version, upgrade
          version, and versions used in intermediary step or steps.

          .. example::

             If you import an existing deployment of MongoDB 2.6
             Community and want to upgrade it to MongoDB 3.0
             Enterprise, you must download and store all archived
             binaries for:

             - MongoDB 2.6 Community Edition
             - MongoDB 3.0 Community Edition
             - MongoDB 3.0 Enterprise Edition

        You do not need to download the archived MongoDB binary for
        every platform, only the one(s) in your current and planned
        MongoDB deployments.

    - id: hybrid
      name: Only Managed MongoDB Hosts Use Local Downloads
      content: |

        Required User Role to Change Mode
        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

        To configure internet access for |onprem| and its agents, you
        must have :ref:`Global Owner <global-owner-role>` access to
        |onprem|.

.. tabs::

   hidden: true

   tabs:
    - id: local
      name: All Hosts Use Local Downloads
      content: |

        .. _config-local-mode:

        Remove Internet Access from |onprem| and Automation Agents
        ----------------------------------------------------------

        .. include:: /includes/steps/configure-local-mode.rst

    - id: hybrid
      name: Only Managed MongoDB Hosts Use Local Downloads
      content: |

        .. _config-hybrid-mode:

        Remove Internet Access from Automation Agents
        ---------------------------------------------

        .. include:: /includes/steps/configure-hybrid-mode.rst

.. class:: hidden

   .. toctree::
      :titlesonly:

      /tutorial/resolve-pre-flight-check.txt
