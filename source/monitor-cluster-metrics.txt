=================
Monitor a Cluster
=================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

|service| collects and displays metrics for your servers, databases, and
MongoDB processes. |service| displays three charts in the :guilabel:`Clusters`
view and additional charts in the :guilabel:`Metrics` view.

Metrics Displayed in the Clusters View
--------------------------------------

The :guilabel:`Clusters` view displays charts that monitor your disk usage,
IOPS, and database operations. If the collected metrics indicate you need to
add capacity to your cluster, see :doc:`/scale-cluster`.

From the :guilabel:`Clusters` view you can see the following:

.. list-table::
   :widths: 35 65
   :header-rows: 1

   * - Chart

     - Data

   * - :guilabel:`Disk Usage`

     - The total bytes of used disk space for the cluster.
       For a :term:`replica set`, the chart displays disk
       use on the server that hosts the :term:`primary`. For a :term:`sharded
       cluster`, the chart displays the sum of disk usage on all servers that
       host a primary. The top line of the chart shows the maximum storage
       capacity on the server or servers.

       To view disk use on a specific server in the cluster, click the
       server's name, then click the :guilabel:`Hardware` tab, and then locate
       the :guilabel:`Disk Space Used` chart.

   * - :guilabel:`Disk IOPS`

     - The input/output operations per second (IOPS) for the cluster. Each
       point on the chart is the sum of read IOPS and write IOPS.

       For a replica set, the chart shows IOPS for the primary. For a sharded
       cluster, the chart shows the sum of the IOPS on all primaries in the
       sharded cluster. The top line of the chart shows the maximum IOPS
       configured for the server or servers.

       To view IOPS for a specific server in the cluster, click the server's
       name, then click the :guilabel:`Hardware` tab, and then locate the
       :guilabel:`Disk IOPS` chart.

   * - :guilabel:`Operations`

     - The aggregated read and write operations for the cluster's databases.
       The ``Read`` line aggregates all ``query`` and ``getMore`` operations.
       The ``Write`` line aggregates ``update``, ``delete``, and ``insert``
       operations.

       For a replica set, the chart shows operations for the primary. For a
       sharded cluster, the chart shows the sum of the operations on all
       primaries in the sharded cluster.

       To view a specific operation by server, click the server's name to open
       the server's metrics. Click the :guilabel:`Status` tab. Select the
       :guilabel:`Display Opcounters on Separate Charts` checkbox to display
       operations on separate charts. Deselect the checkbox to display
       operations on a single :guilabel:`Opcounters` charts.

View All Metrics
----------------

To view metrics, locate the cluster on the :guilabel:`Clusters` tab and click
:guilabel:`Metrics`.

To add or remove charts, click either the :guilabel:`Display` or
:guilabel:`Add Chart` drop-down list, depending on which is available. To
display chart controls, hover the mouse pointer over the chart. To view
metrics at a different level of the cluster topology, use the breadcrumb.

For more information on chart metrics, see the following on this page:

- :ref:`metrics-sharded-clusters`

- :ref:`metrics-replica-sets`

- :ref:`metrics-status-tab`

- :ref:`metrics-hardware-tab`

- :ref:`metrics-db-stats-tab`

- :ref:`metrics-chart-controls`

.. _metrics-sharded-clusters:

Sharded Cluster Metrics
~~~~~~~~~~~~~~~~~~~~~~~

When you view metrics for a :term:`sharded cluster`, you choose to display
either :term:`shards <shard>`, :term:`mongos instances <mongos>`, or
:term:`config servers <config server>`. When displaying shards, you can use
the buttons below the chart to select primaries, secondaries, or both.
|service| displays different processes as different lines.

To sum or average the data, click the :guilabel:`Display Data` drop-down list
and select the desired option. To change charts, click the :guilabel:`Display`
drop-down list.

.. _metrics-replica-sets:

Replica Set Metrics
~~~~~~~~~~~~~~~~~~~

When you view metrics for a replica set, you can limit the display to
particular member types using the :term:`P <primary>`, :term:`S <secondary>`,
and :term:`A <arbiter>` options.

.. _metrics-status-tab:

Status Tab
~~~~~~~~~~

This tab displays the process metrics |service| collects from the selected
:program:`mongod <bin.mongod>` or :program:`mongos <bin.mongos>` process. |service| collects a subset of
the output of the MongoDB ``serverStatus`` command. See :manual:`serverStatus
</reference/command/serverStatus>` in the MongoDB manual.

.. _metrics-hardware-tab:

Hardware Tab
~~~~~~~~~~~~

|service| collects the following hardware metrics for your :program:`mongod`
and :program:`mongos <bin.mongos>` processes:

.. list-table::
   :widths: 35 65
   :header-rows: 1

   * - Chart

     - Data

   * - System CPU

     - The CPU usage of all processes (not just MongoDB processes) on the host
       partition. For partitions with more than 1 CPU core, this value can exceed 100%.

   * - Normalized System CPU

     - The CPU usage of all processes (not just MongoDB processes) on the host
       partition, scaled to a range of 0-100% by dividing by the number of CPU cores.

   * - Process CPU

     - The CPU usage of the MongoDB process. For partitions with more than 1 CPU
       core, this value can exceed 100%.

   * - Normalized Process CPU

     - The CPU usage of the MongoDB process, scaled to a range of 0-100% by
       dividing by the number of CPU cores.

   * - Disk Space Free

     - The total bytes of free disk space on the disk partition used by
       MongoDB.

   * - Util %

     - The percentage of time during which requests are being issued to and
       serviced by the partition. This includes requests from any process, not
       just MongoDB processes.

   * - Disk IOPS

     - The throughput of I/O operations per second for the disk partition used by MongoDB.

   * - Disk Space Percent Free

     - The percent of free disk space on the partition used by MongoDB.

   * - Disk Latency

     - The latency in milliseconds of the partition used by MongoDB.

   * - Disk Space Used

     - The total bytes of used disk space on the partition that runs MongoDB.

.. _metrics-db-stats-tab:

DB Stats Tab
~~~~~~~~~~~~

This tab displays database metrics |service| collects through the MongoDB
``dbStats`` command. |service| collects a subset of ``dbStats`` output. See
:manual:`dbStats </reference/command/dbStats>` in the MongoDB manual.

|service| retrieves database metrics every 20 minutes by default but adjusts
frequency when necessary to reduce the impact on
database performance. If the collection of database statistics still affects
performance, you can disable collection by clicking :guilabel:`Settings`, then
:guilabel:`Group Settings`, and then setting :guilabel:`Collect Database
Specific Statistics` to ``No``.

To select which database to display, click the :guilabel:`Select Database`
drop-down list.

.. _metrics-chart-controls:

Chart Controls
~~~~~~~~~~~~~~

When viewing charts, you can do the following:

.. list-table::
   :widths: 35 65
   :header-rows: 1

   * - Task

     - Action

   * - View a chart's description.

     - Click the :guilabel:`i` icon next to the chart name. (Not available for
       cluster-level chart)

   * - Expand a chart.

     - Click the two-way arrow at the top right of the chart.

   * - Zoom in on a period of time.

     - Click and drag the mouse pointer over a portion of the chart. To reset,
       double-click the chart.

       .. note::

          When you zoom, the time selections above the charts automatically
          update to reflect the new period displayed.

   * - View point-in-time statistics.

     - Hover the mouse pointer over a point on the chart.

   * - Move a chart.

     - Click and hold the grabber in the upper left corner of the chart, and
       drag the chart to the new position.

   * - Export the charts.

     - Click the :guilabel:`Export` drop-down list and select the format.

   * - Link to a chart.

     - Click the curved arrow on the chart and select :guilabel:`Chart
       Permalink`.

   * - Email the chart.

     - Click the curved arrow on the chart and select :guilabel:`Email Chart`.
