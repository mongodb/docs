.. _live-migrate-com-replica:

===============================================================
Live Migrate Your Replica Set from Ops Manager or Cloud Manager
===============================================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

|service| can perform a Live Migration of a source replica set managed by
|com| to an |service| cluster, keeping the target cluster in sync with the
source cluster until you cut your applications over to the target cluster
in |service|.

Once you reach the cutover step in the following procedure, stop the writes
to the source cluster: stop your application instances, point them to the
|service| cluster, and restart them.

Restrictions
------------

- You cannot select an ``M0`` (Free Tier) or ``M2/M5`` shared cluster
  as the target (or destination) cluster for Live Migration. To migrate
  from an ``M0`` (Free Tier) or ``M2/M5`` shared cluster to a paid
  cluster, see :doc:`/scale-cluster`.

To live migrate a sharded cluster, see :doc:`/import/migrate-from-com-sharded`.

.. _migrate-from-com-vpc-support:

Support for VPC Peering and VPC Private Endpoints
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/live-migration-from-com-vpc-support.rst

.. _migrate-from-com-prereqs:

Prerequisites
-------------

Before you begin the Live Migration from |com| to |service|:

.. include:: /includes/live-migration-from-com-prereqs.rst

.. _live-migration-from-com-workflow:

Live Migration Workflow
~~~~~~~~~~~~~~~~~~~~~~~

This section outlines the workflow. For detailed steps,
see the :ref:`procedure for migrating a replica set from Ops Manager or
Cloud Manager to Atlas <lm-com-procedure-rs>`.

.. include:: /includes/live-migration-from-com-workflow.rst

.. _lm-upgrade-path:

Upgrade Path
~~~~~~~~~~~~

|service| Live Migration supports the following migration paths:

.. include:: /includes/list-tables/live-migration-from-com-upgrade-path.rst

.. include:: /includes/list-tables/mongomirror-upgrade-path.rst

.. important::

   If you are migrating from a MongoDB 3.6 cluster, update
   and test your applications in context of the
   target |service| cluster.


.. _lm-com-network-access-rs:

.. include:: /includes/import/network-access-lm-from-com.rst

.. _lm-com-migration-validation-rs:

Pre-Migration Validation
~~~~~~~~~~~~~~~~~~~~~~~~

Before starting the Live Migration procedure, |service| runs validation
checks on the source and destination clusters.

- The source cluster is a replica set.

  If the source is a standalone, :opsmgr:`convert </tutorial/convert-standalone-to-replica-set/>`
  the standalone MongoDB node in Ops Manager, or
  :cloudmgr:`convert </tutorial/convert-standalone-to-replica-set/>`
  the standalone MongoDB node in |mms| to a single-node
  replica set and then live migrate it to |service| using the procedure
  in this section.

- The destination |service| cluster must be a replica set.

Considerations
--------------

Target Cluster Configuration
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

For the target cluster, consider the following:

- The target |service| cluster must be a replica set.

- You can't select an ``M0`` (Free Tier) or ``M2/M5`` shared-tier
  cluster as the target for Live Migration.

- Do **not** change the ``featureCompatibilityVersion`` flag while
  |service| Live Migrattion is running.

.. _security-lm-com-rs:


Database Users and Roles
~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/import/security-lm-from-com.rst

Avoid Namespace Changes
~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/fact-mongomirror-namespace-changes.rst

Avoid Elections
~~~~~~~~~~~~~~~

.. include:: /includes/fact-avoid-elections.rst

Rolling Restarts
~~~~~~~~~~~~~~~~

.. include:: /includes/live-import-rolling-restarts.rst

Staging and Production Environments
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/live-migrate-from-com-staging-prod.rst

Migrating from MongoDB Community
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

If you are :opsmgr:`migrating </tutorial/migrate-community-to-atlas>`
to |service| from MongoDB Community using |onprem|, you must accept
the :opsmgr:`Ops Manager Migration Agreement
</reference/legal/live-migration-atlas-licensing>` as the first step
in the :ref:`Live Migration procedure <lm-com-procedure-rs>`.

Migrate Your Cluster
--------------------

.. important::

   Avoid making changes to the source cluster configuration while the
   Live Migration procedure runs, such as removing replica set members
   or modifying :binary:`mongod <bin.mongod>` runtime settings, such as
   ``featureCompatibilityVersion``.

.. _lm-com-procedure-rs:

Procedure
~~~~~~~~~

.. include:: /includes/steps/migrate-from-com.rst

.. _lm-com-support-rs:

.. include:: /includes/live-migration-support.rst
