stepnum: 1
source:
  file: steps-source-admin-navigation.yaml
  ref:  admin-backup-snapshot
---
title: "Go to the row for the blockstore you want to edit."
stepnum: 2
level: 4
ref: select-blockstore
---
title: "In the :guilabel:`MongoDB Connection` column, edit the necessary fields:"
stepnum: 3
level: 4
ref: edit-blockstore
content: |

   .. list-table::
      :widths: 30 70
      :header-rows: 1

      * - Field
        - Contents

      * - :guilabel:`Name`
        - Type the name for the S3 blockstore.
        
      * - :guilabel:`AWS Access Key`
        - Type your AWS Access Key ID.
        
      * - :guilabel:`AWS Secret Key`
        - Type your AWS Secret Access Key.

          .. note:: The existing Secret Access Key is not displayed.
        
      * - :guilabel:`<hostname>:<port>`

        - Type in one or more hosts in the ``<hostname:port>`` format that
          comprise the S3 blockstore metadata database.

          - If the S3 blockstore metadata database is a Replica Set or Sharded
            Cluster, type a comma-separated list of :program:`mongod`
            instances (for a Replica Set) or :program:`mongos` instances (for
            a Sharded Cluster).

            .. example::
               ``host1.example.com:27017,
               host2.example.com:27017,
               host2.example.com:27018``

            .. note::
               For replica sets, you can enter a
               :ref:`seed list <replica-set-option>`, but you should 
               try to include all `mongod` instances in the replica set.

          - If the S3 blockstore metadata database is a standalone MongoDB
            instance, type the ``hostname:port`` of the instance.
        
      * - :guilabel:`MongoDB Auth Username` (optional) 

        - If the S3 blockstore metadata database uses Username and Password
          (SCRAM-SHA-1) authentication, type the name of the user authorized
          to access the S3 blockstore metadata database.

          To enable Username and Password (SCRAM-SHA-1) authentication on your
          S3 blockstore metadata database,
          see :manual:`how to configure your database for SCRAM-SHA-1 authentication 
          </core/security-scram-sha-1>` in the MongoDB manual.
        
      * - :guilabel:`MongoDB Auth Password` (optional) 

        - If the database uses Username and Password (SCRAM-SHA-1)
          authentication, type the password associated with the username that
          can access the S3 blockstore metadata database.
        
          .. note:: The existing :guilabel:`MongoDB Auth Password` is not displayed.

      * - :guilabel:`Encrypted Credentials` (optional)

        - Select if the Username and Password for the database were encrypted
          using the ``credentialstool``. For details on the
          ``credentialstool``, see :ref:`encrypt-mongodb-user-credentials`.
        
      * - :guilabel:`Use TLS/SSL` (optional)

        - Select if the S3 blockstore metadata database only accepts connection
          encrypted using TLS.

          To enable TLS on the S3 blockstore metadata database, see 
          :manual:`Configure mongod and mongos for TLS/SSL </tutorial/configure-ssl>`.
        
      * - :guilabel:`Connection Options` (optional) 

        - Type any additional :manual:`configuration file options 
          </reference/configuration-options>` for the MongoDB instance. 
          This field supports unescaped values only.

          For proper syntax, see :manual:`Connection String URI
          Format </reference/connection-string>` in the MongoDB manual.
        
      * - :guilabel:`Assignment Labels` (Optional)

        - Type a comma-separated list of labels to assign the
          S3 blockstores to specific groups.

      * - :guilabel:`Load Factor` (Optional)

        - 
          .. note::
             Load Factor depends upon having more than one snapshot 
             store, particularly when backing up a sharded cluster.
             If you do not have more than one snapshot store, this
             setting can be ignored.

          Type how many backup jobs this snapshot store is assigned.

          You should distribute backup jobs proportionally among snapshot
          stores. Snapshots stores with more instances to back up should have
          a greater number of backup jobs. The number of backup jobs given to
          a single snapshot store is known as its *Load Factor*.

          By default, |mms| assigns snapshot stores one shard each.

          If you assign more than one shard to a snapshot store, this 
          snapshot store would need to run more backup jobs, usually by a 
          factor of how many shards it backs up.

          .. example:: **How the Load Factor affects backups**

             You are backing up a five-shard cluster. Your backup storage
             configuration has filestore (``A``) with one shard and 
             blockstore (``B``) with four shards. These blockstores should 
             not get equally distribution of backup jobs, as ``B`` is four 
             times larger than ``A``. ``B`` should get a Load Factor of 
             *four* and ``A`` should get a Load Factor of *one*.

          You should change the Load Factor to change this ratio of backup
          jobs to match the number of shards being backed up.

      * - :guilabel:`Write Concern`

        - Select the proper :manual:`Write Concern</core/write-concern/>`.

---
title: "Select the checkbox in the :guilabel:`Assignment Enabled` column."
stepnum: 4
level: 4
ref: assign-s3-blockstores
---
title: "Click :guilabel:`Save`."
stepnum: 5
level: 4
ref: save-s3-blockstore-changes
--- 
title: "If any Connection String values are changed, restart all the |onprem| instances, including those running activated Backup Daemons. (Optional)"
stepnum: 6 
level: 4
ref: restart-s3-blockstore-after-edits
content: |
  .. warning::
     If you change any of the connection string values (:guilabel:`MongoDB
     Host List`, :guilabel:`MongoDB Hostname`, :guilabel:`MongoDB Port`,
     :guilabel:`Username`, :guilabel:`Password`, :guilabel:`Connection
     Options` and/or :guilabel:`Use TLS/SSL`), you must restart all the
     |onprem| instances, including those running activated Backup Daemons,
     for the changes to take effect.

     .. seealso::
     
        For more details on the MongoDB connection string uri, see
        :manual:`Connection String URI Format </reference/connection-string>`
        in the MongoDB Manual.
...