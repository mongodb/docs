:noprevnext:

===============================
Release Notes for |k8s-op-full|
===============================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. _ent-op-1.27.x:

|k8s-op-full| 1.27 Series
-------------------------

.. _ent_op-1.27.0:

|k8s-op-full| 1.27.0
~~~~~~~~~~~~~~~~~~~~

*Released 2024-08-27*

New Features
```````````````

- **MongoDB** resource: Adds support for enabling log rotation for MongoDB
  processes, monitoring agent, and backup agent. To learn more, see :ref:`mongodb-crd-logging-specification`.

  Use the following settings to configure logs rotation per component:

  - :setting:`spec.agent.mongod.logRotate` for the mongoDB processes.
  - :setting:`spec.agent.mongod.auditlogRotate` for the mongoDB processes audit logs.
  - :setting:`spec.agent.backupAgent.logRotate` for the backup agent.
  - :setting:`spec.agent.monitoringAgent.logRotate` for the monitoring agent.
  - :setting:`spec.agent.readinessProbe.environmentVariables` for the environment variables
    the readiness probe runs with. This setting also applies to settings
    related to the logs rotation. To learn more about the supported environment
    settings, see `Readiness Probe <https://github.com/mongodb/mongodb-kubernetes-operator/blob/master/docs/logging.md#readinessprobe/>`__.

  - :opsmgrkube:`spec.applicationDatabase.agent.<component>.logRotate` for the Application Database.

  For sharded clusters, the |k8s-op-short| supports configuring log rotation
  only under the ``spec.Agent`` settings, and not per process type, such as
  ``mongos`` or ``configsrv``.

- **OpsManager** resource: Adds support for replacing the :ref:`logback.xml configuration file <onprem-own-logs>`,
  which configures general logging settings, such as log rotation for |onprem|
  and |onprem| backups.

  Use the following settings:
  
  - :setting:`spec.logging.logBackAccessRef` for the ConfigMap and access key with the ``logback``
    access configuration file to mount on the |onprem| Pod. Name the ConfigMap's access key
    ``logback-access.xml``. This file configures access to the logging configuration
    file for |onprem|.
  - :setting:`spec.logging.logBackRef` for the ConfigMap and access key with the ``logback``
    configuration file to mount on the |onprem| Pod. This file
    configures the general logging behavior for |onprem|,
    including log rotation policies, log levels, and other logging parameters.
    Name the ConfigMap's access key ``logback.xml``.
  - :setting:`spec.backup.logging.logBackAccessRef` for the ConfigMap and access key with the ``logback``
    access configuration file to mount on the |onprem| Pod. Name the ConfigMap's access key
    ``logback-access.xml``. This file configures access to the logging configuration
    file for |onprem| backups.
  - :setting:`spec.backup.logging.logBackRef` for the ConfigMap and access key with the ``logback``
    configuration file to mount on the |onprem| Pod. This file
    configures the general logging behavior for |onprem| backups,
    including log rotation policies, log levels, and other logging parameters.
    Name the ConfigMap's access key ``logback.xml``.

Deprecations
```````````````

- The ``spec.applicationDatabase.agent.logRotate`` setting for the Application Database has been deprecated.
  Use :opsmgrkube:`spec.applicationDatabase.agent.mongod.logRotate <spec.applicationDatabase.agent.<component>.logRotate>` instead.

Bug Fixes
```````````

- **Agent** launcher: Fixes an issue where, under some resync scenarios,
  the journal data in ``/journal`` may have been corrupted. The Agent now ensures
  that no conflicting journal data exist and prioritizes the data from ``/data/journal``.
  To deactivate this behavior, set the environment variable ``MDB_CLEAN_JOURNAL``
  in the |k8s-op-short| to any value other than 1.

- **MongoDB**, **AppDB**, **MongoDBMulti** resources: Fixes an issue that ensures
  that external domains are used in the ``connectionString``, if you configure it.

- **MongoDB** resource: Removes panic response if you provide a Horizon
  configuration that is shorter than the number of members. The |k8s-op-short| now
  issues a descriptive error in the status of the MongoDB resource in such cases.

- **MongoDB** resource: Fixes an issue where, when creating a resource in a new
  project named as a prefix of another project would fail, preventing the
  MongoDB resource from being created.

.. _ent-op-1.26.x:

|k8s-op-full| 1.26 Series
-------------------------

.. _ent_op-1.26.0:

|k8s-op-full| 1.26.0
~~~~~~~~~~~~~~~~~~~~

*Released 2024-06-21*

New Features
```````````````

- Improves CPU utilization and vertical scaling of the |k8s-op-short| and
  achieves faster reconciliation of all managed resources by allowing you
  to control the number of reconciliations the |k8s-op-short| can perform
  in parallel.

  You can set ``MDB_MAX_CONCURRENT_RECONCILES`` for the |k8s-op-short| deployment
  or ``operator.maxConcurrentReconciles`` in the |k8s-op-short| installation
  Helm chart. If not provided, the default value is 1. The ability to control
  the number of reconciliations might lead to an increased load on the |onprem|
  and the |k8s| API server in the same time window. Observe the |k8s-op-short|
  resource usage and adjust ``operator.resources.requests`` and
  ``operator.resources.limits`` if needed. To learn more,
  see :k8s:`Resource Management for Pods and Containers </concepts/configuration/manage-resources-containers/>`
  in the |k8s| documentation.

- Adds support for OpenShift 4.15. To learn more, see :ref:`k8s-compatibility`.

Helm Chart Installation Changes
```````````````````````````````

- Adds an ``operator.maxConcurrentReconciles`` parameter that allows
  you to control the number of reconciliations the |k8s-op-short| can
  perform in parallel. The default value is 1.
- Adds the :ref:`operator.webhook.installClusterRole
  <webhook-install-cluster-role>` parameter that
  controls whether to install the cluster role allowing the |k8s-op-short|
  to configure admission webhooks. Set this parameter to ``false`` when
  the cluster roles aren't allowed. The default value is ``true``.

Bug Fixes
```````````

* **MongoDB** resource: Fixes a bug where configuring a MongoDB resource
  with multiple entries in :setting:`spec.agent.startupOptions` would cause
  additional unnecessary reconciliation of the underlying ``StatefulSet``.
* **MongoDB, MongoDBMultiCluster** resources: Fixes a bug where
  the |k8s-op-short| wouldn't watch for changes in the X-509 certificates
  configured for {+mdbagent+} authentication.
* **MongoDB** resource: Fixes a bug where boolean flags passed to
  the {+mdbagent+} can't be set to ``false`` if their default value is ``true``.

.. _ent-op-1.25.x:

|k8s-op-full| 1.25 Series
-------------------------

.. _ent_op-1.25.0:

|k8s-op-full| 1.25.0
~~~~~~~~~~~~~~~~~~~~

*Released 2024-04-30*

Breaking Change
`````````````````

- **MongoDBOpsManager** resource. The |k8s-op-short| no longer supports
  |onprem| 5.0. Upgrade to a later version of |onprem|. While |onprem| 5.0
  may continue to work with the |k8s-op-short|, MongoDB won't test the
  |k8s-op-short| against |onprem| 5.0.

New Features
`````````````

- **MongoDBOpsManager** resource: Adds support for deploying the |application|
  on multiple |k8s| clusters. To learn more, see :ref:`deploy-om-multi-cluster`.
- (Public Preview) **MongoDB**, **OpsManager** resources: Introduces
  opt-in :ref:`static-containers` for all types of deployments.

  - In this release, use static containers only for testing purposes.
    Static containers might become the default in a later release.
  - To activate static containers mode, set the ``MDB_DEFAULT_ARCHITECTURE``
    environment variable at the |k8s-op-short| level to ``static``.
    Alternatively, annotate a specific ``MongoDB`` or ``OpsManager``
    custom resource with ``mongodb.com/v1.architecture: "static"``.
  - The |k8s-op-short| supports seamless migration between the static and
    non-static architectures. To learn more, see:

    - :ref:`Use Static Containers <static-containers>`
    - :ref:`Migrate to Static Containers <migrate-to-static-containers>`

- **OpsManager** resource: Adds the ``spec.internalConnectivity`` field
  to allow overrides for the service used by the |k8s-op-short| to ensure
  internal connectivity to the ``OpsManager`` resource-hosting Pods.

- **MongoDB** resource: You can recover a resource due to a broken
  Automation configuration in sharded clusters. In previous releases,
  you could recover other types of resources but not sharded clusters.
  To learn more, see :ref:`troubleshooting-automatic-recovery`.

- **MongoDB**, **MongoDBMultiCluster** resources: These resources now
  allow you to add placeholders in external services.

  - You can define |k8s-annotations| for external services managed by the |k8s-op-short|
    that contain placeholders which will be automatically replaced by the proper values.
    Previously, the |k8s-op-short| configured the same annotations for all
    external services created for each Pod. Starting with this release,
    you can add placeholders so that the |k8s-op-short| can customize
    annotations in each service with values that are relevant and unique
    for each particular Pod. To learn more, see:

    - ``MongoDB`` resource: :setting:`spec.externalAccess.externalService.annotations`
    - ``MongoDBMultiCluster`` resource :ref:`spec.externalAccess.externalService.annotations <multi-spec-externalaccess-externalservice-annotations>`

- The |kubectl-mongodb|: Allows you to print build information when
  using the plugin.
- The ``setup`` command of the |kubectl-mongodb|: Adds the
  :ref:`registry.imagePullSecrets <imagePullSecrets>` setting.
  If specified, created service accounts reference the specified secret on
  the ``imagePullSecrets`` field.
- Improves handling of configurations when the |k8s-op-short| watches more
  than one namespace, and when you install the |k8s-op-short| in a namespace
  that differs from the namespace in which the |k8s-op-short| watches resources.

- Optimizes setting up roles and permissions in member |k8s| clusters
  using a single service account per |k8s| cluster with correctly configured
  roles and role bindings (no cluster roles are necessary) for each watched
  namespace.

- Extends the existing event-based reconciliation process by a time-based
  reconciliation that is triggered every 24 hours. This ensures that all
  {+monitoring-agent+}s are always upgraded in a timely manner.

- OpenShift and OLM Operator: Removes the requirement for cluster-wide
  permissions. Previously, the |k8s-op-short| needed these permissions to
  configure admission webhooks. Starting with this release, webhooks are
  automatically configured by `OLM <https://olm.operatorframework.io/docs/advanced-tasks/adding-admission-and-conversion-webhooks/>`__.

- Adds an optional ``MDB_WEBHOOK_REGISTER_CONFIGURATION`` environment
  variable for the |k8s-op-short|. The variable controls whether the |k8s-op-short|
  should perform automatic admission webhook configuration. The default is ``true``.
  The variable is set to ``false`` for OLM and OpenShift deployments.

Helm Chart Installation Changes
`````````````````````````````````

- Changes the default ``agent.version`` to ``107.0.0.8502-1``. This changes
  the default Agent used in |k8s-op-short| deployments that you install using
  a Helm chart.

- Adds the ``operator.additionalArguments`` variable with the default of
  ``[]`` to allow you to pass additional arguments for the |k8s-op-short| binary.
- Adds the ``operator.createResourcesServiceAccountsAndRoles`` variable
  with the default of ``true`` to control whether to install roles and
  service accounts for ``MongoDB`` and ``OpsManager`` resources. When you
  use the |kubectl-mongodb| to configure the |k8s-op-short| for
  a multi-|k8s| cluster deployment, the plugin installs all necessary
  roles and service accounts. Therefore, to avoid clashes, in some cases
  don't install those roles using the |k8s-op-short| Helm chart.

Bug Fixes
```````````

- **MongoDBMultiCluster** resource: Fixes an issue where the |k8s-op-short|
  reported that ``spec.externalAccess.externalDomain`` and
  ``spec.clusterSpecList[*].externalAccess.externalDomains`` fields were
  required even though they weren't used. The |k8s-op-short| prematurely
  triggered a validation for these fields in cases where the custom resources
  contained a defined ``spec.externalAccess`` structure. Starting with this
  release, the |k8s-op-short| checks for uniqueness of external domains only
  when you define the external domains in ``spec.externalAccess.externalDomain``
  or ``spec.clusterSpecList[*].externalAccess.externalDomains`` settings.

- **MongoDB** resource: Fixes a bug where upon deleting a ``MongoDB`` resource,
  the ``controlledFeature`` policies remained set on the related |onprem| or
  |cloud-short| instance, making cleanup in the UI impossible in the case
  of losing the |k8s-op-short|.

- **OpsManager** resource: Fixes an issue where the ``admin-key`` secret
  was deleted when you removed the ``OpsManager`` custom resource.
  Fixing the ``admin-key`` secret deletion enables easier re-installation of |onprem|.

- **MongoDB Readiness Probe**: Fixes a misleading error message for the
  readiness probe: ``"... kubelet  Readiness probe failed:..."``. This affects
  all MongoDB deployments.

- **Operator**: Fixes cases where in some instances, while communicating with
  the ``OpsManager`` custom resource, the |k8s-op-short| skipped TLS verification,
  even if you enabled TLS.

Improvements
```````````````

- **Kubectl plugin**: The released |kubectl-mongodb| binaries are now signed, and the
  signatures are published with the `release assets <https://github.com/mongodb/mongodb-enterprise-kubernetes/releases>`__.
  The public key is available at `this address <https://cosign.mongodb.com/mongodb-enterprise-kubernetes-operator.pem>`__.
  The released |kubectl-mongodb| binaries are also notarized for MacOS.

- **Released Images signed**: All container images published for the |k8s-op-short|
  are cryptographically signed. This is visible in the MongoDB |quay| registry.
  You can verify the signatures using the MongoDB public key. Released images
  are available at `this address <https://cosign.mongodb.com/mongodb-enterprise-kubernetes-operator.pem>`__.

.. _ent-op-1.24.x:

|k8s-op-full| 1.24 Series
-------------------------

.. _ent_op-1.24.0:

|k8s-op-full| 1.24.0
~~~~~~~~~~~~~~~~~~~~

*Released 2023-12-21*


MongoDBOpsManager Resource
``````````````````````````

New Features
++++++++++++

- Adds support for the upcoming |onprem| 7.0.x series.

Bug Fixes
`````````

- Fixes an issue that prevented terminating a backup correctly.


.. _ent-op-1.23.x:

|k8s-op-full| 1.23 Series
-------------------------

.. _ent_op-1.23.0:

|k8s-op-full| 1.23.0
~~~~~~~~~~~~~~~~~~~~

*Released 2023-11-13*

Warnings and Breaking Changes
`````````````````````````````

- Aligns the component image version numbers with the |k8s-op-short| release tag so 
  it's clear which images go with which version of the |k8s-op-short|. 
  This affects the following images:

  - ``quay.io/mongodb/mongodb-enterprise-database-ubi``
  - ``quay.io/mongodb/mongodb-enterprise-init-database-ubi``
  - ``quay.io/mongodb/mongodb-enterprise-init-appdb-ubi``
  - ``quay.io/mongodb/mongodb-enterprise-init-ops-manager-ubi``

  To learn more, see :ref:`meko-op-install-settings-kubectl-oc` 
  and :ref:`meko-op-install-settings-helm`.

- Replaces ``spec.exposedExternally`` (deprecated in |k8s-op-short| 1.19) with 
  :setting:`spec.externalAccess`.

Bug Fixes
`````````

- Fixes an issue with scaling a replica set in a |multi-cluster| when a member 
  cluster has lost connectivity. The fix addresses both the manual and automated 
  recovery procedures.
- Fixes an issue where changing the names of the Automation Agent and MongoDB 
  audit logs prevented them from being sent to the |k8s| Pod logs. There are no 
  restrictions on the file names of MongoDB audit logs as of |k8s-op-short| 1.22.
- Allows the following new log types from the ``mongodb-enterprise-database`` 
  container to stream directly to |k8s| logs:

  - ``agent-launcher-script``
  - ``monitoring-agent``
  - ``backup-agent``

- Fixes an issue that prevented storing the ``MongoDBUser`` resource in the 
  namespace set in ``spec.mongodbResourceRef.namespace``.

.. _ent-op-1.22.x:

|k8s-op-full| 1.22 Series
-------------------------

.. _ent_op-1.22.0:

|k8s-op-full| 1.22.0
~~~~~~~~~~~~~~~~~~~~

*Released 2023-09-21*

Breaking Changes
````````````````

The |k8s-op-short| no longer uses the ``Reconciling`` state for all custom resources.
In most cases this state has been replaced with ``Pending`` and a corresponding
message. If you use monitoring tools with the custom MongoDB resources deployed
with the |k8s-op-short|, you might need to adjust your dashboards and alerting rules
to use the ``Pending`` state name.

MongoDBOpsManager Resource
``````````````````````````

Improvements
++++++++++++

- Adds support for configuring :opsmgr:`logRotate </reference/cluster-configuration/#mongodb-instances>`
  on the {+mdbagent+} for the {+appdb+} by adding the following new fields
  to the ``MongoDBOpsManager`` resource:

  - ``spec.applicationDatabase.agent.logRotate``
  - ``spec.applicationDatabase.agent.logRotate.numTotal``
  - ``spec.applicationDatabase.agent.logRotate.numUncompressed``
  - ``spec.applicationDatabase.agent.logRotate.percentOfDiskspace``
  - ``spec.applicationDatabase.agent.logRotate.sizeThresholdMB``
  - ``spec.applicationDatabase.agent.logRotate.timeThresholdHrs``

- You can now configure the :manual:`systemLog </reference/configuration-options/#systemlog-options>`
  to send logs to a custom location other than the default ``/var/log/mongodb-mms-automation`` directory using the following new fields
  in the ``MongoDBOpsManager`` resource:

  - :opsmgrkube:`spec.applicationDatabase.agent.systemLog`
  - :opsmgrkube:`spec.applicationDatabase.agent.systemLog.path`
  - :opsmgrkube:`spec.applicationDatabase.agent.systemLog.logAppend`
  - :opsmgrkube:`spec.applicationDatabase.agent.systemLog.destination`

- Improves handling of {+appdb+} clusters in |multi-clusters|.
  
  In the last release, to scale down processes, the |k8s-op-short| required
  a connection to the |k8s| cluster. This could block the reconciliation
  process due to a full-cluster outage.

  In this release, the |k8s-op-short| successfully manages the remaining
  healthy clusters as long as they have a majority of votes to elect a primary.
  The |k8s-op-short| doesn't remove associated processes from the automation
  configuration and replica set configuration. The |k8s-op-short| deletes
  these processes only if you delete the corresponding cluster from
  :opsmgrkube:`spec.applicationDatabase.clusterSpecList <spec.applicationDatabase.clusterSpecList>`
  or change the number of the cluster members to zero. When the |k8s-op-short|
  deletes these processes, it scales down the replica set by removing
  processes tied to that cluster one at a time.

``MongoDB`` Resource
````````````````````

Improvements
++++++++++++

- Adds an automatic recovery mechanism for ``MongoDB``
  resources when a custom resource remains in a ``Pending`` 
  or ``Failed`` state for a longer period of time. In addition, 
  introduces the following environment variables:

  - :ref:`MDB_AUTOMATIC_RECOVERY_ENABLE <mdb-automatic-recovery-enable>`
  - :ref:`MDB_AUTOMATIC_RECOVERY_BACKOFF_TIME_S <mdb-automatic-backoff-time-s>`

  To learn more, see :ref:`troubleshooting-automatic-recovery`.

- Allows you to route the audit logs for the ``MongoDB`` resource to the |k8s|
  Pod logs. Ensure that you write the ``MongoDB`` resource's audit logs
  to the ``/var/log/mongodb-mms-automation/mongodb-audit.log`` file.
  The Pod hosting the resource monitors this file and appends its content
  to its |k8s| logs.
  
  To send audit logs to the |k8s| Pod logs, use the following example
  configuration in the ``MongoDB`` resource:

  .. code-block:: yaml
  
     spec:
       additionalMongodConfig:
         auditLog:
           destination: file
           format: JSON
           path: /var/log/mongodb-mms-automation/mongodb-audit.log
  
  The |k8s-op-short| tags audit log entries with the ``mongodb-audit`` key
  in the Pod logs. 

  To extract audit log entries, use a command similar to the following example:

  .. code-block:: yaml

     kubectl logs -c mongodb-enterprise-database replica-set-0 | \
     jq -r 'select(.logType == "mongodb-audit") | .contents'

Bug Fixes
++++++++++

Fixes an issue where you couldn't set the :setting:`spec.backup.autoTerminateOnDeletion`
setting to ``true`` for sharded clusters. This setting controls whether the
|k8s-op-short| stops and terminates the backup when you delete a MongoDB
resource. If omitted, the default value is ``false``.

.. _ent-op-1.21.x:

|k8s-op-full| 1.21 Series
-------------------------

.. _ent_op-1.21.0:

|k8s-op-full| 1.21.0
~~~~~~~~~~~~~~~~~~~~

*Released 2023-08-25*

Breaking Changes
````````````````

- Renames the environment variable ``CURRENT_NAMESPACE`` to ``NAMESPACE``. This variable 
  tracks the namespace of the |k8s-op-short|. If you've set this variable by editing the 
  |k8s-mdbrscs|, update ``CURRENT_NAMESPACE`` to ``NAMESPACE`` while 
  :ref:`upgrading the Kubernetes Operator <upgrade-k8s-operator>`.
 
Bug Fixes
`````````

- Fixes an issue where ``StatefulSet`` override labels failed to override the ``StatefulSet``.
 
Improvements
````````````

- Supports configuring backups of the {+appdb+} and MongoDB for the |mongodb-multi|.
- Adds documentation for configuring a |mongodb-multis| deployment in a GitOps environment. 
  To learn more, see :ref:`multi-cluster-gitops`.
- Adds ``MetadataWrapper``, a label and annotations wrapper, to the |k8s-mdbrsc|, 
  |mongodb-multi| and ``MongoDBOpsManager`` resources. The wrapper supports 
  overriding ``metadata.Labels`` and ``metadata.Annotations``.

MongoDBOpsManager Resource
``````````````````````````

Breaking Changes and Deprecations
+++++++++++++++++++++++++++++++++

- The ``appdb-ca`` is not automatically added to the JVM trust store in |onprem|. The 
  ``appdb-ca`` is the |certauth| saved in the ConfigMap specified in 
  :opsmgrkube:`spec.applicationDatabase.security.tls.ca`. This impacts you if:

  - You use the same custom certificate for the ``appdb-ca`` and your |s3| snapshot store.
  - You use a version of |k8s-op-short| earlier than 1.17.0 or you've mounted your own 
    trust store to |onprem|.
  
  If you need to use the same custom certificate for ``appdb-ca`` and the |s3| snapshot 
  store, specify the CA with :opsmgrkube:`spec.backup.s3Stores.customCertificateSecretRefs`.

- Deprecates the :opsmgrkube:`spec.backup.s3Stores.customCertificate` and 
  :opsmgrkube:`spec.backup.s3OpLogStores.customCertificate` settings. Use 
  :opsmgrkube:`spec.backup.s3OpLogStores.customCertificateSecretRefs` and 
  :opsmgrkube:`spec.backup.s3Stores.customCertificateSecretRefs` instead.

Bug Fixes
+++++++++

- Fixes an issue that prevented setting an arbitrary port number for 
  :opsmgrkube:`spec.externalConnectivity.port` when using the ``LoadBalancer`` service type 
  to expose |onprem| externally.
- Fixes an issue that caused |onprem| to reject certificates by enabling the |k8s-op-short| 
  to import the ``appdb-ca``, which is a bundle of CAs, into the |onprem| JVM trust store.

Improvements
++++++++++++

- Supports configuring the ``MongoDBOpsManager`` resource with a highly available 
  {+appdb+} across multiple |k8s| clusters by adding the following new fields
  to the ``MongoDBOpsManager`` resource:

  - :opsmgrkube:`spec.applicationDatabase.topology`
  - :opsmgrkube:`spec.applicationDatabase.clusterSpecList`
  
  The default value for the new optional :opsmgrkube:`spec.applicationDatabase.topology` 
  field is ``singleCluster``, and it is used if you omit the value. To upgrade to |k8s-op-short| 
  1.21, you don't need to update your ``MongoDBOpsManager`` resources. This makes the addition 
  of the :opsmgrkube:`spec.applicationDatabase.topology` setting backward-compatible with 
  single |k8s| cluster deployments of the {+appdb+}. To learn more, see :ref:`deploy-om-container` and 
  the :ref:`k8s-om-specification`.
- Allows you to add a list of custom certificates for backups in the |s3| snapshot store 
  using the :opsmgrkube:`spec.backup.s3Stores.customCertificateSecretRefs` and 
  :opsmgrkube:`spec.backup.s3OpLogStores.customCertificateSecretRefs` fields in the ``MongoDBOpsManager`` resource.

.. _ent-op-1.20.x:

|k8s-op-full| 1.20 Series
-------------------------

.. _ent_op-1.20.1:

|k8s-op-full| 1.20.1
~~~~~~~~~~~~~~~~~~~~

*Released 2023-06-07*

This release fixes an issue that prevented upgrading the |k8s-op-short| to 1.20.0 in OpenShift.

Breaking Changes
````````````````

- Removes ``appdb.connectionSpec.Project``, which was deprecated more than two years ago.

Bug Fixes
`````````

- Fixes an issue where the ``MongoDBMultiCluster`` resource was not watching |onprem|'s connection ConfigMap and secret.
- Fixes support for rotating the ``clusterfile`` secret, which is used for internal X.509 authentication in the ``MongoDB`` and ``MongoDBMultiCluster`` resources.

MongoDBOpsManager Resource
``````````````````````````

- Adds support for votes, priority, and tags by introducing the 
  ``spec.applicationDatabase.memberConfig.votes``, 
  ``spec.applicationDatabase.memberConfig.priority``, 
  and ``spec.applicationDatabase.memberConfig.tags`` settings.

- Changes the container registry for the {+appdb+} image from 
  ``quay.io/mongodb/mongodb-enterprise-appdb-database-ubi`` to ``quay.io/mongodb/mongodb-enterprise-server``. This results in the following changes when you upgrade to
  this release:

  - The Helm chart setting for the {+appdb+} image, ``values.mongodb.name``,
    defaults to ``mongodb-enterprise-server``. 
  
  - The |k8s-op-short| updates your {+appdb+} replica set Pods to use the new
    images referenced in the ``values.mongodb.name`` Helm setting. The new images are
    functionally equivalent to the previous ones assuming that the MongoDB version is the same. 
  
  - The |k8s-op-short| automatically updates the tag suffix for all {+appdb+}
    images that reference the new container registry from ``-ent`` to ``-ubi8`` or the
    suffix set in :ref:`mdb-image-type` or :ref:`mongodb-image-type`. For example,
    the |k8s-op-short| changes ``quay.io/mongodb/mongodb-enterprise-server:4.4.5-ent``
    to ``quay.io/mongodb/mongodb-enterprise-server:4.4.5-ubi8``. You don't need to update
    the ``applicationDatabase.version`` setting in the ``MongoDBOpsManager`` resource. 
  
  - You can stop the |k8s-op-short| from automatically updating the tag suffix by setting          
    :ref:`old-suffix` or :ref:`old-suffix-helm` to ``true``. For example, you might want
    to stop the automatic suffix change if you're mirroring this image from your own repository.

- Adds support for specifying versions without a suffix in
  ``spec.applicationDatabase.version``. For example, you can specify a version, such as
  ``6.0.5``, without adding the ``-ubi8`` suffix. The |k8s-op-short| automatically converts
  this to ``6.0.5-${MDB_IMAGE_TYPE}``. The default for the ``MDB_IMAGE_TYPE`` environment
  variable is ``-ubi8``.
 
New Images
``````````

- Changes all images to reference UBI variants by default. The new images use the suffix ``-ubi``. 
  
  - quay.io/mongodb/mongodb-enterprise-database-ubi
  
  - quay.io/mongodb/mongodb-enterprise-init-database-ubi
  
  - quay.io/mongodb/mongodb-enterprise-ops-manager-ubi
  
  - quay.io/mongodb/mongodb-enterprise-init-ops-manager-ubi
  
  - quay.io/mongodb/mongodb-enterprise-init-appdb-ubi
  
  - quay.io/mongodb/mongodb-agent-ubi
  
  - quay.io/mongodb/mongodb-enterprise-appdb-database-ubi

- Changes the default {+appdb+} image repository to use the official MongoDB Enterprise repository by setting ``values.mongodb.name`` to ``quay.io/mongodb/mongodb-enterprise-server`` by default.
  
- Introduces the ``values.mongodb.imageType`` environment variable to override the new default ``-ubi8`` {+appdb+} image tag suffix used by the ``MongoDBOpsManager`` resource.

.. _ent_op-1.20.0:

|k8s-op-full| 1.20.0
~~~~~~~~~~~~~~~~~~~~

*Released 2023-06-07*

.. warning:: **Upgrade to 1.20.1**
  
   This release (1.20.0) is tied to a broken release on the Openshift Marketplace.
   Don't upgrade to 1.20.0, and instead upgrade to the 1.20.1 release.

.. _ent-op-1.19.x:

|k8s-op-full| 1.19 Series
-------------------------

.. _ent_op-1.19.1:

|k8s-op-full| 1.19.1
~~~~~~~~~~~~~~~~~~~~

*Released 2023-03-30*

This release fixes an issue that prevented upgrading the |k8s-op-short| to 1.19.0.
Upgrade to this release.

Breaking Changes
`````````````````

Makes the ``data.orgId`` field required for the ConfigMap of the |k8s-mdbrscs|.
If you provide an empty ``orgId``,  as in: ``orgId = ""``, |onprem|
creates an organization with the project name. Before upgrading the
|k8s-op-short| to 1.19.1, set the ``orgId:""`` in the |onprem| ConfigMap
and reapply it.

Improvements
````````````

- Introduces |multi-clusters|. To learn more, see :ref:`multi-cluster`.

  Makes the following changes to the |multi-cluster| support compared with
  the Beta version of the |multi-cluster| support in |k8s-op-short| 1.18.x:

  - Renames the ``MongoDBMulti`` resource in Beta versions to the |mongodb-multi|.
  - Renames the shortcut name of the |mongodb-multi| to ``mdbmc``. Use this
    shortcut name in all commands on the |mongodb-multi|. For example, to
    check the status of your |mongodb-multi|, run:

    .. code-block:: sh

       kubectl get mdbmc <resource-name> -o yaml -w

  - Renames the "multi-cluster CLI" tool to the "|kubectl-mongodb|".
    To learn more, see the :ref:`kubectl-plugin-ref`.
  - Removes the unnecessary intermediate object ``clusterSpecs`` from the
    ``clusterSpecList`` in the |mongodb-multi| specification. For a valid
    example of a |mongodb-multi| configuration file, see the
    :ref:`multi-cluster-specification`.

- Adds support for |k8s| 1.26 and OpenShift 4.12. To learn more, see
  :ref:`k8s-compatibility`.
- Allows you to configure ``podSpec`` per shard in a MongoDB sharded cluster
  by specifying an array of ``podSpecs`` under the ``spec.shardSpecificPodSpec``
  setting for each shard.
- Makes the ``data.orgId`` field required for the ConfigMap of the |k8s-mdbrscs|.
  If you provide an empty ``orgId``,  as in: ``orgId = " "``, |onprem|
  creates an organization with the project name.
- Adds documentation for the :ref:`multi-cluster-specification`.
- Adds the :ref:`k8s-faq` for the |k8s-op-short| to the documentation.
- Adds documentation for :ref:`configuring file system backup stores <configure-file-store>`
  in the |k8s-op-short| MongoDB deployments.

MongoDBMultiCluster Resource
``````````````````````````````

- Adds the :ref:`spec.clusterSpecList.externalAccess.externalService <multi-spec-clusterspeclist-externalservice>`,
  :ref:`spec.clusterSpecList.externalAccess.externalService.annotations <multi-spec-clusterspeclist-annotations>`,
  :ref:`spec.clusterSpecList.externalAccess.externalService <multi-spec-clusterspeclist-externalservice>`,
  and :ref:`spec.clusterSpecList.externalAccess.externalDomain <multi-spec-clusterspeclist-externaldomain>`
  settings to configure external connectivity settings for |mongodb-multis|. Use these settings to
  :ref:`connect to a Multi-Cluster Resource from outside Kubernetes <multi-cluster-connect-from-outside-k8s>`.

- Adds the :ref:`spec.clusterSpecList.memberConfig.votes <multi-spec-clusterspeclist-memberconfig-votes>`
  and :ref:`spec.clusterSpecList.memberConfig.priority <multi-spec-clusterspeclist-memberconfig-priority>`
  settings for configuring replica set member votes and member priority for |mongodb-multis|.
- Adds the :ref:`spec.clusterSpecList.memberConfig.tags <multi-spec-clusterspeclist-memberconfig-tags>`
  setting for adding tags to replica set members in |mongodb-multis|.

- Adds the :ref:`spec.security.authentication.ldap.timeoutMS <multi-spec-security-ldap-timeoutms>`
  setting that specifies how many milliseconds an authentication request should
  wait before timing out.

MongoDB Resource
`````````````````

- Adds the :setting:`spec.memberConfig.votes` and :setting:`spec.memberConfig.priority`
  settings for configuring replica set member votes and member priority.
- Adds the :setting:`spec.memberConfig.tags` setting for adding tags
  to replica set members.
- Adds the :setting:`spec.podSpec.podTemplate.affinity.podAffinity` setting to determine whether
  multiple |k8s-mdbrsc| |k8s-pods| must be co-located with other
  |k8s-pods| in sharded MongoDB cluster deployments. To learn more about
  the use cases, see |k8s-affinity| in the |k8s| documentation.
- Adds the ``spec.externalAccess`` setting for configuring external
  connectivity for MongoDB resources. Use this setting to
  :ref:`connect to a MongoDB Resource from outside Kubernetes 
  <connect-from-outside-k8s>`.
- Deprecates the ``spec.exposedExternally`` setting. This setting
  will be removed in the |k8s-op-short| 1.23.0 release. To 
  :ref:`connect to a MongoDB Resource from outside Kubernetes 
  <connect-from-outside-k8s>`, use the ``spec.externalAccess`` setting instead.

Bug Fixes
`````````

- Fixes the handling of ``WATCH_NAMESPACE='*'`` environment variable for
  |multi-clusters|. In the following cases, API clients for member clusters
  are configured incorrectly resulting in deployment errors:

  - The ``WATCH_NAMESPACE='*'`` environment variable is specified for
    the |multi-cluster|.
  - A specific namespace is set in ``kubeconfig`` for member clusters.
  - The |kubectl-mongodb| isn't used for configuring |multi-clusters|.

  This leads to the following errors:

  .. code-block:: sh
     :copyable: false

     The secret object 'mdb-multi-rs-cert' does not contain all the valid
     certificates needed: secrets "mdb-multi-rs-cert-pem" already exists

  To avoid this issue, set the ``WATCH_NAMESPACE`` environment variable to
  specific namespaces instead of ``'*'``, and verify that the ``kubeconfig``
  settings for member clusters don't specify a namespace. To set the namespace
  for |multi-clusters|, see :ref:`mc-namespace-scope-ref` and the :ref:`kubectl-plugin-ref`.

- Fixes an issue when ``CertificatesSecretsPrefix`` is set but no related
  ``spec.security.tls`` settings, such as ``tls.additionalCertificateDomains``
  or ``tls.ca`` are  provided.

- Fixes an issue that allows you to explicitly specify the value ``none``
  for the :setting:`spec.security.authentication.ldap.transportSecurity`
  when |tls| isn't used. Previously, the |k8s-op-short| treated this
  setting as ``none`` when you omitted the value and didn't specify the
  ``tls`` value, but the |k8s-op-short| didn't allow you to specify the
  value ``none`` explicitly.

.. _ent_op-1.19.0:

|k8s-op-full| 1.19.0
~~~~~~~~~~~~~~~~~~~~

*Released 2023-03-28*

Breaking Changes
````````````````

.. warning:: **Don't upgrade to 1.19.0. Instead, upgrade to 1.19.1**
  
   This release is tied to a broken release on the Openshift Marketplace.
   Don't upgrade to this release (1.19.0), and instead upgrade to the
   |k8s-op-short| 1.19.1 release.

This release removes Ubuntu-based images. Ubuntu-based images were deprecated
in favor of UBI-based images in the |k8s-op-short| in 1.17.0.
:ref:`Migrate the Kubernetes Operator from Ubuntu-based Images to UBI-based images <migrate-k8s-images>`.
All existing Ubuntu-based images will continue to be supported until their version's
:ref:`End of Life (EOL) dates <k8s-support-lifecycle>`.

.. _ent-op-1.18.x:

|k8s-op-full| 1.18 Series
-------------------------

.. _ent_op-1.18.0:

|k8s-op-full| 1.18.0
~~~~~~~~~~~~~~~~~~~~

*Released 2022-12-29*

Improvements
````````````

- Adds support for ``SCRAM-SHA-1`` for user and {+mdbagent+}
  authentication. To enable either authentication, use ``MONGODB-CR``
  and ``SCRAM-SHA-1`` in the
  :setting:`spec.security.authentication.modes` and 
  :setting:`spec.security.authentication.agents.mode` settings.

- Adds support for the following features for OpsManager Backup configuration:
  
  - KMIP Backup Configuration support through the
    ``spec.backup.encryption.kmip`` parameter in
    :opsmgrkube:`OpsManager backup.encryption.kmip <spec.backup.encryption.kmip>`
    and :setting:`MongoDB backup.encryption.kmip <spec.backup.encryption.kmip>` settings.
    To learn more, see :ref:`configure-kmip-backup-encryption`.
  - Backup assignment labels settings in
    ``spec.backup.[*].assignmentLabels`` elements of the OpsManager and
    MongoDB resources for backups. Use assignment labels to identify that
    specific backup stores are associated with particular projects.
    To learn more, see:

    - :opsmgrkube:`backup.assignment.Labels for Ops Manager resources <spec.backup.assignmentLabels>`
    - :setting:`backup.assignment.Labels for MongoDB resources <spec.backup.assignmentLabels>`
    - :ref:`back-up-mdb-resources`
    - :ref:`deploy-om-container`

  - Backup snapshot schedule configuration through the
    :setting:`spec.backup.snapshotSchedule` setting in the OpsManager
    resource. To learn more, see :ref:`back-up-mdb-resources`.

- Adds support for disaster recovery in |multi-clusters|, which are in
  the beta release. To learn more, see :ref:`disaster-recovery-ref` and
  :ref:`MongoDB kubectl Plugin Reference <kubectl-plugin-ref>`.

MongoDB Resource
`````````````````

- Adds documentation for
  :setting:`spec.additionalMongodConfig.net.tls.disabledProtocols`.

Bug Fixes
`````````

- Fixes the issue where you configure a liveness probe and it reports a
  positive result when you terminate a {+mdbagent+}\'s process. This could
  cause Pods hosting MongoDB resources to run without the MongoDB  Agent.
  In addition to this fix, consider configuring 
  :ref:`readiness probe overrides <readiness-probe-override>`.  

- Fixes the startup script in database Pod that might report errors when
  the Pod restarts.

.. _ent-op-1.17.x:

|k8s-op-full| 1.17 Series
-------------------------

.. _ent_op-1.17.2:

|k8s-op-full| 1.17.2
~~~~~~~~~~~~~~~~~~~~

*Released 2022-10-18*

- Fixes the OpenShift installation issue mentioned in the
  :ref:`v1.17.1 release notes <ent_op-1.17.1>`. The |k8s-op-short|
  Lifecycle Manager upgrade graph automatically skips the v1.17.1
  release and performs an upgrade from v1.17.0 directly to this release.

- Improves the reliability of upgrades by adding startup probes for
  MongoDB and OpsManager custom resources with some defaults. Use
  :setting:`spec.podSpec.podTemplate` to override probe configurations.

.. _ent_op-1.17.1:

|k8s-op-full| 1.17.1
~~~~~~~~~~~~~~~~~~~~

*Released 2022-10-10*

Breaking Changes
````````````````

.. warning:: **Installations for OpenShift**
  
   This release has invalid :q-mdb:`quay.io </mongodb-agent-ubi>`
   digests referenced in the certified bundle's CSV. This affects only
   OpenShift deployments when you install or upgrade |k8s-op-short| from
   the certified bundle (OperatorHub) in :q-mdb:`quay.io </mongodb-agent-ubi>`.

   If you use |k8s-op-short| with OpenShift, we recommend that you do NOT
   upgrade to this release (v1.17.1), and instead upgrade to the
   |k8s-op-short| v1.17.2, which is due the week commencing 17th October 2022.

As a result of this issue, installing this release could result in
``ImagePullBackOff`` errors in Pods hosting AppDB, the  database for |onprem|.
Errors will look similar to the following:

.. code-block:: sh

   Failed to pull image "quay.io/mongodb/mongodb-agent-ubi@sha256:a4cadf209ab87eb7d121ccd8b1503fa5d88be8866b5c3cb7897d14c36869abf6": rpc error: code = Unknown desc = reading manifest sha256:a4cadf209ab87eb7d121ccd8b1503fa5d88be8866b5c3cb7897d14c36869abf6 in quay.io/mongodb/mongodb-agent-ubi: manifest unknown: manifest unknown

To continue using the |k8s-op-short| v1.17.1, use the following workaround
and update the |k8s-op-short| Subscription with the following ``spec.config.env``:

.. code-block:: yaml

   spec:
    config:
      env:
        - name: AGENT_IMAGE
          value: >-
          quay.io/mongodb/mongodb-agent-ubi@sha256:ffa842168cc0865bba022b414d49e66ae314bf2fd87288814903d5a430162620
        - name: RELATED_IMAGE_AGENT_IMAGE_11_0_5_6963_1
          value: >-
          quay.io/mongodb/mongodb-agent-ubi@sha256:e7176c627ef5669be56e007a57a81ef5673e9161033a6966c6e13022d241ec9e
        - name: RELATED_IMAGE_AGENT_IMAGE_11_12_0_7388_1
          value: >-
          quay.io/mongodb/mongodb-agent-ubi@sha256:ffa842168cc0865bba022b414d49e66ae314bf2fd87288814903d5a430162620
        - name: RELATED_IMAGE_AGENT_IMAGE_12_0_4_7554_1
          value: >-
          quay.io/mongodb/mongodb-agent-ubi@sha256:3e07e8164421a6736b86619d9d72f721d4212acb5f178ec20ffec045a7a8f855

Remove this workaround as soon as you install the new |k8s-op-short| v1.17.2.

This release has the following additional breaking change:

- Removes the ``operator.deployment_name`` parameter from |k8s-op-short| Helm charts.
  In previous releases, you might have used this parameter to customize the name of the
  |k8s-op-short| container.

  Starting with this release, the value of the ``operator.name`` Helm chart parameter 
  determines the name of the |k8s-op-short| container.

  This is a breaking change only if you set ``operator.deployment_name`` to a different 
  value than ``operator.name`` and if you configured tooling to rely on the value of
  ``operator.deployment_name``.

Improvements
````````````
 
- Uses `Quay <https://quay.io/>`__ as an image registry for 
  |k8s-op-short| on OpenShift. When you upgrade your |k8s-op-short| 
  deployment, it automatically pulls new images from Quay. You don't need to 
  take any action.

.. _ent_op-1.17.0:

|k8s-op-full| 1.17.0
~~~~~~~~~~~~~~~~~~~~

*Released 2022-09-19*

Improvements
````````````

- Introduces support for |onprem| 6.0.

- Introduces the :opsmgrkube:`spec.backup.s3OpLogStores.s3RegionOverride`
  and :opsmgrkube:`spec.backup.s3Stores.s3RegionOverride` parameters
  for specifying the regions where the custom |s3|-compatible buckets
  that you use for the :term:`oplog store <Oplog Store Database>` or a
  :term:`snapshot store <Snapshot Store>` should reside.

- Improves security by introducing:

  - The ``readOnlyRootFilesystem`` setting for all deployed containers.
    This change also introduces additional
    :k8sdocs:`volumes and volume mounts </concepts/storage/volumes/>`.
  - The ``allowPrivilegeEscalation`` setting. This setting is by default
    set to ``false`` for all deployed containers.

Breaking Changes and Deprecations
``````````````````````````````````

This release:

- Removes support for |onprem| 4.4 due to its
  `End of Life <https://www.mongodb.com/support-policy/lifecycles>`__.
  If you're using |onprem| 4.4, :opsmgr:`upgrade </tutorial/upgrade-ops-manager/>`
  to a newer |onprem| version before you upgrade to |k8s-op-short| 1.17.

- Deprecates Ubuntu-based images. Starting with |k8s-op-short| 1.19.0,
  Ubuntu-based images will no longer be made available. All existing
  Ubuntu-based images will continue to be supported until their version's
  :ref:`End of Life (EOL) dates <k8s-support-lifecycle>`. We strongly
  recommend that you :ref:`migrate-k8s-images` as soon as possible.

- Removes support for |tls| certificates in concatenated |pem| format.
  These certificates were deprecated in |k8s-op-short| 1.13.0.
  If you want to use these certificates, the last version to which you
  can upgrade is |k8s-op-short| 1.16.4.

  Starting with the |k8s-op-short| 1.17.0 release, you must manually
  migrate old-style |tls| secrets from opaque to
  :k8sdocs:`kubernetes.io/tls </concepts/configuration/secret/#tls-secrets>`
  type secrets by creating new secrets that contain the relevant
  certificates and signing keys. To learn how to create these secrets,
  see the following resources:

  - :ref:`secure-tls`
  - :ref:`secure-internal-auth`

.. _ent-op-1.16.x:

|k8s-op-full| 1.16 Series
-------------------------

.. _ent_op-1.16.4:

|k8s-op-full| 1.16.4
~~~~~~~~~~~~~~~~~~~~

*Released 2022-08-03*

MongoDB Resource
`````````````````

- Init-Ops-Manager and Operator binaries now use Go 1.18.4, which 
  addresses security issues.

.. _ent_op-1.16.3:

|k8s-op-full| 1.16.3
~~~~~~~~~~~~~~~~~~~~

*Released 2022-07-15*

MongoDB Resource
````````````````

- Fixed a bug where ``securityContext`` defined at the Pod level is not
  respected as the |k8s-op-short| overrides it with a 
  ``securityContext`` at the container level. To learn more, see the
  description of the :setting:`spec.persistent` setting.

- Adds ``timeoutMS``, and ``userCacheInvalidationInterval`` fields to the 
  ``spec.security.authentication.ldap`` object.

- Fixes behavior where the ``additionalMongodConfig.net.tls.mode`` setting
  was ignored for ``mongos``, ``configSrv``, and ``shard`` objects when 
  configuring ``ShardedCluster`` resources.

.. _ent_op-1.16.2:

|k8s-op-full| 1.16.2
~~~~~~~~~~~~~~~~~~~~

*Released 2022-06-28*

.. warning:: **Breaking Changes**

   This release removes WiredTiger cache computation, which was required
   for MongoDB versions earlier than 4.0.9. Before you upgrade
   to this release, you must upgrade your database deployment to use
   MongoDB version 4.0.9 or later.

   To learn how to upgrade your deployment, see
   :ref:`meko-upgrade-mdb-version`.

MongoDB Resource
````````````````

- Removes the ``spec.podSpec.podAntiAffinityTopologyKey``,
  ``spec.podSpec.podAffinity``, and ``spec.podSpec.nodeAffinity``
  settings.

  Instead, use :setting:`spec.podSpec.podTemplate` to configure these
  parameters.

MongoDBOpsManager Resource
``````````````````````````

- Removes the ``spec.applicationDatabase.podSpec.podAntiAffinityTopologyKey``,
  ``spec.applicationDatabase.podSpec.podAffinity``, and 
  ``spec.applicationDatabase.podSpec.nodeAffinity`` settings.

  Instead, use :opsmgrkube:`spec.applicationDatabase.podSpec.podTemplate 
  <spec.applicationDatabase>` to configure these
  parameters.

MongoDB Multi-Cluster Resource
``````````````````````````````

Added support for :ref:`LDAP client authentication
<multi-cluster-secure-ldap-auth>` and for
:ref:`managing database users with LDAP <multi-cluster-capabilities>`
to |multi-clusters|.

This feature is a beta release. Use |multi-cluster| 
deployments only in development environments.

.. _ent_op-1.16.1:

|k8s-op-full| 1.16.1
~~~~~~~~~~~~~~~~~~~~

*Released 2022-05-24*

MongoDB Resource
````````````````

- Deprecates the :setting:`spec.service` parameter. Use 
  :setting:`spec.statefulSet.spec.serviceName` to provide a custom service name.

.. _ent_op-1.16.0:

|k8s-op-full| 1.16.0
~~~~~~~~~~~~~~~~~~~~

*Released 2022-04-29*

MongoDB Resource
````````````````

- Removes the ``spec.security.tls.secretRef.name`` parameter. 

  - |k8s-op-short| version ``v1.10.0`` deprecated this parameter.
  - To specify the secret name containing the certificate for the
    database, use :setting:`spec.security.certsSecretPrefix`.
  - Create the secret containing the certificates accordingly.

- Removes the ``spec.podSpec.cpu`` and
  ``spec.podSpec.memory`` parameters.

  To override the CPU/Memory resources for the database pod, set the
  ``statefulset`` parameter under
  ``spec.podSpec.podTemplate.spec.containers``.

- Propagates custom labels specified under ``metadata.labels``
  to the database |k8s-statefulset| and the |k8s-pvc| objects.

- Allows adding Prometheus scraping endpoints to the MongoDB resources
  using the :setting:`spec.prometheus` configuration attribute.

  -  Find a sample Prometheus configuration in the
     :github:`GitHub </mongodb/mongodb-enterprise-kubernetes/tree/master/samples/mongodb/prometheus>`
     repository.

MongoDBOpsManager Resource
``````````````````````````

- Removes the
  ``spec.applicationDatabase.security.tls.secretRef.name``
  parameter.

  - |k8s-op-short| version ``v1.10.0`` deprecated this parameter.
  - To specify the secret name containing the certificate for AppDB,
    use the
    :opsmgrkube:`spec.applicationDatabase.security.certsSecretPrefix`
    parameter.
  - Create the secret containing the certificates accordingly.

- Removes ``spec.applicationDatabase.podSpec.cpu`` and
  ``spec.applicationDatabase.podSpec.memory``.

  To override the CPU/Memory resources for the appDB pod, use the
  ``statefulset`` parameter under
  ``spec.applicationDatabase.podSpec.podTemplate.spec.containers``.

- Propagates custom labels specified under
  ``metadata.labels`` to the |onprem|, AppDB and BackupDaemon
  |k8s-statefulsets| and the |k8s-pvc| objects.

- Allows adding Prometheus scraping endpoints to the
  ``ApplicationDatabase`` resources using the
  ``spec.applicationDatabase.prometheus`` configuration
  attribute.

MongoDBUser Resource
````````````````````
  
Adds the optional parameter ``spec.connectionStringSecretName``. This
parameter provides a deterministic secret name for the user-specific
connection string secret that |k8s-op-short| generates.

.. _ent-op-1.15.x:

|k8s-op-full| 1.15 Series
-------------------------

.. _ent_op-1.15.2:

|k8s-op-full| 1.15.2
~~~~~~~~~~~~~~~~~~~~

*Released 2022-03-24*

MongoDBOpsManager Resource
``````````````````````````
 
Bug Fixes
+++++++++

- To enable custom |tls| certificates for |s3| oplog stores, 
  you must configure the following settings:

  - Specify :opsmgrkube:`spec.security.tls.ca`.
  - Specify :opsmgrkube:`spec.security.certsSecretPrefix`.
  - Set :opsmgrkube:`spec.backup.s3OpLogStores.customCertificate`
    to ``true``.

- To enable custom |tls| certificates for |s3| snapshot stores, 
  you must configure the following settings:

  - Specify :opsmgrkube:`spec.security.tls.ca`.
  - Specify :opsmgrkube:`spec.security.certsSecretPrefix`.
  - Set :opsmgrkube:`spec.backup.s3Stores.customCertificate`
    to ``true``.

- Fixes an issue where the |k8s-op-short| mounted the incorrect |certauth| to the {+appdb+} Pod.

.. _ent_op-1.15.1:

|k8s-op-full| 1.15.1
~~~~~~~~~~~~~~~~~~~~

*Released 2022-03-04*

MongoDB Resource
````````````````
 
Changes
+++++++

- Init-database, Init-Ops-Manager, and Operator binaries now use 
  Go 1.17.7 to prevent `CVE-2022-23773 <https://nvd.nist.gov/vuln/detail/CVE-2022-23773>`__.

MongoDBOpsManager Resource
``````````````````````````
 
Bug Fixes
+++++++++

- Fixes an issue that prevented the Operator upgrade when managing a 
  TLS-enabled ApplicationDB whose TLS certificate is stored in a 
  ``Secret`` of type Opaque.

.. _ent_op-1.15.0:

|k8s-op-full| 1.15.0
~~~~~~~~~~~~~~~~~~~~

*Released 2022-02-11*

.. include:: /includes/facts/fact-disable-tls.rst

MongoDB Resource
````````````````
 
Changes
+++++++

- The ``spec.security.tls.enabled`` and
  ``spec.security.tls.secretRef.prefix`` fields are now 
  **deprecated** and will be removed in a future release. 

  To enable |tls| for MongoDB database resources, provide a value for 
  the :setting:`spec.security.certsSecretPrefix` field.
 
MongoDBOpsManager Resource
``````````````````````````
 
Changes
+++++++

- Adds the ``spec.backup.queryableBackupSecretRef`` field.
  This field's value references a |k8s-secret| that stores
  certificates for :opsmgr:`Queryable Backups </tutorial/query-backup/>`.
- Adds two fields to enable support for configuring custom |tls|
  certificates for the |s3| Oplog and Snapshot Stores for backup:
  ``spec.security.tls.ca`` and
  ``spec.security.tls.secretRef``.
- Adds the ability to back up {+appdb+}s. To back up an
  application database, you must first disable its processes using the
  ``spec.applicationDatabase.automationConfig.processes[n].disabled``
  field.
- The ``spec.security.tls.enabled``, 
  ``spec.security.tls.secretRef.prefix``, 
  ``spec.applicationDatabase.security.tls.enabled`` and 
  ``spec.applicationDatabase.security.tls.prefix`` fields are 
  now **deprecated** and will be removed in a future release. 

  To enable |tls| for |onprem| resources, provide a value for 
  the :opsmgrkube:`spec.security.certsSecretPrefix` field.

  To enable |tls| for {+appdb+} resources, provide a value for 
  the :opsmgrkube:`spec.applicationDatabase.security.certsSecretPrefix` 
  field.

New Images
``````````

Find all new images at:
 
- `https://quay.io/repository/mongodb <https://quay.io/repository/mongodb>`__ (ubuntu-based)
 
- `https://connect.redhat.com/ <https://connect.redhat.com/>`__ (rhel-based)

.. _ent-op-1.14.x:

|k8s-op-full| 1.14 Series
-------------------------

.. _ent_op-1.14.0:

|k8s-op-full| 1.14.0
~~~~~~~~~~~~~~~~~~~~

*Released 2021-12-16*

|k8s-op-short|
``````````````

.. include:: /includes/facts/fact-disable-tls.rst

Changes
+++++++

- The |k8s-op-short| now supports |hashicorp-vault| as a |secret-store|. To
  store secrets in |vault-short| instead of |k8s| |k8s-secrets|, see
  :ref:`Configure Secret Storage <k8s-secret-storage>`.

.. _ent_op-1.14.0-mdb-resource:

``MongoDB`` Resource
````````````````````

Changes
+++++++

- This release adds the :setting:`spec.backup.autoTerminateOnDeletion` setting,
  which indicates if the |k8s-op-short|
  should stop and terminate the backup when you delete the ``MongoDB`` resource.

Bug Fixes
+++++++++

- Fixes an issue that caused a ``ShardedCluster`` resource to fail when disabling authentication.

``MongoDBOpsManager`` Resource
``````````````````````````````

Changes
+++++++

- This release adds the ability to configure |s3| oplog stores using the
  :opsmgrkube:`spec.backup.s3OpLogStores.name`
  setting and other related settings.

Bug Fixes
+++++++++

- Fixes an issue that prevented the |k8s-op-short| from triggering a
  resource reconciliation when rotating the {+appdb+} |tls| certificate.
- Fixes an issue where the |k8s-op-short| didn't mount the custom |certauth| specified in the ``MongoDBOpsManager`` resource
  into the Backup Daemon Pod. This issue prevented backups from working
  when you configured |onprem| to run in :opsmgr:`hybrid mode </tutorial/configure-local-mode/#hybrid-mode>` and used a custom |certauth|.

.. _ent-op-1.13.x:

|k8s-op-full| 1.13 Series
-------------------------

.. _ent_op-1.13.0:

|k8s-op-full| 1.13.0
~~~~~~~~~~~~~~~~~~~~

*Released 2021-10-21*

|k8s-op-short|
``````````````

.. warning:: **Breaking Changes**

   The |k8s-op-short| no longer generates |tls| certificates for
   ``MongoDB`` and ``MongoDBOpsManager`` resources.

Changes
+++++++

- The |k8s-op-short| now integrates with the Gatekeeper Open Policy Agent (OPA).
  This allows you to 
  :ref:`control your deployments with policies set in the OPA Gatekeeper <OPA-gatekeeper>`.

- The |k8s-op-short| can now watch a list of namespaces. To learn more,
  see :ref:`ns-scope-different-ns`.

- When deploying resources to :ref:`more than one namespace   
  <ns-scope-different-ns>`, create ``imagePullSecrets`` only in the 
  namespace where you installed the |k8s-op-short|. The |k8s-op-short|
  synchronizes this secret across all watched namespaces.

- The :setting:`spec.credentials` secret :ref:`now accepts 
  <create-k8s-secret>` fields named
  ``publicKey`` and ``privateKey``. Use these fields instead of the 
  ``user`` and ``publicApiKey`` fields supported in previous releases.

.. important:: **Deprecation Notice**

   This release deprecates :k8sdocs:`generic type secrets 
   </concepts/configuration/secret/#opaque-secrets>` for
   |tls| certificates.

- The |k8s-op-short| now supports |tls| secrets of the
  :k8sdocs:`kubernetes.io/tls
  </concepts/configuration/secret/#tls-secrets>` type.

  - The |k8s-op-short| reads these secrets and automatically generates
    new ``.pem`` files that contain the concatenated ``tls.crt`` and
    ``tls.key`` fields when you update these secrets.
  - This removes the need to manually concatenate these vales to create
    ``.pem`` files and enables you to natively reference secrets 
    that |k8s|-native tools, such as `cert-manager
    <https://cert-manager.io/docs/>`__, generate.

- For |tls|\-enabled resources, the operator now watches the ConfigMap
  that contains the |certauth| and the secrets that contain |tls| 
  certificates. Changes to these ConfigMaps and secrets now trigger a 
  reconciliation of the related resource.

.. _ent_op-1.13.0-mdb-resource:

``MongoDB`` Resource
````````````````````

.. warning:: **Breaking Changes**

   This release removes the ``spec.project`` setting from the
   :ref:`k8s-specification`.

   If your ``MongoDB`` resource specifications use the
   ``spec.project`` setting, update your specifications to instead
   use :setting:`spec.opsManager.configMapRef.name` or
   :setting:`spec.cloudManager.configMapRef.name` before you upgrade the
   |k8s-op-short| to 1.13.0 or later.

Changes
+++++++

- This release adds several new fields that determine the names that you
  must give the secrets that contain your |tls| and X.509 certificates 
  for MongoDB resources.

  To learn more, see :setting:`spec.security.certsSecretPrefix` and the
  :ref:`k8s-secure-resources` tutorials.

Bug Fixes
+++++++++

- Fixes an issue where Sharded Cluster backups could not be correctly 
  configured using ``MongoDB`` resource specifications.
- Fixes an issue where Backup Daemon fails to start after you update an
  |onprem| deployment by updating :opsmgrkube:`spec.version`.

``MongoDBOpsManager`` Resource
``````````````````````````````

- The |k8s-op-short| now reports the status of file system snapshot 
  stores that you configure in the  ``spec.backup.fileSystemStores``
  setting in the ``MongoDBOpsManager`` resource specification.

  You must manually configure the file system snapshot stores.

- This release adds a new field, ``spec.backup.externalServiceEnabled``,
  to the ``MongoDBOpsManager`` resource specification.

  By default, the |k8s-op-short| creates a :k8sdocs:`LoadBalancer 
  </concepts/services-networking/service/#loadbalancer>` service when 
  you :ref:`enable queryable backups <configure-om-queryable-backups>`.

  Set ``spec.backup.externalServiceEnabled`` to ``false`` before you
  enable queryable backups to prevent the |k8s-op-short| from creating a
  LoadBalancer service.

- The |k8s-op-short| now automatically upgrades personal API keys to
  programmatic API keys when you upgrade an |onprem| deployment to 
  version 5.0.0 or later. You no longer must change the keys manually to
  upgrade your deployment.

- This release adds the :opsmgrkube:`spec.security.certsSecretPrefix` field to
  determine the name that you must give the secret that contains your
  |tls| certificate for ``MongoDBOpsManager`` resources.

  To learn more, see :opsmgrkube:`spec.security.certsSecretPrefix` and 
  the **HTTPS** tab in the :ref:`deploy-om-container` tutorial.

``MongoDBUser`` Resource
````````````````````````

.. warning:: **Breaking Changes**

   This release removes the spec.project setting from the ``MongoDBUser``
   CustomResourceDefinition.

   If your ``MongoDBUser`` resource specifications use the
   spec.project setting, update your specifications to instead
   use ``spec.MongoDBResourceRef.name`` before you upgrade the
   |k8s-op-short| to 1.13.0 or later.

Miscellaneous
`````````````

- |onprem| 4.4.7, 4.4.9, 4.4.10, 4.4.11, 4.4.12 and 4.4.13 base images
  have been updated to Ubuntu 20.04.
- |onprem| versions 4.4.16 and 5.0.1 are now supported.

.. _ent-op-1.12.x:

|k8s-op-full| 1.12 Series
-------------------------

.. _ent_op-1.12.0:

|k8s-op-full| 1.12.0
~~~~~~~~~~~~~~~~~~~~

*Released 2021-07-15*

.. _mdb-resource-v1-12:

``MongoDB`` Resource
````````````````````

- If you set :opsmgrkube:`spec.externalConnectivity` to ``false`` after it
  was set to ``true``, the |k8s-op-short| deletes the corresponding service.

Bug Fixes
+++++++++

- Fixes a bug where you could specify ``net.ssl.mode`` and not ``net.tls.mode``
  in :setting:`spec.additionalMongodConfig`.

``MongoDBOpsManager`` Resource
``````````````````````````````

- If you set :opsmgrkube:`spec.externalConnectivity` to ``false`` after it
  was set to ``true``, the |k8s-op-short| deletes the corresponding service.
- You can specify the number of backup daemon Pods with :opsmgrkube:`spec.backup.members`.
  If not set, the value defaults to ``1``.

Changes to Images and Supported Versions
````````````````````````````````````````

- The |k8s-op-short| now supports the following |onprem| versions:

  - 4.4.13, 4.4.14, 4.4.15, 4.2.25 and 5.0.0.

- Before upgrading |onprem| to version 5.0.0, check that the
  |k8s-op-short| uses a :ref:`programmatic API key <create-k8s-credentials>`.

- Ubuntu based |k8s-op-short| images are now based on Ubuntu 20.04 instead
  of Ubuntu 16.04.
- Ubuntu based MongoDB images starting from 2.0.1 are based on Ubuntu 18.04
  instead of Ubuntu 16.04.
  
  .. warning:: MongoDB 4.0. does not support Ubuntu 18.04

     MongoDB 4.0. does not support Ubuntu 18.04. If you want to use
     MongoDB 4.0. with the |k8s-op-short|, use previously released
     images.

- Ubuntu based |onprem| images after 4.4.13 are based on Ubuntu 20.04
  instead of Ubuntu 16.04.

- Newly released UBI images for the |k8s-op-short|, |onprem| and
  MongoDB are based on ``ubi-minimal`` instead of ``ubi``.


.. _ent-op-1.11.x:

|k8s-op-full| 1.11 Series
-------------------------

.. _ent_op-1.11.0:

|k8s-op-full| 1.11.0
~~~~~~~~~~~~~~~~~~~~

*Released 2021-06-03*

|k8s-op-short|
``````````````

.. _migrate-single-cluster:

Removes the topic "Migrate to One Resource per Project (Required for
Version 1.3.0)" from the current documentation because :ref:`v.1.3.0 is EOL
<k8s-support-lifecycle>`. This topic has been
`archived <https://www.mongodb.com/docs/kubernetes-operator/v1.3/tutorial/migrate-to-single-resource/>`_.

Bug Fixes
+++++++++

- Fixes an issue with the :k8sdocs:`Liveness Probe </tasks/configure-pod-container/configure-liveness-readiness-startup-probes/>`
  that could cause the database Pods to be restarted in the middle of
  a restore operation from Backup.

New Images
``````````

- ``mongodb-agent 10.29.0.6830-1`` located in the following registries:
 
  - UBI images: :q-mdb:`quay.io/mongodb/mongodb-agent-ubi:10.29.0.6830-1 </mongodb-agent-ubi:10.29.0.6830-1>`
  - Ubuntu images: :q-mdb:`quay.io/mongodb/mongodb-agent:10.29.0.6830-1 </mongodb-agent:10.29.0.6830-1>`
 
- ``mongodb-enterprise-appdb-database`` located in the following registries:

  - UBI images: :q-mdb:`quay.io/mongodb/mongodb-enterprise-appdb-database-ubi </mongodb-enterprise-appdb-database-ubi>`
  - Ubuntu images: :q-mdb:`quay.io/mongodb/mongodb-enterprise-appdb-database </mongodb-enterprise-appdb-database>`

- ``mongodb-enterprise-init-appdb 1.0.7`` located in the following registries:

  - UBI images: :q-mdb:`quay.io/mongodb/mongodb-enterprise-init-appdb-ubi:1.0.7 </mongodb-enterprise-init-appdb-ubi:1.0.7>`
  - Ubuntu images: :q-mdb:`quay.io/mongodb/mongodb-enterprise-init-appdb:1.0.7 </mongodb-enterprise-init-appdb:1.0.7>`

- ``mongodb-enterprise-init-database 1.0.3`` located in the following registries:
 
  - UBI images: :q-mdb:`quay.io/mongodb/mongodb-enterprise-init-database-ubi:1.0.3 </mongodb-enterprise-init-database-ubi:1.0.3>`
  - Ubuntu images: :q-mdb:`quay.io/mongodb/mongodb-enterprise-init-database:1.0.3 </mongodb-enterprise-init-database:1.0.3>`


``MongoDBOpsManager`` Resource
``````````````````````````````
.. warning:: Breaking Changes
   
   - Beginning with this release, you can use any version of MongoDB
     for the {+appdb+}. You must specify this version
     explicitly when you deploy the ``MongoDBOpsManager`` resource. 

   - To upgrade the |k8s-op-short|, you must specify the Application
     Database's version. Check that the :opsmgrkube:`spec.applicationDatabase.version`
     has a value in your configuration files for the ``MongoDBOpsManager``
     custom resource deployment.

   - Each {+appdb+} Pod consists of the following containers
     (instead of one container with a bundled MongoDB version, as in previous
     releases): 
   
     - ``mongodb``
     - ``mongodb-agent``
     - ``mongodb-agent-monitoring``
   
- The ``spec.applicationDatabase.persistent`` setting is removed. The
  |k8s-op-short| always uses persistent volumes for the Application
  Database deployed by your ``MongoDBOpsManager`` custom resources.

.. _ent-op-1.10.x:

|k8s-op-full| 1.10 Series
-------------------------

.. _ent-op-1.10.0:

|k8s-op-full| 1.10.0
~~~~~~~~~~~~~~~~~~~~

*Released 2020-03-25*

|k8s-op-short|
``````````````

Changes
+++++++

- Updates the |k8s-crds| from the ``v1beta1`` version to the ``v1`` 
  version. Clusters on |k8s| 1.16 and higher should remain unimpacted. The |k8s-crds| cannot install in clusters on |k8s| versions lower than 1.16.

Bug Fixes
+++++++++

- Fixes an issue that prevented multiple |onprem| resources from 
  having the same name in different namespaces.
- Fixes an issue that caused new MongoDB resources created with 
  :setting:`spec.backup.mode=disabled <spec.backup.mode>` to fail.
- Fixes an issue with saving changes on the :guilabel:`S3 Store` page.
- Fixes an issue that changed the replica set status to ``Fail``, 
  increased the replica set members, and disabled |tls|.

``MongoDBOpsManager`` Resource
``````````````````````````````
  
Known Issues
++++++++++++

- When you use remote or hybrid mode, and set
  ``automation.versions.download.baseUrl``, you must set the
  ``automation.versions.download.baseUrl.allowOnlyAvailableBuilds``
  property to ``false``. |onprem| 4.4.11 fixes this issue.

.. _ent-op-1.9.x:

|k8s-op-full| 1.9 Series
------------------------

.. _ent-op-1.9.2:

|k8s-op-full| 1.9.2
~~~~~~~~~~~~~~~~~~~

*Released 2020-02-05*

|k8s-op-short|
``````````````

Bug Fixes
+++++++++

Fixes errors in the CSV (This only effects the Red Hat market)

``MongoDBOpsManager`` Resource
``````````````````````````````

Known Issues
++++++++++++

- You can't use MongoDB 4.4 as an application database for an |onprem|
  resource.

New Images
``````````

- ``mongodb-enterprise-operator:1.9.2``

You can find all images in the following registries:

- **Ubuntu-based images**: :qr-mdb:`https://quay.io/repository/mongodb </>`
- **RHEL-based images**: :qr-mdb:`/mongodb-enterprise-operator </mongodb-enterprise-operator>`


.. _ent-op-1.9.1:

|k8s-op-full| 1.9.1
~~~~~~~~~~~~~~~~~~~

*Released 2020-01-15*

|k8s-op-short|
``````````````

Bug Fixes
+++++++++

- Fixes an issue where you could not specify the
  ``service-account-name`` in the |k8s-statefulset| ``podSpec``
  override.
- Removes the unnecessary ``delete service`` permission from Operator
  role.

``MongoDB`` Resource
````````````````````

Bug Fixes
+++++++++

- Fixes an issue where removing the
  :setting:`~spec.security.roles.privileges` array in
  :setting:`spec.security.roles` caused the resource to
  enter a bad state.


``MongoDBOpsManager`` Resource
``````````````````````````````

.. warning:: Breaking Changes

   This release introduces:

   - A new {+appdb+} image,
     ``mongodb-enterprise-appdb:10.2.15.5958-1_4.2.11-ent``. The image
     includes MongoDB ``4.2.11-ent`` instead of
     ``4.2.2-ent``. You must push the new image to any private
     repositories that your |k8s-op-short| installation uses, otherwise
     the ``MongoDBOpsManager`` resource won't start.
   - A new required environment variable,
     ``APPDB_AGENT_VERSION``. If you don't set ``APPDB_AGENT_VERSION``,
     the ``MongoDBOpsManager`` resource can't fetch the {+mdbagent+}
     version for the {+appdb+}.

Known Issues
++++++++++++

- You can't use MongoDB 4.4 as an application database for an |onprem|
  resource.

Changes
+++++++

- The |onprem| user now has :manual:`backup
  </reference/built-in-roles/#backup>`, :manual:`restore
  </reference/built-in-roles/#restore>` and :manual:`hostManager
  </reference/built-in-roles/#hostManager>` roles, allowing for backups
  and restores on the {+appdb+}.

- If you omit :opsmgrkube:`spec.applicationDatabase.version`, the
  |k8s-op-short| uses ``4.2.11-ent`` as the default MongoDB version.

New Images
``````````

- ``mongodb-enterprise-operator:1.9.1``
- ``mongodb-enterprise-appdb:10.2.15.5958-1_4.2.11-ent``
- ``mongodb-enterprise-init-appdb:1.0.2``
- ``mongodb-enterprise-init-database:1.0.6``

You can find all images in the following registries:

- **Ubuntu-based images**: :qr-mdb:`https://quay.io/repository/mongodb </>`
- **RHEL-based images**: `https://catalog.redhat.com/software/containers/mongodb/enterprise-operator/5b8052d069aea356ff258479 <https://catalog.redhat.com/software/containers/mongodb/enterprise-operator/5b8052d069aea356ff258479>`__

.. _ent-op-1.9.0:

|k8s-op-full| 1.9.0
~~~~~~~~~~~~~~~~~~~

*Released 2020-12-08*

|k8s-op-short|
``````````````

Bug Fixes
+++++++++

- Fixes an issue where the |k8s-op-short| didn't close connections to
  |onprem|, causing too many open file descriptors.

``MongoDB`` Resource
````````````````````

Changes
+++++++

- You can now configure continuous backup for a MongoDB database
  resource in its |k8s-crd|.

  .. note::

     To enable continuous backup in the MongoDB |k8s-crd|, you must
     :opsmgrkube:`enable backup <spec.backup.enabled>` in an |onprem|
     instance that you deployed using the |k8s-op-short|.

``MongoDBOpsManager`` Resource
``````````````````````````````

Known Issues
++++++++++++

- You can't use MongoDB 4.4 as an application database for an |onprem|
  resource.

Changes
+++++++

- When you upgrade the |k8s-op-short| to this version, the
  |k8s-op-short| deletes and re-creates the Backup Daemon statefulset.

  This is a safe operation.

  The new |k8s| service that enables Queryable Backups requires a change
  to the ``matchLabels`` Backup Daemon |k8s-statefulset| attribute.

- The |k8s-op-short| changes the way it collects the status of
  {+mdbagent+}\'s in {+appdb+} |k8s-pods|.

New Images
``````````

- ``mongodb-enterprise-operator:1.9.0``

You can find all images in the following registries:

- **Ubuntu-based images**: :qr-mdb:`https://quay.io/repository/mongodb </>`
- **RHEL-based images**: `https://catalog.redhat.com/software/containers/mongodb/enterprise-operator/5b8052d069aea356ff258479 <https://catalog.redhat.com/software/containers/mongodb/enterprise-operator/5b8052d069aea356ff258479>`__

.. _ent-op-1.8.x:

|k8s-op-full| 1.8 Series
------------------------

.. _ent-op-1.8.2:

|k8s-op-full| 1.8.2
~~~~~~~~~~~~~~~~~~~

*Released 2020-11-16*

Known Issues
````````````

- You can't use MongoDB 4.4 as an application database for an |onprem|
  resource.

Bug Fix
```````

Fixes an issue where the |onprem| resource would reach a ``Failing``
state when both :opsmgrkube:`spec.externalConnectivity` and
:opsmgrkube:`spec.backup.enabled` were enabled.

.. _ent-op-1.8.1:

|k8s-op-full| 1.8.1
~~~~~~~~~~~~~~~~~~~

*Released 2020-11-13*

Known Issues
````````````

- You can't use MongoDB 4.4 as an application database for an |onprem|
  resource.
- When both :opsmgrkube:`spec.externalConnectivity` and
  :opsmgrkube:`spec.backup.enabled` are enabled in |onprem| at the same
  time, the |onprem| resource fails to reconcile.

Bug Fixes
`````````
- Fixes a bug where
  :setting:`spec.security.authentication.ignoreUnknownUsers` could not
  be modified after creating a MongoDB resource.
- Fixes failed queryable backups. The |k8s-op-short| now creates a
  |k8s| Service that |onprem| uses to access backups.
- Fixes an issue that made it impossible to move from non-|tls| to a
  |tls|-enabled {+appdb+}.

Improvements
````````````
- Init containers do not run as root.
- |onprem| Backup daemon runs in unprivileged mode.
- To manage Database Pod resources, use the
  :setting:`spec.podSpec.podTemplate` MongoDB Custom Resource attribute.
  For an example resource definition of each supported type, see the
  :github:`samples/mongodb/podspec </mongodb/mongodb-enterprise-kubernetes/tree/master/samples/mongodb/podspec>`
  directory. The following attributes are deprecated:

  - ``spec.podSpec.cpu``
  - ``spec.podSpec.cpuRequests``
  - ``spec.podSpec.memory``
  - ``spec.podSpec.memoryRequests``

New Images
``````````

.. list-table::
   :stub-columns: 1
   :widths: 20 40 40

   * - Init-database 1.0.1
     - :q-mdb:`Ubi </mongodb-enterprise-init-database-ubi:1.0.1>`
     - :q-mdb:`Ubuntu </mongodb-enterprise-init-database:1.0.1>`

   * - Init-ops-manager 1.0.3
     - :q-mdb:`Ubi </mongodb-enterprise-init-ops-manager-ubi:1.0.3>`
     - :q-mdb:`Ubuntu </mongodb-enterprise-init-ops-manager:1.0.3>`

   * - Init-appdb 1.0.5
     - :q-mdb:`Ubi </mongodb-enterprise-init-appdb-ubi:1.0.5>`
     - :q-mdb:`Ubuntu </mongodb-enterprise-init-appdb:1.0.5>`

New |onprem| Images
```````````````````

.. list-table::
   :stub-columns: 1
   :widths: 20 40 40

   * - Version 4.4.5
     - :q-mdb:`Ubi </mongodb-enterprise-ops-manager-ubi:4.4.5>`
     - :q-mdb:`Ubuntu </mongodb-enterprise-ops-manager:4.4.5>`

   * - Version 4.2.21
     - :q-mdb:`Ubi </mongodb-enterprise-ops-manager-ubi:4.2.21>`
     - :q-mdb:`Ubuntu </mongodb-enterprise-ops-manager:4.2.21>`

   * - Version 4.2.20
     - :q-mdb:`Ubi </mongodb-enterprise-ops-manager-ubi:4.2.20>`
     - :q-mdb:`Ubuntu </mongodb-enterprise-ops-manager:4.2.20>`

For a list of the packages installed and any security vulnerabilities
detected in the build process, see the Quay repository for the
:qr-mdb:`MongoDB Enterprise Operator </mongodb-enterprise-operator?tab=tags>`
and the :qr-mdb:`{+mdb-ent-db+} </mongodb-enterprise-database?tab=tags>`.

.. _ent-op-1.8.0:

|k8s-op-full| 1.8.0
~~~~~~~~~~~~~~~~~~~

*Released 2020-09-30*

.. warning:: Breaking Changes

   The {+mdb-ent-db+} image now requires an init container. 
   If you are using a private repository, you must set the ``INIT_DATABASE_IMAGE_REPOSITORY`` 
   environment variable in the Operator deployment, and the new 
   init container must exist inside this repository.

MongoDB Resource Changes
````````````````````````

- Introduces new configuration fields:

  - :setting:`spec.security.authentication.requireClientTLSAuthentication`
    for using the {+mdbagent+} client certificate authentication in
    conjunction with any other authentication mechanism.
  - ``spec.security.authentication.agents.clientCertificateSecretRef``
    for configuring the client TLS certificate used by the MongoDB
    Agent when enabling ClientTLSAuthentication.

- Changes the default permissions of volumes created from secrets from ``0644``
  to ``0640``.

Ops Manager Resource Changes
````````````````````````````

- Allows the {+appdb+} to be configured with SCRAM-SHA-256
  authentication when using |onprem| 4.4 or newer version.
- Changes the validation of the |onprem| :setting:`spec.version` field
  to allow for tags that do not match the :github:`semver </blang/semver>`
  requirements. The :setting:`spec.version` field must start with the
  ``Major.Minor.Patch`` string that represents the |onprem| version. To
  learn more about this field, see :ref:`k8s-om-specification`.

Bug Fixes
`````````

- Fixes an issue that caused the Operator to choose an incorrect project
  name when creating MongoDB users.
- Fixes an issue that caused the MongoDB |onprem| CRD to have the CA
  path in the incorrect location.
- Fixes a bug where the {+mdbagent+} could not correctly recognize the
  parameters that passed through :setting:`spec.agent.startupOptions`.
- Fixes an issue that could cause potential deadlock when certain
  configuration options are modified in parallel.

Known Issues
````````````

- You can't use MongoDB 4.4 as an application database for an |onprem|
  resource.

- When you enable queryable backup, you must manually create two
  additional services for:

  - Exposing the queryable backup port (default: 25999) for the |onprem|
    pod.
  - The Backup Daemon pod, to ensure that it is resolvable from the |onprem| pod.

- If you deploy |onprem| in
  :ref:`local mode <deploy-om-container-local-mode>` and upgrade from
  v4.4.1, you must upgrade the MongoDB tools located in the
  ``automation.versions.directory``, which defaults to
  ``/mongodb-ops-manager/mongodb-releases/``.

  .. seealso::

     :ref:`deploy-om-container-local-mode`.

.. _ent-op-1.7.x:

|k8s-op-full| 1.7 Series
------------------------

.. _ent-op-1.7.1:

|k8s-op-full| 1.7.1
~~~~~~~~~~~~~~~~~~~

*Released 2020-09-02*

MongoDB Resource Changes
````````````````````````

- Supports setting the Distinguished Name (DN) of the LDAP group to
  which the {+mdbagent+} user belongs with the
  :setting:`spec.security.authentication.agents.automationLdapGroupDN`
  setting.
- Requires you to provide
  :setting:`spec.security.authentication.agents.mode` if you specify
  more than one mode in :setting:`spec.security.authentication.modes`.
- Supports setting {+mdbagent+} startup parameters for MongoDB Database
  resources with the following settings:

  - ``spec.applicationDatabase.agent.startupOptions``
  - :setting:`spec.agent.startupOptions`
  - :setting:`spec.configSrv.agent.startupOptions`
  - :setting:`spec.mongos.agent.startupOptions`
  - :setting:`spec.shard.agent.startupOptions`

Bug Fixes
`````````

- |onprem| resources:

  - Fixes a bug where you could not enable ``SCRAM-SHA``
    authentication for application database resources using certain
    MongoDB versions with |onprem| 4.4.
  - Fixes a bug where application database monitoring was not correctly
    configured in |onprem| when you enabled |tls| for the application
    database.
  - Fixes a bug to move the |onprem| |certauth| configuration from
    ``spec.applicationDatabase.security.tls.ca`` to
    ``spec.security.tls.ca``.

- MongoDB resources:

  - Fixes a bug that prevented you from increasing or decreasing the number
    of members in a replica set or a sharded cluster by more than one
    member at a time for MongoDB 4.4 deployments.
  - Fixes an issue where the |k8s-op-short| could not enable agent
    authentication if you enabled ``LDAP`` authentication for a MongoDB
    resource.
  - Fixes an issue where you could not create ``SCRAM`` users and enable
    ``SCRAM`` authentication in any order for a MongoDB resource.
  - Fixes an issue where the |k8s-op-short| did not remove the backup
    automation configuration before starting the agent on a MongoDB
    resource |k8s-pod|.

Known Issues
````````````

- If you enable |tls| on the application database, you must not provide the
  :opsmgrkube:`spec.applicationDatabase.version` field in an |onprem|
  resource definition.
- You can't use MongoDB 4.4 as an application database for an |onprem|
  resource.
- When you upgrade to the |k8s-op-short| 1.7.1, you might have to delete
  the ``mongodb-enterprise-operator`` deployment due to deployment
  configuration changes.

  This is a safe operation. Deleting the
  ``mongodb-enterprise-operator`` Pod does not affect the MongoDB
  |k8s-custom-resources|.
- If you use |tls| certificates signed by a custom |certauth|, you must:

  - Omit the ``spec.version.applicationDatabase`` setting from
    your |onprem| resource definition, and
  - Deploy |onprem| in :ref:`local mode
    <deploy-om-container-local-mode>`. You must manually copy
    installation archives for all MongoDB versions you want to use to
    a |k8s-pv| for the |onprem| StatefulSet.

.. _ent-op-1.7.0:

|k8s-op-full| 1.7.0
~~~~~~~~~~~~~~~~~~~

*Released 2020-08-14*

.. important:: Final Release with OpenShift 3.11 Support

   |k8s-op-short| 1.7.x is the final minor version release series that
   supports OpenShift 3.11. Do not upgrade to any future major or minor
   version releases if you want to continue to deploy the |k8s-op-short|
   using OpenShift 3.11.

   The planned end of life for the |k8s-op-short| 1.7.x release series
   is July 2021.

Docker Image Changes
````````````````````

- All |k8s-op-short| Red Hat Docker images are now based on UBI 8. In
  the previous release, |k8s-op-short| Red Hat Docker images were based
  on UBI 7.

MongoDB Resource Changes
````````````````````````

- Supports LDAP as an authorization mechanism for MongoDB database
  resources you deploy with the |k8s-op-short|. For more information,
  see the sample LDAP configurations on :github:`GitHub
  </mongodb/mongodb-enterprise-kubernetes/tree/master/samples/mongodb/authentication/ldap>`

Bug Fixes
`````````

- Fixes a bug that prevented scaling down a replica set from three
  members to one member.

Known Issues
````````````

- |onprem| cannot monitor {+appdb+}s secured using |tls|.
-  For MongoDB 4.4 deployments, you can increase or decrease the number
   of members in a replica set or a sharded cluster by only one member
   at a time.

.. _ent-op-1.6.x:

|k8s-op-full| 1.6 Series
------------------------

.. _ent-op-1.6.1:

|k8s-op-full| 1.6.1
~~~~~~~~~~~~~~~~~~~

*Released 2020-07-30*

Ops Manager Resource Changes
````````````````````````````

- |onprem| image for version 4.4.0 is available.

Docker Image Changes
````````````````````

- The Red Hat ``database`` and ``operator`` Docker images are now based
  on the latest UBI 7 release. Two high criticality issues have been
  resolved.
- The following Docker images have been released:

  .. list-table::
     :header-rows: 1
     :widths: 10 20 20

     * - Image Type
       - Ubuntu 16.04
       - Red Hat UBI 7
     * - |k8s-op-short|
       - quay.io/mongodb/mongodb-enterprise-operator:1.6.1
       - quay.io/mongodb/mongodb-enterprise-operator-ubi:1.6.1
     * - MongoDB Database
       - quay.io/mongodb/mongodb-enterprise-database:1.6.1
       - quay.io/mongodb/mongodb-enterprise-database-ubi:1.6.1
     * - |onprem|
       - quay.io/mongodb/mongodb-enterprise-ops-manager:4.4.0
       - quay.io/mongodb/mongodb-enterprise-ops-manager-ubi:4.4.0

Bug Fixes
`````````

- Fixes a bug where the |k8s-op-short| did not store a configuration of
  your deployed resources in a |k8s-secret|.
- Fixes a bug where the |k8s-op-short| did not allow passwords of any
  length or complexity for {+appdb+}, oplog store, and
  blockstore database resources defined in |onprem| resources.
- Fixes a bug where the authentication configuration was not removed
  from |onprem| or |cloud-short| projects when you remove a MongoDB
  database resource.

.. _ent-op-1.6.0:

|k8s-op-full| 1.6.0
~~~~~~~~~~~~~~~~~~~

*Released 2020-07-16*

MongoDB Resource Changes
````````````````````````

- Supports LDAP as an authentication mechanism for MongoDB database
  resources you deploy with the |k8s-op-short|. For more information,
  see the sample LDAP configurations on :github:`GitHub
  </mongodb/mongodb-enterprise-kubernetes/tree/master/samples/mongodb/authentication/ldap>`.

  .. note::

     LDAP authorization is not yet supported.

Kubernetes Operator Changes
```````````````````````````

- Preserves backup history by retaining |onprem| cluster records when
  you enable backup.

Bug Fixes
`````````

- Fixes a bug that prevented the |k8s-op-short| from raising errors when
  a ``projectName`` contained spaces.
- Fixes a bug that prevented |onprem| to monitor for all MongoDB
  database resources that you deploy with the |k8s-op-short|.

.. _ent-op-1.5.x:

|k8s-op-full| 1.5 Series
------------------------

.. _ent-op-1.5.5:

|k8s-op-full| 1.5.5
~~~~~~~~~~~~~~~~~~~

*Released 2020-07-02*

MongoDB Resource Changes
````````````````````````

- Provides additional options for more granular configuration of
  |mongod| / |mongos| processes. You can find an example of how to apply
  these options in the ``/samples/mongodb/mongodb-options`` file of the
  :github:`MongoDB Enterprise Kubernetes Operator repository </mongodb/mongodb-enterprise-kubernetes>`.

Bug Fixes
`````````

- Fixes a bug introduced in 1.5.4 where |k8s-op-full| would not tag
  projects correctly when working on |onprem| versions older than 4.2.2.
  In this version, |k8s-op-full| tags the projects correctly.

.. _ent-op-1.5.4:

|k8s-op-full| 1.5.4
~~~~~~~~~~~~~~~~~~~

*Released 2020-06-22*

MongoDB Resource Changes
````````````````````````

- Allows modification of authentication settings using the |com| UI if
  the :setting:`spec.security.authentication` setting is not provided
  in the MongoDB resource object definition.

Kubernetes Operator Changes
```````````````````````````

- Supports Helm :ref:`installation <install-k8s>` with
  ``helm install`` in addition to ``helm template | kubectl apply``.
  ``helm install`` is now the recommended way to install with Helm.

- Supports configuring the {+mdbagent+} authentication mechanism
  independently from the cluster authentication mechanism.

- Supports configuring monitoring for the {+appdb+} to send
  metrics to |onprem|. To learn more about the monitoring function of
  the {+mdbagent+}, see
  :opsmgr:`MongoDB Agent </tutorial/nav/mongodb-agent/>`.

Bug Fixes
`````````

- Fixes a bug that affected transitioning authentication mechanisms
  from X.509 to SCRAM.

- Fixes a bug that prevented the {+mdbagent+} from reaching a goal
  state if SCRAM configuration was changed in the |onprem| UI.

.. _ent-op-1.5.3:

|k8s-op-full| 1.5.3
~~~~~~~~~~~~~~~~~~~

*Released 2020-05-29*

Kubernetes Operator Changes
````````````````````````````

Passes |onprem| and MongoDB deployment configuration properties as
:k8sdocs:`Secret environment variables
</concepts/configuration/secret/#using-secrets-as-environment-variables>`.

Bug Fixes
`````````

- Correctly configures shutdown timeouts for |onprem| and the Backup
  Daemon.
- Fixes an issue where |k8s-op-short|-watched Secrets and ConfigMaps
  triggered unnecessary reconciliations.
- Fixes an issue where the status of custom resources failed to update
  in OpenShift 3.11.

.. _ent-op-1.5.2:

|k8s-op-full| 1.5.2
~~~~~~~~~~~~~~~~~~~

*Released 2020-05-08*

Ops Manager Resource Changes
````````````````````````````

- Runs |onprem| and Backup Daemon pods under a dedicated service
  account.

Kubernetes Operator Changes
````````````````````````````

- Can configure the |k8s-op-short| to watch a subset of provided
  |k8s-crds|. You can find more information in the documentation.

- Can generate |k8s-crds| without using subresources. Some versions of
  Openshift 3.11 require this capability. To avoid using subresources,
  use ``--set subresourceEnabled=false`` when installing the
  |k8s-op-short| with helm.

Bug Fixes
`````````

- Fixes setting the ``spec.statefulSet`` and
  ``spec.backup.statefulSet`` fields on the
  ``MongoDBOpsManager`` Resource.

- Fixes an issue that requires a restart of the |k8s-op-short| during
  setup of webhook.

- Fixes an issue that could make an |onprem| resource to reach an
  unrecoverable state if the provided admin password has insufficient
  strength.

.. _ent-op-1.5.1:

|k8s-op-full| 1.5.1
~~~~~~~~~~~~~~~~~~~

*Released 2020-04-30*

Deprecates the generation of |tls| certificates by the |k8s-op-short|.
If you use |k8s-op-short|-generated certificates, warning messages now
appear in the |k8s-op-short| logs. To configure secure deployments, see
:ref:`k8s-secure-resources`.

Bug Fixes
`````````

Fixes an issue where, when no authentication is configured by the
|k8s-op-short|, the |k8s-op-short| disables authentication in |com|.
The |k8s-op-short| no longer disables authentication unless you
explicitly set :setting:`spec.security.authentication.enabled` to
``false``.

Known Issues
````````````

When you configure the
:opsmgrkube:`spec.statefulSet.spec` and
:opsmgrkube:`spec.backup.statefulSet.spec` settings of the
:ref:`MongoDBOpsManager <plan-om-resource>` resource, you can only
configure the :opsmgrkube:`spec.statefulSet.spec.template` and
:opsmgrkube:`spec.backup.statefulSet.spec.template` fields. Any other
:opsmgrkube:`spec.statefulSet.spec` or
:opsmgrkube:`spec.backup.statefulSet.spec` field has no effect.

.. _ent-op-1.5.0:

|k8s-op-full| 1.5.0
~~~~~~~~~~~~~~~~~~~

*Released 2020-04-24*

|k8s-op-short| Changes
``````````````````````

Adds the ability to start the |k8s-op-short| with some but not all
MongoDB |k8s-crds| installed. Administrators can specify the container
argument ``watch-resource`` to limit the |k8s-op-short| to deploy either
MonogDB instances or |onprem|, or both.

.. warning:: Breaking Changes

   Adds the following new |k8s-op-short| configuration properties:

   - ``INIT_OPS_MANAGER_IMAGE_REPOSITORY``
   - ``INIT_APPDB_IMAGE_REPOSITORY``
   - ``APPDB_IMAGE_REPOSITORY``

   When using a private docker registry, these properties must point
   to the relevant registries after you copy the images from the MongoDB distribution channels.

MongoDB Resource Changes
````````````````````````

- Increases support for custom |tls| certificates with the
  ``spec.security.tls.secretRef`` and :setting:`spec.security.tls.ca`
  configuration settings.
- Deprecates |tls| certificate generation by the |k8s-op-short|.
  Migrating to custom |tls| certificates is recommended.

Ops Manager Resource Changes
````````````````````````````
- Releases the :ref:`MongoDBOpsManager <plan-om-resource>` resource as
  Generally Available (GA). MongoDB now supports using the |k8s-op-short|
  to deploy |onprem| resources to |k8s| in production environments.
- Supports Backup Blockstore Snapshot Stores.
- Defaults to the {+appdb+} as a metadata database for Backup
  |s3| Snapshot Stores.
- Supports :opsmgrkube:`spec.jvmParameters` and :opsmgrkube:`spec.backup.jvmParameters` to add or
  override JVM parameters in |onprem| and Backup Daemon processes.
- Automatically configures |onprem| and Backup Daemon JVM memory
  parameters based on Pod memory availability.
- Supports |tls| for |onprem| and the {+appdb+}.
- Adds more detailed information to the ``status`` field.
- Supports |onprem| Local Mode for ``MongoDBOpsManager`` resources with
  multiple replicas by enabling users to specify
  ``PersistentVolumeClaimTemplates`` in :opsmgrkube:`spec.statefulSet.spec`.
- Implements a new image versioning scheme.

.. warning:: Breaking Changes

   - Removes the ``spec.podSpec`` configuration setting. Use
     :opsmgrkube:`spec.statefulSet.spec` instead.
   - Removes the ``spec.backup.podSpec`` configuration setting. Use
     :opsmgrkube:`spec.backup.statefulSet.spec` instead.

See the :github:`sample YAML files
</mongodb/mongodb-enterprise-kubernetes/tree/master/samples>`
for new feature usage examples.

.. _ent-op-1.4.x:

|k8s-op-full| 1.4 Series
------------------------

.. _ent-op-1.4.5:

|k8s-op-full| 1.4.5
~~~~~~~~~~~~~~~~~~~

Fixes CVE-2020-7922: |k8s| Operator generates potentially insecure certificates.

CVE Description
```````````````

X.509 certificates generated by the |k8s-op| may allow an attacker with
access to the |k8s| cluster improper access to MongoDB instances.
Customers who do not use X.509 authentication, and those who do not use
the |k8s-op-short| to generate their X.509 certificates are unaffected.

Common Weakness Enumeration
```````````````````````````

CWE-295: Improper Certificate Validation
CVSS score: 6.4
CVSS:3.1/AV:A/AC:H/PR:L/UI:N/S:U/C:H/I:H/A:N

Affected Versions
`````````````````

- 1.0, 1.1
- 1.2.0 - 1.2.4
- 1.3.0 - 1.3.1
- 1.4.0 - 1.4.4

Fixed Versions
``````````````

- 1.2.5
- 1.4.5 and above

.. _ent-op-1.4.4:

|k8s-op-full| 1.4.4
~~~~~~~~~~~~~~~~~~~

MongoDB Resource Changes
````````````````````````

Supports changes in the :cloudmgr:`Cloud Manager API </api/>`.

|onprem| Resource Changes (Beta Release)
````````````````````````````````````````

- Properly terminates resources with a termination hook.
- Implements stricter validations.

Bug Fixes
`````````

- MongoDB resources:

  - Fixes an issue when working with |onprem| with custom |https|
    certificates.

.. _ent-op-1.4.3:

|k8s-op-full| 1.4.3
~~~~~~~~~~~~~~~~~~~

*Released 2020-02-24*

|k8s-op-short| Changes
``````````````````````

Adds a :ref:`webhook <k8s-validation-webhook>` to validate
a |k8s-op-short| configuration.

MongoDB Resource Changes
````````````````````````

- Adds support for sidecars for |k8s-mdbrsc| pods using the
  :setting:`spec.podSpec.podTemplate` setting.
- Allows users to change the ``PodSecurityContext`` to allow privileged
  sidecar containers.

|onprem| Resource Changes (Beta Release)
````````````````````````````````````````

- Adds the ``spec.podSpec`` configuration settings for
  |onprem|, the Backup Daemon, and the {+appdb+}. See
  :ref:`k8s-om-specification`.
- |onprem| image for version 4.2.8 is available.

Bug Fixes
`````````

- MongoDB resources:

  - Fixes potential race conditions when deleting |k8s-mdbrscs|.

- |onprem| resources:

  - Supports the :opsmgrkube:`spec.clusterDomain` setting for |onprem|
    and {+appdb+} resources.
  - No longer starts monitoring and backup processes for the Application
    Database.

See the :github:`sample YAML files
</mongodb/mongodb-enterprise-kubernetes/tree/master/samples>` for new
feature usage examples.

.. _ent-op-1.4.2:

|k8s-op-full| 1.4.2
~~~~~~~~~~~~~~~~~~~

*Released 2020-01-24*

MongoDB Resource Changes
````````````````````````

- Runs MongoDB database |k8s| Pods under a dedicated |k8s| service
  account: ``mongodb-enterprise-database-pods``.
- Adds the :setting:`spec.podSpec.podTemplate` setting, which allows
  you to apply templates to |k8s| Pods that the |k8s-op-short|
  generates for each database |k8s-statefulset|.
- Renames the ``spec.clusterName`` setting to
  :setting:`spec.clusterDomain`.

|onprem| Resource Changes (Beta Release)
````````````````````````````````````````

- Adds :ref:`offline mode support <app-db-offline>` for the Application
  Database. Bundles MongoDB Enterprise version 4.2.2 with the
  {+appdb+} image. Internet access is not required to
  install the application database if
  :opsmgrkube:`spec.applicationDatabase.version` is set to
  ``"4.2.2-ent"`` or omitted.
- Renames the ``spec.clusterName`` setting to
  :opsmgrkube:`spec.clusterDomain`.
- |onprem| images for versions 4.2.6 and 4.2.7 are available.

Bug Fixes
`````````

- MongoDB resources:

  - Fixes the order of sharded cluster component creation.
  - Allows |tls| to be enabled on Amazon EKS.

- |onprem| resources:

  - Enables the |k8s-op-short| to use the ``spec.clusterDomain`` setting.

See the :github:`sample YAML files
</mongodb/mongodb-enterprise-kubernetes/tree/master/samples>` for new
feature usage examples.

.. _ent-op-1.4.1:

|k8s-op-full| 1.4.1
~~~~~~~~~~~~~~~~~~~

*Released 2019-12-13*

- Includes `CVE fixes <https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-11729>`_ and
  `RHSA security fixes <https://access.redhat.com/errata/RHSA-2019:4190>`_.
- Fixes an issue that prevented backup from starting on MongoDB 4.0.

.. _ent-op-1.4.0:

|k8s-op-full| 1.4.0
~~~~~~~~~~~~~~~~~~~

*Released 2019-12-09*

MongoDB Resource Changes
````````````````````````

- Adds split horizon DNS support for MongoDB replica sets, which allows
  clients to connect to a replica set from outside of the |k8s|
  cluster.
- Supports requests for |k8s-op-short|-generated certificates for
  additional certificate domains, which makes them valid for the
  specified subdomains.

|onprem| Resource Changes (Beta Release)
````````````````````````````````````````

- Promotes the ``MongoDBOpsManager`` :ref:`resource
  <k8s-om-specification>` to Beta. |onprem| version
  4.2.4 is available.
- Supports Backup and restore in |k8s-op-short|-deployed |onprem|
  instances. This is a semi-automated process that deploys everything
  you need to enable backups in |onprem|. You can enable Backup by
  setting the :opsmgrkube:`spec.backup.enabled` setting in the |onprem|
  custom resource. You can configure the Head Database, Oplog Store, and
  S3 Snapshot Store by using the ``MongoDBOpsManager`` :ref:`resource
  specification <k8s-om-specification>`.
- Supports access to |onprem| from outside the |k8s|
  cluster through the :opsmgrkube:`spec.externalConnectivity` setting.
- :ref:`Enables SCRAM-SHA-1 authentication <app-db-auth>` on |onprem|\'s
  {+appdb+} by default.
- Adds support for OpenShift (Red Hat UBI Images).

For more information on how to enable new features, see the sample YAML
files in the :github:`samples directory
</mongodb/mongodb-enterprise-kubernetes/tree/master/samples/ops-manager>`.

Bug Fixes
`````````

- Improves overall stability of X.509 user management.

.. _ent-op-1.3.x:

|k8s-op-full| 1.3 Series
------------------------

.. _ent-op-1.3.1:

|k8s-op-full| 1.3.1
~~~~~~~~~~~~~~~~~~~

*Released 2019-11-08*

.. important::

  This release introduces significant changes that may not be
  compatible with previous deployments or resource configurations.
  :ref:`Migrate to one resource per project <migrate-single-cluster>` before
  upgrading the |k8s-op-short|.

MongoDB Resource Changes
````````````````````````

- Requires one MongoDB resource per |onprem| project. If you
  have more than one MongoDB resource in a project, all resources will
  change to a ``Pending`` status and the |k8s-op-short| won’t perform
  any changes on them. The existing MongoDB databases will still be
  accessible. You must :ref:`migrate to one resource per project
  <migrate-single-cluster>`.

- Supports ``SCRAM-SHA`` authentication mode. See :github:`the MongoDB
  Enterprise Kubernetes Operator GitHub repository
  </mongodb/mongodb-enterprise-kubernetes/tree/master/samples/mongodb/authentication/scram>`
  for examples.

- Requires that the project (:ref:`ConfigMap <create-k8s-project>`) and
  credentials (:ref:`secret <create-k8s-secret>`)
  referenced from a MongoDB resource be in the same namespace.

- Adds OpenShift installation files (|yaml| file and Helm chart
  configuration).


Ops Manager Resource Changes (Alpha Release)
````````````````````````````````````````````

- Supports highly available :ref:`Ops Manager resources
  <k8s-om-specification>` by introducing the :opsmgrkube:`spec.replicas`
  setting.

- Runs |k8s-pods| as a non-root user.

.. _ent-op-1.3.0:

|k8s-op-full| 1.3.0
~~~~~~~~~~~~~~~~~~~

*Released 2019-10-25*

.. important::

  This release introduces significant changes that may not be
  compatible with previous deployments or resource configurations.
  :ref:`Migrate to one resource per project <migrate-single-cluster>`
  before installing or upgrading the |k8s-op-short|.

Specification Schema Changes
````````````````````````````

- Moves to a :ref:`one resource per project configuration <migrate-single-cluster>`.
  This follows the warnings introduced in a :ref:`previous version of the operator <ent-op-1.2.3>`.
  The operator now requires each cluster to be contained within a new project.

- Authentication settings are now contained within the
  :ref:`security section <security-settings>` of the MongoDB resource
  specification rather than the project ConfigMap.

- Replaces the ``project`` field with the
  :setting:`spec.opsManager.configMapRef.name` or
  :setting:`spec.cloudManager.configMapRef.name` fields.

- :ref:`User resources <k8s-manage-db-users>` now refer to MongoDB
  resources rather than project ConfigMaps.

- No longer requires ``data.projectName`` in the project ConfigMap. The
  name of the project defaults to the name of the MongoDB resource in
  |k8s|.

Ops Manager Resource Changes (Alpha Release)
````````````````````````````````````````````

This release introduces significant changes to the |onprem| resource's
architecture. The |onprem| application database is now managed by
the |k8s-op-short|, not by |onprem|.

Bug Fixes
`````````

- Stops unnecessary recreation of NodePorts.

- Fixes logging so it's always in JSON format.

- Sets ``USER`` in the |k8s-op-short| Docker image.

.. _ent-op-1.2.x:

|k8s-op-full| 1.2 Series
------------------------

.. _ent-op-1.2.5:

|k8s-op-full| 1.2.5
~~~~~~~~~~~~~~~~~~~

Fixes CVE-2020-7922: |k8s| Operator generates potentially insecure
certificates.

CVE Description
```````````````

X.509 certificates generated by the |k8s-op| may allow an attacker with
access to the |k8s| cluster improper access to MongoDB instances.
Customers who do not use X.509 authentication, and those who do not use
the |k8s-op-short| to generate their X.509 certificates are unaffected.

Common Weakness Enumeration
```````````````````````````

CWE-295: Improper Certificate Validation
CVSS score: 6.4
CVSS:3.1/AV:A/AC:H/PR:L/UI:N/S:U/C:H/I:H/A:N

Affected Versions
`````````````````

- 1.0, 1.1
- 1.2.0 - 1.2.4
- 1.3.0 - 1.3.1
- 1.4.0 - 1.4.4

Fixed Versions
``````````````

- 1.2.5
- 1.4.5 and above

.. _ent-op-1.2.4:

|k8s-op-full| 1.2.4
~~~~~~~~~~~~~~~~~~~

*Released 2019-10-02*

- Increases stability of Sharded Cluster deployments.
- Improves internal testing infrastructure.

.. _ent-op-1.2.3:

|k8s-op-full| 1.2.3
~~~~~~~~~~~~~~~~~~~

*Released 2019-09-13*

- **Update:** The |k8s-op-full| will remove support for multiple
  clusters per project in a future release. If a project contains more
  than one cluster, a warning will be added to the status of the
  MongoDB Resources. Additionally, any new cluster being added to a
  non-empty project will result in a :guilabel:`Failed` state, and won't
  be processed.

- **Fix:** The overall stability of the operator has been improved. The
  operator is now more conservative in resource updates both on
  |k8s| and |com|.

.. _ent-op-1.2.2:

|k8s-op-full| 1.2.2
~~~~~~~~~~~~~~~~~~~

*Released 2019-08-30*

- **Security Fix:** Clusters configured by |k8s-op-short| versions
  1.0 through 1.2.1 used an insufficiently strong keyfile for internal
  cluster authentication between ``mongod`` processes. This only affects
  clusters which are using X.509 for user authentication, but are not
  using X.509 for internal cluster authentication. Users are advised to
  upgrade to version 1.2.2, which will replace all managed keyfiles.

- **Security Fix:** Clusters configured by |k8s-op-short| versions 1.0
  through 1.2.1 used an insufficiently strong password to authenticate
  the {+mdbagent+}. This only affects clusters which have been manually
  configured to enable ``SCRAM-SHA-1``, which is not a supported
  configuration. Users are advised to upgrade to version 1.2.2, which
  will reset these passwords.

.. _ent-op-1.2.1:

|k8s-op-full| 1.2.1
~~~~~~~~~~~~~~~~~~~

*Released 2019-08-23*

- **Fix:** The |k8s-op-short| no longer recreates |csrs| when X.509
  authentication is enabled and the approved |csrs| have been deleted.

- **Fix:** If the ``OPERATOR_ENV`` environment variable is set to
  something unrecognized by the |k8s-op-short|, it will no longer result
  in a ``CrashLoopBackOff`` of the pod. A default value of ``prod`` is
  used.

- The |k8s-op-short| now supports more than 100 agents in a given
  project.

.. _ent-op-1.2:
.. _ent-op-1.2.0:

|k8s-op-full| 1.2.0
~~~~~~~~~~~~~~~~~~~

*Released 2019-08-13*

GA Release
``````````

- Adds a
  :k8sdocs:`readinessprobe </tasks/configure-pod-container/configure-liveness-readiness-probes>`
  to the MongoDB Pods to improve the reliability of rolling upgrades.

Alpha Release
`````````````

This feature is an alpha release. It is not ready for production use.

- Can use the |k8s-op-short| to manage |onprem| 4.2. To
  :doc:`deploy an |onprem| instance </tutorial/deploy-om-container>`,
  you use a new :ref:`resource <k8s-om-specification>`: ``MongoDBOpsManager``.

.. _ent-op-1.1.x:

|k8s-op-full| 1.1 Series
------------------------

.. _ent-op-1.1:

|k8s-op-full| 1.1
~~~~~~~~~~~~~~~~~

*Released 2019-07-19*

- **Fix:** Adds sample yaml files, in particular, the attribute related
  to
  :manual:`featureCompatibilityVersion </reference/command/setFeatureCompatibilityVersion>`.
- **Fix:** |tls| can be disabled in a deployment.
- **Improvement:** Adds
  :github:`script </blob/master/support/mdb_operator_diagnostic_data.sh>`
  in the
  :github:`support </tree/master/support>` directory that can gather
  information of your MongoDB resources in Kubernetes.
- **Improvement:** In a |tls| environment, the |k8s-op-short| can use a
  custom |certauth|. All the certificates must be passed as |k8s-secret|
  objects.

.. _ent-op-1.0.x:

|k8s-op-full| 1.0 Series
------------------------

.. _ent-op-1.0:

|k8s-op-full| 1.0
~~~~~~~~~~~~~~~~~

*Released 2019-06-18*

- Supports Kubernetes v1.11 or later.

- Provisions any kind of MongoDB deployment in the Kubernetes Cluster
  of your Organization:

  - :doc:`Standalone </tutorial/deploy-standalone>`
  - :doc:`Replica Set </tutorial/deploy-replica-set>`
  - :doc:`Sharded Cluster </tutorial/deploy-sharded-cluster>`

- Configures |tls| on the MongoDB deployments and encrypt all traffic.
  Hosts and clients can verify each other’s identities.

- Manages MongoDB users.

- Supports X.509 authentication to your MongoDB databases.

.. seealso::
  
   To learn how to install and configure the Operator, see :doc:`/installation`.

.. note:: Questions about the |k8s-op-short| GA release

   If you have any questions regarding this release, use the
   `#enterprise-kubernetes <https://mongo-db.slack.com/messages/CB323LCG5/>`__
   Slack channel.

.. _ent-op-0.x:

|k8s-op-full| Beta Series
-------------------------

.. _ent-op-0.12:

|k8s-op-full| 0.12
~~~~~~~~~~~~~~~~~~

*Released 2019-06-07*

- Rolling upgrades of MongoDB resources ensure that
  :method:`rs.stepDown() <rs.stepDown>` is called for the primary
  member. Requires MongoDB patch version 4.0.8 and later or MongoDB
  patch version 4.1.10 and later.
- During a MongoDB major version upgrade, the
  ``featureCompatibilityVersion`` field can be set.
- Fixed a bug where replica sets with more than seven members could
  not be created.
- X.509 Authentication can be enabled at the
  :ref:`Project level <create-k8s-project>`. Requires |cloud-short|,
  |onprem| patch version 4.0.11 and later, or |onprem| patch version
  4.1.7 and later.
- Internal cluster authentication based on X.509 can be enabled at the
  :doc:`deployment </deploy>` level.
- MongoDB users with X.509 authentication can be created, using the
  new ``MongoDBUser`` custom resource.

.. _ent-op-0.11:

|k8s-op-full| 0.11
~~~~~~~~~~~~~~~~~~

*Released 2019-04-29*

- ``NodePort`` service creation can be disabled.

- |tls| can be enabled for internal authentication between MongoDB in
  replica sets and sharded clusters. The |tls| certificates are created
  automatically by the |k8s-op-short|. Refer to the sample
  ``.yaml`` files in the
  :github:`GitHub repository </tree/master/samples>`
  for examples.

- Wide or asterisk roles have been replaced with strict listing of
  verbs in ``roles.yaml``.

- Printing ``mdb`` objects with ``kubectl`` will provide more
  information about the MongoDB object: type, state, and MongoDB server
  version.

.. _ent-op-0.10:

|k8s-op-full| 0.10
~~~~~~~~~~~~~~~~~~

*Released 2019-04-02*

- The |k8s-op-short| and database images are now based on ubuntu:16.04.

- The |k8s-op-short| now uses a single |k8s-crd| named ``MongoDB``
  instead of the ``MongoDbReplicaSet``, ``MongoDbShardedCluster``, and
  ``MongoDbStandalone`` CRDs.

  .. important::

     Follow the :ref:`upgrade procedure <upgrade-k8s-operator>` to
     transfer existing ``MongoDbReplicaSet``, ``MongoDbShardedCluster``,
     and ``MongoDbStandalone`` resources to the new format.

- For a list of the packages installed and any security vulnerabilities
  detected in our build process, see:

  - :qr-mdb:`MongoDB Enterprise Operator </mongodb-enterprise-operator?tab=tags>`

  - :qr-mdb:`{+mdb-ent-db+} </mongodb-enterprise-database?tab=tags>`

.. _ent-op-0.9:

|k8s-op-full| 0.9
~~~~~~~~~~~~~~~~~

*Released 2019-03-19*

- The Operator and Database images are now based on
  ``debian:stretch-slim`` which is the latest and up-to-date Docker
  image for Debian 9.

.. _ent-op-0.8:

|k8s-op-full| 0.8
~~~~~~~~~~~~~~~~~

*Released 2019-02-26*

- Perform |onprem| clean-up on deletion of MongoDB resource without the
  use of finalisers.

- **Bug fix:** Race conditions when communicating with |onprem|.

- **Bug fix:** ``ImagePullSecrets`` being incorrectly initialized in
  OpenShift.

- **Bug fix:** Unintended fetching of closed projects.

- **Bug fix:** Creation of duplicate organizations.

- **Bug fix:** Reconciliation could fail for the MongoDB resource if
  some other resources in |onprem| were in error state.


.. _ent-op-0.7:

|k8s-op-full| 0.7
~~~~~~~~~~~~~~~~~

*Released 2019-02-01*

- Improved detailed status field for MongoDB resources.

- The |k8s-op-short| watches changes to configuration parameters in a
  project configMap and the credentials secret then performs a rolling
  upgrade for relevant Kubernetes resources.

- Added |json| structured logging for {+mdbagent+} Pods.

- Support |dns-srv| records for MongoDB access.

- Bug fix: Avoiding unnecessary reconciliation.

- Bug fix: Improved Ops Manager/Cloud Manager state management for
  deleted resources.

.. _ent-op-0.6:

|k8s-op-full| 0.6
~~~~~~~~~~~~~~~~~

*Released 2018-12-17*

.. _controller-runtime: https://github.com/kubernetes-sigs/controller-runtime/

- Refactored code to use the controller-runtime_ library to fix issues
  where Operator could leave resources in inconsistent state. This also
  introduced a proper reconciliation process.

- Added new ``status`` field for all MongoDB Kubernetes resources.

- Can configure Operator to watch any single namespace or all
  namespaces in a cluster (requires cluster role).

- Improved database logging by adding a new configuration property
  ``logLevel``. This property is set to ``INFO`` by default.
  {+mdbagent+} and MongoDB logs are merged in to a single log
  stream.

- Added new configuration Operator timeout. It defines waiting time
  for database pods start while updating |k8s-mdbrscs|.

- **Fix:** Fixed failure detection for ``mongos``.

.. _ent-op-0.5:

|k8s-op-full| 0.5
~~~~~~~~~~~~~~~~~

*Released 2018-11-14*

- Image for database no longer includes the binary for the Automation
  Agent. The container downloads the Automation Agent binary from
  |mms| when it starts.

- **Fix:** Communication with |mms| failed if the project with the same
  name existed in different organization.

.. _ent-op-0.4:

|k8s-op-full| 0.4
~~~~~~~~~~~~~~~~~

*Released 2018-10-04*

- If a backup was enabled in |onprem| for a Replica Set or Sharded
  Cluster that the |k8s-op-short| created, then the |k8s-op-short|
  disables the backup before removing a resource.

- Improved persistence support:

  - The data, journal and log directories are mounted to three
    mountpoints in one or three volumes depending upon the
    ``podSpec.persistence`` setting.

    .. list-table::
       :widths: 40 60
       :header-rows: 1

       * - Setting
         - Mount Directories to
       * - ``podSpec.persistence.single``
         - One volume
       * - ``podSpec.persistence.multiple``
         - Three volumes

    Prior to this release, only the data directory was mounted to
    persistent storage.

  - A new parameter, ``labelSelector``, allows you to specify the
    selector for volumes that |k8s-op-short| should consider mounting.

  - If |k8s-sc| is not specified in the ``persistence``
    configuration, then the default ``StorageClass`` for the cluster is
    used. In most of public cloud providers, this results in dynamic
    volume provisioning.

.. _ent-op-0.3:

|k8s-op-full| 0.3
~~~~~~~~~~~~~~~~~

*Released 2018-08-07*

- The Operator no longer creates the CustomResourceDefinition objects.
  The user needs to create them manually. Download and apply
  :github:`this new yaml file </mongodb/mongodb-enterprise-kubernetes/blob/master/crds.yaml>`
  (``crd.yaml``) to create/configure these objects.

- ClusterRoles are no longer required. How the Operator watches
  resources has changed. Until the last release, the Operator would
  watch for any resource on any |k8s-ns|. With 0.3, the Operator
  watches for resources in the same namespace in which it was created.
  To support multiple namespaces, multiple Operators can be installed.
  This allows isolation of MongoDB deployments.

- Permissions changes were made to how PersistentVolumes are mounted.

- Added configuration to Operator to not create
  :k8sdocs:`SecurityContexts </tasks/configure-pod-container/security-context/>`
  for |k8s-pods|. This solves an issue with OpenShift which does not
  allow this setting when ``SecurityContextContraints`` are used.

  If you are using Helm, set ``managedSecurityContext`` to ``true``.
  This tells the Operator to not create ``SecurityContext`` for
  |k8s-pods|, satisfying the OpenShift requirement.

- The combination of ``projectName`` and ``orgId`` replaces
  ``projectId`` alone to configure the connection to |onprem|.
  The project is created if it doesn't exist.

.. _ent-op-0.2:

|k8s-op-full| 0.2
~~~~~~~~~~~~~~~~~

*Released 2018-08-03*

- Calculates WiredTiger memory cache.

.. _ent-op-0.1:

|k8s-op-full| 0.1
~~~~~~~~~~~~~~~~~

*Released 2018-06-27*

**Initial Release**

- Can deploy standalone instances, replica sets, sharded clusters
  using |k8s| configuration files.
