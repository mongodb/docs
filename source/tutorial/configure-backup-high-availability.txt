=================================================
Configure a Highly Available |mms| Backup Service
=================================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

Overview
--------

The :ref:`Backup Daemon <backup-daemon>` maintains copies of the data
from your backed up :program:`mongod` instances and creates snapshots
used for restoring data. The file system that the Backup Daemon uses
must have sufficient disk space and write capacity to store the
backed up instances.

For replica sets, the local copy is equivalent to an additional
secondary replica set member. For sharded clusters the daemon
maintains a local copy of each shard as well as a copy of the
:term:`config database`.

To configure high availability

- scale your deployment horizontally by using multiple :ref:`backup
  daemons <backup-daemon>`,

- provide :manual:`failover </core/replica-set-high-availability>` for
  your |application| Database and Backup Database
  by deploying :term:`replica sets <replica set>` for the dedicated
  MongoDB processes that host the databases, and

- configure additional backup daemons to serve as dedicated restore
  daemons that focus on restore jobs exclusively.

.. _multiple-backup-daemons:

Multiple Backup Daemons
~~~~~~~~~~~~~~~~~~~~~~~

To increase your storage and to scale horizontally, you can run multiple
instances of the :term:`Backup Daemon`. This scales by increasing the
available storage for the :term:`head databases <head database>`. This
does not increase the available space for snapshot storage.

With multiple daemons, |mms| binds each backed-up replica set or shard
to a particular Backup Daemon.

.. example::
   If you run two daemons for a :term:`cluster` that has three
   :term:`shards <shard>`, and if |mms| binds two shards to the first
   daemon, then that daemon's server replicates only the data of those
   two shards. The server running the second daemon replicates the data
   of the remaining shard.

Multiple Backup Daemons allow for **manual** failover should one daemon
become unavailable. You can instruct |mms| to transfer the daemon's
backup responsibilities to another Backup Daemon. |mms| reconstructs the
data on the new daemon's server and binds the associated replica sets or
shards to the new daemon. To learn how this process works, see
:doc:`/tutorial/move-jobs-to-new-backup-daemon`.

|onprem| reconstructs the data using a snapshot and the oplog from the
:ref:`backup-database`.

The Backup Daemon is installed with |onprem| package but must be
specifically activated to run. Select the procedure specific to your
platform on the :doc:`/installation` section.

Replica Sets for Application and Backup Data
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Deploy :term:`replica sets <replica set>` rather than standalones for
the :doc:`dedicated MongoDB processes
</tutorial/prepare-backing-mongodb-instances>` that host the
|application| Database and Backup Database. Replica sets
provide :manual:`automatic failover </core/replica-set-high-availability>`
should the :term:`primary` become unavailable.

When deploying a replica set with members in multiple facilities, ensure
that a single facility has enough votes to elect a :term:`primary` if
needed. Choose the facility that hosts the core application systems.
Place a majority of voting members and all the members that can become
primary in this facility. Otherwise, network partitions could prevent
the set from being able to form a majority.

.. seealso::

   - For details on how replica sets elect primaries, see
     :manual:`Replica Set Elections </core/replica-set-elections>`.

   - To deploy a replica set, see :manual:`Deploy a Replica Set
     </tutorial/deploy-replica-set>`.

Dedicated Restore Daemons
~~~~~~~~~~~~~~~~~~~~~~~~~

To decrease restore times, add dedicated restore daemons, especially if
you have multiple backup jobs per daemon. To configure dedicated restore
daemons, adjust the settings per backup daemon on the :guilabel:`Daemon`
:ref:`configuration <daemons-interface>` page.

Additional Information
----------------------

To move jobs from a lost Backup server to another Backup server, see
:doc:`/tutorial/move-jobs-to-new-backup-daemon`.

For information on making the |application| highly available, see
:doc:`/tutorial/configure-application-high-availability`.
