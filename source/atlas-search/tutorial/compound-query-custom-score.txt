.. _compound-query-custom-score-tutorial:

======================================================
How to Run |fts| Compound Queries with Weighted Fields
======================================================

.. default-domain:: mongodb

.. meta::
   :keywords: atlas search, dynamic mapping, compound query, compound operator, must clause, should clause, range operator, text operator, search scoring, alter search score, constant scoring, boost scoring, multiply score, boost single field, boost multiple fields, function scoring, highlight term
   :description: In this tutorial, learn how to alter the relevance score of the documents in your results.

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

This tutorial describes how to create an index with dynamic mapping on 
the ``sample_mflix.movies`` collection. It shows how to run compound 
queries against the ``year`` field and alter the score using 
:ref:`scoring-constant`, :ref:`scoring-function`, and 
:ref:`scoring-boost`. It takes you through the following steps: 

1. Set up an |fts| index with dynamic mapping for the 
   ``sample_mflix.movies`` collection.
#. Run |fts| queries against the ``year`` field in the 
   ``sample_mflix.movies`` collection and alter the score using 
   specific a word in the ``title`` field.

Before you begin, ensure that your |service| cluster meets the 
requirements described in the :ref:`fts-tutorials-prereqs`.

.. include:: /includes/atlas-roles/create-search-index.rst

Create the |fts| Index With Dynamic Mapping 
-------------------------------------------

In this section, you will create an |fts| index that uses dynamic 
mapping to index the fields in the ``sample_mflix.movies`` collection. 

.. include:: /includes/steps/fts-tutorial-create-dynamic-index.rst

Run a Compound Query
--------------------

----------

.. |arrow| unicode:: U+27A4

|arrow| Use the **Select your language** drop-down menu to set the 
language of the examples in this section.

----------

.. tabs-selector:: drivers

You can use the :ref:`compound-ref` operator to combine two or more 
operators into a single query. Every document that |fts| returns for 
your query is assigned a score based on relevance, in order from 
highest score to lowest. |fts| provides a sample compound query 
template with guidance. To learn more, see 
:ref:`query-guidance-template`.

In this section, you will connect to your 
|service| cluster and run the sample queries using the 
:ref:`compound-ref` operator against the ``title`` and ``year`` 
fields in the ``sample_mflix.movies`` collection. The sample queries 
use custom scoring to alter the relevance score returned by |fts|.

.. tabs-drivers::

   .. tab::
      :tabid: atlas-ui

      .. include:: /includes/steps/fts-compound-score-tutorial-run-query-atlas-ui.rst

   .. tab::
      :tabid: shell

      .. include:: /includes/steps/fts-score-tutorial-run-queries.rst

   .. tab::
      :tabid: compass

      .. include:: /includes/steps/fts-compound-score-tutorial-run-query-compass.rst

   .. tab::
      :tabid: csharp

      .. include:: /includes/steps/fts-compound-score-tutorial-run-query-cs.rst

   .. tab:: 
      :tabid: go

      .. include:: /includes/steps/fts-compound-score-tutorial-run-query-go.rst

   .. tab:: 
      :tabid: java-sync 

      .. include:: /includes/steps/fts-compound-score-tutorial-run-query-java.rst

   .. tab::
      :tabid: nodejs

      .. include:: /includes/steps/fts-compound-score-tutorial-run-query-nodejs.rst

   .. tab::
      :tabid: python

      .. include:: /includes/steps/fts-compound-score-tutorial-run-query-python.rst

Continue Learning 
-----------------

To learn more about compound queries using |fts|, take `Unit 9 of the
Intro To MongoDB Course on MongoDB University
<https://learn.mongodb.com/courses/mongodb-atlas-search>`__. The 1.5
hour unit includes an overview of |fts| and lessons on creating |fts|
indexes, running :pipeline:`$search` queries using compound operators,
and grouping results using :ref:`fts-facet-ref`.  
