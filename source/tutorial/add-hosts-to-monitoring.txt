.. _tutorial-monitoring:

============================================
Add Existing MongoDB Processes to Monitoring
============================================

.. default-domain:: mongodb

Overview
--------

You can monitor existing MongoDB processes in |mms| by adding the
hostnames and ports of the processes. |mms| will start monitoring the
:program:`mongod` and :program:`mongos` instances.

If you add processes from an environment that uses authentication, you
must add each :program:`mongod` instance separately and explicitly set the
authentication credentials on each.

If you add processes in an environment that does *not* use authentication,
you can manually add one process from a replica set or a sharded cluster
as a seed. Once the :doc:`Monitoring Agent </tutorial/nav/monitoring-agent>`
has the seed, it automatically
discovers all nodes in the replica set or cluster based on the replica set
or cluster configuration. For details, see
:ref:`host-discovery-without-auth`.

Considerations
--------------

Unique Replica Set Names
~~~~~~~~~~~~~~~~~~~~~~~~

Do not add two different replica sets with the same name. |mms| uses the replica
set name to identify which set a member belongs to.

Preferred Hostnames
~~~~~~~~~~~~~~~~~~~

If the MongoDB process is accessible only by specific hostname or IP
address, or if you need to specify the hostname to use for servers with
multiple aliases, set up a preferred hostname. For details, see the
:guilabel:`Preferred Hostnames` setting in :doc:`/core/settings`.

.. _host-discovery-without-auth:

Host Discovery in Environments without Authentication
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Once the Monitoring Agent has a seed process, it discovers all other nodes
in the replica set or sharded cluster, including:

- Master databases, after adding slave databases.

- Shard clusters, after adding ``mongos`` instances.

- Replica sets, after adding any member of the set.

Once you add a seed, the Monitoring Agent will fetch this
information *from* the |mms| servers. Thus, when configuring the
monitoring environment, you may need to wait for several update cycles
(e.g. 5-10 minutes) to complete the auto-discovery process and host
identification. During this period, you may see duplicate hosts in the
|mms| web console. This is normal.

The Monitoring Agent fetches configuration and reports to |monitoring| every
minute, so, again, there may be a delay of several minutes before data
and host information propagate to the |mms| console.

.. index:: adding hosts
   single: hosts; adding

Add MongoDB Processes
---------------------

If your deployments use authentication, perform this procedure for each process.
If your deployment does not use authentication, add one process from a replica
set or sharded cluster and |mms| will discover the other nodes in the replica
set or sharded cluster.

.. include:: /includes/steps/add-host.rst

.. index:: host discovery
   single: hosts; discovery
