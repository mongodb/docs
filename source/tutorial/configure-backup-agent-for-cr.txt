=====================================
Configure Backup Agent for MONGODB-CR
=====================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

In MongoDB 3.0 and later, MongoDBâ€™s default authentication mechanism is
a challenge and response mechanism (``SCRAM-SHA-1``). Previously, MongoDB
used MongoDB Challenge and Response (``MONGODB-CR``) as the default.

The Backup Agent can use ``MONGODB-CR`` or ``SCRAM-SHA-1``
to authenticate to hosts that enforce access control.

To authenticate using ``SCRAM-SHA-1`` or ``MONGODB-CR``, create a user
in the ``admin`` database with the appropriate roles in MongoDB.

.. include:: /includes/extracts/note-manage-agent-auth-with-automation-mongodbcr.rst

Procedures
----------

Create MongoDB User for the Agent
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/prerequisites-create-user-for-agent.rst

.. include:: /includes/considerations-agent-access-control.rst

MongoDB 3.0 and Later
`````````````````````

To back up MongoDB instances running 3.0 and later, create a user in
the ``admin`` database with an operation that resembles the following:

.. code-block:: javascript

   use admin
   db.createUser(
      {
        user: "<username>",
        pwd: "<password>",
        roles: [ { role: "backup", db: "admin" } ]
      }
   )

See :ref:`Access Control for MongoDB 3.0
<access-control-backup-3.0>` for more information on the
required access.

MongoDB 2.6
```````````

To back up MongoDB 2.6 release series instances, create a user in the
``admin`` database with an operation that resembles the following:

.. code-block:: javascript

   use admin
   db.createUser(
      {
        user: "<username>",
        pwd: "<password>",
        roles: [ 
           "clusterAdmin",
           "readAnyDatabase",
           "userAdminAnyDatabase",
           { role: "readWrite", db: "admin" },
           { role: "readWrite", db: "local" },
        ]
      }
   )

See :ref:`Access Control for MongoDB 2.6
<access-control-backup-2.6>` for more information on the
required access.

MongoDB 2.4
```````````

To back up MongoDB 2.4 release series instances, create a user in the
``admin`` database with an operation that resembles the following:

.. code-block:: javascript

   use admin
   db.addUser(
      {
        user: "<username>",
        pwd: "<password>",
        roles: [
           "clusterAdmin",
           "readAnyDatabase",
           "userAdminAnyDatabase"
        ],
        otherDBRoles: { 
           local: ['readWrite'],
           admin: ['readWrite'],
           config: ['readWrite']
        }
      }
   )

See :ref:`Access Control for MongoDB 2.4
<access-control-backup-2.4>` for more information on the
required access.

Host Settings
~~~~~~~~~~~~~

.. include:: /includes/fact-access-control-host-settings.rst
