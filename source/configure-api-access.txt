.. _atlas-admin-api-access:

=============================================
Get Started with the {+atlas-admin-api+}
=============================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

.. important::

   Each {+atlas-admin-api+} has its own resources and requires initial
   setup. The {+atlas-admin-api+} and the {+app-services+} Admin API 
   also use different access keys from the {+data-api+}.

   You can access the {+atlas-admin-api+} servers through the public 
   internet only. The {+atlas-admin-api+} is not available over 
   connections that use :ref:`network peering <vpc-peering>` or 
   :ref:`private endpoints <private-endpoint>`.

   To learn more, see :doc:`/api`.

.. _atlas-prog-api-key:

Required for All Resources: Generate an Organization API Key
------------------------------------------------------------

To access the {+atlas-admin-api+}, :ref:`create-org-api-key`.

All |api| keys belong to the organization. You can give an |api| key
access to a project. To add the new |api| key to a project, 
:ref:`invite-org-app-api-keys`.

To learn more about managing |api| keys for your organization or 
project, see :ref:`programmatic-access`. For usage details, 
see :ref:`prog-access-usage`.

.. _enable-api-access-list:

Required for Select Resources: API Resource Request Access Lists
----------------------------------------------------------------

|service| allows your |api| key to make requests from any address on the
internet. |service| has some exceptions to this rule. These exceptions
limit which :ref:`resources <atlas-require-api-access-list>` an API key
can use without location-based limits defined in an |api| access list.

To add these location-based limits to your |api| key, create an |api| 
access list. This list limits the internet addresses from which a
specific API key can make API requests.

Any |api| keys with an |api| access list require all |api| requests to
come from an IP address on that list. Your API access list must include
entries for all clients that use the |api|.

.. _atlas-require-api-access-list:

Use API Resources that Require an Access List
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The following |api| resources require an API access list:

Organization API Access List Entries
````````````````````````````````````
:oas-atlas-op:`Create 
</createApiKeyAccessList>` or 
:oas-atlas-op:`remove 
</deleteApiKeyAccessListEntry>` access 
list entries for an organization |api| key.

Cloud Backup Restores
`````````````````````

- Return a :oas-atlas-op:`dedicated </getBackupRestoreJob>`
  or :oas-atlas-op:`serverless 
  </getServerlessBackupRestoreJob>` cloud backup restore 
  job.

- Return all :oas-atlas-op:`dedicated 
  </listBackupRestoreJobs>` or :oas-atlas-op:`serverless 
  </listServerlessBackupRestoreJobs>` cloud backup restore 
  jobs.

- Restore a :oas-atlas-op:`dedicated </createBackupRestoreJob>`
  or :oas-atlas-op:`serverless </createServerlessBackupRestoreJob>`
  cloud backup snapshot.

- :oas-atlas-op:`Cancel </cancelBackupRestoreJob>` the restore 
  of a dedicated or serverless cloud backup snapshot.

Cloud Backup Snapshots
``````````````````````

:oas-atlas-op:`Take </takeSnapshot>` or remove one 
:oas-atlas-op:`replica set </deleteReplicaSetBackup>` or 
:oas-atlas-op:`sharded cluster </deleteShardedClusterBackup>` 
cloud backup snapshot.

Cloud Backup Schedules
``````````````````````

- :oas-atlas-op:`Return </getBackupSchedule>` the cloud 
  backup schedule for an |service| cluster.

- Create or modify the :oas-atlas-op:`cloud backup schedule 
  </updateBackupSchedule>` for an 
  |service| cluster.

Legacy Backups
``````````````

- :oas-atlas-op:`Restore </createLegacyBackupRestoreJob>`,
  :oas-atlas-op:`remove </deleteLegacySnapshot>`, or 
  :oas-atlas-op:`change the expiration date </updateLegacySnapshotRetention>`
  of a legacy backup snapshot.

- :oas-atlas-op:`Clear </deleteAllBackupSchedules>`
  or :oas-atlas-op:`update 
  </updateCloudBackupBackupPolicyForOneCluster>` legacy backup snapshot 
  schedule.

.. _atlas-require-all-api-access-list:

Require an API Access List for All Requests
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

You can require *all* |api| requests from an |api| key to come from an
entry on its |api| access list. If you require |api| access lists, API
keys can't make any |api| requests until you define at least one |api|
access list entry.

Procedure
`````````

To set your organization to require API access lists for every API key:

.. include:: /includes/steps/require-ip-access-list.rst

.. _programmatic-access:

Grant Programmatic Access to |service|
--------------------------------------

To grant programmatic access to an organization or project using only
the :doc:`API </api>`, create an |api| key.

- |api| keys have two parts: a Public Key and a Private Key. These 
  two parts serve the same function as a username and a personal |api| 
  key when you make |api| requests to |service|.

- You can't use an |api| key to log into |service| through the user 
  interface.

- You must grant roles to |api| keys as you would for users to ensure 
  the |api| keys can call |api| endpoints without errors.

- Each |api| key belongs to only one organization, but you can grant 
  an |api| key access to any number of projects in that 
  organization.

.. _see-org-api-keys:
.. _about-org-api-keys:

Manage Programmatic Access to an Organization
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Required Access
```````````````

To perform any of the following actions, you must have
:authrole:`Organization Owner` access to |service|.

.. _create-org-api-key:

Create an |api| Key in an Organization
``````````````````````````````````````

.. tabs::

   .. tab:: {+atlas-cli+}
      :tabid: atlascli

      Create an |api| Key
      +++++++++++++++++++

      .. include:: /includes/extracts/atlas-organizations-apiKeys-create.rst

      Add an |api| Access List Entry for the |api| Key
      ++++++++++++++++++++++++++++++++++++++++++++++++

      .. include:: /includes/extracts/atlas-organizations-apiKeys-accessLists-create.rst

   .. tab:: {+atlas-ui+}
      :tabid: ui

      .. include:: /includes/steps/app-api-key-create-in-org.rst

.. _view-org-api-key:

View |api| Keys in an Organization
``````````````````````````````````

.. tabs::

   .. tab:: {+atlas-cli+}
      :tabid: atlascli

      You can view a list of |api| keys, the details of an |api| key,
      or the access list for an |api| key in an
      organization using the {+atlas-cli+}.

      View |api| Keys
      +++++++++++++++

      .. include:: /includes/extracts/atlas-organizations-apiKeys-describe-and-list.rst

      View |api| Access List Entries for the |api| Key
      ++++++++++++++++++++++++++++++++++++++++++++++++

      .. include:: /includes/extracts/atlas-organizations-apiKeys-accessLists-list.rst

   .. tab:: {+atlas-ui+}
      :tabid: ui

      To view the details of an |api| key in an organization using the 
      {+atlas-ui+}:

      .. include:: /includes/steps/app-api-key-view-details-in-org.rst

.. _change-org-api-key-roles:

Change an |api| Key in an Organization
``````````````````````````````````````

.. tabs::

   .. tab:: {+atlas-cli+}
      :tabid: atlascli

      You can change the roles or access list for an |api| key in an
      organization using the {+atlas-cli+}.

      Change an |api| Key's Roles
      +++++++++++++++++++++++++++

      .. include:: /includes/extracts/atlas-organizations-apiKeys-assign.rst

      Add an |api| Access List Entry for the |api| Key
      ++++++++++++++++++++++++++++++++++++++++++++++++

      .. include:: /includes/extracts/atlas-organizations-apiKeys-accessLists-create.rst

      Delete an |api| Access List Entry for the |api| Key
      +++++++++++++++++++++++++++++++++++++++++++++++++++

      .. include:: /includes/extracts/atlas-organizations-apiKeys-accessLists-delete.rst

   .. tab:: {+atlas-ui+}
      :tabid: ui

      You can change the roles, description, or access list for an 
      |api| Key in an organization using the {+atlas-ui+}.

      .. include:: /includes/steps/app-api-key-change-in-org.rst

.. _delete-org-api-key:

Delete an |api| Key from an Organization
````````````````````````````````````````

.. tabs::

   .. tab:: {+atlas-cli+}
      :tabid: atlascli

      .. include:: /includes/extracts/atlas-organizations-apiKeys-delete.rst

      To delete an access list entry for an |api| key in an
      organization, see :ref:`change-org-api-key-roles`.

   .. tab:: {+atlas-ui+}
      :tabid: ui

      .. include:: /includes/steps/app-api-key-delete-from-org.rst

.. _about-project-api-keys:

Manage Programmatic Access to a Project
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Required Access
```````````````

To perform any of the following actions, you must have
:authrole:`Project Owner` access to the project.

.. _invite-org-app-api-keys:

Invite an Organization |api| Key to a Project
`````````````````````````````````````````````

.. tabs::

   .. tab:: {+atlas-cli+}
      :tabid: atlascli

      .. include:: /includes/extracts/atlas-projects-apiKeys-assign.rst

   .. tab:: {+atlas-ui+}
      :tabid: ui

      To invite an organization |api| key to a project using the 
      {+atlas-ui+}:

      .. include:: /includes/steps/app-api-key-invite-to-project.rst


.. _create-project-api-key:

Create an |api| Key for a Project
`````````````````````````````````
.. tabs::

   .. tab:: {+atlas-cli+}
      :tabid: atlascli

      .. include:: /includes/extracts/atlas-projects-apiKeys-create.rst

      After you create the |api| key for your project, use the 
      {+atlas-ui+} to add an |api| access list entry. You can't use the
      |api| key for the project until you set up the |api| access list.

      .. note:: {+atlas-cli+} Limitation

         You can't edit the |api| access list for a project |api| key
         using the {+atlas-cli+}.

      To add an |api| access list entry using the {+atlas-ui+}:

      .. include:: /includes/steps/add-project-api-key-to-access-list.rst 

   .. tab:: {+atlas-ui+}
      :tabid: ui

      To create an |api| key for a project using the {+atlas-ui+}:

      .. include:: /includes/steps/app-api-key-create-in-project.rst

.. _view-project-api-key:

View the |api| Keys in a Project
````````````````````````````````

.. tabs::

   .. tab:: {+atlas-cli+}
      :tabid: atlascli

      .. include:: /includes/extracts/atlas-projects-apiKeys-list.rst

      You can view the |api| access list entries for a project 
      |api| key using an ``atlas organizations`` command.

      .. include:: /includes/extracts/atlas-organizations-apiKeys-accessLists-list.rst

   .. tab:: {+atlas-ui+}
      :tabid: ui

      To view the details of an |api| key in a project using the 
      {+atlas-ui+}:

      .. include:: /includes/steps/app-api-key-view-details-in-project.rst

.. _change-project-api-key-roles:

Change an |api| Key's Roles in a Project
````````````````````````````````````````

.. include:: /includes/steps/app-api-key-change-roles-in-project.rst

.. _edit-project-api-key-access-list:

Edit an API Key's Access List
`````````````````````````````

.. tabs::

   .. tab:: {+atlas-cli+}
      :tabid: atlascli

      You can edit the |api| access list entries for a project |api|
      key using ``atlas organizations`` commands.

      Add an |api| Access List Entry for the |api| Key
      ++++++++++++++++++++++++++++++++++++++++++++++++

      .. include:: /includes/extracts/atlas-organizations-apiKeys-accessLists-create.rst

      Delete an |api| Access List Entry for the |api| Key
      +++++++++++++++++++++++++++++++++++++++++++++++++++

      .. include:: /includes/extracts/atlas-organizations-apiKeys-accessLists-delete.rst

   .. tab:: {+atlas-ui+}
      :tabid: ui

      .. include:: /includes/steps/app-api-key-edit-access-list-in-project.rst

.. _delete-project-api-key:

.. _delete-project-app-api-key:

Delete an API Key from a Project
````````````````````````````````
.. tabs::

   .. tab:: {+atlas-cli+}
      :tabid: atlascli

      .. include:: /includes/extracts/atlas-projects-apiKeys-delete.rst

   .. tab:: {+atlas-ui+}
      :tabid: ui

      To delete an |api| key from a project using the {+atlas-ui+}:

      .. include:: /includes/steps/app-api-key-delete-from-project.rst

.. _prog-access-mult-orgs:

Manage Programmatic Access to Multiple Organizations
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/fact-org-intro.rst

Required Access
```````````````

To perform any of the following actions, you must have
:authrole:`Organization Owner` access to |service|.

.. _create-mult-orgs:

Create Multiple Organizations
`````````````````````````````

Repeat the following steps to create multiple organizations:

.. include:: /includes/steps/create-organization.rst

(Optional) Set Up Cross-Organization Billing
````````````````````````````````````````````

You can set up :ref:`cross-organization billing <cross-org-billing>` to 
share a billing subscription across multiple organizations.

The following prerequisites and limitations apply:

.. include:: /includes/fact-cross-org-billing-prereqs.rst

To configure a paying organization and link other organizations to it:

.. include:: /includes/steps/configure-paying-organization.rst

Create |api| Keys for your Organizations
`````````````````````````````````````````

To manage projects in all your organizations:

.. procedure::
   :style: normal

   .. step:: Create an |api| for each organization.

      Repeat the steps to :ref:`create an API key for an organization 
      <create-org-api-key>` for each organization.

   .. step:: Invite the organization key to each project within the organization.

      For each project within an organization, 
      :ref:`invite the related organization key 
      <invite-org-app-api-keys>`.

.. _prog-access-usage:

Make an |api| Request
---------------------

.. include:: /includes/api-requirements.rst

All {+atlas-admin-api+} endpoints have the following base URL:

.. include:: /includes/api-base-url.rst

Usage
~~~~~

Your request should resemble the following examples, where 
``{PUBLIC-KEY}`` is your |api| public key and ``{PRIVATE-KEY}``
is the corresponding private key. 

The following sample ``GET`` request 
:oas-atlas-op:`returns all projects </listProjects>` in your organization:

.. code-block:: sh

   curl --user "{PUBLIC-KEY}:{PRIVATE-KEY}" --digest \
         --header "Content-Type: application/json" \
         --include \
         --request GET "https://cloud.mongodb.com/api/atlas/v1.0/groups"

The following sample ``POST`` request takes a request body and
:oas-atlas-op:`creates a project </createProject>` named 
``MyProject`` in your organization:

.. code-block:: sh

   curl --user "{PUBLIC-KEY}:{PRIVATE-KEY}" --digest \
         --header "Content-Type: application/json" \
         --include \
         --request POST "https://cloud.mongodb.com/api/atlas/v1.0/groups" \
         --data '
            {
               "name": "MyProject",
               "orgId": "5a0a1e7e0f2912c554080adc"
            }'

.. seealso::
   
   - `{+atlas-admin-api+} Specification <https://mongodb.com/docs/atlas/reference/api-resources-spec>`_
   - :ref:`atlas-api-error-codes`
   
Alternatively, you can use any tool that supports `OpenAPI v3
specification <https://spec.openapis.org/oas/v3.0.1>`__ to generate code
samples or mock servers. For example, you can import 
the :atlas:`Atlas Admin API Specification </reference/api-resources-spec>`
into `Postman <https://www.postman.com/>`__ to generate ``curl``
commands. To use Postman to generate ``curl`` commands: 

.. procedure:: 
   :style: normal 

   .. step:: In the MongoDB |service| Administration API :atlas:`documentation </reference/api-resources-spec/>`, right-click the **Download** button and copy the link.
   
   .. step:: Open Postman and click **File**, then **Import**.

      The **Import** window displays.

   .. step:: In the **Import** window, click **Link** and paste the download link that you copied in step 1.

   .. step:: Click **Continue**, then **Import**.

   .. step:: For the request for which you want to generate a ``curl`` command, click **</>** on the right and select **cURL** from the **Code snippet** dropdown.
