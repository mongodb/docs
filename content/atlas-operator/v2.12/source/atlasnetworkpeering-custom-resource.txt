.. _atlasnetworkpeering-custom-resource:

=======================================
``AtlasNetworkPeering`` Custom Resource
=======================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

.. include:: /includes/subresource-deprecation.rst

The ``AtlasNetworkPeering`` custom resource defines a :ref:`network
peering connection <ak8so-network-peering>` for a |service|
project. Network peering connections isolate traffic from public
networks for added security.

.. include:: /includes/fact-ak8so-crds.rst

|ak8so| does one of the following actions using the |service|
:oas-bump-atlas-tag:`Network Peering API Resource <network-peering>`:
   
- Creates a new network peering connection.
- Updates an existing network peering connection.

.. note::

   A network peering connection can belong only to one project. To
   define the same network peering connection for multiple projects,
   create custom resource definitions for each project.

Examples
--------

The following examples illustrate configurations for
``AtlasNetworkPeering`` CRDs.

- The basic example configuration defines a resource that you manage
  with the same |ak8so| instance with which you manage its parent
  {+service+} project.

- The :ref:`Independent CRD <ak8so-independent-crd>` example
  configures the same |vpc| peering connection as the basic example,
  but for a {+service+} project that you manage outside of the |ak8so|
  instance with which you manage the |vpc| peering connection.

.. _atlasnetworkpeering-example-basic:

Basic Example
~~~~~~~~~~~~~

The following example shows an ``AtlasNetworkPeering`` custom resource
that defines the ``green-leaf-peering`` connection between the
``my-project`` project |vpc| and your {+aws+} |vpc|. To manage this
resource in the same |ak8so| instance as its parent {+service+}
project, you must identify the project with ``projectRef`` instead of
``externalProjectRef``.

.. code-block::

   apiVersion: atlas.mongodb.com/v1
   kind: AtlasNetworkPeering
   metadata:
     name: green-leaf-peering
   spec:
     projectRef:
       name: my-project
       namespace: my-operator-namespace
     containerRef:
       id: 72a6d2a69388ba121943ae27
     id: 72a6d2a69388ba121943ae27
     provider: AWS
     awsConfiguration:
       accepterRegionName: us-east-1
       awsAccountId: 389226183042
       routeTableCiderBlock: 10.0.0.0/21
       vpcId: vpc-abc

Independent CRD Example
~~~~~~~~~~~~~~~~~~~~~~~

The following example shows an ``AtlasNetworkPeering``
:ref:`independent CRD <ak8so-independent-crd>` that configures the
same |vpc| peering connection defined by the :ref:`Basic Example
<atlasnetworkpeering-example-basic>`. To enable resource management
independent of the parent project, you must use an
``externalProjectRef`` instead of a ``projectRef``, and you must
supply a ``connectionSecret`` directly since this resource can't
inherit API credentials from its parent project.

.. code-block::

   apiVersion: atlas.mongodb.com/v1
   kind: AtlasNetworkPeering
   metadata:
     name: green-leaf-peering
   spec:
     externalProjectRef:
       projectId: 66e2f2b621571b7e69a89b66
     connectionSecret:
       name: atlas-connection-secret
     containerRef:
       id: 72a6d2a69388ba121943ae27
     id: 72a6d2a69388ba121943ae27
     provider: AWS
     awsConfiguration:
       accepterRegionName: us-east-1
       awsAccountId: 389226183042
       routeTableCiderBlock: 10.0.0.0/21
       vpcId: vpc-abc

Parameters
----------

.. include:: /includes/manual-crds/atlas-network-peering.rst