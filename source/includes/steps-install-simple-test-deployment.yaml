stepnum: 1
title: "Provision an |onprem| host."
level: 4
ref: set-up-host
content: |

  Provision a host for |onprem| that meets the following requirements:

  .. list-table::
     :widths: 30 70
     :stub-columns: 1

     * - System Memory
       - 15 GB
     * - Disk Capacity
       - 50 GB in ``/`` (The root directory of this host)
     * - Host OS Permissions
       - ``root``
     * - Host OS
       - Red Hat Enterprise Linux 8.0

  .. admonition:: Using |aws|
     :class: note

     An |aws| EC2 ``t3a.xlarge`` instance meets the memory requirements.
     Change the size of the instance's root partition to 50 GB. Log
     into the instance and execute ``df -h`` to verify the root
     partition has 50 GB of space.

---
stepnum: 2
title: "Configure ``yum`` to install MongoDB."
ref: config-yum
level: 4
content: |

  Issue the following command to set up a ``yum`` package management
  system repository definition:

  .. code-block:: sh

     echo "[mongodb-org-4.2]
     name=MongoDB Repository
     baseurl=https://repo.mongodb.org/yum/redhat/8/mongodb-org/4.2/x86_64/
     gpgcheck=1
     enabled=1
     gpgkey=https://www.mongodb.org/static/pgp/server-4.2.asc" | sudo tee /etc/yum.repos.d/mongodb.repo

---
stepnum: 3
title: "Install MongoDB."
ref: install-mongodb
level: 4
content: |
  Issue the following command to install the latest stable release of
  MongoDB:

  .. code-block:: sh

     sudo yum install -y mongodb-org mongodb-org-shell

---
stepnum: 4
title: "Disable the ``mongod`` service."
ref: disable-mongodb-service-for-appdb
level: 4
content: |
  
  By default, a ``mongod`` service starts on port ``27017`` when you
  start a MongoDB instance. You need this port for the |onprem| 
  Application Database. Disable the ``mongod`` service to 
  keep this port free for the Application Database should the host 
  restart.
  
  Invoke the following command to disable the ``mongod`` service:

  .. code-block:: sh

     sudo systemctl disable mongod 
---
stepnum: 5
title: "Create the |onprem| Application Database directory."
ref: create-data-dir
level: 4
content: |
  Issue the following two commands to create the data directory and
  change its ownership:

  .. code-block:: sh

     sudo mkdir -p /data/appdb
     sudo chown -R mongod:mongod /data
---
stepnum: 6
title: "*(Optional)* Create the |onprem| backup data directory."
ref: create-backup-dir
level: 4
content: |
  To configure the Backup feature as well, issue the following
  additional commands for the backup database:

  .. code-block:: sh

     sudo mkdir -p /data/backup
     sudo chown mongod:mongod /data/backup
---
stepnum: 7
title: "Start the |onprem| Application Database mongod instance."
ref: start-mongod-instance
level: 4
content: |

  Start MongoDB as the ``mongod`` user, specifying:

  .. list-table::
     :widths: 50 30 20
     :header-rows: 1

     * - Setting
       - Command Option
       - Value
     * - Port
       - ``--port``
       - ``27017``
     * - Absolute path for MongoDB data files
       - ``--dbpath``
       - ``/data/appdb``
     * - Absolute file path for MongoDB logs
       - ``--logpath``
       - ``/data/appdb/mongodb.log``
     * - Amount of cache the WiredTiger :term:`storage engine` uses
         for the :term:`application database`.
       - ``--wiredTigerCacheSizeGB``
       - ``1``
     * - Flag to run the ``mongod`` in the background and maintain
         control of the terminal
       - ``--fork``
       -

  The resulting command would resemble this:

  .. code-block:: sh

    sudo -u mongod mongod --port 27017 --dbpath /data/appdb \
      --logpath /data/appdb/mongodb.log \
      --wiredTigerCacheSizeGB 1 --fork
---
stepnum: 8
title: "*(Optional)* Start the |onprem| Backup Database mongod instance."
ref: start-mongod-backup-instance
level: 4
content: |

  Start MongoDB as the ``mongod`` user, specifying:

  .. list-table::
     :widths: 50 30 20
     :header-rows: 1

     * - Setting
       - Command Option
       - Value
     * - Port
       - ``--port``
       - ``27018``
     * - Absolute path for MongoDB data files
       - ``--dbpath``
       - ``/data/backup``
     * - Absolute file path for MongoDB logs
       - ``--logpath``
       - ``/data/backup/mongodb.log``
     * - Amount of cache the WiredTiger :term:`storage engine` uses
         for the :term:`application database`.
       - ``--wiredTigerCacheSizeGB``
       - ``1``
     * - Flag to run the ``mongod`` in the background and maintain
         control of the terminal
       - ``--fork``
       -

  The resulting command would resemble this:

  .. code-block:: sh

    sudo -u mongod mongod --port 27018 --dbpath /data/backup \
      --logpath /data/backup/mongodb.log \
      --wiredTigerCacheSizeGB 1 --fork
---
stepnum: 9
title: "Download the |onprem| package."
ref: application-package-download
level: 4
content: |

  #. Navigate to the :dl:`Ops Manager Download Center <ops-manager>`.

  #. From the :guilabel:`Platforms` drop-down menu, click
     :guilabel:`Red Hat + CentOS 6, 7, 8 / SUSE 12 + 15 / Amazon Linux`.

  #. From the :guilabel:`Packages` drop-down menu, click
     :guilabel:`RPM`.

  #. Click :guilabel:`Download`.

  .. note::

     The downloaded package is named
     ``mongodb-mms-<version>.x86_64.rpm``, where ``<version>`` is the
     version number.

---
stepnum: 10
title: "*(Optional)* Copy the |onprem| ``.rpm`` package to your host."
ref: copy-rpm-installer
level: 4
content: |

  If you are installing |onprem| on a remote host, such as a cloud 
  provider compute instance, use ``scp`` to copy the installer to your
  host:

  .. code-block:: sh
     
     scp -i <keyfile> mongodb-mms-<version>.x86_64.rpm ec2-user@<public-ip>:~

---
stepnum: 11
title: "Install |onprem|."
ref: install
level: 4
content: |
  Install the ``.rpm`` package by issuing the following command, where
  ``<version>`` is the version of the |onprem| ``.rpm`` package:

  .. code-block:: sh

     sudo rpm -ivh mongodb-mms-<version>.x86_64.rpm

  The install creates the following:

  - The base directory for the |onprem| software, which is:

    ``/opt/mongodb/mms/``

  - A new system user, ``mongodb-mms``, under which the host runs.

  - The ``/opt/mongodb/mms/conf/conf-mms.properties`` file, which
    contains the connection string to access the Application Database
    in :setting:`mongo.mongoUri` setting. The default value is
    ``locahost``, port ``27017``, so no changes are necessary.

---
stepnum: 12
title: "Start |onprem|."
level: 4
ref: start-the-application
content: |
  Issue the following command:

  .. code-block:: sh

     sudo service mongodb-mms start
---
stepnum: 13
title: "Get your instance hostname."
level: 4
ref: public-host-name
content: |
  If you are using an EC2 instance, the hostname is the ``Public DNS``
  listed on the EC2 instance's ``Description`` tab.

  If you do not have a hostname, you can instead use the public IP
  address. To get the public IP address, paste this |url| into your
  preferred browser:

  .. code-block:: sh

     https://www.google.com/search?q=myip
---
stepnum: 14
title: "Open the |onprem| home page and register the first user."
level: 4
ref: home-page
content: |

  a. In a browser, enter the following |url| using the hostname.
     If do not have a hostname, use the public IP address instead:

     .. code-block:: sh

        http://{+opsmgr-url+}

  b. Click the :guilabel:`Register` link and follow the prompts to
     register the first user and create the first project. The first
     user is automatically assigned the :ref:`Global Owner
     <global-owner-role>` role.

---
stepnum: 15
title: "Configure |onprem|."
level: 4
ref: configure-app
content: |

  |onprem| walks you through several configuration pages.
  Required settings are marked with an asterisk. Enter information as
  appropriate. When configuration is complete, |onprem| opens the
  :guilabel:`Deployment` page.

  .. seealso::

     To review the available |onprem| configuration settings, see
     :doc:`/reference/config/ui-settings/`.

---
stepnum: 16
title: "*(Optional)* Configure the backup capabilities."
level: 4
ref: configure-backup-feature
content: |
  a. Create a directory to store the
     :term:`head databases <head database>`.

     .. code-block:: sh

        sudo mkdir /data/headdb

     .. important::

        Do not use this directory for any other purpose.

  b. Make the directory writable by the ``mongodb-mms`` user:

     .. code-block:: sh

        sudo chown mongodb-mms:mongodb-mms /data/headdb

  c. In |onprem|, while logged in as the user you registered during
     installation, click the :guilabel:`Admin` link at the top right of
     the page.

  d. Click the :guilabel:`Backup` tab.

  e. Follow the prompts to configure the Backup storage.
     |onprem| walks you through the configuration.

     For :term:`snapshot storage <snapshot>`, select backup database.

     When prompted, enter your local hostname and port for the
     connection string to the backup database:

     .. code-block:: sh

        localhost:27018

     |onprem| prefixes connection strings with ``mongodb://``. Your
     connection string should match the following:

     .. code-block:: sh
        :copyable: false

        mongodb://localhost:27018

---
stepnum: 17
title: "Set up your first deployment."
level: 4
ref: deploy
content: |

  a. Click :guilabel:`MongoDB Ops Manager` in the upper left corner of
     the page to return to the :guilabel:`Deployment` page.

  b. Click :guilabel:`Add New` to deploy a MongoDB instance.

     .. seealso::

        - :doc:`replica set </tutorial/deploy-replica-set>`
        - :doc:`sharded cluster </tutorial/deploy-sharded-cluster>`

...
