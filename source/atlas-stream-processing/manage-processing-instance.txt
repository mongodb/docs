.. _manage-spi:
.. _atlas-sp-manage-spi:

===================================================
Configure a {+SPI+}
===================================================

.. default-domain:: mongodb

.. meta::
   :keywords: atlas stream processing, atlas stream processing overview, streaming data, data stream, real time, data processing, apache kafka, kafka
   :description: Learn how MongoDB Atlas can connect to sources and sinks of streaming data to provide real time data processing leveraging the full power of MongoDB aggregation pipelines.

.. facet::
   :name: genre
   :values: tutorial

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. include:: includes/atlas-stream-processing/public-preview.rst

An {+atlas-sp+} instance provides a context for all of your operations
on streaming data. The procedures in this page walk you through 
creating and configuring your {+spi+}s.

.. _atlas-sp-manage-spi-prereqs:

Prerequisites
-------------

To create and configure a stream processor, you must have the 
following:

- An |service| :ref:`project <manage-projects>`
- An |service| user with the :authrole:`Project Owner` or
  the :authrole:`Project Stream Processing Owner` role to manage a
  {+SPI+} and Connection Registry

  .. note::
     
     The :authrole:`Project Owner` role allows you to create database 
     deployments, manage project access and project settings, manage 
     IP Access List entries, and more.

     The :authrole:`Project Stream Processing Owner` role enables {+atlas-sp+} 
     actions such as viewing, creating, deleting, and editing stream 
     processing instances, and viewing, adding, modifying, and deleting 
     connections in the connection registry. 

     See :ref:`Project Roles <project-roles>` to learn more about the 
     differences between the two roles.

- An |service| {+cluster+}

.. _manage-spi-view:
.. _atlas-sp-manage-spi-view:

View {+spi+}s
-------------------------------------

To view your {+spi+}s:

.. tabs::

   .. tab:: {+atlas-cli+}
      :tabid: view-spi-cli

      .. include:: /includes/extracts/atlas-streams-instances-list-and-describe.rst

   .. tab:: {+atlas-ui+}
      :tabid: view-spi-ui

      .. include:: /includes/procedures/atlas-sp-view-spi-ui.rst

   .. tab:: {+atlas-admin-api+}
      :tabid: view-spi-api

      The {+atlas-admin-api+} provides different endpoints for 
      retrieving one or all {+spi+}s.

      :oas-atlas-tag:`Return One Stream Instance </Streams/operation/getStreamInstance>`
      
      :oas-atlas-tag:`List All Stream Instances </Streams/operation/listStreamInstances>`

.. _manage-spi-create:
.. _atlas-sp-manage-spi-create:

Create a {+spi+}
-------------------------------------

To create a new {+spi+}:

.. tabs::

   .. tab:: {+atlas-cli+}
      :tabid: create-spi-cli

      .. include:: /includes/extracts/atlas-streams-instances-create.rst

   .. tab:: {+atlas-ui+}
      :tabid: create-spi-ui

      .. include:: /includes/procedures/atlas-sp-create-spi-ui.rst

   .. tab:: {+atlas-admin-api+}
      :tabid: create-spi-api

      The {+atlas-admin-api+} provides an endpoint for creating a 
      {+spi+}.

      :oas-atlas-tag:`Create One Stream Instance </Streams/operation/createStreamInstance>`

.. _manage-spi-delete:
.. _atlas-sp-manage-spi-delete:

Delete a {+spi+}
-----------------------------------

To delete a {+spi+}:

.. tabs::

   .. tab:: {+atlas-cli+}
      :tabid: delete-spi-cli

      .. include:: /includes/extracts/atlas-streams-instances-delete.rst

   .. tab:: {+atlas-ui+}
      :tabid: delete-spi-ui

      .. include:: /includes/procedures/atlas-sp-delete-spi-ui.rst

   .. tab:: {+atlas-admin-api+}
      :tabid: delete-spi-api

      The {+atlas-admin-api+} provides an endpoint for deleting a 
      {+spi+}.

      :oas-atlas-tag:`Delete One Stream Instance </Streams/operation/deleteStreamInstance>`

.. _manage-spi-edit:
.. _atlas-sp-manage-spi-edit:

Edit an {+spi+}
--------------------------------------

To edit an {+spi+}:

.. tabs::

   .. tab:: {+atlas-cli+}
      :tabid: edit-spi-cli

      .. include:: /includes/extracts/atlas-streams-instances-update.rst

   .. tab:: {+atlas-admin-api+}
      :tabid: edit-spi-api

      The {+atlas-admin-api+} provides an endpoint for editing a 
      {+spi+}.

      :oas-atlas-tag:`Update One Stream Instance </Streams/operation/updateStreamInstance>`

.. _manage-spi-connection-view:
.. _atlas-sp-manage-connection-view:

View Connections in the Connection Registry
-------------------------------------------

To view a connection to your {+spi+}:

.. tabs::

   .. tab:: {+atlas-cli+}
      :tabid: view-connection-cli

      .. include:: /includes/extracts/atlas-streams-connections-list-and-describe.rst

   .. tab:: {+atlas-ui+}
      :tabid: view-connection-ui

      .. include:: /includes/procedures/atlas-sp-view-connection-ui.rst

   .. tab:: {+atlas-admin-api+}
      :tabid: view-connection-api

      The {+atlas-admin-api+} provides different endpoints for 
      retrieving one or all connections in a connection registry.

      :oas-atlas-tag:`View One Connection in a Connection Registry </Streams/operation/getStreanConnection>`
      
      :oas-atlas-tag:`List All Connections in a Connection Registry </Streams/operation/listStreamConnections>`

   .. tab:: ``mongosh``
      :tabid: view-connection-sh

      To list all available connections using ``mongosh``, use the
      ``sp.listConnections()`` method. It returns a list of documents
      describing each connection in the {+spi+}'s connection
      registry. It has the following syntax:

      .. code-block:: sh

         sp.listConnections()

.. _manage-spi-connection-add:
.. _atlas-sp-manage-connection-add:

Add a Connection to the Connection Registry
-------------------------------------------

To add a connection to your {+spi+}:

.. tabs::

   .. tab:: {+atlas-cli+}
      :tabid: add-connection-cli

      .. include:: /includes/extracts/atlas-streams-connections-create.rst

      When you create a {+spi+} using the {+atlas-cli+}, you must provide a ``.json``
      configuration file to define the new connection's parameters. The format of this
      file depends on the type of connection you define.

      Apache Kafka Broker
      ~~~~~~~~~~~~~~~~~~~

      For an {+kafka+} connection, provide a configuration file with the following syntax:

      .. code-block:: json

         {
	   "name": "<name>",
	   "type": "Kafka",
	   "bootstrapServers": "<address:port>, ...",
	   "security": {
	     "protocol": "<protocol>"
	   },
	   "authentication": {
	     "mechanism": "<auth-mechanism>",
	     "username": "<username>",
	     "password": "<password>"
	   }
	 }

      {+service+} Database
      ~~~~~~~~~~~~~~~~~~~~~~~~

      For an {+service+} database connection, provide a configuration
      file with the following syntax:

      .. code-block:: json

         {
	   "name": "<name>",
	   "type": "Cluster",
	   "clusterName": "<clusterName>"
	 }

      Sample Connection
      ~~~~~~~~~~~~~~~~~~~~~~~~

      For a connection to the built-in ``sample_stream_solar``,
      provide a configuration file with the following syntax:

      .. code-block:: json

         {
	   "name": "sample_stream_solar",
	   "type": "Sample"
	 }

   .. tab:: {+atlas-ui+}
      :tabid: add-connection-ui

      .. include:: /includes/procedures/atlas-sp-add-connection-ui.rst

   .. tab:: {+atlas-admin-api+}
      :tabid: add-connection-api

      The {+atlas-admin-api+} provides an endpoint for adding a 
      connection to a connection registry.

      :oas-atlas-tag:`Add a Connection to the Connection Registry </Streams/operation/createStreamConnection>`

.. important::

   After adding an external connection such as an {+kafka+} cluster to
   your connection registry, you must add {+service+} IP addresses to 
   an access list for that external connection. For more information, 
   see :ref:`atlas-add-inbound-ips`.

.. _manage-spi-connection-modify:
.. _atlas-sp-manage-connection-modify:

Modify a Connection from the Connection Registry
------------------------------------------------

To modify a connection from a connection registry:

.. tabs::

   .. tab:: {+atlas-cli+}
      :tabid: edit-connection-cli

      .. include:: /includes/extracts/atlas-streams-connections-update.rst

   .. tab:: {+atlas-ui+}
      :tabid: edit-connection-ui

      .. include:: /includes/procedures/atlas-sp-edit-connection-ui.rst

   .. tab:: {+atlas-admin-api+}
      :tabid: edit-connection-api

      The {+atlas-admin-api+} provides an endpoint for editing a 
      {+spi+}.

      :oas-atlas-tag:`Delete One Stream Instance </Streams/operation/updateStreamConnection>`

.. _manage-spi-connection-delete:
.. _atlas-sp-manage-connection-delete:

Delete a Connection from the Connection Registry
------------------------------------------------

To delete a connection from a connection registry:

.. tabs::

   .. tab:: {+atlas-cli+}
      :tabid: delete-connection-cli

      .. include:: /includes/extracts/atlas-streams-connections-delete.rst

   .. tab:: {+atlas-ui+}
      :tabid: delete-connection-ui

      .. include:: /includes/procedures/atlas-sp-delete-connection-ui.rst

   .. tab:: {+atlas-admin-api+}
      :tabid: delete-connection-api

      The {+atlas-admin-api+} provides an endpoint for editing a 
      {+spi+}.

      :oas-atlas-tag:`Delete One Stream Instance </Streams/operation/deleteStreamConnection>`
