=================
Automation Status
=================

.. default-domain:: mongodb

Overview
--------

The Public API provides the ``automationStatus`` endpoint to let you see
whether each MongoDB process is up-to-date with the current
:doc:`automation configuration </reference/cluster-configuration>`. The
endpoint returns the ``goalVersion`` field to report the current version
of the automation configuration and the ``lastGoalVersionAchieved`` fields to
report the versions of the configuration running on each server.

Operation
---------

- ``GET /api/public/v1.0/groups/GROUP-ID/automationStatus``

  Retrieve the status of each MongoDB process in the deployment.

Sample Entity
-------------

.. code-block:: javascript

   "goalVersion": 29,
   "processes": [
       {
           "hostname": "AGENT_HOST_0",
           "name": "BLUE_0",
           "lastGoalVersionAchieved": 28,
           "plan": ["Download", "Start", "WaitRsInit"]
       },
       {
           "hostname": "AGENT_HOST_1",
           "name": "BLUE_1",
           "lastGoalVersionAchieved": 29,
           "plan": []
       }
   ]

Entity Fields
-------------

.. list-table::
   :widths: 20 10 80
   :header-rows: 1

   * - Name
     - Type
     - Description
   * - goalVersion
     - integer
     - The version of the most recently submitted :ref:`automation
       configuration <automation-configuration-sample-entity>`. If there is a
       :ref:`conflict in submissions of automation configurations
       <concurrent-cluster-config>`, this field lists the winning
       configuration.
   * - processes
     - array
     - The group's deployed MongoDB instances.
   * - \- hostname
     - string
     - The fully qualified domain name (retrieved by issuing ``hostname -f``)
       of the server on which the MongoDB process and Automation Agent are
       hosted.
   * - \- name
     - string
     - The process name as specified in the automation configuration.
   * - \- lastGoalVersionAchieved
     - integer
     - The last version of the automation configuration with which this
       process had deployed as configured. If the ``lastGoalVersionAchieved``
       number is not equal to the ``goalVersion`` number, the process has
       not yet deployed according to the current configuration.
   * - \- plan
     - array
     - Describes how a process that is not yet up-to-date with the
       configuration will achieve the goal state.

Example
-------

Retrieve status: ::

  curl -u "username:apiKey" --digest -i "https://mms.mongodb.com/api/public/v1.0/groups/533c5895b91030606f21033a/automationStatus"

Response:

.. code-block:: json

  {
    "processes": [
      {
        "plan": [],
        "lastGoalVersionAchieved": 2,
        "name": "shardedCluster_myShard_0_0",
        "hostname": "testDeploy-0"
      },
      {
        "plan": [],
        "lastGoalVersionAchieved": 2,
        "name": "shardedCluster_myShard_0_1",
        "hostname": "testDeploy-1"
      },
      {
        "plan": [],
        "lastGoalVersionAchieved": 2,
        "name": "shardedCluster_myShard_0_2",
        "hostname": "testDeploy-2"
      },
      {
        "plan": [],
        "lastGoalVersionAchieved": 2,
        "name": "shardedCluster_myShard_1_3",
        "hostname": "testDeploy-3"
      },
      {
        "plan": [],
        "lastGoalVersionAchieved": 2,
        "name": "shardedCluster_myShard_1_4",
        "hostname": "testDeploy-4"
      },
      {
        "plan": [],
        "lastGoalVersionAchieved": 2,
        "name": "shardedCluster_myShard_1_5",
        "hostname": "testDeploy-5"
      },
      {
        "plan": [],
        "lastGoalVersionAchieved": 2,
        "name": "shardedCluster_config_6",
        "hostname": "testDeploy-6"
      },
      {
        "plan": [],
        "lastGoalVersionAchieved": 2,
        "name": "shardedCluster_config_7",
        "hostname": "testDeploy-7"
      },
      {
        "plan": [],
        "lastGoalVersionAchieved": 2,
        "name": "shardedCluster_config_8",
        "hostname": "testDeploy-8"
      },
      {
        "plan": [],
        "lastGoalVersionAchieved": 2,
        "name": "shardedCluster_mongos_9",
        "hostname": "testDeploy-9"
      }
    ],
    "goalVersion": 2
  }
