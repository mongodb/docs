=======================
Provider Configurations
=======================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: twocols

Overview
--------

The ``providerConfigs`` resource displays the cloud service providers you
have integrated with |mms| and provides endpoints to create, update, or
delete an integration.

For more information on |mms| integration with cloud service providers, see
:doc:`/tutorial/nav/add-servers`.

Endpoints
---------

Get All Provider Configurations
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. code-block:: none

   GET /api/public/v1.0/groups/GROUP-ID/providerConfigs

Get All Provider Configurations for a Given Provider
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Currently the only available value for ``PROVIDER-NAME`` is ``AWS``.

.. code-block:: none

   GET /api/public/v1.0/groups/GROUP-ID/providerConfigs/PROVIDER-NAME

.. _get-provider-configuration-via-api:

Get a Single Provider Configuration
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Currently the only available value for ``PROVIDER-NAME`` is ``AWS``.

.. code-block:: none

   GET /api/public/v1.0/groups/GROUP-ID/providerConfigs/PROVIDER-NAME/CONFIG-ID

Create a Provider Configuration
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Use ``POST`` to create a new provider configuration. You must provide all
configuration options. It is recommended that that you use ``GET`` to
:ref:`retrieve an existing provider configuration
<get-provider-configuration-via-api>` to determine what to send for the new
configuration. Leave out the top-level configuration ``id`` field. |mms|
creates this.

Currently the only available value for ``PROVIDER-NAME`` is ``AWS``.

.. code-block:: none

   POST /api/public/v1.0/groups/GROUP-ID/providerConfigs/PROVIDER-NAME

Update a Provider Configuration
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Use ``PUT`` to update a provider configuration. The entire configuration is
replaced. Perform a ``GET`` to :ref:`retrieve the existing provider
configuration <get-provider-configuration-via-api>` . Then modify the fields
you want to change and ``PUT`` the entire updated configuration to the
endpoint here. Include the top-level configuration ``id`` field.

Currently the only available value for ``PROVIDER-NAME`` is ``AWS``.

You can only use ``PUT`` to update a provider configuration. You **cannot**
use ``PATCH``.

.. code-block:: none

   PUT /api/public/v1.0/groups/GROUP-ID/providerConfigs/PROVIDER-NAME/CONFIG-ID

Delete a Provider Configuration
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Currently the only available value for ``PROVIDER-NAME`` is ``AWS``.

.. code-block:: none

   DELETE /api/public/v1.0/groups/GROUP-ID/providerConfigs/PROVIDER-NAME/CONFIG-ID

Sample Entity
-------------

.. code-block:: javascript

   {
     "id" : "54018b94e4b0b1b52f4c4997",
     "authTypeName" : "KEY_SECRET",
     "authPublic" : "<access-key-id>",
     "authPrivate" : "<secret-access-key>",
     "defaultDataDirectory" : "/data",
     "defaultRegionName" : "AWS_US_EAST_1",
     "machineUser" : "user",
     "providerName" : "AWS",
     "links" : [ ... ]
   }

Entity Fields
-------------

For ``POST`` and ``PUT``, all fields are required, except for fields that do
not correspond to the given ``authTypeName``.

.. list-table::
   :widths: 10 10 80
   :header-rows: 1

   * - Name
     - Type
     - Description

   * - ``id``
     - string
     - Unique identifier.

   * - ``authTypeName``
     - string
     - *AWS only*. The authentication method used to grant access to
       resources. Possible values are:

       - ``KEY_SECRET``
       - ``CROSS_ACCOUNT``

   * - ``authPublic``
     - string
     - *AWS only*. Required and present only if ``authTypeName`` is set to
       ``KEY_SECRET``. This sets the AWS account’s Access Key ID. See
       :ref:`aws-access`.

   * - ``authPrivate``
     - string
     - *AWS only*. Required and present only if ``authTypeName`` is set to
       ``KEY_SECRET``. This sets the AWS account’s Secret Access Key. See
       :ref:`aws-access`. This is used only by ``POST`` and ``PUT``.

   * - ``roleARN``
     - string
     - *AWS only*. Required and present only if ``authTypeName`` is set to
       ``CROSS_ACCOUNT``. Set this to your AWS "Role ARN". Use `this guide
       <http://blog.cloud.mongodb.com/post/103214737505/mms-create-aws-role-for-cross-account-access>`_
       to create an AWS Role ARN if you do not have one.

   * - ``externalId``
     - string
     - *AWS only*. Required and present only if ``authTypeName`` is set to
       ``CROSS_ACCOUNT``. Set this to your AWS "External ID". Use `this guide
       <http://blog.cloud.mongodb.com/post/103214737505/mms-create-aws-role-for-cross-account-access>`_
       to create an AWS External ID if you do not have one.

   * - ``defaultDataDirectory``
     - string
     - The data directory for the MongoDB deployment on the server.

   * - ``defaultRegionName``
     - string
     - *AWS only*. The server's AWS region.

   * - ``machineUser``
     - string
     - The username for SSH login to the server.

   * - ``providerName``
     - string
     - The cloud service provider.

Links
-----

.. list-table::
   :header-rows: 1

   * - Relation
     - Description

   * - ``self``
     - Me.

   * - ``http://mms.mongodb.com/group``
     - The group the configuration belongs to.

Examples
--------

Get All Provider Configurations
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Request
```````

.. code-block:: none

   curl -u "username:apiKey" --digest -i "https://cloud.mongodb.com/api/public/v1.0/groups/5421e044e4b09da19248b17f/providerConfigs"

Response
````````

.. code-block:: none

   HTTP/1.1 200 OK

   {
     "results" : [ {
       "authPublic" : "<access-key-id>",
       "authTypeName" : "KEY_SECRET",
       "defaultDataDirectory" : "/data",
       "defaultRegionName" : "AWS_US_EAST_1",
       "id" : "5421e0eae4b09da19248f528",
       "links" : [ ... ],
       "machineUser" : "user",
       "providerName" : "AWS"
     }, {
       "authTypeName" : "CROSS_ACCOUNT",
       "defaultDataDirectory" : "/data",
       "id" : "54018b94e4b0b1b52f4c4997",
       "links" : [ ... ],
       "machineUser" : "user",
       "providerName" : "AWS"
     } ],
     "links" : [ ... ],
     "totalCount" : 2
   }

Get All Provider Configurations for a Given Provider
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Request
```````

.. code-block:: none

   curl -u "username:apiKey" --digest -i  "https://cloud.mongod.com/api/public/v1.0/groups/5421e044e4b09da19248b17f/providerConfigs/AWS"

Response
````````

.. code-block:: none

   HTTP/1.1 200 OK

   {
     "results" : [ {
       "authPublic" : "<access-key-id>",
       "authTypeName" : "KEY_SECRET",
       "defaultDataDirectory" : "/data",
       "defaultRegionName" : "AWS_US_EAST_1",
       "id" : "5421e0eae4b09da19248f528",
       "links" : [ ... ],
       "machineUser" : "user",
       "providerName" : "AWS"
     } ],
     "links" : [ ... ],
     "totalCount" : 1
   }

Get a Single Provider Configuration
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Request
```````

.. code-block:: none

   curl -u "username:apiKey" --digest -i "https://cloud.mongodb.com/api/public/v1.0/groups/5421e044e4b0da19248b17f/providerConfigs/AWS/5421e0eae4b09da19248f528"

Response
````````

.. code-block:: none

   HTTP/1.1 200 OK

   {
     "authPublic" : "<access-key-id>",
     "authTypeName" : "KEY_SECRET",
     "defaultDataDirectory" : "/data",
     "defaultRegionName" : "AWS_US_EAST_1",
     "id" : "5421e0eae4b09da19248f528",
     "links" : [ ... ],
     "machineUser" : "user",
     "providerName" : "AWS"
   }

Create a Provider Configuration
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Request
```````

.. code-block:: none

   curl -u "username:apiKey" --digest -i -H "Content-Type: application/json" -X POST "https://cloud.mongodb.com/api/public/v1.0/groups/5421e044e4b0da19248b17f/providerConfigs/AWS" --data '
   {
     "authPublic" : "<access-key-id>",
     "authPrivate" : "<secret-access-key>",
     "authTypeName" : "KEY_SECRET",
     "defaultDataDirectory" : "/data",
     "defaultRegionName" : "AWS_US_EAST_1",
     "machineUser" : "user",
     "providerName" : "AWS"
   }'

Response
````````

.. code-block:: none

   HTTP/1.1 201 Created

   {
     "authPublic" : "<access-key-id>",
     "authTypeName" : "KEY_SECRET",
     "defaultDataDirectory" : "/data",
     "defaultRegionName" : "AWS_US_EAST_1",
     "id" : "555608f7e4b08eb7ee2eea53",
     "links" : [ ... ],
     "machineUser" : "user",
     "providerName" : "AWS"
   }

Update a Provider Configuration
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Request
```````

.. code-block:: none

   curl -u "username:apiKey" --digest -i -H "Content-Type: application/json" -X PUT "https://cloud.mongodb.com/api/public/v1.0/groups/5421e044e4b0da19248b17f/providerConfigs/AWS/555408f7e4b08eb7ee2eea53" --data '
   {
     "authPublic" : "<access-key-id>",
     "authPrivate" : "<secret-access-key>",
     "authTypeName" : "KEY_SECRET",
     "defaultDataDirectory" : "/data",
     "defaultRegionName" : "AWS_US_WEST_1",
     "machineUser" : "user",
     "providerName" : "AWS"
   }'

Response
````````

.. code-block:: none

   HTTP/1.1 200 OK

   {
     "authPublic" : "<access-key-id>",
     "authTypeName" : "KEY_SECRET",
     "defaultDataDirectory" : "/data",
     "defaultRegionName" : "AWS_US_WEST_1",
     "id" : "555608f7e4b08eb7ee2eea53",
     "links" : [ ... ],
     "machineUser" : "user",
     "providerName" : "AWS"
   }

Delete a Provider Configuration
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Request
```````

.. code-block:: none

   curl -u "username:apiKey" --digest -i -X DELETE "https://cloud.mongodb.com/api/public/v1.0/groups/54ba08efe4b043f2fa07dc31/providerConfigs/AWS/54bce4dde4b0f09f4e03c14a"

Response
````````

.. code-block:: none

   HTTP/1.1 200 OK

   {}
