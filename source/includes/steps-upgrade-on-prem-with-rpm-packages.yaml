stepnum: 1
level: 4
source:
  file: steps-source-upgrade-onprem.yaml
  ref: backup
---
stepnum: 2
level: 4
source:
  file: steps-source-upgrade-onprem.yaml
  ref: shutdown
---
stepnum: 3
level: 4
source:
  file: steps-source-upgrade-onprem.yaml
  ref: uninstall-daemon
post: |

  This config file is located at
  ``/opt/mongodb/mms-backup-daemon/conf/conf-daemon.properties``.

---
stepnum: 4
level: 4
# Note: This step is borrowed from the rpm install procedure, not from steps-source-upgrade.
source:
  file: steps-install-on-prem-with-rpm-packages.yaml
  ref: download
---
title: "Install the |onprem| package on each server being used for |onprem| services, including backup."
stepnum: 5
level: 4
ref: install
content: |

  .. important::
     The Backup Daemon is now a function of |onprem| and not a separate
     service. This means that every server that previously only had a Backup
     Daemon service installed will need to install the full |onprem| server to
     provide backup capabilities.

  Install the ``.rpm`` package on each |application| server by issuing the
  following command, where ``<version>`` is the version of the ``.rpm``
  package:

  .. code-block:: sh

     sudo rpm -Uvh mongodb-mms-<version>.x86_64.rpm

  The installer preserves the existing ``conf-mms.properties`` configuration
  file and names the new configuration file ``conf-mms.properties.rpmnew``.
  Both are located in ``/opt/mongodb/mms/conf/``.

# .. note::

#    If the server runs only a Backup Daemon and does not have an existing
#    ``conf-mms.properties`` file, copy the file from an |application| server
#    to the Backup Daemon server. This preserves the :setting:`mongo.mongoUri`
#    string for connecting to the Backup Database. Copy the
#    ``conf-mms.properties`` file to the ``/opt/mongodb/mms/conf`` directory
#    on Backup Daemon server. Create the directory if it does not exist.


# On servers that run the |onprem| Application, the installer preserves your existing
# ``conf-mms.properties`` configuration file and names the new configuration
# file ``conf-mms.properties.rpmnew``. Both are located in
# ``/opt/mongodb/mms/conf/``.

# On servers that run only the Backup Daemon, the installer creates the
# ``/opt/mongodb/mms/`` directory and creates the ``conf-mms.properties``
# configuration file in ``/opt/mongodb/mms/conf/``.
---
stepnum: 6
level: 4
source:
  file: steps-source-upgrade-onprem.yaml
  ref: replace-connection-string
---
stepnum: 7
level: 4
# Note: This step is borrowed from the rpm install procedure, not from steps-source-upgrade.
source:
  file: steps-install-on-prem-with-rpm-packages.yaml
  ref: workaround-rhel
---
stepnum: 8
level: 4
source:
  file: steps-source-upgrade-onprem.yaml
  ref: start
---
stepnum: 9
level: 4
source:
  file: steps-source-upgrade-onprem.yaml
  ref: log-in-as-global-owner
---
stepnum: 10
level: 4
source:
  file: steps-source-upgrade-onprem.yaml
  ref: configuration
---
stepnum: 11
level: 4
source:
  file: steps-source-upgrade-onprem.yaml
  ref: backup-agent-configuration
...
