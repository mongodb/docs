.. index:: hosts-tab

=====
Hosts
=====

The :guilabel:`Hosts` pages are the primary location for monitoring information
in the MMS console. This tabbed interface provides access to all of your
monitored objects.

Interface
---------

Tabs
~~~~

The tabs you see depend on the types of processes in your deployment. The main
tabs:

- **Hosts** displays all ``mongod`` instances.

- **Mongos** displays all ``mongos`` instances.

- **Configs** displays all database configuration servers.

- **Host Mapping** shows the mapping between system hostnames and
  the names provided by the monitored process (e.g. ``mongod`` and
  ``mongos``). For more information about creating host
  aliases, see :ref:`Creating Host Aliases <creating-host-aliases>`.

The **AGENTS** section of the :guilabel:`Hosts` page includes these tabs:

- **Monitoring Agents** lists the Monitoring agents attached to this MMS account.
  For more information, see :ref:`Monitoring Agents <hosts-agents>`.

- **Monitoring Agent Log** displays a log of the Monitoring agent's activity.

The Hosts Table
~~~~~~~~~~~~~~~

The :guilabel:`Hosts`, :guilabel:`Mongos`, and :guilabel:`Configs` pages list
monitored resources as a table with these headings:

- **Last Ping:** the last time this agent sent a ping to the MMS servers.

- **Host:** the name of the host running the agent. When clicked, charts display.

- **Type:** the type of host, for example, PRIMARY, SECONDARY, STANDALONE, and
  ARBITER. When the host recovers, the rectangle flag turns yellow and displays
  RECOVERING. When the host returns a fatal error, the flag displays FATAL. The
  flag also can display NO DATA.

- **Cluster:** the cluster name. When clicked, charts display.

- **Shard:** the cluster name. When linked and clicked, charts display.

- **Repl Set:** the cluster name. When clicked, charts display.

- **Up Since:** the date the host first pinged MMS.

- **Version:** the version of the agent software running on this agent
  instance.

.. _hosts-agents:

The Monitoring Agents Table
~~~~~~~~~~~~~~~~~~~~~~~~~~~

The :guilabel:`Monitoring Agents` tab lists software agent information as a
table with these headings:

- **Agent Hostname:** the hostname for the agent.

- **Agent IP:** the IP address of the running agent.

- **Hosts:** the number of MongoDB instances this agent monitors.

- **Ping Count:** the number of pings (i.e. data payloads) sent by the
  agent since midnight GMT. Typically agents send pings every minute.

- **Conf Count:** the number of configuration requests sent by the
  agent since midnight GMT. Typically agents request configuration
  updates every two minutes.

- **Version:** the version of the agent software running on this agent
  instance.

- **Last Ping:** the date and time of the last ping from the agent.

- **Last Conf:** the last time the agent made a configuration request
  of the MMS servers.

Remember, if you have more than one Monitoring agent, only one agent
actively monitors MongoDB instances at once. See :ref:`Monitoring
Architecture <monitoring-architecture>` for more information.

Messages
~~~~~~~~

An orange yield sign icon displays under a host name on the :guilabel:`Hosts`,
:guilabel:`Mongos`, or :guilabel:`Configs` pages when:

- |monitoring| has detected startup warnings for this host. You can see the
  warning in the last ping for the host.

- |monitoring| suspects the host has a low ``ulimit`` setting less than
  ``1024``. |monitoring| infers the host's ``ulimit`` setting using the total
  number of available and current connections. See the :manual:`UNIX ulimit
  Settings </reference/ulimit/>` reference page.

- |monitoring| flags a deactivated host.

.. important:: If you have deactivated hosts, review all deactivated hosts to
   ensure that they are still in use, and remove all hosts that are not active.
   Then click on the warning icon and select **Reactive ALL hosts**.

.. include:: /includes/mms-old-version-red.rst

Tasks
-----

.. _creating-host-aliases:
.. index:: aliases
   single: host aliases

Create Host Aliases
~~~~~~~~~~~~~~~~~~~

You can create aliases for the hosts you monitor with MMS. These aliases
are arbitrary and are useful if your machines have existing hostnames that do
not sufficiently describe the system in the context of MMS.

In most cases, hosts are automatically aliased during auto-discovery.
  
To set an alias for a host:

1. Click the :guilabel:`Hosts`, :guilabel:`Mongos`, or :guilabel:`Configs`
   tabs.

#. To the right of any Host, click the gear icon in the far right column of the
   hosts table. Select :guilabel:`Edit Host`.

#. The :guilabel:`Edit Host` interface appears. Click the :guilabel:`Host Alias` tab.

#. Type the host alias and click the :guilabel:`Submit` button. Port numbers are not
   appended to host aliases.

.. note::

   When you add or update a Host Alias value, all previous hostname aliases are
   reset.

.. index:: removing hosts
.. index:: procedure; removing hosts
.. _removing-hosts:

Remove Hosts
~~~~~~~~~~~~

MMS cannot ignore hosts added in the discovery process. To delete a host from
the MMS dashboard, click the gear icon on the far right of the host entry in
the :guilabel:`Hosts`, :guilabel:`Mongos`, or :guilabel:`Configs` pages and
select :guilabel:`Remove Host`.

To add monitoring for a host you have deleted from MMS, you must add the host
manually using the :guilabel:`+Add Host` button at the top of thepage.

For more about monitoring hosts, see :doc:`Monitoring Hosts with MMS
</monitoring/tutorial/monitor-hosts-with-mms>`.

.. index:: database profiling
.. _db-profiling-section:

Profile Databases
~~~~~~~~~~~~~~~~~

|monitoring| can collect data from MongoDB's profiler to provide statistics
about performance and database operations. A link at the bottom of the Host
Statistics page that displays the profile levels.

Be aware of these issues:

- Profile data can include sensitive information, including the content of
  database queries. Ensure that exposing this data to |monitoring| is consistent
  with your information security practices.

- The profiler can consume resources which may adversely affect MongoDB
  performance. Consider the implications before enabling profiling.

To allow |monitoring| to collect profile data for a specific host:

1. Click the :guilabel:`Hosts`, :guilabel:`Mongos`, or :guilabel:`Configs`
   tabs.

#. To the right of any Host, click the gear icon in the far right column of the
   hosts table. Select :guilabel:`Edit Host`.

#. The :guilabel:`Edit Host` interface appears. Click the :guilabel:`Profiling` tab.

#. Click the :guilabel:`On button` to enable transmission to MMS of database
   profile statistics.

#. Use the mongo shell to modify the ``setProfilingLevel`` command. This starts
   database profiling. See the `database profiler
   <http://www.mongodb.org/display/DOCS/Database+Profiler>`_ documentation for
   instructions for using the profiler.

.. note::

   The Monitoring agent attempts to minimize its effect on the
   monitored systems. If resource intensive operations, like polling
   profile data, begins to impact the performance of the database,
   |monitoring| will throttle the frequency that it collects data. See
   :ref:`db-stats-warning` for more information about the agent's
   throttling process.

   When enabled, |monitoring| samples profiling data from monitored
   instances: the agent only sends the most recent 20 entries from last
   minute.

When profiling is on, all configuration changes made in the MMS console can
take up to 2 minutes to propagate to the agent and another minute before
profiling data appears in the MMS interface.

If you have profiling data, and wish to delete it from the system,
there is a button on the bottom of the Profile Data tab, that says
Delete Profile Data. When you click on this button, the MMS Console
raises a confirmation dialogue. When you confirm, |monitoring| will
begin removing stored profile data from this server's record.

.. note::

   If |monitoring| is storing a large amount of profile data for your
   instance, the removal process will not be instantaneous.

.. index:: host labels

Host Labels
~~~~~~~~~~~

You can label hosts to narrow the list of hosts in the MMS display. This helps
if you monitor a large number of hosts and want to access a more limited set of
hosts. Hosts may belong to none, one, or multiple labels.

To add or edit a host label:

1. Click the :guilabel:`Hosts`, :guilabel:`Mongos`, or :guilabel:`Configs`
   tabs.

#. Click the :guilabel:`all hosts` link directly above the :guilabel:`Last
   Ping` column heading.

#. Select :guilabel:`Edit Labels` from the drop down lists. The :guilabel:`Host
   Labels` interface appears.

#. To edit or delete an existing host label, click the pencil icon or trash icon.

#. To add a new host label, type the name and click the :guilabel:`Add Label`
   button.

To add or tag a host with a label:

1. Click the :guilabel:`Hosts`, :guilabel:`Mongos`, or :guilabel:`Configs`
   tabs.

#. To the right of any Host, click the gear icon in the far right column of the
   hosts table. Select :guilabel:`Edit Host`.

#. The :guilabel:`Edit Host` interface appears. Click the :guilabel:`Host
   Labels` tab.

#. Click to select one or more labels to assign to the host.

To display hosts by their host label:

1. Click the :guilabel:`Hosts`, :guilabel:`Mongos`, or :guilabel:`Configs`
   tabs.

#. Click the :guilabel:`all hosts` link directly above the :guilabel:`Last
   Ping` column heading.

#. Select the appropriate host label. The list of hosts will display only hosts
   tagged with the selected label.
