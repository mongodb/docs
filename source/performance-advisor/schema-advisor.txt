.. _schema-advisor:

===================
Improve Your Schema
===================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

Your schema is the architecture of your cluster, including your
:term:`collections <collection>`, :term:`indexes <index>` and
:term:`documents <document>`. The |service| Schema Advisor monitors
your cluster and suggests schema modifications that follow MongoDB's
best practices and help improve database performance. These suggestions
come in the form of |service| :ref:`alerts <alerts>`.

Schema Suggestions
------------------

To learn more about the improvements that Schema Advisor
suggests and how to act on them, refer to the following pages:

.. list-table::
   :header-rows: 1
   :widths: 20 40

   * - Schema Improvement
     - Reason for Suggestion

   * - :ref:`unbounded-arrays-anti-pattern`
     - Your documents contain array fields with many elements,
       which can degrade query performance.

   * - :ref:`too-many-namespaces-anti-pattern`
     - You have an exceedingly high number of collections in a
       database, which can result in unnecessary disk space usage.

   * - :ref:`indexes-anti-pattern`
     - You have unnecessary indexes in your collection, which can 
       consume disk space and degrade write performance.

   * - :ref:`case-insensitive-regex-anti-pattern`
     - You are executing case-insensitive regex queries which could be
       improved with an index.

Limitations of Schema Suggestions
---------------------------------

- Schema suggestions for a collection are partly driven by a random
  sampling of documents from that collection. Because this sample
  varies between Schema Advisor analyses, you may see different
  suggestions at different times for the same collection.

- The Schema Advisor uses slow query logs as an input to recognize
  certain schema issues, namely too many :pipeline:`$lookup` operations
  and not utilizing an index for case-insensitive regex queries. If a
  collection does not have any operations that last longer than 100
  milliseconds, the Schema Advisor may not suggest all potential
  improvements for that collection, or may not show all reasons why
  an improvement is being suggested.

- When analyzing collections in the
  :ref:`Performance Advisor <performance-advisor>`, |service| selects
  the 20 most active collections based on the output of the
  :dbcommand:`top` command. To see suggestions for a specific
  collection, view that collection in the
  :ref:`Data Explorer <data-explorer-db-colls>`.


.. class:: hidden

   .. toctree::

      /schema-advisor/avoid-unbounded-arrays
      /schema-advisor/too-many-collections
      /schema-advisor/too-many-indexes
      /schema-advisor/case-insensitive-regex
