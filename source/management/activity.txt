.. index:: alerts

===========================
Activity: Alerts and Events
===========================

.. contents:: Activity Page
   :backlinks: none
   :local:

Activity Page
-------------

The :guilabel:`Activity` page has three sections:

#. :guilabel:`All Activity`, which shows a feed of all MMS events as well as all
   open alerts.

#. :guilabel:`Closed Alerts`, which shows a list of alerts that users have
   closed explicitly or where the metric has dropped below the
   threshold of the alert.

#. :guilabel:`Alert Settings`, which provides a window to create new alerts and
   manage existing alerts.

Procedures
----------

The :guilabel:`Alert Settings` tab on the :guilabel:`Activity` page displays all available alerts. A
:guilabel:`gear icon` drop down on the right side of each alert lets you edit,
clone, disable, or delete an alert.

Create an Alert
~~~~~~~~~~~~~~~

Alerts can be created from scratch or cloned from an existing alert. To clone
an alert, see the :guilabel:`Clone an Alert` procedure below.

To create an alert:

1. Click the :guilabel:`Add Alert` button in the top right of the :guilabel:`Alert
   Settings` page. A window appears where you can configure the alert.

2. In the first section, choose the target category to monitor. Target
   categories refer to the monitored target and include: hosts, replica set,
   agents and backups.

   - If you select :guilabel:`Host`, choose the host type and then the condition or
     metric. Conditions include defining alert thresholds above or below
     metrics tracked in charts displayed when a hostname is clicked on the
     :guilabel:`Hosts` page, for example, Asserts, Opcounter, and Queues.

   .. only:: saas

      - If you select :guilabel:`Replica Set`, select the Primary Elected
        condition to send an alert when a new primary is elected.

   - If you select :guilabel:`Agent`, choose the agent to monitor.

   .. only:: saas

      - If you select :guilabel:`Backup`, choose which condition to use for the
        alert.

3. In the second section, choose to create an alert for *either* any monitored
   target (i.e. host, replica set, agent, or backup) *or* a subset of the
   monitored targets.

   If you want to specify a subset of monitored targets, you can
   specify the criteria used to select targets here.

.. only:: saas

   4. In the third section, you may add recipients (i.e. users or groups)
      and specify the distribution method (i.e. email addresses, and
      SMS) to define the distribution list of the alert.

      Users must ensure they have entered the correct number into the
      :guilabel:`Alerts` window. MMS removes all punctuation and letters and
      only uses the digits for the telephone number.

      .. include:: /includes/fact-intl-phone-numbers.rst

      For HipChat alerts, enter the HipChat room name and API token. Alerts
      will appear in the HipChat room message stream. See the :doc:`Settings page
      </management/settings/>` to define default group alerts settings for HipChat.
      
      For PagerDuty alerts, enter only the service key. Escalation rules and
      alert assignments are defined in PagerDuty. See the :doc:`Settings page
      </management/settings/>` to define default group alerts settings for PagerDuty.

.. only:: hosted

   4. In the third section, you may add recipients (i.e. users or groups)
      and specify the distribution method (i.e. email addresses, SNMP, and
      SMS) to define the distribution list of the alert.

      For SNMP alerts, specify the hostname that will receive
      the v2c trap on standard port ``162``.

      The MIB file for SNMP is `available for download here
      <http://downloads.mongodb.com/on-prem-monitoring/MMS-10GEN-MIB.txt>`_.

      Users must ensure that they have entered the correct number into the
      :guilabel:`Alerts` window. MMS removes all punctuation and letters and
      only uses the digits for the telephone number.

      .. include:: /includes/fact-intl-phone-numbers.rst

You may also create multiple alerts with different minimum times before
notification to implement alert escalation. Alerts are processed on a 5 minute
interval. Therefore, the minimum frequency for an alert is 5 minutes.

The time between re-notifications increases by the frequency amount every alert
cycle (e.g. 5 minutes, 10 minutes, 15 minutes, 20 minutes,) up to a maximum of
24 hours.

.. START-COMMENT

   - If you select **Group** and check the **SMS** box, then MMS sends
     alert text messages to all users in the group who have filled
     in their Mobile Number in the Settings page.

   - If you select **User** and check the **SMS** box, then MMS sends
     alert text messages to the user's Mobile Number specified in
     their Settings page.

   - MMS sends alert emails as multipart messages containing both HTML
     and plain text content. This way, the recipient's email client
     can choose the appropriate message format for display.

.. END-COMMENT

Costs to send alerts depend on your telephone service contract. Many factors
may affect alert delivery, including do not call lists, caps for messages
sent or delivered, delivery time of day, and message caching.

Clone an Alert
~~~~~~~~~~~~~~

Alerts can be created by cloning an existing alert then editing it.

To clone an alert:

1. On the :guilabel:`Alert Settings` tab on the :guilabel:`Activity` page,
   click the :guilabel:`gear icon` to the right of an alert. Select
   :guilabel:`Clone` to clone the alert.

2. Follow steps 2-4 described in the :guilabel:`Create an Alert` procedure
   above.

Modify an Alert
~~~~~~~~~~~~~~~

To modify an existing alert, select the :guilabel:`Alert Settings` tab to view
all available alerts. A :guilabel:`gear icon` drop down on the right side of
each alert lets you edit an alert.

Each alert has a distribution list you can edit *and* a frequency
setting that controls how often MMS will distribute the alert.

Alerts are processed on a 5 minute interval.

.. START-COMMENT

   Per Mike Benoit 12/17/2013, mms-docs Pull 80: The reason for the 5 minute
   minimum is that our alert processing job only executes every five minutes.
   Thus, setting this lower than 5 minutes wouldn't have any impact. This also
   means that only multiples of 5 make sense for this value.

.. END-COMMENT

Delete Alerts
~~~~~~~~~~~~~

Alerts can be deleted from MMS. On the :guilabel:`Alert Settings` tab on the
:guilabel:`Activity` page, click the :guilabel:`gear icon` to the right of an
alert. Select :guilabel:`Delete` to delete the alert.

Disable Alerts
~~~~~~~~~~~~~~

Alerts can be disabled and turned off in MMS. On the :guilabel:`Alert Settings`
tab on the :guilabel:`Activity` page, click the :guilabel:`gear icon` to the
right of an alert. Select :guilabel:`Disable` to stop the agent.

The alert configuration remains visible in a *greyed out* state. Any active
alerts related to the disabled alert configuration will be cancelled.

For example, if you have an alert configured for *Host Down* and you currently
have an active alert telling you a host is down, the active alert will be
cancelled if you disable the *Monitoring Agent Down* configuration. No further
alerts of that type will be triggered unless the disabled alert is re-enabled.

Enable Alerts
~~~~~~~~~~~~~

Disabled alerts can be turned back on once disabled. On the :guilabel:`Alert
Settings` tab on the :guilabel:`Activity` page, click the :guilabel:`gear icon`
to the right of a disabled alert. Select :guilabel:`Enable` to reactivate the
agent.

View Open Alerts
~~~~~~~~~~~~~~~~

To view open alerts visit the :guilabel:`All Activity` tab on the
:guilabel:`Activity` page. Open alerts appear above the *Feed* section in an
*Open Alerts* section that only appears if there are open alerts. From this
window you can acknowledge an alert and select the duration of the
acknowledgment.

Once a user acknowledges an alert in the interface, MMS sends no
further notifications to the alert's distribution list until the
acknowledgement period has passed.

The distribution list receives *no* notification of alert
acknowledgment.

If your alert is configured with PagerDuty, a third-party incident management
service, the alert can only be acknowledged on your PagerDuty dashboard.
