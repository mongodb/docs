.. _deployment-diagrams:

=============================
Example Installation Diagrams
=============================

.. default-domain:: mongodb

Overview
--------

The following diagrams show example |onprem| deployments.

.. _on-prem-minimal-deployment-diagram:

Non-Durable, Test Install on a Single Server
--------------------------------------------

For a test deployment, you can deploy all of the |onprem|
components to a single server, as described in
:doc:`/tutorial/install-simple-test-deployment`. Ensure you :ref:`configure
the appropriate ulimits <onprem-config-ulimits>` for the deployment.

.. include:: /images/opsmanager-test.rst

The :term:`head databases <head database>` are dynamically created and maintained
by the Backup Daemon. They reside on the disk partition specified
in the ``conf-daemon.properties`` file.

Durable Production Install
--------------------------

The basic deployment provides durability in case of failure by keeping a
redundant copy of the application data and snapshots.
However, the basic deployment
does not provide high availability and cannot accept writes to the backing
databases in the event that a replica set member is lost. See
:ref:`highly-available-deployment` for a deployment that can continue to
accept writes with the loss of a member.

.. include:: /images/opsmanager-medium.rst

**Server 1** must satisfy the combined :doc:`hardware and software
requirements </core/requirements>` for the |application| hardware and
|application| Database hardware.

**Server 2** must satisfy the combined hardware and software
requirements for the Backup Daemon hardware and Backup
Database hardware. The Backup Daemon automatically creates and
maintains the :term:`head databases <head database>`, which reside on the
disk partition specified in the ``conf-daemon.properties`` file.
Do not place the head databases on the same disk partition
as the Backup Database, as this will reduce |backup|'s
performance.

**Server 3** hosts replica set members for the |application| Database
and Backup Database. Replica sets provide data redundancy and
are strongly recommended, but are not required for |onprem|.
Server 3 must satisfy the combined hardware and software
requirements for the |application| Database hardware and Backup
Database hardware.

For an example tutorial on installing the minimally viable |onprem|
installation on RHEL 6+ or Amazon Linux, see
:doc:`/tutorial/install-basic-deployment`.

.. _highly-available-deployment:

Durable, Highly Available Install with Multiple Backup Databases
----------------------------------------------------------------

The following is a highly available deployment that you can scale out to
add additional Backup Databases.

.. include:: /images/opsmanager-large.rst

The deployment
includes two servers that host the |application| and the |application|
Database, four servers that host two |backup| deployments, and an
additional server to host the :term:`arbiters <arbiter>` for each
replica set.

Deploy an HTTP Load Balancer to balance the HTTP traffic for the
|http-service| and Backup service. |onprem| does not supply
an HTTP Load Balancer: you must deploy and configure it yourself.

All of the software services need to be able to communicate with
the |application| Databases and the Backup Databases.
Configure your firewalls to allow traffic between these servers
on the :doc:`appropriate ports </reference/firewall-configuration>`.

- **Server 1** and **Server 2** must satisfy the combined :doc:`hardware
  and software requirements </core/requirements>` for the |application|
  hardware and |application| Database hardware.

- **Server 3**, **Server 4**, **Server 5**, and **Server 6** must
  satisfy the combined hardware and software requirements
  for the Backup Daemon hardware and Backup Database hardware.

  The Backup Daemon creates and maintains the :term:`head databases <head databases>`,
  which reside on the disk partition specified in the
  ``conf-daemon.properties`` file. Only the Backup Daemon needs to
  communicate with the head databases. As such, their :setting:`net.bindIp` value
  is ``127.0.0.1`` to prevent external communication.
  :setting:`net.bindIp` specifies the IP address that
  :program:`mongod` and :program:`mongos` listens to for connections
  coming from applications.

  For best performance, each Backup server should have 2 partitions. One
  for the Backup Database, and one for the head
  databases.

- **Server 7** and **Server 8** host :term:`secondaries <secondary>` for
  the |application| Database, and for the two Backup
  Databases. They must satisfy the combined hardware and software
  requirements for the databases.

To deploy |onprem| with high availability, see:
:doc:`/tutorial/configure-application-high-availability`.
