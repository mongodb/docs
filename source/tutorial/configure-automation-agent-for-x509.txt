:orphan:

.. meta::
   :robots: noindex, nosnippet

==========================================================================
Configure the Automation Agent for x.509 Client Certificate Authentication
==========================================================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. include:: /includes/legacy-agents/fact-automation-agent-deprecated.rst

.. include:: /includes/enable-auth-intro.rst

.. next paragraph stolenish from the MongoDB Manual

MongoDB supports x.509 certificate authentication for use with a secure
:doc:`TLS/SSL </tutorial/enable-ssl-for-a-deployment>` connection. The
x.509 client authentication allows clients to authenticate to servers
with certificates rather than with a username and password.

.. include:: /includes/extracts/note-manage-agent-auth-with-automation-x509.rst

Considerations
--------------

.. include:: /includes/fact-out-of-scope-ssl-certs.rst

Prerequisites
-------------

To enable x.509 Authentication for |mms|, you must obtain valid
certificates generated and signed by a single certificate authority.
Refer to the
:manual:`Client x.509 Certificate </tutorial/configure-x509-client-authentication>`
in the MongoDB Manual for more about the certificate requirements.

x.509 Client Certificate Authentication requires you to
:doc:`enable and configure </tutorial/enable-ssl-for-a-deployment>`
|tls-ssl| for the deployment.

Procedures
----------

This tutorial assumes that you have already configured your MongoDB
deployment to use x.509 certificate authentication and |ssl|. If you
have not done so, refer to the
:manual:`Use x.509 Certificates to Authenticate Clients </tutorial/configure-x509-client-authentication>`
and
:manual:`Configure mongod and mognos for TLS/SSL </tutorial/configure-ssl>` tutorials.

Create MongoDB User for the ``subject``
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

For the Automation Agent to connect to your MongoDB deployment, you
must create a user for the Automation Agent in the ``$external``
database.

For x.509 certificate authentication, use the ``subject`` value of your
client certificate as the username.

Use the following commands to create the users from {+mongosh+}:

.. literalinclude:: /includes/code-examples/create-user.js
   :language: javascript
   :lines: 1,3,5,8-17
   :linenos:

For more information on the required access, see
:doc:`/reference/required-access-automation-agent`.

You can only associate an x.509 client certificate with a single user;
each user must have its own certificate.

Edit Agent Configuration File
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

x.509 requires that you configure the agent for |tls-ssl|:

.. include:: /includes/steps/automation-agent-configure-ssl.rst

:doc:`/tutorial/configure-automation-agent-for-ssl` provides more
details about configuring the Automation Agent for |tls-ssl|.

Once you have configured the Automation Agent, you still need to
configure the x.509 Authentication mechanism in the |mms| interface, as
described in :doc:`/tutorial/enable-x509-authentication-for-group`.
