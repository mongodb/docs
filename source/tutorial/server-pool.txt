.. _provision-via-server-pool:

======================================
Provision Servers for the Server Pool
======================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

|onprem| Server Pool allows |onprem| users with administrative
privileges, i.e. |onprem| Administrators, to maintain a pool of
globally provisioned servers that already have Automation Agents
installed.

When users in a group want to create a new MongoDB deployment, they can
request servers from this pool to host the MongoDB deployment.

Administrators can associate properties with the servers in the pool.
The administrator can then expose these server properties as options
when a user creates a server request; i.e. the user can select certain
properties to request servers that match the these properties.

Administrators control which server properties are exposed to the user.
That is, the Administrator can provide the user access to all the
available server properties or restrict the user to a specific
properties. For details, see :ref:`server-pool-server-request-options`.

.. _server-pool-configuration:

Enable and Configure the Server Pool
-------------------------------------

To enable and configure the server pool, click the :guilabel:`Admin`
link in the top right corner of |onprem| to access the settings panels.
From the :guilabel:`General` tab, go to :guilabel:`Ops Manager Config`
and select the the `Server Pool` tab.

If the server pool is disabled, enable server pool and configure the
server pool, such as setting server termination policy. The
configuration applies to all servers in the pool.

Provision Servers for the Pool
------------------------------

Requirements
~~~~~~~~~~~~

The servers in the pool must meet the same :doc:`prerequisites
</tutorial/provisioning-prep>` as any other provisioned servers.

Install Automation Agents
~~~~~~~~~~~~~~~~~~~~~~~~~

Install the Automation Agent on each server for the pool.

On Linux servers, if you installed MongoDB with a package manager, use the
same package manager to install the Automation Agent. If you installed
MongoDB without a package manager, use an archive to install the
Automation Agent.

.. include:: /includes/steps/automation-agent-install.rst

.. important::

   In the agent's configuration file, specify the server pool
   configuration for the agent. Do not specify the group configuration.

.. _server-pool-manage-server-pool:

Manage the Server Pool
----------------------

To manage servers in the pool, click the the :guilabel:`Admin` link in
the top right corner and go to the :guilabel:`Server Pool` tab.

View Servers
~~~~~~~~~~~~

From the :ref:`admin-server-pool` page, the :ref:`Server List
<server-pool-servers>` displays the servers in the pool as well as
their availability (i.e. whether they are bound to a group or unbound).

Terminate Servers
~~~~~~~~~~~~~~~~~

From the :ref:`Server List <server-pool-servers>` view, Administrators
can terminate unbound servers. For servers bound to a group, owners of
the group can terminate the servers from their :guilabel:`Deployment`
view.

The termination policy, set in :ref:`server-pool-configuration`,
determines what happens to terminated servers and their data files. 

Recycle Terminated Servers
~~~~~~~~~~~~~~~~~~~~~~~~~~

If the policy determines that the servers are not automatically
returned to the pool upon termination, the servers go to the
:guilabel:`Recycle Bin`. From the :guilabel:`Recycle Bin` view,
Administrator can recycle terminated servers to returm them to the pool.

If the list of terminated servers exceed the list displayed on the
current page, :guilabel:`Recycle All` recycles *all* terminated servers
in the recycle bin, not just the servers displayed on the current page.

.. _server-pool-cancel-request:

View Pending Request
~~~~~~~~~~~~~~~~~~~~

From the :ref:`admin-server-pool` page, the :guilabel:`Pending
Requests` view lists the pending requests. Administrator can cancel
pending requests from this view. When users :doc:`submit server request
</tutorial/request-servers-from-pool>` and no servers exist that can
fulfill the request, users can cancel their request at that time.

If neither the user or the Administrator cancels the pending request,
the request expires once the timeout period has passed. The
|onprem| Administrator sets the request timeout period for the server
pool through the :ref:`server-pool-configuration`.

.. _server-pool-manager-server-request-options:

Manage Server Request Options
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

From the :ref:`server-pool-server-request-options` page, Administrators
can control which server properties are exposed to the user when the
user creates the server request.

Server properties are specified in the
:asetting:`serverPoolPropertiesFile` file that the Administrator
specifies when installing the Automation Agent.

By controlling which properties to expose to the users, the
Administrator can control the degree of customization that a user can
have when creating the server request.

For example, the Administrator can provide access to all the available
server properties to allow for maximum customization of the server
request, or limit users to certain properties, or even limit all
properties from the user.
