======================================
Get Measurements for a MongoDB Process
======================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

Get measurements for a specific |service| MongoDB process. A |service| MongoDB
process can be either a :binary:`mongod <bin.mongod>` or :binary:`mongos
<bin.mongos>`.

.. include:: /includes/api-requirements.rst

.. include:: /includes/api-base-url.rst

Resource
--------

.. code-block:: none

   GET api/atlas/v1.0/groups/{GROUP-ID}/processes/{HOST}:{PORT}/measurements

Request Path Parameters
~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/list-table-measurements-request-path-parameters.rst

Request Query Parameters
~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/list-table-measurements-request-query-parameters.rst

Request Body Parameters
~~~~~~~~~~~~~~~~~~~~~~~

This endpoint does not use HTTP request body parameters.

Response Elements
-----------------

.. admonition:: Free Tier
   :class: important

   ``M0`` Free Tier clusters return a subset of the metrics documented here.


If you set the query element ``envelope`` to ``true``, the response is wrapped
by the ``content`` object.

The HTTP response returns a JSON document that includes the following objects:

.. list-table::
   :header-rows: 1
   :widths: 30 10 60

   * - Name
     - Type
     - Description

   * - ``end``
     - string
     - The end of the period for which to retrieve measurements, specified as
       an ISO-8601_
       timestamp.

   * - ``granularity``
     - string
     - An ISO-8601_-formatted
       time period that specifies the size of the interval covered by each
       data point. For example, ``PT5M`` specifies a 5-minute granularity.

   * - ``groupId``
     - string
     - ID of the group that owns the |service| MongoDB process.

   * - ``hostId``
     - string
     - The hostname of the machine running the |service| MongoDB process.

   * - ``links``
     - array
     - An array of documents, representing a :ref:`link <api-linking>` to one
       or more sub-resources and/or related resources such as :ref:`list
       pagination <api-lists>`. See :ref:`api-linking` for more information.

   * - ``measurements``
     - object array
     - An array of measurements and their data points.

   * - ``measurements.dataPoints``
     - object array
     - An array of objects, where each object represents a single data
       point. If there is no data point available for a particular moment in
       time (i.e., a timestamp), the ``value`` field is set to ``null``.

   * - ``measurements.dataPoints.timestamp``
     - string
     - The timestamp of the beginning of the time interval represented by this
       data point.

   * - ``measurements.dataPoints.value``
     - float
     - The value of the data point.

   * - ``measurements.name``
     - string
     - The name of the measurement. For possible values, see
       :ref:`measurement-types` below on this page.

   * - ``measurements.units``
     - string
     - How the measurement is quantified. Possible units are:

       - ``PERCENT``
       - ``MILLISECONDS``
       - ``BYTES``
       - ``GIGABYTES``
       - ``BYTES_PER_SECOND``
       - ``MEGABYTES_PER_SECOND``
       - ``GIGABYTES_PER_HOUR``
       - ``SCALAR_PER_SECOND``
       - ``SCALAR``

   * -  ``processId``
     - string
     - The hostname and port of the machine running the |service| MongoDB
       process.

   * - ``start``
     - string
     - The start of the period for which to retrieve measurements, specified as
       an ISO-8601_
       timestamp.


.. _measurement-types:

Measurement Values
~~~~~~~~~~~~~~~~~~

.. list-table::

   * - - ``ASSERT_REGULAR``
       - ``ASSERT_WARNING``
       - ``ASSERT_MSG``
       - ``ASSERT_USER``

     - Measures the rate of asserts for a MongoDB process, as collected from
       the MongoDB :manual:`serverStatus </reference/command/serverStatus>`
       command's :serverstatus:`asserts` document.

   * - - ``CACHE_BYTES_READ_INTO``
       - ``CACHE_BYTES_WRITTEN_FROM``
       - ``CACHE_USAGE_DIRTY``
       - ``CACHE_USAGE_USED``

     - Applies to a MongoDB process's :manual:`WiredTiger </core/wiredtiger>`
       storage engine, as collected from the MongoDB :manual:`serverStatus
       </reference/command/serverStatus>` command's
       :serverstatus:`wiredTiger.cache` and
       :serverstatus:`wiredTiger.concurrentTransactions` documents.

   * - - ``CONNECTIONS``

     - Measures connections to a MongoDB process, as collected from the
       MongoDB :manual:`serverStatus </reference/command/serverStatus>`
       command's :serverstatus:`connections` document.

   * - - ``CURSORS_TOTAL_OPEN``
       - ``CURSORS_TOTAL_TIMED_OUT``

     - Measures the number of :manual:`cursors </core/cursors>` for a MongoDB
       process, as collected from the MongoDB :manual:`serverStatus
       </reference/command/serverStatus>` command's
       :serverstatus:`metrics.cursor` document.

   * - - ``DB_STORAGE_TOTAL``
       - ``DB_DATA_SIZE_TOTAL``

     - Measures the database's on-disk storage space, as collected from
       the MongoDB :manual:`dbStats </reference/command/dbStats>` command.

   * - - ``DOCUMENT_METRICS_RETURNED``
       - ``DOCUMENT_METRICS_INSERTED``
       - ``DOCUMENT_METRICS_UPDATED``
       - ``DOCUMENT_METRICS_DELETED``

     - The average rate per second of documents returned, inserted, updated,
       or deleted for a selected time period.

   * - - ``EXTRA_INFO_PAGE_FAULTS``

     - Measurements on page faults related to the host.

   * - - ``GLOBAL_LOCK_CURRENT_QUEUE_TOTAL``
       - ``GLOBAL_LOCK_CURRENT_QUEUE_READERS``
       - ``GLOBAL_LOCK_CURRENT_QUEUE_WRITERS``

     - Measures operations waiting on locks, as collected from the MongoDB
       :manual:`serverStatus </reference/command/serverStatus>` command.

   * - - ``MEMORY_RESIDENT``
       - ``MEMORY_VIRTUAL``
       - ``MEMORY_MAPPED``

     - Measures memory for a MongoDB process, as collected from the MongoDB
       :manual:`serverStatus </reference/command/serverStatus>` command's
       :serverstatus:`mem` document.

   * - - ``NETWORK_BYTES_IN``
       - ``NETWORK_BYTES_OUT``
       - ``NETWORK_NUM_REQUESTS``

     - Measures throughput for MongoDB process, as collected from the MongoDB
       :manual:`serverStatus </reference/command/serverStatus>` command's
       :serverstatus:`network` document.

   * - - ``OPCOUNTER_CMD``
       - ``OPCOUNTER_QUERY``
       - ``OPCOUNTER_UPDATE``
       - ``OPCOUNTER_DELETE``
       - ``OPCOUNTER_GETMORE``
       - ``OPCOUNTER_INSERT``

     - Measures the rate of database operations on a MongoDB process since the
       process last started, as collected from the MongoDB
       :manual:`serverStatus </reference/command/serverStatus>` command's
       :serverstatus:`opcounters` document.

   * - - ``OPCOUNTER_REPL_CMD``
       - ``OPCOUNTER_REPL_UPDATE``
       - ``OPCOUNTER_REPL_DELETE``
       - ``OPCOUNTER_REPL_INSERT``

     - Measures the rate of database operations on MongoDB :term:`secondaries
       <secondary>`, as collected from the MongoDB :manual:`serverStatus
       </reference/command/serverStatus>` command's
       :serverstatus:`opcountersRepl` document.

   * - - ``OPERATIONS_SCAN_AND_ORDER``

     - For a selected time period, the average rate per second for operations
       that perform a sort but cannot perform the sort using an index.

   * - - ``OP_EXECUTION_TIME_READS``
       - ``OP_EXECUTION_TIME_WRITES``
       - ``OP_EXECUTION_TIME_COMMANDS``

     - Available to hosts running MongoDB v3.4+. The execution
       time in milliseconds per read, write, or command operation
       over the selected time period.

   * - - ``OPLOG_MASTER_TIME``
       - ``OPLOG_RATE_GB_PER_HOUR``

     - Measurements that apply to the MongoDB process's :manual:`oplog
       </core/replica-set-oplog>`.

   * - - ``QUERY_EXECUTOR_SCANNED``

     - The average rate per second to scan index items during
       queries and query-plan evaluations. This rate is driven by
       the same value as ``totalKeysExamined`` in the output of
       :manual:`explain </reference/command/explain>`. This
       measurement is found on the host's ``Query Executor``
       chart, accessed when viewing metrics.

   * - - ``QUERY_EXECUTOR_SCANNED_OBJECTS``

     - The average rate per second to scan documents during queries
       and query-plan evaluations. |mms| derives the rate using the
       :manual:`explain </reference/command/explain>` output's
       ``totalDocsExamined`` value. This measurement is found on the
       host's ``Query Executor`` chart, accessed when viewing
       metrics.
   * - - ``QUERY_TARGETING_SCANNED_PER_RETURNED``

     - The ratio of the number of index items scanned to the number of
       documents returned. This measurement is found on the host's
       ``Query Targeting`` chart, accessed when viewing metrics.

   * - - ``QUERY_TARGETING_SCANNED_OBJECTS_PER_RETURNED``

     - The ratio of the number of documents scanned to the number of
       documents returned. This measurement is found on the host's
       ``Query Targeting`` chart, accessed when viewing metrics.

   * - - ``TICKETS_AVAILABLE_READS``
       - ``TICKETS_AVAILABLE_WRITES``

     - Measurement of the :manual:`WiredTiger </core/wiredtiger>` storage
       engine :serverstatus:`wiredTiger.cache` and
       :serverstatus:`wiredTiger.concurrentTransactions` documents as
       collected from the MongoDB :manual:`serverStatus
       </reference/command/serverStatus>` command.

   * - - ``PROCESS_CPU_USER``
       - ``PROCESS_CPU_KERNEL``
       - ``PROCESS_CPU_CHILDREN_USER``
       - ``PROCESS_CPU_CHILDREN_KERNEL``

     - The CPU usage of MongoDB. For servers with more than 1 CPU core, these
       values can exceed 100%.

   * - - ``PROCESS_NORMALIZED_CPU_USER``
       - ``PROCESS_NORMALIZED_CPU_KERNEL``
       - ``PROCESS_NORMALIZED_CPU_CHILDREN_USER``
       - ``PROCESS_NORMALIZED_CPU_CHILDREN_KERNEL``

     - The CPU usage of MongoDB, scaled to a range of 0-100% by dividing by
       the number of CPU cores.

   * - - ``SYSTEM_CPU_USER``
       - ``SYSTEM_CPU_KERNEL``
       - ``SYSTEM_CPU_NICE``
       - ``SYSTEM_CPU_IOWAIT``
       - ``SYSTEM_CPU_IRQ``
       - ``SYSTEM_CPU_SOFTIRQ``
       - ``SYSTEM_CPU_GUEST``
       - ``SYSTEM_CPU_STEAL``

     - CPU usage of processes on the host server. For servers with more than 1
       CPU core, this value can exceed 100%.

   * - - ``SYSTEM_NORMALIZED_CPU_USER``
       - ``SYSTEM_NORMALIZED_CPU_KERNEL``
       - ``SYSTEM_NORMALIZED_CPU_NICE``
       - ``SYSTEM_NORMALIZED_CPU_IOWAIT``
       - ``SYSTEM_NORMALIZED_CPU_IRQ``
       - ``SYSTEM_NORMALIZED_CPU_SOFTIRQ``
       - ``SYSTEM_NORMALIZED_CPU_GUEST``
       - ``SYSTEM_NORMALIZED_CPU_STEAL``

     - CPU usage of processes on the host server, scaled to a range of 0-100%
       by dividing by the number of CPU cores.

Example Request
---------------

The following example request sets a ``granularity`` and ``period`` of one
minute. Replace the information in brackets ``{}`` with your own |service|
information to execute this example request:

.. class:: copyable-code
.. code-block:: shell

   curl -u "<ATLAS-USERNAME>:<API-KEY>" --digest -i "https://cloud.mongodb.com/api/atlas/v1.0/groups/{GROUP-ID}/processes/{HOST}:{PORT}}/measurements?granularity=PT1M&period=PT1M&pretty=true"

Example Response
----------------

.. code-block:: none

   HTTP/1.1 200 OK
   Vary: Accept-Encoding
   Cache-Control: no-cache, no-transform, must-revalidate, proxy-revalidate, max-age=0
   Content-Type: application/json
   Strict-Transport-Security: max-age=300
   Date: Tue, 22 Aug 2017 20:31:22 GMT
   Connection: keep-alive
   Content-Length: 16848

   {
     "end" : "2017-08-22T20:31:14Z",
     "granularity" : "PT1M",
     "groupId" : "12345678",
     "hostId" : "shard-00-00.mongodb.net:27017",
     "links" : [ {
       "href" : "https://cloud.mongodb.com/api/atlas/v1.0/groups/12345678/processes/shard-00-00.mongodb.net:27017/measurements?granularity=PT1M&period=PT1M&pretty=true",
       "rel" : "self"
     }, {
       "href" : "https://cloud.mongodb.com/api/atlas/v1.0/groups/12345678/processes/shard-00-00.mongodb.net:27017",
       "rel" : "http://mms.mongodb.com/host"
     } ],
     "measurements" : [ {
       "dataPoints" : [ {
         "timestamp" : "2017-08-22T20:31:12Z",
         "value" : null
       }, {
         "timestamp" : "2017-08-22T20:31:14Z",
         "value" : null
       } ],
       "name" : "ASSERT_REGULAR",
       "units" : "SCALAR_PER_SECOND"
     }, {
       ...
     }],
     "processId" : "shard-00-00.mongodb.net:27017",
     "start" : "2017-08-22T20:30:45Z"
   }

.. _ISO-8601:  http://www.iso.org/iso/home/standards/iso8601.htm
