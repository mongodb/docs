===================================
Preparing Backing MongoDB Instances
===================================

.. default-domain:: mongodb

Overview
--------

A backing MongoDB instance is a dedicated replica set that hosts a
:ref:`backing database <backing-database>` that |mms| uses to store data.
The MMS Application requires a backing instance to store monitoring data,
and the MMS Backup Service requires a separate backing instance to store
backup data. Backing instances are dedicated and cannot be used for other
purposes.

All backing MongoDB instances must be running MongoDB 2.4.9 or
later.

MMS Application Database
~~~~~~~~~~~~~~~~~~~~~~~~

MMS Monitoring requires a MongoDB replica set to hold the MMS Application
database. The database stores:

- Monitoring data collected from monitoring agents.

- Meta data for MMS users, groups, hosts, monitoring data, and backup state.

For up to 400 monitored hosts, the MMS Application Database requires 200 GB of storage space.
For up to 2000 monitored hosts, the MMS Application Database requires 500 GB of storage space.
If you have more than 2000 monitored hosts, please contact your MongoDB Account Manager.

The application database should be a single three-member MongoDB replica
set. If you cannot allocate 3 data instances, you may deploy 2
:program:`mongod` instances that hold data and one arbiter.

You may run the MMS Application Server on the same physical server as
one member of the MMS Application Database replica set.

For reference: an AWS EC2 Standard Extra Large (i.e. m1.xlarge) with a
provisioned 500 IOP/s EBS volume may support the 400-host configuration
above. An AWS EC2 High I/O Quadruple Extra Large (hi1.4xlarge)
may support the 2000 host configuration above.

For the best results use SSD-backed storage. A MongoDB standalone may also be used in
please of a replica set, but this is not recommended for production deployments.

Optional: MMS Backup Blockstore Database
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

MMS Backup requires a separate, **dedicated** MongoDB replica set to hold
the Backup Service's snapshot data. This **cannot** be a replica set used
for purposes other than holding the snapshots. In particular, this cannot
be a replica set that stores the data the snapshots back up.

The replica set should have enough capacity to store 2 to 3 times the
total backed up data size.

Prior to installing MMS Backup, consider contacting your MongoDB Account
Manager to arrange a sizing consultation for the MMS Backup database.

For testing *only* you may use a standalone :program:`mongod` instance
in place of a replica set.

Prerequisites
-------------

Read the :manual:`MongoDB Production Notes
</administration/production-notes>` before installing
MongoDB and other software on your servers. If you are deploying MMS
on Amazon AWS, please see ::doc:`/tutorial/configure-aws-hosts`.

The MMS Application requires :query:`$where`. As a result, you must
ensure that :setting:`security.javaScriptEnabled` is ``true``, which
is the default, for all backing :program:`mongod` instances.

Setup and Install Replica Sets
------------------------------

To create replica sets, start the :program:`mongod` instances for each
member of a new replica set, configure the replica set, then add the
:program:`mongod` instances to the replica set.

The :manual:`Deploy a Replica Set </tutorial/deploy-replica-set>` guide
has step by step details how to setup and deploy replica sets for use as
backing MongoDBs for MMS.

Each backing instance should be a single three-member MongoDB replica
set. If you cannot allocate 3 data instances, you may deploy 2
:program:`mongod` instances that hold data and one arbiter.

For additional information on installing MongoDB, see :manual:`Install
MongoDB </installation/>`.
