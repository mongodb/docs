.. _upgrade-major-MongoDB-version:

===========================================
Upgrade Major MongoDB Version for a Cluster
===========================================

.. default-domain:: mongodb

.. facet::
   :name: genre
   :values: tutorial

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

You can upgrade the major version of your |service| {+cluster+} at any time
by :ref:`modifying the cluster <scale-cluster-version>`.

To ensure that your transition to the new MongoDB version is smooth and doesn't
affect your application, before you upgrade the major version on your
production |service| {+cluster+}, use the following procedure to create
a staging {+cluster+} and test your application against the new MongoDB version.

Considerations
--------------

The following considerations apply:

- Your {+cluster+} must be in a healthy state before upgrading.

- If you :ref:`take an on-demand snapshot <on-demand-snapshots>` before
  a major version upgrade, wait until the snapshot completes before you
  upgrade the version.

- You can only upgrade your |service| {+cluster+} one major version at a
  time. You cannot skip any major versions when upgrading your
  {+cluster+}.

- Each major version contains some features which may not be
  backward-compatible with previous versions. When upgrading to a new
  major version, check the :manual:`Release Notes </release-notes>` for
  changes which may affect your applications.

- After upgrading the MongoDB major version, you will not be able to 
  downgrade to previous versions.

- Upgrading from MongoDB 4.4 to MongoDB 5.0 has potential performance impacts. 
  See :manual:`Performance Considerations </release-notes/5.0/#performance-considerations>` for more information.

- Starting with MongoDB 6.0, the ``$$SEARCH_META`` 
  aggregation variable can't be used in any subsequent stage after a 
  :pipeline:`$searchMeta` stage. 

  If you want to upgrade to MongoDB 6.0 from a previous 
  version and use the ``$$SEARCH_META`` aggregation variable in your
  |fts| :pipeline:`$searchMeta` queries, review them before you upgrade your 
  {+cluster+} to avoid errors.

Required Access
---------------

To upgrade a {+cluster+}, you must have the :authrole:`Project Owner` or
higher role for the project.

Procedure
---------

.. include:: /includes/steps-change-major-version.rst

.. _major-version-upgrade-support:

Support for Major Version Upgrades
----------------------------------

If you have any questions regarding migration support beyond what is covered
in this documentation, or if you encounter an error during migration,
file a support ticket through the |service| user interface.

To file a support ticket:

.. procedure::
   :style: normal

   .. step:: Click :guilabel:`Support` in the left-hand navigation.

   .. step:: For :guilabel:`Atlas Issue Category`, select ``Other``.

   .. step:: Set the priority.
    
      For :guilabel:`Priority`, select ``Medium Priority``. If the issue
      affects your production cluster, select ``High Priority``.

   .. step:: Update the summary.
    
      For :guilabel:`Request Summary`, include ``Major Version Upgrade``
      in the summary.

   .. step:: Specify details.
    
      For :guilabel:`More details`, include any other relevant details 
      to your question or major version upgrade error.
