.. _set-up-database-auditing:

========================
Set up Database Auditing
========================

.. default-domain:: mongodb

.. meta::
   :keywords: audit

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. include:: /includes/fact-atlas-free-tier-limits.rst

.. include:: /includes/serverless-preview-dont-use.rst

Overview
--------

.. note:: **Required Privileges**

   To enable or disable database auditing, you must have the 
   :authrole:`Organization Owner` role or the :authrole:`Project Owner` 
   role for the project that you want to update.

Auditing allows
administrators to track system activity for deployments with multiple
users. |service| administrators can select the actions that they want 
to audit, as well as the database users, |service| roles, and LDAP 
groups whose actions they want audited. |service| supports 
:manual:`auditing </core/auditing>` all system event actions documented 
at :ref:`audit-action-details-results`.

The ``authCheck`` event action logs authorization attempts by users
trying to read from and write to databases in the clusters in your
project. The following specific commands are audited:

.. list-table::
   :header-rows: 1
   :widths: 25 75

   * - ``authCheck Reads``
     - ``authCheck Writes``

   * - :manual:`aggregate </reference/command/aggregate>`
     - :manual:`aggregate </reference/command/aggregate>`

   * - :manual:`mapReduce </reference/command/mapReduce>`
     - :manual:`mapReduce </reference/command/mapReduce>`

   * - :manual:`distinct </reference/command/distinct>`
     - :manual:`delete </reference/command/delete>`

   * - :manual:`eval </reference/command/eval>` [1]_
     - :manual:`eval </reference/command/eval>` [1]_

   * - :manual:`count </reference/command/count>`
     - :manual:`findAndModify </reference/command/findAndModify>`

   * - :manual:`geoNear </reference/command/geoNear>`
     - :manual:`insert </reference/command/insert>`

   * - :manual:`geoSearch </reference/command/geoSearch>`
     - :manual:`update </reference/command/update>`

   * - :manual:`group </reference/command/group>`
     - :manual:`resetError </reference/command/resetError>`

   * - :manual:`find </reference/command/find>`
     -

   * - :manual:`getLastError </reference/command/getLastError>`
     -

   * - :manual:`getMore </reference/command/getMore>`
     -

   * - :manual:`getPrevError </reference/command/getPrevError>`
     -

   * - :manual:`parallelCollectionScan </reference/command/parallelCollectionScan>` [1]_
     -

.. [1] MongoDB versions 4.2 and later do not support these commands.

|service| implements the ``authCheck`` event action as the following
four separate actions:

.. list-table::
   :header-rows: 1
   :widths: 25 75

   * - Event Action
     - Description

   * - ``authChecksReadFailures``
     - The ``authCheck`` event action for all failed reads with the :manual:`auditAuthorizationSuccess
       </reference/parameters/#param.auditAuthorizationSuccess>`
       parameter set to false. This is the default for read-related event actions.

   * - ``authChecksReadAll``
     - The ``authCheck`` event action for all reads, both sucesses and failures.
       Same as ``authChecksReadFailures`` but with the :manual:`auditAuthorizationSuccess </reference/parameters/#param.auditAuthorizationSuccess>`
       parameter set to true.

       .. warning::

          Enabling Audit authorization successes can severely impact cluster performance. Enable this option with caution.

   * - ``authChecksWriteFailures``
     - The ``authCheck`` event action for all failed writes with the :manual:`auditAuthorizationSuccess
       </reference/parameters/#param.auditAuthorizationSuccess>`
       parameter set to false. This is the default for write-related event actions.

   * - ``authChecksWriteAll``
     - The ``authCheck`` event action for all writes, both successes and failures.
       Same as ``authChecksWriteFailures`` but with the :manual:`auditAuthorizationSuccess </reference/parameters/#param.auditAuthorizationSuccess>`
       parameter set to true.

       .. warning::

          Enabling Audit authorization successes can severely impact cluster performance. Enable this option with caution.

To learn about how MongoDB writes audit events to disk, see :manual:`Audit Guarantee </core/auditing/#audit-guarantee>`
in the MongoDB Manual.

.. _enable-auditing-atlas:

Procedure
---------

.. note::

   To learn about best practices for auditing the actions of temporary
   database users, see :ref:`audit-temp-db-users`.

Use the following procedure to set up database auditing:

.. include:: /includes/steps/set-up-database-auditing.rst

To retrieve the audit logs in |service|, see :ref:`MongoDB Logs <mongodb-logs>`.
To retrieve the audit logs using the API, see :doc:`Logs </reference/api/logs>`.

.. toctree::
   :titlesonly:

   /tutorial/auditing-custom-filter
