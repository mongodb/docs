.. _live-import-replica:

======================================
Live Migrate Your Replica Set to Atlas
======================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

|service| can perform a live migration of a source replica set to an
|service| cluster, keeping the cluster in sync with the remote source
until you cut your applications over to the |service| cluster. Once you
reach the cutover step in the following procedure, you should stop
writes to the source cluster by stopping your application instances,
pointing them to the |service| cluster, and restarting them.

To begin, click on the ellipsis :guilabel:`...` button and choose
:guilabel:`Migrate Data to this Cluster` from the dropdown menu.

.. note::

   On the Cluster list, the ellipsis :guilabel:`...` button appears
   beneath the cluster name, as shown below. When you view a cluster's
   details, the ellipsis :guilabel:`...` appears on the right-hand side
   of the screen, next to the :guilabel:`Connect` and
   :guilabel:`Configuration` buttons.

.. figure:: /images/live-migrate-blurred-region.png

Restrictions
------------

- You cannot select an ``M0`` (Free Tier) or ``M2/M5`` shared cluster
  as the source or destination for live migration. To migrate data
  from an ``M0`` (Free Tier) or ``M2/M5`` shared cluster to a paid
  cluster, see :doc:`/scale-cluster`.

- Live Migration does not support :ref:`VPC peering <vpc-peering>` or
  :ref:`private endpoints <private-endpoint>` for either the source or
  destination cluster.

For a procedure on live migrating a sharded cluster, see
:doc:`/import/live-import-sharded`.

Prerequisites
-------------

.. include:: /includes/note-source-cluster-readiness.rst

.. _live-import-upgrade-path:

Upgrade Path
~~~~~~~~~~~~

|service| live migration supports the following migration paths:

.. include:: /includes/list-tables/mongomirror-upgrade-path.rst

.. important::

   Users migrating from a MongoDB 2.6 cluster should take particular
   care to update and test their applications in context of the
   destination |service| cluster. In general, whenever migrating
   to a newer version of MongoDB, plan for updating and testing
   your application in context of the destination migration cluster.

.. _live-import-ip-access-list:

.. include:: /includes/import/network-access.rst

.. _live-import-migration-validation:

Pre-Migration Validation
~~~~~~~~~~~~~~~~~~~~~~~~

|service| performs a number of validation checks on the source
and destination cluster before starting the Live Migration procedure.

- The source cluster is a replica set.

  If the source is a standalone,
  :manual:`convert the standalone to a replica set first </tutorial/convert-standalone-to-replica-set>`
  before using :doc:`Live Migration </import/live-import>`.

- The destination |service| cluster must be a replica set.

.. _live-import-security:

Source Cluster Security
~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/source-cluster-security.rst

.. include:: /includes/fact-failIndexKeyTooLong-import.rst

Considerations
--------------

Destination Cluster Configuration
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

When configuring the destination cluster, consider the following:

.. include:: /includes/fact-live-migration-destination-cluster.rst

- The destination |service| cluster must be a replica set.

- You cannot select an ``M0`` (Free Tier) or ``M2/M5`` shared-tier
  cluster as the destination for live migration.

- Do **not** change the ``featureCompatibilityVersion`` flag while
  |service| Live Migrate is running.

Database Users and Roles
~~~~~~~~~~~~~~~~~~~~~~~~

|service| does not migrate any user or role data to the destination
cluster.

If the source cluster enforced authentication, you must re-create the
credentials used by your applications on the destination |service|
cluster. |service| uses :ref:`SCRAM <authentication-scram>` for
user authentication. See :doc:`/security-add-mongodb-users` for a
tutorial on creating database users in |service|.

Avoid Namespace Changes
~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/fact-mongomirror-namespace-changes.rst

Rolling Restarts
~~~~~~~~~~~~~~~~

.. include:: /includes/live-import-rolling-restarts.rst

Migrate Your Cluster
--------------------

.. admonition:: Staging and Production Migrations
   :class: note

   Consider performing this procedure twice. Perform a partial migration
   that stops at the :guilabel:`Perform the Cutover` step *first*. This
   creates an up-to-date |service|-backed staging cluster to test
   application behavior and performance
   using the latest
   :driver:`driver version </driver-compatibility-reference>` that
   supports the MongoDB version of the |service| cluster.

   Once you have tested your application, perform the full migration
   procedure using a separate |service| cluster to create your
   |service|-backed production environment.

.. important::

   Avoid making changes to the source cluster configuration while the
   Live Migration procedure runs, such as removing replica set members
   or modifying :binary:`mongod <bin.mongod>` runtime settings
   like ``featureCompatibilityVersion``.

.. include:: /includes/pre-migration-checklist.rst

Procedure
~~~~~~~~~

.. include:: /includes/steps/atlas-live-import.rst

.. _live-migration-support:

.. include:: /includes/live-migration-support.rst
