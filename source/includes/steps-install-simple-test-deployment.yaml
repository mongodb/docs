stepnum: 1
title: "Provision an |onprem| host."
level: 4
ref: set-up-host
content: |

  Provision a host for |onprem| that meets the following requirements:

  .. list-table::
     :widths: 30 70
     :stub-columns: 1

     * - System Memory
       - 15 GB
     * - Disk Capacity
       - 50 GB in ``/`` (The root directory of this host)
     * - Host OS Permissions
       - ``root``
     * - Host OS
       - Red Hat Enterprise Linux 8.0

  .. admonition:: Using |aws|
     :class: note

     An |aws| EC2 ``t3a.xlarge`` instance meets the memory
     requirements. Change the size of the instance's root partition to
     50 GB. Log in to the instance and execute ``df -h`` to verify the
     root partition has 50 GB of space.

  .. important::
     
     Ensure the ``ulimit`` settings meet the minimum requirements. 
     For more information, see the :manual:`MongoDB Ulimit Settings </reference/ulimit>`.

---
stepnum: 2
title: "Configure ``yum`` to install MongoDB."
ref: config-yum
level: 4
content: |

  Create a ``/etc/yum.repos.d/mongodb-org-4.4.repo`` file so
  that you can install MongoDB directly using ``yum``:

  .. code-block:: cfg

     [mongodb-org-4.4]
     name=MongoDB Repository
     baseurl=https://repo.mongodb.org/yum/redhat/$releasever/mongodb-org/4.4/x86_64/
     gpgcheck=1
     enabled=1
     gpgkey=https://www.mongodb.org/static/pgp/server-4.4.asc

---
stepnum: 3
title: "Install MongoDB."
ref: install-mongodb
level: 4
content: |
  Issue the following command to install the latest stable release of
  MongoDB:

  .. code-block:: sh

     sudo yum install -y mongodb-org

---
stepnum: 4
title: "Disable the |mongod| service."
ref: disable-mongodb-service-for-appdb
optional: true
level: 4
content: |

  The |onprem| attaches to its application database on port 27017. If
  the host on which you want to install the application database is
  already running a |mongod|, you need to disable it.

  Invoke the following command to disable the |mongod| service:

  .. code-block:: sh

     sudo systemctl disable mongod
---
stepnum: 5
title: "Create the |onprem| Application Database directory."
ref: create-data-dir
level: 4
content: |
  Issue the following two commands to create the data directory and
  change its ownership:

  .. code-block:: sh

     sudo mkdir -p /data/appdb
     sudo chown -R mongod:mongod /data

---
stepnum: 6
title: "Update the MongoDB configuration file."
ref: update-mdb-conf-file
level: 4
content: |

  When you install MongoDB, it creates a configuration file saved at
  ``/etc/mongod.conf``. Open this file with your preferred text editor.
  Make the following changes to the file:

  .. code-block:: yaml
     :linenos:
     :emphasize-lines: 3, 6, 9-11, 19-20

     systemLog:
       destination: file
       path: "/data/appdb/mongodb.log"
       logAppend: true
     storage:
       dbPath: "/data/appdb"
       journal:
         enabled: true
       wiredTiger:
         engineConfig:
           cacheSizeGB: 1
     processManagement:
       fork: true
       timeZoneInfo: /usr/share/zoneinfo
       pidFilePath: /var/run/mongodb/mongod.pid
     net:
       bindIp: 127.0.0.1
       port: 27017
     setParameter:
       enableLocalhostAuthBypass: false

  Save the file when you have made the edits.

---
stepnum: 7
title: "Start the |onprem| Application Database mongod instance."
ref: start-mongod-instance
level: 4
content: |

  .. code-block:: sh

     sudo -u mongod mongod -f /etc/mongod.conf

---
stepnum: 8
title: "Download the |onprem| package."
ref: application-package-download
level: 4
content: |

  #. Navigate to the :dl:`Ops Manager Download Center <ops-manager>`.

  #. From the :guilabel:`Platforms` drop-down menu, click
     :guilabel:`Red Hat + CentOS 6, 7, 8 / SUSE 12 + 15 / Amazon Linux`.

  #. From the :guilabel:`Packages` drop-down menu, click
     :guilabel:`RPM`.

  #. Click :guilabel:`Download`.

  .. note::

     The downloaded package is named
     ``mongodb-mms-<version>.x86_64.rpm``, where ``<version>`` is the
     version number.

---
stepnum: 9
title: "Copy the |onprem| ``.rpm`` package to your host."
optional: true
ref: copy-rpm-installer
level: 4
content: |

  If you are installing |onprem| on a remote host, such as a cloud
  provider compute instance, use ``scp`` to copy the installer to your
  host:

  .. code-block:: sh

     scp -i <keyfile> mongodb-mms-<version>.x86_64.rpm ec2-user@<public-ip>:~

---
stepnum: 10
title: "Install |onprem|."
ref: install
level: 4
content: |
  Install the ``.rpm`` package by issuing the following command, where
  ``<version>`` is the version of the |onprem| ``.rpm`` package:

  .. code-block:: sh

     sudo rpm -ivh mongodb-mms-<version>.x86_64.rpm

  The install creates the following:

  - The base directory for the |onprem| software, which is:

    ``/opt/mongodb/mms/``

  - A new system user, ``mongodb-mms``, under which the host runs.

  - The ``/opt/mongodb/mms/conf/conf-mms.properties`` file, which
    contains the connection string to access the Application Database
    in :setting:`mongo.mongoUri` setting. The default value is
    ``locahost``, port ``27017``, so no changes are necessary.

---
stepnum: 11
title: "Start |onprem|."
level: 4
ref: start-the-application
content: |
  Issue the following command:

  .. code-block:: sh

     sudo service mongodb-mms start
---
stepnum: 12
title: "Get your instance hostname."
level: 4
ref: public-host-name
content: |
  If you are using an EC2 instance, the hostname is the ``Public DNS``
  listed on the EC2 instance's ``Description`` tab.

  If you do not have a hostname, you can instead use the public IP
  address. To get the public IP address, paste this |url| into your
  preferred browser:

  .. code-block:: sh

     https://www.google.com/search?q=myip
---
stepnum: 13
title: "Open the |onprem| home page and register the first user."
level: 4
ref: home-page
content: |

  a. In a browser, enter the following |url| using the hostname.
     If do not have a hostname, use the public IP address instead:

     .. code-block:: sh

        http://{+opsmgr-url+}

  b. Click the :guilabel:`Register` link and follow the prompts to
     register the first user and create the first project. The first
     user is automatically assigned the :ref:`Global Owner
     <global-owner-role>` role.

---
stepnum: 14
title: "Configure |onprem|."
level: 4
ref: configure-app
content: |

  |onprem| walks you through several configuration pages. Required
  settings are marked with an asterisk. Enter information as
  appropriate. When configuration is complete, |onprem| opens the
  :guilabel:`Deployment` page.

  .. seealso::

     To review the available |onprem| configuration settings, see
     :doc:`/reference/config/ui-settings/`.

---
stepnum: 15
title: "Set up your first deployment."
level: 4
ref: deploy
content: |

  a. Click :guilabel:`MongoDB Ops Manager` in the upper left corner of
     the page to return to the :guilabel:`Deployment` page.

  b. Click :guilabel:`Add New` to deploy a MongoDB instance.

     .. seealso::

       -:doc:`replica set </tutorial/deploy-replica-set>`
       -:doc:`sharded cluster </tutorial/deploy-sharded-cluster>`

...
