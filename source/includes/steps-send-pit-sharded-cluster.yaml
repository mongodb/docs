title: "Restore the snapshot data files to the destination host."
level: 4
ref: copy
content: |
  Extract the snapshot archive for the :term:`config server` and for
  each :term:`shard` to a temporary location.

  .. example::

     .. code-block:: sh

        tar -xvf {backupRestoreName}.tar.gz
        mv {backupRestoreName} {temp-database-path}
---
title: "Run the MongoDB Backup Restore Utility (Point-in-Time Restore Only)."
level: 4
ref: mbru-binary
edition: onprem
content: |

  a. Download the MongoDB Backup Restore Utility to your host.

     .. note::

        If you closed the restore panel, click :guilabel:`Backup`, then
        :guilabel:`More` and then :guilabel:`Download MongoDB Backup
        Restore Utility`.

  b. Run the MongoDB Backup Restore Utility on your destination host.
     Run it once for the config server and each shard.

     .. admonition:: Pre-configured MBRU command
        :class: important

        |mms| provides the ``mongodb-backup-restore-util`` with the
        appropriate options for your restore on the restore panel under
        :guilabel:`Run Binary with PIT Options`.

        Select and copy the `mongodb-backup-restore-util` command
        provided.

  b. Run the MongoDB Backup Restore Utility on your destination host.

     .. admonition:: Pre-configured MBRU command
        :class: important

        |mms| provides the `mongodb-backup-restore-util` with the
        appropriate options for your restore on the restore panel under
        :guilabel:`Run Binary with PIT Options`.

        Select and copy the `mongodb-backup-restore-util` command
        provided.

     .. class:: copyable-code
     .. code-block:: sh

        ./mongodb-backup-restore-util --https --host <targetHost> \
          --port <targetPort> \
          --opStart <opLogStartTimeStamp> \
          --opEnd <opLogEndTimeStamp> \
          --logFile <logPath> \
          --oplogSourceAddr <oplogSourceAddr> \
          --apiKey <apiKey> \
          --groupId <groupId> \
          --rsId <rsId> \
          --whitelist <database1.collection1, database2, etc.> \
          --blacklist <database1.collection1, database2, etc.> \
          --seedReplSetMember \
          --oplogSizeMB <size> \
          --seedTargetPort <port> \
          --ssl \
          --sslCAFile <path> \
          --sslPEMKeyFile <path>

     The ``mongodb-backup-restore-util`` command uses the following
     options:

     .. list-table::
        :widths: 30 10 60
        :header-rows: 1

        * - Option
          - Required
          - Description

        * - ``--https``
          - Optional
          - Use if you need :abbr:`TLS (Transport Security Layer)`/
            :abbr:`SSL (Secure Sockets Layer)` to connect to the
            ``--oplogSourceAddr``.

        * - ``--host``
          - Required
          - Provide the hostname or :abbr:`IP (Internet Protocol)`
            address for the host that serves the :program:`mongod` to
            which the :term:`oplog <Oplog Store Database>` should be
            applied.

        * - ``--port``
          - Required
          - Provide the port for the host that serves the
            :program:`mongod` to which the :term:`oplog <Oplog Store
            Database>` should be applied.

        * - ``--opStart``
          - Required
          - Provide the :ref:`BSON timestamp <document-bson-type-timestamp>`
            for the first :term:`oplog <Oplog Store Database>` entry
            you want to include in the restore.

        * - ``--opEnd``
          - Required
          - Provide the :ref:`BSON timestamp <document-bson-type-timestamp>`
            for the last :term:`oplog <Oplog Store Database>` entry
            you want to include in the restore.

        * - ``--logFile``
          - Optional
          - Provide a path, including file name, where the
            :abbr:`MBRU (MongoDB Backup Restore Utility)` log is
            written.

        * - ``--oplogSourceAddr``
          - Required
          - Provide the URL for the :term:`oplog <Oplog Store
            Database>`.

            .. only:: cloud
               This is ``api-backup-dev.mongodb.com`` for |mms|.

        * - ``--apiKey``
          - Required
          - Provide your |mms| Agent
            :doc:`API Key </tutorial/manage-agent-api-key>`.

        * - ``--groupId``
          - Required
          - Provide the :term:`group` ID.

        * - ``--rsId``
          - Required
          - Provide the :term:`replica set` ID.

        * - ``--whitelist``
          - Optional
          - Provide a list of databases and/or collections to which you
            want to limit the restore.

        * - ``--blacklist``
          - Optional
          - Provide a list of databases and/or collections to which you
            want to exclude from the restore.

        * - ``--seedReplSetMember``
          - Optional
          - Use if you need a replica set member to re-create the
            :term:`oplog <Oplog Store Database>` collection and seed
            it with the correct timestamp.

            Requires ``--oplogSizeMB`` and ``--seedTargetPort``.

        * - ``--oplogSizeMB``
          - Conditional
          - Provide the :term:`oplog <Oplog Store Database>` size in MB.

            Required if ``--seedReplSetMember`` is set.

        * - ``--seedTargetPort``
          - Conditional
          - Provide the port for the :term:`replica set`'s
            :term:`primary`. This may be different from the `ephemeral
            port <https://en.wikipedia.org/wiki/Ephemeral_port?oldid=797306581>`_
            used.

            Required if ``--seedReplSetMember`` is set.

        * - ``--ssl``
          - Optional
          - Use if you need :abbr:`TLS (Transport Security Layer)` /
            :abbr:`SSL (Secure Sockets Layer)` to apply :term:`oplogs
            <Oplog Store Database>` to the :program:`mongod`.
            Requires ``--sslCAFile`` and ``--sslPEMKeyFile``.

        * - ``--sslCAFile``
          - Conditional
          - Provide the path to the :abbr:`CA (Certificate Authority)`
            file.

            Required if ``--ssl`` is set.

        * - ``--sslPEMKeyFile``
          - Conditional
          - Provide the path to the :abbr:`PEM (privacy-enhanced mail)`
            certificate file.

            Required if ``--ssl`` is set.

---
title: "Copy the completed snapshots to restore."
level: 4
ref: distribute
content: |

  - For the config server, copy the restored config server database to
    the working database path of each :term:`replica set` member.

  - For each shard, copy the restored shard database to the working
    database path of each replica set member.

...
