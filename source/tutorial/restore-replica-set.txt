===================================
Restore a Replica Set from a Backup
===================================

.. default-domain:: mongodb

Overview
--------

You can restore a replica set from the artifacts captured by |mms| Backup. You
can restore either a stored snapshot or a point in time in the last 24 hours
between snapshots.

If you restore from a point in time, |mms| Backup creates a
custom snapshot for the selected point by applying the :manual:`oplog
</core/replica-set-oplog/>` to the previous regular snapshot. The point in
time is an upper *exclusive* bound: if you select a timestamp of 12:00,
then the last operation in the restore will be no later than 11:59:59.
Point-in-time recovery takes longer than recovery from a stored snapshot.

When you select a snapshot to restore, |mms| creates a link to download the
snapshot as a tar file. The link is available for one download only and times
out after an hour. You can optionally have |mms| ``scp`` the tar file directly
to your system. The ``scp`` delivery method requires you to :doc:`generate
a key pair </tutorial/generate-key-pair-for-scp-restores>` ahead of time
but provides faster delivery. Windows machines do not come with ``SCP``
and require additional setup outside the scope of this manual.

You can restore either to new hardware or existing hardware. If you restore to
existing hardware, use a different data directory than used previously.

Sequence
--------

The sequence used here to restore a replica set is to download the restore
file and distribute it to each server, restore the :term:`primary`, and then
restore the :term:`secondaries <secondary>`. For additional approaches to
restoring replica sets, see the procedure from the MongoDB Manual to
:manual:`Restore a Replica Set from a Backup
</tutorial/restore-replica-set-from-backup>`.

Prerequisites
-------------

Oplog Size
++++++++++

To seed each replica set member, you will use the :file:`seedSecondary.sh`
or :file:`seedSecondary.bat` script included in the backup restore file. 
When you run the script, you
will provide the replica set's oplog size, in gigabytes. If you do not
have the size, see the section titled "Check the Size of the Oplog" on the
:manual:`Troubleshoot Replica Sets </tutorial/troubleshoot-replica-sets>`
page of the MongoDB manual.

Client Requests
+++++++++++++++

.. include:: /includes/considerations-restore-in-isolation.rst

Procedures
----------

Select and Download the Snapshot
++++++++++++++++++++++++++++++++

.. include:: /includes/steps/download-snapshot-replica-set.rst

Restore the Primary
+++++++++++++++++++

You must have a copy of the snapshot on the server that provides the
primary:

.. include:: /includes/steps/restore-primary.rst

Restore Each Secondary
++++++++++++++++++++++

After you have restored the primary you can restore all
secondaries. You must have a copy of the snapshot on all servers that
provide the secondaries:

.. include:: /includes/steps/restore-secondary.rst
