title: "Navigate to the :guilabel:`Network Access` page for your project."
ref: project-nav-nw-access-page
level: 4
stepnum: 1
content: |

  a. If it is not already displayed, select the organization that
     contains your desired project from the |ui-org-menu| in the
     navigation bar.

  #. If it is not already displayed, select your desired project
     from the :guilabel:`Projects` menu in the navigation bar.

  #. Click :guilabel:`Network Access` in the sidebar.

---
title: "Create a private endpoint."
ref: create-private-endpoint
level: 4
stepnum: 2
content: |

  a. Click the :guilabel:`Private Endpoint` tab.

  #. Click :guilabel:`Add Private Endpoint`.

---
title: "Choose a cloud provider."
ref: select-cloud-provider
level: 4
stepnum: 3
content: |

  Click the |aws| logo, then click :guilabel:`Next`.

---
title: "Choose a region."
ref: select-region
level: 4
stepnum: 4
content: |

  a. From the :guilabel:`Atlas Region` list, select the region
     in which you want to create the private endpoint.

  #. Click :guilabel:`Next`.

  |servicegov-short| creates |vpc| resources in the region
  you selected. This might take several minutes to complete.

---
title: "Configure your private endpoint."
ref: configure-private-endpoint-aws
level: 4
stepnum: 5
content: |

    a. Enter the following details about your |aws| |vpc|:

       .. list-table::
          :widths: 20 80

          * - :guilabel:`Your VPC ID`
            - Unique identifier of the peer |aws| |vpc|. Find this 
              value on the |vpc| dashboard in your |aws| account.

          * - :guilabel:`Your Subnet IDs`
            - Unique identifiers of the subnets your |aws| |vpc| uses. 
              Find these values on the :guilabel:`Subnet` dashboard in 
              your |aws| account.

              .. important::

                You must specify at least one subnet. If you don't, 
                |aws| won't provision an interface endpoint in
                your |vpc|. An  is required for 
                clients in your |vpc| to send traffic to the private endpoint.

    #. Copy the command the dialog displays and run it using the |aws| 
       CLI.

       .. note::
        
          You can't copy the command until |servicegov-short| finishes
          creating |vpc| resources in the background.

          See :aws:`Creating an Interface Endpoint </vpc/latest/userguide/vpce-interface.html#create-interface-endpoint>` to perform this task using the |aws| CLI.
      
    #. You might receive an error like the following when you create 
       the private endpoint:

       .. code-block:: sh
          :copyable: false

          An error occurred (InvalidParameter) when calling the CreateVpcEndpoint 
          operation: The VPC endpoint service com.amazonaws.vpce.us-east-1.vpce-svc-<...> 
          does not support the availability zone of the subnet: subnet-<...>.

       If you receive this error, |servicegov-short| has deployed |vpc| 
       resources into different availability zones than the ones to 
       which you deployed your |vpc| subnets. 
       Please contact MongoDB Support for assistance resolving this 
       error. To contact support, click :guilabel:`Support` from the 
       left-hand navigation bar of the |servicegov-short| UI.
            
    #. Click :guilabel:`Next`.

---
title: "Finalize your private endpoint connection."
ref: finalize-private-endpoint
level: 4
stepnum: 6
content: |

    a. Enter your :guilabel:`VPC Endpoint ID`. This is a 
       22-character alphanumeric string that identifies your private 
       endpoint. Find this value on the |aws| VPC Dashboard under 
       :guilabel:`Endpoints` > :guilabel:`VPC ID`.

    #. Click :guilabel:`Create`.


---
title: "Configure your resources' security groups to send traffic to and receive traffic from the interface endpoint." 
level: 4
ref: resource-sg-pl
stepnum: 7
content: |

  For each resource that needs to connect to your |servicegov-short| 
  clusters using {+aws-pl+}, the resource's security group must allow 
  outbound traffic to the interface endpoint's private IP(s) on all 
  ports.

  See :aws:`Adding Rules to a Security Group </AWSEC2/latest/UserGuide/ec2-security-groups.html#adding-security-group-rule>` in the |aws| 
  documentation for more information.

---
title: "Create a security group for your interface endpoint to allow resources to access it."
ref: attach-sg-pl
level: 4
stepnum: 8
content: |

  This security group must allow inbound traffic on all ports from each 
  resource that needs to connect to your |servicegov-short| clusters 
  using {+aws-pl+}:

  a. In the |aws| console, navigate to the :guilabel:`VPC Dashboard`. 
  
  #. Click :guilabel:`Security Groups`, then click 
     :guilabel:`Create security group`.

  #. Use the wizard to create a security group. Make sure you select 
     your VPC from the :guilabel:`VPC` list.

  #. Select the security group you just created, then click the 
     :guilabel:`Inbound Rules` tab.

  #. Click :guilabel:`Edit Rules`.

  #. Add rules to allow all inbound traffic from each resource in your
     VPC that you want to connect to your |servicegov-short| cluster.

  #. Click :guilabel:`Save Rules`.

  #. Click :guilabel:`Endpoints`, then click the endpoint for your
     VPC.

  #. Click the :guilabel:`Security Groups` tab, then click 
     :guilabel:`Edit Security Groups`.

  #. Add the security group you just created, then click 
     :guilabel:`Save`.

  See :aws:`VPC security groups 
  </vpc/latest/userguide/VPC_SecurityGroups.html>` in the |aws| 
  documentation for more information.

---
title: "Verify that the private endpoint is available."
ref: verify-active-pl-aws
level: 4
stepnum: 9
content: |

  You can connect to an |servicegov-short| cluster using the {+aws-pl+} 
  private endpoint when all of the resources are configured and the 
  private endpoint becomes available.

  To verify that the {+aws-pl+} private endpoint is available:

  a. In the :guilabel:`Security` section of the left navigation,
     click :guilabel:`Network Access`.
  #. On the :guilabel:`Private Endpoint` tab, verify the following 
     statuses for the region that contains the cluster 
     you want to connect to using {+aws-pl+}:

     .. list-table::
        :widths: 20 80

        * - :guilabel:`Atlas Endpoint Service Status`
          - Ready for connection requests
           
        * - :guilabel:`Endpoint Status`
          - Available

  If you do not see these statuses, see 
  :ref:`privatelink-troubleshooting` for additional information.

...
