=========================
Restore a Single Database
=========================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

Backup snapshots contain a complete copy of your :program:`mongod` data
directory. You may want to restore some of the data in a snapshot.

To restore a single database or a collection
from a snapshot, you can use the :ref:`Queryable Backup
<restore-from-queryable-backup>` to export a single database or
collection to restore to the target deployment.

You can also manually :ref:`manual-restore-from-backup`.

.. only:: onprem

   .. include:: /includes/fact-pit-restore-change.rst

Considerations
--------------

Before you attempt a restore, ensure the host for your target
deployment has sufficient storage space for the restore files and the
restored database, plus additional space for dataset growth. Use
:manual:`db.stats() </reference/method/db.stats/>` to find the current
database size.

.. _restore-from-queryable-backup:

Restore a Database or Collection from Queryable Backup
------------------------------------------------------

You can use a :doc:`queryable backup snapshot </tutorial/query-backup>`
to export data for a database or a collection and restore to the target
deployment. The following procedure connects to the queryable backup
instance via |mms|-provided tunnel [#manual-connect]_.

.. include:: /includes/steps/restore-db-from-queryable-backup.rst

.. [#manual-connect]
   Alternatively, instead of connecting via the tunnel, you can
   :ref:`connect directly <query-via-manual-connection>` to the
   queryable backup, using the X.509 PEM files provided. If connecting
   directly to the queryable backup, you must specify the hostname and
   port, the TLS/SSL option, and the X.509 certificates.

.. _manual-restore-from-backup:

Restore a Database or Collection from a Manually Created Backup Instance
------------------------------------------------------------------------

Prerequisites
~~~~~~~~~~~~~

.. include:: /includes/extracts/fact-restore-from-encrypted-backup-prereq.rst

.. include:: /includes/extracts/encrypted-backup-display-kmip-info.rst

Secure Copy (``SCP``) Delivery
++++++++++++++++++++++++++++++

.. include:: /includes/note-scp-key-pair-requirement.rst

.. include:: /includes/note-windows-scp-issue.rst

.. _select-snapshot-single-database:

Select and Prepare a Snapshot
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/steps/prepare-snapshot-single-database.rst

.. _retrieve-snapshot-single-database:

Retrieve a Snapshot using HTTPS
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/steps/download-snapshot-single-database.rst

.. important::
   Skip to :ref:`restore-single-database`.

.. _send-snapshot-single-database-by-scp:

Send Snapshot using SCP
~~~~~~~~~~~~~~~~~~~~~~~

Direct |mms| to copy the restore files to your server via ``SCP``.

.. include:: /includes/steps/send-snapshot-single-database-scp.rst

.. _restore-single-database:

Restore the Database
~~~~~~~~~~~~~~~~~~~~

The following examples use:

- ``27017`` as the port for a running MongoDB instance that receives
  the restored backup.

- ``27018`` as the port for the temporary MongoDB instance that
  uses the snapshot to export the single database.

.. include:: /includes/steps/restore-single-database.rst
