==================================================
Install or Upgrade the On-Prem MMS Service: Debian
==================================================

.. default-domain:: mongodb

Overview
--------

|mms| is a service to monitor and back up a MongoDB infrastructure. This
tutorial describes the basic process to install and configure the service.

At a high level, a basic installation will look like the following.
The estimated setup time is less than an hour.

#. Install a standalone local MongoDB server backed by a fast, large storage volume.

#. Install an SMTP email server as appropriate for your environment.

#. Configure the MMS server's URL and email addresses.

#. Start up MMS server.

Links to configure the MMS application and start MMS are at the bottom of
this tutorial.

Prerequisites
-------------

Contact a MongoDB representative to obtain the current stable |monitoring|
release. MMS is available in DEB packages for Debian, Ubuntu, and related
systems; RPM for Red Hat Enterprise Linux, CentOS, Fedora, and related
systems; as well as ``tar.gz`` and ``zip`` packages.

You can also download the latest On-Prem Monitoring releases from
<http://www.mongodb.com/commercialsupport/downloads> as an RPM package.

Confirm your environment meets the :doc:`/management/requirements`.

Procedures
----------

Install and Start MongoDB System
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

See the :manual:`MongoDB Installation tutorials </installation>` for
complete instructions on this procedure.

Install the MMS Software Packages
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Install the DEB by issuing command in the following form:

.. code-block:: sh

   sudo dpkg --install mongodb-mms-<version>.x86_64.deb

Replace ``<version>`` with the version of the ``.deb`` you
obtained. When installed, the base directory for the MMS software is
``/opt/mongodb/mms/``. The DEB package will also create a new system
user ``mongodb-mms`` under which the server will run.

Update the MMS Software Packages
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Upgrade |mms| from 1.2 and Earlier
++++++++++++++++++++++++++++++++++

Due to the `company name change
<http://www.mongodb.com/press/10gen-announces-company-name-change-mongodb-i
nc>`_, the name of the MMS package changed between versions 1.2 and 1.3.
Therefore, to upgrade the |mms| server from *any* version before 1.3, use
the following procedure:

#. *Recommended.* Take a full backup of the MMS database before
   beginning the upgrade procedure.

#. Shut down MMS, using the following command:

   .. code-block:: sh

      /etc/init.d/10gen-mms stop

#. Download the latest package and proceed with the instructions
   for a fresh install. Do not attempt to use your package manager
   to do an upgrade.

   When complete, |mms| is installed in the ``/opt/mongodb/mms``
   directory.

#. Follow all procedures for a new install include configuring the
   options in ``/opt/mongodb/mms/conf/conf-mms.properties``. If you
   used encrypted authentication credentials you will need to
   regenerate these manually.  *Do not copy the credentials from
   your old properties file. Old credentials will not work.*

#. Start MMS  using the new package name:

   .. code-block:: sh

      sudo /etc/init.d/mongodb-mms start

#. Update any Monitoring Agent. See :ref:`upgrade-mms-agent` for
   more information.

Upgrade a Debian-Based Installation
+++++++++++++++++++++++++++++++++++

Please contact MMS to receive the download location of the latest
MMS server release.

1. Shutdown the On-Prem MMS server and take a backup of your existing
   configuration:

   .. code-block:: sh

    sudo /etc/init.d/mongodb-mms stop
    sudo cp -a <install_dir>/conf ~/mms_conf.backup

#. Reconcile any changes in configuration files.

   At this point the upgrade is complete. However you may need to reconcile
   changes in your configuration with new configuration options
   available in the latest release.

   Compare your current configuration to the updated version, with the
   following sequence of operations:

   .. code-block:: sh

      diff -u <install_dir>/conf/conf-mms.properties <install_dir>/conf/conf-mms.properties.rpmnew
      diff -u <install_dir>/conf/mms.conf <install_dir>/conf/mms.conf.rpmnew

   Edit your configuration to resolve any conflicts between the old
   and new versions, being sure to take any new changes from
   ``conf-mms.properties.rpmnew`` as appropriate. Changes to
   ``mms.centralUri``, email addresses, and MongoDB are the most
   common configuration changes.

   Repeat the above reconciliation for ``mms.conf`` if the upgrade
   indicates a conflict.

   .. note::

      The upgrade from beta versions 1.0.1 to 1.0.2 changed several
      paths to make the MMS server completely self contained. In
      1.0.2 all logs, configuration, and working files are in the
      ``/opt/10gen/mms/`` hierarchy. This changes the following paths
      from 1.0.1:

      - New logs path:  <install_dir>/logs/
      - New tmp path:  <install_dir>/tmp/

      Finally, you may also need to re-symlink your startup script:

      .. code-block:: sh

         sudo ln -s /<install_dir>/bin/mongodb-mms /etc/init.d/mongodb-mms

#. Restart the On-Prem MMS server.

   .. code-block:: sh

      sudo /etc/init.d/mongodb-mms start

.. include:: /includes/mms-install-next-steps.rst

