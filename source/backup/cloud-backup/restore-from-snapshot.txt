.. _restore-from-snapshot:

==============================================
Restore from a Scheduled or On-Demand Snapshot
==============================================

.. default-domain:: mongodb

.. meta::
   :keywords: restore, backup, snapshot

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

|service| lets you restore data from a scheduled or on-demand 
{+Cloud-Backup+}. The following sections describe restoring from a 
snapshot *without* {+encrypt-at-rest+}. To restore from a snapshot 
using {+encrypt-at-rest+}, see :ref:`restore-from-ear`.

Restore Considerations
~~~~~~~~~~~~~~~~~~~~~~

In addition to the :ref:`prerequisites <restore-prereq>`, consider the
following requirements and limitations when restoring from a scheduled
or on-demand {+Cloud-Backup+}.

.. include:: /includes/fact-restore-reqs.rst

- This feature is not available for ``M0`` {+clusters+}.

- .. include:: /includes/fact-fts-indexes-backup-restore.rst
 
  .. note::
     
     When you restore the data from the snapshot, the |fts| index 
     definitions from the snapshot replace any existing |fts| index 
     definitions.

Sharded {+Clusters+}
````````````````````

- If you are restoring from a sharded {+cluster+}, the source and 
  target {+clusters+} must have the same number of shards.

- |service| can't restore a sharded cluster snapshot to a replica set.

M2/M5 {+Clusters+}
``````````````````

- Starting with MongoDB 5.0, you can restore snapshots of {+clusters+}
  that run only the two most recent major versions of MongoDB to
  ``M2`` and ``M5`` {+clusters+}.

  .. example::

     - You can restore snapshots taken from {+clusters+} that run 
       MongoDB 4.2 to an ``M2`` or ``M5`` {+cluster+} that runs MongoDB
       5.0. 
     - You can't restore snapshots taken from {+clusters+} that run
       MongoDB 4.0 to an ``M2`` or ``M5`` {+cluster+} that runs MongoDB 5.0.

{+Serverless-Instances+}
````````````````````````

- |service| can't restore snapshots from shared clusters, dedicated 
  clusters, or Cloud Manager to a {+serverless-instance+}.

- If you are restoring from a {+serverless-instance+}, you can only
  restore the two most recent snapshots.

Recommendations to Optimize Restore Times
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/restore-optimization-considerations.rst

.. _cps-fallback-snapshots:

Fallback Snapshots
~~~~~~~~~~~~~~~~~~

If a scheduled snapshot fails for any reason, |service| attempts to
repeat the snapshot process. If necessary, you may use the resulting
fallback snapshot to restore the cluster. This isn't recommended:
fallback snapshots use a different process from regular snapshots. They
may contain inconsistent data.

Fallback snapshots are marked in the UI with a warning icon, and a
warning message appears in the restore modal window if the restore uses
a fallback snapshot.

.. warning::

   Restoring your cluster from a fallback snapshot may result in
   inconsistent data across your cluster, and should be considered an
   option of last resort.

Required Access
~~~~~~~~~~~~~~~

.. include:: /includes/atlas-roles/restore-and-watch.rst

.. _restore-cluster:

Procedure
~~~~~~~~~

.. include:: /includes/fact-restore-cluster-downtime-warning.rst

.. tabs::

   .. tab:: {+atlas-cli+}
      :tabid: atlascli

      Restore a {+Cluster+} 
      `````````````````````

      .. include:: /includes/extracts/atlas-backups-restores-start-and-watch.rst

      Restore a {+Serverless-Instance+}
      `````````````````````````````````
         
      .. include:: /includes/extracts/atlas-serverless-backups-restores-create-and-watch.rst

   .. tab:: {+atlas-admin-api+}
      :tabid: atlas-api 

      The {+atlas-admin-api+} provides different endpoints for restoring
      ``M10+`` {+clusters+}, ``M2/M5`` {+clusters+} and 
      {+serverless-instances+}.

      :oas-atlas-tag:`Restore One Snapshot of One Cluster </Cloud-Backups/operation/createBackupRestoreJob>`
      :oas-atlas-tag:`Create One Restore Job from One M2 or M5 Cluster </Shared-Tier-Restore-Jobs/operation/createSharedClusterBackupRestoreJob>`
      :oas-atlas-tag:`Restore One Snapshot of One Serverless Instance </Cloud-Backups/operation/createServerlessBackupRestoreJob>`

   .. tab:: {+atlas-ui+}
      :tabid: atlasui

      .. include:: includes/procedures/snapshot-restore.rst
