==================================
Query a {+Old-Backup+} Snapshot
==================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. include:: /includes/admonitions/deprecated-continuous-backup.rst

|service| supports querying a
:doc:`{+old-backup+} </backup/legacy-backup/overview>` snapshot.
This functionality allows you to query specific {+old-backup+}
snapshot. You can use the queryable backups to:

- Restore a subset of data within the MongoDB cluster.

- Compare previous versions of data against the current data.

- Identify the best point in time to restore a system by comparing data
  from multiple {+old-backup+}s.

Considerations
--------------

- |service| does not support querying
  :doc:`{+Cloud-Backup+}s </backup/cloud-backup/overview>`.

- |service| provisions these queryable snapshots as *read-only* MongoDB
  instances.

  .. important::
     These instances are available for up to 24 hours.

- Query restrictions:

  - You cannot run map-reduce operations.

  - You cannot run queries that requires disk usage, such as running
    aggregation with the ``allowDiskUse`` option to perform large sort
    operations.

- Connections to these instances are over TLS/SSL and require a X.509
  authentication. |service| provides:

  - An executable to create a :ref:`tunnel <query-via-tunnel>` which
    handles the connection, including the TLS/SSL and the X.509
    authentication.

  - X.509 certificates if you want to handle the connection details
    manually, including the TLS/SSL and the X.509 authentication.

.. _query-via-tunnel:

Query Backup (Use Tunnel to Connect)
------------------------------------

.. note::

   The tunnel handles the security (TLS/SSL and X.509 authentication)
   for connecting to the instance.

.. include:: /includes/steps/query-backup-tunnel.rst

.. tip::

   Once you have finished querying this snapshot, you can terminate the
   queryable instance:

   #. Go to the :guilabel:`Restores & Downloads` tab and hover over the
      :guilabel:`Status` column for the cluster.

   #. Click :guilabel:`Cancel`.

.. _query-via-manual-connection:

Query Backup (Handle TLS and Authentication Manually)
-----------------------------------------------------

.. note::

   The X.509 certificates are valid for 24 hours.

.. include:: /includes/steps/query-backup-manual.rst

.. tip::

   Once you have finished querying this snapshot, you can terminate the
   queryable instance:

   #. Go to the :guilabel:`Restores & Downloads` tab and hover over the
      :guilabel:`Status` column for the cluster.

   #. Click :guilabel:`Cancel`.
