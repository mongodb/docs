=============================
Release Notes for MongoDB 3.0
=============================

.. default-domain:: mongodb

*March 3, 2015*

MongoDB 3.0 is now available. Key features include support for the
WiredTiger storage engine, pluggable storage engine API,
``SCRAM-SHA-1`` authentication mechanism, and improved ``explain``
functionality.

MongoDB Ops Manager, which includes Automation, Backup, and Monitoring,
is now also available. See the `Ops Manager documentation
<http://docs.opsmanager.mongodb.com/current/>`_ and the `Ops Manager
release notes
<http://docs.opsmanager.mongodb.com/current/release-notes/application/>`_
for more information.

Minor Releases
--------------

.. class:: hidden

   .. toctree::

      /release-notes/3.0-changelog

3.0.1 -- April 7, 2015
~~~~~~~~~~~~~~~~~~~~~~

- Fix inefficient query plans for ``2d`` \ :query:`$nearSphere`:
  :issue:`SERVER-17469`

- Fix problem starting :program:`mongod` during repair operations with
  WiredTiger: :issue:`SERVER-17652` and :issue:`SERVER-17729`

- Resolved invalid compression stream error with WiredTiger and ``zlib``
  block compression: :issue:`SERVER-17713`

- Fix memory use issue for inserts into large indexed arrays:
  :issue:`SERVER-17616`

- `All issues closed in 3.0.2
  <https://jira.mongodb.org/issues/?jql=fixVersion%20%3D%20%223.0.2%22%20AND%20project%20%3D%20SERVER>`_


3.0.1 -- March 17, 2015
~~~~~~~~~~~~~~~~~~~~~~~

- Fixed race condition in WiredTiger between inserts and checkpoints that could
  result in lost records: :issue:`SERVER-17506`.

- Resolved issue in WiredTiger's capped collections implementing that
  caused a server crash: :issue:`SERVER-17345`.

- Fixed issue is initial sync with duplicate ``_id`` entries:
  :issue:`SERVER-17487`.

- Fixed deadlock condition in MMAPv1 between the journal lock and the
  oplog collection lock: :issue:`SERVER-17416`.

- `All issues closed in 3.0.1
  <https://jira.mongodb.org/issues/?jql=fixVersion%20%3D%20%223.0.1%22%20AND%20project%20%3D%20SERVER>`_

Major Changes
-------------

Pluggable Storage Engine API
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

MongoDB 3.0 introduces a pluggable storage engine API that allows third
parties to develop storage engines for MongoDB.

WiredTiger
~~~~~~~~~~

MongoDB 3.0 introduces support for the `WiredTiger
<http://wiredtiger.com>`_ storage engine. With the support for
WiredTiger, MongoDB now supports two storage engines:

- MMAPv1, the storage engine available in previous versions of MongoDB
  and the default storage engine for MongoDB 3.0, and

- `WiredTiger <http://wiredtiger.com>`_, available only in the 64-bit
  versions of MongoDB 3.0.

WiredTiger Usage
````````````````

WiredTiger is an alternate to the default MMAPv1 storage engine.
WiredTiger supports all MongoDB features, including operations that
report on server, database, and collection statistics. Switching to
WiredTiger, however, requires a change to the :ref:`on-disk storage
format <3.0-compatibility-data-file>`. For instructions on changing the
storage engine to WiredTiger, see the appropriate sections in the
:doc:`/release-notes/3.0-upgrade` documentation.

MongoDB 3.0 replica sets and sharded clusters can have members with
different storage engines; however, performance can vary according to
workload. For details, see the appropriate sections in the
:doc:`/release-notes/3.0-upgrade` documentation.

The WiredTiger storage engine requires the latest official MongoDB
drivers. For more information, see
:ref:`3.0-compatibility-drivers-wired-tiger`.

.. seealso:: :ref:`3.0-compatibility-touch`,
   :ref:`storage-wiredtiger` section in the :doc:`/core/storage`
   documentation

WiredTiger Configuration
````````````````````````

To configure the behavior and properties of the WiredTiger storage
engine, see :setting:`storage.wiredTiger` configuration options. You
can set :ref:`WiredTiger options on the command line
<cli-wiredtiger-options>`.

.. seealso::
   :ref:`storage-wiredtiger` section in the :doc:`/core/storage`
   documentation

WiredTiger Concurrency and Compression
``````````````````````````````````````

The 3.0 WiredTiger storage engine provides document-level locking and
compression.

By default, WiredTiger compresses collection data using the
:term:`snappy` compression library. WiredTiger uses :term:`prefix
compression` on all indexes by default.

.. seealso::
   :ref:`prod-notes-wired-tiger-concurrency` section in the
   :doc:`/administration/production-notes`

MMAPv1 Improvements
~~~~~~~~~~~~~~~~~~~

MMAPv1 Concurrency Improvement
``````````````````````````````

In version 3.0, the MMAPv1 storage engine adds support for
collection-level locking.

MMAPv1 Configuration Changes
````````````````````````````

To support multiple storage engines, some configuration settings for
MMAPv1 have changed. See :ref:`3.0-compatibility-configuration-file`.

.. _3.0-mmapv1-padding:

MMAPv1 Record Allocation Behavior Changes
`````````````````````````````````````````

MongoDB 3.0 no longer implements dynamic record allocation and
deprecates :term:`paddingFactor <padding factor>`. The default
allocation strategy for collections in instances that use MMAPv1 is
:ref:`power of 2 allocation <power-of-2-allocation>`, which has been
improved to better handle large document sizes. In 3.0, the
``usePowerOf2Sizes`` flag is ignored, so the power of 2 strategy is
used for all collections that do not have ``noPadding`` flag set.

For collections with workloads that consist only of inserts or in-place
updates (such as incrementing counters), you can disable the power of 2
strategy. To disable the power of 2 strategy for a collection, use the
:dbcommand:`collMod` command with the :collflag:`noPadding` flag or the
:method:`db.createCollection()` method with the ``noPadding`` option.

.. warning::

   Do not set ``noPadding`` if the workload includes removes or any
   updates that may cause documents to grow. For more information, see
   :ref:`exact-fit-allocation`.

When low on disk space, MongoDB 3.0 no longer errors on all writes but
only when the required disk allocation fails. As such, MongoDB now
allows in-place updates and removes when low on disk space.

.. seealso:: :ref:`3.0-compatiblity-record-alloc`

.. _3.0-replica-sets:

Replica Sets
------------

.. _3.0-replica-sets-max-members:

Increased Number of Replica Set Members
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

In MongoDB 3.0, replica sets can have up to 50
members. [#voting-members]_ The following drivers support the larger
replica sets:

- C# (.NET) Driver 1.10
- Java Driver 2.13
- Python Driver (PyMongo) 3.0+
- Ruby Driver 2.0+
- Node.JS Driver 2.0+

Because the C, C++, Perl, PHP, and earlier versions of the Ruby,
Python, and Node.JS drivers discover and monitor replica set members
serially, these drivers are not suitable for use with large replica
sets.

PyMongo 3.0 is currently in development.

.. [#voting-members] The maximum number of *voting* members remains at 7.

.. _3.0-replica-sets-step-down:

Replica Set Step Down Behavior Changes
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The process that a :term:`primary` member of a :term:`replica set`
uses to step down has the following changes:

- Before stepping down, :dbcommand:`replSetStepDown` will attempt to
  terminate long running user operations that would block the primary
  from stepping down, such as an index build, a write operation or a
  map-reduce job.

- To help prevent rollbacks, the :dbcommand:`replSetStepDown` will wait
  for an electable secondary to catch up to the state of the primary
  before stepping down. Previously, a primary would wait for a
  secondary to catch up to within 10 seconds of the primary (i.e. a
  secondary with a replication lag of 10 seconds or less) before
  stepping down.

- :dbcommand:`replSetStepDown` now allows users to specify a
  ``secondaryCatchUpPeriodSecs`` parameter to specify how long the
  primary should wait for a secondary to catch up before stepping
  down.

.. _3.0-replica-sets-operational-changes:

Other Replica Set Operational Changes
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- Initial sync builds indexes more efficiently for each collection and
  applies oplog entries in batches using threads.

- Definition of :ref:`w: "majority" <wc-w>` write concern changed to
  mean majority of *voting* nodes.

- Stronger restrictions on
  :doc:`/reference/replica-configuration`. For details, see
  :ref:`3.0-compatibility-repl-set-config`.

- For pre-existing collections on secondary members, MongoDB 3.0 no
  longer automatically builds missing ``_id`` indexes.

.. seealso:: :ref:`3.0-compatibility-rs` in
   :doc:`/release-notes/3.0-compatibility`

.. _3.0-sharded-clusters:

Sharded Clusters
----------------

MongoDB 3.0 provides the following enhancements to sharded clusters:

- Adds a new :method:`sh.removeTagRange()` helper to improve management
  of sharded collections with tags. The new
  :method:`sh.removeTagRange()` method acts as a complement to
  :method:`sh.addTagRange()`.

- Provides a more predictable read preference behavior.
  :program:`mongos` instances no longer pin connections to members of
  replica sets when performing read operations. Instead,
  :program:`mongos` reevaluates :doc:`read preferences
  </core/read-preference>` for every operation to provide a more
  predictable read preference behavior when read preferences change.

- Provides a new ``writeConcern`` setting to configure the :doc:`write
  concern </core/write-concern>` of chunk migration operations. You can
  configure the ``writeConcern`` setting for the :ref:`balancer
  <sharded-cluster-config-secondary-throttle>` as well as for
  :dbcommand:`moveChunk` and :dbcommand:`cleanupOrphaned` commands.

- Improves visibility of balancer operations. :method:`sh.status()`
  includes information about the state of the balancer. See
  :method:`sh.status()` for details.

.. seealso:: :ref:`3.0-compatibility-sharded-cluster` in
   :doc:`/release-notes/3.0-compatibility`

Security Improvements
---------------------

MongoDB 3.0 includes the following security enhancements:

- MongoDB 3.0 adds a new :ref:`SCRAM-SHA-1
  <authentication-scram-sha-1>` challenge-response user authentication
  mechanism. ``SCRAM-SHA-1`` requires a driver upgrade if your current
  driver version does not support ``SCRAM-SHA-1``. For the driver
  versions that support ``SCRAM-SHA-1``, see
  :ref:`considerations-scram-sha-1-drivers`.

- Increases restrictions when using the :ref:`localhost-exception` to
  access MongoDB. For details, see :ref:`3.0-compatibility-localhost`.

.. seealso::
   :ref:`3.0-compatibility-security-changes`

Improvements
------------

New Query Introspection System
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

MongoDB 3.0 includes a new query introspection system that provides an
improved output format and a finer-grained introspection into both
query plan and query execution.

For details, see the new :method:`db.collection.explain()` method and
the new :dbcommand:`explain` command as well as the updated
:method:`cursor.explain()` method.

For information on the format of the new output, see
:doc:`/reference/explain-results`.

.. _3.0-logging-improvements:

Enhanced Logging
~~~~~~~~~~~~~~~~

To improve usability of the log messages for diagnosis, MongoDB
categorizes some log messages under specific components, or operations,
and provides the ability to set the verbosity level for these
components. For information, see :doc:`/reference/log-messages`.

.. _3.0-tools-enhancements:

MongoDB Tools Enhancements
~~~~~~~~~~~~~~~~~~~~~~~~~~

All MongoDB tools are now written in Go and maintained as a separate
project.

- New options for parallelized :program:`mongodump` and
  :program:`mongorestore`. You can control the number of collections
  that :program:`mongorestore` will restore at a time with the
  ``--numParallelCollections`` option.

- New options ``-excludeCollection`` and
  ``--excludeCollectionsWithPrefix`` for :program:`mongodump` to
  exclude collections.

- :program:`mongorestore` can now accept BSON data input from standard
  input in addition to reading BSON data from file.

- :program:`mongostat` and :program:`mongotop` can now return output
  in JSON format with the ``--json`` option.

- Added configurable :term:`write concern` to :program:`mongoimport`,
  :program:`mongorestore`, and :program:`mongofiles`. Use the
  ``--writeConcern`` option.

- :program:`mongofiles` now allows you to configure the GridFS prefix
  with the ``--prefix`` option so that you can use custom namespaces
  and store multiple GridFS namespaces in a single database.

.. seealso:: :ref:`3.0-compatibility-tools`

Indexes
~~~~~~~

- Background index builds will no longer automatically interrupt if
  :dbcommand:`dropDatabase`, :dbcommand:`drop`,
  :dbcommand:`dropIndexes` operations occur for the database or
  collection affected by the index builds. The
  :dbcommand:`dropDatabase`, :dbcommand:`drop`, and
  :dbcommand:`dropIndexes` commands will still fail with the error
  message ``a background operation is currently running``, as in 2.6.

- If you specify multiple indexes to the :dbcommand:`createIndexes`
  command,

  - the command only scans the collection once, and

  - if at least one index is to be built in the foreground, the
    operation will build all the specified indexes in the foreground.

- For sharded collections, indexes can now :ref:`cover queries
  <read-operations-covered-query>` that execute against the
  :program:`mongos` if the index includes the shard key.

.. seealso::
   :ref:`3.0-compatibility-indexes` in
   :doc:`/release-notes/3.0-compatibility`

Query Enhancements
~~~~~~~~~~~~~~~~~~

MongoDB 3.0 includes the following query enhancements:

- For geospatial queries, adds support for "big" polygons for
  :query:`$geoIntersects` and :query:`$geoWithin` queries. "Big"
  polygons are single-ringed GeoJSON polygons with areas greater than
  that of a single hemisphere. See :query:`$geometry`,
  :query:`$geoIntersects`, and :query:`$geoWithin` for details.

- For :method:`~db.collection.aggregate()`, adds a new
  :expression:`$dateToString` operator to facilitate converting a date
  to a formatted string.

- Adds the :query:`$eq` query operator to query for equality conditions.

.. seealso:: :ref:`3.0-geo-near-compatibility`

Distributions
~~~~~~~~~~~~~

Most non-Enterprise MongoDB distributions now include support for SSL.
Previously, only MongoDB Enterprise distributions came with SSL support
included; for non-Enterprise distributions, you had to build MongoDB
locally with the ``--ssl`` flag (i.e. ``scons --ssl``).

MongoDB Enterprise Features
---------------------------

Auditing
~~~~~~~~

:doc:`/core/auditing` in MongoDB Enterprise can filter on :doc:`any
field in the audit message </reference/audit-message>`, including the
fields returned in the :ref:`param <audit-action-details-results>`
document. This enhancement, along with the
:parameter:`auditAuthorizationSuccess` parameter, enables auditing to
filter on CRUD operations. However, enabling
:parameter:`auditAuthorizationSuccess` to audit of all authorization
successes degrades performance more than auditing only the
authorization failures.

Additional Information
----------------------

Changes Affecting Compatibility
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. class:: hidden

   .. toctree::

      /release-notes/3.0-compatibility

Some changes in 3.0 can affect :doc:`compatibility
</release-notes/3.0-compatibility>` and may require user actions. For a
detailed list of compatibility changes, see
:doc:`/release-notes/3.0-compatibility`.

Upgrade Process
~~~~~~~~~~~~~~~

.. class:: hidden

   .. toctree::

      /release-notes/3.0-upgrade
      /release-notes/3.0-scram
      /release-notes/3.0-downgrade

See :doc:`/release-notes/3.0-upgrade` for full upgrade instructions.

Download
~~~~~~~~

To download MongoDB 3.0, go to the `downloads page`_.

.. _`downloads page`: http://www.mongodb.org/downloads

Additional Resources
~~~~~~~~~~~~~~~~~~~~

- `All Third Party License Notices <https://github.com/mongodb/mongo/blob/v3.0/distsrc/THIRD-PARTY-NOTICES>`_.

- `All JIRA issues resolved in 3.0 <http://bit.ly/1CpOu6t>`_.
