=============================
Change the Version of MongoDB
=============================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

|mms| supports safe automatic MongoDB version upgrades and downgrades
of managed MongoDB deployments while maximizing the availability of
your deployment. |mms| can upgrade and downgrade :term:`sharded
clusters <sharded cluster>`, :term:`replica sets <replica set>`, and
:term:`standalone MongoDB instances <standalone>`.

:doc:`/tutorial/configure-available-mongodb-version` describes how
to choose which versions of MongoDB are available to |mms|.

If |mms| does not manage your deployment, you need to change the
version of MongoDB manually. The MongoDB Manual provides upgrade
tutorials with each :manual:`release </release-notes>`.

.. include:: /includes/extracts/mongodb-eol-3.2.rst

Considerations
--------------

.. include:: /includes/considerations-change-mongodb-version.rst

Prerequisites
-------------

Remove Incompatible MongoDB Features when Downgrading
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

If the MongoDB deployment has set its
:guilabel:`Feature Compatibility Version` to the same release series
as its :guilabel:`Version`, you must first downgrade the
:manual:`featureCompatibilityVersion</reference/command/setFeatureCompatibilityVersion>`
of the instance manually.

.. cond:: onprem

   .. tabs::

      .. tab:: 4.2 to 4.0
         :tabid: four-two-to-three-six

         1. :ref:`Unmanage the deployment <remove-from-automation>`.

         #. Downgrade the deployment item manually.

            - :manual:`Downgrade 4.2 Standalone to 4.0 </release-notes/4.2-downgrade-standalone>`
            - :manual:`Downgrade 4.2 Replica Set to 4.0 </release-notes/4.2-downgrade-replica-set>`
            - :manual:`Downgrade 4.2 Sharded Cluster to 4.0 </release-notes/4.2-downgrade-sharded-cluster>`

            .. note::
               This removes any :ref:`4.2 incompatible features
               <4.2-compatibility-enabled>` and sets the
               ``"featureCompatibilityVersion" : "4.0"``.

         #. :doc:`Import the deployment </tutorial/add-existing-mongodb-processes>` back into |mms|.

      .. tab:: 4.0 to 3.6
         :tabid: four-oh-to-three-six

         1. :ref:`Unmanage the deployment <remove-from-automation>`.

         #. Downgrade the deployment item manually.

            - :manual:`Downgrade 4.0 Standalone to 3.6 </release-notes/4.0-downgrade-standalone>`
            - :manual:`Downgrade 4.0 Replica Set to 3.6 </release-notes/4.0-downgrade-replica-set>`
            - :manual:`Downgrade 4.0 Sharded Cluster to 3.6 </release-notes/4.0-downgrade-sharded-cluster>`

            .. note::
               This removes any :ref:`4.0 incompatible features
               <4.0-compatibility-enabled>` and sets the
               ``"featureCompatibilityVersion" : "3.6"``.

         #. :doc:`Import the deployment </tutorial/add-existing-mongodb-processes>` back into |mms|.

      .. tab:: 3.6 to 3.4
         :tabid: three-six-to-three-four

         1. :ref:`Unmanage the deployment <remove-from-automation>`.

         #. Downgrade the deployment item manually.

            - :manual:`Downgrade 3.6 Standalone to 3.4 </release-notes/3.6-downgrade-standalone>`
            - :manual:`Downgrade 3.6 Replica Set to 3.4 </release-notes/3.6-downgrade-replica-set>`
            - :manual:`Downgrade 3.6 Sharded Cluster to 3.4 </release-notes/3.6-downgrade-sharded-cluster>`

            .. note::
               This removes any :ref:`3.6 incompatible features
               <3.6-compatibility-enabled>` and sets the
               ``"featureCompatibilityVersion" : "3.4"``.

         #. :doc:`Import the deployment </tutorial/add-existing-mongodb-processes>` back into |mms|.

      .. tab:: 3.4 to 3.2
         :tabid: three-four-to-three-two

         1. :ref:`Unmanage the deployment <remove-from-automation>`.

         #. Downgrade the deployment manually:

            - :manual:`Downgrade 3.4 Standalone to 3.2 </release-notes/3.4-downgrade-standalone>`
            - :manual:`Downgrade 3.4 Replica Set to 3.2 </release-notes/3.4-downgrade-replica-set/>`
            - :manual:`Downgrade 3.4 Sharded Cluster to 3.2 </release-notes/3.4-downgrade-sharded-cluster>`

            .. note::
               This removes any :ref:`3.4 incompatible features
               <3.4-compatibility-enabled>` and sets the
               ``"featureCompatibilityVersion" : "3.2"``.

         #. :doc:`Import the deployment </tutorial/add-existing-mongodb-processes>` back into |mms|.

.. cond:: cloud

   .. tabs::

      .. tab:: 4.2 to 4.0
         :tabid: four-two-to-four-oh

         1. :ref:`Unmanage the deployment <remove-from-automation>`.

         #. Downgrade the deployment item manually.

            - :manual:`Downgrade 4.2 Standalone to 4.0 </release-notes/4.2-downgrade-standalone>`
            - :manual:`Downgrade 4.2 Replica Set to 4.0 </release-notes/4.2-downgrade-replica-set>`
            - :manual:`Downgrade 4.2 Sharded Cluster to 4.0 </release-notes/4.2-downgrade-sharded-cluster>`

            .. note::
               This removes any :ref:`4.2 incompatible features
               <4.2-compatibility-enabled>` and sets the
               ``"featureCompatibilityVersion" : "4.0"``.

         #. :doc:`Import the deployment </tutorial/add-existing-mongodb-processes>` back into |mms|.

      .. tab:: 4.0 to 3.6
         :tabid: four-oh-to-three-six

         1. :ref:`Unmanage the deployment <remove-from-automation>`.

         #. Downgrade the deployment item manually.

            - :manual:`Downgrade 4.0 Standalone to 3.6 </release-notes/4.0-downgrade-standalone>`
            - :manual:`Downgrade 4.0 Replica Set to 3.6 </release-notes/4.0-downgrade-replica-set>`
            - :manual:`Downgrade 4.0 Sharded Cluster to 3.6 </release-notes/4.0-downgrade-sharded-cluster>`

            .. note::
               This removes any :ref:`4.0 incompatible features
               <4.0-compatibility-enabled>` and sets the
               ``"featureCompatibilityVersion" : "3.6"``.

         #. :doc:`Import the deployment </tutorial/add-existing-mongodb-processes>` back into |mms|.

      .. tab:: 3.6 to 3.4
         :tabid: three-six-to-three-four

         1. :ref:`Unmanage the deployment <remove-from-automation>`.

         #. Downgrade the deployment item manually.

            - :manual:`Downgrade 3.6 Standalone to 3.4 </release-notes/3.6-downgrade-standalone>`
            - :manual:`Downgrade 3.6 Replica Set to 3.4 </release-notes/3.6-downgrade-replica-set>`
            - :manual:`Downgrade 3.6 Sharded Cluster to 3.4 </release-notes/3.6-downgrade-sharded-cluster>`

            .. note::
               This removes any :ref:`3.6 incompatible features
               <3.6-compatibility-enabled>` and sets the
               ``"featureCompatibilityVersion" : "3.4"``.

         #. :doc:`Import the deployment </tutorial/add-existing-mongodb-processes>` back into |mms|.

Procedure
---------

.. include:: /includes/steps/change-mongodb-version.rst
