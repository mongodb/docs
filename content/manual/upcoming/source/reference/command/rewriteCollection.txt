====================================
rewriteCollection (database command)
====================================
.. meta::
   :description: Change the data distribution of a collection using the `rewriteCollection` command.

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

Definition
----------

.. dbcommand:: rewriteCollection

   .. include:: /includes/command/rewriteCollection.rst

   Use this command to redistribute data when adding or removing
   shards, or to reclaim disk space.

   To stop an in-progress collection rewrite, use the
   :dbcommand:`abortRewriteCollection` command.

   .. versionadded:: 8.3

Compatibility
-------------

This command is available in deployments hosted in the following environments: 

.. include:: /includes/fact-environments-atlas-only.rst

.. include:: /includes/fact-environments-atlas-support-all.rst

.. include:: /includes/fact-environments-onprem-only.rst
 
Syntax
------

The command has the following syntax:

.. code-block:: javascript

   db.adminCommand( {
      rewriteCollection: "<database>.<collection>",
      numInitialChunks: <int>,
      zones: <zones>
   } )

Command Fields
--------------

The command takes the following fields:

.. list-table::
   :header-rows: 1
   :widths: 25 15 60

   * - Field
     - Type
     - Description

   * - ``rewriteCollection``
     - string
     - Required. Name of the database and collection to rewrite.

   * - ``numInitialChunks``
     - integer
     - Optional. Number of initial chunks to use to reshard the collection.
       It defaults to 90.

   * - ``zones``
     - array
     - Optional. Documents that specify the zones for the shard key.

Considerations
--------------

.. |operation| replace:: rewriting
.. |op| replace:: rewrite 
.. include:: /includes/fact-reshard-considerations.rst
.. include:: /includes/resharding-oplog-note.rst

Access Control
--------------

The ``rewriteCollection`` command requires the
:authaction:`rewriteCollection` privilege action on the cluster
or on the database and collection you want to rewrite.

This privilege action is also available to users with the
following roles:

- :authrole:`enableSharding`

- :authrole:`clusterManager`

Examples
--------

To rewrite a collection, run the following command:

.. code-block:: javascript

   db.adminCommand( {
     rewriteCollection: "sales.orders"
   } )

Learn More
----------

- :ref:`reshard-to-same-key`

- :ref:`resharding-a-collection-back-to-same-key`

- :ref:`resharding-for-adding-and-removing-shards-tutorial`

- :dbcommand:`reshardCollection`

- :dbcommand:`moveCollection`

