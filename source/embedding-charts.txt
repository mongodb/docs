.. _embedding-charts:

========================================
Embedding Charts in Your Web Application
========================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

Overview
--------

As a dashboard :ref:`Author <dashboard-permissions>`, you can embed
charts into your own web sites, allowing people who are not Charts
users to see your visualizations. You can either require a verified
signature to accompany each data request, or allow anyone with the
chart's identifying information to embed it in a web page.

If you want strict control over who can embed your charts, use the
:ref:`Verified Signature <require-authentication>` option. If your data
is non-sensitive and you prefer a simpler embedding solution, use the
:ref:`Unauthenticated Access <allow-unauthenticated>` option. 

.. _embedding-procedure:

Procedure
---------

From your dashboard tab, select the dashboard containing the chart you
wish to make embeddable. From the dashboard, click the ellipsis
(:guilabel:`...`) button at the top-right of the chart to access its
embedding information. Select :guilabel:`Embed Chart` from the dropdown
menu.

If you have not already enabled embedding for the data source this
uses, and if you are the data source owner, you have the opportunity to
do so now. Click the :guilabel:`Enable embedding options` link.

.. figure:: /images/charts/embed-chart-options.png
   :figwidth: 507px
   :alt: Embed a chart

Once the data source has embedding enabled, you can choose to allow
unauthenticated access or restrict access to those with a
:ref:`verified signature <require-authentication>`.

.. figure:: /images/charts/embed-chart.png
   :figwidth: 507px
   :alt: Embed a chart

.. _allow-unauthenticated:

Allow Unauthenticated Access
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

To allow anyone with the chart link to embed the chart in a web page,
select the :guilabel:`Unauthenticated` tab and toggle the switch marked
:guilabel:`Enable unauthenticated access` to :guilabel:`On`. The HTML
code necessary to embed the chart appears in the modal window. This
HTML snippet is ready to copy and paste into an external web page.

.. figure:: /images/charts/embed-chart2.png
   :figwidth: 508px
   :alt: Embed unauthenticated chart

.. _require-authentication:

Require Authentication for Access
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

For increased security, you can require a verified signature to
accompany each data request for an embedded chart. Select the
:guilabel:`Verified Signature` tab and toggle the :guilabel:`Enable
signed authentication acces` switch to :guilabel:`On`.

.. figure:: /images/charts/embed-chart3.png
   :figwidth: 508px
   :alt: Embed authenticated chart

In addition to the HTML iframe, the verified signature option requires
some server-side code in order to work. The HTML snippet above shows
what the iframe needs to look like, but it is not usable as-is.
Your web application must use a secret embedding key to sign the URL
and include a timestamp.

.. _verified-signature:

Verified Signature Generation
-----------------------------

To grant data access for embedded charts which require authentication,
you must obtain an embedding key from the
:ref:`Admin Settings <admin-settings>` page.

.. note::

   You must be a :ref:`Project Owner <dashboard-permissions>` to access
   the :guilabel:`Admin Settings` page. For users with the
   :ref:`Project Owner <dashboard-permissions>` role, the
   :guilabel:`Admin Settings` link appears in the top right corner of
   the charts UI. As a non-admin user, you can still use embedded
   charts, but you will need to ask a Project Owner for a key.

Once you have a key, you can create the server-side code required to
generate the verified signature which must accompany a data request
from an embedded chart. Code examples of how to generate a verified
signature are available for the following languages and platforms:

- `Node.js <https://github.com/mongodb/charts-embedding-examples/tree/master/node>`__
- `C# <https://github.com/mongodb/charts-embedding-examples/tree/master/c-sharp>`__
- `Java <https://github.com/mongodb/charts-embedding-examples/tree/master/java>`__
- `Python <https://github.com/mongodb/charts-embedding-examples/tree/master/python>`__
- `MongoDB Stitch <https://github.com/mongodb/charts-embedding-examples/tree/master/stitch>`__

Embedded Charts Error Codes
---------------------------

If an embedded chart fails to render, an error code is displayed:

.. list-table::
   :header-rows: 1
   :widths: 20 80

   * - Error Code
     - Error Cause

   * - ``-1``
     - Unknown error.

   * - ``1``
     - Invalid tenant ID. Check the ``tenant`` field in the iframe
       HTML and make sure it matches what you see in the
       :ref:`Embed Chart <embedding-procedure>` modal window. 

   * - ``2``
     - Item not found. Check the ``id`` field in the iframe
       HTML and make sure it matches what you see in the
       :ref:`Embed Chart <embedding-procedure>` modal window.

   * - ``3``
     - Embedding not enabled. Check the settings in your chart's
       :ref:`Embed Chart <embedding-procedure>` modal window.

   * - ``4``
     - Embedding not allowed. Check the embedding settings in your
       chart's :ref:`data source <data-source-embedding>`.

   * - ``5``
     - Invalid payload. Your application server is not creating a
       usable :ref:`signature <verified-signature>`.
