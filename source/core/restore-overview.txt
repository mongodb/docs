================
Restore Overview
================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

Introduction
------------

When you restore a deployment from a backup, you select a restore point
and |mms| provides you with one or more restore files. If you use |mms|
automation, |mms| can automatically restore the files for you.
Otherwise, you manually restore the files by copying them yourself to
the servers you choose.

You can restore a single MongoDB process or an entire :term:`replica set` 
or :term:`sharded cluster`. You select whether to restore from an
existing snapshot or a restore point between snapshots. For the latter,
|mms| builds a custom snapshot based on the restore point you choose.
Installing from a custom snapshot takes longer as |mms| must build the
snapshot by applying the :manual:`oplog </core/replica-set-oplog/>` to
the previous regular snapshot. For sharded clusters, you must
:ref:`enable checkpoints <enable-cluster-checkpoints>` before you can
restore to a point between snapshots.

.. COMMENT: can you only restore to a point-in-time "in the last 24 hours"?

You can restore to either new hardware or existing hardware. If you use
existing hardware and perform the restore manually, create a new path
for the MongoDB data directory. Do not use existing data directories.

Automated Restore
-----------------

If you choose to have |mms| automatically restore your backup, |mms| removes
all existing data from the target servers and replaces that data with new
backup data from your snapshot. For automated restores, you must have:

- An :term:`Automation Agent` installed on the source and target hosts.

- A :term:`Monitoring Agent` on the target deployment that can connect to the
  target deployment.

.. important::

   Under certain conditions, an automated restore fails because either:

   - The backup and destination databases' storage engines do not match, or
   
   - The destination database uses settings that are different from the
     settings of the backup itself.

   If the backup and destination database storage engines or settings do not
   match, ``mongod`` cannot start once the backup is restored. At this time,
   you can either:

   - Not restore this snapshot, or
    
   - Change the storage engine or settings of the destination sharded cluster
     or replica set to match the configuration of the snapshot.

.. _delivery-methods-file-formats:

Manual Restore
--------------

For a manual restore, |mms| provides each restore file as an archive (``.tar``
or ``.tar.gz``) containing the complete copy of the data directory.

- For a replica set, |mms| provides one archive that you copy to each
  replica set member.

- For a sharded cluster, |mms| provides one archive for the
  :term:`config servers <config server>` and separate archives for each
  :term:`shard`.

With a manual restore, |mms| can provide the files in two ways:

Download via ``HTTP``
   |mms| provides a link to download the restore files.

Transfer via secure copy (``SCP``)
   |mms| transfers the restore archive(s) or the individual data files to a
   target directory on a destination server of your choosing.

   .. include:: /includes/note-scp-key-pair-requirement.rst

   .. include:: /includes/note-windows-scp-issue.rst

If you choose to receive archive files, you must extract the contents 
of each archive, then reconstruct your data. 

This is generally faster than choosing to download the individual data files
but requires sufficient space on the destination server for both the archive
file and the extracted contents.

