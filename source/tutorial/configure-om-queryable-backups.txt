:noprevnext:

.. _configure-om-queryable-backups:

==================================================
Configure Queryable Backups for |onprem| Resources
==================================================

.. include:: /includes/styles/corrections.rst

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

You can configure :opsmgr:`queryable backups </tutorial/query-backup/>`
for |onprem| resources that you deploy in the |k8s-op-short|.

.. note:: In the |onprem| documentation, queryable backups are also
          referred to as queryable snapshots, or queryable restores.

Queryable backups allow you to :opsmgr:`run queries
</tutorial/query-backup/#query-backup-handle-tls-authentication-manually>`
on specific backup snapsnots from your |onprem| resources. Querying
|onprem| backups helps you compare data from different snapshots
and identify the best snapshot to use for :opsmgr:`restoring data
</tutorial/restore-single-database/#restore-from-queryable-backup>`.

In the following procedure you:

- Create the :opsmgr:`queryable.pem
  </reference/configuration/#brs.queryable.pem>` file that holds the
  certificatesfor accessing the backup snapshots that you intend to query.

- Create the Secret containing the :opsmgr:`queryable.pem
  </reference/configuration/#brs.queryable.pem>` file.

- Configure a persistent volume that is attached to the |onprem|
  |k8s| Pod in the |k8s-op-short|.

- Specify the mount point for the Secret in  the persistent volume's
  configuration.

- Save the |onprem| custom resource configuration and apply it.

Once the |k8s-op-short| deploys the updated configuration for the
|onprem| custom resource, |onprem| can read the Secret from the
specified location in the :opsmgr:`queryable.pem
</reference/configuration/#brs.queryable.pem>` parameter in |onprem|.
You can now access the backup snapshots and run queries on them.

Prerequisites
-------------

Before you configure queryable backups, complete the following:

- :doc:`Install the Kubernetes Operator </tutorial/install-k8s-operator>`.

- :ref:`Deploy the Ops Manager application <deploy-om-container>`.

- :doc:`Configure Backup Settings for the Ops Manager Resource </tutorial/deploy-om-container>`.
  In the linked procedures, see the steps for configuring backups.

Procedure
---------

.. include:: /includes/steps/configure-om-queryable-backups.rst

After you configure queryable backups, you can :opsmgr:`query them
</tutorial/query-backup/>` to select the best backup snapshot to use for
:opsmgr:`restoring data
</tutorial/restore-single-database/#restore-from-queryable-backup>`.

