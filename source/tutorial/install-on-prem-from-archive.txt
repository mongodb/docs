==========================================================
Install or Upgrade the On-Prem MMS Service: tar.gz and zip
==========================================================

.. default-domain:: mongodb

Overview
--------

|mms| is a service to monitor and back up a MongoDB infrastructure. This
tutorial describes the basic process to install or upgrade the MMS Application Package.

At a high level, a basic installation will look like the following.
The estimated setup time is less than an hour.

#. Configure an MMS Application Server that meets the :doc:`hardware
   requirements </core/requirements>`.

#. Install a single MongoDB replica set to be used for the MMS
   application database, as described in
   :doc:`/tutorial/prepare-backing-mongodb-instances`.

#. Install an SMTP email server as appropriate for your environment.

#. Install the MMS Application Package.

#. Configure the MMS server's URL, email addresses, and Mongo URI connection strings.
   See :doc:`/reference/configuration` for more information.

#. Start up the MMS application. See
   :doc:`/tutorial/start-and-stop-application` for more information.

#. Optionally install the backup server. See
   :doc:`/tutorial/install-on-prem-backup-server-with-rpm-packages` or.
   :doc:`/tutorial/install-on-prem-backup-server-with-deb-packages`.

Prerequisites
-------------

Configure an MMS Application Server that meets the :doc:`hardware
requirements and software requirements </core/requirements>`.

Ensure that you have deployed the :doc:`backing MongoDB instances
</tutorial/prepare-backing-mongodb-instances>` that MMS uses to store
application data. For additional information on installing MongoDB,
see the :manual:`MongoDB Installation tutorials  </installation>`.

Install and Start MMS Application Database
------------------------------------------

Install the MMS Application Package
-----------------------------------

1. Download the latest On-Prem Monitoring releases from
   `the downloads page <http://www.mongodb.com/commercialsupport/downloads>`_.

#. You can install |monitoring| from the provided ``tar.gz`` or ``zip``
   archive without making any changes to the underlying system
   (i.e. without creating users).  To install, extract the package, as in
   the following command:

   .. code-block:: sh

      tar -zxf mongodb-mms-<version>.x86_64.tar.gz

   When complete, |mms| is installed in the ``/opt/mongodb/mms``
   directory.

   Optionally create a symlink in ``/etc/init.d`` to the included control
   script for convenience, as in the following:

   .. code-block:: sh

      sudo ln -s <install_dir>/bin/mongodb-mms /etc/init.d/

   Note, when the app is first started, it will create and store an encryption
   key in ``$HOME/.mongodb-mms`` for the app user.

#. Configure the MMS application. In the ``conf-mms.properties`` file,
   ensure that the following required settings are correct:

   - :setting:`mms.centralUrl`

   - :setting:`mms.backupCentralUrl`

   - :setting:`mms.fromEmailAddr`

   - :setting:`mms.replyToEmailAddr`

   - :setting:`mms.adminFromEmailAddr`

   - :setting:`mms.adminEmailAddr`

   - :setting:`mms.bounceEmailAddr`

   - :setting:`mongo.mongoUri`

   - :setting:`mongo.replicaSet`

   Also configure authentication, email, and
   optional Kerberos integration, as described in the
   :doc:`/reference/configuration`.

#. Start the MMS application by issuing the following command:

   .. code-block:: sh

      sudo /etc/init.d/mongodb-mms start

Upgrade the MMS Software Package
--------------------------------

If you have an existing On Prem MMS deployment, use the following
procedure to upgrade to the latest release. There are no supported
downgrade paths for On Prem MMS.

Upgrade |mms| from 1.3 and Later
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

To upgrade a tarball installation, backup configuration and/or logs,
and then re-install the On-Prem MMS server.

.. important:: It is crucial that you back up the existing
   configuration because the upgrade process will delete existing
   data.

In more details:

#. Shutdown the MMS server and take a backup of your existing
   configuration and logs.

   .. code-block:: sh

      sudo /etc/init.d/mongodb-mms stop
      sudo cp -a <install_dir>/conf ~/mms_conf.backup
      sudo cp -a <install_dir>/logs ~/mms_logs.backup

#. If you are running MMS Backup, also shutdown the MMS Backup Daemon. Note, this may be
   installed on a different server. If is *critical* that this is also shut down.

   .. code-block:: sh

      sudo /etc/init.d/mongodb-mms-backup-daemon stop

#. Remove your existing MMS server installation entirely and extract
   latest release in its place:

   .. code-block:: sh

      cd <install_dir>/../
      sudo rm -rf <install_dir>
      sudo tar -zxf -C . /path/to/mongodb-mms-<version>.x86_64.tar.gz

#. Compare and reconcile any changes in configuration between versions:

   .. code-block:: sh

      diff -u ~/mms_conf.backup/conf-mms.properties <install_dir>/conf/conf-mms.properties
      diff -u ~/mms_conf.backup/mms.conf <install_dir>/conf/mms.conf

#. Edit your configuration to resolve any conflicts between the old
   and new versions, being sure to take any new changes as
   appropriate.

   .. note::

      Changes to ``mms.centralUri``, email addresses, and MongoDB are
      the most common configuration changes.

#. Restart the On-Prem MMS server.

   .. code-block:: sh

      sudo /etc/init.d/mongodb-mms start

#. Update all Monitoring Agents and Backup Agents. See :ref:`upgrade-mms-agent` for
   more information.

#. If you are running MMS Backup, also update the Backup Daemon Package
   and any Backup Agent. See
   :doc:`/tutorial/install-on-prem-backup-server-with-rpm-packages` or.
   :doc:`/tutorial/install-on-prem-backup-server-with-deb-packages`, and
   see :ref:`tutorial-install-backup-agent`.

Upgrade |mms| from 1.2 and Earlier
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Due to the `company name change
<http://www.mongodb.com/press/10gen-announces-company-name-change-mongodb-inc>`_,
the name of the MMS package changed between versions 1.2 and 1.3.
Therefore, to upgrade the |mms| server from *any* version before 1.3, use
the following procedure:

#. *Recommended.* Take a full backup of the MMS database before
   beginning the upgrade procedure.

#. Shut down MMS, using the following command:

   .. code-block:: sh

      /etc/init.d/10gen-mms stop

#. Download the latest package from
   `the downloads page <http://www.mongodb.com/commercialsupport/downloads>`_
   and proceed with the instructions
   for a fresh install. Do not attempt to use your package manager
   to do an upgrade. See :doc:`/installation` for more
   information.

   When complete, |mms| is installed in the ``/opt/mongodb/mms``
   directory.

#. Follow all procedures for a new install include configuring the
   options in ``/opt/mongodb/mms/conf/conf-mms.properties``. If you
   used encrypted authentication credentials you will need to
   regenerate these manually.  *Do not copy the credentials from
   your old properties file. Old credentials will not work.*

#. Start MMS using the new package name:

   .. code-block:: sh

      sudo /etc/init.d/mongodb-mms start

#. Update any Monitoring Agent. See :ref:`upgrade-mms-agent` for
   more information.

Additional Information
----------------------

.. include:: /includes/additional-information-onprem-install-tutorial.rst
