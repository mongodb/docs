:noprevnext:

.. _explain-lucene-query:

===============================
Lucene Query Structured Summary 
===============================

.. default-domain:: mongodb

.. meta::
   :keywords: atlas search, explain method response, lucene query information, query planner verbosity, boolean query, boolean query options, boolean query example, constant score query, constant score query options, constant score query example, function score query, function score query options, function score query​ example, lat lon point distance query, lat lon point distance query options, lat lon point distance query​ example, lat lon shape query, lat lon shape query options, lat lon shape query example, long distance feature query, long distance feature query options, long distance feature query example, multi term query constant score wrapper, multi term query constant score wrapper options, multi term query constant score wrapper example, phrase query, phrase query options, phrase query example, point range query, point range query options, point range query example, term query, term query options, term query example, default options, default example
   :description: The explain response of an Atlas Search query contains information about the structure of the Lucene queries used to satisfy your Atlas Search query.

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

The :ref:`explain response <explain-response>` of a search command 
contains information about the query executed with that command. The 
response includes structured details of what Lucene queries |fts| 
executed to satisfy a ``$search`` query. 

This page contains: 

- Some of the Lucene queries that |fts| operators create
- Lucene query options that are included in the structured summary 
- Lucene query structured summary example for each Lucene query type

.. note:: About the Examples

   The examples in this section are based on queries run against the 
   :ref:`sample datasets <available-sample-datasets>` with the 
   ``queryPlanner`` :ref:`verbosity mode <explain-verbosity>`. In the 
   example response, the: 
   
   - ``mongotQuery`` field shows the |fts| operator and the query 
     that was run. 
   - ``explain.type`` field shows the Lucene Query that the operator 
     created. 

   For complete examples, see :ref:`explain-egs`.

.. expression:: BooleanQuery

   .. tabs:: 

      .. tab:: Options 
         :tabid: bqopt 

         For Lucene ``BooleanQuery``, the structured summary includes 
         details on the following options: 

         .. list-table::
            :header-rows: 1
            :widths: 10 20 10 50

            * - Field
              - Type
              - Necessity
              - Description

            * - ``must``
              - <:ref:`explain-response`>
              - Optional
              - Clauses which must match.              

            * - ``mustNot``
              - <:ref:`explain-response`>
              - Optional
              - Clauses which must not match.             

            * - ``should``
              - <:ref:`explain-response`>
              - Optional
              - Clauses which should match.
              

            * - ``filter``
              - <:ref:`explain-response`>
              - Optional
              - Clauses which must all match. 

            * - ``minimumShouldMatch``
              - Integer
              - Optional
              - The minimum number of ``should`` clauses which must  
                match.

      .. tab:: Example 
         :tabid: bqeg 

         The following example shows the ``explain`` response for a 
         query run against the ``sample_airbnb.listingsAndReviews`` 
         collection.

         .. literalinclude:: /includes/fts-lucene-booleanquery-eg.json
            :language: json
            :linenos:
            :emphasize-lines: 37-88 

.. expression:: ConstantScoreQuery

   .. tabs:: 

      .. tab:: Options 
         :tabid: csqopt

         For constant score queries, the structured summary includes 
         details on the following options: 

         .. list-table::
            :header-rows: 1
            :widths: 10 20 10 50

            * - Field
              - Type
              - Necessity
              - Description              

            * - ``query``
              - :ref:`explain-response`
              - Required
              - Child of the ``ConstantScoreQuery``. 

      .. tab:: Example 
         :tabid: csqeg

         The following example shows the ``explain`` response for a 
         query run against the ``sample_airbnb.listingsAndReviews`` 
         collection.
     
         .. literalinclude:: /includes/fts-lucene-constantscorequery-eg.json
            :language: json
            :linenos:
            :emphasize-lines: 11-22                     

.. expression:: FunctionScoreQuery

   .. tabs:: 

      .. tab:: Options 
         :tabid: fsqopt 

         For Lucene ``FunctionScoreQuery`` queries, the structured 
         summary includes details on the following options: 

         .. list-table::
            :header-rows: 1
            :widths: 10 20 10 50

            * - Field
              - Type
              - Necessity
              - Description

            * - ``scoreFunction`` 
              - string 
              - Required 
              - Scoring expression used in the query.

            * - ``query``
              - :ref:`explain-response`
              - Required 
              - The query.

      .. tab:: Example 
         :tabid: fsqeg 

         The following example shows the ``explain`` response for a 
         query run against the ``sample_airbnb.listingsAndReviews`` 
         collection.
     
         .. literalinclude:: /includes/fts-lucene-functionscorequery-eg.json
            :language: json
            :linenos:
            :emphasize-lines: 12-59          

.. expression:: LatLonPointDistanceQuery

   .. tabs:: 

      .. tab:: Options 
         :tabid: llpdqopt 

         For Lucene ``LatLonPointDistanceQuery`` queries, the response 
         contains an :ref:`explain-timing-breakdown` only.

      .. tab:: Example 
         :tabid: llpdqeg

         The following example shows the ``explain`` response for a 
         query run against the ``sample_airbnb.listingsAndReviews`` 
         collection.
     
         .. literalinclude:: /includes/fts-lucene-latlonpointdistancequery-eg.json
            :language: json
            :linenos:
            :emphasize-lines: 20-23           

.. expression:: LatLonShapeQuery

   .. tabs:: 

      .. tab:: Options 
         :tabid: llsqopt 

         For Lucene ``LatLonShapeQuery`` queries, the response contains 
         an :ref:`explain-timing-breakdown` only.

      .. tab:: Example 
         :tabid: llsqeg 

         The following example shows the ``explain`` response for a 
         query run against the ``sample_airbnb.listingsAndReviews`` 
         collection.
     
         .. literalinclude:: /includes/fts-lucene-latlonshapequery-eg.json
            :language: json
            :linenos:
            :emphasize-lines: 26-29       

.. expression:: LongDistanceFeatureQuery

   .. tabs:: 

      .. tab:: Options 
         :tabid: ldfqopt

         For Lucene ``LongDistanceFeatureQuery``, the response contains 
         an :ref:`explain-timing-breakdown` only.

      .. tab:: Example 
         :tabid: ldfqeg

         The following example shows the ``explain`` response for a 
         query run against the ``sample_mflix.movies`` collection.
     
         .. literalinclude:: /includes/fts-lucene-longdistancefeaturequery-eg.json
            :language: json
            :linenos:
            :emphasize-lines: 12-15           

.. expression:: MultiTermQueryConstantScoreWrapper

   .. tabs:: 

      .. tab:: Options 
         :tabid: mtqopt 

         For Lucene ``MultiTermQueryConstantScoreWrapper`` queries, the 
         structured summary includes details on the following 
         arguments: 

         .. list-table::
            :header-rows: 1
            :widths: 10 20 10 50

            * - Field
              - Type
              - Necessity
              - Description

            * - ``queries``
              - List<:ref:`explain-response`>
              - Required
              - List of queries.

      .. tab:: Example 
         :tabid: mtqeg

         The following example shows the ``explain`` response for a 
         query run against the ``sample_airbnb.listingsAndReviews`` 
         collection.
     
         .. literalinclude:: /includes/fts-lucene-multitermquery-eg.json
            :language: json
            :linenos:
            :emphasize-lines: 12-24   

.. expression:: PhraseQuery

   .. tabs:: 

      .. tab:: Options 
         :tabid: pqopt 

         For Lucene ``PhraseQuery`` queries, the structured summary 
         includes details on the following arguments: 

         .. list-table::
            :header-rows: 1
            :widths: 10 20 10 50

            * - Field
              - Type
              - Necessity
              - Description

            * - ``path``
              - string
              - Required
              - Indexed field to search.

            * - ``query``
              - string 
              - Required
              - String or strings to search for.

            * - ``slop``
              - int
              - Required
              - Allowable distance between words in the ``query`` 
                phrase.

      .. tab:: Example 
         :tabid: pqeg

         The following example shows the ``explain`` response for a 
         query run against the ``sample_airbnb.listingsAndReviews`` 
         collection.
     
         .. literalinclude:: /includes/fts-lucene-phrasequery-eg.json
            :language: json
            :linenos:
            :emphasize-lines: 12-19

.. expression:: PointRangeQuery

   .. tabs:: 

      .. tab:: Options 
         :tabid: prqopt 

         For Lucene ``PointRangeQuery`` queries, the structured summary 
         includes details on the following arguments: 

         .. list-table::
            :header-rows: 1
            :widths: 10 20 10 50

            * - Field
              - Type
              - Necessity
              - Description

            * - ``path``
              - string
              - Required
              - Indexed field to search.

            * - ``representation``
              - string
              - Optional
              - Numeric representation. Queries over date-typed data do 
                not include representation.

            * - ``gte``
              - number
              - Optional
              - Lower bound of the query.

            * - ``lte``
              - number
              - Optional
              - Upper bound of the query.

      .. tab:: Example 
         :tabid: prqeg 

         The following example shows the ``explain`` response for a 
         query run against the ``sample_airbnb.listingsAndReviews`` 
         collection.
     
         .. literalinclude:: /includes/fts-lucene-pointrangequery-eg.json
            :language: json
            :linenos:
            :emphasize-lines: 11-38    

.. expression:: TermQuery

   .. tabs:: 

      .. tab:: Options 
         :tabid: tqopt 

         For term queries, the structured summary includes details on 
         the following arguments: 

         .. list-table::
            :header-rows: 1
            :widths: 10 20 10 50

            * - Field
              - Type
              - Necessity
              - Description

            * - ``path``
              - string
              - Required
              - Indexed field to search.

            * - ``value``
              - string 
              - Required
              - String to search for. 

      .. tab:: Example 
         :tabid: tqeg
         
         The following example shows the ``explain`` response for a 
         query run against the ``sample_airbnb.listingsAndReviews`` 
         collection.
     
         .. literalinclude:: /includes/fts-lucene-termquery-eg.json
            :language: json
            :linenos:
            :emphasize-lines: 11-17

.. expression:: Default

   .. tabs:: 

      .. tab:: Options 
         :tabid: opt 

         Lucene queries that are not explicitly defined by another 
         Lucene query are serialized using the default query. The 
         structured summary includes details on the following option: 

         .. list-table::
            :header-rows: 1
            :widths: 10 20 10 50

            * - Field
              - Type
              - Necessity
              - Description
              
            * - ``queryType`` 
              - string 
              - Required.
              - Type of Lucene query.
              
      .. tab:: Example 
         :tabid: eg 

         The following example shows the ``explain`` response for a 
         query run against the ``sample_airbnb.listingsAndReviews`` 
         collection.
     
         .. literalinclude:: /includes/fts-lucene-defaultquery-eg.json
            :language: json
            :linenos:
            :emphasize-lines: 18-23              
