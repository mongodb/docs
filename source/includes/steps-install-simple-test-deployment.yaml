title: "Provision an |onprem| host."
stepnum: 1
ref: set-up-host
content: |

  Provision a host for |onprem| that meets the following requirements:

  .. list-table::
     :widths: 30 70
     :stub-columns: 1

     * - System Memory
       - 15 GB
     * - Disk Capacity
       - 50 GB in ``/``
     * - Host OS Permissions
       - ``root``
     * - Host OS
       - Red Hat Enterprise Linux 7.0

  .. admonition:: Using |aws|
     :class: note

     An |aws| EC2 ``m3.xlarge`` instance meets the memory requirements.
     Change the size of the instance's root partition to 50 GB. Log
     into the instance and execute ``df -h`` to verify the root
     partition has 50 GB of space.

---
title: "Configure ``yum`` to install MongoDB."
ref: config-yum
content: |

  Issue the following command to set up a ``yum`` package management
  system repository definition:

  .. code-block:: sh

     echo "[mongodb-org-4.0]
     name=MongoDB Repository
     baseurl=https://repo.mongodb.org/yum/redhat/7/mongodb-org/4.0/x86_64/
     gpgcheck=1
     enabled=1
     gpgkey=https://www.mongodb.org/static/pgp/server-4.0.asc" | sudo tee /etc/yum.repos.d/mongodb.repo
---
title: "Install MongoDB."
ref: install-mongodb
content: |
  Issue the following command to install the latest stable release of
  MongoDB:

  .. code-block:: sh

     sudo yum install -y mongodb-org mongodb-org-shell
---
title: "Create the |onprem| Application Database directory."
ref: create-data-dir
content: |
  Issue the following two commands to create the data directory and
  change its ownership:

  .. code-block:: sh

     sudo mkdir -p /data/appdb
     sudo chown -R mongod:mongod /data
---
title: "*(Optional)* Create the |onprem| backup data directory."
ref: create-backup-dir
content: |
  To configure the Backup feature as well, issue the following
  additional commands for the backup database:

  .. code-block:: sh

     sudo mkdir -p /data/backup
     sudo chown mongod:mongod /data/backup
---
title: "Start the |onprem| Application Database mongod instance."
ref: start-mongod-instance
content: |

  Start MongoDB as the ``mongod`` user, specifying:

  .. list-table::
     :widths: 50 30 20
     :header-rows: 1

     * - Setting
       - Command Option
       - Value
     * - Port
       - ``--port``
       - ``27017``
     * - Absolute path for MongoDB data files
       - ``--dbpath``
       - ``/data/appdb``
     * - Absolute file path for MongoDB logs
       - ``--logpath``
       - ``/data/appdb/mongodb.log``
     * - Amount of cache the WiredTiger :term:`storage engine` uses
         for the :term:`application database`.
       - ``--wiredTigerCacheSizeGB``
       - ``1``
     * - Flag to run the ``mongod`` in the background and maintain
         control of the terminal
       - ``--fork``
       -

  The resulting command would resemble this:

  .. code-block:: sh

    sudo -u mongod mongod --port 27017 --dbpath /data/appdb \
      --logpath /data/appdb/mongodb.log \
      --wiredTigerCacheSizeGB 1 --fork
---
title: "*(Optional)* Start the |onprem| Backup Database mongod instance."
ref: start-mongod-backup-instance
content: |

  Start MongoDB as the ``mongod`` user, specifying:

  .. list-table::
     :widths: 50 30 20
     :header-rows: 1

     * - Setting
       - Command Option
       - Value
     * - Port
       - ``--port``
       - ``27018``
     * - Absolute path for MongoDB data files
       - ``--dbpath``
       - ``/data/backup``
     * - Absolute file path for MongoDB logs
       - ``--logpath``
       - ``/data/backup/mongodb.log``
     * - Amount of cache the WiredTiger :term:`storage engine` uses
         for the :term:`application database`.
       - ``--wiredTigerCacheSizeGB``
       - ``1``
     * - Flag to run the ``mongod`` in the background and maintain
         control of the terminal
       - ``--fork``
       -

  The resulting command would resemble this:

  .. code-block:: sh

    sudo -u mongod mongod --port 27018 --dbpath /data/backup \
      --logpath /data/backup/mongodb.log \
      --wiredTigerCacheSizeGB 1 --fork
---
title: "Download the |onprem| package."
ref: application-package-download
content: |
  a. Open your preferred browser to visit the
     :guilabel:`MongoDB Download Center`.

  #. Click the :guilabel:`Tools` tab and then click
     :dl:`Ops Manager <ops-manager>`.

  #. From the :guilabel:`Platforms` drop-down menu, click
     :guilabel:`Red Hat + CentOS 6, 7 / SUSE 12 / Amazon Linux`.

  #. From the :guilabel:`Packages` drop-down menu, click
     :guilabel:`RPM`.

  #. Click :guilabel:`Download`.

  .. note::

     The downloaded package is named
     ``mongodb-mms-<version>.x86_64.rpm``, where ``<version>`` is the
     version number.

---
title: "Install |onprem|."
ref: install
content: |
  Install the ``.rpm`` package by issuing the following command, where
  ``<version>`` is the version of the |onprem| ``.rpm`` package:

  .. code-block:: sh

     sudo rpm -ivh mongodb-mms-<version>.x86_64.rpm

  The install creates the following:

  - The base directory for the |onprem| software, which is:

    ``/opt/mongodb/mms/``

  - A new system user, ``mongodb-mms``, under which the host runs.

  - The ``/opt/mongodb/mms/conf/conf-mms.properties`` file, which
    contains the connection string to access the Application Database.
    The default is ``locahost``, port ``27017``, so no changes are
    necessary.

---
title: "Start |onprem|."
stepnum: 10
ref: start-the-application
content: |
  Issue the following command:

  .. code-block:: sh

     sudo service mongodb-mms start
---
title: "Get your instance hostname."
stepnum: 11
ref: public-host-name
content: |
  If you are using an EC2 instance, the hostname is the ``Public DNS``
  listed on the EC2 instance's ``Description`` tab.

  If you do not have a hostname, you can instead use the public IP
  address. To get the public IP address, paste this |url| into your
  preferred browser:

  .. code-block:: sh

     https://www.google.com/search?q=myip
---
title: "Open the |onprem| home page and register the first user."
stepnum: 12
ref: home-page
content: |

  a. In a browser, enter the following |url| using the hostname.
     If do not have a hostname, use the public IP address instead:

     .. code-block:: sh

        http://<opsManagerHost>:8080

  b. Click the :guilabel:`Register` link and follow the prompts to
     register the first user and create the first project. The first
     user is automatically assigned the :ref:`Global Owner
     <global-owner-role>` role.

---
title: "Configure |onprem|."
stepnum: 13
ref: configure-app
content: |

  |onprem| walks you through several configuration pages.
  Required settings are marked with an asterisk. Enter information as
  appropriate. When configuration is complete, |onprem| opens the
  :guilabel:`Deployment` page.

---
title: "*(Optional)* Configure the backup capabilities."
stepnum: 14
ref: configure-backup-feature
content: |
  a. Create a directory to store the :term:`head databases <head
     database>`.

     .. important::
        Do not use this directory for any other purpose:

        .. code-block:: sh

           mkdir /data/backupDaemon

  b. Make the directory writable by the ``mongodb-mms`` user:

     .. code-block:: sh

        sudo chown mongodb-mms:mongodb-mms /data/backupDaemon

  c. In |onprem|, while logged in as the user you registered during
     installation, click the :guilabel:`Admin` link at the top right of
     the page.

  d. Click the :guilabel:`Backup` tab.

  e. Follow the prompts to configure the Backup storage.
     |onprem| walks you through the configuration.

     For :term:`snapshot storage <snapshot>`, select either the local
     filesystem or the backup database. If you use a :term:`File System
     Store`, you still need a small MongoDB database for :term:`oplog
     storage <Oplog Store Database>`. At the prompt to configure the
     connection string to the backup database, enter your local hostname
     and port:

     .. code-block:: sh

        localhost:27018

     |onprem| automatically prefixes connection strings with
     ``mongodb://``. Your connection string should match the following:

     .. code-block:: sh
        :copyable: false

        mongodb://localhost:27018

---
title: "Set up your first deployment."
stepnum: 15
ref: deploy
content: |

  a. Click :guilabel:`MongoDB Ops Manager` in the upper left corner of
     the page to return to the :guilabel:`Deployment` page.

  b. Click :guilabel:`Add New` to deploy a MongoDB instance.

...
