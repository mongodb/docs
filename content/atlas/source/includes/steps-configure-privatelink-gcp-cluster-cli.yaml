stepnum: 1
level: 4
ref: create-private-endpoint-cli
title: "Create the private endpoint in |service|."
content: |

  a. Run the {+atlas-cli+} command to create a port mapped private 
     endpoint in |service|. Ensure that the value of ``--region`` 
     matches the region where you deployed your {+cluster+}:

     .. code-block:: sh

        ./atlas privateEndpoints gcp create --region CENTRAL_US --portMappingEnabled

     .. note:: 

         If you don't explicitly set the ``--portMappingEnabled`` flag, 
         the private endpoint will be created without port mapping.

     .. include:: /includes/fact-multi-region-multi-cloud-endpoint.rst

  b. Note the private endpoint's ID in the response. In this example,
     the ID is ``6344ac8f51b94c6356527881``. 

     .. code-block:: json 
        :copyable: false

        Private endpoint '6344ac8f51b94c6356527881' created.

---
stepnum: 2
level: 4
ref: get-private-endpoint-service-name-cli
title: "Wait for the private endpoint to become available."
content: |

  :gold:`IMPORTANT:` It might take |service| some time to provision the private
  endpoint. Wait 1-2 minutes before you complete this step.

  Run the {+atlas-cli+} command to describe the private endpoint using its ID:

  .. include:: /includes/extracts/atlas-privateEndpoints-gcp-describe-2.rst

  The following shows a sample output:

  .. code-block:: json
     :copyable: false

     ID                         GROUP NAME   REGION       STATUS      PORT MAPPING ENABLED   ERROR
     69948cba1faa593416bbbd7d   N/A          CENTRAL_US   AVAILABLE   true                   <nil>

  If the ``STATUS`` value is ``INITIATING``, wait 1-2 more
  minutes for |service| to provision the private endpoint. Then, try this step again.

---
stepnum: 3
level: 4
ref: create-endpoint-gcp-cli
title: "Create the endpoint in GCP."
content: |

  Run the following commands to allocate an IP address and create the 
  private endpoint, replacing the following placeholders with your 
  values:

  .. list-table::
     :widths: 20 80
     :header-rows: 1

     * - Placeholder
       - Description

     * - {GCP-PROJECT-ID}
       - Unique string that identifies your |gcp| project in 
         |gcp|.

     * - {ATLAS-GCP-PROJECT-ID}
       - Unique string that identifies the |gcp| project in 
         which |service| deploys your resources.

     * - {ENDPOINT}
       - Unique string that identifies your private endpoint.

     * - {REGION}
       - |gcp| region in which your {+cluster+} resides.

     * - {SUBNET}
       - When you create Private Service Connect endpoints, you
         specify a subnet in your VPC network; you may either create a
         new subnet to encapsulate your endpoints or use an existing
         one.

     * - {VPC-NAME}
       - Name of the VNet that you want to use to connect to Atlas.
         You can find this value on the VPC Network page on your |gcp|
         dashboard.

     * - {GROUP-ID}
       - Unique 24-character hexadecimal string that identifies your
         project in |service|.

  .. code-block:: sh
     
     gcloud config set project {GCP-PROJECT-ID}
     gcloud compute addresses create {ENDPOINT}-ip --region={REGION} --subnet={SUBNET}
     gcloud compute forwarding-rules create {ENDPOINT} --region={REGION} --network={VPC-NAME} --address={ENDPOINT}-ip --target-service-attachment=projects/{ATLAS-GCP-PROJECT-ID}/regions/{REGION}/serviceAttachments/sa-{REGION}-{GROUP-ID}

---
stepnum: 4
level: 4
ref: update-private-endpoint-gcp-cli
title: "Specify the VPC Endpoint ID for your private endpoint."
content: |

  a. Run the {+atlas-cli+} command to 
     create an interface endpoint in |service| using the |service|
     endpoint ID and the VPC Endpoint ID. In this example, you
     would set the following parameters:
     
     .. list-table::
        :widths: 33 33 33
        :header-rows: 1

        * - Parameter
          - Type
          - Example Value
     
        * - ``endpointGroupId``
          - Argument
          - ``tester-1``
     
        * - ``endpointServiceId``
          - Option
          - ``6344ac8f51b94c6356527881``

        * - ``gcpProjectId``
          - Option
          - ``atlascli-private-endpoints``
        
        * - ``endpoint``
          - Option
          - ``tester-1@10.142.0.1``

            If |gcp| PSC port mapping is enabled for the backing private 
            endpoint service, then this parameter should only be of size 1.

     .. include:: /includes/extracts/atlas-privateEndpoints-gcp-interfaces-create-2.rst

---
stepnum: 5
level: 4
ref: get-private-endpoint-status-cli
title: "Verify the private endpoint's availability."
content: |

  You can connect to the {+database-deployment+} using the 
  {+gcp-psc+} private endpoint after |service| finishes configuring all
  of the resources and the private endpoint becomes available.

  To verify that the |gcp| private endpoint is available: 
   
  a. Run the {+atlas-cli+} command to 
     describe the interface endpoint using its ID. In this example, you
     would use the following parameters from the previous step:
     
     .. list-table::
        :header-rows: 1

        * - Parameter
          - Type
          - Example Value
     
        * - ``id``
          - Argument
          - ``tester-1``

        * - ``endpointServiceId``
          - Option
          - ``6344ac8f51b94c6356527881``

     .. include:: /includes/extracts/atlas-privateEndpoints-gcp-interfaces-describe-2.rst

  b. Verify that the ``STATUS`` field's value is ``AVAILABLE`` as shown
     in the following example:

     .. code-block:: json
        :copyable: false

        ENDPOINT              STATUS            DELETE REQUESTED
        tester-1              AVAILABLE         false

     If the ``STATUS`` value is ``VERIFIED``, wait 1-2 more minutes for
     |service| to make your private endpoint available.

...
