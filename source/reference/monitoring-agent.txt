:orphan:

==============================
Monitoring Agent Configuration
==============================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. include:: /includes/legacy-agents/fact-monitoring-agent-deprecated.rst

This page describes possible settings for Monitoring Agent. These
values are set after first launching |mms| and not through manual
editing of these files.

.. cond:: onprem

   See :doc:`/reference/configuration/` for the
   |mms| settings and their values.

.. warning::

   Do **not** edit these settings for a Monitoring Agent that is
   managed by an Automation Agent. If you do, the Automation Agent can
   overwrite any changes you make. If you are not using the Automation Agent, you must edit these settings manually.

Configuration File Location on Each Platform
--------------------------------------------

The location of the Monitoring Agent configuration file
depends on your platform:

.. include:: /includes/list-table-monitoring-agent-conf-file-locations.rst

Settings
--------

|mms| provides default values for many of the Monitoring Agent
Configuration settings.

.. important::
   You must set the :msetting:`mmsApiKey` value.

.. _monitoring-agent-connection-settings:

Connection Settings
~~~~~~~~~~~~~~~~~~~

For the Monitoring Agent to communicate with the |mms| servers, these
connection settings are **required**:

.. msetting:: mmsGroupId

   *Type*: string

   Specifies the ID of your |mms| project. The project ID is displayed
   in the :guilabel:`Project Settings` page (:guilabel:`Settings` > :guilabel:`Project Settings`).

   .. cond:: cloud

      *Required*.

   .. cond:: onprem

      This setting is usually set when the Automation Agent is
      installed and is required to bind the server to a project.

   .. code-block:: ini

      mmsGroupId=8zvbo2s2asigxvmpnkq5yexf

   .. cond:: onprem

      .. include:: /includes/extracts/server-pool-agent-group-settings.rst

.. msetting:: mmsApiKey

   *Type*: string

   Specifies the |mms| agent API key of your |mms| project.

   .. include:: /includes/extracts/agent-api-key-specify.rst

   This setting is usually set when the Monitoring Agent is installed
   and *it is required*.

   .. code-block:: ini

      mmsApiKey=rgdte4w7wwbnds9nceuodx9mcte2zqem

.. msetting:: mmsBaseUrl

   *Type*: string

   Specifies the URL of the |application|.

   .. code-block:: ini

      mmsBaseUrl=http://example.com:8080

.. _monitoring-agent-logging-settings:

Logging Settings
~~~~~~~~~~~~~~~~

.. msetting:: logFile

   *Type*: string

   Specifies the absolute path to the log file. If this is not
   specified, the log writes to standard error (``stderr``) on UNIX-
   and Linux-based systems and to the Event Log on Windows systems.

.. msetting:: maxLogFileSizeBytes

   *Type*: integer

   Specifies the maximum size, in bytes, of a log file before the logs
   are rotated. If unspecified, the Monitoring Agent does not rotate
   logs based on file size. This is optional.

   .. code-block:: ini

      maxLogFileSizeBytes=536870912

.. msetting:: maxLogFileDurationHrs

   *Type*: float

   Specifies the number of hours after which the log file is rotated.
   This is optional and cond supported on UNIX- and Linux-based
   systems.

   .. note::
      You can manually rotate the Monitoring Agent logs. Issue a user
      signal 1 kill command for the Monitoring Agent process:

      .. code-block:: sh

         kill -SIGUSR1 <monitoringAgentID>

      This rotates the Monitoring Agent log file.


HTTP Proxy Settings
~~~~~~~~~~~~~~~~~~~

.. msetting:: httpProxy

   *Type*: string

   Specifies the URL of an HTTP proxy server the Monitoring Agent can
   use.

   .. code-block:: ini

      httpProxy=http://proxy.example.com:8080

.. _mongodb-kerberos-settings:

MongoDB Kerberos Settings
~~~~~~~~~~~~~~~~~~~~~~~~~

Specify these settings if the Monitoring Agent authenticates to hosts
using Kerberos. To configure Kerberos, see
:doc:`/tutorial/configure-monitoring-agent-for-kerberos`.

.. msetting:: krb5Principal

   *Type*: string

   Specifies the Kerberos principal the Monitoring Agent uses.

   .. code-block:: ini

      krb5Principal=mmsagent/myhost@EXAMPLE.COM

.. msetting:: krb5Keytab

   *Type*: string

   Specifies the *absolute* path to Kerberos principal's ``keytab``
   file.

   .. code-block:: ini

      krb5Keytab=/path/to/mms-monitoring-agent.keytab

.. msetting:: krb5ConfigLocation

   *Type*: string

   Specifies the *absolute* path to an non-system-standard location for
   the Kerberos configuration file.

   .. code-block:: ini

      krb5ConfigLocation=/path/to/krb_custom.conf

.. msetting:: gssapiServiceName

   *Type*: string

   Specifies the service name with the :msetting:`gssapiServiceName`
   option.

   *By default, MongoDB uses* ``mongodb`` *as its service name.*

.. include:: /includes/fact-set-krb5ccname.rst

.. _monitoring-agent-ssl-settings:

MongoDB TLS Settings
~~~~~~~~~~~~~~~~~~~~

Specify these settings when the Monitoring Agent connects to MongoDB
deployments using |tls|. See
:doc:`/tutorial/configure-monitoring-agent-for-ssl` for more
information.

.. msetting:: useSslForAllConnections

   *Type*: boolean

   Specifies whether or not to encrypt **all** connections to MongoDB
   deployments using |tls|.

   .. caution::

      Setting this to ``true`` overrides any
      per-host |tls| settings configured in the |mms| interface.

.. msetting:: sslClientCertificate

   *Type*: string

   Specifies the *absolute* path to the private key, client
   certificate, and optional intermediate certificates in ``PEM``
   format. The Monitoring Agent uses the client certificate to connect
   to any configured MongoDB deployment that uses |tls| and requires a
   client certificate (run with the :option:`--tlsCAFile
   <mongod.--tlsCAFile>` option).

   .. example::

      If you want to connect to a MongoDB deployment that uses both
      |tls| and certificate validation using the |mongo| 
      shell:

      .. code-block:: sh

         mongo --tls --tlsCertificateKeyFile /path/to/client.pem --tlsCAFile /path/to/ca.pem example.net:27017

      You must set these options in your Monitoring Agent configuration file:

      .. code-block:: ini

         sslTrustedServerCertificates=/path/to/ca.pem
         sslClientCertificate=/path/to/client.pem

.. msetting:: sslClientCertificatePassword

   *Type*: string

   Specifies the password needed to decrypt the private key in
   the ``sslClientCertificate`` file. This setting is
   required when the client certificate ``PEM`` file is
   encrypted.

   .. code-block:: ini

      sslClientCertificatePassword=password

.. msetting:: sslTrustedServerCertificates

   *Type*: string

   Specifies the *absolute* path that contains the trusted CA
   certificates in ``PEM`` format. These certificates verify the server
   certificate returned from any MongoDB deployments running with |tls|.

   .. code-block:: ini

      sslTrustedServerCertificates=/path/to/ca.pem

.. msetting:: sslRequireValidServerCertificates

   *Type*: boolean

   Specifies whether the Monitoring Agent should validate the |tls|
   certificates presented by the MongoDB databases.

   .. code-block:: ini

      sslRequireValidServerCertificates=true

   .. include:: /includes/extracts/fact-bypass-ssl-certificate.rst

.. _server-monitoring-ssl:

|mms| Server TLS Settings
~~~~~~~~~~~~~~~~~~~~~~~~~

Specify the settings the Monitoring Agent uses when communicating with
|mms| using |tls|.

.. msetting:: httpsCAFile

   *Type*: string

   Specifies the *absolute* path that contains the trusted CA
   certificates in ``PEM`` format. The Monitoring Agent uses this
   certificate to verify that the agent is communicating with the
   designated |mms| instance.

   *By default, the Monitoring Agent uses the trusted root CAs
   installed on the system.*

   If the agent cannot find the trusted root CAs, configure
   these settings manually.

   .. cond:: onprem

      If the |mms| instance uses a self-signed |tls| certificate, you
      *must* specify a :msetting:`httpsCAFile`
      value.

   .. code-block:: ini

      httpsCAFile=/path/to/mms-certs.pem

.. additional settings are in the following extracts file:

.. include:: /includes/extracts/monitoring-agent-configuration-ssl.rst

Deprecated Settings
~~~~~~~~~~~~~~~~~~~

MongoDB Authentication Settings
+++++++++++++++++++++++++++++++

If all monitored MongoDB deployments use the same ``MONGODB-CR``
credentials, you may use these settings. Setting the username and
password in the configuration file overrides any configuration in the
|application|.

See :doc:`/reference/required-access-monitoring-agent` for information
on the privileges needed for this user.

.. msetting:: globalAuthUsername

   *Type*: string

   Specifies the MongoDB username that the Monitoring Agent uses to connect.

   .. warning::

      This value overrides all other usernames configured for the
      Monitoring Agent.

   .. code-block:: ini

      globalAuthUsername=mms-monitoring-agent

.. msetting:: globalAuthPassword

   *Type*: string

   Specifies the password for the ``globalAuthUsername`` user.

   .. warning::

      This value overrides all other passwords configured for the
      Monitoring Agent.

   .. code-block:: ini

      globalAuthPassword=password
