===========================
Get All |fts| Index Metrics
===========================

.. default-domain:: mongodb

.. meta::
   :canonical: https://www.mongodb.com/docs/atlas/reference/api-resources-spec/#tag/Monitoring-and-Logs

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

The ``fts`` resource allows you to return all the |fts| index metrics 
for a :manual:`namespace </reference/limits/#namespaces>` on the 
specified process.

.. include:: /includes/api-requirements.rst

.. include:: /includes/fact-projects-groups-synonyms.rst

Required Roles 
--------------

You must have the :authrole:`Project Read Only` or higher role to view 
the |fts| metric types using the |service| :doc:`UI 
</review-atlas-search-metrics>` or API.

Resource 
--------

.. include:: /includes/api/base-api-uri.rst

.. code-block:: http

   GET /groups/{GROUP-ID}/hosts/{PROCESS-ID}/fts/metrics/indexes/{DATABASE-NAME}/{COLLECTION-NAME}/measurements

Request Parameters
------------------

Request Path Parameters
~~~~~~~~~~~~~~~~~~~~~~~

.. list-table::
   :header-rows: 1
   :stub-columns: 1
   :widths: 15 10 10 65

   * - Path Element
     - Type
     - Necessity
     - Description

   * - ``GROUP-ID``
     - string
     - Required
     - Unique 24-hexadecimal digit string that identifies the 
       :ref:`project <projects>`.

   * - ``PROCESS-ID``
     - string
     - Required
     - Unique hexadecimal digit string, or a string in the form of 
       ``<hostname>:port``, that identifies the process.
  
       .. note::

          You can find the ``PROCESS-ID`` in the URL of the process in
          |service| after ``/host/``.

   * - ``DATABASE-NAME``
     - string
     - Required
     - Human-readable label that identifies the database.

   * - ``COLLECTION-NAME``
     - string
     - Required
     - Human-readable label that identifies the collection.

Request Query Parameters
~~~~~~~~~~~~~~~~~~~~~~~~

.. list-table::
   :widths: 20 11 14 45 10
   :header-rows: 1
   :stub-columns: 1

   * - Name
     - Type
     - Necessity
     - Description
     - Default

   * - ``end``
     - string
     - Conditional
     - Required if you don't specify ``period``.
       |iso8601-time| that indicates the end date up to which 
       |service| reports the metrics. If you specify **end** you must 
       also specify **start**. Mutually exclusive with **period**.
     - 
   
   * - ``envelope``
     - boolean
     - Optional
     - Flag that indicates whether |service| should wrap the response 
       in a |json| envelope.

       If |api| clients can't access the |http| response headers 
       or status code, set ``envelope=true`` in the query.

       For endpoints that return one result, the response body
       includes:

       .. list-table::
          :widths: 30 70
          :stub-columns: 1

          * - status
            - |http| response code
          * - envelope
            - Expected response body

       For endpoints that return a list of results, the **results**
       object is an envelope. |service| adds the **status** field to
       the response body.

     - ``false``
  
   * - ``granularity``
     - string
     - Required
     - |iso8601-duration| that specifies the interval at which 
       |service| reports the metrics.  |service| supports the following 
       subset of |iso8601|\-formatted time periods:

       - **PT10S**
         
         .. include:: /includes/fact-10-second-granularity.rst

       - **PT1M**
       - **PT5M**
       - **PT1H**
       - **P1D**
        
       When you specify **granularity**, you must specify either
       **period** *or* **start** and **end**.
     -

   * - ``metrics``
     - string
     - Optional
     - List that contains the metrics that you want |service| to report 
       for the associated data series. If you don't specify individual 
       **metrics**, the endpoint returns all metrics for the associated 
       data series.
     - ``<all-metrics>``

   * - ``period``
     - string
     - Conditional
     - Required if you don't specify ``start`` and ``end``.
       |iso8601-duration| that specifies the length of time over  
       which Atlas reports the metrics. Mutually exclusive with 
       ``start`` and ``end``.

       .. example::

          To request the last 36 hours, specify: ``period=P1DT12H``.
     - 

   * - ``start``
     - string
     - Conditional
     - Required if you don't specify ``period``.
       |iso8601-time| that indicates the start date from which 
       |service| reports the metrics. If you specify **start** you must 
       also specify **end**. Mutually exclusive with **period**.
     - 

Request Body Parameters
~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/api/no-body-parameters.rst

Response Elements
-----------------

The |http| response returns a |json| document that includes an a
array of |fts| metric types. Each |fts| metric type contains the 
following elements:

.. list-table::
   :header-rows: 1
   :stub-columns: 1
   :widths: 15 10 75

   * - Name
     - Type
     - Description

   * - ``collectionName``
     - string
     - Human-readable label that identifies the collection.

   * - ``databaseName``
     - string
     - Human-readable label that identifies the database.

   * - ``granularity``
     - string
     - |iso8601-duration| that specifies the interval at which 
       |service| reports the metrics.
      
   * - ``groupId``
     - string
     - Unique 24-hexadecimal digit string that identifies the 
       project.

   * - ``start``
     - string
     - |iso8601-time| that indicates the start date from which 
       |service| reports the metrics.

   * - ``end``
     - string
     - |iso8601-time| that indicates the end date up to which 
       |service| reports the metrics.

   * - ``indexIds``
     - array
     - List that contains the unique 24-hexadecimal digit strings that 
       identifies the indexes.

   * - ``indexStatsMeasurements``
     - array
     - List that contains all available |fts| index :ref:`metrics 
       <fts-index-measurements>`.

   * - ``indexStatsMeasurements.dataPoints``
     - string
     - List that contains |fts| index metric data.

   * - ``indexStatsMeasurements.dataPoints.timestamp``
     - string
     - |iso8601-time| that indicates when |service| captured the 
       |fts| index metric data point.

   * - ``indexStatsMeasurements.dataPoints.value``
     - number
     - Number that indicates the |fts| index metric data point 
       value.
  
   * - ``indexStatsMeasurements.name``
     - string
     - Human-readable label that identifies the |fts| index 
       metric.

   * - ``indexStatsMeasurements.units``
     - string
     - Unit of measurement that applies to the |fts| index 
       metric.
  
   * - ``links``
     - array
     - .. include:: /includes/api/links-explanation.rst
  
   * - ``processId``
     - string
     - String in the form of ``<hostname>:port`` that identifies the 
       process.

.. _fts-index-measurements:

Measurement Values
~~~~~~~~~~~~~~~~~~

.. list-table::
   :header-rows: 1
   :stub-columns: 1
   :widths: 45 55

   * - Measurement
     - Description

   * - ``REPLICATION_LAG``
     - Approximate number of seconds |fts| is behind in replicating 
       changes from the :term:`oplog` of |mongod|.

   * - ``NUMBER_OF_SUCCESS_QUERIES``
     - Total number of queries that successfully returned a response.

   * - ``NUMBER_OF_ERROR_QUERIES``
     - Total number of queries that were unable to return a response.

   * - ``TOTAL_NUMBER_OF_QUERIES``
     -  Total number of queries submitted to |fts|.

   * - ``NUMBER_OF_GETMORE_COMMANDS``
     - Total number of ``getmore`` commands run on all |fts| queries.

   * - ``NUMBER_OF_INSERTS``
     - Total number of documents or fields defined in the index 
       definition indexed into |fts|.

   * - ``NUMBER_OF_UPDATES``
     - Total number of documents or fields defined in the index 
       definition updated in |fts|.

   * - ``NUMBER_OF_DELETES``
     - Total number of documents or fields defined in the index 
       definition removed from |fts|.

   * - ``INDEX_SIZE_ON_DISK``
     - Total size of the index.

   * - ``NUMBER_OF_INDEX_FIELDS``
     - Total number of unque fields present in the |fts| index.

Example Request
---------------

.. code-block:: sh

   curl --user "{PUBLIC-KEY}:{PRIVATE-KEY}" --digest \
        --include \
        --request GET "https://cloud.mongodb.com/api/atlas/v1.0/groups/{GROUP-ID}/hosts/{PROCESS-ID}/fts/metrics/indexes/{DATABASE-NAME}/{COLLECTION-NAME}/measurements?granularity=PT1M&period=PT1M"

Example Response
----------------

Response Header
~~~~~~~~~~~~~~~

.. include:: /includes/api/api-headers/200.rst

Response Body
~~~~~~~~~~~~~

The following example response contains an array of |fts| metric types.

.. code-block:: json
   :copyable: false

   {
    "collectionName": "movies",
    "databaseName": "sample_mflix",
    "granularity": "PT1M",
    "groupId": "5f86fb2ff9c4e56d39502559",
    "indexIds": [],
    "indexStatsMeasurements": [
        {
            "dataPoints": [],
            "name": "REPLICATION_LAG",
            "units": "SECONDS"
        },
        {
            "dataPoints": [],
            "name": "NUMBER_OF_SUCCESS_QUERIES",
            "units": "SCALAR_PER_SECOND"
        },
        {
            "dataPoints": [],
            "name": "NUMBER_OF_ERROR_QUERIES",
            "units": "SCALAR_PER_SECOND"
        },
        {
            "dataPoints": [],
            "name": "TOTAL_NUMBER_OF_QUERIES",
            "units": "SCALAR_PER_SECOND"
        },
        {
            "dataPoints": [],
            "name": "NUMBER_OF_GETMORE_COMMANDS",
            "units": "SCALAR_PER_SECOND"
        },
        {
            "dataPoints": [],
            "name": "NUMBER_OF_INSERTS",
            "units": "SCALAR_PER_SECOND"
        },
        {
            "dataPoints": [],
            "name": "NUMBER_OF_UPDATES",
            "units": "SCALAR_PER_SECOND"
        },
        {
            "dataPoints": [],
            "name": "NUMBER_OF_DELETES",
            "units": "SCALAR_PER_SECOND"
        },
        {
            "dataPoints": [],
            "name": "INDEX_SIZE_ON_DISK",
            "units": "MEGABYTES"
        },
        {
            "dataPoints": [],
            "name": "NUMBER_OF_INDEX_FIELDS",
            "units": "SCALAR"
        }
    ],
    "links": [
        {
            "href": "https://cloud.mongodb.com/api/atlas/v1.0/groups/5f86fb2ff9c4e56d39502559/hosts/4d5ef1b285f7c73f4e9e24f0abd400b2/fts/metrics/indexes/sample_mflix/movies/measurements?granularity=PT1M&period=PT1M",
            "rel": "self"
        },
        {
            "href": "https://cloud.mongodb.com/api/atlas/v1.0/groups/5f86fb2ff9c4e56d39502559/processes/cluster0-shard-00-00.5f3gk.mongodb-dev.net:27017",
            "rel": "http://cloud.mongodb.com/host"
        }
    ],
    "processId": "cluster0-shard-00-00.5f3gk.mongodb-dev.net:27017"
   }
