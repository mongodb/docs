.. _query-syntax-ref:

==========================================
The ``$search`` Aggregation Pipeline Stage
==========================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. important:: 

   Looking for ``$searchBeta``? Use ``$search`` instead, the official 
   aggregation stage for running search queries. 

Definition
----------

.. pipeline:: $search

   |fts| queries take the form of an
   :manual:`aggregation pipeline stage </aggregation>`. The
   :pipeline:`$search` stage performs a full-text search on the
   specified field or fields which must be covered by an |fts| index.

   A ``$search`` pipeline stage has the following prototype form:

   .. code-block:: json

      {
        $search: {
          "index": "<index-name>",
          "<operator-name>": {
            <operator-specification(s)>
          },
          "highlight": {highlighting-options}
        }
      }

Fields
------

The ``$search`` stage takes a document with the following fields: 

.. list-table:: 
   :header-rows: 1
   :widths: 10 15 15 70

   * - Field 
     - Type 
     - Necessity 
     - Description

   * - ``highlight`` 
     - document 
     - Optional 
     - Document that specifies the :ref:`highlight-ref` options for 
       displaying search terms in their original context.

   * - ``index`` 
     - string 
     - Optional 
     - Name of the |fts| index to use. If omitted, defaults to 
       ``default``.

   * - ``<operator-name>``
     - string 
     - Required
     - Name of the :ref:`operator <operators-ref>` to search with. You 
       can provide a document that contains the operator-specific 
       options as the value for this field.

Behavior
--------

``$search`` must be the first stage of any pipeline it appears in.
``$search`` cannot be used in:

- a :manual:`view definition</core/views>`
- a :pipeline:`$lookup subpipeline <$lookup>`
- a :pipeline:`$facet` pipeline stage

.. seealso::

   :ref:`$search Operators <operators-ref>`

Troubleshoot Errors 
-------------------

The following error is returned if you run ``$search`` queries when 
the |fts| ``mongot`` process isn't installed or running:

.. code-block:: shell 
   :copyable: false 

   MongoError: Remote error from mongot :: caused by :: Error connecting to localhost:28000.

The ``mongot`` process is installed only when the first |fts| index is 
defined. If you don't have any |fts| index in your |service| cluster, 
create at least one |fts| index to resolve this error. 

.. seealso:: 

   - :ref:`ref-index-definitions`
   - :ref:`ref-create-index`


.. toctree::
   :titlesonly:

   /reference/atlas-search/operators
   /reference/atlas-search/path-construction
