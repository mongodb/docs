.. _flex-migration:

===========================================================================================================
Migrate your Programmatic Tools from M2, M5, or {+Serverless-Instances+} to {+Flex-Clusters+}
===========================================================================================================

.. default-domain:: mongodb

.. facet::
   :name: genre
   :values: tutorial

.. meta::
   :keywords: migrate to flex cluster

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. include:: /includes/shared-to-atlas-flex-migration.rst

All of the tools support {+Flex-clusters+}. Update your code and replace
all references to deprecated instance types with references to {+Flex-Clusters+}.

.. note::

   If your workloads require :ref:`Private Endpoints
   <private-endpoint-overview>` or
   :ref:`Continuous Backup and Point-in-Time Restore <pit-restore>`, use
   dedicated clusters.

.. _flex-migration-api:

Migrating API Configuration
---------------------------

The :oas-bump-atlas-tag:`Cluster <clusters>` API endpoints listed in the table in this
section are compatible with ``M2``/``M5`` {+clusters+}.
As of January 2025, these endpoints manage {+Flex-clusters+}. You can
continue using these API endpoints without change until they reach End of Life 
(EOL) in January 2026.

As of January 2025, API endpoints for Serverless Instances
manage {+Flex-clusters+}. As of  March 2025, all existing
{+Serverless-instances+} have been migrated to {+Free-clusters+}, {+Flex-clusters+}, 
or {+dedicated-clusters+}, according to your usage. If your {+Serverless-instance+} 
is migrated to a {+Free-cluster+} or {+dedicated-cluster+}, you must use the 
:oas-bump-atlas-tag:`Cluster <clusters>` API endpoint instead. To see which tiers 
|service| will migrate your instances to, consult the 
`All Clusters <https://cloud.mongodb.com/v2#/clusters>`__ 
page in the {+atlas-ui+}.

If you attempt to create an ``M2`` or ``M5`` {+cluster+} using the
:oas-bump-atlas-op:`<creategroupcluster>` endpoint, or a {+Serverless-instance+}
using the :oas-bump-atlas-op:`<creategroupserverlessinstance>` endpoint, between
January of 2025 and January of 2026, you will instead create a
{+Flex-cluster+}. Support for these endpoints ends January 2026.

You must replace calls to
{+Serverless-instance+} API endpoints with appropriately configured
calls to the :oas-bump-atlas-tag:`Clusters <clusters>` API endpoints before your
{+Serverless-instances+} are migrated to {+Flex-clusters+}.

The following changes also apply to the listed API endpoints beginning
January of 2025.

.. list-table::
   :widths: 30 70
   :header-rows: 1

   * - Endpoint
     - Impact

   * - :oas-bump-atlas-op:`<listgroupprivateendpointserverlessinstanceendpoint>`
     - Deprecated for new {+Flex-clusters+}. Returns an error because
       {+Serverless-instances+} are migrated to Free, Flex or {+dedicated-clusters+}
       as of May 2025.

   * - :oas-bump-atlas-op:`<upgradegroupclustertenantupgrade>`
     - When used on {+Flex-clusters+}, ``upgradeSharedCluster`` takes the
       value set by the user, but doesn't toggle Continuous Backup because
       Continuous Backup is not available for {+Flex-clusters+}.

   * - :oas-bump-atlas-op:`<creategroupserverlessinstance>`
     - When used on {+Flex-clusters+}, ``createServerlessInstance`` takes the
       value set by the user, but doesn't toggle Continuous Backup because
       Continuous Backup is not available for {+Flex-clusters+}.

   * - :oas-bump-atlas-op:`<updategroupserverlessinstance>`
     - When used on {+Flex-clusters+}, ``updateServerlessInstance`` takes the 
       value set by the user, but doesn't toggle Continuous Backup because 
       Continuous Backup is not available for {+Flex-clusters+}.

   * - :oas-bump-atlas-op:`<setgroupserverlessperformanceadvisorautoindexing>`
     - When used on {+Flex-clusters+}, ``setServerlessAutoIndexing`` takes the 
       value set by the user, but doesn't toggle Auto-Indexing because 
       Auto-Indexing is not available for {+Flex-clusters+}.

   * - :oas-bump-atlas-op:`<getgroupserverlessperformanceadvisorautoindexing>`
     - When used on {+Flex-clusters+}, ``getServerlessAutoIndexing`` takes the 
       value set by the user, but doesn't toggle Auto-Indexing because 
       Auto-Indexing is not available for {+Flex-clusters+}.

.. _flex-migration-terraform:

Terraform Atlas Provider Migration
--------------------------------------

The `HashiCorp Terraform Provider <https://registry.terraform.io/providers/mongodb/mongodbatlas/latest/docs/resources/flex_cluster>`__
supports {+Flex-clusters+}. General Terraform  support for ``M2``/``M5``
{+clusters+} and {+Serverless-instances+} will continue until January 2026.

You must update your Terraform configurations to operate on {+Flex-clusters+}
according to the following timelines, depending on which features you use:

.. list-table::
   :widths: 30 70
   :header-rows: 1

   * - Feature
     - Update Deadline

   * - `Private Endpoint Interface Link
       <https://registry.terraform.io/providers/mongodb/mongodbatlas/latest/docs/resources/privatelink_endpoint_service>`__
     - April, 2025

   * - `Serverless PrivateLink Endpoint Service
       <https://registry.terraform.io/providers/mongodb/mongodbatlas/latest/docs/resources/privatelink_endpoint_service_serverless>`__
       for new  {+Serverless-instances+}
     - January, 2025

   * - `Serverless PrivateLink Endpoint Service
       <https://registry.terraform.io/providers/mongodb/mongodbatlas/latest/docs/resources/privatelink_endpoint_service_serverless>`__ 
       for existing  {+Serverless-instances+}
     - May, 2025

   * - All other features
     - January, 2026

.. _flex-migration-go-sdk:

Go SDK Migration
----------------

The {+atlas-go-sdk+} supports {+Flex-clusters+} starting in November
of 2024. General SDK support for ``M2``/``M5`` {+clusters+} and
{+Serverless-instances+} continues until January 2026. You must
update your SDK scripts to operate on {+Flex-clusters+} according to
the following timelines, depending on which features you use:

.. list-table::
   :widths: 30 70
   :header-rows: 1

   * - Feature
     - Update Deadline

   * - The :github:`ServerlessPrivateEndpointsApi <mongodb/atlas-sdk-go/blob/main/docs/docs/ServerlessPrivateEndpointsApi.md>`
     - May, 2025

   * - All other features
     - January, 2026

.. _flex-migration-cli:

{+atlas-cli+} Migration
------------------------

The {+atlas-cli+} supports {+Flex-clusters+} beginning December 2024.
To learn more, see :atlascli:`command reference </command/atlas/>` and
select the latest {+atlas-cli+} version from the dropdown.

Support for {+pit-restore+} on {+Serverless-instances+} ended in January 2025.
If you used {+pit-restore+} on any of your {+Serverless-instances+}, you
must update your {+atlas-cli+} workflows to remove {+Serverless-Instance+}
{+pit-restore+} to avoid errors.

General {+atlas-cli+} support for ``M2``/``M5`` {+clusters+} and
{+Serverless-instances+} continues until January 2026. Before January 2026,
you must remove all ``M2``/``M5`` and {+Serverless-Instance+} commands
from your {+atlas-cli+} workflows.

.. _flex-migration-ak8so:

{+ak8so+} Migration
----------------------------------------

The :ak8so:`{+ak8so+} </>` supports {+Flex-clusters+} beginning
February 2025.

- Until January 2026, to preserve backwards compatibility for a period of time,
  |service| allows you to manage migrated {+clusters+} through both
  the {+Serverless-instances+} and {+Flex-clusters+} APIs, including when
  you're using |ak8so|.

- You can create and manage {+Flex-clusters+} in the same ``AtlasDeployment``
  Custom Resources in which you created and managed {+Serverless-instances+}
  and ``M2`` and ``M5`` {+clusters+}. To learn more, see
  the :ak8so:`AtlasDeployment </current/atlasdeployment-custom-resource/>` custom
  resource in the {+ak8so+} documentation.

- You can't create **NEW** ``M2``/``M5`` {+clusters+} and {+Serverless-instances+}
  in |service|. Attempting to do so creates a {+Flex-cluster+} instead.

- Replace references to ``spec.serverlessSpec`` in the ``AtlasDeployment``
  Custom Resource with the configuration for ``spec.flexSpec``.

- Replace references to ``spec.deploymentSpec`` in the ``AtlasDeployment``
  Custom Resource with the configuration for ``spec.flexSpec``.

- If you receive errors during reconciliations related to private endpoints,
  you must upgrade to at least {+ak8so+} 2.7.1 or later, or replace
  the ``serverlessSpec`` configuration with the configuration for
  ``flexSpec`` in the ``AtlasDeployment`` custom resource.

- To avoid reconciliation errors that you might notice after the automigration,
- make the following changes to your CRD configurations:

  - Remove the ``spec.deploymentSpec.replicationSpecs.zoneName`` setting.

  - Remove any of the ``spec.deploymentSpec.replicationSpecs.regionConfigs``
    settings after the first set of settings.

  - Specify ``replicaset`` only in the ``spec.deploymentSpec.clusterType``.

  Alternatively, replace references to ``spec.deploymentSpec``
  in the ``AtlasDeployment`` Custom Resource with the configuration for
  ``spec.flexSpec``.

- By January 2026, you must remove all remaining ``M2``/``M5`` and 
  {+Serverless-Instance+} configurations from your {+ak8so+} custom resources
  because backwards compatibility of APIs ends January 2026. At that time,
  the old APIs will be removed and only APIs related to {+Flex-clusters+} will
  remain in place. Releases of {+ak8so+} after 2.7.1 don't support
  existing {+Serverless-instances+}. 

.. _flex-migration-cfn-cdk:

{+service+} CloudFormation Migration
------------------------------------

{+service+} CloudFormation and Cloud Development Kit (CDK) now support {+Flex-clusters+}.
General support for ``M2``/``M5`` {+clusters+} continues until January 2026.

Support for :github:`Serverless Private Endpoints
<mongodb/mongodbatlas-cloudformation-resources/tree/master/cfn-resources/serverless-private-endpoint>`
and the ``Properties.ContinuousBackupEnabled`` parameter of the
:github:`Serverless Instance
<mongodb/mongodbatlas-cloudformation-resources/tree/master/cfn-resources/serverless-instance/docs#mongodbatlasserverlessinstance>`
resource ended when {+service+} CloudFormation introduced {+Flex-cluster+}
support. These resources are no longer available in CloudFormation or CDK.
Update your configurations to remove them. You must remove all
``M2``/``M5`` and {+Serverless-instance+} features from your {+service+}
CloudFormation and CDK resources before January 2026.

.. important::

   Use the ``MongoDB::Atlas::Cluster`` resource in CloudFormation or the ``CfnCluster`` resource in CDK
   instead of the ``MongoDB::Atlas::FlexCluster`` resource in CloudFormation or the ``CfnFlexCluster`` resource in CDK
   to create and manage {+Flex-clusters+}. ``MongoDB::Atlas::Cluster`` and ``CfnCluster`` support
   {+Flex-clusters+}, and future upgrades will be available only through these resources.
   CloudFormation and CDK do not yet support migration between {+Flex-clusters+} and other cluster types,
   but support will be added in the future.

For more information, see:

- :github:`CloudFormation Flex Cluster README
  <mongodb/mongodbatlas-cloudformation-resources/blob/master/cfn-resources/flex-cluster/README.md>`
- :github:`CloudFormation Cluster README
  <mongodb/mongodbatlas-cloudformation-resources/blob/master/cfn-resources/cluster/README.md>`
- :github:`CDK Flex Cluster README
  <mongodb/awscdk-resources-mongodbatlas/blob/main/src/l1-resources/flex-cluster/README.md>`
- :github:`CDK Cluster README
  <mongodb/awscdk-resources-mongodbatlas/blob/main/src/l1-resources/cluster/README.md>`
