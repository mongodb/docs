================
Back Up |onprem|
================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

Deploying the |onprem| Backup Blockstore and Application databases as
:term:`replica sets <replica set>` is key to protect the databases from failure.

Ensure you configure and deploy your replica sets for
failover and redundancy. See :manual:`Replica Set High Availability
</core/replica-set-high-availability>` and :manual:`Replica Set
Deployment Architectures </core/replica-set-architectures>` for more
about replica set architecture.

Beyond using MongoDB's replication capabilities, you can create
backups for the Backup Blockstore database and Application database,
both for longterm storage of snapshots, and for backing
up |onprem| for disaster recovery purposes.

To restore |onprem|, you only need backups of the Application database
and the Backup Blockstore database. |onprem|'s other components are
stateless: you can rebuild them from the installation package if need
be.

.. important::

   Your Backup installation cannot back up |onprem|. If you wish to
   use |onprem| to back up |onprem|, you will need *two* |onprem|
   installations: one to back up your MongoDB deployment,
   and another to back up your |onprem| databases.

Back Up with the Public API
---------------------------

The |mms| Public API allows you to programmatically restore snapshots
on your desired schedule, and store them offline. Ideally, you should
save the backups to a tape drive, appending the new snapshots daily
until the drive is full, and then store the drive offsite.

Programmatically restoring snapshots has the same impact on a
snapshot as a typical restore.

See :doc:`the API documentation </reference/api/restore-jobs>` for how
to restore jobs using this method.

This method backs up the snapshots only: you **cannot** use the backups
to restore |onprem| in the event that a Blockstore database is lost.

.. _backup-opsmgr:

Shut Down and Back Up
---------------------

To perform a full backup of all snapshots contained in |onprem|,
including the point-in-time restores:

1. Shut down the |onprem| application service
2. Shut down the |onprem| application databases
3. Shut down the |onprem| backup databases.
4. If you backed up using blockstores, back up the file systems that
   store the application and backup databases (and/or files) while they
   are offline.
5. If you backed up using file system stores, backup the snapshot files
   on the file system.

The *Shut Down and Back Up* approach has the advantage of providing all
of |onprem|'s backup snapshots *and* the point-in-time restores that it
stores. However, the process involves significant downtime and during
the shut down, |onprem| is completely unavailable as are monitoring and
automation capabilities. As such, if a failure occurs in one of your
MongoDB instances, you may lose the data that |onprem| did not back up
prior to shutdown nor are you alerted of that fact because monitoring
is unavailable.

.. seealso:: :manual:`Back up and Restore with Filesystem Snapshots
   </tutorial/backup-with-filesystem-snapshots/>`.

