.. _mcli-cm-create-alerts-settings-command:

=============================================
mongocli cloud-manager alerts settings create
=============================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol


The ``alerts settings create`` command creates one alert configuration
in the specified |cloud-short| project. You can also create one alert
configuration in a project through the |cloud-short| :cloudmgr:`API
</reference/api/alert-configurations-create-config/>`.

.. _cm-create-alerts-settings-syntax:

Syntax 
------

.. code-block:: text 

   mongocli cloud-manager|cm alert|alerts settings|config create
        [ --event <event> ]
        [ --enabled ]
        [ --matcherField <fieldName> ]
        [ --matcherOperator <operator> ]
        [ --matcherValue <value> ]
        [ --notification* (notification flags) ]
        [ --projectId <id-of-project> ]
        [ --profile|-P <profile-name> ]

.. _cm-crete-alerts-settings-options:

Options 
-------

.. list-table:: 
   :header-rows: 1 
   :widths: 20 10 60 10

   * - Option 
     - Type 
     - Description 
     - Required?

   * - ``--apiKey``
     - string
     - OpsGenie or VictorOps API key. 
     - only if ``notificationType`` is ``OPS_GENIE`` or ``VICTOR_OPS``.  

   * - ``--enabled``
     - boolean
     - Flag that determines whether the alert configuration is enabled.
       If present, the alert configuration is enabled. If omitted, the 
       configuration is disabled.
     - no

   * - ``--event``
     - string
     - Type of event that triggers an alert.
        
       For a complete list of alert events, see :cloudmgr:`Alert Conditions
       </reference/alerts/>`.
     - yes

   * - ``--matcherFieldName``
     - string
     - Name of the field in the target object to match on.
        
       Use the :ref:`List alert configuration matcher fields 
       <mcli-cm-alert-settings-fields-type-command>` to return the 
       accepted values.
     - no

   * - ``--matcherOperator``
     - string
     - Operator to test the field's value. Accepted values are:
        
       .. include:: /includes/possibleValues-api-matchers.operator.rst
     - no

   * - ``--matcherValue``
     - string
     - Value to test with the specified operator.
        
       .. include:: /includes/possibleValues-api-matchers.value.rst
     - no

   * - ``--metricMode``
     - string
     - Set to ``AVERAGE`` to compute the average of this metric.
     - no

   * - ``--metricName``
     - string
     - The name of the metric whose value went outside the threshold. Only
       applicable if ``--event`` is ``OUTSIDE_METRIC_THRESHOLD``. Accepted
       values are:

       .. include:: /includes/metricName-list.rst
     - only if ``--event`` is ``OUTSIDE_METRIC_THRESHOLD``.

   * - ``--metricOperator``
     - string
     - Operator to apply when checking the current metric value
       against the threshold value. Accepted values are:

       - ``GREATER_THAN``

       - ``LESS_THAN``
     - no

   * - ``--metricThreshold``
     - float
     - Threshold value outside of which an alert is triggered.
     - no

   * - ``--metricUnits``
     - string
     - Units for the threshold value. Depends on the type of 
       metric. 
        
       .. example:: 

          A metric that measures memory consumption would have a 
          byte measurement, while a metric that measures time would 
          have a time unit.
        
       Accepted values are:
        
       .. include:: /includes/possibleValues-api-units.rst
     - no

   * - ``--notificationToken``
     - string
     - Slack API or Bot token or Flowdock personal API token.
       If the token later becomes invalid, |mms| sends an email to 
       the Project owner and eventually removes the token.
     - only if ``notificationType`` is ``SLACK`` or ``FLOWDOCK``.

   * - ``--notificationChannelName``
     - string
     - Slack channel name. 
     - only if ``notificationType`` is ``SLACK``.

   * - ``--notificationdelayMin``
     - int
     - Minutes to wait after an alert condition is detected before 
       sending out the first notification.
     - no

   * - ``--notificationEmailAddress``
     - string
     - Email address to which |cloud-short| sends notifications.
     - only if ``notificationType`` is ``EMAIL``.

   * - ``--notificationEmailEnabled``
     - boolean
     - Flag determining if |cloud-short| sends email notifications. 
       If present, |cloud-short| sends email notifications. If absent, 
       |cloud-short| doesn't send email notifications.
       Configurable for ``GROUP`` and ``USER`` notifications types.
     - no

   * - ``--notificationsFlowName``
     - string
     - Flow name, in lower-case letters. The flow name appears
       after the organization name in the URL string:
       ``www.flowdock.com/app/<organization-name>/<flow-name>``.
     - only if ``notificationType is ``FLOWDOCK``.

   * - ``--notificationIntervalMin``
     - int
     - Minutes to wait between successive notifications 
       for unacknowledged alerts that are not resolved.
     - no

   * - ``--notificationMobileNumber``
     - string
     - Mobile number to send SMS messages to.
     - only if ``notificationType`` is ``SMS``.

   * - ``--notificationOrgName``
     - string
     - Flowdock organization name in lower-case letters. This is 
       the name that appears after ``www.flowdock.com/app/`` in the 
       URL string.
     - only if ``notificationType`` is ``FLOWDOCK``.

   * - ``--notificationRole``
     - string
     - One or more :ref:`project roles <project-roles>` that receive
       the configured alert. Accepted values include:

       .. include:: /includes/project-roles-cm.rst

       If you include this field, |cloud-short| sends alerts only to 
       users assigned the roles you specify in the array. If you 
       omit this field, |cloud-short| sends alerts to users assigned
       any role.

       Configurable for ``GROUP`` notifications types.
     - no

   * - ``--notificationServiceKey``
     - string
     - PagerDuty service key.
     - only if ``notificationType`` is ``PAGER_DUTY``.

   * - ``--notificationSmsEnabled``
     - boolean
     - Flag indicating SMS notifications must be sent.
     - only if:

       - ``notificationType`` is ``GROUP``
       - ``notificationType`` is ``USER``

   * - ``--notificationTeamId``
     - string
     - Unique identifier of a team.
     - no

   * - ``--notificationType``
     - string
     - Type of alert notification. Accepted values are:
        
       - ``EMAIL``
       - ``FLOWDOCK``
       - ``GROUP`` (Project)
       - ``ORG``
       - ``OPS_GENIE``
       - ``PAGER_DUTY``
       - ``SLACK``
       - ``SMS``
       - ``TEAM``
       - ``USER``
       - ``VICTOR_OPS``

     - yes

   * - ``--notificationUsername``
     - string
     - Name of an |cloud-short| user to which to send notifications. 
       Specify a user in the Project that owns the alert
       configuration. 
     - Only if ``notificationType`` is ``USER``.

   * - ``--notificationVictorOpsRoutingKey``
     - string
     - VictorOps routing key
     - Only if ``notificationType`` is ``VICTOR_OPS``.

   * - ``--profile``, ``-P``
     - string
     - Name of the profile where the public and private 
       keys for the project are saved. If omitted, uses the {+default-profile+}. To learn more about creating a 
       profile, see :ref:`mcli-configure`.
     - no

   * - ``--projectId``
     - string
     - Unique identifier of the project containing the alert
       configuration you want to create.

       .. include:: /includes/admonitions/note-get-project-id.rst
     - yes

.. _cm-create-alerts-settings-output:

Output 
------ 

If the command succeeds, it prints the subset of the following fields to 
the terminal in |json| format that describes the alert configuration. 
If the command returns an error, see :ref:`Troubleshooting 
<troubleshooting>` for recommended solutions.

.. include:: /includes/list-table-alert-settings-response-cm.rst

Example
-------

The following example uses the ``mongocli cm alerts settings create``
command to create one alert configuration the specified
project. It uses the {+default-profile+} to access the
|cloud-short| project.

.. code-block:: text
   :copyable: false

   mongocli cm alert settings create --event JOINED_GROUP --enabled \
   --notificationType USER --notificationEmailEnabled \
   --notificationUsername john@example.com \
   --projectId 5df90590f10fab5e33de2305

The above command prints the following fields in |json| format to 
the terminal. To learn more about these fields, see 
:ref:`cm-create-alerts-settings-output`.

.. code-block:: json
   :copyable: false

   {
   	"id": "5eaafc90da10757c5fc51e70",
   	"groupId": "5df90590f10fab5e33de2305",
   	"eventTypeName": "JOINED_GROUP",
   	"created": "2020-05-01T14:34:57Z",
   	"updated": "2020-05-01T14:34:57Z",
   	"enabled": true,
   	"notifications": [
   		{
   			"delayMin": 0,
   			"emailEnabled": true,
   			"smsEnabled": false,
   			"typeName": "USER",
   			"username": "john@example.com"
   		}
   	]
   }
