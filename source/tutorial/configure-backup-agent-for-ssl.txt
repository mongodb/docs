==============================
Configure Backup Agent for SSL
==============================

.. default-domain:: mongodb

Overview
--------

If your MongoDB deployment uses SSL, then you must configure the Backup
Agent to use SSL to connect to your deployment's :program:`mongod` and
:program:`mongos` instances.

Configuring the agent to use SSL involves specifying which certificate to
use to sign MongoDB certificates and turning on the SSL option for the
MongoDB instances in |mms|.

Prerequisite
------------

To configure the agent to use SSL, you must have a trusted CA
certificate that signed the MongoDB instance's certificate.

Procedures
----------

Connections between Agents and MongoDB Instances
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

To use SSL for the Backup Agent's connection to a MongoDB host, specify
the host's SSL settings when :doc:`adding the host
</tutorial/add-existing-mongodb-processes>` or by :doc:`editing the host's settings
</tutorial/enable-ssl-for-a-deployment>`.

.. only:: onprem

   .. note::

      In |onprem| 1.8 and later, |onprem| can manage SSL for you if you
      using Automation for the deployment. With Automation, |mms|
      prompts you for the certificates to use to connect to the
      deployment when you enable SSL and then configures the agents
      appropriately. See: :doc:`/tutorial/enable-ssl-for-a-deployment` for
      more information.

.. only:: cloud

   .. note::
   
      |mms| can manage SSL for you if you are using Automation for the
      deployment. With Automation, |mms| prompts you for the
      certificates to use to connect to the deployment, when you enable
      SSL and then configures the agents appropriately. See:
      :doc:`/tutorial/enable-ssl-for-a-deployment` for more information.

.. include:: /includes/steps/backup-agent-configure-ssl.rst

Connections between Agents and |mms|
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. only:: classic or cloud

   The Backup Agents always use SSL when connecting to the |mms| servers.
   For the settings used by the Backup Agent to connect to the |mms|
   servers, see :ref:`backup-server-ssl-settings`.

.. only:: onprem

   To ensure that the Backup Agents use SSL when connecting to
   |onprem|, Configure |onprem| to use SSL for all connections. The
   :doc:`/tutorial/configure-ssl-connection-to-web-interface` tutorial
   describes how to set up |onprem| to run over HTTPS.

   Starting with |onprem| 1.4, the Backup Agent validates the SSL
   certificate of the |onprem| server by default.

   If you are not using a certificate signed by a trusted 3rd party,
   you must configure the Backup Agent to trust the |onprem| server.

   To specify a self-signed certificate of the |onprem| server that the
   Backup Agent should trust:

   .. include:: /includes/steps/on-prem-backup-agent-configure-trust.rst
