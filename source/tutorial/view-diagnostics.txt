============
View Metrics
============

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

Overview
--------

|mms| provides charts for analyzing the statistics collected by the Monitoring
Agent for your deployment's :program:`mongod` and :program:`mongos` processes.
The agent collects metrics using several MongoDB diagnostic commands, including
:manual:`serverStatus </reference/command/serverStatus>` and :manual:`dbStats
</reference/command/dbStats>`.

|mms| also provides charts for analyzing hardware statistics collected by the
Automation Agents. Hardware metrics are available only for automated
deployments. The Automation Agents collect the metrics for the servers that
run the managed MongoDB processes.

Data Granularity
~~~~~~~~~~~~~~~~

.. include:: /includes/extracts/metric-data-retention-granularity.rst

.. _metric-data-retention:

Data Retention
~~~~~~~~~~~~~~

.. include:: /includes/extracts/metric-data-retention-retention.rst

.. _access-host-statistics:

View Metrics
------------

To view metrics, click :guilabel:`Deployment` and then click the :guilabel:`Metrics`
button for the sharded cluster, replica set, or individual MongoDB process.

To add or remove charts, click either the :guilabel:`Display` or
:guilabel:`Add Chart` drop-down list, depending on which is available. To
display a chart's controls, hover the mouse pointer over the chart. To view
metrics for a different level in the topology of a sharded cluster or replica
set, use the breadcrumb.

For additional information on displayed metrics, see the following on this
page:

- :ref:`metrics-sharded-clusters`

- :ref:`metrics-replica-sets`

- :ref:`real-time-metrics-status-tab`

- :ref:`metrics-status-tab`

- :ref:`metrics-hardware-tab`

- :ref:`metrics-db-stats-tab`

- :ref:`metrics-chart-controls`

.. _metrics-sharded-clusters:

Sharded Cluster Metrics
~~~~~~~~~~~~~~~~~~~~~~~

When you view metrics for a sharded cluster, you can choose to
display either the :term:`shards <shard>`, :term:`mongos instances <mongos>`, or
:term:`config servers <config server>`. For a shard you can use the buttons
below the chart to select primaries, secondaries, or both. |mms| displays
different processes as different lines.

To sum or average the data, click the :guilabel:`Display Data` drop-down list
and select the desired option. To change charts, click the :guilabel:`Display`
drop-down list.

.. _metrics-replica-sets:

Replica Set Metrics
~~~~~~~~~~~~~~~~~~~

When you view metrics for a replica set, you can limit the display to
particular types of members using the :term:`P <primary>`, :term:`S
<secondary>`, and :term:`A <arbiter>` options.

To add or remove charts, click the :guilabel:`Add Chart` drop-down list or
click the buttons at the bottom of the page. To remove a chart, deselect it.

.. _real-time-metrics-status-tab:

Real-Time Tab
~~~~~~~~~~~~~

.. admonition:: Availability
   :class: note 

   Real-time metrics is available for MongoDB deployments managed by
   Automation, using Automation Agent version 3.3.1 or greater.
   
   Real-time metrics is also available for `MongoDB Atlas
   <https://cloud.mongodb.com?jmp=docs>`_.

Click the :guilabel:`Real-Time` tab to display various real-time
metrics.

You can view the stats in either :guilabel:`Table` view or the
:guilabel:`Graph` view.

Table View
``````````

.. list-table::
   :header-rows: 1
   :widths: 25 75
   
   * - Fields
     - Description

   * - | :guilabel:`Resident`
       | :guilabel:`Virtual` 
       | :guilabel:`Mapped`

     - Displays the resident/virtual/mapped memory stats as reported by
       :program:`mongostat <bin.mongostat>`. For a description of the
       fields, see :manual:`mongostat
       </reference/program/mongostat/#fields>`.

   * - | :guilabel:`Bytes In` 
       | :guilabel:`Bytes Out`
       | :guilabel:`Connections`

     - Displays the connection stats (number of bytes in, number of
       bytes out, number of connections) as reported by
       :program:`mongostat <bin.mongostat>`. For a description of the
       fields, see :manual:`mongostat
       </reference/program/mongostat/#fields>`.

   * - | :guilabel:`Commands` 
       | :guilabel:`Queries`
       | :guilabel:`Updates`
       | :guilabel:`Deletes`
       | :guilabel:`Inserts`
       | :guilabel:`GetMores`

     - Displays the number of the specified operations (commands,
       queries, etc.) as reported by :program:`mongostat
       <bin.mongostat>`. For a description of the fields, see
       :program:`mongostat <bin.mongostat>`.

   * - | :guilabel:`Active Readers`
       | :guilabel:`Active Writers`
       | :guilabel:`Queued Readers`
       | :guilabel:`Queued Writers`

     - Displays the number of active reads, queued reads, active
       writes, queued writes as reported by :program:`mongostat
       <bin.mongostat>`. For a description of the fields, see
       :manual:`mongostat </reference/program/mongostat/#fields>`.

Click on the elipsis button (``...``) to hide or display fields from
the table.

Graph View
``````````

.. list-table::
   :header-rows: 1
   :widths: 25 75
   
   * - Chart/Table
     - Description

   * - :guilabel:`Memory`

     - Displays the memory stats as reported by :program:`mongostat
       <bin.mongostat>`. For a description of the fields, see
       :manual:`mongostat </reference/program/mongostat/#fields>`.

   * - :guilabel:`Network`

     - Displays the connection stats as reported by
       :program:`mongostat <bin.mongostat>`. For a description of the
       fields, see :manual:`mongostat
       </reference/program/mongostat/#fields>`.

   * - :guilabel:`Operations`

     - Displays the number of operations as reported by
       :program:`mongostat <bin.mongostat>`. For a description of the
       fields, see :program:`mongostat <bin.mongostat>`.

   * - :guilabel:`Reads & Writes`

     - Displays the number of active reads, queued reads, active
       writes, queued writes as reported by :program:`mongostat
       <bin.mongostat>`. For a description of the fields, see
       :manual:`mongostat </reference/program/mongostat/#fields>`.

   * - :guilabel:`Hottest Collections`

     - Displays the collections with the most operations as reported by
       :program:`mongotop <bin.mongotop>`. For each hot collection, the
       table also displays the :guilabel:`Utilization Percent` for
       the collection. 

       :guilabel:`Utilization Percent` is calculated from the read and write
       times as reported by :program:`mongotop <bin.mongotop>` during a
       sample period. Specifically, the :guilabel:`Utilization Percent` is the
       percentage (rounded to the nearest 0.1%) of the read and write
       times for a collection relative to the read and write times for
       all collections in the deployment during the sample period. If
       no read and write operation occur during this period, the
       :guilabel:`Utilization Percent` may be 0%.

       The hottest collections correspond to the most current time
       displayed in the charts. That is, if the display is running
       (i.e. not paused), the collections correspond to the hottest
       collections at the current timestamp. If the display is paused,
       the collections correspond to the hottest collections at the
       paused time.

   * - :guilabel:`Slowest Operations`

     - Displays the slowest operations as reported by
       :manual:`db.currentOp() </reference/method/db.currentOp>`. 
       
       The operations correspond to the most current time displayed in
       the charts. That is, if the display is running (i.e. not
       paused), the operations correspond to the slowest operations at
       the current timestamp. If the display is paused, the operations
       correspond to the slowest operations at the paused time.
       
       To view the JSON document as reported by
       :manual:`db.currentOp() </reference/method/db.currentOp>` for
       the operation, click on the operation.

To hide/show a metric in the graph, click on the color box for the
metric.

Stop and Restart Display
````````````````````````

To stop the update of the stats displayed, click the :guilabel:`Pause`
button. The :guilabel:`Pause` button only stops the update of the
displays and does not pause the collection of the underlying data.

To restart the display updates, click :guilabel:`Play`.

.. _metrics-status-tab:

Status Tab
~~~~~~~~~~

This tab displays process metrics the Monitoring Agent collects from the
selected :program:`mongod` or :program:`mongos` process. The agent collects
a subset of the output of the MongoDB :manual:`serverStatus
</reference/command/serverStatus>` and :manual:`explain
</reference/command/explain>` commands.

.. _metrics-hardware-tab:

Hardware Tab
~~~~~~~~~~~~

.. important::

   As of Automation Agent 2.7.0, hardware monitoring using ``munin-node`` is
   deprecated.

   If you run ``munin-node`` on your MongoDB servers then install or upgrade to
   Automation Agent version 2.7.0 or later, |mms| displays the hardware data
   that the Automation Agent collected, **not what Munin had collected**. The
   historical hardware data Munin collected **is neither displayed nor saved**.

   If you run Munin but not the Automation Agent, |mms| displays the Munin charts.

The Automation Agent collects the following hardware metrics for your
:program:`mongod` and :program:`mongos` processes:

.. list-table::
   :widths: 35 65
   :header-rows: 1

   * - Chart

     - Data

   * - System CPU

     - The CPU usage of all processes (not just MongoDB processes) on the host
       server. For servers with more than 1 CPU core, this value can exceed
       100%.

   * - Normalized System CPU

     - The CPU usage of all processes (not just MongoDB processes) on the host
       server, scaled to a range of 0-100% by dividing by the number of CPU cores.

   * - Process CPU

     - The CPU usage of the MongoDB process. For servers with more than 1 CPU
       core, this value can exceed 100%.

   * - Normalized Process CPU

     - The CPU usage of the MongoDB process, scaled to a range of 0-100% by
       dividing by the number of CPU cores.

   * - Disk Space Free - <partition>

     - The total bytes of free disk space on the disk partition used by
       MongoDB.

   * - Util % - <partition>

     - The percentage of time during which requests are being issued to
       and serviced by the partition. This includes requests from any process,
       not just MongoDB processes.

   * - Disk IOPS - <partition>

     - The throughput of I/O operations per second for the disk partition used for MongoDB.

   * - Disk Space Percent Free - <partition>

     - The percent of free disk space on the partition used by MongoDB.

   * - Disk Latency - <partition>

     - The latency in milliseconds of the disk partition used by MongoDB.

   * - Disk Space Used - <partition>

     - The total bytes of used disk space on the partition that runs MongoDB.

.. _metrics-db-stats-tab:

DB Stats Tab
~~~~~~~~~~~~

This tab displays database metrics the Monitoring Agent collects through the
MongoDB ``dbStats`` command. The agent collects a subset of ``dbStats``
output. See :manual:`dbStats </reference/command/dbStats>` in the MongoDB
manual.

The agent retrieves database metrics every 20 minutes by default but adjusts
frequency when necessary to reduce the impact on database performance. You can
disable the collection of database statistics by clicking
:guilabel:`Settings`, then :guilabel:`Group Settings`, and then setting
:guilabel:`Collect Database Specific Statistics` to ``No``.

To select which database to display, click the :guilabel:`Select Database`
drop-down list.

.. _metrics-chart-controls:

Chart Controls
~~~~~~~~~~~~~~

When viewing charts, you can do the following:

.. list-table::
   :widths: 35 65
   :header-rows: 1

   * - Task

     - Action

   * - View a chart's description.

     - Click the :guilabel:`i` icon next to the chart name. (Not available for
       cluster-level chart)

   * - Expand a chart.

     - Click the two-way arrow at the top right of the chart.

   * - Zoom in on a period of time.

     - Click and drag the mouse pointer over a portion of the chart. To reset,
       double-click the chart.

       .. note::

          When you zoom, the time selections above the charts automatically
          update to reflect the new period displayed.

   * - View point-in-time statistics.

     - Hover the mouse pointer over a point on the chart.

   * - Move a chart.

     - Click and hold the grabber in the upper left corner of the chart, and
       drag the chart to the new position.

   * - Export the charts.

     - Click the :guilabel:`Export` drop-down list and select the format.

   * - Link to a chart.

     - Click the curved arrow on the chart and select :guilabel:`Chart
       Permalink`.

   * - Email the chart.

     - Click the curved arrow on the chart and select :guilabel:`Email Chart`.
