.. _c-bson:

====
BSON
====

.. meta::
   :description: Learn how to create, modify, write, and read BSON documents using the C Driver.

.. meta::
   :keywords: document, BSON, JSON

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

Overview
--------

In this guide, you can learn how to create BSON documents, write BSON documents to a file,
and read BSON data from a file by using the {+driver-short+}.

**BSON**, or Binary JSON, is the data format that MongoDB uses to organize
and store data. This data format includes all JSON data structure types and
adds support for types including dates, different size integers, ObjectIds, and
binary data. For a complete list of supported types, see the
:manual:`BSON Types </reference/bson-types>` server manual page.

You can use BSON documents in your {+language+} application by including the
`libbson <{+api-libbson+}>`__ package.

The code samples in this guide use the following BSON document as an example:

.. code-block:: none

   {
       "address" : {
           "street" : "Pizza St", 
           "zipcode" : "10003" 
       },
       "coord" : [-73.982419, 41.579505]
       "cuisine" : "Pizza",
       "name" : "Mongo's Pizza"
   }

Create a BSON Document
----------------------

BSON documents are represented by the ``bson_t`` type in the {+driver-short+}. You can use
the ``BCON_NEW()`` function to create a ``bson_t`` instance. The following
example creates a ``bson_t`` representation of the sample BSON document:

.. literalinclude:: /includes/data-formats/bson.c
   :start-after: // start-create-bson
   :end-before: // end-create-bson
   :language: c
   :dedent:

.. TODO: Update link in admonition below when DBX adds BCON API docs 

.. note:: BSON Field Values

   When creating or appending fields to a BSON document, ensure that you use the appropriate
   ``BCON_*`` function to represent the field values correctly. For a complete list of
   ``BCON_*`` functions, see the :github:`bson-bcon.h file <mongodb/mongo-c-driver/blob/master/src/libbson/src/bson/bson-bcon.h>`
   in the {+driver-short+} GitHub repository.

Append to a BSON Document
-------------------------

You can append field-value pairs to an existing ``bson_t`` instance by using the ``BCON_APPEND()``
function. The following example appends a new ``yearEstablished`` field and value to the sample
BSON document:

.. literalinclude:: /includes/data-formats/bson.c
   :start-after: // start-append-bson
   :end-before: // end-append-bson
   :language: c
   :dedent:

You can also use the ``bson_append_*`` function that corresponds to the data type of the value
to be appended. The following example adds the same field-value pair as the preceding example
by using the ``bson_append_int32()`` function:

.. literalinclude:: /includes/data-formats/bson.c
   :start-after: // start-append-bson-alt
   :end-before: // end-append-bson-alt
   :language: c
   :dedent:

For a complete list of ``bson_append_*`` functions, see `bson_t <{+api-libbson+}/bson_t.html>`__
in the ``libbson`` API documentation.

Write BSON to a File
--------------------

You can use the ``bson_get_data()`` function with the standard {+language+} file I/O library
to write BSON data to a file. The following example writes the sample BSON document to a file
named ``output.bson``:

.. literalinclude:: /includes/data-formats/bson.c
   :start-after: // start-write-bson
   :end-before: // end-write-bson
   :language: c
   :dedent:

Read BSON From a File
---------------------

You can use the ``bson_reader_t`` type to read a sequence of BSON documents from a file,
memory region, or a custom callback. The following example reads BSON documents from a file
named ``example.bson`` and prints the JSON representation of each document:

.. literalinclude:: /includes/data-formats/bson.c
   :start-after: // start-read-bson
   :end-before: // end-read-bson
   :language: c
   :dedent:

Reading JSON From a File
~~~~~~~~~~~~~~~~~~~~~~~~

You can use the ``bson_json_reader_t`` type to read a sequence of JSON documents and
convert them to ``bson_t`` documents. The following example reads JSON documents from a file
named ``example.json``, converts each document to BSON format, and prints the documents:

.. literalinclude:: /includes/data-formats/bson.c
   :start-after: // start-read-json
   :end-before: // end-read-json
   :language: c
   :dedent:

Cleanup
-------

You can free the memory allocated for a BSON document by using the ``bson_destroy()`` function,
as shown in the following example:

.. code-block:: c

   bson_t *doc = BCON_NEW("test", BCON_UTF8("example"));

   // Operations using doc

   bson_destroy(doc);

.. important::

   Always call ``bson_destroy()`` on a ``bson_t`` instance when you are finished with it
   to avoid memory leaks in your application.

API Documentation
-----------------

To learn more about any of the methods or types discussed in this
guide, see the following API documentation:

- `libbson <{+api-libbson+}>`__
- `bson_t <{+api-libbson+}/bson_t.html>`__
- `bson_get_data() <{+api-libbson+}/bson_get_data.html>`__
- `bson_reader_t <{+api-libbson+}/bson_reader_t.html>`__
- `bson_json_reader_t <{+api-libbson+}/bson_json_reader_t.html>`__
- `bson_destroy() <{+api-libbson+}/bson_destroy.html>`__