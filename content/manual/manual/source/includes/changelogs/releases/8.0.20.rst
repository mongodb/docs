.. _8.0.20-changelog:

8.0.20 Changelog
----------------

Sharding
~~~~~~~~

- :issue:`SERVER-106590` moveChunk and movePrimary lock contention
  during critical section

Replication
~~~~~~~~~~~

- :issue:`SERVER-79298` FCBIS should succeed in unhealthy set
- :issue:`SERVER-96495` Choosing sync source across regions doesn't take
  into account which node is primary
- :issue:`SERVER-103123` Update term on startup based on replica set
  config's term
- :issue:`SERVER-115594` Skip acquiring tickets when deleting txn
  coordinator doc

Query
~~~~~

- :issue:`SERVER-104719` $lookup on time-series collection using bounded
  sorter can lead to incorrect uassert
- :issue:`SERVER-110916` Use-after-move in
  targetShardsAndAddMergeCursors()
- :issue:`SERVER-113319` $match pushdown past a renamed field is done
  incorrectly when the expression root is a renamed field path
  expression
- :issue:`SERVER-117865` Deduplicate shardIds when building
  targetedShards

Storage
~~~~~~~

- :issue:`SERVER-108699` Check BSON size in collection validation
- :issue:`WT-12535` Optimize time spent in __wt_update_obsolete_check()
- :issue:`WT-15803` Fix ref not unlocked in error cases

WiredTiger
``````````

- :issue:`WT-12974` Delete unneeded loop in __rec_hs_wrapup()
- :issue:`WT-14034` Fix resolving the prepared key multiple times
  because of reserved updates
- :issue:`WT-14267` test/format assert detects evicting an accessible
  internal page with an active split generation
- :issue:`WT-14750` Failure in __wt_page_inmem: "encountered an illegal
  file format or internal value: 0x0"
- :issue:`WT-14837` Add metric to measure execution time of
  block_first_srch()
- :issue:`WT-15088` Commit may be rolled back after we have logged the
  transaction
- :issue:`WT-15455` Don't skip prepared update pages during cursor walk
- :issue:`WT-15838` Add logging if checkpoint is blocked by eviction for
  more than 1 minute

Build and Packaging
~~~~~~~~~~~~~~~~~~~

:issue:`SERVER-111406` Change Stream breaks on document with top-level
$v

Tools
~~~~~

:issue:`WT-14392` wt utility overwrites passed config when given -m
option

Internals
~~~~~~~~~

- :issue:`SERVER-78841` Make the number of samples per chunk in the
  SamplingBasedInitialSplitPolicy configurable
- :issue:`SERVER-90885` Better error handling for BackupFileCloner
- :issue:`SERVER-92020` Add assumes_balancer_off tag to concurrent tests
  with  ReshardCollectionInProgress error
- :issue:`SERVER-93069` Prevent oplog_replay_on_startup_with_bad_op.js
  from running on Windows
- :issue:`SERVER-94979` Make CheckMetadataConsistency hook don't rely on
  the discovery topology helpers
- :issue:`SERVER-95570` BatchedDeleteStage can sometimes find the record
  it is deleting twice
- :issue:`SERVER-95650` Time-series inserts can use invalid string
  comparator
- :issue:`SERVER-95726` Time-series meta-only delete and update should
  respect control.closed
- :issue:`SERVER-96975` Add SystemOverloaded error category
- :issue:`SERVER-97229` Remove the field name validation in projection
  executor utils
- :issue:`SERVER-97488` Race condition with dropping/re-adding a
  collection and time series can yield incorrect query results
- :issue:`SERVER-97900` Prevent getMore in tests running in implicit
  moveCollection suites
- :issue:`SERVER-98918` Ensure correct size parameter for array new
  operator
- :issue:`SERVER-99349` $fill throws an error implying duplicate values
  when there are none
- :issue:`SERVER-99623` High CPU usage in range deleter service
- :issue:`SERVER-99743` Tag multi_statement_transaction_current_op.js
  with requires_getmore
- :issue:`SERVER-100040` Ensure "new Mongo(...)" is connected to the
  node
- :issue:`SERVER-101112` Truncate SBE debug info to fit into
  internalQueryExplainSizeThresholdBytes
- :issue:`SERVER-102822` Add requires_getmore tag on $listClusterCatalog
  jsCore tests
- :issue:`SERVER-103129` Use remote cache on all CI
- :issue:`SERVER-103404` QueryAnalysisCoordinator Invariant Can Be
  Triggered When System Is Very Slow
- :issue:`SERVER-103576` Enable feature flag
- :issue:`SERVER-103790` Extend the FindReplicaSetHostTimeoutMS timeout
  in slow test variants
- :issue:`SERVER-104007` Track delinquent interrupt checks
- :issue:`SERVER-104485` Make WiredTiger Cache Size scaled by percentage
- :issue:`SERVER-104651` Denoise the throw hook
- :issue:`SERVER-104932` Introduce admission rate limiter to mongos
  ingress path
- :issue:`SERVER-104933` Introduce admission rate limiter to mongod
  ingress path
- :issue:`SERVER-104934` Support bypassing the ingress rate limiters
  according to client IP address
- :issue:`SERVER-104975` Check that all chunks have a proper 'history'
  array
- :issue:`SERVER-105047` Query using $or and $ne on sharded collection
  can include orphan documents
- :issue:`SERVER-105312` Add sample based rate limiting to $queryStats
- :issue:`SERVER-105416` Configs should be rejected if they make it
  impossible to elect a Primary
- :issue:`SERVER-105536` Apply code change to ingress rate limiting to
  accumulate exempt stats
- :issue:`SERVER-105662` Server: Reduce the need to request from git
  http endpoint for multiversion gen
- :issue:`SERVER-105743` Introduce new error code for rejecting
  admission in RateLimiter
- :issue:`SERVER-105942` Add logging to ReplicaSetAwareService stepDown
  hook
- :issue:`SERVER-106020` Update ingress request burst size to be
  configured in units of time
- :issue:`SERVER-106247` IngressRequestRateLimiter rejection attempts to
  send a response to fireAndForget commands
- :issue:`SERVER-106854` Timeseries reopen verification function does
  not properly handle meta in different order
- :issue:`SERVER-106858` Unecessary reload of
  IngressRequestRateLimiterBurstCapacitySecs on update
- :issue:`SERVER-106908` Enable ingress request rate limiting by default
- :issue:`SERVER-107093` Test computeHmacWithCtx() with HMAC test
  vectors
- :issue:`SERVER-107098` SessionEstablishmentRateLimiter incorrectly
  updates burst capacity when the rate limit is modified
- :issue:`SERVER-107482` Handle top level StaleConfig errors in
  batch_write_op
- :issue:`SERVER-107546` Dump global WT state if too many write
  conflicts are hit in a row for the same transaction
- :issue:`SERVER-107873` Report number of Queryable Encryption
  collections using each index type in serverStatus
- :issue:`SERVER-108040` Update markFailed to check current step
- :issue:`SERVER-108256` Setting the shard role for secondary namespaces
  should use the proper dbVersion
- :issue:`SERVER-108318` Introduce new error label indicating a failure
  is unconditionally retryable
- :issue:`SERVER-108364` local.replset.minvalid writes are untimestamped
  but may fail if encountering a timestamped entry in the ident
  beforehand
- :issue:`SERVER-108581` Find query remaining time is calculated
  incorrectly in mongos
- :issue:`SERVER-108626` Coverity analysis defect 156320: Uninitialized
  scalar field
- :issue:`SERVER-108945` Handle $elemMatch with empty path under a
  contained $or correctly
- :issue:`SERVER-109033` Coverity analysis defect 152012: Double lock
- :issue:`SERVER-109137` Calculation of expireAt in QueryAnalysisWriter
  can hit integer overflow
- :issue:`SERVER-109213` Increase logging when index bounds are deemed
  invalid
- :issue:`SERVER-109490` Rank fusion tests share collections and search
  indexes, causing flaky tests
- :issue:`SERVER-109515` Disable oidc_e2e_azure_machine tests
- :issue:`SERVER-109541` Coverity analysis defect 149896: Data race
  condition
- :issue:`SERVER-109836` Add BES evergreen variables in Server that are
  currently present in MMS
- :issue:`SERVER-110118` Coverity analysis defect 176650: Using a moved
  object
- :issue:`SERVER-110149` Coverity analysis defect 176559: Using a moved
  object
- :issue:`SERVER-110345` config.rangeDeletions docs for uncompleted
  range deletion tasks could get deleted due to non-exact delete filter
- :issue:`SERVER-110390` Ensure internalInsertMaxBatchSize reports
  correct value in getParameter for v8.0
- :issue:`SERVER-110423` $group can use a distinct scan on a sparse
  index, which hides null/missing results
- :issue:`SERVER-110442` Capture Information about index build durations
- :issue:`SERVER-110480` Add core_analyzer_distro_name to s390x/ppc
  variants
- :issue:`SERVER-110803` $top and $bottom ignore sortBy clause when
  preceeding $sort stage makes it eligible for DISTINCT_SCAN
  optimization
- :issue:`SERVER-110832` OplogWriter should not hold on to session
  through rollbacks
- :issue:`SERVER-110842` commitTimeseriesBucketForBatch and
  commitTimeseriesBucketsAtomically should set the collection catalog
  within the scope of  acquireAndValidateBucketsCollection
- :issue:`SERVER-111058` Fix throw_hook configuration locking
- :issue:`SERVER-111139` Prepend all calls to RateLimiter's token bucket
  with proper mutex acquisition
- :issue:`SERVER-111295` Python code is not getting formatted by Ruff
- :issue:`SERVER-111423` Allow usage of setParameterOnAllHosts in
  stepdown suites
- :issue:`SERVER-111486` $group can still use a distinct scan on a
  sparse index if an alternative index is available
- :issue:`SERVER-111914` Client-based rate limiting exemption
- :issue:`SERVER-111929` Make resharding only skip cloning when it
  doesn't own any chunks
- :issue:`SERVER-112229` backport gitignore for new auto_header tool
- :issue:`SERVER-112529` Temporarily disable external_data_source.js in
  concurrency_compute_mode
- :issue:`SERVER-112849` Fix uassert message in
  change_stream_ensure_resume_token_present_stage.cpp
- :issue:`SERVER-112897` Make
  featureFlagReshardingSkipCloningIfApplicable default to true
- :issue:`SERVER-112933` Escape CheckMetadataConsistency hook assertion
  from running in sharded clusters
- :issue:`SERVER-113136` Make a copy of "forRestore" in
  sharded_backup_restore.js before starting up on the data files
- :issue:`SERVER-113153` Make query multiversion fuzzers on LTS versions
  deterministic
- :issue:`SERVER-113162` Relax rank_fusion_upgrade_downgrade.js
  assertions for afterSecondariesHaveRestarted state
- :issue:`SERVER-113311` IngressRequestRateLimitExceeded errors should
  include NoWritesPerformed error label
- :issue:`SERVER-113348` Remove orphaned files and improve logging for
  selective_backup_restore_e2e.js and
- :issue:`SERVER-113431` Pin copybara to a specific tag
- :issue:`SERVER-113484` Add test suite exclusion for
  timeseries_insert_respect_max_bson_size_too_big
- :issue:`SERVER-113545` Wait for lastCommittedOpTime to be initialized
  after restart in api_version_prepare_txn.js
- :issue:`SERVER-113700` Update copybara to v20251110
- :issue:`SERVER-113838` Allow concurrent oplog resize during async
  oplog sampling
- :issue:`SERVER-113933` [v8.0] Add
  timeseries_user_system_buckets_sharding.js to
  backports_required_for_multiversion
- :issue:`SERVER-113974` Remove import to replsettest.js in
  selective_backup_restore_e2e.js
- :issue:`SERVER-113996` Resharding recipient enters infinite retry loop
  when reshardingOplogApplier fails with retryable error
- :issue:`SERVER-114017` move_primary_setFCV.js test creates database at
  latest FCV instead of downgraded FCV
- :issue:`SERVER-114179` Fix S390X and PPC 8.0 trying to run remote
  execution
- :issue:`SERVER-114217` Extracted folder doesn't match tgz name
- :issue:`SERVER-114337` Index build lastCommittedMillis should be int64
- :issue:`SERVER-114363` Capture index build blocking replication
  metrics
- :issue:`SERVER-114627` Remove use of grpc flag on 8.0
- :issue:`SERVER-114629` Upgrade db-contrib-tool to 2.1.0
- :issue:`SERVER-114770` fix and re-enable clang-tidy task on 8.0
- :issue:`SERVER-114806` Wildcard indexes may consume all memory allowed
  for the index build
- :issue:`SERVER-114935` OplogCapMaintainerThread spams logs during
  shutdown
- :issue:`SERVER-115202` Report oplogMinRetentionHours while async
  sampling is ongoing [8.0 only]
- :issue:`SERVER-115398` Differentiate between steady-state replication
  and startup recovery for lastTimeBetweenCommitOplogAndCommitMillis
- :issue:`SERVER-115917` Set specific Visual Studio and MSVC install
  version
- :issue:`SERVER-115962` Balancer does not make progress when the most
  loaded shard is already balanced within its zones
- :issue:`SERVER-116078` Move AL2 Release Variant from compiling on AWS
  c-series to m-series
- :issue:`SERVER-116113` Write concern integration tests randomly run
  50% of commands, leading to long execution times in some runs
- :issue:`SERVER-116258` Refactor Pipeline maintenance and fetching out
  of ReshardingDonorOplogIterator
- :issue:`SERVER-117012` [v8.0] Enable backward compatibility for
  'compactAnchorPaddingFactor' and 'maxAnchorCompactionSize' fields of
  fleCompactionOptions cluster parameter
- :issue:`SERVER-117128` [8.0] Add min_fcv to
  ddlLockOptimisticRecoveryWaitTimeout
- :issue:`SERVER-117148` Disable no-stringop-overflow for
  message_compressor_test on gcc on v8.0
- :issue:`SERVER-117267` Run a checkpoint and retry when dropIdent fails
  in startup recovery due to dirty data
- :issue:`SERVER-117467` Skip running too_many_fds.js on macOS
- :issue:`SERVER-118428` mongocryptd rejects large messages
- :issue:`SERVER-118712` [v8.0.19] Can not create timeseries 2dsphere
  index with a non-system user
- :issue:`SERVER-119396` Adjust maximum buffer size for ingress network
  messages
- :issue:`SERVER-119546` Remove oldcrypt from 8.0

