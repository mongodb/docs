.. _mcli-atlas-backup-restore-start-cmd:

===================================
mongocli atlas backup restore start
===================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. include:: /includes/styles/corrections.rst

The ``backup restore start`` command restores a deployment using the 
snapshot or point in time of a cluster. You can also restore a 
deployment using the |service| :atlas:`UI
</backup/cloud-backup/restore/>` or :atlas:`API
</reference/api/cloud-backup/restore/create-one-restore-job/>`.

.. _mcli-atlas-backup-restore-start-syntax:

Syntax 
------

.. code-block:: text 

   mongocli atlas backup restore start <restore-job-type>
        --clusterName <cluster-name>
        [ --output|-o json ]
        [ --oplogInc <oplog-Inc> ]
        [ --oplogTs <oplog-timestamp> ]
        [ --pointInTimeUTCMillis <pointInTime-UTC-ms> ]
        [ --profile|-P <profile-name> ]
        [ --projectId <project-ID> ]
        --snapshotId <snapshot-ID>
        [ --targetClusterName <cluster-name> ]
        [ --targetProjectId <project-ID> ]

.. include:: /includes/fact-command-line-help.rst

.. _mcli-atlas-backup-restore-start-args:

Arguments 
---------

.. warning::

   If you create an ``automated`` or ``pointInTime`` restore job,
   |service| **removes all existing data** on the target cluster prior
   to the restore.

Specify the type of restore job with one of the following
arguments:

.. include:: /includes/backup-restore-start-args.rst

.. _mcli-atlas-backup-restore-start-options:

Options 
-------

The options required by or available for the command depend on the type
of restore job:

.. tabs::

   .. tab:: Automated
      :tabid: automated

      .. list-table::
         :header-rows: 1
         :widths: 30 10 50 10

         * - Option 
           - Type 
           - Description 
           - Required? 

         * - ``--clusterName``
           - string
           - Name of the cluster that the job represents.
           - yes

         * - ``--profile``, ``-P``
           - string
           - Name of the profile where the project ID and the 
             |svc-api-key|\s for the project are saved. If omitted, uses
             the {+default-profile+}. To learn more about creating a
             profile, see :ref:`mcli-configure`.
           - no

         * - ``--output``, ``-o``
           - string 
           - .. include:: /includes/extracts/fact-basic-options-output.rst
           - no

         * - ``--projectId``
           - string
           - Unique identifier of the project that contains the 
             cluster. If omitted, uses the project ID in the profile or
             :ref:`environment variable <mcli-env-var>`.
           - no

         * - ``--snapshotId``
           - string
           - Unique identifier of the snapshot to use for restore.
           - yes

         * - ``--targetClusterId``
           - string
           - Unique identifier of the target cluster to restore.
           - yes

         * - ``--targetProjectId``
           - string
           - Unique identifier of the project that contains the 
             destination cluster for the restore job
           - yes

   .. tab:: Continuous Cloud Backup
      :tabid: pit

      .. list-table::
         :header-rows: 1
         :widths: 20 10 60 10

         * - Option 
           - Type 
           - Description 
           - Required? 

         * - ``--clusterName``
           - string
           - Name of the cluster that the job represents.
           - yes

         * - ``--oplogInc``
           - string
           - :atlas:`Oplog </reference/atlas-oplog/index.html>` 
             operation number from which 
             to you want to restore this snapshot. This is the second
             part of an :atlas:`Oplog
             </reference/atlas-oplog/index.html>` timestamp.

             Three conditions apply to this parameter:

             - Enable :atlas:`Continuous Cloud Backup restores </backup/cloud-backup/overview/#continuous-cloud-backups>` on 
               your cluster.
             - Specify ``oplogTs``.
             - Specify either ``oplogTs`` and ``oplogInc`` or
               ``pointInTimeUTCSeconds``, but *not both*.

           - conditional

         * - ``--oplogTs``
           - string
           - |Epoch-time| from which to you want to restore this 
             snapshot. This is the first part of an :atlas:`Oplog
             </reference/atlas-oplog/index.html>` timestamp.

             Three conditions apply to this parameter:

             - Enable :atlas:`Continuous Cloud Backup restores </backup/cloud-backup/overview/#continuous-cloud-backups>` on 
               your cluster.
             - Specify ``oplogInc``.
             - Specify either ``oplogTs`` and ``oplogInc`` or
               ``pointInTimeUTCSeconds``, but *not both*.

           - conditional

         * - ``--output``, ``-o``
           - string 
           - .. include:: /includes/extracts/fact-basic-options-output.rst
           - no

         * - ``--pointInTimeUTCMillis``
           - integer
           - |Epoch-time| from which you want to restore this snapshot.

             Two conditions apply to this parameter:

             - Enable :atlas:`Continuous Cloud Backup restores </backup/cloud-backup/overview/#continuous-cloud-backups>` on 
               your cluster.
             - Specify either ``pointInTimeUTCSeconds`` or ``oplogTs`` 
               and ``oplogInc``, but *not both*.

           - conditional

         * - ``--profile``, ``-P``
           - string
           - Name of the profile where the project ID and the 
             |svc-api-key|\s for the project are saved. If omitted, uses
             the {+default-profile+}. To learn more about creating a
             profile, see :ref:`mcli-configure`.
           - no

         * - ``--projectId``
           - string
           - Unique identifier of the project that contains the 
             cluster. If omitted, uses the project ID in the profile or
             :ref:`environment variable <mcli-env-var>`.
           - no

         * - ``--targetClusterId``
           - string
           - Unique identifier of the target cluster to restore.
           - yes

         * - ``--targetProjectId``
           - string
           - Unique identifier of the project that contains the 
             destination cluster for the restore job.
           - yes

   .. tab:: Downloaded
      :tabid: downloaded

      .. list-table::
         :header-rows: 1
         :widths: 20 10 60 10

         * - Option 
           - Type 
           - Description 
           - Required? 

         * - ``--clusterName``
           - string
           - Name of the cluster that the job represents.
           - yes

         * - ``--output``, ``-o``
           - string 
           - .. include:: /includes/extracts/fact-basic-options-output.rst
           - no

         * - ``--profile``, ``-P``
           - string
           - Name of the profile where the project ID and the 
             |svc-api-key|\s for the project are saved. If omitted, uses
             the {+default-profile+}. To learn more about creating a
             profile, see :ref:`mcli-configure`.
           - no

         * - ``--projectId``
           - string
           - Unique identifier of the project that contains the  
             cluster. If omitted, uses the project ID in the profile or
             :ref:`environment variable <mcli-env-var>`.
           - no

         * - ``--snapshotId``
           - string
           - Unique identifier of the snapshot to use for restore.
           - yes

.. _mcli-atlas-backup-restore-start-output:

Output 
------

The command prints the following fields in |json| format to the terminal
if the command succeeds. If the command returns an error, see
:ref:`Troubleshooting <troubleshooting>` for recommended solutions.

.. tabs::
   
   .. tab:: Automated
      :tabid: automated

      .. list-table::
         :widths: 15 10 75
         :header-rows: 1
         :stub-columns: 1

         * - Name
           - Type
           - Description

         * - ``cancelled``
           - boolean
           - Flag indicating whether the restore job was canceled.

         * - ``createdAt``
           - string
           - |iso8601-time| when |service| created the restore job.

         * - ``deliveryType``
           - string
           - Type of restore job to create. 

         * - ``expired``
           - boolean
           - Flag indicating whether the restore job expired.

         * - ``expiresAt``
           - integer
           - |iso8601-time| when the restore job expires.

         * - ``finishedAt``
           - integer
           - |iso8601-time| when the restore job completed.

         * - ``id``
           - string
           - Unique identifier of the restore job.

         * - ``links``
           - array of objects
           - .. include:: /includes/links-explanation.rst

         * - ``snapshotId``
           - string
           - Unique identifier of the source snapshot ID of the restore 
             job.

         * - | ``target``
             | ``GroupId``
           - string
           - Name of the target |service| project of the restore job.

         * - | ``target``
             | ``ClusterName``
           - string
           - Name of the target |service| cluster to which the restore 
             job restores the snapshot.

         * - ``timestamp``
           - string
           - |iso8601-time| when the snapshot associated to 
             ``snapshotId`` was taken.

   .. tab:: Continuous Cloud Backup
      :tabid: pit

      .. list-table::
         :widths: 15 10 75
         :header-rows: 1
         :stub-columns: 1

         * - Name
           - Type
           - Description

         * - ``cancelled``
           - boolean
           - Flag indicating whether the restore job was canceled.

         * - ``createdAt``
           - string
           - |iso8601-time| when |service| created the restore job.

         * - ``deliveryType``
           - string
           - Type of restore job to create. 

         * - ``expired``
           - boolean
           - Flag indicating whether the restore job expired.

         * - ``expiresAt``
           - integer
           - |iso8601-time| when the restore job expires.

         * - ``finishedAt``
           - integer
           - |iso8601-time| when the restore job completed.

         * - ``id``
           - string
           - Unique identifier of the restore job.

         * - ``links``
           - array of objects
           - .. include:: /includes/links-explanation.rst

         * - ``oplogTs``
           - integer
           - |Epoch-time| from which to you want to restore this 
             snapshot.
             This is the first part of an :atlas:`Oplog </reference/atlas-oplog/index.html>`
             timestamp. Returned when ``"oplogTs" > 0``.

         * - ``oplogInc``
           - integer
           - :atlas:`Oplog </reference/atlas-oplog/index.html>` 
             operation number from which to
             you want to restore this snapshot. This is the second part
             of an :atlas:`Oplog </reference/atlas-oplog/index.html>`
             timestamp. Returned when ``"oplogTs" > 0``.

         * - | ``pointInTime``
             | ``UTCSeconds``
           - integer
           - |Epoch-time| from which |service| restored this snapshot.
             Returned when ``"pointInTimeUTCSeconds" > 0``.

         * - | ``target``
             | ``GroupId``
           - string
           - Name of the target |service| project of the restore job.

         * - | ``target``
             | ``ClusterName``
           - string
           - Name of the target |service| cluster to which the restore 
             job restores the snapshot.

         * - ``timestamp``
           - string
           - |iso8601-time| when the snapshot associated to 
             ``snapshotId`` was taken.

   .. tab:: Downloaded
      :tabid: downloaded

      .. list-table::
         :widths: 15 10 75
         :header-rows: 1
         :stub-columns: 1

         * - Name
           - Type
           - Description

         * - ``cancelled``
           - boolean
           - Flag indicating whether the restore job was canceled.

         * - ``createdAt``
           - string
           - |iso8601-time| when |service| created the restore job.

         * - ``deliveryType``
           - string
           - Type of restore job to create.

         * - ``deliveryUrl``
           - array of strings
           - One or more |url|\s for the compressed snapshot files for 
             manual download. Returned when ``"deliveryType" :
             "download"``.

             .. note::

                If empty, |service| is processing the restore job. Use
                the
                :atlas:`/reference/api/cloud-backup/restore/get-all-restore-jobs`
                endpoint periodically check for a ``deliveryUrl``
                download value for the restore job.

         * - ``expired``
           - boolean
           - Flag indicating whether the restore job expired.

         * - ``expiresAt``
           - integer
           - |iso8601-time| when the restore job expires.

         * - ``finishedAt``
           - integer
           - |iso8601-time| when the restore job completed.

         * - ``id``
           - string
           - Unique identifier of the restore job.

         * - ``links``
           - array of objects
           - .. include:: /includes/links-explanation.rst

         * - ``snapshotId``
           - string
           - Unique identifier of the source snapshot ID of the restore 
             job.

         * - ``timestamp``
           - string
           - |iso8601-time| when the snapshot associated to 
             ``snapshotId`` was taken.


.. _mcli-atlas-backup-restore-start-eg:

Example
-------

.. tabs::

   .. tab:: Automated
      :tabid: automated

      The following example uses the ``mongocli atlas backup restore
      start automated`` command to restore a deployment. The command
      uses the {+default-profile+} where the project ID and the
      |svc-api-key|\s for the source cluster are stored.

      .. code-block:: sh 

         mongocli atlas backup restore start automated \
                  --clusterName myDemo \
                  --snapshotId 5e7e00128f8ce03996a47179 \
                  --targetClusterId 5e2f56937a3e5a26326a5ee8 \
                  --targetProjectId 1a2345b67c8e9a12f3456de7

      The previous command prints the following fields to the terminal.
      To learn more about these fields, see
      :ref:`mcli-atlas-backup-restore-start-output`. 
      
      .. code-block:: json
         :copyable: false

         {
           "cancelled": false,
           "deliveryType": "automated",
           "expired": false,
           "expiresAt": "2020-05-04T16:25:01Z",
           "id": "5e7e207f6b77fc028bee5e2d",
           "links": [
             {
               "href": "https://example.mongodb.com/api/atlas/v1.0/groups/5e3f04ecf10fab66c7d4072d/clusters/myCluster/backup/restoreJobs/5e7e207f6b77fc028bee5e2d",
               "rel": "self"
             },
             {
               "href": "https://example.mongodb.com/api/atlas/v1.0/groups/5e3f04ecf10fab66c7d4072d/clusters/myCluster/backup/snapshots/5e7e00128f8ce03996a47179",
               "rel": "http://example.mongodb.com/snapshot"
             },
             {
               "href": "https://example.mongodb.com/api/atlas/v1.0/groups/5e3f04ecf10fab66c7d4072d/clusters/myCluster",
               "rel": "http://example.mongodb.com/cluster"
             },
             {
               "href": "https://example.mongodb.com/api/atlas/v1.0/groups/5e3f04ecf10fab66c7d4072d",
               "rel": "http://example.mongodb.com/group"
             }
           ],
           "snapshotId": "5e7e00128f8ce03996a47179",
           "targetClusterName": "Cluster1",
           "targetGroupId": "1a2345b67c8e9a12f3456de7",
           "timestamp": "2020-05-03T16:25:01Z"
         }

   .. tab:: Continuous Cloud Backup
      :tabid: pit

      The following example uses the ``mongocli atlas backup restore
      start download`` command to restore a deployment. The command
      uses the {+default-profile+} where the project ID and the
      |svc-api-key|\s for the source cluster are stored.

      .. code-block:: sh 
         
         mongocli atlas backup restore start pointInTime \
                  --clusterName myDemo \
                  --pointInTimeUTCMillis 1588523147 \
                  --targetClusterId 5e2f56937a3e5a26326a5ee8 \
                  --targetProjectId 1a2345b67c8e9a12f3456de7

      The previous command prints the following fields to the terminal.
      To learn more about these fields, see
      :ref:`mcli-atlas-backup-restore-start-output`. 
      
      .. code-block:: json
         :copyable: false

         {
           "cancelled": false,
           "deliveryType": "download",
           "expired": false,
           "expiresAt": "2020-05-04T16:25:01Z",
           "id": "5e7e207f6b77fc028bee5e2d",
           "links": [
             {
               "href": "https://example.mongodb.com/api/atlas/v1.0/groups/5e3f04ecf10fab66c7d4072d/clusters/myCluster/backup/restoreJobs/5e7e207f6b77fc028bee5e2d",
               "rel": "self"
             },
             {
               "href": "https://example.mongodb.com/api/atlas/v1.0/groups/5e3f04ecf10fab66c7d4072d/clusters/myCluster/backup/snapshots/5e7e00128f8ce03996a47179",
               "rel": "http://example.mongodb.com/snapshot"
             },
             {
               "href": "https://example.mongodb.com/api/atlas/v1.0/groups/5e3f04ecf10fab66c7d4072d/clusters/myCluster",
               "rel": "http://example.mongodb.com/cluster"
             },
             {
               "href": "https://example.mongodb.com/api/atlas/v1.0/groups/5e3f04ecf10fab66c7d4072d",
               "rel": "http://example.mongodb.com/group"
             }
           ],
           "pointInTimeUTCSeconds" : 1588523147,
           "targetClusterName": "Cluster1",
           "targetGroupId": "1a2345b67c8e9a12f3456de7",
           "timestamp": "2020-05-03T16:25:01Z"
         }
       
   .. tab:: Downloaded
      :tabid: downloaded

      The following example uses the ``mongocli atlas backup restore
      start pointInTime`` command to restore a deployment. The command
      uses the {+default-profile+} where the project ID and the
      |svc-api-key|\s for the source cluster are stored.

      .. code-block:: sh 
         
         mongocli atlas backup restore start download \
                  --clusterName myDemo \
                  --snapshotId 5e7e00128f8ce03996a47179 

      The previous command prints the following fields to the
      terminal. To learn more about these fields, see
      :ref:`mcli-atlas-backup-restore-start-output`.
       
      .. code-block:: json
         :copyable: false

         {
           "cancelled": false,
           "deliveryType": "download",
           "expired": false,
           "expiresAt": "2020-05-04T16:25:01Z",
           "id": "5e7e207f6b77fc028bee5e2d",
           "links": [
             {
               "href": "https://example.mongodb.com/api/atlas/v1.0/groups/5e3f04ecf10fab66c7d4072d/clusters/myDemo/backup/restoreJobs/5e7e207f6b77fc028bee5e2d",
               "rel": "self"
             },
             {
               "href": "https://example.mongodb.com/api/atlas/v1.0/groups/5e3f04ecf10fab66c7d4072d/clusters/myDemo/backup/snapshots/5e7e00128f8ce03996a47179",
               "rel": "http://example.mongodb.com/snapshot"
             },
             {
               "href": "https://example.mongodb.com/api/atlas/v1.0/groups/5e3f04ecf10fab66c7d4072d/clusters/myDemo",
               "rel": "http://example.mongodb.com/cluster"
             },
             {
               "href": "https://example.mongodb.com/api/atlas/v1.0/groups/5e3f04ecf10fab66c7d4072d",
               "rel": "http://example.mongodb.com/group"
             }
           ],
           "snapshotId": "5e7e00128f8ce03996a47179",
           "deliveryUrl": "https://example.mongodb.com/backup/restore/v2/pull/5e7e207f6b77fc028bee5e2d/N2UxYTI2MTQwOGI5NGQ3M2FmZWJkMjA5ZjJkYWJjMTE=/myDemo-shard-0-1585315789-5e7e207f6b77fc028bee5e2d.tar.gz",
           "timestamp": "2020-05-03T16:25:01Z"
         }
