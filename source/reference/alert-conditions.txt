.. _alert-conditions:

=======================
Review Alert Conditions
=======================

.. default-domain:: mongodb

.. facet::
   :name: genre
   :values: reference

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: twocols

This page describes the conditions for which you can trigger alerts. 
You specify conditions and thresholds when :doc:`configuring alerts 
</configure-alerts>`. To learn more, see :ref:`alerts-workflow`.

.. include:: /includes/fact-free-shared-alerts.rst

Host Alerts
-----------

The conditions in this section apply if you select :guilabel:`Host` as
the alert target when configuring the alert. You can apply the
condition to all hosts or to specific type of host, such as
:term:`primaries <primary>` or
:term:`config servers <config server>`.

.. important::

   .. include:: /includes/fact-live-migration-host-alerts.rst

{+service+} triggers certain host alerts based on {+cluster+}
monitoring, and are thus subject to variations in granularity. To
learn more, see :ref:`Monitoring Data Storage Granularity
<monitoring-storage-granularity>`.

Advisor
~~~~~~~

.. alert:: Host has index suggestions

   Raised if :ref:`Performance Advisor <performance-advisor>`
   has index suggestions for the host.

   If the :ref:`query targeting ratio <query-targeting-resolution>` for
   a host is greater than 8000 and if Performance Advisor determines
   that the host benefits from one or more indexes to improve
   performance of inefficient queries, this alert triggers and directs
   you to create the suggested indexes. 

   This alert is only available for ``M10+`` clusters, and is enabled
   by default for ``M10+`` clusters that have
   :ref:`Performance Advisor <performance-advisor>` enabled. This alert
   does not trigger for clusters where Performance Advisor is disabled.

Asserts
~~~~~~~

The following alert conditions measure the rate of asserts for a
MongoDB process, as collected from the MongoDB ``serverStatus``
command's :serverstatus:`asserts` document. You can view asserts
through :doc:`cluster monitoring </monitor-cluster-metrics>`.

.. alert:: Asserts: Msg is

   Raised if the rate of message asserts meets the specified
   threshold. Message asserts are internal server errors. Stack traces
   are logged for these.

.. alert:: Asserts: Regular is

   Raised if the rate of regular asserts meets the specified
   threshold.

.. alert:: Asserts: User is

   Raised if the rate of errors generated by users meets the
   specified threshold.

.. alert:: Asserts: Warning is

   Raised if the rate of warnings meets the specified
   threshold.

.. _alert-conditions-autoscaling:

Auto-scaling
~~~~~~~~~~~~

You can configure alerts for the following {+cluster+} events.
:ref:`View the activity feed <view-activity-feed>` to review all
auto-scaling events that occurred.

For each event in this section, to receive alerts, you must first configure
an alert to notify you or members of your organization of this type of
an auto-scaling event.

To learn how |service| scales a {+cluster+} up or down, see :ref:`cluster-autoscaling`.

.. alert:: Auto-scaling: Compute auto-scaling initiated for base tier

   Raised if |service| starts compute auto-scaling for any of the
   :term:`operational nodes <operational node>` in your dedicated {+cluster+}.
   |service| can scale disk capacity as part of this event.

.. alert:: Auto-scaling: Compute auto-scaling initiated for analytics tier

   Raised if |service| starts compute auto-scaling for any of the
   :term:`analytics nodes <analytics node>` in your dedicated {+cluster+}.
   |service| can scale disk capacity as part of this event.

.. alert:: Auto-scaling: Compute auto-scaling down didn't initiate for base tier due to storage requirements

   Raised if |service| couldn't start compute auto-scaling for any of the
   :term:`operational nodes <operational node>` in your dedicated {+cluster+}
   as the configured storage size isn't supported by the target {+cluster+} tier.

.. alert:: Auto-scaling: Compute auto-scaling down didn't initiate for analytics tier due to storage requirements

   Raised if |service| couldn't start compute auto-scaling for any of the
   :term:`analytics nodes <analytics node>` in your dedicated {+cluster+}
   as the configured storage size isn't supported by the target {+cluster+} tier.

.. alert:: Auto-scaling: Compute auto-scaling didn't initiate for base tier due to maximum configured cluster tier

   Raised if |service| couldn't scale up an :term:`operational node <operational node>`
   because your {+cluster+} reached a maximum {+cluster+} tier configured for auto-scaling.

.. alert:: Auto-scaling: Compute auto-scaling didn't initiate for analytics tier due to maximum configured cluster tier

   Raised if |service| couldn't scale up an :term:`analytics node <analytics node>`
   because your {+cluster+} reached a maximum {+cluster+} tier configured
   for auto-scaling.

.. alert:: Auto-scaling: Compute auto-scaling didn't initiate for base tier due to insufficient oplog size

   Raised if |service| couldn't scale up an :term:`operational node <operational node>`
   due to insufficient :term:`oplog` size. To learn more, see :ref:`set-oplog-min-window`.

.. alert:: Auto-scaling: Compute auto-scaling didn't initiate for analytics tier due to insufficient oplog size

   Raised if |service| couldn't scale up an :term:`analytics node <analytics node>`
   due to insufficient :term:`oplog` size. To learn more, see :ref:`set-oplog-min-window`.

.. alert:: Auto-scaling: Disk auto-scaling initiated

   Raised if |service| starts auto-scaling disk capacity.

.. alert:: Auto-scaling: Disk auto-scaling didn't initiate due to the cluster reaching maximum available disk size

   Raised if |service| couldn't scale up the disk size because the {+cluster+}
   has reached maximum available disk size.

.. alert:: Auto-scaling: Disk auto-scaling didn't initiate due to insufficient oplog size

   Raised if |service| couldn't scale up the disk size because the {+cluster+}\'s
   :term:`oplog` size isn't sufficient.

.. _alert-conditions-atlas-search:

|fts|
~~~~~~~~~~~~

The following alert conditions measure the amount of CPU and memory
used by |fts| processes. You can view |fts| metrics through
:ref:`cluster monitoring <review-atlas-search-metrics>`.

.. alert:: Atlas Search: Index Replication Lag is

   Raised if the approximate number of milliseconds that |fts| 
   is behind in replicating changes from the :term:`oplog` of |mongod| is above 
   or below the threshold.

.. alert:: Atlas Search: Index Size on Disk is

   Raised if the total size of all |fts| indexes on disk in 
   bytes is above or below the threshold.

.. alert:: Atlas Search: Max Number of Lucene Docs is

   Raised if the upper bound on the number of Lucene docs used
   to store |fts| indexes for a given replica set or shard is above the 
   threshold.

.. alert:: Atlas Search: Mongot stopped replication

   Raised on dedicated search nodes if the replication is interrupted by
   the |fts| ``mongot`` process due to high disk utilization. 

.. alert:: Atlas Search: Number of Error Queries is

   Raised if the number of queries for which |fts| is unable to 
   return a response is above or below the threshold.

.. alert:: Atlas Search: Number of Index Fields is

   Raised if the total number of unique fields present in the
   |fts| index is above or below the threshold.

.. alert:: Atlas Search: Number of Successful Queries is

   Raised if the number of queries for which |fts| successfully 
   returned a response is above or below the threshold.

.. alert:: Atlas Search: Total Number of Queries is

   Raised if the number of queries submitted to |fts| is above 
   or below the threshold.

.. alert:: Atlas Search Opcounter: Delete is

   Raised if the total number of documents or fields 
   (specified in the index definition) removed per second is above or 
   below the threshold.

.. alert:: Atlas Search Opcounter: Getmore is

   Raised if the total number of ``getmore`` commands run on 
   all |fts| queries per second is above or below the threshold.

.. alert:: Atlas Search Opcounter: Insert is

   Raised if the total number of documents or fields 
   (specified in the index definition) that |fts| indexes per second is 
   above or below the threshold.

.. alert:: Atlas Search Opcounter: Update is

   Raised if the total number of documents or fields 
   (specified in the index definition) that |fts| updates per second is 
   above or below the threshold.

.. alert:: Insufficient disk space to support rebuilding search indexes

   Raised if your {+database-deployment+} runs out of enough 
   free disk space to support your |fts| indexes.

.. alert:: Search Memory: Resident is

   Raised if the total bytes of resident memory occupied by the
   |fts| process is above or below the threshold.

.. alert:: Search Memory: Shared is

   Raised if the total bytes of shared memory occupied by the
   |fts| process is above or below the threshold.

.. alert:: Search Memory: Virtual is

   Raised if the total bytes of virtual memory occupied by the
   |fts| process is above or below the threshold.

.. alert:: Search Process: CPU (Kernel) % is

   Raised if the percentage of time the CPU spent servicing
   operating system calls for the |fts| process is above the threshold.

.. alert:: Search Process: CPU (User) % is

   Raised if the percentage of time the CPU spent servicing the
   |fts| process is above the threshold.

.. alert:: Search Process: Disk space used is

   Raised if the total bytes of disk space used by the |fts|
   process is above the threshold.

   .. note::

      If you apply the condition to all hosts, it applies to 
      :ref:`dedicated Search Nodes <what-is-search-node>` as well.

.. alert:: Search Process: Ran out of memory

   Raised if the search process (``mongot``) runs out of 
   memory. If the search process runs out of memory, indexing and 
   queries fail.

Average Execution Time
~~~~~~~~~~~~~~~~~~~~~~

The following alert conditions measure the average execution time of
reads, writes, or commands for a MongoDB process, as collected from the
MongoDB ``serverStatus`` command's :serverstatus:`opLatencies`
document. You can view asserts through
:doc:`cluster monitoring </monitor-cluster-metrics>`.

.. alert:: Average Execution Time: Commands is

   Average execution time for command operations meets your specified
   threshold.

.. alert:: Average Execution Time: Reads is

   Average execution time for read operations meets your specified
   threshold.

.. alert:: Average Execution Time: Writes is

   Average execution time for write operations meets your specified
   threshold.

Cache Ratio
~~~~~~~~~~~

The following alert conditions measure the cache fill ratio 
and dirty fill ratio for a MongoDB process, as collected from the 
MongoDB ``serverStatus`` command's :serverstatus:`wiredTiger.cache` document. 
You can view these metrics on the |service| :guilabel:`Cache Fill Ratio` chart, 
accessed through :ref:`cluster monitoring <review-available-metrics>`.

.. alert:: Cache: Fill Ratio is... 

   Raised if the percentage of bytes in the cache relative to the total cache 
   size meets the specified threshold.

.. alert:: Cache: Dirty Fill Ratio is... 

   Raised if the percentage of dirty bytes relative to the total cache size
   meets the specified threshold.

Disk Throughput
~~~~~~~~~~~~~~~

The following alert conditions measure the disk read and write
throughput for a MongoDB process. You
can view these metrics on the |service| :guilabel:`Disk Throughput`
chart, accessed through :ref:`cluster monitoring <review-available-metrics>`.

.. alert:: Disk read throughput is... 

   Raised if the rate at which data is read
   from disk in Megabytes per second meets the specified threshold.

.. alert:: Disk write throughput is... 

   Raised if the rate at which data is written to disk in
   Megabytes per second meets the specified threshold.

Opcounter
~~~~~~~~~

The following alert conditions measure the rate of database operations
on a MongoDB process since the process last started, as collected from
the MongoDB ``serverStatus`` command's :serverstatus:`opcounters`
document. You can view opcounters through
:doc:`cluster monitoring </monitor-cluster-metrics>`.

.. alert:: Opcounter: Cmd is

   Raised if the rate of commands performed meets the specified
   threshold.

.. alert:: Opcounter: Delete is

   Raised if the rate of deletes meets the specified threshold.

.. alert:: Opcounter: Getmores is

   Raised if the rate of ``getmore`` operations to retrieve the
   next cursor batch meets the specified threshold.

   .. seealso::

      To learn more, see
      :manual:`Cursor Batches </core/cursors/#cursor-batches>` in the
      MongoDB manual.

.. alert:: Opcounter: Insert is

   Raised if the rate of inserts meets the specified threshold.

.. alert:: Opcounter: Query is

   Raised if the rate of queries meets the specified threshold.

.. alert:: Opcounter: Update is

   Raised if the rate of updates meets the specified threshold.

Opcounter - Repl
~~~~~~~~~~~~~~~~

The following alert conditions measure the rate of database operations
on MongoDB :term:`secondaries <secondary>`, as collected from the
MongoDB ``serverStatus`` command's :serverstatus:`opcountersRepl`
document. You can view these metrics on the
:guilabel:`Opcounters - Repl` chart, accessed through
:doc:`cluster monitoring </monitor-cluster-metrics>`.

.. alert:: Opcounter: Repl Cmd is

   Raised if the rate of replicated commands meets the
   specified threshold.

.. alert:: Opcounter: Repl Delete is

   Raised if the rate of replicated deletes meets the specified
   threshold.

.. alert:: Opcounter: Repl Insert is

   Raised if the rate of replicated inserts meets the specified
   threshold.

.. alert:: Opcounter: Repl Update is

   Raised if the rate of replicated updates meets the specified
   threshold.

Operations Scan and Order
~~~~~~~~~~~~~~~~~~~~~~~~~

You might set alerts for the scan and order operations for a MongoDB
process.

.. alert:: Operations: Scan and Order is
   
   Average rate per second over your specified threshold of queries 
   that return sorted results that can't perform the sort operation 
   using an index.

   .. note:: How It's Measured

      MongoDB reports on the Replication Oplog using the
      ``metrics.operation.scanAndOrder`` document that the
      :manual:`serverStatus </reference/command/serverStatus>`
      command returns.

Atlas {+Free-Clusters+}
~~~~~~~~~~~~~~~~~~~~~~~

.. alert:: Logical Size is

   Raised if the total size of the data and indexes is outside
   the specified threshold.

   *Applicable for Atlas {+Free-Clusters+} Only*

Memory
~~~~~~

The following alert conditions measure memory for a MongoDB process, as
collected from the MongoDB ``serverStatus`` command's
:serverstatus:`mem` document. You can view these metrics on the
|service| :guilabel:`Memory` and :guilabel:`Non-Mapped Virtual Memory`
charts, accessed through :doc:`cluster monitoring </monitor-cluster-metrics>`.

.. alert:: Memory: Computed is

   Raised if the size of virtual memory that is not accounted
   for by memory-mapping meets the specified threshold. If this number
   is very high (multiple gigabytes), it indicates that excessive
   memory is being used outside of memory mapping.

   .. seealso::

      To learn how to use this metric, view the
      :guilabel:`Non-Mapped Virtual Memory` chart and click the
      chart's :guilabel:`i` icon.

.. alert:: Memory: Resident is

   Raised if the size of the resident memory meets the
   specified threshold. It is typical over time, on a dedicated
   database server, for the size of the resident memory to approach the
   amount of physical RAM on the box.

.. alert:: Memory: Virtual is

   Raised if the size of virtual memory for the |mongod|
   process meets the specified threshold. You can use this alert to
   flag excessive memory outside of memory mapping.

   .. seealso::

      To learn more, click the :guilabel:`Memory` chart's
      :guilabel:`i` icon.

.. alert:: System Memory: Available is

   Raised if the amount of available system memory drops below
   the specified threshold.
   
.. alert:: System Memory: Max Available is

   Raised if the maximum amount of available system memory 
   drops below the specified threshold.

.. alert:: System Memory: Max Used is

   Raised if the maximum system memory usage value meets the 
   specified threshold.

.. alert:: System Memory: Used is

   Raised if the total system memory used minus buffers, 
   cached, and free memory meets the specified threshold.

.. _alert-conditions-connections:

Connections
~~~~~~~~~~~

The following alert condition measures connections to a MongoDB
process, as collected from the MongoDB ``serverStatus`` command's
:serverstatus:`connections` document. You can view this metric on the
|service| :guilabel:`Connections` chart, accessed through :doc:`cluster
monitoring </monitor-cluster-metrics>`.

.. alert:: Connections is

   Raised if the number of active connections to the host meets
   the specified average.

.. alert:: Connections % of configured limit is

   Raised if the number of open connections to the host exceeds
   the specified percentage.

.. _queues:

Queues
~~~~~~

The following alert conditions measure operations waiting on locks, as
collected from the MongoDB ``serverStatus`` command's
:serverstatus:`globalLock` document. You can view these metrics on the
|service| :guilabel:`Queues` chart, accessed through :doc:`cluster monitoring
</monitor-cluster-metrics>`.

.. alert:: Queues: Readers is

   Raised if the number of operations waiting on a :term:`read
   lock` meets the specified average.

.. alert:: Queues: Total is

   Raised if the number of operations waiting on a
   :term:`lock` of any type meets the specified average.

.. alert:: Queues: Writers is

   Raised if the number of operations waiting on a :term:`write
   lock` meets the specified average.

Page Faults
~~~~~~~~~~~

The following alert condition measures the rate of page faults for a
MongoDB process, as collected from the MongoDB ``serverStatus``
command's :serverstatus:`extra_info.page_faults` field.

.. alert:: Page Faults is

   Raised if the rate of page faults (whether or not an
   exception is thrown) meets the specified threshold. You can view
   this metric on the |service| :guilabel:`Page Faults` chart, accessed
   through :doc:`cluster monitoring </monitor-cluster-metrics>`.

Cursors
~~~~~~~

The following alert conditions measure the number of
:manual:`cursors </core/cursors>` for a MongoDB process, as collected
from the MongoDB ``serverStatus`` command's
:serverstatus:`metrics.cursor` document. You can view these metrics on
the |service| :guilabel:`Cursors` chart, accessed through
:doc:`cluster monitoring </monitor-cluster-metrics>`.

.. alert:: Cursors: Open is

   Raised if the number of cursors the server is maintaining
   for clients meets the specified average.

.. alert:: Cursors: Timed Out is

   Raised if the number of timed-out cursors the server is
   maintaining for clients meets the specified average.

Network
~~~~~~~

The following alert conditions measure throughput for MongoDB process,
as collected from the MongoDB ``serverStatus`` command's
:serverstatus:`network` document. You can view these metrics on a
host's :guilabel:`Network` chart, accessed through :doc:`cluster
monitoring </monitor-cluster-metrics>`.

.. alert:: Network: Bytes In is

   Raised if the number of bytes sent *to* MongoDB meets the
   specified threshold.

.. alert:: Network: Bytes Out is

   Raised if the number of bytes sent *from* MongoDB meets the
   specified threshold.

.. alert:: Network: Num Requests is

   Raised if the number of requests sent to MongoDB meets the
   specified average.

Replication Oplog
~~~~~~~~~~~~~~~~~

The following alert conditions apply to the MongoDB process's
:manual:`oplog </core/replica-set-oplog>`. You can view these metrics
on the following charts, accessed through
:doc:`cluster monitoring </monitor-cluster-metrics>`:

- :guilabel:`Oplog GB/Hour`
- :guilabel:`Replication Headroom`
- :guilabel:`Replication Lag`
- :guilabel:`Replication Oplog Window`

The following alert conditions apply to the oplog:

.. alert:: Oplog Data Per Hour is

   Raised when the amount of data per hour being written to a
   primary's oplog meets the specified threshold.

.. alert:: Replication Headroom is

   Raised when the difference between the sync source member's
   oplog window and the replication lag time on the secondary meets the
   specified threshold.

.. alert:: Replication Lag is

   Raised if the approximate amount of time that the
   :term:`secondary` is behind the primary meets the specified
   threshold. |service| calculates replication lag using the approach
   described in
   :ref:`Check the Replication Lag <replica-set-replication-lag>` in
   the MongoDB manual.

.. alert:: Replication Oplog Window is

   Raised if the approximate amount of time available in the
   :term:`primary's <primary>` replication :term:`oplog` meets the
   specified threshold.

.. _db-storage-alerts:

DB Storage
~~~~~~~~~~

The following alert conditions apply to database storage, as collected
for a MongoDB process by the MongoDB
:manual:`dbStats </reference/command/dbStats>` command. For details on
how |service| handles reaching database storage limits, refer to the
:ref:`FAQ page <faq-storage limit>`. These conditions are based on the
summed total of **all databases** on the MongoDB process:

.. note::

   .. include:: /includes/fact-db-stats-collection-interval.rst

.. alert:: DB Data Size is

    Raised if approximate size of all documents (and their
    paddings) meets the specified threshold.

.. alert:: DB Storage is

   Raised if the allocated storage meets the specified
   threshold. This alert condition can be viewed on a host's
   :guilabel:`DB Storage` chart, accessed through
   :doc:`cluster monitoring </monitor-cluster-metrics>`.

.. _wt-storage-engine:

WiredTiger Storage Engine
~~~~~~~~~~~~~~~~~~~~~~~~~

The following alert conditions apply to the MongoDB process's
:manual:`WiredTiger </core/wiredtiger>` storage engine, as collected
from the MongoDB ``serverStatus`` command's
:serverstatus:`wiredTiger.cache` and
:serverstatus:`queues.execution` documents.

You can view these metrics on the following charts, accessed through
:doc:`cluster monitoring </monitor-cluster-metrics>`:

- :guilabel:`Cache Activity`
- :guilabel:`Cache Usage`
- :guilabel:`Tickets Available`

The following are the alert conditions that apply to WiredTiger:

.. alert:: Cache: Bytes Read Into Cache is

   Raised when the number of bytes read into the WiredTiger
   cache meets the specified threshold.

.. alert:: Cache: Bytes Written From Cache is

   Raised when the number of bytes written from the WiredTiger
   cache meets the specified threshold.

.. alert:: Cache: Dirty Bytes is

   Raised when the number of dirty bytes in the WiredTiger
   cache meets the specified threshold.

.. alert:: Cache: Used Bytes is

   Raised when the number of used bytes in the WiredTiger cache
   meets the specified threshold.

.. alert:: Tickets Available: Reads is

   Raised if the number of read tickets available to the
   WiredTiger storage engine meet the specified threshold.

.. alert:: Tickets Available: Writes is

   Raised if the number of write tickets available to the
   WiredTiger storage engine meet the specified threshold.

.. include:: /includes/fact-tickets.rst

.. _system-disk-alerts:

System and Disk Alerts
~~~~~~~~~~~~~~~~~~~~~~

The following alert conditions measure usage on your |service| server
clusters:

.. note::

   Currently, |service| uses a single partition for data, index, and 
   journal files. Even though the alerts reference individual 
   paritions, they point to the same metric.

.. include:: includes/burst-metrics.rst

.. alert:: Disk Queue depth on Data Partition is

   Raised if the average length of the queue of requests issued 
   to the data partition that MongoDB uses exceeds the specified 
   threshold.

.. alert:: Disk read IOPS on Data Partition is

   Raised if the average number of disk read operations per
   second exceeds the specified threshold.

.. alert:: Disk read latency on Data Partition is

   Raised if the amount of latency on disk read operations
   exceeds the specified threshold.

.. alert:: Disk space % used on Data Partition is

   The percentage of disk space used on any partition that contains the
   MongoDB collection's data.

   To find possible solutions for this alert, see
   :doc:`Alert Resolutions </reference/alert-resolutions/disk-space-used>`.

.. alert:: Disk write IOPS on Data Partition is

   Raised if the average number of disk write operations per
   second exceeds the specified threshold.

.. alert:: Disk write latency on Data Partition is

   Raised if the amount of latency on disk write operations
   exceeds the specified threshold.

.. alert:: Max disk queue depth on Data Partition is

   Raised if the maximum average length of the queue of 
   requests issued to the data partition that MongoDB uses exceeds the 
   specified threshold.

.. alert:: Max disk read IOPS on Data Partition is

   Raised if the maximum average number of disk read operations 
   per second exceeds the specified threshold.

.. alert:: Max disk read latency on Data Partition is

   Raised if the maximum amount of latency on disk read 
   operations exceeds the specified threshold.

.. alert:: Max disk space % used on Data Partition is

   Raised if the maximum percentage of disk space used on any 
   partition that contains the MongoDB collection's data exceeds the 
   specified threshold.

.. alert:: Max disk write IOPS on Data Partition is

   Raised if the maximum average number of disk write 
   operations per second exceeds the specified threshold.

.. alert:: Max disk write latency on Data Partition is

   Raised if the maximum amount of latency on disk write 
   operations exceeds the specified threshold.

.. alert:: Max System Network In is

   Raised if the maximum number of bytes sent *to* MongoDB 
   meets the specified threshold.

.. alert:: Max System Network Out is

   Raised if the maximum number of bytes sent *from* MongoDB 
   meets the specified threshold.

.. alert:: System: CPU (Steal) % is

   *Applicable when the EC2 cluster credit balance is exhausted.*

   The percentage by which the CPU usage exceeds the guaranteed
   baseline CPU credit accumulation rate. CPU credits are units of CPU
   utilization that you accumulate. The credits accumulate at a
   constant rate to provide a guaranteed level of performance. These
   credits can be used for additional CPU performance. When the credit
   balance is exhausted, only the guaranteed baseline of CPU
   performance is provided, and the amount of excess is shown as steal
   percent.

   .. note::

      |service| triggers this alert only for AWS EC2 clusters that
      support :aws:`Burstable Performance </AWSEC2/latest/UserGuide/burstable-performance-instances.html>`.
      Currently, these are ``M10`` and ``M20`` cluster types.

.. alert:: System: CPU (User) % is

   The CPU usage of the processes on the node, normalized by the number
   of CPUs. This value is scaled to a range of 0-100%.

.. alert:: System: Max CPU (Steal) % is

   Raised if the maximum percentage by which the CPU usage 
   exceeds the guaranteed baseline CPU credit accumulation rate exceeds 
   the specified threshold.

.. alert:: System: Max CPU (User) % is

   Raised if the maximum CPU usage of the processes on the node, 
   normalized by the number of CPUs, exceeds the specified threshold.

.. alert:: System Network In is

   Raised if the average rate of physical bytes received per
   second by the ``eth0`` network interface reaches the specified
   threshold.

.. alert:: System Network Out is

   Raised if the average rate of physical bytes transmitted per
   second by the ``eth0`` network interface reaches the specified 
   threshold.

Restarts
~~~~~~~~

.. alert:: Restarts in Last Hour is

   Raised if the number of times a host restarts within the
   previous hour exceeds the specified threshold.

Host Down
~~~~~~~~~

.. alert:: Host is Down
   
   Raised if |service| is unable to reach a host for several
   minutes.

   .. important::

      You should only configure this alert if you depend on secondary
      reads. For more information on secondary reads, see
      :ref:`replica-set-tags` and :ref:`replica-set-read-preference`.

   This alert is generally triggered by one of the following
   conditions:

   - The cluster has experienced a failure and is being auto-healed.
   - The cluster could not be reached because of a network issue.

   |service-fullname| checks that the downtime did not occur because of
   your actions, such as :manual:`rolling index builds
   </tutorial/build-indexes-on-replica-sets/>`. If |service-fullname| confirms
   that the downtime was not intentional, |service-fullname| attempts to replace
   the affected node. If failures occur, |service| clusters maintain node
   availability for both reads and writes as long as a majority of nodes are
   running. To learn more, see :ref:`How does MongoDB Atlas deliver high
   availability? <high-availability>`.

Swap
~~~~

The following alert conditions apply to swap space usage:

.. alert:: Swap Usage: Free is

   Raised if the amount of available swap space drops below the
   specified threshold.

.. alert:: Swap Usage: Max Free is

   Raised if the maximum amount of available swap space drops 
   below the specified threshold.

.. alert:: Swap Usage: Max Used is

   Raised if the maximum total amount of swap space in use 
   reaches the specified threshold.

.. alert:: Swap Usage: Used is

   Raised if the total amount of swap space in use reaches the 
   specified threshold.

Sort
~~~~

The following alert conditions apply to sort operations:

.. alert:: Sort: Spill to disk during sort is
  
   Raised if the number of writes to disk caused by :pipeline:`$sort` stages
   meets the specified threshold.

Inapplicable Host Conditions
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The following host conditions do not apply to |service|. |service| will
not generate alerts for the following conditions:

- Accesses Not In Memory: Total is

- Background Flush Average is

- B-tree: accesses is

- B-tree: hits is

- B-tree: misses is

- B-tree: miss ratio is

- Cursors: Client Cursors Size is

- Effective Lock % is

- Journaling Commits in Write Lock is

- Journaling MB is

- Journaling Write Data Files MB is

- Memory: Mapped is

- Page Fault Exceptions Thrown: Total is

.. _query-targeting-alerts:

Query Targeting Alerts
----------------------

The following alerts apply to indexes on your collections. Either alert
might indicate a missing or inefficient index.

.. seealso::

   To learn more about indexing to improve performance, see
   :manual:`Indexing Strategies </applications/indexes>`.

.. alert:: Query Targeting: Scanned / Returned

   Raised if the ratio of index keys scanned to documents
   returned meets or exceeds the specified threshold.

.. alert:: Query Targeting: Scanned Objects / Returned

   Raised if the ratio of documents scanned to documents
   returned meets or exceeds the specified threshold.

.. include:: /includes/fact-query-targeting-mongot.rst

Cloud Backup Alerts
-------------------

The following alerts apply to {+Cloud-Backup+} snapshots.

.. alert:: Backup restore failed

   Raised when a restore fails.

.. alert:: Backup restore succeeded

   Raised when a restore succeeds.

.. alert:: Fallback snapshot failed

   Raised when a fallback snapshot fails.

.. alert:: Fallback snapshot taken

   Raised when a regular backup fails, but |service| was able
   to take a fallback snapshot.

   .. seealso::

      :ref:`cps-fallback-snapshots`.

.. alert:: Last snapshot too old

  Raised when too much time has passed since the last successful snapshot.
	   
.. alert:: Snapshot download request failed

   Raised when a download request fails.

.. alert:: Snapshot schedule fell behind

   Raised when a snapshot hasn't been taken over configured
   period.

.. alert:: Snapshot taken successfully

   Raised when a snapshot was taken successfully.

Replica Set Alerts
------------------

The following alert conditions apply to
:term:`replica sets <replica set>`:

.. alert:: Number of elections in last hour is > X

   Raised when the number of elections that have occurred in
   the last hour exceeds the user-specified value of ``X``. The value
   of ``X`` is set when you create the alert. This alert might indicate
   that the cluster's replication is not in a healthy state, as
   evidenced by constant elections.

.. alert:: Replica set elected a new primary

   Raised when a replica set elects a new :term:`primary`.

.. alert:: Replica set has no primary

   Raised when a replica set does not have a :term:`primary`.
   Specifically, when none of the members of a replica set have a
   status of ``PRIMARY``, the alert triggers. For example, this
   condition might arise when a set has an even number of voting members
   resulting in a tie.

   .. include:: /includes/fact-replica-set-no-primary.rst

   To find possible solutions for this alert, see
   :doc:`Alert Resolutions </reference/alert-resolutions/no-primary>`.

Sharded Cluster Alerts
----------------------

The following alert condition applies to
:term:`sharded clusters <sharded cluster>`:

.. alert:: Cluster is missing an active mongos

   Raised if |service| cannot reach any |mongos| for the cluster.

.. app-services-alerts:

{+app-services+} Alerts
-----------------------------

The following alert conditions apply to 
:appservices:`{+atlas-app-services+} </>`.

.. alert:: An overall request rate limit has been hit

   Raised when the number of concurrent requests exceeds the limit. This alert 
   indicates that an app might be making an unexpectedly high number 
   of requests.

.. alert:: Auth Login Fail is

   Raised if the number of failed client login requests per 
   second meets the specified threshold.

.. alert:: Endpoints Compute Time is

   Raised if the HTTPS endpoints :appservices:`compute time 
   </billing/#app-services-compute>` per second meets the 
   specified threshold.

.. alert:: Endpoints Egress Bytes is

   Raised if the HTTPS endpoints :appservices:`data egress 
   </billing/#data-transfer>` bytes per second meets the specified 
   threshold.

.. alert:: Failed Requests - Endpoints is

   Raised if the number of HTTPS endpoints requests that fail 
   per second meets the specified threshold.

.. alert:: Failed Requests - GraphQL is

   Raised if the number of GraphQL requests that fail per 
   second meets the specified threshold. 
   (GraphQL support for {+atlas-app-services+} is deprecated. To learn more, 
   see the :appservices:`{+atlas-app-services+} documentation </migrate-hosting-graphql>`.)

.. alert:: Failed Requests - Overall is

   Raised if the number of total requests that fail per second 
   meets the specified threshold.

.. alert:: Failed Requests - SDK (Functions) is

   Raised if the number of SDK Function requests that fail per 
   second meets the specified threshold.

.. alert:: Failed Requests - Sync is

   Raised if the number of failed :appservices:`Atlas Device Sync 
   </sync/learn/overview/>` requests per second meets the specified 
   threshold.

.. alert:: Failed Requests - Triggers is

   Raised if the number of Triggers requests that fail per 
   second meets the specified threshold.

.. alert:: GraphQL Compute Time is

   Raised if the GraphQL :appservices:`compute time 
   </billing/#app-services-compute>` per second meets the 
   specified threshold.
   (GraphQL support for {+atlas-app-services+} is deprecated. To learn more, 
   see the :appservices:`{+atlas-app-services+} documentation </migrate-hosting-graphql>`.)

.. alert:: GraphQL Egress Bytes is

   Raised if the GraphQL :appservices:`data egress 
   </billing/#data-transfer>` bytes per second meets the 
   specified threshold.
   (GraphQL support for {+atlas-app-services+} is deprecated. To learn more, 
   see the :appservices:`{+atlas-app-services+} documentation </migrate-hosting-graphql>`.)
   
.. alert:: GraphQL Request Duration P95 is

   Raised if the 95th percentile of duration in milliseconds 
   for GraphQL requests meets the specified threshold.
   (GraphQL support for {+atlas-app-services+} is deprecated. To learn more, 
   see the :appservices:`{+atlas-app-services+} documentation </migrate-hosting-graphql>`.)

.. alert:: HTTP Endpoint Request Duration P95 is

   Raised if the 95th percentile of duration in milliseconds 
   for HTTPS endpoint requests meets the specified threshold.

.. alert:: MQL Request Duration P95 is

   Raised if the 95th percentile of duration in milliseconds 
   for MQL requests meets the specified threshold.

.. alert:: Overall Compute Time is

   Raised if the overall :appservices:`compute time 
   </billing/#app-services-compute>` per second meets the 
   specified threshold.

.. alert:: Overall Egress Bytes is

   Raised if the overall :appservices:`data egress 
   </billing/#data-transfer>` bytes per second meets the 
   specified threshold.

.. alert:: SDK Functions Compute Time is

   Raised if the SDK Functions :appservices:`compute time 
   </billing/#app-services-compute>` per second meets the specified 
   threshold.

.. alert:: SDK Functions Egress Bytes is

   Raised if the SDK Functions :appservices:`data egress 
   </billing/#data-transfer>` bytes per second meets the specified 
   threshold.

.. alert:: SDK Functions Request Duration P95 is

   Raised if the 95th percentile of duration in milliseconds 
   for SDK function requests meets the specified threshold.

.. alert:: SDK MQL Compute Time is

   Raised if the SDK MQL :appservices:`compute time 
   </billing/#app-services-compute>` per second meets the 
   specified threshold.

.. alert:: SDK MQL Egress Bytes is

   Raised if the SDK MQL :appservices:`data egress 
   </billing/#data-transfer>` bytes per second meets the 
   specified threshold.

.. alert:: Session Ended - Sync is

   Raised if the number of sessions ended per second during 
   :appservices:`Atlas Device Sync </sync/learn/overview/>` meets the 
   specified threshold.

.. alert:: Sync Client Bootstrap Time is

   Raised if the 95th percentile of the bootstrap time for the 
   :appservices:`Atlas Device Sync </sync/learn/overview/>` client 
   meets the specified threshold.

.. alert:: Sync Client Uploads that failed is

   Raised if the number of uploads that failed per second on the 
   :appservices:`Atlas Device Sync </sync/learn/overview/>` client 
   meets the specified threshold.

.. alert:: Sync Client Uploads that are invalid

   Raised if the number of invalid uploads per second on the 
   :appservices:`Atlas Device Sync </sync/learn/overview/>` client 
   meets the specified threshold.

.. alert:: Sync Current Oplog Lag Sum is

   Raised if the approximate amount of time that the 
   :appservices:`Atlas Device Sync </sync/learn/overview/>` is behind 
   the MongoDB :term:`oplog` meets the specified threshold.

.. alert:: Sync Egress Bytes is

   Raised if the :appservices:`Atlas Device Sync 
   </sync/learn/overview/>` :appservices:`data egress 
   </billing/#data-transfer>` bytes per second meets the 
   specified threshold.

.. alert:: Sync Num Unsyncable Docs % is

   Raised is the number of {+app-services+} 
   :appservices:`unsyncable documents 
   </mongodb/internal-database-usage/#std-label-unsynced-documents>` 
   meets the specified threshold.

.. alert:: Triggers Compute Time is

   Raised if the triggers :appservices:`compute time 
   </billing/#app-services-compute>` per second has meets the 
   specified threshold.

.. alert:: Triggers Current Oplog Lag Sum is

   Raised if the approximate amount of time that the 
   {+app-services+} triggers is behind the MongoDB :term:`oplog` meets 
   the specified threshold.

.. alert:: Triggers Egress Bytes is

   Raised if the triggers :appservices:`data egress 
   </billing/#data-transfer>` bytes per second meets the specified 
   threshold.

.. alert:: Triggers Request Duration P95 is

   Raised if the 95th percentile of duration in milliseconds 
   for triggers meets the specified threshold.

.. _serverless-alerts:

Serverless Alerts
-----------------

The following alert conditions apply to
:term:`{+Serverless-instances+} <deployment>`:

- :alert:`Connections is`

- :alert:`Connections % of configured limit is`

- :alert:`DB Data Size is`

- :alert:`Network: Bytes In is`

- :alert:`Network: Bytes Out is`

- :alert:`Network: Num Requests is`

- :alert:`Opcounter: Cmd is`

- :alert:`Opcounter: Delete is`

- :alert:`Opcounter: Getmores is`

- :alert:`Opcounter: Insert is`

- :alert:`Opcounter: Query is`

- :alert:`Opcounter: Update is`

.. alert:: Serverless metric outside threshold

   Raised if any of the following conditions apply:

   - The number of open connections to the host exceeds 80% of the 
     total open connections allowed.

   - The approximate size of all documents (and their paddings) and the 
     index exceeds 0.75 terabytes.
   
   - The read processing units (RPUs) per second exceeds 250K for 30 
     minutes or more and realerts every 12 hours.
     
   - The read processing units (RPUs) per second 
     exceeds 1 million for 5 minutes or more and realerts every 2 
     hours.  

.. alert:: Total Read Units is

   Raised if the total read processing units (RPUs) per second 
   exceeds the specified threshold.

.. alert:: Total Write Units is

   Raised if the total write processing units (WPUs) per second 
   exceeds the specified threshold.

User Alerts
-----------

The following alert conditions apply to |service| users.

.. alert:: Organization users do not have multi-factor authentication enabled

   Raised when one or more users in an organization do not
   have :doc:`multi-factor authentication </security-multi-factor-authentication>`
   enabled.

.. alert:: User had their role changed

   Raised when an |service| user's project or organization
   roles have changed.

.. alert:: User joined the organization

   Raised when a new user joins the |service| organization.

.. alert:: User joined the project

   Raised when a new user joins the |service| project.

.. alert:: User left the organization

   Raised when a user leaves the |service| organization.

.. alert:: User left the project

   Raised when a user leaves the |service| project.

Project Alerts
--------------

The following alert conditions apply to your |service| project.

.. alert:: Users awaiting approval to join project

   Raised if there are users who have asked to join the
   project. A user can ask to join a project when first registering for
   |service|.

.. alert:: Users do not have multi-factor authentication enabled

   Raised if the project or organization has users who have
   not set up multi-factor authentication.

.. _billing-alerts:

Billing Alerts
--------------

The following alert conditions apply to |service| billing. You can 
configure billing alerts from the {+atlas-ui+} at the organization 
level or the project level.

To configure organization-level alerts:

.. procedure::
   :style: normal
   
   .. include:: /includes/nav/steps-org-settings.rst

   .. include:: /includes/nav/steps-org-alerts.rst

   .. step:: Configure the alerts.

To configure project-level alerts:

.. procedure::
   :style: normal

   .. include:: /includes/nav/steps-project-alerts.rst

   .. step:: Configure the alerts.

.. note::

   All amounts billed are in :abbr:`USD (United States Dollars)`.

.. alert:: Amount billed ($) yesterday is above the threshold

   Raised if the organization or project's last daily amount
   billed exceeds your configured threshold. |service| does not account
   for any credits applied for the previous day when calculating the
   billed amount.

   This condition applies to both organizations and projects.
   
.. alert:: Credit card is about to expire

   Raised if the credit card on file is about to expire. The
   alert is triggered at the beginning of the month that the card
   expires. |service| enables this alert when a credit card is added
   for the first time.

   This condition applies to both organizations and projects.

.. alert:: Current bill ($) for any single project is above the threshold

   Raised if the monthly total for any project within the
   organization exceeds your configured threshold for all projects.
   When the current pending invoice closes, this alert resets.

   This alert condition applies to organizations only.

.. alert:: Current bill ($) for the organization is above the threshold

   Raised if the monthly total for the organization exceeds
   your configured threshold. When the current pending invoice closes,
   this alert resets.

   This alert condition applies to organizations only.

.. _service-account-alerts:

Service Account Alerts
----------------------

The following alert conditions apply to |service| :ref:`service accounts <service-accounts-overview>`. You can 
:ref:`configure these alerts <configure-alerts>` from the 
{+atlas-ui+} at the organization level.

.. alert:: Service Account Secrets are about to expire

   Raised if a secret for any of your service accounts expires within seven days, 
   or the number of days you specify if you :ref:`configure this alert <configure-alert-settings>`. When all expiring secrets are removed or have expired,
   this alert resets.

   This alert condition applies to organizations only.

.. alert:: Service Account Secrets have expired

   Raised if a secret for any of your service accounts has expired. To generate 
   a new secret, see :ref:`change-org-api-key-roles`. When all expired secrets
   are removed, this alert resets.

   This alert condition applies to organizations only.

.. _federation-alerts:

Federation Alerts
-----------------
   
.. alert:: Organization's IdP certificate is about to expire
   
   Raised when an |idp| certificate associated with an 
   organization for which you have the :authrole:`Organization Owner` 
   role expires within 14 days. |service| sends this alert daily until 
   you acknowledge it.
   
   .. note::
      
      |service| creates this alert automatically when you 
      :ref:`map an organization to an IdP provider 
      <atlas-map-org-idp>`. If you remove the mapping, |service| 
      deletes all instances of this alert.

.. _alert-conditions-encryption-at-rest:

Encryption at Rest Alerts
-------------------------

The following alert conditions apply to projects using
:ref:`security-kms-encryption`.

.. alert:: AWS encryption key elapsed time since last rotation is above (n) days

   Raised if the AWS Customer Master Key (CMK) used by the
   |service| project has been active for more than the configured
   number of days (90 by default).

   To modify the alert threshold:
   
   1. .. include:: /includes/nav/list-project-alerts.rst

   #. Click the :guilabel:`Alert Settings`.

   If you :ref:`configure <configure-alerts>` the
   default 90 days :alert:`alert <AWS encryption key elapsed time since
   last rotation is above (n) days>` to be greater than the |aws| |kms|
   CMK rotation, |service| won't create the alert because |aws| would
   have automatically rotated your |cmk|.  

   This alert resets automatically if you rotate the project
   :abbr:`CMK (Customer Master Key)`. For documentation on how to
   rotate your project :abbr:`CMK (customer master key)`, see
   :ref:`security-aws-kms-rotate-key`.

.. alert:: Azure encryption key elapsed time since last rotation is above (n) days

   Raised if the Azure Key Vault Key Identifier used by the
   |service| project has been active for more than the configured
   number of days (90 by default).
   
   To modify the alert threshold:
   
   1. .. include:: /includes/nav/list-project-alerts.rst
      
   #. Click the :guilabel:`Alert Settings`.

   This alert resets automatically if you rotate the project Key
   Identifier. For documentation on how to rotate your project Key
   Identifier, see :ref:`azure-kms-rotate-key`.

.. alert:: GCP encryption key elapsed time since last rotation is above (n) days

   Raised if the GCP Key Version Resource ID used by the
   |service| project has been active for more than the configured
   number of days (90 by default).

   To modify the alert threshold:
   
   1. .. include:: /includes/nav/list-project-alerts.rst
      
   #. Click the :guilabel:`Alert Settings`.

   This alert resets automatically if you rotate the project
   Key Version Resource ID.

   To learn how to rotate your project Key Version Resource ID, see
   :ref:`gcp-kms-rotate-key`.

.. alert:: Encryption at Rest KMS network access denied

   Raised if the KMS credentials for your cloud provider are invalid due 
   to network access restrictions.
   
   To modify or remove the alert:
   
   1. .. include:: /includes/nav/list-project-alerts.rst
      
   #. Click the :guilabel:`Alert Settings`.

   This alert is enabled by default for all new projects.

.. _maintenance-window-alerts:

Maintenance Window Alerts
-------------------------

The following alert conditions apply to projects with
:ref:`configured maintenance windows <atlas-modify-project-settings>`.

.. note::

   You can only :ref:`configure maintenance window alerts
   <configure-mw-alert>` if a project has an active maintenance window.

.. alert:: Maintenance is scheduled

   Raised 72 hours prior to scheduled maintenance for a
   project.

.. alert:: Maintenance no longer needed

   Raised if scheduled maintenance is no longer needed for a
   project.

.. alert:: Maintenance started

   Raised when maintenance starts for a project.

.. alert:: Maintenance has been auto-deferred

   Raised if maintenance has been deferred.

.. _alert-conditions-support-access-grant:

MongoDB Support Access Grant Alerts
---------------------------------------------

.. alert:: Granted additional access to MongoDB support

   Raised when MongoDB support staff has infrastructural access. You can view the 
   access grant type and the expiration date of the granted event.

.. alert:: Revoked additional access from MongoDB support

   Raised when MongoDB support staff no longer has infrastructural access. You can view the 
   access grant type.

.. _atlas-sp-alerts:

{+atlas-sp+} Alerts
---------------------------------------------

The following alert conditions apply to projects running {+SPI+}s.

.. alert:: Stream Processor State is failed

   Raised if a target stream processor exits with a failed state.

   .. include:: /includes/fact-asp-alert-condition.rst


