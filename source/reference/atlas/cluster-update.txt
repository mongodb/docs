.. _mcli-atlas-cluster-update-command:

=============================
mongocli atlas cluster update
=============================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

The ``cluster update`` command modifies your |service| 
cluster settings. You can only modify: 

- ``M10`` or larger clusters
- A single-region replica set

You can also modify a cluster through the |service| 
:atlas:`UI <scale-cluster/>` or :atlas:`API 
<reference/api/clusters-modify-one/>`.

.. _atlas-cluster-update-syntax:

Syntax 
------

.. code-block:: text 

   mongocli atlas cluster(s) update <cluster-name> 
        [ --diskSizeGB <size-of-disk> ]
        [ --file|-f <path-to-cluster-config-file> ]
        [ --instanceSize <cluster-tier> ]
        [ --mdbVersion <mongodb-version> ]
        [ --profile|-P <profile-name> ]
        --projectId <id-of-project> 

.. include:: /includes/fact-command-line-help.rst

.. _atlas-cluster-update-options:

Options 
-------

.. list-table:: 
   :header-rows: 1 
   :widths: 20 10 60 10

   * - Option 
     - Type 
     - Description 
     - Required?

   * - ``<cluster-name>``
     - string
     - Name of your |service| cluster. You cannot change the 
       name of your cluster.
     - yes

   * - ``--diskSizeGB``
     - int
     - Size of the server’s root volume in GB. You can add 
       capacity by increasing this number.
     - no

   * - ``--file``, ``-f``
     - string
     - Path to a |json| configuration file that defines cluster
       settings. Any settings specified in the configuration file take
       precedence over settings specified by a command option. 
       
       For a list of settings you can define, see the
       :atlas:`Create One Cluster API
       <reference/api/clusters-create-one/#request-body-parameters>`.
     - no

   * - ``--instanceSize``
     - string
     - Name of your cluster tier. You can modify your cluster 
       tier.
     - no

   * - ``--mdbVersion``
     - string
     - Major version of MogoDB to which you want to upgrade 
       your cluster. You cannot downgrade the MongoDB version of 
       your cluster.

       .. note:: 

          Before your upgrade, refer to the current 
          :atlas:`recommended best practices for major version 
          upgrades <tutorial/major-version-change/>`.
     - no

   * - ``--profile``, ``-P``
     - string
     - Name of the profile to use for accessing the |service| 
       project. If omitted, uses the ``default`` profile.
     - no

   * - ``--projectId``
     - string
     - Unique identifier of the project containing the cluster 
       you want to update.
     - yes

.. _atlas-cluster-update-output:

Output 
------ 

The command prints the following fields in |json| format to the terminal
if the command succeeds. If the command returns errors, see
:ref:`Troubleshooting <troubleshooting>` for recommended solutions.

.. list-table::
   :header-rows: 1
   :widths: 30 70

   * - Field 
     - Description

   * - ``autoScaling``
     - Configuration for :atlas:`automatically scaling 
       <cluster-autoscaling/#cluster-autoscaling>` cluster storage 
       and tier.

   * - ``autoscaling.diskGBEnabled``
     - Specifies whether or not disk :atlas:`auto-scaling 
       <cluster-autoscaling/#cluster-autoscaling>` is enabled. 
       Value can be:

       - ``true`` if enabled
       - ``false`` if diskGBEnabled

       By default, disk auto-scaling is disabled.

   * - ``backupEnabled``
     - Specifies whether or not :atlas:`continuous 
       backups <backup/continuous-backups>` is enabled. 
       Value can be:

       - ``true`` if enabled
       - ``false`` if disabled

   * - ``biConnector``
     - Configuration for |bic| on the cluster.

   * - ``biConnector.enabled``
     - Specifies whether or not |bic-short| is enabled. 
       Value can be:

       - ``true`` if enabled
       - ``false`` if disabled

       The default value is false.

   * - ``biConnector.readPreference``
     - Specifies the read preference for |bic| on the 
       cluster. Value can be:

       - ``primary`` to allow |bic-short| to read from 
         primary.
       - ``secondary`` to allow |bic-short| to read from 
         the secondary. 
       - ``analytics`` to allow |bic-short| to read from 
         the :atlas:`analytics node <faq/#analytics-nodes-overview>`.

       The default value is ``secondary`` if there are no 
       analytics nodes in the cluster. If there analytics 
       nodes in the cluster, the default value is ``analytics``.

   * - ``clusterType``
     - Specifies the type of cluster. Value can be:

       - ``REPLICASET``
       - ``SHARDED``
       - ``GEOSHARDED``

       The default value is ``REPLICASET``.

   * - ``diskSizeGB``
     - Specifies the capacity, in GB, of the host's root 
       volume. 

   * - ``encryptionAtRestProvider``
     - Configuration for encryption-at-rest. Default value 
       is ``NONE``.

   * - ``id``
     - Specifies the unique identifier of the cluster.

   * - ``groupId``
     - Specifies the unique identifier of the project. 
      
       .. note::

          Groups and projects are synonymous terms. Your 
          {GROUP-ID} is the same as your project ID. 

   * - ``mongoDBVersion``
     - Specifies the MongoDB version that is deployed.

   * - ``mongoDBMajorVersion``
     - Specifies the major version of MongoDB that is deployed.

   * - ``mongoURI``
     - Base :manual:`connection string <reference/connection-string/>` 
       for the cluster.

   * - ``MongoURIUpdated``
     - Specifies the timestamp in |iso8601-time| when the connection 
       string was last updated. 

   * - ``mongoURIWithOptions``
     - Specifies the :manual:`connection string <reference/connection-string/>` 
       for connecting to the |service| cluster. Includes the ``replicaSet``, 
       ``ssl``, and ``authSource`` query parameters in the connection string 
       with values appropriate for the cluster.

   * - ``name``
     - Specifies the name of the cluster.

   * - ``numShards``
     - Specifies the numer of shards in the sharded cluster. Value 
       can be:

       - ``1`` if the cluster is a replica set.
       - ``2`` or higher, up to ``12``, if the cluster is a sharded 
         cluster. 

   * - ``paused``
     - Specifies whether or not the cluster is paused. Value 
       can be:

       - ``true`` if cluster is paused.
       - ``false`` if cluster is active.

   * - ``providerBackupEnabled``
     - Specifies whether or not :atlas:`Cloud Provider 
       Snapshots <backup/cloud-provider-snapshots/#backup-cloud-provider>` 
       is enabled. Value can be: 

       - ``true`` if enabled.
       - ``false`` if disabled.

   * - ``providerSettings``
     - Configuration for the provisioned servers on which 
       MongoDB runs.

   * - ``providerSettings.diskIOPS``
     - Specifies the maximum input/output operations per second (IOPS) that 
       the system can perform. The possible values depend on the selected ``providerSettings.instanceSizeName`` and ``diskSizeGB``.

   * - ``providerSettings.encryptEBSVolume``
     - Specifies whether the Amazon EBS encryption feature encrypts 
       the server’s root volume for both data at rest within the volume 
       and for data moving between the volume and the cluster. Value can 
       be:

       - ``true`` if enabled 
       - ``false`` if disabled

   * - ``providerSettings.instanceSizeName``
     - Specifies the name of the cluster tier used for |service| 
       cluster. 

       .. tabs-cloud-providers::

          .. tab:: 
             :tabid: aws

             .. include:: /includes/extracts/fact-cluster-instance-sizes-AWS.rst

          .. tab:: 
             :tabid: gcp

             .. include:: /includes/extracts/fact-cluster-instance-sizes-GCP.rst

          .. tab:: 
             :tabid: azure
              
             .. include:: /includes/extracts/fact-cluster-instance-sizes-AZURE.rst

   * - ``providerSettings.providerName``
     - Specifies the name of the cloud service provider on which 
       the server is provisioned. Value can be: 

       - ``AWS`` for Amazon AWS
       - ``GCP`` for Google Cloud Platform
       - ``AZURE`` for Microsot Azure

   * - ``providerSettings.regionName``
     - Specifies the physical location of the cluster. For a 
       complete list of regions, see cloud provider reference:

       - :atlas:`AWS <reference/amazon-aws/#amazon-aws>`
       - :atlas:`GCP <reference/google-gcp/#google-gcp>` 
       - :atlas:`Azure <reference/microsoft-azure/#microsoft-azure>`

   * - ``providerSettings.volumeType`` 
     - Specifies the |iops| range for the selected volume size. Value 
       can be: 

       - ``STANDARD`` to indicate that ``providerSettings.diskIOPS`` 
         value must not exceed the default |iops| rate for the selected 
         volume size.
       - ``PROVISIONED`` to indicate that ``providerSettings.diskIOPS`` 
         value must fall within the allowable |iops| range for the 
         selected volume size.

   * - replicationFactor
     - Specifies the number of :atlas:`replica set members 
       <reference/glossary/#term-replica-set>` in the cluster. The 
       possible values are ``3``, ``5``, ``7``.

   * - replicationSpec
     - Configuration for each region in the cluster. Each 
       element in this object represents a region where 
       your cluster is deployed. 

   * - ``replicationSpec.<region>``
     - Specifies the physical location of the region. 

       Each ``<region>`` object describes the region’s priority 
       in elections and the number and type of MongoDB nodes 
       |service| deploys to the region. 

   * - ``replicationSpec.<region>.analyticsNodes``
     - Specifies the number of :atlas:`analytics nodes 
       <faq/#analytics-nodes-overview>` in the region. 
       Analytics nodes are read-only, and can never become 
       the :atlas:`primary <reference/glossary/#term-primary>`.

   * - ``replicationSpec.<region>.electableNodes``
     - Specifies the number of electable nodes in the 
       region. Electable nodes can become the 
       :atlas:`primary <reference/glossary/#term-primary>` 
       and can facilitate local reads.

   * - ``replicationSpec.<region>.priority``
     - Specifies the election priority of the region. The highest 
       possible priority is ``7``, which identifies the ``Preferred 
       Region`` of the cluster. |service| places the primary node in 
       the ``Preferred Region``. The lowest possible priority is ``0``, 
       which identifies a read-only region.

       You can have any number of priority ``0`` read only regions. 
       Priorities ``1`` through ``7`` are exclusive: only one region 
       per cluster can be assigned a given priority.

   * - ``replicationSpec.<region>.readOnlyNodes``
     - Specifies the number of read-only nodes in the region. Read-only 
       nodes can never become the primary member, but can facilitate 
       local reads.

   * - ``replicationSpecs``
     - Configuration for each zone in a :atlas:`Global Cluster 
       <global-clusters>`. Each object in this array represents a 
       zone where |service| deploys nodes for your :atlas:`Global Cluster 
       <global-clusters>`.

   * - ``replicationSpecs.id``
     - Specifies the unique identifier of the replication object.

   * - ``replicationSpecs.numShards``
     - Specifies the number of shards to deploy in the specified 
       zone.

   * - ``replicationSpecs.zoneName``
     - Specifies the name for the zone in a :atlas:`Global Cluster 
       <global-clusters>`.

   * - ``replicationSpecs.regionConfig``
     - Configuration for the physical location of the region. Each 
       ``regionsConfig`` object describes the region’s priority in 
       elections and the number and type of MongoDB nodes that 
       |service| deploys to the region.

   * - | ``replicationSpecs[n].regionsConfig``
       | ``.<regionName>.analyticsNodes``
     - Specifies the number of analytics nodes to deploy in the 
       region.

   * - | ``replicationSpecs[n].regionsConfig``
       | ``.<regionName>``.electableNodes``
     - Number of electable nodes for |service| to deploy to the region.
       Electable nodes can become the :term:`primary` and can
       facilitate local reads.

   * - | ``replicationSpecs[n].regionsConfig``
       | ``.<regionName>.priority``
     - Election priority of the region. If you have regions with only
       read-only nodes, set this value to ``0``.

   * - | ``replicationSpecs[n].regionsConfig``
       | ``.<regionName>.readOnlyNodes``
     - Number of read-only nodes for |service| in the region.
       Read-only nodes can never become the :term:`primary`, but can
       facilitate local-reads.

       Specify ``0`` if you do not want any read-only nodes in the
       region.

   * - ``srvAddress``
     - The :manual:`connection string <reference/connection-string/>` 
       for connecting to the |service| cluster. The ``+srv`` modifier 
       forces the connection to use |tls|. The ``mongoURI`` parameter 
       lists additional options.

   * - ``stateName``
     - The current status of the cluster. Value can be:

       - ``IDLE``
       - ``CREATING``
       - ``UPDATING``
       - ``DELETING``
       - ``DELETED``
       - ``REPAIRING``

.. _atlas-cluster-update-eamples:

Examples 
--------

Example 1
~~~~~~~~~

The following ``mongocli atlas cluster update`` command migrates the
cluster named ``sbxCluster`` in the specified project from ``M10`` to
``M20``. It uses the ``default`` profile for accessing the project.

.. code-block:: text 
   :copyable: false 

   mongocli atlas cluster update sbxCluster --projectId 5e2211c17a3e5a48f5497de3 --instanceSize M20

The command prints the following fields to the terminal:

.. code-block:: json 
   :copyable: false 

   {
	"autoScaling": {
		"diskGBEnabled": true
	},
	"backupEnabled": false,
	"biConnector": {
		"enabled": false,
		"readPreference": "secondary"
	},
	"clusterType": "REPLICASET",
	"diskSizeGB": 2,
	"encryptionAtRestProvider": "NONE",
	"id": "5e2f1f657a3e5a052beddd92",
	"groupId": "5e2211c17a3e5a48f5497de3",
	"mongoDBVersion": "4.2.3",
	"mongoDBMajorVersion": "4.2",
	"mongoURI": "mongodb://sbxcluster-shard-00-00-7hgjn.mongodb-dev.net:27017,sbxcluster-shard-00-01-7hgjn.mongodb-dev.net:27017,sbxcluster-shard-00-02-7hgjn.mongodb-dev.net:27017",
	"mongoURIUpdated": "2020-01-27T17:41:49Z",
	"mongoURIWithOptions": "mongodb://sbxcluster-shard-00-00-7hgjn.mongodb-dev.net:27017,sbxcluster-shard-00-01-7hgjn.mongodb-dev.net:27017,sbxcluster-shard-00-02-7hgjn.mongodb-dev.net:27017/?ssl=true\u0026authSource=admin\u0026replicaSet=sbxCluster-shard-0",
	"name": "sbxCluster",
	"numShards": 1,
	"paused": false,
	"providerBackupEnabled": false,
	"providerSettings": {
		"diskIOPS": 100,
		"encryptEBSVolume": true,
		"instanceSizeName": "M20",
		"providerName": "AWS",
		"regionName": "US_EAST_1",
		"volumeType": "STANDARD"
	},
	"replicationFactor": 3,
	"replicationSpec": {
		"US_EAST_1": {
			"analyticsNodes": 0,
			"electableNodes": 3,
			"priority": 7,
			"readOnlyNodes": 0
		}
	},
	"replicationSpecs": [
		{
			"id": "5e2f1f657a3e5a052beddd8d",
			"numShards": 1,
			"zoneName": "Zone 1",
			"regionsConfig": {
				"US_EAST_1": {
					"analyticsNodes": 0,
					"electableNodes": 3,
					"priority": 7,
					"readOnlyNodes": 0
				}
			}
		}
	],
	  "srvAddress": "mongodb+srv://sbxcluster-7hgjn.mongodb-dev.net",
	  "stateName": "UPDATING"
   }

Example 2
~~~~~~~~~

The following ``mongocli atlas cluster update`` command uses a
configuration file to:

- Increase the cluster tier from ``M10`` to ``M20`` and 
- Increase the server's root volume to ``200 GB``.

The command uses the profile named ``egAtlasProfile``, which
contains the public and private keys for accessing |service|.

.. code-block:: text
   :copyable: false

   mongocli atlas cluster update myCluster --file cluster-config.json --projectId 5e2211c17a3e5a48f5497de3 --profile egAtlasProfile
   
The cluster configuration file contains the updated settings:

.. code-block:: json
   :copyable: false

   {
    "diskSizeGB": 200,
    "providerSettings": {
        "providerName": "AWS",
        "diskIOPS": 100,
        "instanceSizeName": "M20"
    },
    "replicationFactor": 3
   }

The command prints the following to the terminal. To learn more about 
these fields, see :ref:`Output <atlas-cluster-create-output-fields>`.

.. code-block:: json
   :copyable: false
   
   {
    "autoScaling": {
     "diskGBEnabled": true
    },
    "backupEnabled": false,
    "biConnector": {
     "enabled": false,
     "readPreference": "secondary"
    },
    "clusterType": "REPLICASET",
    "diskSizeGB": 120,
    "encryptionAtRestProvider": "NONE",
    "id": "5e66718ec4121d0a54021794",
    "groupId": "5e2f04ecf10fab66c7d4072e",
    "mongoDBVersion": "4.2.3",
    "mongoDBMajorVersion": "4.2",
    "mongoURI": "mongodb://cluster0-shard-00-00-xgwul.mongodb-dev.net:27017,cluster0-shard-00-01-xgwul.mongodb-dev.net:27017,cluster0-shard-00-02-xgwul.mongodb-dev.net:27017",
    "mongoURIUpdated": "2020-03-09T16:47:50Z",
    "mongoURIWithOptions": "mongodb://cluster0-shard-00-00-xgwul.mongodb-dev.net:27017,cluster0-shard-00-01-xgwul.mongodb-dev.net:27017,cluster0-shard-00-02-xgwul.mongodb-dev.net:27017/?ssl=true\u0026authSource=admin\u0026replicaSet=Cluster0-shard-0",
    "name": "Cluster0",
    "numShards": 1,
    "paused": false,
    "providerBackupEnabled": true,
    "providerSettings": {
     "diskIOPS": 360,
     "encryptEBSVolume": true,
     "instanceSizeName": "M10",
     "providerName": "AWS",
     "regionName": "US_EAST_1",
     "volumeType": "STANDARD"
    },
    "replicationFactor": 3,
    "replicationSpec": {
     "US_EAST_1": {
      "analyticsNodes": 0,
      "electableNodes": 3,
      "priority": 7,
      "readOnlyNodes": 0
     }
    },
    "replicationSpecs": [
     {
      "id": "5e667185746809055da6b383",
      "numShards": 1,
      "zoneName": "Zone 1",
      "regionsConfig": {
       "US_EAST_1": {
        "analyticsNodes": 0,
        "electableNodes": 3,
        "priority": 7,
        "readOnlyNodes": 0
       }
      }
     }
    ],
    "srvAddress": "mongodb+srv://cluster0-xgwul.mongodb-dev.net",
    "stateName": "UPDATING"
   }
