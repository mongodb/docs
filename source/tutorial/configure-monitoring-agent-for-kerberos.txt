:orphan:

===========================================
Configure the Monitoring Agent for Kerberos
===========================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. include:: /includes/styles/corrections.rst

.. include:: /includes/legacy-agents/fact-monitoring-agent-deprecated.rst

:product:`MongoDB Enterprise <mongodb-enterprise-advanced>` supports
Kerberos. Kerberos is a network authentication protocol.
{+magent+} can authenticate to MongoDB instances using
Kerberos.

.. include:: /includes/note-manage-agent-auth-with-automation-kerberos.rst

Prerequisites
-------------

Configure KDC to Issue Tickets with Four-Hour Minimum Lifetime
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Kerberos tickets are only valid, or used to authenticate users, for a
limited time. You must configure the Kerberos Key Distribution Center
(KDC) to issue tickets that are valid for at least four hours. The
Monitoring Agent periodically renews the ticket. The |kdc| service
provides session tickets and temporary session keys to users and
computers.

Add Kerberos as Authentication Mechanism for Deployment
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/fact-access-control-host-settings.rst

Configure Monitoring Agent Host to Use Kerberos
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/note-needed-kerberos-files-for-agent.rst

For the purposes of this tutorial, you must make sure:

- Your deployment supports Kerberos authentication and
- Your Agents use Kerberos authentication.

To learn how to enable Kerberos authentication, see
:doc:`/tutorial/enable-kerberos-authentication-for-group`.

Create Kerberos User Principal for the Monitoring Agent
-------------------------------------------------------

.. include:: /includes/steps/kerberos-create-principal.rst

Create a User and Assign Roles for the Monitoring Agent |upn|
-------------------------------------------------------------

.. include:: /includes/fact-kerberos-principal-as-user.rst

From a |mongo| shell connected to your MongoDB deployment, 
issue the following commands to create the users:

.. code-block:: javascript

   db.getSiblingDB("$external").createUser(
      {
        user: "<Kerberos Principal>",
        roles: [ { role: "clusterMonitor", db: "admin" } ]
      }
   )

To learn about the required access for the Monitoring Agent, see 
:doc:`/reference/required-access-monitoring-agent`.

Edit the Monitoring Agent Configuration File
--------------------------------------------

Edit the Monitoring Agent configuration file. The following table lists
the default installation paths for some common platforms. Depending on
your deployment, you may need to substitute the default path for the
custom installation path used for your |mms| agent installation.

.. list-table::
   :header-rows: 1
   :widths: 40 60 

   * - Operating System
     - Path

   * - RHEL, Ubuntu
     - ``/etc/mongodb-mms/monitoring-agent.config``

   * - Linux Archive, macOS
     - ``<userSelected>/monitoring-agent.config``

   * - Windows
     - ``C:\MMSData\Monitoring\local.config``

.. include:: /includes/steps/kerberos-agent-config-file.rst

