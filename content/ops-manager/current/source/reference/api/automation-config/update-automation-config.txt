.. _update-automation-configuration:

===================================
Update the Automation Configuration
===================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

.. include:: /includes/api/automation-configuration/auto-config-def.rst

.. include:: /includes/api/automation-configuration/update-config-steps.rst

.. important::

   An automation configuration might contain sensitive information,
   including passwords or key values. To update a project's automation
   configuration without updating any fields that contain sensitive
   information, use the
   :ref:`/groups/{PROJECT-ID}/automationConfig/noSecrets
   <update-automation-configuration-no-secrets>` endpoint.

.. include:: /includes/api/automation-configuration/note-update-parameters-limit.rst

To see a tutorial on how to update an automation configuration, see
:ref:`update-automation-configuration-tutorial`.

The MongoDB Agents continuously poll |mms| for changes to the
configuration and fetch configuration updates when they occur. The
Agents then adjust the states of their live processes to match.

.. warning:: 

   Making changes to the automation configuration using a ``PUT``
   request can cause cluster downtime. Test your changes in lower
   environments before you apply them to production environments.
   
.. _concurrent-cluster-config:

.. warning::
   
   There is **no protection** in the {+admin-api+} to prevent
   concurrent modifications. If two administrators both start with a
   configuration based on the current version, make their own
   modifications, and then submit their modifications, the later
   modification wins.

.. warning:: Update Agent Username before Enabling Authentication

   The automation configuration provides the sole means to enabling
   authentication on your clusters using the |api|. To enable
   authentication, first call the following endpoints with
   **"username": "mms-automation"**:

   - :doc:`Update the current backup log settings </reference/api/automation-config/update-backup-log-attributes>`
   - :doc:`Update the current monitoring log settings  </reference/api/automation-config/update-monitoring-log-attributes>`

Required Roles
--------------

This resource requires the :authrole:`Project Automation Admin` role.

Resource
--------

.. include:: /includes/api/base-api-uri.rst

.. code-block:: http

   PUT /groups/{PROJECT-ID}/automationConfig

Request
-------

Path Parameters
~~~~~~~~~~~~~~~

.. list-table::
   :widths: 20 14 11 55
   :header-rows: 1
   :stub-columns: 1

   * - Name
     - Type
     - Necessity
     - Description

   * - PROJECT-ID
     - string
     - Required
     - Unique identifier of the :opsmgr:`group </reference/glossary/#std-term-group>` that owns the automation
       configuration.

Query Parameters
~~~~~~~~~~~~~~~~

.. include:: /includes/api/no-query-single-parameters.rst

Body Parameters
~~~~~~~~~~~~~~~

To review these parameters, see
:doc:`/reference/api/automation-config/automation-config-parameters`.

Response
--------

To review these parameters, see
:doc:`/reference/api/automation-config/automation-config-parameters`.

Example Request
---------------

The following replaces the automation configuration with the updated
configuration saved in ``/Users/admin/updated-conf.json``. For an
example of an updated configuration document, see
:ref:`example-updated-configuration`.

.. code-block:: sh

   curl --user "{PUBLIC-KEY}:{PRIVATE-KEY}" --digest \
     --header "Accept: application/json" \
     --header "Content-Type: application/json" \
     --include \
     --request PUT "https://{+opsmgr-url+}/api/public/v1.0/groups/{PROJECT-ID}/automationConfig?pretty=true" \
     --data-binary "@/Users/admin/updated-conf.json"

Example Response
----------------

Response Header
~~~~~~~~~~~~~~~

.. include:: /includes/api/api-headers/401.rst

.. include:: /includes/api/api-headers/200.rst

Response Body
~~~~~~~~~~~~~

To review an example of this configuration, see
:doc:`/reference/api/automation-config/automation-config-example`.
