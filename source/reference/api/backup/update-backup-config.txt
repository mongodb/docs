===============================
Update One Backup Configuration
===============================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

.. include:: /includes/fact-groups-projects-synonyms.rst

.. include:: /includes/api/base-api-uri.rst

Resource
--------

.. code-block:: http

   PATCH /groups/{PROJECT-ID}/backupConfigs/{CLUSTER-ID}

Request Parameters
------------------

Request Path Parameters
~~~~~~~~~~~~~~~~~~~~~~~

.. list-table::
   :widths: 10 10 80
   :header-rows: 1
   :stub-columns: 1

   * - Name
     - Type
     - Description

   * - PROJECT-ID
     - string
     - *(Required.)* The unique identifier for the project that holds the cluster with
       the backup configuration you want to change.

   * - CLUSTER-ID
     - string
     - *(Required.)* The unique indentifier of the cluster whose backup configuration
       you want to change.

Request Query Parameters
~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/api/no-query-single-parameters.rst

Request Body Parameters
~~~~~~~~~~~~~~~~~~~~~~~

.. only:: onprem

   .. list-table::
      :widths: 10 10 80
      :header-rows: 1
      :stub-columns: 1

      * - Name
        - Type
        - Description

      * - PROJECT-ID
        - string
        - Unique identifier of the project that owns this backup configuration.

      * - CLUSTER-ID
        - string
        - Unique identifier of the cluster that this backup configuration is for.

      * - statusName
        - string
        - The current (or desired) status of the backup configuration. Possible
          values are:

          - ``INACTIVE``
          - ``PROVISIONING``
          - ``STARTED``
          - ``STOPPED``
          - ``TERMINATING``

      * - storageEngineName
        - string
        - The storage engine used for the backup. Possible values are:

          - ``MEMORY_MAPPED``
          - ``WIRED_TIGER``

      * - authMechanismName
        - string
        - The name of the authentication mechanism to use when
          connecting to the sync source database. Only present when
          using authentication. Possible values are:

          .. include:: /includes/api/lists/authMechanismName-values.rst

      * - username
        - string
        - The username to use to connect to the sync source
          database. Only present when backing up :program:`mongod`
          instances that require clients to authenticate.

          You can send this field to |mms| only when updating the backup
          configuration for a replica set or sharded cluster that is **not**
          managed by |mms| Automation.

      * - password
        - string
        - The password to use to connect to the sync source
          database. Only present when backup the :program:`mongod`
          instances that require clients to authenticate.
          ``GET`` requests do *not* include this field.

          You can send this field to |mms| only when updating the backup
          configuration for a replica set or sharded cluster that is **not**
          managed by |mms| Automation.

      * - encryptionEnabled
        - boolean
        - Specifies whether encryption is enabled for the backup configuration.
          You must include the ``syncSource`` field when enabling encryption
          for a backup configuration. For existing backups in a project, enabling
          encryption requires an initial backup sync to recreate the backups’
          head databases.

      * - sslEnabled
        - boolean
        - Is SSL enabled for the sync source database?

      * - syncSource
        - string
        - The :program:`mongod` instance to get backup data
          from. Possible values are either a specific hostname or one of:
          ``PRIMARY`` and ``SECONDARY``. This field is only used when
          updating a backup configuration. It is not returned by a
          ``GET`` request.

      * - provisioned
        - boolean
        - Reports if |mms| has provisioned the resources needed to store a backup. This
          field is only present when the amount of data to be backed up exceeds a
          certain threshold.

      * - excludedNamespaces
        - string array
        - A list of database names and collection names to omit from the
          backup. Each string is a namespace in the form of ``{database}`` or
          ``{database}.{collection}``. If this field is present the
          ``includedNamespaces`` field cannot be present.

          You must send the new full list of excluded namespaces, including any
          that were already listed.

          If the new list removes any namespaces from the previous list, you must
          also set the ``syncSource`` field, as the removal of an excluded
          namespace necessitates a full resync. Without the ``syncSource`` field,
          the request will fail.

          If the new list only adds to the previous list, you do not need to set
          ``syncSource``.

      * - includedNamespaces
        - string array
        - A list of database names and collection names to include in the
          backup. Each string is a namespace in the form of ``{database}``
          or ``{database}.{collection}``. Any namespace **not listed** in this
          array **will not be backed up**. If this field is present the
          ``excludedNamespaces`` field cannot be present.

          You must send the new full list of included namespaces, including any
          that were already listed.

          If the new list adds any namespaces to the previous list, you must
          also set the ``syncSource`` field, as the addition of an included
          namespace necessitates a full resync. Without the ``syncSource`` field,
          the request will fail.

          If the new list only removes namespaces from the previous list, you do
          not need to set ``syncSource``.

.. only:: cloud

   .. list-table::
      :widths: 10 10 80
      :header-rows: 1
      :stub-columns: 1

      * - Name
        - Type
        - Description

      * - PROJECT-ID
        - string
        - Unique identifier of the project that owns this backup configuration.

      * - CLUSTER-ID
        - string
        - Unique identifier of the cluster that this backup configuration is for.

      * - statusName
        - string
        - The current (or desired) status of the backup configuration. Possible
          values are:

          - ``INACTIVE``
          - ``PROVISIONING``
          - ``STARTED``
          - ``STOPPED``
          - ``TERMINATING``

      * - storageEngineName
        - string
        - The storage engine used for the backup. Possible values are:

          - ``MEMORY_MAPPED``
          - ``WIRED_TIGER``

      * - authMechanismName
        - string
        - The name of the authentication mechanism to use when connecting to the
          sync source database. Only present when using authentication. Possible
          values are:

          .. include:: /includes/api/lists/authMechanismName-values.rst

      * - username
        - string
        - The username to use to connect to the sync source
          database. Only present when backing up :program:`mongod`
          instances that require clients to authenticate.

          You can send this field to |mms| only when updating the backup
          configuration for a replica set or sharded cluster that is **not**
          managed by |mms| Automation.

      * - password
        - string
        - The password to use to connect to the sync source
          database. Only present when backup the :program:`mongod`
          instances that require clients to authenticate.
          ``GET`` requests do *not* include this field.

          You can send this field to |mms| only when updating the backup
          configuration for a replica set or sharded cluster that is **not**
          managed by |mms| Automation.

      * - sslEnabled
        - boolean
        - Is SSL enabled for the sync source database?

      * - syncSource
        - string
        - The :program:`mongod` instance to get backup data
          from. Possible values are either a specific hostname or one of:
          ``PRIMARY`` and ``SECONDARY``. This field is only used when
          updating a backup configuration. It is not returned by a
          ``GET`` request.

      * - provisioned
        - boolean
        - Reports if |mms| has provisioned the resources needed to store a backup. This
          field is only present when the amount of data to be backed up exceeds a
          certain threshold.

      * - excludedNamespaces
        - string array
        - A list of database names and collection names to omit from the
          backup. Each string is a namespace in the form of ``{database}`` or
          ``{database}.{collection}``. If this field is present the
          ``includedNamespaces`` field cannot be present.

          You must send the new full list of excluded namespaces, including any
          that were already listed.

          If the new list removes any namespaces from the previous list, you must
          also set the ``syncSource`` field, as the removal of an excluded
          namespace necessitates a full resync. Without the ``syncSource`` field,
          the request will fail.

          If the new list only adds to the previous list, you do not need to set
          ``syncSource``.

      * - includedNamespaces
        - string array
        - A list of database names and collection names to include in the
          backup. Each string is a namespace in the form of ``{database}``
          or ``{database}.{collection}``. Any namespace **not listed** in this
          array **will not be backed up**. If this field is present the
          ``excludedNamespaces`` field cannot be present.

          You must send the new full list of included namespaces, including any
          that were already listed.

          If the new list adds any namespaces to the previous list, you must
          also set the ``syncSource`` field, as the addition of an included
          namespace necessitates a full resync. Without the ``syncSource`` field,
          the request will fail.

          If the new list only removes namespaces from the previous list, you do
          not need to set ``syncSource``.

Response
--------

.. only:: onprem

   .. list-table::
      :widths: 10 10 80
      :header-rows: 1

      * - Name
        - Type
        - Description

      * - PROJECT-ID
        - string
        - Unique identifier of the project that owns this backup configuration.

      * - CLUSTER-ID
        - string
        - Unique identifier of the cluster that this backup configuration is for.

      * - statusName
        - string
        - The current (or desired) status of the backup configuration. Possible
          values are:

          - ``INACTIVE``
          - ``PROVISIONING``
          - ``STARTED``
          - ``STOPPED``
          - ``TERMINATING``

      * - storageEngineName
        - string
        - The storage engine used for the backup. Possible values are:

          - ``MEMORY_MAPPED``
          - ``WIRED_TIGER``

      * - authMechanismName
        - string
        - The name of the authentication mechanism to use when
          connecting to the sync source database. Only present when
          using authentication. Possible values are:

          .. include:: /includes/api/lists/authMechanismName-values.rst

      * - encryptionEnabled
        - boolean
        - Specifies whether encryption is enabled for the backup configuration.
          You must include the ``syncSource`` field when enabling encryption
          for a backup configuration. For existing backups in a project, enabling
          encryption requires an initial backup sync to recreate the backups’
          head databases.

      * - sslEnabled
        - boolean
        - Is SSL enabled for the sync source database?

      * - syncSource
        - string
        - The :program:`mongod` instance to get backup data
          from. Possible values are either a specific hostname or one of:
          ``PRIMARY`` and ``SECONDARY``. This field is only used when
          updating a backup configuration. It is not returned by a
          ``GET`` request.

      * - provisioned
        - boolean
        - Reports if |mms| has provisioned the resources needed to store a backup. This
          field is only present when the amount of data to be backed up exceeds a
          certain threshold.

      * - excludedNamespaces
        - string array
        - A list of database names and collection names to omit from the
          backup. Each string is a namespace in the form of ``{database}`` or
          ``{database}.{collection}``. If this field is present the
          ``includedNamespaces`` field cannot be present.

          You must send the new full list of excluded namespaces, including any
          that were already listed.

          If the new list removes any namespaces from the previous list, you must
          also set the ``syncSource`` field, as the removal of an excluded
          namespace necessitates a full resync. Without the ``syncSource`` field,
          the request will fail.

          If the new list only adds to the previous list, you do not need to set
          ``syncSource``.

      * - includedNamespaces
        - string array
        - A list of database names and collection names to include in the
          backup. Each string is a namespace in the form of ``{database}``
          or ``{database}.{collection}``. Any namespace **not listed** in this
          array **will not be backed up**. If this field is present the
          ``excludedNamespaces`` field cannot be present.

          You must send the new full list of included namespaces, including any
          that were already listed.

          If the new list adds any namespaces to the previous list, you must
          also set the ``syncSource`` field, as the addition of an included
          namespace necessitates a full resync. Without the ``syncSource`` field,
          the request will fail.

          If the new list only removes namespaces from the previous list, you do
          not need to set ``syncSource``.

.. only:: cloud

   .. list-table::
      :widths: 10 10 80
      :header-rows: 1

      * - Name
        - Type
        - Description

      * - PROJECT-ID
        - string
        - Unique identifier of the project that owns this backup configuration.

      * - CLUSTER-ID
        - string
        - Unique identifier of the cluster that this backup configuration is for.

      * - statusName
        - string
        - The current (or desired) status of the backup configuration. Possible
          values are:

          - ``INACTIVE``
          - ``PROVISIONING``
          - ``STARTED``
          - ``STOPPED``
          - ``TERMINATING``

      * - storageEngineName
        - string
        - The storage engine used for the backup. Possible values are:

          - ``MEMORY_MAPPED``
          - ``WIRED_TIGER``

      * - authMechanismName
        - string
        - The name of the authentication mechanism to use when connecting to the
          sync source database. Only present when using authentication. Possible
          values are:

          .. include:: /includes/api/lists/authMechanismName-values.rst

      * - sslEnabled
        - boolean
        - Is SSL enabled for the sync source database?

      * - syncSource
        - string
        - The :program:`mongod` instance to get backup data
          from. Possible values are either a specific hostname or one of:
          ``PRIMARY`` and ``SECONDARY``. This field is only used when
          updating a backup configuration. It is not returned by a
          ``GET`` request.

      * - provisioned
        - boolean
        - Reports if |mms| has provisioned the resources needed to store a backup. This
          field is only present when the amount of data to be backed up exceeds a
          certain threshold.

      * - excludedNamespaces
        - string array
        - A list of database names and collection names to omit from the
          backup. Each string is a namespace in the form of ``{database}`` or
          ``{database}.{collection}``. If this field is present the
          ``includedNamespaces`` field cannot be present.

          You must send the new full list of excluded namespaces, including any
          that were already listed.

          If the new list removes any namespaces from the previous list, you must
          also set the ``syncSource`` field, as the removal of an excluded
          namespace necessitates a full resync. Without the ``syncSource`` field,
          the request will fail.

          If the new list only adds to the previous list, you do not need to set
          ``syncSource``.

      * - includedNamespaces
        - string array
        - A list of database names and collection names to include in the
          backup. Each string is a namespace in the form of ``{database}``
          or ``{database}.{collection}``. Any namespace **not listed** in this
          array **will not be backed up**. If this field is present the
          ``excludedNamespaces`` field cannot be present.

          You must send the new full list of included namespaces, including any
          that were already listed.

          If the new list adds any namespaces to the previous list, you must
          also set the ``syncSource`` field, as the addition of an included
          namespace necessitates a full resync. Without the ``syncSource`` field,
          the request will fail.

          If the new list only removes namespaces from the previous list, you do
          not need to set ``syncSource``.

      * - links
        - object array
        - .. include:: /includes/api/links-explanation.rst


Example Request
---------------

.. only:: cloud

   .. cssclass:: copyable-code
   .. code-block:: sh
      :emphasize-lines: 5-8

      curl --user "{PUBLIC-KEY}:{PRIVATE-KEY}" --digest \
       --header "Accept: application/json" \
       --header "Content-Type: application/json" \
       --include --request PATCH "https://cloud.mongodb.com/api/public/v1.0/groups/{PROJECT-ID}/backupConfigs/{CLUSTER-ID}"
       --data '
       {
         "statusName": "STOPPED"
       }'

.. only:: onprem

   .. cssclass:: copyable-code
   .. code-block:: sh
      :emphasize-lines: 5-8

      curl --user "{PUBLIC-KEY}:{PRIVATE-KEY}" --digest \
       --header "Accept: application/json" \
       --header "Content-Type: application/json" \
       --include --request PATCH "https://{opsManagerHost}:{port}/api/public/v1.0/groups/{PROJECT-ID}/backupConfigs/{CLUSTER-ID}" \
       --data '
       {
         "statusName": "STOPPED"
       }'


Example Response
----------------

Response Header
~~~~~~~~~~~~~~~

.. include:: /includes/api/api-headers/401.rst

.. include:: /includes/api/api-headers/200.rst

Response Body
~~~~~~~~~~~~~

.. code-block:: json
   :emphasize-lines: 4

   {
     "clusterId" : "{CLUSTER-ID}",
     "excludedNamespaces" : [ ],
     "groupId" : "{PROJECT-ID}",
     "links" : [],
     "sslEnabled" : false,
     "statusName" : "STOPPED",
     "storageEngineName" : "WIRED_TIGER"
   }
