title: Copy Configuration Files
stepnum: 1
ref: copy-config-files
pre: |
  Use the following sequence of commands to move the SNMP
  configuration files to the SNMP service configuration directory.

  First, create the SNMP configuration directory if needed and then, from
  the installation directory, copy the configuration files to the SNMP
  service configuration directory:
action:
  language: sh
  code: |
    mkdir -p /etc/snmp/
    cp MONGO-MIB.txt /usr/share/snmp/mibs/MONGO-MIB.txt
    cp mongod.conf.subagent /etc/snmp/mongod.conf
post: |
  Edit the new ``mongod.conf`` using instructions in that file, to
  ensure that:

  - The ``agentXAddress`` socket matches the ``agentXAddress`` in the
    SNMP master configuration file. The configuration filename
    is tool-dependent. For example, when using ``net-snmp`` the
    configuration file is ``snmpd.conf``.

  - SNMP uses TCP rather than UNIX Domain Sockets.
---
title: Start MongoDB
stepnum: 2
ref: start-with-snmp
pre: |
  Start |mongod-program| with the :setting:`snmp-subagent` to send data
  to the SNMP master.
action:
  language: sh
  code: mongod --snmp-subagent
---
title: Test SNMP
stepnum: 3
ref: test-snmp
optional: true
action:
  - heading: Confirm Data Retrieval
    pre: |
      Use ``snmpwalk`` to collect data from |mongod-program|:

      Connect an SNMP client to verify the ability to collect SNMP data
      from MongoDB.

      Install the `net-snmp <http://www.net-snmp.org/>`_ package to access
      the snmpwalk client. ``net-snmp`` provides the ``snmpwalk``
      SNMP client.
    language: sh
    code: |
      snmpwalk -m /usr/share/snmp/mibs/MONGO-MIB -v 2c -c mongodb 127.0.0.1:<port> 1.3.6.1.4.1.34601
    post: |
      ``<port>`` refers to the port defined by the SNMP master,
      *not* the primary :setting:`port` used by |mongod-program| for
      client communication.
  - heading: Run as SNMP Master For Testing
    optional: true
    pre: |
      You can run |mongod-program| with the :setting:`snmp-master`
      option for testing purposes. To do this, use the SNMP master
      configuration file instead of the subagent configuration file. From
      the directory containing the unpacked MongoDB installation files:
    language: sh
    code: |copy-command|
...
