============================
Migrate with ``mongomirror``
============================

.. default-domain:: mongodb


:program:`mongomirror` is a utility for migrating data from an existing
MongoDB replica set to a MongoDB |service| replica set.
:program:`mongomirror` does not require you to shut down your existing replica
set or applications.

.. important::

   :program:`mongomirror` does not import user/role data.

Download ``mongomirror``
------------------------

.. include:: /includes/list-table-mongomirror-downloads.rst

Prerequisites
-------------

Source
~~~~~~

- The source MongoDB deployment must be a replica set. If the source is
  a standalone MongoDB deployment, convert to a replica set first.

- The source MongoDB replica set must be version 3.0 or greater, 
  excluding version 3.6
 
- The source MongoDB replica set cannot be an 
  ``M0`` (Free Tier) or ``M2/M5`` shared cluster.

- You should not change the ``featureCompatibilityVersion`` flag 
  at any time during the procedure.

Target
~~~~~~

- The target |service| cluster must be a replica set.

- The target |service| cluster should be empty or run
  :program:`mongomirror` with the :option:`--drop` option.

- The target |service| cluster cannot be an ``M0`` (Free Tier),
  ``M2``, or ``M5`` shared cluster.

- You should not change the ``featureCompatibilityVersion`` flag 
  at any time during the procedure.

Procedure
---------

.. include:: /includes/steps/migrate-using-mongomirror-1.rst

When you start :program:`mongomirror`:

#. First, :program:`mongomirror` performs an initial sync, copying
   collections from the existing MongoDB replica set to the target cluster
   in |service|. :program:`mongomirror` does not copy the ``config``
   database.

#. After the initial sync, :program:`mongomirror` continuously
   tails the replica set's oplog for incoming changes and replays
   them on the target cluster in MongoDB |service|. See
   :ref:`mongomirror-import-oplog-entries`.

Once started, :program:`mongomirror` runs continuously until you shut
down the process. To fully migrate to the |service|, continue on to
:ref:`mongomirror-migrate-to-atlas` steps.

.. _mongomirror-migrate-to-atlas:

Switch to |service|
-------------------

After the :program:`mongomirror` has performed the initial sync and has
been tailing the replica set's oplog,  to switch over to |service|
cluster:

.. include:: /includes/steps/migrate-using-mongomirror-2.rst

.. _mongomirror-import-oplog-entries:

``oplog`` Entries
-----------------

.. include:: /includes/fact-mongomirror-oplog.rst

Additional Information
----------------------

For more information on :program:`mongomirror`, including behavior,
options, and examples, see the :program:`mongomirror reference page
<mongomirror>`.

.. class:: hidden

   .. toctree::
      :titlesonly:

      /reference/mongomirror
