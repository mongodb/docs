.. _8.0.14-changelog:

8.0.14 Changelog
----------------

Replication
~~~~~~~~~~~

:issue:`SERVER-103841` Memory leak in TransactionCoordinator associated
to long-lived cancellation source

Schema
~~~~~~

:issue:`WT-14140` Unnecessary schema lock taken for active "file:"
dhandles that are not swept

Aggregation
~~~~~~~~~~~

:issue:`SERVER-88046` Support $vectorSearch execution within unionWith
subpipeline

Storage
~~~~~~~


WiredTiger
``````````

- :issue:`WT-14653` Add logs/stats to reconciliation for tracking HS
  updates
- :issue:`WT-14843` Add stats to track eviction pages seen and queued
- :issue:`WT-14932` Build Framework for Unique WT Verbose IDs & Update
  Critical Atlas Log Rules
- :issue:`WT-14978` Add diagnostic information to durable timestamp
  assertion

Internals
~~~~~~~~~

- :issue:`SERVER-82019` Create feature flag
- :issue:`SERVER-84314` Add more diagnostic server metrics to queryStats
- :issue:`SERVER-86727` Consider changing
  MigrationDestinationManager::cloneCollectionIndexesAndOptions to not
  take DB MODE_X lock
- :issue:`SERVER-89316` Coverity analysis defect 140316: Out-of-bounds
  read
- :issue:`SERVER-91200` Add end-to-end ranked fusion test using existing
  syntax
- :issue:`SERVER-91201` Add end-to-end score fusion test using existing
  syntax
- :issue:`SERVER-91278` Allow sorting by more kinds of metadata
- :issue:`SERVER-91279` Add example rank fusion tests which use
  $setWindowFields
- :issue:`SERVER-91281` Allow $rank and $denseRank window functions to
  operate without a SortKeyPattern
- :issue:`SERVER-91907` Create skeleton of DocumentSourceRankFusion
- :issue:`SERVER-91909` Implement basic parsing of $rankFusion
- :issue:`SERVER-91911` Add validation that $rankFusion subpipelines are
  valid
- :issue:`SERVER-91912` Test auth for $rankFusion stage
- :issue:`SERVER-92115` Address time out issues with
  external_data_source.js
- :issue:`SERVER-92213` Implement desugaring of $rankFusion
- :issue:`SERVER-92243` sbe::SplillingStore gives up under cache
  pressure
- :issue:`SERVER-92244` Create Feature Flag for Milestones 1 and 2
- :issue:`SERVER-92357` Create js testing strategy for search scoring
  differences in sharded vs non-sharded configurations
- :issue:`SERVER-92446` Update with $where requires additional
  privileges
- :issue:`SERVER-93153` Emit startIndexBuild change event
- :issue:`SERVER-93391` Remove rankConstant field from $rankFusion
- :issue:`SERVER-93576` Remove vector embeddings from $vectorSearch
  explain
- :issue:`SERVER-93672` Fix concat error in multiversionconstants.py
- :issue:`SERVER-93673` Mount redhat license keys to ubi7 containers in
  package_test
- :issue:`SERVER-93874` $group on time-series collections can produce
  rounded results due to bucket control rounding
- :issue:`SERVER-94603` Add 'weights' argument to $rankFusion
- :issue:`SERVER-94653` Consolidate multiversion binaries search for
  multiversion tests
- :issue:`SERVER-94660` Test $rankFusion query shape and stable API
  restrictions
- :issue:`SERVER-94668` POC 'scoreDetails' for $score
- :issue:`SERVER-94669` Implement 'scoreDetails' for $rankFusion
- :issue:`SERVER-94787` Avoid abandoning the snapshot explicitly in
  CollectionScan
- :issue:`SERVER-94841` Implement 'score' for $score
- :issue:`SERVER-95162` Refactor multiversion query test to make it more
  re-usable
- :issue:`SERVER-95164` Allow more than 2 input pipelines for
  $rankFusion
- :issue:`SERVER-95168` Implement $setWindowFields version of desugaring
  for $rankFusion
- :issue:`SERVER-95169` Add multiversion query test which stresses
  sharded scenarios
- :issue:`SERVER-96056` Validate that variants respect tags like
  requires_large_host
- :issue:`SERVER-96064` Optimize away $sort directly after $vectorSearch
  for single node environments
- :issue:`SERVER-96127` Adjust $rankFusion syntax to adopt
  'input.pipelines' revision
- :issue:`SERVER-96154` Validate field names for 'inputs.pipelines' and
  'weights'
- :issue:`SERVER-96736` Switch $rankFusion to use
  'featureFlagSearchHybridScoringPrerequisites'
- :issue:`SERVER-96764` Create geoNear index in rankFusion auth test
- :issue:`SERVER-96792` Allow {$meta: "score"} to return any kind of
  score metadata
- :issue:`SERVER-96793` Allow {$meta: "scoreDetails"} to return any kind
  of scoreDetails metadata
- :issue:`SERVER-96835` Update commands_lib.js rankFusion pipeline to
  new syntax.
- :issue:`SERVER-97102` Stress test dependency tracking for {$meta:
  "scoreDetails"} for pipelines spanning across sharded network split
- :issue:`SERVER-97103` Allow sorting by {$meta: "score"}
- :issue:`SERVER-97104` Restrict {$meta: "scoreDetails"} to
  featureFlagRankFusionFull and apiStrict=false
- :issue:`SERVER-97189` $rankFusion and $scoreFusion are missing parsing
  assertions
- :issue:`SERVER-97201` Add a metric in FTDC for replication coordinator
  mutex wait time
- :issue:`SERVER-97339` Implement serialization and query shape testing
  for $score
- :issue:`SERVER-97645` Refactor serializeTransformation to remove
  redundant explain parameter
- :issue:`SERVER-97915` Create feature flag for earlier $rankFusion
  milestone
- :issue:`SERVER-97917` Move $rankFusion to be guarded under
  featureFlagRankFusionBasic
- :issue:`SERVER-97919` Enable featureFlagRankFusionBasic by default
- :issue:`SERVER-98322` Improve field path validation error messages
- :issue:`SERVER-98343` $rankFusion seg faults if given empty pipeline
- :issue:`SERVER-98453` Refactor $sort to make it easier to add a new
  option
- :issue:`SERVER-98994` Make featureFlagRankFusionBasic FCV-gated
- :issue:`SERVER-99153` $rankFusion scoreDetails should error if not
  requested by top-level pipeline (but specified in inner)
- :issue:`SERVER-99169` score cannot be used when not defined
- :issue:`SERVER-99210` $rankFusion should reject duplicate
  input.pipelines names
- :issue:`SERVER-99335` Support projecting textScore with $meta: score
- :issue:`SERVER-99505` Refactor string building in
  document_source_rank_fusion.cpp
- :issue:`SERVER-99589` Consolidate metadata dependency tracking of
  search and non-search metadata
- :issue:`SERVER-99596` Refactor how metadata dependencies are validated
- :issue:`SERVER-99674` Change $rankFusion weights object to accept a
  subset of pipelines specified
- :issue:`SERVER-99675` Improve feedback for misspelled $rankFusion
  pipelines in weights object
- :issue:`SERVER-99732` Switch sort key metadata assertion to tassert
  (from invariant)
- :issue:`SERVER-99773` Bucket-level $group rewrite on sharded TS
  collection is not performed on shards
- :issue:`SERVER-99887` $setWindowFields can fail when spilling to disk
- :issue:`SERVER-100045` Add property-based test for metadata field
  dependency validation
- :issue:`SERVER-100107` Add "description" and "weight" to $rankFusion
  scoreDetails
- :issue:`SERVER-100203` Change scoreDetails to use array rather than
  object
- :issue:`SERVER-100394` Validation of score $meta field is skipped for
  mongot queries
- :issue:`SERVER-100448` Command registration should not depend on the
  FCV at startup
- :issue:`SERVER-100546` Handle deps tracking generically in
  DocumentSourceFacet::getDependencies()
- :issue:`SERVER-100678` scoreDetails cannot be used when not defined
- :issue:`SERVER-100752` $rankFusion should output score metadata
- :issue:`SERVER-100799` Guard meta_dependency_validation.js on
  featureFlagRankFusionFull
- :issue:`SERVER-100948` Re-enable scoreDetails "value" field
- :issue:`SERVER-101155` Run search e2e metadata tests in the search
  passthroughs
- :issue:`SERVER-101178` Apply important upstream ICU fixes to our
  vendored copy
- :issue:`SERVER-101342` Coverity analysis defect 170504: Overflowed
  constant
- :issue:`SERVER-101568` $rankFusion should reject scoreDetails: true
  unless FF is on
- :issue:`SERVER-101653` Do not allow rankFusion to run on views
- :issue:`SERVER-101701` $rankFusion must be the first stage of the
  pipeline
- :issue:`SERVER-101702` Add tests for $rankFusion in $lookup/$unionWith
  subpipelines
- :issue:`SERVER-101781` Reject $rankFusion in a view definiton
- :issue:`SERVER-101827` Adjust sbe genericAbs to return nan when called
  with a nan operand
- :issue:`SERVER-102266` 7.0 -- Coverity analysis defect 169977: Data
  race condition
- :issue:`SERVER-102449` Remove unnecessary clearDbInfo in DDLs and rely
  on the implicit clear of the release of the critical section
- :issue:`SERVER-102728` Audit rankFusion's scoreDetails testing
- :issue:`SERVER-102983` Logical initial sync reports compounding index
  build memory use
- :issue:`SERVER-103572` Split tasks for required build variants into
  smaller execution units
- :issue:`SERVER-103715` Add test coverage for scenarios in which we
  have garbage entries in config.databases
- :issue:`SERVER-103742` opWriteConcernCounters can illegally embed a
  NUL bytes into ServerStatus
- :issue:`SERVER-104636` Do not serialize _internalOutputSortKeyMetadata
  in query shape hash
- :issue:`SERVER-104730` Explicitly ban nested $rankFusions and
  $scoreFusions
- :issue:`SERVER-104839` Add a new log line that contains both metadata
  and authentication info
- :issue:`SERVER-105263` Resmoke blocks completion of passing tests on
  symbolization of failing tests from other jobs
- :issue:`SERVER-105358` Modify hybrid search input pipeline validation
  to analyze pre-desugared stages
- :issue:`SERVER-105424` Handle yield and restore in direct shard
  connection warnings
- :issue:`SERVER-105478` Separate eligible and ineligible oplog entries
  for the applier with secondaryDelaySecs
- :issue:`SERVER-105519` Make ppc always install fresh venv
- :issue:`SERVER-106351` Split mixed_mode_sharded_nossl to prevent
  timeouts
- :issue:`SERVER-106602` BatchWriteOp should use set when tracking
  statement ids
- :issue:`SERVER-106606` Upgrade mongo-task-generator to v3.4.1
- :issue:`SERVER-106682` TransactionCoordinator member variables hold
  mutexes too long
- :issue:`SERVER-106875` Really deregister all collections when closing
  CollectionCatalog
- :issue:`SERVER-107211` Re-add $v:1 oplog support to Atlas v8
- :issue:`SERVER-107409` View definitions with stages that include
  $rankFusion with subpipelines are not getting disallowed
- :issue:`SERVER-107693` [v8.0] Backport Hybrid Search Rank Fusion
- :issue:`SERVER-107852` Server SBOM rebuild to master/v8.x/v7.0
- :issue:`SERVER-107954` Update evergreen-py in 8.0 branch to fix retry
  logic
- :issue:`SERVER-108052` DocumentSourceInternalSetWindowFields doesn't
  have sort key metadata in bounded sorts
- :issue:`SERVER-108154` Coverity analysis defect 151472: Overflowed
  constant
- :issue:`SERVER-108371` Upgrade our required patch builds to use the
  atlas ami
- :issue:`SERVER-108800` Use retryable session for config writes in
  check_metadata_consistency.js
- :issue:`SERVER-108896` Split mixed_mode_sharded_transition to prevent
  timeouts
- :issue:`SERVER-108902` backport hydration tasks to 8.0
- :issue:`SERVER-108970` Upgrade db-contrib-tool to 2.0.1
- :issue:`SERVER-109624` [v8.0] Port $_isRankFusion aggregate command
  rename to 8.0
- :issue:`SERVER-109721` [v8.0] Write the expansions as part of
  package_supplementary_data
- :issue:`SERVER-109980` validate the resumeToken for $_startAt in
  aggregate
- :issue:`SERVER-109986` Enable rank fusion feature flag only in
  relevant tests
- :issue:`SERVER-110161` Correct $_startAt behavior to stop skipping
  documents
- :issue:`SERVER-110377` crypt_shared 8.0.14-rc0 fails to load on Ubuntu
  20.04
- :issue:`WT-13746` Conflict between RTS and eviction regarding
  btree->rec_max_timestamp (take 2)
- :issue:`WT-14968` Remove the checkpoint cleanup wait after each file
  process
- :issue:`WT-15251` Skip test_sweep04 on 8.0

