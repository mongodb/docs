==========
Monitoring
==========

.. meta::
   :description: Troubleshoot monitoring issues in Ops Manager, including server startup, alert management, and deployment visibility problems.

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol


.. "Ops Manager Installation:"

.. include:: /includes/extracts/troubleshooting-onprem-installation.rst

Alerts
------

For resolutions to alert conditions, see also :doc:`/tutorial/nav/alert-resolutions`.

For information on creating and managing alerts, see
:doc:`/tutorial/manage-alert-configurations` and
:doc:`/tutorial/manage-alerts-and-events`.

Cannot Turn Off Email Notifications
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

There are at least two ways to turn off alert notifications:

- Remove the deployment from your |mms| account. See :doc:`/tutorial/unmanage-deployment`.

- Disable or delete the alert configuration. See
  :doc:`/tutorial/manage-alert-configurations`.

- Turn off alerts for a specific host. See
  :ref:`manage-host-alerts`.

Receive Duplicate Alerts
~~~~~~~~~~~~~~~~~~~~~~~~

If the notification email list contains multiple email-groups, one or
more people may receive multiple notifications of the same alert.

.. _open-file-limits:

Receive "Host has low open file limits" or "Too many open files" error messages
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

These error messages appear on the :guilabel:`Deployment` page, under
a host's name. They appear if the number of available connections does
not meet the |mms|-defined minimum value. These errors are not
generated by the :binary:`~bin.mongos` instance and, therefore, not
appear in :binary:`~bin.mongos` log files.

On a host by host basis, the {+magent+} compares the number of
open file descriptors and connections to the maximum connections
limit. The max open file descriptors ulimit parameter directly affects
the number of available server connections. The agent calculates
whether or not enough connections exist to meet the |mms|\-defined
minimum value.

In ping documents, for each node and its ``serverStatus.connections``
values, if the sum of the ``current`` value plus the ``available``
value is less than the ``maxConns`` configuration value set for a
monitored host, the {+magent+} will send a
:guilabel:`Host has low open file limits` or
:guilabel:`Too many open files` message to |mms|.

Ping documents are data sent by {+magent+}s to |mms|. To view
ping documents:

.. include:: /includes/extracts/admonition-pii-user-role.rst

#. Click the :guilabel:`Deployment` page.

#. Click the host's name.

#. Click :guilabel:`Last Ping`.

To prevent this error, we recommend you set ``ulimit`` open files to
``64000``. We also recommend setting the ``maxConns`` command in {+mongosh+}
to at least the recommended settings.

To learn more, see
:manual:`the MongoDB ulimit reference page </reference/ulimit>` and
the :manual:`the MongoDB maxConns reference page </reference/configuration-options/#maxConns>`.

Deployments
-----------

{+magent+} Fails to Collect Data
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Possible causes for this state:

- The {+magent+} can't connect to the server because of
  networking restrictions or issues (i.e. firewalls, proxies,
  routing.)

- Your database is running with |tls|. You must enable |tls| either
  globally or on a per-host basis. To learn more, see
  :ref:`configure-tls-mdbagent` and
  :ref:`enable-tls-for-deployment`.

- Your database is running with authentication. You must supply
  |mms| with the authentication credentials for the host. See
  :doc:`/tutorial/edit-host-authentication-credentials`.

Deployments Aren't Visible
~~~~~~~~~~~~~~~~~~~~~~~~~~

The following factors can cause problems with the {+magent+} detecting 
deployments:

Deployment Not Added
````````````````````

To fix this issue:

1. Click :guilabel:`Deployment`.
#. Click the :guilabel:`Processes` tab
#. Click :guilabel:`Add Deployment`.
#. In the :guilabel:`New Deployment` window, specify the following 
   values:

   - deployment type
   - internal hostname
   - internal port

#. If appropriate: 

   - Add the database username and password.
   - Enable |tls| to connect with your {+magent+}. 

.. note::

   You don't need to restart your {+magent+} when you
   add (or remove) a deployment.

Accidental Duplicate mongod 
```````````````````````````

If you add the deployment after a crash and restart the
{+magent+}, you might not see the hostname on the
:guilabel:`Deployment` page. |mms| detects the deployment as a
duplicate and suppresses its data. 

To reset:

1. Click :guilabel:`Settings`.
#. Click :guilabel:`Project Settings`.
#. Click :guilabel:`Reset Duplicates`.

{+magent+}s Can't Detect Deployments
`````````````````````````````````````

If your deployments exist across multiple data centers, ensure
that all of your deployments can be discovered by all of your
{+magent+}s.

Can't Delete a Deployment
~~~~~~~~~~~~~~~~~~~~~~~~~

In rare cases, the :binary:`~bin.mongod` is brought down and the
replica set is reconfigured. The down deployment can't be deleted
and returns the following error message:

.. warning:: 
      
   This deployment cannot be deleted because it is enabled 
   for backup.

Contact |mdb-support| for help with deleting these deployments.

Projects
--------

Additional Information on Projects
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Create a project to monitor additional segregated systems or
environments for servers, agents, users, and other resources.

.. example::

   Firewalls may separate your deployment among two or more
   environments. In this case, you would need two or more separate
   |mms| projects.

|api| keys are unique to each project. Each project requires its own agent with the appropriate |api| keys. Within each project, the agent needs to be able to connect to all hosts it monitors in the project.

To learn more about creating and managing projects, see
:doc:`/tutorial/manage-projects`.
