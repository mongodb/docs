==========================================
Install the Monitoring Agent on UNIX/Linux
==========================================

.. index:: requirements; full
.. _mms-requirements:

Requirements and Prerequisites
------------------------------

.. start-requirements-content 

|monitoring| has a series of prerequisite requirements. The following
sections will guide you through the requirements and provide basic
instructions for fulfilling them.

Basic |monitoring| Requirements
```````````````````````````````

- Your MongoDB instances (i.e. ``mongod`` and ``mongos``) must be
  version 1.6 or newer.

.. index:: requirements; Python

- You must have Python 2.4 or greater.

   .. note::

      The Monitoring agent does not provide support the PyPy implementation
      of Python, and does not support the Python 3.x series of Python.

.. index:: requirements; setuptools
   single: setuptools

- You'll need Python's `setuptools <http://pypi.python.org/pypi/setuptools>`_.

  Most operating systems (i.e. distributions) package setuptools. For
  example, Debian and Ubuntu users can use the following command to
  install the package: ::

        sudo apt-get install python-setuptools

  For Red Hat Enterprise Linux (RHEL) CentOS, or Fedora users, the the
  following command will install the package: ::

        sudo yum install python-setuptools

.. index:: hmac
   single: requirements; Python 2.4 Installation

- If your system is running Python 2.4, you will need to install the
  following Python modules:

   - ``hmac``
   - ``hashlib``

  Issue the following command: ::

    sudo easy_install hmac hashlib

  .. index:: simplejson
     single: requirements; For Python 2.5

  .. note::

     The latest version of the Monitoring agent includes no other
     Python module dependencies. If you're installing version 1.4 of
     the agent (legacy) you will also need to install the
     ``simplejson`` module.

     For users of Python 2.4, you will need to install ``simplejson``
     version 2.1.0. Install this module with the following command: ::

         sudo easy_install simplejson==2.1.0

     For users of Python 2.5, you will need to install the simplejson
     with the following command: ::

         sudo easy_install simplejson

     Do not use ``pip`` to install modules when using Python 2.4 or
     2.5, as there are some compatibility issues. Some users have
     reported problems installing ``hmac``, if ``easy_install``
     produces an error or you suspect a problem with these libraries
     see :ref:`instructions for installing hmac manually
     <troubleshooting-hmac>`.

.. index:: requirements; PyMongo Installation

- All users must install `PyMongo  <http://pypi.python.org/pypi/pymongo/>`_,
  the Python driver for MongoDB. 

  For optimal speed and stability, use the most recent version of
  PyMongo. The agent is not compatible with versions of PyMongo before
  1.9. For instructions for installing PyMongo, see :doc:`Installing
  PyMongo </monitoring/tutorial/install-pymongo>`.
      
.. index:: troubleshooting; proxies

- If your datacenter requires that you proxy outbound connections
  through a gateway, you must use a version of Python greater than
  2.6.1. Additionally, you will need export the "``https_proxy``"
  environment variable (or "``HTTPS_PROXY``" on Windows). For more
  information, see ":ref:`Working with Proxies <troubleshooting-proxies>`".

Consider the ``README`` file distributed with the agent for more
information. When all dependencies are successfully installed, you may
proceed to installing the agent.

.. end-requirements-content

.. index:: installation; UNIX/Linux

Install Monitoring Agent Software
---------------------------------

.. start-install-content

.. include:: /includes/install-saas-registration.rst

If you have not downloaded the Monitoring agent already, you can 
click the "Settings" link immediately after you sign into MMS
(i.e. <http://mms.mongodb.com>), and then select :guilabel:`Monitoring Agent`
from the left-hand list to download an agent specifically
configured for your account. 

You can run the agent on any system that can connect to the MongoDB
instances you want to monitor. As long as it can connect to each
instance, you can use a single agent to do all the monitoring. Do be
sure that the agent can make outgoing connections via HTTPS on port
443.

   .. note:: 
   
      The Monitoring agent does have some resource requirements and
      should run on separate systems to avoid impacting ``mongod`` and
      ``mongos`` performance. To monitor five or fewer nodes, you can
      safely deploy on an AWS "micro instance." Similarly, if you are
      only monitoring a small number of databases, you may be able to
      deploy the agent on the system running the ``mongos`` process.
      Running PyMongo with the native extensions, which requires GCC,
      provides significant performance improvements.

Unzip the archive and run the agent with the following command: ::

     python agent.py

This starts two processes: a parent to monitor the agent daemon and
perform automatic upgrades and a child process to collect data.

.. warning:: If your MongoDB instance has thousands of databases or
   collections, you will want to disable database statistics
   collection. See ":ref:`Database and Collection statistics
   <db-stats-warning>`" for more information.

.. end-install-content

.. _automated-agent-installation:

Automate Agent Deployments
--------------------------

The agent you downloaded from the |mms| site is automatically
configured with the credentials for your account. You can download a
configured copy of the Monitoring agent by copying the link available
in the "Group Settings" section of the "Settings" tab of the MMS
console. This link will resemble the following: ::

      https://mms.mongodb.com/settings/mmsAgent/<hash>/10gen-mms-agent-<group-name>.zip

Alternately, you may automate Monitoring agent deployments using an
unconfigured agent, and the API and secret keys from the "API Key" and
"Secret Key" sections of the settings page. The unconfigured agent is
available at the following URL: ::

      https://mms.mongodb.com/settings/10gen-mms-agent.zip

Unzip this archive and edit the ``settings.py`` file. Replace the
strings "``@API_KEY@``" and "``@SECRET_KEY@``" with the "API" and
"Secret Keys" defined for your account. You can find these
in the "Settings" page of the MMS console.

You may embed this process in your existing deployment scripts to
automatically install or redeploy new agents.

Next Steps
----------

Now that you have installed the Monitoring agent software, you can
:doc:`deploy the Monitoring agent in production
</monitoring/tutorial/deploy-mms-in-production>`.

