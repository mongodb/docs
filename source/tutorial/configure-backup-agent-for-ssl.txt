==============================
Configure Backup Agent for SSL
==============================

.. default-domain:: mongodb

If your MongoDB deployment uses SSL, then you must configure the Backup
Agent to use SSL to connect to your deployment's :program:`mongod` and
:program:`mongos` instances.

Configuring the agent to use SSL involves specifying which certificate to
use to sign MongoDB certificates and turning on the SSL option for the
MongoDB instances in |mms|.

.. COMMENT  -- can we remove this.  This was a prerequisite before, so 
   I moved it up here since that shouldn't be a prerequisite for the agent

.. note::

   The default distribution of MongoDB does **not** contain support for
   SSL. To use SSL, you must either use `MongoDB Enterprise
   <https://www.mongodb.com/products/downloads/mongodb-enterprise>`_ or
   you must build locally MongoDB, enabling SSL support during the
   compile.

Prerequisite
------------

To configure the agent to use SSL, you must have a trusted CA
certificate that signed the MongoDB instance's certificate.

Procedure
---------

Edit the agent configuration file to set the
``sslTrustedServerCertificates`` field to the path of a file containing
one or more certificates in PEM format. For example:

.. code-block:: ini

   sslTrustedServerCertificates=/path/to/mongodb-certs.pem

The agent configuration file is located in either the agent install
directory or the ``/etc/mongodb-mms/`` directory, depending on your
operating system.

By default, to connect to MongoDB instances using SSL requires a valid
trusted certificate. For testing purposes, however, you can set the
:bsetting:`sslRequireValidServerCertificates` setting to ``False`` to
bypass this check. This configuration is **not** recommended for
production use as it makes the connection insecure.

For additional information on these settings, see
:ref:`backup-mongodb-ssl-settings`.
