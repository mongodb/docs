stepnum: 1
level: 4
source:
  file: steps-source-backup-tab.yaml
  ref: select-backup-tab-overview-page
---
stepnum: 2
level: 4
source:
  file: steps-source-prepare-restore-snapshot.yaml
  ref: click-deployment-select-restore
---
stepnum: 3
title: "Select the restore point."
level: 4
ref: select-shard-pit
content: |

  a. Choose the :guilabel:`Snapshot` from which you want to restore
     your backup.

  b. Click :guilabel:`Next`.

---
title: "Click :guilabel:`Download` to restore the files manually."
stepnum: 4
level: 4
ref: select-restore-method

---
stepnum: 5
level: 4
source:
  file: steps-source-download-restore-snapshot.yaml
  ref: select-restore-destination
---
stepnum: 6
title: "Retrieve the snapshots."
level: 4
ref: retrieve
content: |

  |mms| creates links to the snapshot. By default, these links are
  available for an hour and can be used just once.

  To download the snapshots:

  a. If you closed the restore panel, click :guilabel:`Backup`, then
     :guilabel:`Restore History`.

  b. When the restore job completes, click :guilabel:`(get link)`
     for each :term:`shard` and for one of the :term:`config servers
     <config server>` appears.

  c. Click:

     - The copy button to the right of the link to copy the link to
       use it later, or
     - :guilabel:`Download` to download the snapshot immediately.

---
stepnum: 7
title: "Restore the snapshot data files to the destination host."
level: 4
ref: copy
content: |
  Extract the snapshot archive for the :term:`config server` and for
  each :term:`shard` to a temporary location.

  .. example::

     .. code-block:: sh

        tar -xvf <backupSnapshot>.tar.gz
        mv <backupSnapshot> <temp-database-path>
---
stepnum: 8
title: "Copy the completed snapshots to restore to other hosts."
level: 4
ref: distribute
content: |

  - For the config server, copy the restored config server database to
    the working database path of each :term:`replica set` member.

  - For each shard, copy the restored shard database to the working
    database path of each replica set member.

---
stepnum: 9
title: "Unmanage the Sharded Cluster."
level: 4
ref: unmanage
content: |

  Before attempting to restore the data manually,
  :doc:`remove the sharded cluster from Automation
  </tutorial/unmanage-deployment>`.

---
stepnum: 10
title: "Restore the Sharded Cluster Manually."
level: 4
ref: restore-manually
content: |

  Follow the tutorial from the MongoDB Manual to
  :manual:`restore the sharded cluster </tutorial/restore-sharded-cluster>`.

---
stepnum: 11
title: "Reimport the Sharded Cluster."
level: 4
ref: reimport
content: |

  To manage the sharded cluster with automation again,
  :doc:`import the sharded cluster </tutorial/add-existing-mongodb-processes>`
  back into |mms|.

---
stepnum: 12
title: "Start the Sharded Cluster Balancer."
level: 4
ref: start-balancer
content: |

  Once a restore completes, the
  :manual:`sharded cluster balancer </core/sharding-balancer-administration>`
  is turned off. To start the balancer:

  a. Click :guilabel:`Deployment`.
  #. Click :icon:`ellipsis-h` on the card for your desired sharded
     cluster.
  #. Click :guilabel:`Manager Balancer`.
  #. Toggle to :guilabel:`Yes`.
  #. Click :icon:`pencil-alt` to the right of :guilabel:`Set the Balancer State`.
  #. Toggle to :guilabel:`Yes`.
  #. Click :guilabel:`Save`.
  #. Click :guilabel:`Review & Deploy` to save the changes.

...

