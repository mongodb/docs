======================================
On-Prem MMS System Administration Tool
======================================

.. default-domain:: mongodb

Overview
--------

|mms| includes a tool to view system status and perform administrative
tasks, for example, set cron jobs and manage users and groups.

If you have administrative privileges, click the :guilabel:`Admin` link in
the top right corner of MMS to access the system administration tool.

The Admin page includes these main sections and tabs:

- The default tab is the Overview tab which provides a system overview.
  Messages, Reports, Users, and Groups tabs provide additional functionality.

- The Backup section includes tabs for Jobs, Logs, Daemons, Blockstores,
  Grooms, Job Timeline, and Provisioning.

- The Control Panel section includs tabs for Cron Jobs, Ping Throttling,
  Send Test Email, and Send Test SMS.

General Tabs
------------

Overview
~~~~~~~~

This tab displays the Total Pages Viewed and Total Chart Requests charts,
as well as a summary table with total groups, total users, active groups,
active users, ping spillover queue, and increment spillover queue.

Messages
~~~~~~~~

You can display a short message on any page of the MMS application to
notify or remind users.

The :guilabel:`Messages` tab lists all messages with a :guilabel:`+ Add
Message` button to add messages. At the top right of the page is a search
box to find a message.

To add a message which appears on one page, or on all pages, click the
:guilabel:`+ Add Message` button and enter the message and page or page
prefix in the :guilabel:`Add Message` interface. Click the Active checkbox
to make the message live. Click the :guilabel:`Add` button to add the
message.

For example, entering the page prefix ``/settings/profile`` will display a
message on the default :guilabel:`Settings` page and :guilabel:`Profile`
tab but not on any other page or tab in the application. Messages take 60
seconds before they display.

To disable a message, click the orange square button to the right of any
alert listed on the :guilabel:`Messages` tab. The orange button will
change to a grey button which, when clicked, enables the message and makes
it active again.

To delete a message, click the garbage can icon to the right of any alert
listed on the :guilabel:`Messages` tab.

Reports
~~~~~~~

This tab displays a form to build a query and generate a report. The
report is in CSV format and zipped. Reports can specify MongoDB Versions,
whether or not to report active hosts, CS Customers only, and fields to
include in the report.

Click the :guilabel:`Generate Report` button at the bottom of the form to
compile then download report results.

Users
~~~~~

The :guilabel:`Users` tab displays a list of all people permissioned to
use the |mms| application, in addition to their username, admin role(s),
last login, last access, login count, time zone, and date/time created. At
the top right of the page is a search box to find a user record.

To edit a user record, click the pencil icon to the far right of a name.
In the :guilabel:`Edit User` interface, edit their information for
two-factor authentication, profile, and groups and roles. Click the
:guilabel:`Lock Account` checkbox to lock their account. Click the
:guilabel:`Clear Two Factor Auth` checkbox to reset their two-factor
authentication credentials. When you're finished, click the
:guilabel:`Save` button to save any changes and exit.

Groups
~~~~~~

The :guilabel:`Groups` tab lists all groups created with their date
created and the last date and time an agent for the group pinged MMS. At
the top right of the page is a search box to find a group by name.

Click a group name to go directly to the group pages in MMS. To return to
the system administration tool, click the browser back button or click the
:guilabel:`Admin` link in the top right of any page.

Backup Tabs
-----------

Jobs
~~~~

You can see all active and stopped backup agent jobs on the
:guilabel:`Jobs` tab. For each backup job, the tab lists job group, name,
last agent conf, last oplog, head time, last snapshot, what the agent is
working on, the daemon, and the blockstore.

Click the group name to go directly to the backup job page for the group.
To return to the system administration tool, click the browser back button
or click the :guilabel:`Admin` link in the top right of any page.

Click the job name to see the results of the job on a detail page. On the
job detail page, click links to see the logs, resource usage, conf call,
and download the JSON files as a zipped archive file.

Logs
~~~~

The :guilabel:`Logs` tab lists backup logs by job and class with messages
grouped and counted by last 2 hours, last day, and last 3 days. Click a
count number to see all messages in the group.

Daemons
~~~~~~~

This tab lists all active backup daemons, as well as the ability to
pre-configure a new backup daemon.

For each backup daemon, this tab lists the server name, configuration,
head space used, head space free, the number of replica sets backed up,
the percentage of time the backup agent was busy, and job runtime counts
by 1 minute, 10 minutes, 60 minutes, less than or equal to 180 minutes,
and greater than 180 minutes.

Click the :guilabel:`Show JSON` link to view the backup daemon JSON. When
JSON displays, click the :guilabel:`View raw runtime data` link under the
code to view raw data. To hide the daemon JSON, click the :guilabel:`Hide
JSON` link.

Click the :guilabel:`Move all heads` link to move the backup daemon head
location. Select the location and click the :guilabel:`Move all heads`
button to move the head.

For each backup daemon, you can select or deselect the assignment, backup
jobs, restore jobs, resource usage, and garbage collection configuration,
as well as select head disk type, SSD or HDD.

To pre-configure a new backup daemon, scroll to the bottom of this tab and
type the <machine>:<root head path> in the text field above the
:guilabel:`Pre-Configure New Daemon` button. Click the button to
pre-configure the new backup daemon.

Blockstores
~~~~~~~~~~~

The :guilabel:`Blockstores` tab lists all backup blockstores with the
ability to add a new blockstore.

To update an existing blockstore, edit the <hostname>:<port>, MongoDD Auth
Username, and MongoDB Auth Password. Click the Encrypted Credentials
checkbox if the username and password entered above used the
``credentialstool`` for encryption.

To add a blockstore, enter the ``<id>`` and ``<hostname:port>`` in the
text fields above the :guilabel:`Add New Blockstore` button then click the
button to save and add the blockstore.

For all MongoDB connections, enter a single <hostname>:<port> for a
MongoDB standalone or a comma separated list of all replica set members.

Grooms
~~~~~~

This tab lists all active backup groom jobs, bytes saved from recent groom
jobs, and recently finished groom jobs.

For active and recently finished backup groom jobs, the tab lists the
group, job name, savings, running time, stage, total blocks, scanned
blocks as a percent of total (for active jobs), copied blocks as a percent
of total (for finished jobs), direction, blockstore, and machine.

Job Timeline
~~~~~~~~~~~~

The :guilabel:`Job Timeline` tab displays the present and future scheduled
backup agent status for active agents, as well as the ability to search
backup jobs by group, replica set, and machine.

To update the list automatically every 10 seconds, click the
:guilabel:`Auto refresh` checkbox at the top left of the list. Or click
the :guilabel:`Refresh` button to refresh data manually as needed.

To view the backup daemon JSON, click the :guilabel:`Show JSON` link under
the :guilabel:`Group` heading for any backup job. When JSON displays,
click the :guilabel:`View raw runtime data` link under the code to view
raw data. To hide the daemon JSON, click the :guilabel:`Hide JSON` link.

To move the backup daemon head location, click the :guilabel:`Move head`
link under the :guilabel:`Machine` heading for a backup job. Select the
location and click the :guilabel:`Move head` button to move the head.

You can bind a backup job to a head by clicking the Set binding button
under the :guilabel:`Machine` heading for any backup job.

To break the backup job, click the :guilabel:`Break Job` link under the
:guilabel:`Machine` heading for any backup job. To unbreak the backup
job, click the :guilabel:`Unbreak Job` link.

Provisioning
~~~~~~~~~~~~

The :guilabel:`Provisioning` tab lists replica sets and clusters used by
the MMS application and backed up by MMS, as well as the ability to mark
them as provisioned.

Control Panel Tabs
------------------

Cron Jobs
~~~~~~~~~

The :guilabel:`Cron Jobs` tab lists details about all cron jobs in MMS, as
well as the ability to enable or disable cron jobs or run them on demand.

For each cron job, this page lists the name, operational state, last host,
last start date/time, last end date/time, last duration in milliseconds,
and next scheduled run date/time.

To enable or disable a cron job, click the Enabled checkbox to the far
right of any cron job entry. When unchecked, the state will change to
:guilabel:`Manually Disabled`.

To run a cron job on demand, click the :guilabel:`Run Now` button to the
far right of any cron job entry.

Ping Throttling
~~~~~~~~~~~~~~~

You can throttle pings with this tab. This page also lists data about
pings, for example, start, percent, whether or not manual override is
active, last step, healthy count, app server, queue size, and the last
updated date/time.

To throttle a ping, select the :guilabel:`Percent` and :guilabel:`Manual
Override` values at the top of the page, then click the :guilabel:`Go`
button.

Send Test Email
~~~~~~~~~~~~~~~

Use this tab to send a test email with MMS. Fill out the :guilabel:`To`
and :guilabel:`Body` message then click the :guilabel:`Send Email`
button.

Send Test SMS
~~~~~~~~~~~~~

Use this tab to send an SMS message. Fill out the :guilabel:`To` and
:guilabel:`Body` message then click the :guilabel:`Send Email` button.
