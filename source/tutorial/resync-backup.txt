=============
Resync Backup
=============

.. default-domain:: mongodb

Overview
--------

When a backup becomes out of sync with the MongoDB deployment,
|mms| produces a ``Backup requires resync`` alert.
If you receive a ``Backup requires resync`` alert, you must resync the
backup for the specified MongoDB instance.

The following scenarios trigger a ``Backup requires resync`` alert:

- **The Oplog has rolled over.** This is by far the most common case for
  the ``Backup requires resync`` alert and occurs whenever the Backup
  Agent’s :term:`tailing cursor <tailable cursor>` cannot keep up with
  the deployment’s :term:`oplog`. This is similar to when a
  :term:`secondary` falls too far behind the primary in a replica set.
  Without a resync, the Backups will not catch up.

- **Unsafe applyOps**. This occurs when a document that Backup does not
  have a copy of is indicated.

- **Data corruption or other illegal instruction.** This typically
  causes replication, and therefore the backup job, to break. When the
  daemon sees the broken job, it requests a resync.

During the resync, data is read from a secondary in each replica set and
|mms| does not produce any new snapshots.

.. note::

   For production deployments, you should resync all backups annually.

Considerations
--------------

To avoid the need for resyncs, ensure the Backup oplog does not fall behind the
deployment’s oplog. This requires that:

- adequate machine resources are provisioned for the agent, and that

- you restart the |mms| agents in a timely manner following maintenance
  or other downtime.

To provide a buffer for maintenance and for occasional activity bursts,
ensure that the oplog on the :term:`primary` is large enough to contain at
least 24 hours of activity. For more information on the Backup oplog, see
the :ref:`faq-backup`.

Procedures
----------

Use the appropriate procedure below for your deployment type, sharded cluster
or replica set.

Resync a Sharded Cluster
++++++++++++++++++++++++

.. include:: /includes/steps/resync-shard.rst

Resync a Replica Set
++++++++++++++++++++

.. include:: /includes/steps/resync-replica-set.rst
