.. _sort-tutorial:

========================================================
How to Sort Your |fts| Results for Your Perfomance Needs
========================================================

.. default-domain:: mongodb

.. meta::
   :keywords: atlas search, sort your results, sort for speed, sort for precision, sort for speed and precision, stored source option, return stored source, lucene analyzer, search scoring, near operator, wildcard operator, compound operator, compound search queries 
   :description: Learn how to sort your Atlas Search results for speed, precision, or both.

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

.. important:: 

   The procedures in this tutorial might not be sufficient to optimize
   search query performance for all use cases. To provide feedback on
   your use case, use the `MongoDB Feedback Engine
   <https://feedback.mongodb.com/forums/924868-atlas-search/suggestions/45316366-faster-sorting-with-atlas-search>`__.

This tutorial describes the various ways to sort your |fts| results
based on your performance needs. You can sort for speed, precision, or
for both. 

First, this tutorial creates an index with :ref:`static mappings
<static-dynamic-mappings>` for the ``title``, ``year`` and ``released``
fields in the ``sample_mflix.movies`` collection on ``mongot``. It also
uses the :ref:`storedSource <fts-stored-source-definition>` option for
the ``title`` field only. Storing fields on ``mongot`` allows you
to perform interim operations such as sort on documents with a minimum
number of fields and avoid full document lookup in the interim
stages. Then, the tutorial shows how to sort the query results using
the field stored on ``mongot``. 

Before you begin, ensure that your |service| cluster meets the 
requirements described in the :ref:`fts-tutorials-prereqs`.

Create the |fts| Index 
----------------------

In this section, you will create an |fts| index on the ``released``, 
``title``, and ``year`` fields in the ``sample_mflix.movies`` 
collection and configure the ``storesdSource``
option for the ``title`` field to store that field on ``mongot``.

Procedure
~~~~~~~~~

.. include:: /includes/steps/fts-sort-create-index.rst

Sort Your Search Results
------------------------

----------

.. |arrow| unicode:: U+27A4

|arrow| Use the **Select your language** drop-down menu to set the
language of the example in this section.

----------

.. tabs-selector:: drivers

You can sort your search results in multiple ways. The queries in this
section demonstrate how to sort your search results using the
following: 

- :ref:`near-ref` and :ref:`wildcard-ref` operators for querying the data
- :ref:`returnStoredSource <fts-return-stored-source-option>` option for retrieving the 
  field stored on ``mongot``
- :ref:`score options <scoring-ref>` for altering the scores of matching results

Sort Numbers for Speed
~~~~~~~~~~~~~~~~~~~~~~

.. tabs-drivers::

   .. tab:: 
      :tabid: atlas-ui

      .. include:: /includes/steps/fts-sort-speed-tutorial-run-query-atlas-ui.rst

   .. tab:: 
      :tabid: shell

      .. include:: /includes/steps/fts-sort-speed-tutorial-run-query-shell.rst
   
   .. tab:: 
      :tabid: compass

      .. include:: /includes/steps/fts-sort-speed-tutorial-run-query-compass.rst

   .. tab:: 
      :tabid: csharp

      .. include:: /includes/steps/fts-sort-speed-tutorial-run-query-cs.rst
   
   .. tab:: 
      :tabid: nodejs

      .. include:: /includes/steps/fts-sort-speed-tutorial-run-query-nodejs.rst

   .. tab:: 
      :tabid: java-sync

      .. include:: /includes/steps/fts-sort-speed-tutorial-run-query-java.rst
   
   .. tab:: 
      :tabid: go

      .. include:: /includes/steps/fts-sort-speed-tutorial-run-query-go.rst

   .. tab:: 
      :tabid: python

      .. include:: /includes/steps/fts-sort-speed-tutorial-run-query-python.rst

Sort Dates for Speed
~~~~~~~~~~~~~~~~~~~~

.. tabs-drivers::

   .. tab:: 
      :tabid: atlas-ui

      .. include:: /includes/steps/fts-sort-date-tutorial-run-query-atlas-ui.rst

   .. tab:: 
      :tabid: shell

      .. include:: /includes/steps/fts-sort-date-tutorial-run-query-shell.rst
   
   .. tab:: 
      :tabid: compass

      .. include:: /includes/steps/fts-sort-date-tutorial-run-query-compass.rst
   
   .. tab:: 
      :tabid: csharp

      .. include:: /includes/steps/fts-sort-date-tutorial-run-query-cs.rst
   
   .. tab:: 
      :tabid: nodejs

      .. include:: /includes/steps/fts-sort-date-tutorial-run-query-nodejs.rst

   .. tab:: 
      :tabid: java-sync

      .. include:: /includes/steps/fts-sort-date-tutorial-run-query-java.rst
   
   .. tab:: 
      :tabid: go

      .. include:: /includes/steps/fts-sort-date-tutorial-run-query-go.rst

   .. tab:: 
      :tabid: python

      .. include:: /includes/steps/fts-sort-date-tutorial-run-query-python.rst


Sort Strings for Precision
~~~~~~~~~~~~~~~~~~~~~~~~~~

.. note::
 
   This method is highly resource intensive and not recommended in
   production.

.. tabs-drivers::

   .. tab:: 
      :tabid: atlas-ui

      .. include:: /includes/steps/fts-sort-precision-tutorial-run-query-atlas-ui.rst

   .. tab:: 
      :tabid: shell

      .. include:: /includes/steps/fts-sort-precision-tutorial-run-query-shell.rst
   
   .. tab:: 
      :tabid: compass

      .. include:: /includes/steps/fts-sort-precision-tutorial-run-query-compass.rst
   
   .. tab:: 
      :tabid: csharp

      .. include:: /includes/steps/fts-sort-precision-tutorial-run-query-cs.rst
   
   .. tab:: 
      :tabid: nodejs

      .. include:: /includes/steps/fts-sort-precision-tutorial-run-query-nodejs.rst

   .. tab:: 
      :tabid: java-sync

      .. include:: /includes/steps/fts-sort-precision-tutorial-run-query-java.rst
   
   .. tab:: 
      :tabid: go

      .. include:: /includes/steps/fts-sort-precision-tutorial-run-query-go.rst

   .. tab:: 
      :tabid: python

      .. include:: /includes/steps/fts-sort-precision-tutorial-run-query-python.rst

Sort Strings for Speed and Precision
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. tabs-drivers::

   .. tab:: 
      :tabid: atlas-ui

      .. include:: /includes/steps/fts-sort-tutorial-run-query-atlas-ui.rst

   .. tab:: 
      :tabid: shell

      .. include:: /includes/steps/fts-sort-tutorial-run-query-shell.rst
   
   .. tab:: 
      :tabid: compass

      .. include:: /includes/steps/fts-sort-tutorial-run-query-compass.rst
   
   .. tab:: 
      :tabid: csharp

      .. include:: /includes/steps/fts-sort-tutorial-run-query-cs.rst
   
   .. tab:: 
      :tabid: nodejs

      .. include:: /includes/steps/fts-sort-tutorial-run-query-nodejs.rst

   .. tab:: 
      :tabid: java-sync

      .. include:: /includes/steps/fts-sort-tutorial-run-query-java.rst
   
   .. tab:: 
      :tabid: go

      .. include:: /includes/steps/fts-sort-tutorial-run-query-go.rst

   .. tab:: 
      :tabid: python

      .. include:: /includes/steps/fts-sort-tutorial-run-query-python.rst
