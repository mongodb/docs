ref: considerations-onprem-upgrade-3.4
content: |
   .. admonition:: Advisories

      - MongoDB 2.6 is no longer allowed as a backing store. The |onprem|
        Application Database and all Blockstore Snapshot Stores must be
        upgraded to at least MongoDB 3.0.8 before attempting the upgrade
        to |onprem| 3.4.

      - As soon as the upgrade to |onprem| 3.4 is complete, the system
        will begin a background migration of all monitoring data to a new
        schema. This migration requires significant free disk space.
        Before upgrading to |onprem| 3.4 ensure that the data
        partitions for the |onprem| Application Database have at least
        50% free disk space.

   - The Automation endpoints for the API are now whitelist protected.

   - If you have modified the ``mms.conf`` file in your current
     installation, back up this file. This is not a regular practice as
     ``mms.conf`` contains platform and network administration settings
     for Java VM and |mms| network port settings. You must use the new
     ``mms.conf`` file the upgrade installs. Reapply any modifications
     from your backed up copy to the new ``mms.conf`` after completing 
     the upgrade.

---
ref: considerations-onprem-upgrade-2.0
content: |
   Backup Database
     There are data migrations that touch the various backup data
     stores that make up the :ref:`backup-database`. The data stores
     must all be online when you upgrade. Any data stores that are no
     longer in use should be deleted through the |onprem| UI before
     upgrading.

   Backup Daemon
     Beginning with |onprem| 2.0, there is no separate Backup Daemon
     package. The |onprem| package also installs the Backup Daemon.
     When started, the |onprem| package automatically starts two
     services: the |application| and the Backup Daemon. You choose on
     which servers to "activate" the Backup Daemon. The daemon always
     runs, but it performs no operations unless activated.

     After upgrade, a server that runs **only** the |application| continues to do so but now also runs a "dormant" Backup Daemon service. The Backup Daemon remains dormant as long as you do not activate it.

     A server that runs **only** a Backup Daemon runs |onprem| with an "activated" Backup Daemon and a "dormant" |application|. The |application| remains dormant as long as you do not direct HTTP traffic to it.

   Backup HTTP Service
     Beginning with |onprem| 2.0, there is no Backup HTTP Service on
     port 8081. Any Backup Agents that are managed by Automation will
     be automatically updated to use the new port, 8080. For Backup
     Agents that were installed **manually**, you must edit the
     agent's configuration file, as described in the procedure below.
     You must have access to the servers running any manually
     installed Backup Agents.

     .. warning::

        You must configure the new port for any **manually
        installed** Backup Agents, or the agents will have no access
        to |onprem|.

   Agent Updates
     Do not update the agents before upgrade. If you use Automation,
     |onprem| prompts you to update the agents after you upgrade.
     Follow the prompts to update the agents through the |onprem| UI.
     Do *not* update the agents manually.

   conf-mms.properties
     Beginning in 2.0, |onprem| stores global configuration settings
     in the |onprem| Application Database and stores only local
     settings in the |onprem| server's ``conf-mms.properties`` file.
     The upgrade procedure uses the existing ``conf-mms.properties``
     file to connect to the |application| Database before replacing
     the existing file with the new, smaller 2.0 file.

   Restore properties
     The following properties no longer apply and are replaced by
     settings specified when initiating a restore:

     - ``mms.backup.restore.linkExpirationHours``

     - ``mms.backup.restore.linkUnlimitedUses``

   mms.conf
     If you have modified the ``mms.conf`` file in your current
     installation (which is not typical), back up the file. You must
     use the new ``mms.conf`` file installed by the upgrade. You can
     redo any modifications once the upgrade is complete.
...
