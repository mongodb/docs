.. _embedding-charts-sdk:

===================================
Embed Charts with the Embedding SDK
===================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

.. include:: /includes/sdk-beta.rst

You can embed a chart into a web application with the Charts Embedding
JavaScript SDK, allowing more flexible adjustments of settings and rendering.

Features of the embedding SDK include:

- Add filters dynamically
- Change the size and style of the chart
- Refresh on demand

The current version of the SDK supports :ref:`unauthenticated chart
embedding <choose-access-level>`. A future version will include support
for authenticated embedded charts.

To embed a chart with the SDK, you need to:

- Enable unauthenticated embedding for the chart.
- Whitelist any document fields which you want to have available for use
  in :ref:`chart filters <embed-options-filter>`.
- Have the chart ID and base URL strings.

To prepare a chart for embedding with the SDK, use the following
procedure.

.. _embed-chart-procedure:

Procedure
---------

.. include:: /includes/steps/embed-chart-sdk-anon.rst

Installation
------------

If you have a simple web app, you can reference the Embedding SDK from a
script tag, and no installation is needed. If you are building a more complex
web app and are using ``npm`` or ``yarn``, you can install the Embedding SDK
so that it can be used directly from your script files.

To install the embedding SDK with ``npm``, use the following command:

.. code-block:: none

   npm install @mongodb-js/charts-embed-dom

To install with ``yarn``:

.. code-block:: none

   yarn add @mongodb-js/charts-embed-dom

Examples
--------

An `example app <https://codesandbox.io/s/charts-embedding-sdk-8i898>`__ using
the embedding SDK can be found at ``codesandbox.io``. The example app
demonstrates some of the interactive features available to the embedding
SDK, including an interactive filter and a manual refresh button.

The example app is configured with a chart ID and base URL which are
particular to the app. Be sure to configure your own apps with the correct
chart ID and base URL.

The example app uses two SDK methods:

.. list-table::
   :header-rows: 1
   :widths: 15 55 15 15

   * - Method
     - Description
     - Args
     - Returns

   * - ``refresh()``
     - Reloads the chart with the latest data from its
       :ref:`data source <data-sources>`.
     - none
     - Promise<void>

   * - ``setFilter()``
     - Filters your embedded chart based on a specified MQL
       :ref:`filter document <query-bar>`.

       .. note::

          Any fields included in the filter must be specified in the Embed
          Chart modal. See :ref:`Filter Embedded Charts with the SDK
          <filter-embedded-sdk>`.

     - :ref:`filter <query-bar>` object
     - Promise<void>

Quick Start with HTML
~~~~~~~~~~~~~~~~~~~~~

If you're just getting started with the embedding SDK and you would
like to confirm that your chart ID and base URL are correct and
try out some of the options, you can use the SDK in a simple HTML
page by including it as part of a header script tag.

.. code-block:: html

   <!DOCTYPE html>
   <html lang="en">
     <head>
       <title>Chart demo</title>
       <meta charset="utf-8">
       <!-- import the embedding sdk -->
       <script src="https://unpkg.com/@mongodb-js/charts-embed-dom"></script>
       <script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
       <script>
         $( document ).ready(function() {
           $("#refresh").on("click", () => {
             chart.refresh();
           });
         });
       </script>
     </head>
     <body>
       <h1>Embedded Chart Demo</h1>
       <button id="refresh">Refresh Chart</button>
       <div id="chart"></div>
       <script>
         const sdk = new ChartsEmbedSDK({
           baseUrl: '<your-base-url>'
         });
         // when using npm:
         // import ChartsEmbedSDK from '@mongodb-js/charts-embed-dom';

         const chart = sdk
           .createChart({
             chartId: '<your-chart-id>',
             width: 500,
             height: 500,
             refreshInterval: 300
           });
    
         chart.render(document.getElementById('chart'));
       </script>
     </body>
   </html>

.. _sdk-option-reference:

Option Reference
----------------

The following options are available to the JavaScript ``createChart``
method. After the chart is created, you can control the configuration
of the chart by calling methods on its handle.

.. list-table::
   :header-rows: 1
   :widths: 10 10 70 10

   * - Option
     - Type
     - Description
     - Required?

   * - ``baseUrl``
     - string
     - Base URL of the chart.
     - yes

   * - ``chartID``
     - string
     - Unique identifier of the chart.
     - yes

   * - ``height``
     - number
     - Height of the chart. If no height is provided, it defaults to
       the height of its container. If a value is provided without units,
       it is assumed to be pixels (px).
     - no

   * - ``width``
     - number
     - Width of the chart. If no width is provided, it defaults to
       the width of its container. If a value is provided without units,
       it is assumed to be pixels (px).
     - no

   * - ``filter``
     - object
     - A :ref:`filter <embed-options-filter>` to apply to the chart.
     - no

   * - ``refreshInterval``
     - number
     - How often to refresh the chart, in seconds. The minimum refresh
       interval is 10 seconds. ``autorefresh`` is off by default.
     - no

   * - ``theme``
     - string
     - A :ref:`theme <chart-display-theme>` for the chart to use. Valid
       options are:

       - ``light`` for a light background with dark text and chart 
         elements, or

       - ``dark`` for a dark background with light text and chart 
         elements.

       Defaults to ``light``.
     - no

   * - ``background``
     - string
     - A background color to apply to your chart instead of the 
       ``theme`` background. You can specify:

       - A color hex code

       - A |css| color name

       - ``transparent`` for a transparent background

       If no background is provided, the background color defaults to 
       the current ``theme``:

       - ``#FFFFFF`` for the ``light`` theme, or

       - ``#21313C`` for the ``dark`` theme.
     - no

   * - ``showAttribution``
     - boolean
     - Specifies whether or not to display the :guilabel:`MongoDB` logo
       below the chart. Defaults to ``true``.
     - no

   * - ``getUserToken``
     - object
     - Function that returns a ``base64``-encoded |jwt| token. 
       |charts-short| validates this token to determine if an 
       authenticated chart will be rendered.

       If authenticated access is enabled, the authenticated chart view 
       is rendered only if |charts-short| can validate the token using 
       the :doc:`configured authentication providers 
       </configure-auth-providers>`.

       If the token is invalid, |charts| renders the unauthenticated 
       chart if you enabled unauthenticated access. Otherwise, the chart 
       does not render.

       .. seealso:: :doc:`/embed-chart-jwt-auth`

     - no

