.. _atlas-data-lake:

=====================
|service| |data-lake|
=====================

.. default-domain:: mongodb

.. meta::
   :keywords: |data-lake|

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. _atlas-data-lake-about:

About |service| |data-lake|
---------------------------

MongoDB |service| |data-lake| allows you to natively query, transform, 
and move data across |aws| |s3| and MongoDB |service| clusters. You can 
query your richly structured data stored in |json|, |bson|, CSV, TSV, 
Avro, ORC, and Parquet formats using the |mongo| shell, :dl:`MongoDB 
Compass <compass>`, or any :driver:`MongoDB driver </>`.

Sample Uses 
-----------

You can use {+adl+} to: 

- Convert richly structured MongoDB data into columnar Parquet or CSV 
  files.
- `Query across multiple Atlas clusters <https://developer.mongodb.com/how-to/query-multiple-databases-with-atlas-data-lake/?tck=featlearn>`__ 
  to get a holistic view of your data.
- Materialize aggregations from MongoDB or |s3| data.
- Automatically import data from your |s3| bucket into an |service| 
  cluster.

|data-lake| Access 
------------------

When you create a |data-lake|, you grant |service| either read only or 
read and write access to |s3| buckets in your |aws| account. To access 
your |service| clusters, |service| uses your existing :manual:`Role 
Based Access Controls</core/authorization>`. You can view and edit the 
generated data storage :ref:`configuration 
<datalake-configuration-file>` that maps data from your |s3| buckets 
and |service| clusters to virtual databases and collections.

A database user must have one of the following roles to query an 
|service| |data-lake|:

- :atlas:`readWriteAnyDatabase </security-add-mongodb-users/#readWriteAnyDatabase>`

- :atlas:`readAnyDatabase </security-add-mongodb-users/#readAnyDatabase>`

- A :atlas:`custom role </security-add-mongodb-roles/>` with the  
  :manual:`find </reference/privilege-actions/>` privilege

.. _atlas-data-lake-actions:

Privilege Actions 
-----------------

Privilege actions define the operations that you can perform on your 
{+dl+}. You can grant the following {+adl+} privileges: 

- When you :atlas:`create or modify </security-add-mongodb-roles/>` 
  custom roles from the |service| User Interface
- In the ``actions.action`` request body parameter when you 
  :atlas:`create </reference/api/custom-roles-create-a-role/>` or 
  :atlas:`update </reference/api/custom-roles-update-a-role/>` a custom 
  role from the |service| |api|

.. authaction:: sqlGetSchema

   Retrieve the schema stored for a collection or view using 
   the :ref:`sqlgetschema-cmd` command. 

.. authaction:: sqlSetSchema

   Set or delete the schema for a collection or view using the 
   :ref:`sqlsetschema-cmd` command.

.. authaction:: viewAllHistory 

   Retrieve details about the queries that were run in the past 
   24 hours using :ref:`$queryHistory <adl-query-history-stage>`.

.. authaction:: outToS3

   Write data from any one of the :ref:`supported 
   <datalake-configuration-file-overview>` {+data-lake-stores+} or 
   multiple :ref:`supported <datalake-configuration-file-overview>` 
   {+data-lake-stores+} to your |s3| bucket using :ref:`adl-out-stage`.

.. authaction:: storageGetConfig 

   Retrieve your {+dl+} :ref:`storage configuration 
   <datalake-configuration-file>` using the :ref:`storageGetConfig 
   <datalake-getstorageconfig>` command.

.. authaction:: storageSetConfig 

   Set or update your {+dl+} :ref:`storage configuration 
   <datalake-configuration-file>` using the :ref:`storageSetConfig 
   <datalake-setstorageconfig>` command.

Authentication Options 
----------------------

|data-lake| uses :manual:`SCRAM-SHA </core/security-scram/>` or
:ref:`x509 <self-managed-x509-adl>` for authentication. It doesn't
support :atlas:`LDAP </security-ldaps/>`.

.. _atlas-data-lake-regions:

{+adl+} Regions 
-----------------------

.. note::

   To prevent excessive charges on your bill, create your |service|
   |data-lake| in the same |aws| region as your |s3| data source.

{+adl+} routes your {+dl+} requests through one of the following 
regions:

.. include:: /includes/list-table-supported-aws-regions.rst

.. note::

   You will incur charges when running {+data-lake+} queries. For more
   information, see :ref:`atlas-data-lake-billing` below.

.. _atlas-data-lake-billing:

Billing
-------

You incur |service| |data-lake| costs for the following items:

- Storage on the cloud object storage
- Data processed by |data-lake|
- Data returned by |data-lake|

Total Data Processed
~~~~~~~~~~~~~~~~~~~~

|service| charges for the total number of bytes that |data-lake| 
processes from your |aws| S3 buckets, rounded up to the nearest 
megabyte. |service| charges **$5.00 per TB** of processed data, with a 
minimum of **10 MB** or **$0.00005 per query**.

.. include:: /includes/fact-partition-cost-benefit.rst

You can use partitioning strategies and compression in |aws| |s3| to
reduce the amount of processed data.

Total Data Returned
~~~~~~~~~~~~~~~~~~~

|service| charges for the total number of bytes returned by
|data-lake|. This total is the sum of the following data transfers:

- The number of bytes transferred between |data-lake| service nodes
- The number of bytes transferred from |data-lake| to the client

Returned data is billed as outlined in the :guilabel:`Data Transfer
Fees` section of the `Atlas pricing page 
<https://www.mongodb.com/cloud/atlas/pricing?tck=docs_atlas>`_. The 
cost of data transfer depends on the Cloud Service Provider charges 
for same-region, region-to-region, or region-to-internet data transfer.

.. toctree::
   :titlesonly:
   :hidden:

   /tutorial/getting-started
   /deployment/deploy-adl
   /config/config-data-lake
   /administration
   /query/query-data-lake
   /admin/query-with-sql
   /tutorials
   /reference
   /supported-unsupported
   /supported-unsupported/limitations
   /release-notes/data-lake
