.. meta::
   :keywords: atlas cli, atlas ui
   :description: Configure the hour for Atlas to start weekly maintenance on your cluster, with options for protected hours and urgent maintenance considerations.

.. _configure-maintenance-window:

============================
Configure Maintenance Window
============================

.. default-domain:: mongodb

.. facet::
   :name: genre
   :values: tutorial

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

You can set the hour of the day when |service| should start weekly
maintenance on your cluster. This setting is optional and is not
required for most clusters. Configure maintenance windows from your
:ref:`project settings <project-settings>`.

Typically, you don't need to manually configure a maintenance window.
|service| performs maintenance automatically in a rolling manner to preserve 
continuous availability for :ref:`resilient applications <resilient-application>`.
You can use the :ref:`Test Failover <test-failover>` capability to ensure that 
your application is resilient to replica set elections.

Configuring maintenance windows provides more control over the timing of 
maintenance by allowing maintenance that requires replica set elections to occur
at your preferred time of day, and other standard updates to occur outside of 
business-critical hours.

.. important::

   You configure maintenance windows at the project level and they apply only to
   {+Dedicated-clusters+} (``M10`` and above). For {+Free-clusters+} and 
   {+Flex-clusters+}, |service| manages their maintenance windows automatically
   and you can't configure them manually.

Maintenance Window Considerations
---------------------------------

- **Urgent maintenance activities**: |service| may perform urgent maintenance
  activities (such as security patches for zero-day vulnerabilities) as soon
  as necessary without regard to configured maintenance windows or protected
  hours.

- **Ongoing maintenance operations**: Once you schedule a maintenance window
  for your cluster, you cannot change it until any ongoing maintenance 
  operations have completed.

- **MongoDB database upgrades**: If maintenance includes a MongoDB patch
  version upgrade, |service| displays the current and target versions in
  the console. If |service| upgrades the MongoDB maintenance version on
  one of your clusters during the next maintenance window, the cluster's
  card displays the target MongoDB maintenance version.

- **Maintenance requires replica set elections**: |service| performs 
  maintenance the same way as the maintenance procedure described in the 
  :manual:`MongoDB Manual </tutorial/perform-maintence-on-replica-set-members/>`. 
  This procedure requires at least one :manual:`replica set election 
  </core/replica-set-elections>` during the maintenance window per replica 
  set. Use the :ref:`Test Failover <test-failover>` capability to ensure 
  that your application is resilient to replica set elections.

- **Maintenance starts as close to the start of the window as possible**: 
  Maintenance always begins as close to the scheduled time as possible, but
  in-progress cluster updates or unexpected system issues could delay the
  start time.

- **Potential for brief performance degradation during maintenance**: If you
  have low :ref:`Disk IOPS <disk-io-util>`, your cluster could experience a
  brief performance degradation during maintenance while MongoDB repopulates
  the WiredTiger storage engine. To learn more, see :manual:`Journaling and the WiredTiger
  Storage Engine </core/journaling/#journaling-wiredTiger>`.

- **Protected hours**: In addition to configuring a maintenance window, you 
  can set daily protected hours, which is a window of time during which 
  |service| avoids performing standard updates. |service| automatically 
  performs maintenance during the maintenance window. 
  
  However, |service| may perform standard updates that don't involve a cluster
  restart or impact workload performance, outside of the maintenance window.
  When you enable protected hours, |service| performs standard updates
  outside of the protected hours window. The length of your protected hours
  window can't exceed 18 hours.

Scheduled Maintenance Operation Types
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The :guilabel:`Scheduled Maintenance Operations` modal may display one or 
more of the following maintenance types:

- MongoDB Required Maintenance: Critical maintenance operations required 
  for cluster health and stability.

- MongoDB Version Update: Upgrades to MongoDB patch versions or maintenance 
  releases.

- OS Policy Version Update: Updates to the underlying operating system 
  policies and security patches.

- Other Maintenance Operation: Additional maintenance activities required 
  for cluster management.

Track Maintenance Completion
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

You'll see a ``Maintenance window completed`` event in your
:ref:`Project Activity Feed <activity-feed>` when maintenance operations finish.

.. _auto-defer-maintenance:

Enable Auto-Defer for Future Maintenance Windows
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

When you enable the :guilabel:`Automatically defer maintenance for one week`
option, |service| automatically defers future scheduled maintenance by one week
each time. This means maintenance effectively runs every two weeks instead of
weekly, since the first week is automatically deferred each time. If needed,
you can still manually defer maintenance an additional time.

.. important::

   If you enable the :guilabel:`Automatically defer maintenance for one week`
   option, |service| configures automatic deferral for future maintenance windows.
   To defer currently scheduled maintenance, use the :guilabel:`Defer 1 Week`
   option as described in the :ref:`Defer Maintenance <cluster-maintenance-defer-maintenance>`
   section.

Auto-defer allows you to:

- Reduce maintenance frequency: Set up auto-defer once to space out
  maintenance operations to occur every two weeks instead of weekly.

- Batch updates: Consolidate maintenance operations into a single
  maintenance window and reduce the total number of maintenance events.

- Test in lower environments first: Set up auto-defer in production
  environments and allow  maintenance to run weekly in development or staging.
  This gives you time to validate updates before they reach production.

To enable auto-defer, see the section :ref:`View and Configure Maintenance Window <maintenance-window-protected-hours>`.

Required Access
---------------

To manage maintenance windows, you must have 
:authrole:`Organization Owner` or :authrole:`Project Owner` access 
to the project.

Procedure
---------

Open Your Project Settings
~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/steps-view-modify-project-settings.rst

.. _maintenance-window-protected-hours:

View and Configure Maintenance Window
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. tabs::

   .. tab:: {+atlas-ui+}
      :tabid: ui

      To view and configure the maintenance window using the 
      {+atlas-ui+}:

      1. Click the :guilabel:`Set Maintenance Window` button to display the maintenance window settings.

      #. Set the day and time that you want |service| to start
         maintenance on your project.

      #. If you want |service| to automatically defer any scheduled
         maintenance for one week, click
         :guilabel:`Automatically defer maintenance for one week`.
         
         Enabling this option configures automatic deferral for future maintenance 
         windows. To defer currently scheduled maintenance, use the :guilabel:`Defer 1 Week` button.

      #. To set a range of protected hours in which |service| avoids performing
         standard updates, toggle the :guilabel:`Turn on protected hours`
         setting to :guilabel:`On`. You can set a maximum time range of 18 hours a day.

      #. Click :guilabel:`Save` to keep your changes or click
         :guilabel:`Cancel` to discard them.

   .. tab:: {+atlas-cli+}
      :tabid: atlascli

      .. include:: /includes/extracts/atlas-maintenanceWindows-describe-and-update.rst

Clear Your Maintenance Window Configuration Settings
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

If you configured a preferred maintenance window start time, you can
clear the settings using the {+atlas-cli+} or the {+atlas-ui+}. Clearing your maintenance window configuration restores the default
maintenance window settings.

.. tabs::

   .. tab:: {+atlas-ui+}
      :tabid: ui

      To clear the configured maintenance window using the
      {+atlas-ui+}, toggle the :guilabel:`Set Maintenance Window`
      setting to :guilabel:`Off`.

   .. tab:: {+atlas-cli+}
      :tabid: atlascli

      .. include:: /includes/extracts/atlas-maintenanceWindows-clear.rst

Respond to Required Maintenance
-------------------------------

When maintenance is required:

- Between 48 and 72 hours (2-3 days) before the scheduled maintenance,
  {+service+} displays a banner in your project's cluster list showing
  the date and time when the maintenance is scheduled. Click 
  :guilabel:`Show Details` to see the scheduled maintenance operations, 
  such as MongoDB version updates, OS policy updates, or other 
  maintenance types.

- {+service+} sends an email to users with the :authrole:`Project
  Owner` role and updates the {+atlas-ui+} to display the option to
  begin maintenance immediately or to defer maintenance for one week.

  .. note::

     To configure how you receive scheduled maintenance window
     notifications, see :ref:`Configure a Maintenance Window Alert
     <configure-mw-alert>`.

.. cluster-maintenance-begin-now:

Begin Maintenance Now
~~~~~~~~~~~~~~~~~~~~~

.. tabs::

   .. tab:: {+atlas-ui+}
      :tabid: ui

      To begin maintenance immediately:

      .. procedure::
         :style: normal

         .. step:: In the maintenance banner, click :guilabel:`Show Details`. 
            A modal window titled :guilabel:`Scheduled Maintenance Operations` 
            appears, showing the scheduled date and time along with the types of
	    maintenance operations planned.

         .. step:: In the :guilabel:`Scheduled Maintenance Operations` modal, 
            click the :guilabel:`Begin Now` button. In the
            :guilabel:`Start Cluster Maintenance Now` confirmation modal, 
            confirm by clicking :guilabel:`Yes, start my maintenance now.`

   .. tab:: {+atlas-cli+}
      :tabid: atlascli

      .. include:: /includes/extracts/atlas-maintenanceWindows-update.rst

      :gold:`IMPORTANT:` To trigger maintenance immediately, pass the
      ``--startASAP`` option.

      .. code-block:: Bash

         # Trigger immediate maintenance for the project with the ID
         # 5e2211c17a3e5a48f5497de3:

         atlas maintenanceWindows update --startASAP --projectId 5e2211c17a3e5a48f5497de3 --output json

   .. tab:: {+atlas-admin-api+}
      :tabid: atlasapi

      {+service+} provides the :oas-bump-atlas-op:`Update One
      Maintenance Window for One Project endpoint
      <updategroupmaintenancewindow>`. You can trigger maintenance
      immediately by passing in the optional ``startASAP`` field with
      a value of ``true``.

      .. code-block:: bash

         curl --user "${PUBLIC_KEY}:${PRIVATE_KEY}" \
           --digest --include \
           --header "Accept: application/vnd.atlas.2025-03-12+json" \
           --header "Content-Type: application/json" \
           -X PATCH "https://cloud.mongodb.com/api/atlas/v2/groups/{groupId}/maintenanceWindow" \
           --data '
             {
               "startASAP": true
             }'

.. _cluster-maintenance-defer-maintenance:

Defer Maintenance
~~~~~~~~~~~~~~~~~

Use the following procedure to defer currently scheduled maintenance by one week. 
To automatically defer all future maintenance, enable :ref:`auto-defer <auto-defer-maintenance>`.

.. tabs::

   .. tab:: {+atlas-ui+}
      :tabid: ui

      .. include:: /includes/fact-defer-maintenance-max.rst
         
      To defer scheduled maintenance:

      .. procedure::
         :style: normal

         .. step:: In the maintenance banner, click :guilabel:`Show Details`.
            A modal window titled :guilabel:`Scheduled Maintenance Operations`
            appears, showing the scheduled date and time along with the types of
            maintenance operations planned.

         .. step:: In the :guilabel:`Scheduled Maintenance Operations` modal,
            click the :guilabel:`Defer 1 Week` button. In the
            :guilabel:`Defer Maintenance to Next Week` confirmation modal,
            confirm by clicking :guilabel:`Yes, defer maintenance until next week.`

   .. tab:: {+atlas-cli+}
      :tabid: atlascli

      .. include:: /includes/fact-defer-maintenance-max.rst

      .. include:: /includes/extracts/atlas-maintenanceWindows-defer.rst

   .. tab:: {+atlas-admin-api+}
      :tabid: atlasapi

      {+service+} provides the :oas-bump-atlas-op:`Defer One
      Maintenance Window for One Project endpoint
      <defergroupmaintenancewindow>`.

      .. include:: /includes/fact-defer-maintenance-max.rst
