.. _atlas-sp-manage-connections:

============================
Manage Connection Registries
============================

.. default-domain:: mongodb

.. meta::
   :keywords: atlas stream processing, atlas stream processing overview, streaming data, data stream, real time, data processing, apache kafka, kafka
   :description: Learn how to create, configure, and manage connections in your Stream Processing Instance connection registry

.. facet::
   :name: genre
   :values: tutorial

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

Each {+SPI+} stores every configured connection to a streaming data
source or sink in its connection registry. The procedures on this page
walk you through creating and configuring your {+atlas-sp+}
connections.

.. _atlas-sp-manage-spi-prereqs:

Prerequisites
-------------

To create and configure connections, you must have the following:

- An |service| :ref:`project <manage-projects>`
- An |service| user with the :authrole:`Project Owner` or
  the :authrole:`Project Stream Processing Owner` role to manage a
  connection registry

  .. note::
     
     The :authrole:`Project Owner` role allows you to create database 
     deployments, manage project access and project settings, manage 
     IP Access List entries, and more.

     The :authrole:`Project Stream Processing Owner` role enables {+atlas-sp+} 
     actions such as viewing, creating, deleting, and editing stream 
     processing instances, and viewing, adding, modifying, and deleting 
     connections in the connection registry. 

     See :ref:`Project Roles <project-roles>` to learn more about the 
     differences between the two roles.

- An |service| {+cluster+}

.. _manage-spi-connection-view:
.. _atlas-sp-manage-connection-view:

View Connections in the Connection Registry
-------------------------------------------

To view a connection to your {+spi+}:

.. tabs::

   .. tab:: {+atlas-cli+}
      :tabid: view-connection-cli

      .. include:: /includes/extracts/atlas-streams-connections-list-and-describe.rst

   .. tab:: {+atlas-ui+}
      :tabid: view-connection-ui

      .. include:: /includes/procedures/atlas-sp-view-connection-ui.rst

   .. tab:: {+atlas-admin-api+}
      :tabid: view-connection-api

      The {+atlas-admin-api+} provides different endpoints for 
      retrieving one or all connections in a connection registry.

      :oas-atlas-tag:`View One Connection in a Connection Registry </Streams/operation/getStreanConnection>`
      
      :oas-atlas-tag:`List All Connections in a Connection Registry </Streams/operation/listStreamConnections>`

   .. tab:: ``mongosh``
      :tabid: view-connection-sh

      To list all available connections using ``mongosh``, use the
      ``sp.listConnections()`` method. It returns a list of documents
      describing each connection in the {+spi+}'s connection
      registry. It has the following syntax:

      .. code-block:: sh

         sp.listConnections()

.. _manage-spi-connection-add:
.. _atlas-sp-manage-connection-add:

Add a Connection to the Connection Registry
-------------------------------------------

{+atlas-sp+} supports the following connection types:

- :ref:`Apache Kafka brokers <atlas-sp-manage-kafka-add>`
- :ref:`{+service+} databases <atlas-sp-manage-atlas-add>`
- :ref:`HTTPS connections <atlas-sp-manage-https-add>`

Each type has distinct configuration requirements.

.. _atlas-sp-manage-kafka-add:

Add an Apache Kafka Connection
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. important::

   VPC peering for {+atlas-sp+} is currently in
   private preview. To learn more, contact your
   account team.

To add a Kafka connection to your {+spi+}:

.. tabs::

   .. tab:: {+atlas-cli+}
      :tabid: add-connection-cli

      .. include:: /includes/extracts/atlas-streams-connections-create.rst

      When you create a {+spi+} using the {+atlas-cli+}, you must provide a ``.json``
      configuration file to define the new connection's parameters. The format of this
      file depends on the type of connection you define.

      For an {+kafka+} connection, provide a configuration file with the following syntax:

      .. code-block:: json

         {
	   "name": "<name>",
	   "type": "Kafka",
	   "bootstrapServers": "<address:port>, ...",
	   "security": {
	     "protocol": "<protocol>"
	   },
	   "authentication": {
	     "mechanism": "<auth-mechanism>",
	     "username": "<username>",
	     "password": "<password>"
	   }
	 }

   .. tab:: {+atlas-ui+}
      :tabid: add-connection-ui

      .. include:: /includes/procedures/atlas-sp-add-kafka-connection-ui.rst

   .. tab:: {+atlas-admin-api+}
      :tabid: add-connection-api

      The {+atlas-admin-api+} provides an endpoint for adding a 
      connection to a connection registry.

      :oas-atlas-tag:`Add a Connection to the Connection Registry </Streams/operation/createStreamConnection>`

.. important::

   After adding an external connection such as an {+kafka+} cluster to
   your connection registry, you must add {+service+} IP addresses to 
   an access list for that external connection. For more information, 
   see :ref:`atlas-add-inbound-ips`.

.. _atlas-sp-manage-atlas-add:

Add an {+service+} Connection
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. important::

   VPC peering for {+atlas-sp+} is currently in
   private preview. To learn more, contact your
   account team.

To add an {+service+} database connection to your {+spi+}:

.. tabs::

   .. tab:: {+atlas-cli+}
      :tabid: add-connection-cli

      .. include:: /includes/extracts/atlas-streams-connections-create.rst

      When you create a {+spi+} using the {+atlas-cli+}, you must provide a ``.json``
      configuration file to define the new connection's parameters. The format of this
      file depends on the type of connection you define.

      For an {+service+} database connection, provide a configuration
      file with the following syntax:

      .. code-block:: json

         {
	   "name": "<name>",
	   "type": "Cluster",
	   "clusterName": "<clusterName>"
	 }

   .. tab:: {+atlas-ui+}
      :tabid: add-connection-ui

      .. include:: /includes/procedures/atlas-sp-add-atlas-connection-ui.rst

   .. tab:: {+atlas-admin-api+}
      :tabid: add-connection-api

      The {+atlas-admin-api+} provides an endpoint for adding a 
      connection to a connection registry.

      :oas-atlas-tag:`Add a Connection to the Connection Registry </Streams/operation/createStreamConnection>`

.. _atlas-sp-manage-https-add:

Add an HTTPS Connection
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

To add an HTTPS connection to your {+SPI+}:

.. tabs::

   .. tab:: {+atlas-cli+}
      :tabid: create-https-connection-cli

      .. include:: /includes/extracts/atlas-streams-connections-create.rst

      When you create a {+spi+} using the {+atlas-cli+}, you must provide a ``.json``
      configuration file to define the new connection's parameters. The format of this
      file depends on the type of connection you define.

      For an HTTPS connection, provide a configuration file
      with the following syntax:

      .. code-block:: json

         {
	   "name": "<name>",
	   "type": "HTTPS",
	   "URL": "<request-url>",
	   "headers": {
	     "key1": "value1",
	     . . .
	     "keyn": "valuen"
	   }
	 }

   .. tab:: {+atlas-ui+}
      :tabid: create-https-connection-ui

      .. include:: /includes/procedures/atlas-sp-add-https-connection-ui.rst

   .. tab:: {+atlas-admin-api+}
      :tabid: create-https-connection-api

      The {+atlas-admin-api+} provides an endpoint for adding a 
      connection to a connection registry.

      :oas-atlas-tag:`Create One Connection </Streams/operation/createStreamConnection>`

      If the API endpoint requires authentication, such as an API key or 
      Bearer Access Token authentication, you should add
      authentication details as headers when you define the connection to prevent
      providing these as plaintext as part of the :pipeline:`$https` operator.

      :gold:`Other authentication schemes, such as Digest Auth or OAuth, are not currently supported.`

      To learn how to use HTTPS connections with {+atlas-sp+}, see :ref:`<atlas-sp-agg-https>`.

      **Example:**

      .. code-block:: sh

         curl --user "<publicApiKey>:<privateApiKey>" --digest \
           --header "Content-Type: application/json" \
           --header "Accept: application/vnd.atlas.2023-02-01+json" \
           --include \
           --data '{"name": "HTTPSConnection","type": "Https","url": "<apiBasePath>"}' \
           --request POST "https://cloud.mongodb.com/api/atlas/v2/groups/<projectID>/streams/<tenantName>/connections"


.. _manage-spi-connection-modify:
.. _atlas-sp-manage-connection-modify:

Modify a Connection from the Connection Registry
------------------------------------------------

To modify a connection from a connection registry:

.. tabs::

   .. tab:: {+atlas-cli+}
      :tabid: edit-connection-cli

      .. include:: /includes/extracts/atlas-streams-connections-update.rst

   .. tab:: {+atlas-ui+}
      :tabid: edit-connection-ui

      .. include:: /includes/procedures/atlas-sp-edit-connection-ui.rst

   .. tab:: {+atlas-admin-api+}
      :tabid: edit-connection-api

      The {+atlas-admin-api+} provides an endpoint for editing a 
      {+spi+}.

      :oas-atlas-tag:`Delete One Stream Instance </Streams/operation/updateStreamConnection>`

.. _manage-spi-connection-delete:
.. _atlas-sp-manage-connection-delete:

Delete a Connection from the Connection Registry
------------------------------------------------

To delete a connection from a connection registry:

.. tabs::

   .. tab:: {+atlas-cli+}
      :tabid: delete-connection-cli

      .. include:: /includes/extracts/atlas-streams-connections-delete.rst

   .. tab:: {+atlas-ui+}
      :tabid: delete-connection-ui

      .. include:: /includes/procedures/atlas-sp-delete-connection-ui.rst

   .. tab:: {+atlas-admin-api+}
      :tabid: delete-connection-api

      The {+atlas-admin-api+} provides an endpoint for editing a 
      {+spi+}.

      :oas-atlas-tag:`Delete One Stream Instance </Streams/operation/deleteStreamConnection>`

.. _atlas-sp-manage-connection-pl-list:

List Private Link Connections
-----------------------------

The {+atlas-admin-api+} provides an endpoint for viewing all Private
Link connections configured for {+atlas-sp+} within a specified
project.

:oas-atlas-tag:`Return All Private Links
</Streams/operation/listPrivateLinkConnections>`

.. _atlas-sp-manage-connection-pl-view:

View One Private Link Connection
--------------------------------

The {+atlas-admin-api+} provides an endpoint for viewing the details
of one Private Link connection configured for {+atlas-sp+} within a
specified project.

:oas-atlas-tag:`Return One Private Link
</Streams/operation/getPrivateLinkConnection>`

.. _atlas-sp-manage-connection-pl-create:

Create A Private Link Connection
--------------------------------

{+atlas-sp+} currently supports creating {+aws+} Private Link connections to
the following:

- {+aws+} Confluent clusters
- {+aws-msk+} clusters
- Microsoft |azure| EventHub

Amazon Web Services Private Link Connections
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

To create an {+aws+} Private Link connection to use in your {+atlas-sp+}
project:

.. tabs::

   .. tab:: AWS Confluent Private Link
      :tabid: aws-confluent

      .. include:: includes/atlas-stream-processing/create-private-link-aws-confluent.rst

   .. tab:: {+aws-msk+} Private Link
      :tabid: aws-msk

      .. include:: includes/atlas-stream-processing/create-private-link-aws-msk.rst

Microsoft Azure Private Link Connections
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

To create an {+azure+} Private Link connection to use in your
{+atlas-sp+} project:

.. tabs::

   .. tab:: {+atlas-ui+}
      :tabid: ui

      .. include:: /includes/atlas-stream-processing/create-private-link-azure-ui.rst

   .. tab:: {+atlas-admin-api+}
      :tabid: api

      .. include:: includes/atlas-stream-processing/create-private-link-azure-api.rst

.. _atlas-sp-manage-connection-pl-delete:

Delete a Private Link Connection
--------------------------------

The {+atlas-admin-api+} provides an endpoint for deleting a Private
Link connection configured for {+atlas-sp+} within a specified
project.

:oas-atlas-tag:`Delete One Private Link
</Streams/operation/deletePrivateLinkConnection>`
