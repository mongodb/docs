===============================
Upgrade MongoDB Version and FCV
===============================

.. default-domain:: mongodb

You can upgrade the major, minor, and/or feature compatibility versions
of your MongoDB resource. These settings are configured in your
resource's |k8s-configmap|.

- To upgrade your resource's major and/or minor versions, set the
  :setting:`spec.version` setting to the desired MongoDB version.

- To modify your resource's
  :manual:`feature compatibility version </reference/command/setFeatureCompatibilityVersion/>`,
  set the :setting:`spec.featureCompatibilityVersion` setting to the
  desired version.

.. note::

   If you update ``spec.version`` to a later version, consider setting
   :setting:`spec.featureCompatibilityVersion` to the current working
   MongoDB version to give yourself the option to downgrade if
   necessary.

   To learn more about feature compatibility, see
   :dbcommand:`setFeatureCompatibilityVersion` in the MongoDB Manual.

Example
-------

Consider the following |k8s-configmap| for a standalone resource:

.. code-block:: yaml
   :emphasize-lines: 7

   ---
   apiVersion: mongodb.com/v1
   kind: MongoDB
   metadata:
     name: my-standalone-downgrade
   spec:
     version: 4.0.6
     type: Standalone
     project: my-project
     credentials: my-credentials
     persistent: false
   ...

This resource has a MongoDB version of ``4.0.6``. The following steps
upgrade the deployment's MongoDB version to ``4.2.0``:

1. Perform the following modifications to the resource's
   ConfigMap:

   a. Set :setting:`spec.version` to the desired MongoDB version.

   #. Set :setting:`spec.featureCompatibilityVersion` to the current
      working MongoDB version:

   .. code-block:: yaml
      :emphasize-lines: 7-8

      ---
      apiVersion: mongodb.com/v1
      kind: MongoDB
      metadata:
        name: my-standalone-downgrade
      spec:
        version: 4.2.0
        featureCompatibilityVersion: 3.6
        type: Standalone
        project: my-project
        credentials: my-credentials
        persistent: false
      ...

   .. note::

      Setting ``featureCompatibilityVersion`` to ``4.2`` disables
      :manual:`4.2 features incompatible with MongoDB 4.0 </release-notes/4.2-compatibility/#compatibility-enabled>`.

2. Reapply the configuration to |k8s|:

   .. code-block:: none

      kubectl apply -f <standalone-config>.yaml

|k8s| automatically reconfigures your deployment with the new
specifications. You can see these changes reflected in the
|mms| or `Cloud Manager <docs.cloudmanager.com/current/>`__
application.

