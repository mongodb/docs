====================================================
Configure Deployment to Have Limited Internet Access
====================================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. meta::
   :description: How does Ops Manager download binaries with partial or no Internet access?
   :keywords: remote mode, local mode, hybrid mode

.. |company| replace:: MongoDB, Inc.

By default, |onprem|, {+mdbagent+}, and Backup Daemon hosts download
MongoDB installation binaries over the public internet from |company|

If your environment restricts which hosts can access the public
internet, |onprem|, {+mdbagent+}, and Backup Daemon hosts can download
MongoDB installation binaries from other locations. You can configure 
the following download modes:

Remote Mode
-----------

Choose **Remote Mode** when the |onprem|, MongoDB deployment, and Backup Daemon
hosts can access the public internet or can access an HTTP(s) endpoint
that hosts the MongoDB installation binaries.

The |onprem|, {+mdbagent+}, and Backup Daemon hosts access MongoDB 
installation binaries over the internet from |company| or from another 
HTTP(s) endpoint that the hosts can access.

.. note::

   If your MongoDB deployments run |fcv| 4.2 or later, you don't need to
   deploy Backup Daemons. Only your MongoDB deployments require access
   to the public internet or an HTTP(s) endpoint that hosts the
   MongoDB installation binaries to run |onprem| in Remote Mode.

This is the default configuration when you deploy |onprem|. 
If your |onprem|, MongoDB deployment, and Backup Daemon
hosts can access the public internet, no additional configuration is
necessary.

If you want your |onprem|, {+mdbagent+}, and Backup Daemon hosts to
download the MongoDB installation binaries from an HTTP(s) endpoint,
specify the endpoint using the :setting:`Base URL` |onprem| 
configuration setting.

Hybrid Mode
-----------

Choose **Hybrid Mode** when only the |onprem| hosts in your 
deployment can access the public internet.
|onprem| hosts download MongoDB installer binaries from the
internet. MongoDB hosts with {+mdbagent+}s download these
installers from the |onprem| hosts and then install or upgrade
MongoDB deployments.

To manage MongoDB hosts without internet access, you must
specify that the 
:guilabel:`Source for agents to download MongoDB binaries` is
:guilabel:`hybrid`.

Local Mode
----------

Choose **Local Mode** when none of the hosts in your deployment can
access the public internet. 

For Backup Daemons or {+mdbagent+}s to install or upgrade MongoDB
deployments, you must:

- Use another internet-connected device to download the
   :dl:`MongoDB Server <enterprise>` and
   :dl:`MongoDB Database Tools  <database-tools>` installer
   binaries for each edition, version, and platform you need to
   support from another internet-connected device.

   Check the :doc:`release notes </release-notes/application>` for 
   which version of the MongoDB Tools you should install.

- Load the MongoDB Server and MongoDB Database Tools installer
   binaries to each |onprem| host into the
   :setting:`Versions Directory`.
- Update the :term:`version manifest`.

To manage MongoDB hosts and run |onprem| without internet
access, you must specify that the
:guilabel:`Source for agents to download MongoDB binaries` is
:guilabel:`local`.

Considerations
--------------

MongoDB Community for Windows with |tls| Incompatibility
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

|onprem| supports MongoDB Community Edition for Microsoft Windows with
|tls| in the following versions:

- MongoDB versions 3.2.12 or later
- MongoDB versions 3.4.1 or later
- MongoDB release series 3.6, 4.0, and 4.2

To use earlier versions, you must download them from
:dl:`MongoDB <community>`.

Prerequisites
-------------

If you :doc:`configure an HTTP proxy <use-with-http-proxy>` for |onprem|,
the Backup Daemon, and the MongoDB Agents:

- Consider :ref:`adding sites from which to download the version
  manifest to the firewall whitelist
  <whitelist-sites-for-version-manifest>`.

- :ref:`Exclude internal hosts from the proxy <non-proxy-hosts-ops-manager>`.

Install MongoDB Enterprise Dependencies
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

If you plan on running
:product:`MongoDB Enterprise <mongodb-enterprise-advanced>` on Linux
hosts, then you must manually install a set of dependencies to each
host *before installing MongoDB*. The MongoDB manual provides the
appropriate command to install the dependencies. To install the
dependencies, see the instructions for the appropriate host platform:

.. include:: /includes/list-links-per-os-for-enterprise-dependencies.rst

.. tabs::

   .. tab:: Hybrid Mode
      :tabid: hybrid

      Required User Role to Change Mode
      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

      To configure internet access for |onprem| and {+mdbagent+}s,
      you must have :ref:`Global Owner <global-owner-role>` access to
      |onprem|.

   .. tab:: Local Mode
      :tabid: local

      Required User Role to Change Mode
      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

      To configure internet access for |onprem| and {+mdbagent+}s,
      you must have :ref:`Global Owner <global-owner-role>` access to
      |onprem|.

      .. _local-mode-determine-versions:

      Determine which Binaries to Store Locally and Download
      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

      MongoDB provides :dl:`Community <community>` and
      :dl:`Enterprise <enterprise>` installation binaries for all MongoDB versions and on all
      :ref:`platforms <ops-manager-operating-system>` that |onprem|
      supports.

      Download binaries associated to each combination of MongoDB
      version, platform, and edition that you want to support in your
      current and prospective |onprem|\-managed deployments, including
      one for:

      - Each platform and version that your current and planned
        MongoDB deployments run.

      - Each platform and version along the
        :doc:`upgrade path </tutorial/upgrade-ops-manager>` of
        any existing MongoDB deployments you want to upgrade.

        .. example::

           If you import an existing deployment of MongoDB 3.4
           Community on Ubuntu 14.04 and want to upgrade it to
           MongoDB 4.0 Enterprise on Ubuntu 14.04, you must
           download and store all archived binaries for:

           - MongoDB 3.4 Community Edition
           - MongoDB 3.6 Community Edition
           - MongoDB 4.0 Community Edition
           - MongoDB 4.0 Enterprise Edition

      - If you are running backups, you need the MongoDB binary for
        the platform on which the |onprem| :term:`Backup Daemon`
        runs.

        .. example::

           If you are running a MongoDB replica set on MongoDB 3.6.8
           on a set of Ubuntu hosts and running |onprem| on Windows,
           you must have archived binaries of MongoDB 3.6.8 for
           Ubuntu and for Windows.

      - If you are running
        :doc:`queryable backups </tutorial/query-backup>`,
        you need the Enterprise edition of the MongoDB version that
        your deployment runs.

        .. example::

           If you are running a MongoDB replica set on MongoDB 3.6.8
           on a set of Ubuntu hosts and want to query backups from
           an |onprem| install on Windows, you must have archived
           binaries of MongoDB Community 3.6.8 for Ubuntu and
           MongoDB Enterprise 3.6.8 Windows.

      - If you are running |onprem| 4.4 or later, download
        the :dl:`MongoDB Database Tools <database-tools>`  into the
        :setting:`Versions Directory`. These tools include
        :db-tools:`/mongodump` and :db-tools:`/mongorestore`.
        You need to download these tools for each platform and version that you need to support.

        .. note::

           .. include:: /includes/install/db-tools-separate-from-server.rst

.. tabs::

   .. tab:: Hybrid Mode
      :tabid: hybrid

      .. _config-hybrid-mode:

      Configure {+mdbagent+}s to Use Local Downloads
      ----------------------------------------------

      .. include:: /includes/steps/configure-hybrid-mode.rst

   .. tab:: Local Mode
      :tabid: local

      .. _config-local-mode:

      Configure All Hosts to Use Local Downloads
      ------------------------------------------

      .. include:: /includes/steps/configure-local-mode.rst

.. class:: hidden

   .. toctree::
      :titlesonly:

      /tutorial/resolve-pre-flight-check.txt
