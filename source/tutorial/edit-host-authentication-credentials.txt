==================================================
Configure MongoDB Authentication and Authorization
==================================================

.. default-domain:: mongodb

Overview
--------

Your MongoDB deployments can use the access control mechanisms described
here. You specify the authentication settings when :doc:`adding the
deployment </tutorial/add-hosts-to-monitoring>`. You can also edit
settings after adding a deployment, as described on this page. host.

If a deployment uses access control, the Monitoring and Backup Agents must
authenticate to the deployment as MongoDB users with appropriate access.
See the following:

- :doc:`/reference/required-access-monitoring-agent`
- :doc:`/reference/required-access-backup-agent`

.. only:: onprem

   If a :doc:`backing MongoDB instance
   </tutorial/prepare-backing-mongodb-instances>` runs with access
   control, the |application| must authenticate to the backing instances
   as a MongoDB user with appropriate access. The user must have the
   following roles: :authrole:`readWriteAnyDatabase`,
   :authrole:`clusterAdmin`, and :authrole:`dbAdminAnyDatabase`.

Access Control Mechanisms
-------------------------

.. _mongodb-cr:

MONGODB-CR
++++++++++

MongoDB Challenge-Response (``MONGODB-CR``) is the MongoDB default for
authentication and authorization. To enable, see :doc:`MongoDB access
control </tutorial/enable-mongodb-access-control>`.

To create MongoDB users for the |mms| agents, see
:doc:`/tutorial/configure-monitoring-agent-for-cr` and
:doc:`/tutorial/configure-backup-agent-for-cr`.

.. only:: onprem

   To configure the |application| to authenticate to the :doc:`backing
   instances </tutorial/prepare-backing-mongodb-instances>` using
   ``MONGODB-CR``, see :setting:`mongo.mongoUri`.

LDAP
++++

To use LDAP for access control, see :doc:`LDAP
</tutorial/configure-for-ldap-authentication>`.

Kerberos
++++++++

If your MongoDB deployment uses Kerberos for authentication, you must
create the Kerberos Principal for the |mms| agents, create a MongoDB user
for that Kerberos Principal, edit the agent's configuration file. If you
are running both the Monitoring Agent and the Backup Agent on the same
server, then both agents must connect as the same Kerberos Principal.

To create a Kerberos Principal and the associated MongoDB user as well as
edit the configuration file, see
:doc:`/tutorial/configure-monitoring-agent-for-kerberos` and
:doc:`/tutorial/configure-backup-agent-for-kerberos`.

Specify Kerberos as the MongoDB process's authentication mechanism when
:doc:`adding the deployment </tutorial/add-hosts-to-monitoring>` or in the
procedure on this page for editing a deployment.

.. only:: onprem

   To enable Kerberos authentication between the |application| and the
   :ref:`mms-application-database`, configure the
   :ref:`configuration-kerberos-settings` and the
   :setting:`mongo.mongoUri` setting. You must configure all required
   Kerberos settings to enable Kerberos authentication.

Edit Host Credentials
---------------------

If you configure authentication credentials, the |mms| agents must
authenticate to the deployment as a MongoDB user with the proper access.
Configure the agents with the proper credentials **before** configuring
the credentials on the deployment. See:

- :doc:`/tutorial/nav/configure-monitoring-agent`.

- :doc:`/tutorial/nav/configure-backup-agent`.

Edit Host Credential Information for Monitoring
+++++++++++++++++++++++++++++++++++++++++++++++

Before editing these credentials, set up the agent as a user in MongoDB
with appropriate access. See
:doc:`/tutorial/nav/configure-monitoring-agent`.

To edit authentication credentials:

.. include:: /includes/steps/monitoring-agent-edit-host-credentials.rst

Edit Host Credential Information for Backup
+++++++++++++++++++++++++++++++++++++++++++

Before editing these credentials, set up the agent as a user in MongoDB
with appropriate access. See :doc:`/tutorial/nav/configure-backup-agent`.

To edit authentication credential information:

.. include:: /includes/steps/backup-agent-edit-host-credentials.rst
