.. _create-k8s-project:

==================================
Create a Project using a ConfigMap
==================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

The |k8s-op-full| uses a |k8s| |k8s-configmap| to create or link your
|onprem| :opsmgr:`Project </tutorial/manage-projects>`. To create a
|k8s-op-short| ConfigMap, you need to edit a few lines of the
:ref:`example ConfigMap <example-k8s-configmap>` |yaml| file and apply
the ConfigMap.

The prerequisites and procedure depend on whether your |onprem|
deployment is running with |tls| enabled.

.. tabs::

   tabs:
     - id: tls-disabled
       name: Without TLS
       content: |

     - id: tls-enabled
       name: With TLS
       content: |
         The |k8s-op-full| can use |tls| certificates to encrypt
         communication between:

         - The |k8s-op-short| and |onprem|
         - The {+aagent+} and |onprem|

         The following sections guide you through verifying your |onprem|
         configuration and configuring the |k8s-op-short| to use |tls|.

Prerequisites
-------------

.. tabs::

   hidden: true

   tabs:
     - id: tls-disabled
       name: Without TLS
       content: |

     - id: tls-enabled
       name: With TLS
       content: |
         Ops Manager
         ~~~~~~~~~~~

         - |onprem| is running with |tls| enabled.

           - For more information, see the |onprem| documentation on
             :opsmgr:`Configuring TLS </tutorial/configure-ssl-connection-to-web-interface/>`.

         - {+aagents+} retrieve MongoDB builds from the |onprem|
           application server.

           - Configure this by setting |onprem|'s
             :opsmgr:`Installer Download Source </reference/config/ui-settings/#Installer-Download-Source>`
             setting to :guilabel:`Ops Manager Application Server`.

           - For detailed instructions on how to set this, see
             :opsmgr:`Configure Deployment to Have Limited Internet Access </tutorial/configure-local-mode/index.html#set-the-source-for-onprem-and-its-agents-to-install-binaries-to-the-ops-manager-application-server>`.

         **TLS**

         Get the root |certauth| for your |onprem| instance.

         To find who issued your root |certauth|:

         1. Visit your |onprem| instance using a web browser.
         2. Click the :icon-fa5:`lock` next to your |onprem| |url| in
            the browser address box.
         3. View the Certificate.
            If you do not know how to view the certificate list for
            your web site, consult your browser's documentation.
         4. The first certificate listed is the root |certauth|.

         To download your root |certauth| from an outside provider:

         1. Search for the issuing company and ``"download root CA"``.
         2. Follow the issuing company's instructions.

         To get your root |certauth| from an internal source:

         1. Contact your security team and request the certificate
            file.

Kubernetes
~~~~~~~~~~

- Kubernetes version 1.11 or later or Openshift version
  3.11 or later.
- |k8s-op-full| version 0.11 or later
  :doc:`installed </tutorial/install-k8s-operator>`.

Procedure
---------

.. _example-k8s-configmap:

.. tabs::

   hidden: true

   tabs:
     - id: tls-disabled
       name: Without TLS
       content: |
         .. include:: /includes/steps/create-k8s-configmap.rst

     - id: tls-enabled
       name: With TLS
       content: |
         .. include:: /includes/steps/create-k8s-configmap-tls.rst

Next Steps
----------

Now that you created your ConfigMap, :ref:`create-k8s-secret` before you
start :doc:`deploying MongoDB resources </deploy>`.
