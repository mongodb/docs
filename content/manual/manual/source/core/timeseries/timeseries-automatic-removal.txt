.. _manual-timeseries-automatic-removal:
.. _set-up-automatic-removal:

==========================================================
Set up Automatic Removal for Time Series Collections (TTL)
==========================================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

.. meta::
   :keywords: IOT
   :description: Set up automatic removal of documents in time series collections using the `expireAfterSeconds` parameter to manage data retention.

.. composable-tutorial::
   :options: interface, language
   :defaults: mongosh, None

   .. selected-content::
      :selections: driver, csharp

      .. include:: /includes/time-series/timeseries-removal-csharp.rst

   .. selected-content::
      :selections: driver, java-sync

      .. include:: /includes/time-series/timeseries-removal-java.rst

   .. selected-content::
      :selections: mongosh, None

      .. include:: /includes/time-series/timeseries-removal-mongosh.rst

   .. selected-content::
      :selections: driver, nodejs

      .. include:: /includes/time-series/timeseries-removal-javascript.rst

   .. selected-content::
      :selections: driver, python

      .. include:: /includes/time-series/timeseries-removal-python.rst

Behavior
--------

.. _timeseries-collection-delete-operations-timing:

Timing of Delete Operations
~~~~~~~~~~~~~~~~~~~~~~~~~~~

MongoDB doesn't guarantee that expired data will be deleted immediately
upon expiration. Once all documents in a bucket are expired, the
background task that removes expired buckets removes the bucket during
the next run. The maximum span of time that a single bucket is allowed
to cover is controlled by the ``granularity`` of the time series
collection:

.. list-table::
  :header-rows: 1
  :widths: 40 60

  * - ``granularity``

    - Covered Time Span

  * - ``"seconds"`` (default)

    - one hour

  * - ``"minutes"``

    - 24 hours

  * - ``"hours"``

    - 30 days


The background task that removes expired buckets runs every 60 seconds.
Therefore, documents may remain in a collection during the period
between the expiration of the document, the expiration of all other
documents in the bucket and the running of the background task.

Because the duration of the removal operation depends on the workload of
your mongod instance, expired data may exist for some time beyond the 60
second period between runs of the background task.