.. index:: database profiling
.. _db-profiling-section:

=================
Profile Databases
=================

.. default-domain:: mongodb

Overview
--------

|mms| can collect data from MongoDB's :manual:`profiler
</reference/database-profiler>` to provide statistics about performance
and database operations.
You can enable profiling on a per-process basis, as described here, or for all
processes in the deployment, as described in :ref:`group-settings-page`.
**Please read the considerations below before enabling profiling.**

.. _considerations-profile-database:

Considerations
--------------

Before enabling profiling, be aware of the following:

- Profile data can include sensitive information, including the content of
  database queries. Ensure that exposing this data to |mms| is consistent
  with your information security practices.

- The profiler can consume resources which may adversely affect MongoDB
  performance. Consider the implications before enabling profiling.

- |mms| samples up to 20 entries or up to 4MB of data, whichever comes first.
  This limit affects profiling only if you have increased the 1MB default size of
  the :data:`system.profile <<database>.system.profile>` collection and have
  large profiler documents.

- If you use a Monitoring Agent version earlier than version 3.8.0.255
  and if the agent authenticates as a user containing the
  :authrole:`clusterAdmin` role, the agent might leak cursors if you
  enable profiling. A leaked cursor will automatically time-out on the
  server after 10 minutes.

- The MongoDB profiler stores data in the ``<database>.system.profile``
  collections. When collecting data from the profiler, |mms| ignores
  data about operations on the ``<database>.system.profile``
  collections themselves, such as Monitoring Agent queries of the
  ``<database>.system.profile`` collections.

Procedures
----------

Enable Profiling
~~~~~~~~~~~~~~~~

To allow |mms| to collect profile data for a specific process:

.. include:: /includes/steps/profiling-enable.rst

.. note::

   The Monitoring Agent attempts to minimize its effect on the
   monitored systems. If resource intensive operations, like polling
   profile data, begins to impact the performance of the database,
   |mms| will throttle the frequency that it collects data. See
   :ref:`db-stats-warning` for more information about the agent's
   throttling process.

   The agent sends only the most recent 20 entries from last
   minute.

With profiling enabled, configuration changes made in |mms| can
take up to 2 minutes to propagate to the agent and another minute before
profiling data appears in the |mms| interface.

Display Profiling Levels
~~~~~~~~~~~~~~~~~~~~~~~~

When profiling is on, the :guilabel:`Profile Data` tab displays profiled data.
For more information on profiling, see the :manual:`database profiler
</tutorial/manage-the-database-profiler>` documentation in the MongoDB manual.

.. include:: /includes/steps/profiling-view-data.rst

Delete Profile Data
~~~~~~~~~~~~~~~~~~~

Deleting profile data deletes the Web UI cache of the current profiling data.
You must then disable profiling or drop or clear the source collection, or |mms|
will repopulate the profiling data.

If |mms| is storing a large amount of profile data for your instance,
the removal process will not be instantaneous.

.. include:: /includes/steps/profiling-delete-data.rst
