====================
Back up a Deployment
====================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

You can back up your MongoDB deployment to a local MongoDB database or
a cloud-hosted MongoDB database.

.. important::

   .. include:: /includes/fact-backup-standalone-restriction.rst

.. tabs::

   .. tab:: FCV of 4.0 or earlier
      :tabid: fcv40

   .. tab:: FCV of 4.2 or later
      :tabid: fcv42

Prerequisites
-------------

Unique Names for Deployment Items
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Ensure your deployment items have unique names before creating backups.

.. include:: /includes/important-unique-names-deployment-items.rst

Replica Set Requirements
~~~~~~~~~~~~~~~~~~~~~~~~

A Replica Set must:

.. tabs::
   :hidden:

   .. tab:: FCV of 4.0 or earlier
      :tabid: fcv40

      - Be monitored by |mms|.

      - Run MongoDB version 2.6 or later.

      - Have an active :term:`primary` node.

   .. tab:: FCV of 4.2 or later
      :tabid: fcv42

      - Be monitored by |mms|.

      - Run MongoDB Enterprise with an |fcv| of 4.2 or later.

      - Have an active :term:`primary` node.

Sharded Cluster Requirements
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. tabs::
   :hidden:

   .. tab:: FCV of 4.0 or earlier
      :tabid: fcv40

      A Sharded Cluster must:

      - Be monitored by |mms| including at least one |mongos| in the
        cluster.

      - Run MongoDB version 2.6 or later.

      - Have all :term:`config servers <config server>` running. The
        config server |mongod| processes must be started with either
        the ``--configsvr`` command line option or the
        ``{ "clusterRole": "configsvr" }`` setting in the ``mongod``
        configuration file.

      - Complete the balancing round in less than one hour.

   .. tab:: FCV of 4.2 or later
      :tabid: fcv42

      - Be monitored by |mms|.

      - Run MongoDB Enterprise with an |fcv| of 4.2 or later on all
        nodes including the config server.

      - Have an active :term:`primary` node of each shard and the
        config server.

MongoDB FCV 4.2 Compatibility
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

All |fcv| 4.2 databases must fulfill the appropriate
:ref:`backup considerations <4.2-backup-considerations>`.

MongoDB Compatibility
~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/extracts/backup-prereq-mongodb-compatibility.rst

Data Protection Plan
~~~~~~~~~~~~~~~~~~~~

:doc:`Decide how to back up the data and what data to back up </core/backup-preparations>`.

Procedure
---------

.. tabs::
   :hidden:

   .. tab:: FCV of 4.0 or earlier
      :tabid: fcv40

      You can choose to back up all databases and collections in your
      MongoDB deployment or specific ones.

      .. include:: /includes/steps/enable-backup.rst

   .. tab:: FCV of 4.2 or later
      :tabid: fcv42

      You can back up your entire MongoDB deployment.

      .. include:: /includes/steps/create-backup-wt.rst
