.. _sharding-shard-key:
.. _shard-key:
.. _sharding-internals-shard-keys:

==========
Shard Keys
==========

.. meta::
   :description: Understand how shard keys determine document distribution in MongoDB clusters and the importance of shard key indexes for sharded collections.

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. dismissible-skills-card::
   :skill: Sharding Strategies
   :url: https://learn.mongodb.com/skills?openTab=sharding

The shard key is either a single indexed :term:`field` or multiple
fields covered by a :term:`compound index` that determines the
distribution of the collection's :term:`documents <document>` among the
cluster's :term:`shards <shard>`. For details, see 
:ref:`<sharding-shard-key-indexes>`.

MongoDB divides the span of shard key values (or hashed
shard key values) into non-overlapping ranges of shard key values (or
hashed shard key values). Each range is associated with a
:term:`chunk`, and MongoDB attempts to distribute chunks evenly among
the shards in the cluster.

.. include:: /images/sharding-range-based.rst

.. _shard-a-collection:
.. _sharding-shard-key-creation:

Shard a Collection
------------------

.. include:: /includes/sharding/shard-a-collection.rst

.. _choose-a-shard-key:

Choose a Shard Key
------------------

The choice of shard key affects the creation and :ref:`distribution of
data <sharding-balancing>` across the available :term:`shards
<shard>`. The distribution of data affects the efficiency and
performance of operations within the sharded cluster. The ideal shard 
key allows MongoDB to distribute documents evenly throughout the cluster 
while also facilitating common query patterns.

For details, see the :ref:`Choose a Shard Key 
<sharding-internals-choose-shard-key>` page.

Change a Shard Key
------------------

MongoDB provides two ways to change a shard key. How to change a shard key:

- You can :ref:`refine a shard key <shard-key-refine>` by adding fields to your existing key.
- You can change a shard key entirely and :ref:`reshard a collection <sharding-resharding>` 
  with the new key.

For details, see the :ref:`Change a Shard Key 
<change-a-shard-key>` page.

Change Shard Key Field Value for a Document
-------------------------------------------

You can change the value for the shard key field in any
document in your collection unless the shard key field is
the ``_id`` field. This can affect which shard the document
lives on.

For details, see :ref:`<update-shard-key>`.

.. _shard-key-missing:

Set Missing Shard Key Fields
----------------------------

It is possible for documents in your collection to be missing fields
that your shard key specifies. By default, documents that that are 
missing fields specified by your shard key live in the the same chunk 
range as shard keys with null values. 

For details, see :ref:`<shard-key-missing-set>`.

Display a Shard Key
-------------------

You can use the :method:`db.printShardingStatus()` method to display
the shard key used for your collection. 

For details, see :ref:`<sharding-display-shard-key>`.

Troubleshoot
------------

Some common shard key issues caused by a suboptimal shard key are: 

- Jumbo chunks 
- Uneven load distribution
- Decreased query performance

For details, see :ref:`Troubleshoot Shard Keys 
<shardkey-troubleshoot-shard-keys>`.

.. toctree::
   :titlesonly:

   Shard Key Indexes </core/sharding-shard-key-indexes.txt>
   Choose Shard Key </core/sharding-choose-a-shard-key.txt>
   Change Shard Key </core/sharding-change-a-shard-key.txt>
   Change Shard Key Value </core/sharding-change-shard-key-value.txt>
   Set Missing Key Fields </core/sharding-set-missing-shard-key-fields.txt>
   Display a Shard Key </core/sharding-find-shard-key.txt>
   Troubleshoot </core/sharding-troubleshooting-shard-keys.txt>
