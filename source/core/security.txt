=================
Security Overview
=================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecols

.. cond:: onprem

  To ensure the security of your {+mdbagent+}s, |onprem| hosts,
  and MongoDB deployments, |onprem| supports the following security
  options.

  |tls| for Encrypted Connections
  -------------------------------

  |onprem| supports encrypted connections using |tls| server or
  client certificates. Client certificates identify the *user* while
  server certificates identifies the *host*.

  - The {+mdbagent+} uses |tls| server or client certificate that the
    legacy Automation Agent used.

    - If the legacy Monitoring Agent used its own |tls| server or
      client certificate before the update to the {+mdbagent+},
      {+magent+} continues to use that certificate.

    - If the legacy Backup Agent used its own |tls| server or client
      certificate before the update to the {+mdbagent+}, {+bagent+}
      continues to use that certificate.

  - |onprem| can
    :doc:`connect to its backing databases </tutorial/configure-ssl-connection-to-backing-mongodb>`
    using |tls| server or client certificates.

  - |onprem| users can connect to the |onprem| console or |api| using
    |tls| :doc:`server certificates </tutorial/configure-ssl-connection-to-web-interface>`.

  Authentication Mechanisms
  -------------------------

  Authenticate with Deployments
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

  |onprem| supports these mechanisms to authenticate the |application|
  and its Agents with your MongoDB processes:

  .. list-table::
     :header-rows: 1
     :widths: 15 15 10 10 10 10 10 10

     * - From
       - To
       - :doc:`MONGODB-CR </tutorial/enable-mongodbcr-authentication-for-group>`
       - :doc:`SCRAM-SHA-1 </tutorial/enable-mongodbcr-authentication-for-group>`
       - :doc:`SCRAM-SHA-256 </tutorial/enable-mongodbcr-authentication-for-group>`
       - :doc:`x.509 </tutorial/enable-x509-authentication-for-group>`
       - :doc:`Kerberos </tutorial/enable-kerberos-authentication-for-group>`
       - :doc:`LDAP </tutorial/enable-ldap-authentication-for-group>`
     * - Ops Manager
       - :ref:`Backing Database <configure-auth-backing>`
       - :icon:`check-circle`
       - :icon:`check-circle`
       - :icon:`check-circle`
       - :icon:`check-circle`
       - :icon:`check-circle`
       - :icon:`check-circle`
     * - {+mdbagent+}
       - :ref:`MongoDB Processes <set-project-ssl>`
       - :icon:`check-circle`
       - :icon:`check-circle`
       - :icon:`check-circle`
       - :icon:`check-circle`
       - :icon:`check-circle`
       - :icon:`check-circle`
     * - Your Application Clients
       - :ref:`MongoDB Processes <set-project-ssl>`
       - :icon:`check-circle`
       - :icon:`check-circle`
       - :icon:`check-circle`
       - :icon:`check-circle`
       - :icon:`check-circle`
       - :icon:`check-circle`

  .. note::

     Kerberos and |ldap| authentication is available with
     :product:`MongoDB Enterprise <mongodb-enterprise-advanced>` only.

  Authenticate with |onprem|
  ~~~~~~~~~~~~~~~~~~~~~~~~~~

  |onprem| supports these mechanisms to authenticate with
  |application|:

  .. list-table::
     :header-rows: 1
     :widths: 15 15 30 30 30

     * - From
       - To
       - |onprem| DB
       - :doc:`LDAP </tutorial/configure-for-ldap-authentication>`
       - :doc:`SAML </tutorial/configure-for-saml-authentication>`
     * - |onprem| User
       - Ops Manager
       - :icon:`check-circle`
       - :icon:`check-circle`
       - :icon:`check-circle`

.. cond:: cloud

  |mms| provides configurable encryption, authentication, and
  authorization to ensure the security of your {+mdbagent+}s and
  MongoDB deployments. |mms| supports :ref:`TLS <cloud-tls>`,
  :ref:`cloud-mongodb-cr`, :ref:`cloud-ldap`, and
  :ref:`cloud-kerberos`.

  .. _cloud-ssl:
  .. _cloud-tls:

  |tls| Encryption
  ----------------

  |mms| can use |tls| for encrypting communications for when the
  {+mdbagent+} connects to:

  - |mms|.

  - MongoDB instances that use |tls|. You must set each MongoDB host's
    :guilabel:`Use TLS` setting in |mms| and must configure the agent's
    |tls| settings. See
    :doc:`/tutorial/configure-mongodb-agent-for-tls`.

  Access Control and Authentication
  ---------------------------------

  MongoDB uses Role-Based Access Control (RBAC) to determine access to
  a MongoDB system. When run with access control, MongoDB requires
  users to authenticate themselves and then determines that user's
  permissions.

  If your MongoDB deployment uses authentication and the {+mdbagent+}:

  - Uses Automation to manage the deployment, |mms| creates the
    appropriate MongoDB user, gives it all necessary roles, and
    authenticates to the deployments as that MongoDB user.

  - Does not use Automation to manage the deployment, you must create a
    MongoDB user for the {+mdbagent+} Monitoring and Backup functions
    with :doc:`appropriate access </reference/required-access-mongodb-agent>`.

  .. note::

     Kerberos and |ldap| authentication is available with
     :product:`MongoDB Enterprise <mongodb-enterprise-advanced>` only.


  .. _cloud-mongodb-cr:
  .. _cloud-scram:

  SCRAM-SHA-1 and SCRAM-SHA-256
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

  |mms| can use the ``SCRAM-SHA-1`` and ``SCRAM-SHA-256``
  authentication mechanisms to authenticate a user on a MongoDB
  deployment.

  .. seealso::

     To learn about SCRAM, see the
     :manual:`SCRAM page </core/security-scram>` in the MongoDB manual.

  If your MongoDB deployment uses ``SCRAM`` authentication and the
  {+mdbagent+}:

  - Uses Automation to manage the deployment, |mms| creates the
    appropriate MongoDB user and gives it all necessary roles.
  - Does not use Automation to manage the deployment, you must
    :doc:`create a MongoDB user </tutorial/configure-mongodb-agent-for-scram>`
    for the {+mdbagent+} Monitoring and Backup functions.

  .. _cloud-ldap:

  |ldap|
  ~~~~~~

  The {+mdbagent+} can use the |ldap| authentication mechanism to
  authenticate to the MongoDB deployment.

  If your MongoDB deployment uses |ldap| for authentication, you must
  :doc:`create a MongoDB user for the {+mdbagent+} </tutorial/configure-mongodb-agent-for-ldap>`
  and specify the host's authentication settings when you:

  - :doc:`Add a MongoDB host </tutorial/add-existing-mongodb-processes>`
    or
  - :doc:`Edit the settings </tutorial/edit-host-authentication-credentials>`
    for an existing host.

  .. _cloud-kerberos:

  Kerberos
  ~~~~~~~~

  The {+mdbagent+} can use the Kerberos authentication mechanism to
  authenticate to the MongoDB deployment.

  If your MongoDB deployment uses Kerberos for authentication, you must:

  - :ref:`Create the Kerberos UPN for the {+mdbagent+} <create-krb5-upn-for-mongodb-agent>`
  - :ref:`Create a MongoDB user for that Kerberos UPN <create-mongodb-user-for-mongodb-agent>`
  - Use the same Kerberos |upn| for Automation and Backup functions.
  - :doc:`Edit the agent's configuration file </reference/mongodb-agent-settings>`
  - Specify the host's authentication settings when you:

    - :doc:`Add a host </tutorial/add-existing-mongodb-processes>` or
    - :doc:`Edit the settings </tutorial/edit-host-authentication-credentials>`
      for an existing host.
