.. _snapshot-management:

============================
Manage Your Backup Snapshots
============================

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

While most {+service+} snapshot operations are automated according to
your :ref:`backup policies <configure-backup-policy>`, you can also:

- View snapshots
- Manually delete snapshots
- Initiate on-demand snapshots between planned backups.

Required Access
~~~~~~~~~~~~~~~

To take or delete a backup snapshot, you must have :authrole:`Project Owner` 
access to the project. Users with :authrole:`Organization Owner` 
access must add themselves as a ``Project Owner`` 
to the project before they can take or delete a backup snapshot.

To view backup snapshots, you must have :authrole:`Project Read Only` access 
to the project. Users with :authrole:`Organization Owner` 
access must add themselves as a ``Project Owner`` 
to the project before they can take or delete a backup snapshot.

.. _delete-snapshot:

Delete a Backup Snapshot
~~~~~~~~~~~~~~~~~~~~~~~~

.. note::

   If you have a :ref:`{+bcp+} enabled <backup-compliance-policy>`, you 
   can't delete a backup snapshot.

You can delete a snapshot using either the {+atlas-cli+} or the
{+atlas-ui+}. To delete all copies of a snapshot affected by a 
multi-region :ref:`Snapshot Distribution <snapshot-distribution>` 
policy without deleting the policy itself, delete the snapshot from its
original region.

.. tabs::
 
   .. tab:: {+atlas-cli+}
      :tabid: atlascli

      .. include:: /includes/extracts/atlas-backups-snapshots-delete.rst

   .. tab:: {+atlas-admin-api+}
      :tabid: api

      - For non-sharded clusters, delete the snapshot programmatically
        with :oas-atlas-op:`Remove One Replica Set Cloud Backup 
        </removeOneReplicaSetCloudBackup>`.
      - For sharded clusters, delete the snapshot programmatically with
        :oas-atlas-op:`Remove One Sharded Cluster Cloud Backup 
        </removeOneShardedClusterCloudBackup>`.

   .. tab:: {+atlas-ui+}
      :tabid: ui

      To delete a snapshot from the {+atlas-ui+}, perform the following procedure:

      1. Click :guilabel:`Database` in the upper left-hand corner and
         select the cluster from which you wish to delete a snapshot.
      2. Click the :guilabel:`Backup` tab.
      3. Select the snapshot you wish to delete from the list under the 
         :guilabel:`Snapshots` tab and click :icon:`trash-alt`.

Deleting the original snapshot by any of these methods will propagate
the deletion to all copies of that snapshot.

.. _viewing-snapshots:

View Backup Snapshots
~~~~~~~~~~~~~~~~~~~~~

.. tabs::

   .. tab:: {+atlas-cli+}
      :tabid: atlascli

      .. include:: /includes/extracts/atlas-backups-snapshots-list-and-describe.rst

   .. tab:: {+atlas-ui+}
      :tabid: ui

      .. include:: /includes/view-snapshots-cluster-ui.rst

By default, |service| displays both on-demand and policy-based
snapshots. To view only policy-based snapshots:

1. Click :guilabel:`Policy` under :guilabel:`View Snapshots by`.

   Alternatively, click :guilabel:`On-demand` to display only snapshots
   taken by clicking :guilabel:`Take Snapshot Now`.

Snapshots taken according to your backup policy display the frequency of
the policy item that generated the snapshot in the
:guilabel:`Frequency` column: ``Yearly``, ``Monthly``, ``Weekly``, 
``Daily``, or ``Hourly``.

.. note::

   .. include:: /includes/fact-overlapping-backup-policy-items.rst

.. include:: /includes/fact-backup-zone-renaming.rst

.. _cloud-provider-snapshots-on-demand:
.. _on-demand-snapshots:

Take On-Demand Snapshots
~~~~~~~~~~~~~~~~~~~~~~~~

|service| takes on-demand snapshots immediately, unlike scheduled
snapshots which occur at
:oas-atlas-op:`regular intervals 
</getBackupSchedule>`. If there is already an on-demand snapshot with 
a status of ``queued`` or ``inProgress``, you must wait until |service| 
has completed the on-demand snapshot before taking another. If there is
already a scheduled snapshot with a status of ``queued`` or 
``inProgress``, you may queue an on-demand snapshot.

.. note::

   If you have a :ref:`{+bcp+} enabled <backup-compliance-policy>` with 
   a specified retention time for on-demand snapshots, you can't 
   decrease the retention time for an on-demand snapshot after 
   it's taken.

.. tabs::

   .. tab:: {+atlas-cli+}
      :tabid: atlascli

      You must have the :authrole:`Organization Owner` or 
      :authrole:`Project Owner` role to successfully call these 
      endpoints.

      .. include:: /includes/extracts/atlas-backups-snapshots-create-and-watch.rst

   .. tab:: {+atlas-ui+}
      :tabid: ui

      .. include:: /includes/take-on-demand-snapshot-ui.rst