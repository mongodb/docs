.. _cpp-extended-json:

=============
Extended JSON
=============

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: twocols

.. facet::
   :name: genre
   :values: reference

Overview
--------

In this guide, you can learn how to use the **Extended JSON** data format
when interacting with MongoDB documents.

JSON is a human-readable data format that represents the values of objects,
arrays, numbers, strings, booleans, and nulls. This format supports only a
subset of BSON data types, which is the format that MongoDB uses to store data. The
Extended JSON format supports more BSON types, defining a reserved
set of keys prefixed with "``$``" to represent field type information that
directly corresponds to each type in BSON.

To learn more about JSON, BSON, and Extended JSON, see the
`JSON and BSON <https://www.mongodb.com/resources/basics/json-and-bson>`__ resource
and :manual:`Extended JSON </reference/mongodb-extended-json/>` {+mdb-server+} manual
entry.

Extended JSON Formats
---------------------

MongoDB Extended JSON provides string formats to represent BSON data.
Each format conforms to the `JSON RFC <https://www.rfc-editor.org/rfc/rfc8259>`__
and meets specific use cases.

The following table describes each Extended JSON format:

.. list-table::
   :header-rows: 1
   :stub-columns: 1
   :widths: 10 40

   * - Name
     - Description

   * - **Canonical**
     - | A string format that avoids loss of BSON type information during data conversions.
       | This format prioritizes type preservation at the loss of human-readability and
         interoperability with older formats.  To specify this mode, pass ``bsoncxx::ExtendedJsonMode::k_canonical`` as a ``mode`` argument to the ``to_json()`` method.

   * - **Relaxed**
     - | A string format that describes BSON documents with some type information loss.
       | This format prioritizes human-readability and interoperability at the loss of
         certain type information. To specify this mode, pass ``bsoncxx::ExtendedJsonMode::k_relaxed`` as a ``mode`` argument to the ``to_json()`` method.

   * - **Legacy**
     - | A string format that describes BSON documents with some type information loss. 
       | This format matches Relaxed Extended JSON with some exceptions.
       | The {+driver-short+} uses this mode by default.

.. note::

   The {+driver-short+} parses the ``$uuid`` Extended JSON type from a string to a
   ``b_binary`` object of binary subtype 4. For more information about ``$uuid`` field
   parsing, see the
   :spec:`special rules for parsing $uuid fields </extended-json/extended-json.md#special-rules-for-parsing-uuid-fields>`
   section in the extended JSON specification.

.. _extended_json_example_section:

Extended JSON Examples
~~~~~~~~~~~~~~~~~~~~~~

The following examples show a document containing an ObjectId, date, and long
number field represented in each Extended JSON format. Click the tab that
corresponds to the format of the example you want to see:

.. tabs::

   .. tab:: Canonical
      :tabid: canonical-format

      .. code-block:: json

         {
           "_id": { "$oid": "573a1391f29313caabcd9637" },
           "createdAt": { "$date": { "$numberLong": "1601499609" }},
           "numViews": { "$numberLong": "36520312" }
         }

   .. tab:: Relaxed Mode
      :tabid: relaxed-mode-format

      .. code-block:: json

         {
           "_id": { "$oid": "573a1391f29313caabcd9637" },
           "createdAt": { "$date": "2020-09-30T18:22:51.648Z" },
           "numViews": 36520312
         }

   .. tab:: Legacy Mode
      :tabid: legacy-mode-format

      .. code-block:: json
     
         {
           "_id": { "$oid": "573a1391f29313caabcd9637" },
           "createdAt": { "$date": "1601499771648" },
           "numViews": 36520312
         }

Read Extended JSON
------------------

You can read an Extended JSON string into a C++ BSON document by calling
the ``bsoncxx::from_json()`` method. This method parses an Extended
JSON string and returns a ``bsoncxx::document::value`` containing the data.

The following example shows how you can read an Extended JSON string into a
BSON document by using the ``from_json()`` method:

.. literalinclude:: /includes/data-formats/extended-json.cpp
   :start-after: start-ex-json-read
   :end-before: end-ex-json-read
   :language: cpp
   :dedent:

Write Extended JSON
-------------------

You can write an Extended JSON string by using the ``bsoncxx::to_json()`` method. By default, this method returns the Extended JSON string in the legacy
format, but you can specify canonical or relaxed formats by passing a ``mode`` argument. 

.. note:: Legacy Version

   The legacy format option tells the {+driver-short+} to serialize BSON types
   with the Libbson Legacy Extended JSON format. The driver uses this as the default mode. 

   For more information, see the `Legacy Extended JSON <https://mongoc.org/libbson/current/legacy_extended_json.html>`__ page in the C Driver API documentation.

The ``bsoncxx::to_json()`` method is available for several core and standard
library types, including ``array`` and ``document``. The following example converts a ``document`` value into
an Extended JSON string in the canonical format:

.. io-code-block::
   :copyable:

   .. input:: /includes/data-formats/extended-json.cpp
      :start-after: start-ex-json-write
      :end-before: end-ex-json-write
      :language: cpp
      :dedent:

   .. output::
      :language: none
      :visible: false

      {"myNumber":{"$numberInt":"11223344"},"myString":"String value"}
      
Additional Information
----------------------

API Documentation
~~~~~~~~~~~~~~~~~

To learn more about the types and methods mentioned in this guide, see the following API documentation:

- `bsoncxx::from_json() <{+api+}/namespacebsoncxx_1_1v__noabi.html#ab0e7628a9514418eee8fbb66a1ec20f6>`__
- `bsoncxx::to_json() <{+api+}/namespacebsoncxx_1_1v__noabi.html#a3075c061f11e66776c71457d9a73f1ca>`__
- `ExtendedJSONMode <{+api+}/namespacebsoncxx.html#a60dd2f6217949fcc5aed38795773dfb4>`__

Server Manual Pages
~~~~~~~~~~~~~~~~~~~

To learn more about Extended JSON, see :manual:`MongoDB Extended JSON (v2)</reference/mongodb-extended-json/>` in the {+mdb-server+} manual.