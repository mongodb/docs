=========================================
Configure Monitoring Agent for MONGODB-CR
=========================================

.. default-domain:: mongodb

In MongoDB 3.0 and later, MongoDBâ€™s default authentication mechanism is
a challenge and response mechanism (``SCRAM-SHA-1``). Previously, MongoDB
used MongoDB Challenge and Response (``MONGODB-CR``) as the default.

The Monitoring Agent can use ``MONGODB-CR`` or ``SCRAM-SHA-1``
to authenticate to hosts that enforce access control.

To authenticate using ``SCRAM-SHA-1`` or ``MONGODB-CR``, create a user
in the ``admin`` database with the appropriate roles in MongoDB.

.. include:: /includes/extracts/note-manage-agent-auth-with-automation-mongodbcr.rst

.. only:: classic

   Prerequisites
   -------------

   .. include:: /includes/fact-auth-monitoring-requirements.rst

Procedures
----------

Create MongoDB User for the Agent
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/prerequisites-create-user-for-agent.rst

.. include:: /includes/considerations-agent-access-control.rst

MongoDB 2.6 and Later
`````````````````````

To monitor MongoDB 2.6 instances, create a user in the ``admin``
database with an operation that resembles the following:

.. code-block:: javascript

   use admin
   db.createUser(
      {
        user: "<username>",
        pwd: "<password>",
        roles: [ { role: "clusterMonitor", db: "admin" } ]
      }
   )

See :ref:`Access Control for MongoDB 2.6 <access-control-monitoring-agent-2.6>` for more
information on the required access.

MongoDB 2.4
```````````

To monitor MongoDB 2.4 instances, create a user in the ``admin``
database with an operation that resembles the following:

.. code-block:: javascript

   use admin
   db.addUser( 
      {
        user: "<username>",
        pwd: "<password>",
        roles: [ 
           "clusterAdmin",
           "readAnyDatabase"
        ]
      }
   )

Refer to the :ref:`Access Control for MongoDB 2.4 <access-control-2.4>` reference
to choose which MongoDB roles to provide for the Monitoring Agent.
For example, if you wish to monitoring with database profiling,
you will need to include the :role:`dbAdminAnyDatabase` role.

Host Settings
~~~~~~~~~~~~~

.. include:: /includes/fact-access-control-host-settings.rst

