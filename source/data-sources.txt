:noprevnext:

============
Data Sources
============

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

Data sources in |charts| reference a :ref:`collection <collections>`
or :ref:`view <3.4-reference-views>` in your MongoDB
deployment. When building a chart, you will need to specify the data
source that the chart uses.

To view, add, or remove data sources, click :guilabel:`Data Sources` on
the top navigation bar.

Data Sources View
-----------------

The :guilabel:`Data Sources` view displays existing data sources that
the currently logged-in user has permission to view. The data sources
are displayed in a tabular format with the following columns:

.. figure:: /images/charts/data-sources-view.png
   :alt: Diagram of the "Data Sources" view
   :figwidth: 750px

.. list-table::
   :header-rows: 1
   :widths: 38 72

   * - Column
     - Description

   * - :guilabel:`Deployment`
     - The MongoDB deployment containing the source database and
       collection. Identified by the hostname and port of the first host
       in the :manual:`Connection String URI </reference/connection-string>`.

   * - :guilabel:`Database`
     - The database containing the source collection or view.

   * - :guilabel:`Collection`
     - The collection or view from where |charts-short| retrieves data.

   * - :guilabel:`Alias`
     - Optional. The display name of the data source used by the
       Chart Builder. Providing an :guilabel:`Alias` may result in a
       shorter and more identifiable name when selecting a data source
       in the :doc:`chart builder </build-charts>`.

       To modify the :guilabel:`Alias` for a data source, see the
       :ref:`Modify a Data Source <mod-data-source-alias>`
       section.

   * - :guilabel:`Last modified`
     - The date the data source was last modified.

   * - :guilabel:`Permissions`
     - The icon next to the :guilabel:`Access` button denotes the
       :ref:`permissions <permission-model>` you have on the data source:

       :guilabel:`Eye Icon`
         You have ``Reader`` permission.

       :guilabel:`Globe Icon`
         You have either ``Manager`` or ``Owner`` permission and
         :ref:`Everyone <data-source-access-everyone>` has some level
         of access to the data source.

       :guilabel:`Group Icon`
         You have either ``Manager`` or ``Owner`` permission and
         :ref:`additional users <data-source-specific-access>` have
         some level of access to the data source.

       :guilabel:`Lock Icon`
         You have ``Owner`` permission and no other user has
         access.

       To modify the permissions for a data source, see the
       :ref:`Modify a Data Source <mod-data-source-permissions>`
       section.

.. note::
   You can sort data sources by any of the columns by clicking on the
   column header. You can also search across all columns using the
   search bar on the upper right corner of the view.

.. _add-data-source:

Add a Data Source
-----------------

1. From the :guilabel:`Data Sources` view, click the
   :guilabel:`New Data Source` button.

#. Enter the :manual:`Connection String URI </reference/connection-string>`
   of the MongoDB deployment to which you want to connect.

   .. important::
      |charts| requires that MongoDB deployments run version 3.4 or
      later.

      If your MongoDB deployment is running with
      :manual:`authentication </core/authentication/>`
      enabled, include a database user's credentials in the connection
      string URI. Anonymous, SCRAM, and LDAP authentication mechanisms
      are supported. The database user must have
      :manual:`read permissions </reference/built-in-roles/#read>` on
      the collections selected in the following step.

      If the authenticated user does not have the
      :manual:`listDatabases
      </reference/privilege-actions/#listDatabases>` privilege on the
      deployment specified in the URI, they can still add the data
      source by specifying the desired database as part of the URI. In
      this case, the URI takes the following form:

      .. code-block:: none

         mongodb://[username:password@]<server>:<port>/<database>

      If your deployment is running with |tls-ssl| enabled, add the
      ``ssl=true`` option to the URI:

      .. code-block:: none

         mongodb://[username:password@]<server>:<port>/<database>?ssl=true

      For more information, see
      :doc:`/administration/configure-ssl-data-sources`.

#. Click :guilabel:`Connect`.

#. Select the collections from which you wish to create data sources.
   |charts-short| creates a separate data source for each selected
   collection.

#. Click :guilabel:`Set Permissions`.

#. Set the :ref:`permissions <permission-model>` for the data source.
   You can search for specific users by name or email address using
   the search bar.

#. Click :guilabel:`Publish Data Source`.

   .. note::

      If you selected multiple collections for your data source in step
      4, the data source :ref:`permissions <permission-model>` you
      select are applied to all of the selected collections when you
      publish your data source. If you wish to apply different
      permissions to individual collections that you have selected, you
      will need to edit those data sources after publishing.

You will see your newly added data source listed in the
:guilabel:`Data Sources` view.

.. _permission-model:

Permissions
~~~~~~~~~~~

Data source permissions dictate which |charts-short|
users have access to the data source and their respective :ref:`roles
<data-source-roles>` for the data source. A user's role dictates which
actions they can perform on the data source. The following data source
roles are available:

.. _data-source-roles:

.. list-table::
   :header-rows: 1
   :widths: 20 80

   * - Role
     - Description

   * - Reader
     - Can access the data source by viewing existing charts or
       creating new charts which use the data source.

   * - Manager
     - Has all privileges of ``Reader`` and can also
       :ref:`modify the alias <mod-data-source-alias>` of a data
       source.

       .. note::

          ``Manager`` will provide the ability to modify the data
          source connection string in the GA release of |charts|.

   * - Owner
     - Has all privileges of ``Manager`` and can also
       :ref:`manage permissions <mod-data-source-permissions>` on the
       data source and :ref:`remove the data source
       <charts-remove-data-source>`.

       The creator of the data source automatically has the
       ``Owner`` role. The creator cannot be removed from the list of
       data source users and thier ``Owner`` role cannot be modified.

.. _data-source-specific-access:

Specific User Access
````````````````````

To give specific users access to your data source:

1. Search for the desired user using the search bar directly above
   where the data source users are listed. Search can be performed
   by either username or email.

#. Click the desired user to add them to the permissions list.

#. Use the dropdown to the right of the user's name to assign the
   appropriate :ref:`role <data-source-roles>`.

   .. raw:: html

      <br>

   .. figure:: /images/charts/data-source-permissions.gif
      :alt: Adding a data source user
      :figwidth: 721px

#. Repeat steps 1-3 for each user you wish to grant data source access.

#. Click :guilabel:`Publish Data Source`.

To remove access for a user you have added, click the trash can icon
to the right of the user's name.

.. _data-source-access-everyone:

Access for All Users
````````````````````

In addition, to allow acess to a data source for *all* |charts|
users:

1. Toggle the switch on the right-side of the :guilabel:`Everyone` user
   to ``On``.

#. Select the :ref:`role <data-source-roles>` to apply to all |charts|
   users.

   .. note::

      If permissions are assigned to both :guilabel:`Everyone` and a
      specific user, the user's specific permissions take precedence
      over the permissions set to :guilabel:`Everyone`.

      For example, if :guilabel:`Everyone` has the ``Manager``
      role and a specific user Alice has the ``Reader`` role,
      Alice's effective permission level is ``Reader``.

#. Click :guilabel:`Publish Data Source`.

.. _charts-modify-data-source:

Modify a Data Source
--------------------

|charts| users can modify certain properties of a data source provided
they have appropriate :ref:`permissions <permission-model>` on the
target data source. The following data source properties may be
modified after a data source has been created:

- :ref:`Alias <mod-data-source-alias>`

- :ref:`Permissions <mod-data-source-permissions>`

.. note::

   In the GA release of |charts|, data source connection strings will
   be able to be modified as well.

.. _mod-data-source-alias:

Modify Data Source Alias
~~~~~~~~~~~~~~~~~~~~~~~~

A data source ``Manager`` or ``Owner`` can modify the :guilabel:`Alias`
of a data source by hovering over the row's :guilabel:`Alias` field,
then clicking either :guilabel:`Add Alias` or the edit button
(pencil icon). Click the green check mark to save the alias.

.. _mod-data-source-permissions:

Modify Data Source Permissions
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

A data source ``Owner`` can add, modify, and remove user permissions on
a data source.

1. From the :guilabel:`Data Sources` view, click the :guilabel:`Access`
   button in the :guilabel:`Permissions` column for the data source you
   want to modify permissions.

#. Perform the desired permission changes for the data source. Refer
   to the :ref:`Permissions <permission-model>` section for details
   on the permissions available and instructions on modifying the
   permissions.

#. Click :guilabel:`Apply Changes`.

.. _charts-remove-data-source:

Remove a Data Source
--------------------

.. important::

   To remove a data source, you must have the ``Owner``
   :ref:`permission <permission-model>` on that data source.

To remove a data source:

1. From the :guilabel:`Data Sources` view, click the red trash can icon
   on the right-hand side of the data source you want to delete.

#. Click :guilabel:`Delete Data Source` to confirm deletion.

.. important::

   Any charts using the deleted data source will need to be
   reconfigured using a different data source or deleted.
