.. _deployment-diagrams:

=============================
Example Deployment Topologies
=============================

.. default-domain:: mongodb

Overview
--------

The following diagrams show example |onprem| deployments.

.. _on-prem-minimal-deployment-diagram:

Test Install on a Single Server
-------------------------------

For a test deployment, you can deploy all of the |onprem|
components to a single server, as described in
:doc:`/tutorial/install-simple-test-deployment`. Ensure you :ref:`configure
the appropriate ulimits <onprem-config-ulimits>` for the deployment.

.. include:: /images/opsmanager-test.rst

The :term:`head databases <head database>` are dynamically created and maintained
by the Backup Daemon. They reside on the disk partition specified
in the ``conf-daemon.properties`` file.

Production Install with Redundant Metadata and Snapshots
--------------------------------------------------------

This deployment provides redundancy for the
:ref:`mms-application-database` and :ref:`backup-database`, in the event
of server failure. The deployment keeps a redundant copy of each database
by running each as a MongoDB :term:`replica set`, each with two
data-bearing members and an arbiter.

This deployment does not provide high availability: the deployment cannot
accept writes to a database if a data-bearing replica set member is lost.
|onprem| uses ``w: 2`` :manual:`write concern </reference/write-concern>`,
with requires acknowledgement from both data-bearing members in order
write to the database.

.. include:: /images/opsmanager-medium.rst

**Server 1** must satisfy the combined :doc:`hardware and software
requirements </core/requirements>` for the |application| hardware and
|application| Database hardware.

**Server 2** must satisfy the combined hardware and software
requirements for the Backup Daemon hardware and Backup
Database hardware. The Backup Daemon automatically creates and
maintains the :term:`head databases <head database>`, which reside on the
disk partition specified in the ``conf-daemon.properties`` file.
Do not place the head databases on the same disk partition
as the Backup Database, as this will reduce the Backup feature's
performance.

**Server 3** hosts replica set members for the |application| Database
and Backup Database. Replica sets provide data redundancy and
are strongly recommended, but are not required for |onprem|.
Server 3 must satisfy the combined hardware and software
requirements for the |application| Database hardware and Backup
Database hardware.

For an example tutorial on installing the minimally viable |onprem|
installation on RHEL 6+ or Amazon Linux, see
:doc:`/tutorial/install-basic-deployment`.

.. note:: **Durable Metadata and Snapshots**

   To make the |application| and Backup Databases durable, run each
   three-member with three data-bearing members and ensure journaling is
   enabled.

.. _highly-available-deployment:

Production Install with a Highly Available |application| and Multiple Backup Databases
--------------------------------------------------------------------------------------

This |onprem| deployment provides high availability for the |application|
by running multiple instances behind a load balancer. This deployment
scales out to add an additional Backup Database.

.. include:: /images/opsmanager-large.rst

The deployment
includes two servers that host the |application| and the |application|
Database, four servers that host Backup Daemons and Backup Databases, and an
additional server to host the :term:`arbiters <arbiter>` for each
replica set.

Deploy an HTTP Load Balancer to balance the HTTP traffic for the
|http-service|. |onprem| does not supply
an HTTP Load Balancer: you must deploy and configure it yourself.

All of the software services need to be able to communicate with
the |application| Databases and the Backup Databases.
Configure your firewalls to allow traffic between these servers
on the :doc:`appropriate ports </reference/firewall-configuration>`.

- **Server 1** and **Server 2** must satisfy the combined :doc:`hardware
  and software requirements </core/requirements>` for the |application|
  hardware and |application| Database hardware.

- **Server 3**, **Server 4**, **Server 5**, and **Server 6** must
  satisfy the combined hardware and software requirements
  for the Backup Daemon hardware and Backup Database hardware.

  The Backup Daemon creates and maintains the :term:`head databases <head database>`,
  which reside on the disk partition specified in the
  ``conf-daemon.properties`` file. Only the Backup Daemon needs to
  communicate with the head databases. As such, their :setting:`net.bindIp` value
  is ``127.0.0.1`` to prevent external communication.
  :setting:`net.bindIp` specifies the IP address that
  :program:`mongod` and :program:`mongos` listens to for connections
  coming from applications.

  For best performance, each Backup server should have 2 partitions. One
  for the Backup Database, and one for the head
  databases.

- **Server 7** and **Server 8** host :term:`secondaries <secondary>` for
  the |application| Database, and for the two Backup
  Databases. They must satisfy the combined hardware and software
  requirements for the databases.

For the procedure to install |onprem| with high availability, see
:doc:`/tutorial/configure-application-high-availability`.
