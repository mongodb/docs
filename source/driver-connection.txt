==================
Connect via Driver
==================

.. default-domain:: mongodb

.. meta::
   :keywords: connect

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

The :guilabel:`Connect` dialog for a cluster provides the details to
connect to a cluster with an application using a
:driver:`MongoDB driver </>`.

.. admonition:: 3.6-Series Driver Compatibility with MongoDB 4.2
   :class: note

   The drivers recommended for MongoDB 3.6 in the
   :driver:`driver compatibility matrices </driver-compatibility-reference/>`
   are tested against MongoDB 4.2.

   Applications running with 3.6-series drivers will work
   against MongoDB clusters running MongoDB 4.2 as long as:

   - No :manual:`functionality new to MongoDB 4.0
     </release-notes/4.0/>` is being used,

   - No :manual:`functionality new to MongoDB 4.2 </release-notes/4.2>`
     is being used, and

   - No commands, methods, or options
     :manual:`removed in MongoDB 4.0 </release-notes/4.0-compatibility/#general>`
     or :manual:`removed in MongoDB 4.2 </release-notes/4.2/#removed-commands-and-methods>`
     (which means ``geoNear``, ``db.collection.group()``, and
     ``db.eval()``) are being used.

   We still recommend using MongoDB 4.2-series drivers with
   MongoDB 4.2 to utilize newer database features and better prepare
   for future version upgrades.

.. seealso:: :ref:`connection-limits`

Prerequisites
-------------

|tls|
~~~~~

Clients must support |tls| to connect to an |service| cluster.

Clients must support the :rfc:`SNI <6066#section-3>` |tls| extension to
connect to an |service| ``M0`` Free Tier or ``M2/M5`` shared starter
cluster. To verify that your driver supports the |sni| |tls| extension,
refer to the :driver:`Driver Compatibility <driver-compatibility-reference/>` matrix for your driver. If the driver is compatible with MongoDB 3.4 and later, it supports the |sni|
|tls| extension.

.. include:: /includes/fact-connection-prereq-whitelist.rst

.. include:: /includes/fact-connection-prereq-user.rst

Connect Your Application
------------------------

.. include:: /includes/steps/connect-to-cluster-driver.rst

Driver Examples
---------------

In this example
:manual:`URI connection strings </reference/connection-string/>`, the
user ``kay`` provides their password ``myRealPassword`` to
authenticate and connect to |a-service| cluster.

Select your driver from the following options:

.. tabs-pillstrip:: languages

.. tabs-drivers::

   tabs:
     - id: c
       content: |

         .. note::

            .. include:: /includes/extracts/driver-free-tier-c.rst

         .. code-block:: c

            client = mongoc_client_new ("mongodb+srv://kay:myRealPassword@cluster0.mongodb.net/?serverSelectionTryOnce=false&serverSelectionTimeoutMS=15000&w=majority");
            db = mongoc_client_get_database (client, "test");

         .. list-table::
            :header-rows: 1

            * - MongoDB Version
              - Recommended Driver Version(s)

            * - MongoDB 4.0
              - :ref:`Version 1.11 or later <reference-compatibility-mongodb-c>`

            * - MongoDB 3.6
              - :ref:`Version 1.9 or later <reference-compatibility-mongodb-c>`

         Behavior
         ~~~~~~~~

         .. include:: /includes/extracts/c-driver-single-threaded.rst

     - id: cpp
       content: |

         .. note::

            .. include:: /includes/extracts/driver-free-tier-cpp.rst

         .. code-block:: cpp

            #include <mongocxx/client.hpp>
            #include <mongocxx/instance.hpp>

            //...

            mongocxx::instance inst{};
            mongocxx::client conn{mongocxx::uri{"mongodb+srv://kay:myRealPassword@cluster0.mongodb.net/test?serverSelectionTryOnce=false&serverSelectionTimeoutMS=15000&w=majority"}};
            mongocxx::database db = conn["test"];

         .. list-table::
            :header-rows: 1

            * - MongoDB Version
              - Recommended Driver Version(s)

            * - MongoDB 4.0
              - :ref:`Version 3.4.x <reference-compatibility-mongodb-cpp>`

            * - MongoDB 3.6
              - :ref:`Version 3.3.x <reference-compatibility-mongodb-cpp>`

         .. note::

            The Legacy C++ driver has reached End-Of-Life, and is no
            longer supported.

         Behavior
         ~~~~~~~~

         .. include:: /includes/extracts/cplus-driver-single-threaded.rst

     - id: csharp
       content: |

         .. note::

            .. include:: /includes/extracts/driver-free-tier-csharp.rst

         .. code-block:: csharp

            var client = new MongoClient("mongodb+srv://kay:myRealPassword@cluster0.mongodb.net/test?w=majority");
            var database = client.GetDatabase("test");

         .. list-table::
            :header-rows: 1

            * - MongoDB Version
              - Recommended Driver Version(s)

            * - MongoDB 4.0
              - :ref:`Version 2.7 <reference-compatibility-mongodb-csharp>`

            * - MongoDB 3.6
              - :ref:`Version 2.5 <reference-compatibility-mongodb-csharp>`

         .. note::

            Microsoft .NET Core library versions *2.1 and later*
            support the |sni| |tls| extension on Linux and macOS.
            Applications using prior versions of .NET Core on these
            platforms cannot connect to a |service| ``M0`` Free Tier or
            ``M2/M5`` shared-tier cluster.

            To learn more this requirement, see this
            :gh:`dotnet/corefx issue </dotnet/corefx/issues/9608>`.

     - id: go
       content: |

         .. note::

            .. include:: /includes/extracts/driver-free-tier-go.rst

         .. code-block:: go

            uri := "mongodb+srv://kay:myRealPassword@cluster0.mongodb.net/test?w=majority"

            ctx, cancel := context.WithTimeout(context.Background(), 10*time.Second)
            defer cancel()
            
            client, err := mongo.Connect(ctx, options.Client().ApplyURI(uri))
            if err != nil {
                panic(err)
            }

            defer func() {
                if err = client.Disconnect(ctx); err != nil {
                    panic(err)
                }
            }()

            // Ping the primary
            if err := client.Ping(ctx, readpref.Primary()); err != nil {
                panic(err)
            }

         .. list-table::
            :header-rows: 1

            * - MongoDB Version
              - Recommended Driver Version(s)

            * - MongoDB 4.0
              - :ref:`Version 1.0.0 or later <reference-compatibility-mongodb-go>`

            * - MongoDB 3.6
              - :ref:`Version 1.0.0 or later <reference-compatibility-mongodb-go>`

     - id: java-sync
       content: |

         .. note::

            .. include:: /includes/extracts/driver-free-tier-java.rst

         .. code-block:: java

            MongoClientURI uri = new MongoClientURI(
                "mongodb+srv://kay:myRealPassword@cluster0.mongodb.net/test?w=majority");

            MongoClient mongoClient = new MongoClient(uri);
            MongoDatabase database = mongoClient.getDatabase("test");

         .. list-table::
            :header-rows: 1

            * - MongoDB Version
              - Recommended Driver Version(s)

            * - MongoDB 4.0
              - :ref:`Version 3.8 or later <reference-compatibility-mongodb-java>`

            * - MongoDB 3.6
              - :ref:`Version 3.6 or later <reference-compatibility-mongodb-java>`

     - id: nodejs
       content: |

         .. note::

            .. include:: /includes/extracts/driver-free-tier-node.rst

         .. code-block:: javascript

            const MongoClient = require('mongodb').MongoClient;
            const uri = "mongodb+srv://kay:myRealPassword@cluster0.mongodb.net/test?w=majority";
            const client = new MongoClient(uri, { useNewUrlParser: true });
            client.connect(err => {
              const collection = client.db("test").collection("devices");
             // perform actions on the collection object
              client.close();
            });

         .. include:: /includes/extracts/connection-details-driver.rst

         .. example::

            The following connection string specifies ``test`` in the
            database component and includes the ``authSource=admin``
            option.

            .. code-block:: javascript

               var uriTestDb = "mongodb+srv://kay:myRealPassword@cluster0.mongodb.net/test?ssl=true&authSource=admin&w=majority";
               MongoClient.connect(uriTestDb, function(err, db) {
                  db.close();
               });

         .. list-table::
            :header-rows: 1

            * - MongoDB Version
              - Recommended Driver Version(s)

            * - MongoDB 4.0
              - :ref:`Version 3.1 or later <reference-compatibility-mongodb-node>`

            * - MongoDB 3.6
              - :ref:`Version 3.0 or later <reference-compatibility-mongodb-node>`

     - id: perl
       content: |

         .. note::

            .. include:: /includes/extracts/driver-free-tier-perl.rst

         .. code-block:: perl

            my $client = MongoDB->connect('mongodb+srv://kay:myRealPassword@cluster0.mongodb.net/test?w=majority');
            my $db = $client->get_database( 'test' );

         .. list-table::
            :header-rows: 1

            * - MongoDB Version
              - Recommended Driver Version(s)

            * - MongoDB 4.0
              - :ref:`Version 3.1 or later <reference-compatibility-mongodb-perl>`

            * - MongoDB 3.6
              - :ref:`Version 3.0 or later <reference-compatibility-mongodb-perl>`

         Behavior
         ~~~~~~~~

         .. include:: /includes/extracts/perl-driver-single-threaded.rst

     - id: php
       content: |

         .. note::

            .. include:: /includes/extracts/driver-free-tier-php.rst

         The following example uses the MongoDB PHP Library which provides a
         high-level abstraction around the lower-level PHP driver:

         .. code-block:: php

            $client = new MongoDB\Client(
                'mongodb+srv://kay:myRealPassword@cluster0.mongodb.net/test?serverSelectionTryOnce=false&serverSelectionTimeoutMS=15000&w=majority"');

            $db = $client->test;

         .. list-table::
            :header-rows: 1

            * - MongoDB Version
              - Recommended Driver Version(s)

            * - MongoDB 4.0
              - :ref:`PHPLIB 1.4 + mongodb-1.5 <reference-compatibility-mongodb-php>`

            * - MongoDB 3.6
              - :ref:`PHPLIB 1.3 + mongodb-1.3 <reference-compatibility-mongodb-php>`

         Behavior
         ~~~~~~~~

         .. include:: /includes/extracts/php-driver-single-threaded.rst

     - id: python
       content: |

         .. note::

            .. include:: /includes/extracts/driver-free-tier-python.rst

         .. code-block:: python

            import pymongo
            import dns # required for connecting with SRV

            client = pymongo.MongoClient("mongodb+srv://kay:myRealPassword@cluster0.mongodb.net/test?w=majority")
            db = client.test

         .. list-table::
            :header-rows: 1

            * - MongoDB Version
              - Recommended Driver Version(s)

            * - MongoDB 4.0
              - :ref:`Version 3.7 or later <reference-compatibility-mongodb-python>`

            * - MongoDB 3.6
              - :ref:`Version 3.6 or later <reference-compatibility-mongodb-python>`

         .. admonition:: macmacOS and Python 3.6 Installers

            The Python 3.6 installers for macOS from
            `<https://www.python.org>`_ do not automatically install
            any CA certificates. Without installed CA certificates,
            connections to |service| will fail certificate
            verification.

            After you run the installer from
            `<https://www.python.org>`_ to install Python 3.6, you
            must run the following script to install an up-to-date CA
            bundle before connecting to |service|:

            .. code-block:: sh

               open "/Applications/Python 3.6/Install Certificates.command"

            For more information on Python 3.6 installers for macOS
            from `<https://www.python.org>`_, see
            `<https://bugs.python.org/issue29065#msg283984>`_. Earlier
            versions of Python as well as Python 3.6 installed by
            other means (e.g. `Homebrew
            <https://brew.sh/#install>`__), are not affected.

     - id: ruby
       content: |

         .. note::

            .. include:: /includes/extracts/driver-free-tier-ruby.rst

         .. code-block:: ruby

            client = Mongo::Client.new('mongodb+srv://kay:myRealPassword@cluster0.mongodb.net/?ssl=true&w=majority')

         .. include:: /includes/extracts/connection-details-driver.rst

         .. example::

            The following connection string specifies ``test`` in the
            database component and includes the ``authSource=admin`` option.

            .. code-block:: ruby

               client = Mongo::Client.new('mongodb+srv://kay:myRealPassword@cluster0.mongodb.net/test?ssl=true&replicaSet=Mycluster0-shard-0&authSource=admin&w=majority')

         .. list-table::
            :header-rows: 1

            * - MongoDB Version
              - Recommended Driver Version(s)
            * - MongoDB 4.0
              - :ref:`Version 2.6 or later <reference-compatibility-mongodb-ruby>`
            * - MongoDB 3.6
              - :ref:`Version 2.5 or later <reference-compatibility-mongodb-ruby>`

         Mongoid Example
         ~~~~~~~~~~~~~~~

         .. code-block:: yaml

            production:
              # Configure available database clients. (required)
              clients:
                # Defines the default client. (required)
                default:
                  # Defines the name of the default database that Mongoid can connect to.
                  # (required).
                  database: 'myDatabaseName'

                  # Provides the hosts the default client can connect to. Must be an array
                  # of host:port pairs. (required)
                  hosts:
                    - mycluster0-shard-00-00.mongodb.net:27017
                    - mycluster0-shard-00-01.mongodb.net:27017
                    - mycluster0-shard-00-02.mongodb.net:27017
                  options:
                    # The name of the user for authentication.
                    user: kay

                    # The password of the user for authentication.
                    password: myRealPassword

                    # The database or source to authenticate the user against. If the database
                    # specified above is not admin, admin MUST be specified here.
                    auth_source: admin

                    # All Atlas servers use SSL. (default: false)
                    ssl: true

         .. list-table::
            :header-rows: 1

            * - MongoDB Version
              - Minimum ODM Version

            * - MongoDB 4.0

              - `Version 7.0.0 or later <https://docs.mongodb.com/mongoid/7.0/>`_

            * - MongoDB 3.6

              - `Version 6.3.0 or later <https://docs.mongodb.com/mongoid/6.3/>`_

     - id: scala
       content: |

         .. note::

            .. include:: /includes/extracts/driver-free-tier-scala.rst

         .. code-block:: scala

            val uri: String = "mongodb+srv://kay:myRealPassword@cluster0.mongodb.net/test?w=majority"
            System.setProperty("org.mongodb.async.type", "netty")
            val client: MongoClient = MongoClient(uri)
            val db: MongoDatabase = client.getDatabase("test")

         .. list-table::
            :header-rows: 1

            * - MongoDB Version
              - Recommended Driver Version(s)
            * - MongoDB 4.0
              - :ref:`Version 2.4 or later <reference-compatibility-mongodb-scala>`
            * - MongoDB 3.6
              - :ref:`Version 2.2 or later <reference-compatibility-mongodb-scala>`

Troubleshooting
---------------

.. include:: /includes/fact-connection-troubleshooting.rst
