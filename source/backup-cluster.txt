=================
Back Up a Cluster
=================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. include:: /includes/fact-atlas-free-tier-limits.rst

Enabling backup for your cluster allows you to :doc:`restore
</restore-cluster>` from stored snapshots or from a selected point in
time between snapshots.

Enable Backup
-------------

You can enable backup during the :doc:`cluster creation
</create-new-cluster>` or during the :doc:`modification of an existing
cluster <scale-cluster>`. 

Specifically, in the cluster configuration, set ``Do you want to enable
backup?`` to ``Yes``.

Backup Data
-----------

|service| backup service takes snapshots of the data. These snapshots
only stores the differences between successive snapshots. For sharded
clusters, the backup service temporarily stop the balancer via the
:program:`mongos <bin.mongos>` in order to insert a marker token into all shards and
config servers in the cluster. |service| takes a snapshot when the
marker tokens appear in the backup data.

|service| provides the functionality to query specific backup snapshot.
For details, see :doc:`/query-backup`.

Size
~~~~

To reduce the snapshop data size, |service| uses compression and
block-level de-duplication technology.

Data Centers
~~~~~~~~~~~~

For |service| clusters created after June 21st, 2017, |service| stores backup
data for an |service| cluster in a data center specific to the cluster's
geographic region:

.. list-table::
   :header-rows: 1
   
   * - Cluster Location
     - Backup Service Location
     
   * - USA
     - USA
     
   * - Germany
     - Germany
     
   * - United Kingdom
     - United Kingdom
     
   * - Australia
     - Australia
     
   * - All other cluster locations
     - Ireland

|service| retains these snapshots based on the :ref:`retention policy
<retention-policy>`.

.. _modify-backup-schedule:

Modify Backup Schedule
----------------------

If you enable backup for a cluster, |service| takes a base snapshot of
your data every 6 hours.

To change a deployment's backup schedule, go to :guilabel:`Backup`. For
the cluster whose backup schedule you wish to modify, click the
ellipsis and select :guilabel:`Edit Snapshot Schedule` menu option.

.. _retention-policy:

Retention Policy
----------------

|service| retains snapshots for the time periods listed in the
following table. If you disable backup for a cluster or terminate a
cluster, |service| immediately deletes the backup snapshots for the
cluster.

.. list-table::
   :widths: 30 30 40
   :header-rows: 1

   * - Snapshot
     - Default Retention Policy
     - Maximum Retention Setting
   * - Base snapshot.
     - 2 days
     - 5 days.
   * - Daily snapshot
     - 7 days
     - 360 days
   * - Weekly snapshot
     - 4 weeks
     - 52 weeks
   * - Monthly snapshot
     - 13 months
     - 36 months

.. class:: hidden

   .. toctree::
      :titlesonly:

      /query-backup
