================
Modify a Cluster
================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

|service| Configuration Options
-------------------------------

.. list-table::

   * - :ref:`Cloud Service Provider & Region <scale-cluster-cloud-provider>`

     - You can modify the cloud service provider backing the 
       |service| cluster. Transitioning to a different provider
       requires your cluster connection string to change.

       You can also change the cluster's region.

   * - :ref:`Deploy or Configure a multi-region cluster <scale-cluster-region>`
     - You can deploy or modify a multi-region cluster.

   * - :ref:`Instance Size <scale-cluster-instance>`

     - You can modify the instance size of the cluster.

   * - :ref:`Instance Storage Options <scale-cluster-storage>`

     - You can modify the storage options for the selected instance 
       size.

   * - :ref:`MongoDB Version <scale-cluster-version>`

     - You can upgrade the major MongoDB version of the cluster.

       Only available for cluster with an :guilabel:`Instance Size`
       of ``M10`` or larger.

       You cannot downgrade the MongoDB version of a cluster.

   * - :ref:`Deploy a Sharded Cluster <scale-cluster-sharding>`

     - If your cluster is a replica set, you can upgrade the deployment 
       to a sharded cluster.
       
       Only available for clusters with an :guilabel:`Instance Size` of
       ``M30`` or larger.

   * - :ref:`Modify the Number of Shards <scale-cluster-shardNum>`

     - You can configure the number of shards in the sharded cluster. 
       
       Only available for sharded cluster deployments.

   * - :ref:`Enable or Disable Backup <scale-cluster-backups>`

     - You can enable or disable backups for the cluster. Only available 
       for clusters with an :guilabel:`Instance Size` of ``M10`` or 
       larger.

   * - :ref:`Enable or Disable the Business Intelligence Connector <create-cluster-enable-bi>`

     - You can enable or disable the |bic| for this cluster.

       .. include:: /includes/extracts/cluster-option-bi-cluster-requirements.rst

   * - :ref:`Confirm and Deploy <scale-cluster-payment>`

     - Confirm and deploy your cluster with the selected changes.

Considerations
--------------

Migration, Downtime, and Performance Impact
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The time required for an :term:`initial sync` and resynchronizing data
across storage volumes increases linearly with the amount of data in the
cluster. Making changes to a cluster often requires migrating to new
servers and storage volumes, which can take a long time. However, cluster
changes can be made more quickly in some cases. For example, changing
the instance size of a cluster on AWS does not require an initial sync.

.. note:: 

   All changes on Azure and GCP require an initial sync. In addition,
   all changes to ``M0``, ``M2``, and ``M5`` clusters require 7-10 minutes
   of downtime.

To maximize availability:

- For a replica set, |service| migrates one node at a time, starting
  with the secondary nodes first and then the primary.

- For a sharded cluster, |service| performs the migration of the shards
  independently of each other. For each shard (i.e. replica set),
  |service| migrates one node at a time, starting with the secondary
  nodes first and then the primary.

Downtime occurs during the migration of the primary when the current
primary becomes unavailable and lasts until the election of a new
primary, generally under a minute.

Migration can affect performance if your primary is already reaching
operational capacity: each newly migrated replica set node must
perform an :term:`initial sync` from the primary, adding to the
operational load. Migrations can also affect performance if
:manual:`read preferences </core/read-preference>` are set to read from
secondaries: the replica set is down one secondary during the migration.

.. include:: /includes/fact-auto-index.rst

.. Note to writers: beginning in v20160712, an instance size change with no disk
   change does not require an initial sync

Billing
~~~~~~~

As you modify your cluster, you can compare the costs of different
options before applying them. The :guilabel:`Cluster Overview` box displays
the cost of the selected configuration, excluding data transfer.

.. admonition:: Free Tier
   :class: important

   Upgrading an ``M0`` Free Tier cluster to an ``M2`` or greater paid tier
   cluster starts billing for the cluster. See :doc:`billing` for complete
   documentation on |service| billing.

The following sections provide complete documentation for each of the
|service| cluster scaling configuration options.

.. _scale-cluster-open-dialog:

A. Open the :guilabel:`Editing Cluster` Dialog
----------------------------------------------

.. container:: admonition

   For the cluster you want to modify, click the ellipses :guilabel:`...`
   icon, then select :guilabel:`Edit Configuration`.

   Alternatively, if you are already viewing the specific cluster, click the
   :guilabel:`Configuration` button.

   For ``M0`` Free Tier clusters, you can also click the :guilabel:`Upgrade`
   button for the cluster.

.. _scale-cluster-cloud-provider:

B. Modify the :guilabel:`Cloud Provider & Region` of the Cluster
----------------------------------------------------------------

.. important::

   Changing the Cloud Provider for the cluster changes the
   connection string for that cluster. You must update your
   applications with the new connection string to resume 
   connectivity to the cluster. Consider scheduling a maintenance
   window for migrating your cluster to a new cloud provider.

.. container:: admonition

   Select :guilabel:`Cloud Provider & Region` to view the
   currently configured cloud provider and region for the cluster.

   You can change the Cloud Provider backing your cluster by selecting
   from the available Cloud Service Providers.

   Review the available regions for the selected cloud provider. 

   Regions marked as :guilabel:`Free Tier Available` support
   deploying ``M0`` Free Tier clusters. 

   Regions marked as |star| are
   :guilabel:`Recommended` regions that provide higher availability
   compared to other regions. For more information, see: 

   - :ref:`AWS Recommended Regions <amazon-aws-availability-zones>`.          
   - :ref:`GCP Recommended Regions <google-gcp-availability-zones>`.          
   - :ref:`Azure Recommended Regions <microsoft-azure-availability-zones>`.

   .. include:: /includes/extracts/fact-no-node-restriction-base.rst

   .. |star| unicode:: U+2605

   The choice of cloud provider and region affects the 
   configuration options for the available instance sizes, network 
   latency for clients accessing your cluster, and the 
   :doc:`cost of running the cluster </billing>`.

.. _scale-cluster-region:

Deploy or Modify a Multi-Region Cluster
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. container:: admonition

   .. include:: /includes/extracts/cluster-option-clusterProviderRegionOnly.rst

.. _scale-cluster-instance:

C. Modify the :guilabel:`Cluster Tier` of the Cluster
-----------------------------------------------------

.. container:: admonition

   .. admonition:: Free Tier
      :class: note

      You cannot downgrade a cluster to an ``M0`` Free Tier cluster.

   You can change the instance size, as well as the memory, storage, and IOPS
   (speed) specifications for the selected instance size.

   .. include:: /includes/extracts/cluster-option-clusterInstance.rst

.. _scale-cluster-storage:

Customize the Storage Settings of the Selected Instance
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. container:: admonition

   .. include:: /includes/extracts/cluster-option-customizeStorage.rst

D. Modify the :guilabel:`Additional Settings` of the Cluster
------------------------------------------------------------

.. container:: admonition

   From the :guilabel:`Additional Settings` section, you can

   - :ref:`scale-cluster-version`,
   - :ref:`scale-cluster-backups`,
   - :ref:`scale-cluster-sharding`,
   - :ref:`scale-cluster-shardNum`,
   - :ref:`scale-cluster-enable-bi`, and
   - :ref:`scale-cluster-enable-encryption`.

.. _scale-cluster-version:

Upgrade the MongoDB Version of the Cluster
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. container:: admonition

   Select :guilabel:`Additional Settings` to view the currently
   configured MongoDB version for the cluster.

   .. include:: /includes/extracts/fact-mongodb-version-downgrade-restriction-scale.rst

   Select the new MongoDB version from the :guilabel:`Select a version` 
   dropdown. |service| supports the following upgrade paths:

   - MongoDB 3.2 -> MongoDB 3.4
   - MongoDB 3.4 -> MongoDB 3.6
   - MongoDB 3.6 -> MongoDB 4.0

   .. include:: /includes/extracts/fact-3.2-eol-upgrade.rst

   |service| running with MongoDB 3.2 *must* upgrade to MongoDB 3.4
   before upgrading to MongoDB 3.6. 

   See :doc:`/tutorial/major-version-change` for the MongoDB-recommended
   procedure for a major version change. This procedure
   includes creating a staging cluster for the purpose of testing
   and validating application and cluster performance and functionality
   on the new MongoDB version.

.. _scale-cluster-sharding:

Scale your Replica Set to a Sharded Cluster
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. container:: admonition

   .. include:: /includes/extracts/cluster-option-clusterSharding.rst

.. _scale-cluster-shardNum:

Modify the :guilabel:`Number of Shards` in your sharded cluster
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. container:: admonition

   .. include:: /includes/extracts/cluster-option-clusterShardingNum.rst

.. _scale-cluster-backups:

Enable or Disable Backup for the Cluster
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. container:: admonition

   .. include:: /includes/extracts/cluster-option-clusterBackup.rst

   You can disable backups for the cluster by toggling this option to
   :guilabel:`No`. Once you disable backup, |service| immediately
   deletes any backup snapshots for the cluster. See 
   :doc:`/backup-cluster` for more information.

.. _scale-cluster-enable-bi:

Enable or Disable |bic| for the Cluster
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. container:: admonition

   .. include:: /includes/extracts/cluster-option-bi.rst

.. _scale-cluster-enable-encryption:

Enable Encryption at Rest
~~~~~~~~~~~~~~~~~~~~~~~~~

.. container:: admonition
   
   .. include:: /includes/extracts/cluster-option-encryption-at-rest.rst

.. _scale-cluster-payment:

E. Confirm and Deploy Your Changes
----------------------------------

.. container:: admonition

   Click :guilabel:`Confirm & Deploy` deploy your changes.

   If you are upgrading from an ``M0`` Free Tier cluster, |service| prompts
   you to enter payment information before deploying your changes.

.. include:: /includes/footnote-databearing.rst


.. class:: hidden

   .. toctree::
      :titlesonly:
      
      /tutorial/major-version-change