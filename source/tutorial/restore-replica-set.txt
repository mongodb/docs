===================================
Restore a Replica Set from a Backup
===================================

.. default-domain:: mongodb

Overview
--------

You can restore a replica set onto new hardware from the artifacts
captured by |backup|.

You can restore from a stored snapshot or from a point in time in the last
24 hours. For point-in-time recovery, MMS applies the :manual:`oplog
</core/replica-set-oplog/>` to the snapshot that is previous to the
selected point in order to create a custom snapshot. Point-in-time
recovery takes longer than recovery from a stored snapshot.

MMS provides the snapshot through a link to a tar file.

.. todo: add this info an a link when the 'download via scp' tutorial is
         written: "You can optionally download the replica set directly
         to your server through SCP."

The sequence to restore a replica set is to:

- download the restore file,

- distribute the restore file to to each server,

- start the :program:`mongod` instances, and

- initiate and configure the replica set.

For more information on restores, see :ref:`restores`. For additional
approaches to restoring replica sets, see the procedure from the MongoDB
Manual to :manual:`Restore a Replica Set from a Backup
</tutorial/restore-replica-set-from-backup>`.

Procedures
----------

Select and Download the Snapshot
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

When you select a snapshot to restore, MMS creates a link to download the
snapshot as a tar file. The link is available for one download only and
times out after an hour. Once you download the tar file, copy it to each
server to be restored.

.. include:: /includes/steps/download-snapshot-replica-set.rst

Restore the Primary
~~~~~~~~~~~~~~~~~~~

To perform this procedure you must have a copy of the snapshot's tar file
on the server that runs the primary.

.. include:: /includes/steps/restore-primary.rst

Restore Each Secondary
~~~~~~~~~~~~~~~~~~~~~~

Perform this procedure separately for each secondary. Before you perform
these steps on a secondary, you must have a copy of the snapshot's tar
file on the secondary.

.. include:: /includes/steps/restore-secondary.rst
