.. _jobs-page:
.. _admin-console-jobs-page:

====
Jobs
====

.. include:: /includes/styles/corrections.rst

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

This page lets you manage Backup jobs and Backup resources for
each group. The top part of the page displays :guilabel:`Active Jobs`
and the bottom part displays :guilabel:`Stopped Jobs`. The following
fields on the page have a yellow background if delayed:

- :guilabel:`Last Agent Conf`, if older than 1 hour.

- :guilabel:`Last Oplog`, if older than 1 hour before the
  :guilabel:`Last Agent Conf`.

- :guilabel:`Head Time`, if older than 1 hour before
  :guilabel:`Last Oplog`.

- :guilabel:`Last Snapshot`, if older than the snapshot interval
  multiplied by 1.5.

.. _manage-backup-jobs:
.. _admin-manage-backup-jobs:

Manage Backup Jobs
------------------

From the :guilabel:`Jobs` page, you can do the following:

.. list-table::
   :header-rows: 1
   :widths: 30 70

   * - Task

     - Procedure

   * - Assign a group to particular set of
       :term:`Backup Daemons <Backup Daemon>` or
       :term:`blockstores <blockstore>`.

     - Click the group, select the daemons or :term:`blockstores
       <blockstore>`, and select :guilabel:`Save Changes`.

   * - View a job's log.

     - Click the name of the job and then click the :guilabel:`Logs`
       link. Contact MongoDB Support if you need help interpreting the
       error message.

   * - View information about a job.

     - Click the job. From the job's page you can access logs, conf
       calls, and other information, and you can download diagnostics.

   * - Move a job to a new Backup Daemon.

     - Click the job. On the job's page, click the
       :guilabel:`Move head` link, select the new
       :term:`head <head database>`, and click the
       :guilabel:`Move Head` button.

   * - Filter the page to display the jobs assigned to a particular
       daemon or blockstore.

     - Click the name of the daemon or blockstore.

   * - Toggle whether a job :term:`journals <journal>` its
       :term:`head database`.

     - Select or clear :guilabel:`Journal Head` to turn on or off
       journaling for your head database.

       .. note::
          Changing this setting at the job level overrides the
          deployment-wide setting.

       See :setting:`mms.backup.journal.heads` for how to enable or
       disable journaling for all head databases in your group.

.. _admin-manage-backup-resources:

Manage Backup Resources
-----------------------

From the :guilabel:`Jobs` page, you can assign backup resources to a
particular :term:`group`.

You can make these changes for existing backups, but only new
:term:`backup jobs <backup job>` will follow the new rules. Making
these changes does not affect existing deployments. For additional
procedural information, see
:doc:`/tutorial/move-jobs-to-new-backup-daemon`.

.. list-table::
   :header-rows: 1
   :widths: 30 70

   * - Task
     - Procedure

   * - Assign a group to particular :term:`daemons <Backup Daemon>`,
       :term:`blockstores <blockstore>`
       or :term:`oplog stores <Oplog Store Database>`.

     - Click the group to open the group's assignment page; make the
       assignments; select :guilabel:`Save Changes`.

   * - Assign a group to a labelled set of daemons, blockstores,
       and oplog stores.

     - First assign the label on the Admin page for each resource. See
       :ref:`daemons-interface`, :ref:`blockstores-page`,
       and :ref:`oplog-stores-page`.

       Then, on the :guilabel:`Jobs` page:

       1. Click the group name to open the group's assignment page.

       2. In the :guilabel:`Assignment Labels` list box, click
          :guilabel:`Select Labels`.

       3. Select the label. Each selected label must exist on at least
          one daemon, one blockstore, and one oplog store. If you
          select multiple labels, the resource must meet all selected
          labels.

          Keep in mind that the resource must also meet any other
          selected criteria on this page. For example, for a daemon to
          match, it must also meet any selections you have made in the
          :guilabel:`Backup Daemon` field.

       4. Click :guilabel:`Save Changes`.

       .. warning::

          After you change the labels applied to this backup job,
          :ref:`restart backups <restart-backup>` for this deployment.
          Once backup restarts, |onprem| changes the
          :term:`oplog store <Oplog Store Database>` assigned to this
          backup job. The oplog store matches the job's assigned
          labels to an oplog store with the same
          :ref:`assigned labels <edit-oplogstore>`. This change halts
          any :term:`point-in-time restores <point-in-time restore>`
          until |onprem| takes the next snapshot after reassigning the
          oplog store.
