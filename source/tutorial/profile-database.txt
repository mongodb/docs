.. _profile-database:
.. _query-profiler:

==============
Query Profiler
==============

.. default-domain:: mongodb

.. meta::
   :keywords: profile

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

*Only available on M10+ clusters*

The Query Profiler diagnoses and monitors performance issues. This
monitoring can expose slow-running queries and their key performance
statistics in the |service| UI. You can explore a sample of historical
queries for up to last 24 hours without additional cost or performance
overhead.

|service| collects and displays statistics from any of your ``mongod``
instances. Atlas displays this data in the :guilabel:`Profiler` section
of an instance. To access the query profiler, click :guilabel:`Metrics`
for that instance in the project panel then click :guilabel:`Profiler`.

The :guilabel:`Profiler` displays one aspect, such as
:guilabel:`Operation Execution Time`, that could reveal slow database
operations over a set time frame. It displays this data in both a chart
and a table that each can filter on aspect and time frame.

|service| manages the threshold for slow operations for each
``mongod`` host based on average operation execution time on that host.

.. note::

   To opt out of the |service|-managed slow operation threshold and
   instead use a fixed slow query threshold of 100 milliseconds,
   use the |service| |api|. See :ref:`api-managed-slowms-disable`.

.. _atlas-considerations-profile-database:

Considerations
--------------

.. important:: Please read the following considerations before you enable profiling.

Security
~~~~~~~~

Profile data may include sensitive information including the content of
database queries. Ensure that exposing this data to |service| is
consistent with your information security practices.

Data Analysis Limitations
~~~~~~~~~~~~~~~~~~~~~~~~~

The Query Profiler displays up to the first of the following limits:

- the most recent 10,000 operations, or
- the most recent 10MB of logs.

Data Display Limitations
~~~~~~~~~~~~~~~~~~~~~~~~

|service| displays no more than 10,000 data points in the
:guilabel:`Profiler` charts.

Log data is processed in batches. Data can be delayed up to five
minutes from realtime.

Enable and Disable Profiling
----------------------------

|service| enables Profiling by default.

To disable profiling:

1. Click :guilabel:`Project Settings` in the left navigation.
#. Toggle :guilabel:`Performance Advisor and Profiler` to
   :guilabel:`Off`.

.. _atlas-profiler-interface:

Profiler Interface
------------------

.. _atlas-profiler-chart:

Profiling Chart
~~~~~~~~~~~~~~~

Above the chart, select the metric and time period you want to see.

1. Select the metric from the :guilabel:`Display` menu. Accepted
   options are:

   - Operation Execution Time (default)
   - Keys Examined
   - Docs Returned
   - Examined:Returned Ratio
   - Num Yields
   - Response Length

#. Select the time period from the :guilabel:`View Last` menu.
   Accepted options are:

   - 24 hr (default)
   - 12 hr
   - 6 hr
   - 1 hr
   - 15 min

.. _atlas-profiler-table:
.. _atlas-profiler-table-set-filter:

Profiling Table
~~~~~~~~~~~~~~~

Above the table, select the namespace, operation type, and metric you
wish to profile:

1. Click :guilabel:`All Namespaces` to change which combination of
   databases and collections to profile.

#. Click :guilabel:`All Operations` to change which operations you want
   to profile.

#. Click :guilabel:`Operation Execution Time` to change which metric
   you want to profile. Accepted options are:

   - Operation Execution Time (default)
   - Keys Examined
   - Docs Returned
   - Examined:Returned Ratio
   - Num Yields
   - Response Length
