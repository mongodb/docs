======================================
Frequently Asked Questions: Monitoring
======================================

.. seealso:: :doc:`/faq/management`

Host Configuration
------------------

How do I add a new host or server?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Click on the plus icon on the top of the `hosts page
<https://mms.mongodb.com/host/list>`_.

Can I monitor Kerberos-enabled nodes?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Yes. |monitoring| does support monitoring for
Kerberos-enabled MongoDB instances. See
:doc:`/tutorial/connect-to-hosts-with-kerberos-authentication`
for more information.

.. _db-stats-warning:

How does MMS gather database statistics?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

In most instances, |monitoring| will scale its request cycle to limit
more expensive statistics gathering. The information on the DB Stats
tab updates every 10 minutes, and the agent will throttle the frequency
to reduce the impact on the database. [#dbstats-tab]_ Even so, the "DB
stats" operation impacts the performance of your database, as is
possible when installations have a large number of databases and
collections.

If the collection of database statistics impacts database performance, disable
database stats collection. See the "DB Stats" section on the "Settings" page in
MMS before starting your agent.

.. [#dbstats-tab] The DB Stats tab will not appear until 30 minutes
   after you add the host to |monitoring|

|monitoring| Agent
------------------

Do I need a monitoring agent for every MongoDB?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

No. A single monitoring agent can be used to connect to all MongoDB databases
in your deployment. We strongly recommend you complete your initial monitoring
agent setup with a single monitoring agent.

For redundancy, you may wish to run a second monitoring agent. See the
:ref:`monitoring-agent-redundancy` for more information.

Can I use two Monitoring Agents to connect MongoDBs in different data centers?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

No. The monitoring agent must connect to every server in your MongoDB
deployment. Configure firewalls to allow the monitoring agent to connect across
data centers and servers.

Use multiple monitoring agents *only* to provide redundancy. Each agent
must be able to connect to every monitored MongoDB. We strongly recommend you
complete your initial monitoring agent setup with a single agent.

What happens if a Monitoring Agent becomes unavailable? How can I ensure my MongoDBs are always monitored?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The monitoring agent is fairly robust. If at least one agent is available, MMS
will not trigger an *Agent Down* alert.

To set up a second agent, first complete the initial MMS setup. If one
monitoring agent fails, the other can continue monitoring.

Please note the second agent has connectivity requirements identical to the
first agent. To support failover from one agent to the next, the second agent
also must connect to every monitored host. If you made firewall adjustments to
allow the first monitoring agent to connect successfully, make the same
adjustments for the second monitoring agent.

You also can create an alert to notify you when an agent is down. In MMS, click
:guilabel:`Activity` then :guilabel:`Agent Settings`. Click the :guilabel:`Add
Alert` button then edit the :guilabel:`Create a New Alert` window to set to
alert if Monitoring Agent is down, for which agents, and where to send the
email or SMS message.

See :ref:`monitoring-agent-redundancy` for more information.

Where should I run the Monitoring Agent?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The amount of resources the monitoring agent requires varies depending on
infrastructure size, the number of nodes and the databases it's monitoring. Run
the agent on an existing machine with additional capacity that *does not* run a
:program:`mongod` instance. You may also run the monitoring agent
on a smaller dedicated instance.

The Monitoring agent load scales with the number of monitored ``mongod`` plus
``mongos`` processes and the number of databases in your MongoDB environment.

.. include:: /includes/fact-host-for-monitoring-agent.rst

Can I run the Monitoring agent on an AWS micro instances?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

If you monitor five or fewer ``mongod`` instances, you can use
a AWS micro instance.

Why can't the Monitoring agent connect to my host?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The most common problem is that the agent is unable to resolve the
hostname of the server. Check DNS and the ``/etc/hosts`` file.

The second most common problem is that there are firewall rules in
place that prohibit access to the server from the agent.

To test the connection, login to the server running the agent and run:
``mongo hostname:port/test`` If you are unable to connect, the agent
will not be able to connect.

In addition, |monitoring| supports monitoring for
Kerberos-enabled nodes.

Why does the Monitoring agent connect with hostnames instead of IP addresses?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

By default, the monitoring agent tries to connect by resolving hostnames. If
the agent cannot connect by resolving a hostname, you can force the monitoring
agent to prefer an IP address over its corresponding hostname for a specific
IP address.

To create a preferred hostname, on the :guilabel:`Settings` page, click the
:guilabel:`Group Settings` tab then click the :guilabel:`Add` button to the
right of the Preferred Hostnames heading. If your IP addresses have a common
prefix, create a preferred hostname with the :guilabel:`ends-with` button or
click the :guilabel:`regexp` button to use a regular expression.

Preferred hostnames also allow you to specify the hostname to use for servers
with multiple aliases. This prevents servers from appearing multiple times
under different names in the MMS interface.

How do I download the Monitoring Agent?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

You can download the Monitoring Agent from the "Monitoring Agent" section on the MMS
`settings page`_.

.. _`settings page`: https://mms.mongodb.com/settings

How do I setup and configure the agent?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

See the ``README`` file included in the agent download.

.. only:: saas

   Can I run the Backup and Monitoring Agents on a Single System?
   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

   .. include:: /includes/faq-backup-and-monitoring-agent-on-one-server.rst

How do I delete a Monitoring Agent from MMS?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Monitoring agents report their status to the |mms|. When an agent does not
report for more than 24 hours, the agent no longer appears in MMS.

For more details, see :doc:`/tutorial/delete-monitoring-agent`.

Can I run the MMS Monitoring Agent with MMS Backup On Prem?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Yes. Both the MMS Monitoring Service and MMS Backup On Prem can operate in
the same environment. You will need to install and configure two separate
Monitoring agents: configure one agent for the On Prem environment and
the other for the MMS Service.

Data Presentation
-----------------

What are all those vertical bars in my charts?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

A *red bar* indicates a server restart.

A *purple bar* indicates the server is now a primary.

A *yellow bar* indicates the server is now a secondary.

How do I magnify dashboard chart data?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Click and drag on a dashboard chart, horizontally or vertically, to zoom and
isolate a specific data region. Other charts will automatically zoom to the
same region. Double click on a chart to reset zoom level.


Why is my Monitoring agent highlighted in red on the Agents tab?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Your agent is out of date.

You can update the Monitoring Agent from the "Monitoring Agent" section on the MMS
`settings page`_.

.. _`settings page`: https://mms.mongodb.com/settings


Data Retention
--------------

What is the data retention policy for |MMS|?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Data retention policies, as defined in the `Terms of Service`_ are
always subject to change. Currently, |MMS| preserves 3 days of
minute-level data is retained, 94 days of hour data, and unlimited
day-level data.

.. _`Terms of Service`: https://mms.mongodb.com/links/terms-of-service
