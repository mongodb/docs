==================================
Live Migrate Your Cluster to Atlas
==================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

|service| can perform a live migration of a source replica set to an
|service| cluster, keeping the cluster in sync with the remote source
until you cut your applications over to the |service| cluster.

.. figure:: /images/live-migrate.png

.. note::

   You cannot select an ``M0`` (Free Tier) cluster as the source or
   destination for live migration. To migrate data from an ``M0`` (Free Tier)
   cluster to a paid cluster, see 
   :doc:`Migrate Data from an M0 (Free Tier) Cluster to a Paid Cluster
   </tutorial/transition-free-tier-to-paid>`.
   
   |service| does not support live migrations from or to a sharded cluster.

Considerations
--------------

Upgrade Path
~~~~~~~~~~~~

|service| live migration supports the following migration paths:

.. list-table::
   :header-rows: 1

   * - Source Replica Set Version
     - Destination Cluster version

   * - 3.0
     - 3.2

   * - 3.2
     - 3.2

   * - 3.4
     - 3.4

Supported Authentication Mechanism
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

|service| only supports :manual:`SCRAM-SHA-1 </core/security-scram-sha-1>` for
connecting to source clusters enforcing authentication.

If the source cluster uses a different authentication mechanism, to connect
you can use the :doc:`/import/mongomirror` tool to migrate data from the
source cluster to the destination |service| cluster.

MongoDB Users and Roles
~~~~~~~~~~~~~~~~~~~~~~~

|service| does not migrate any user or role data to the destination cluster.

If the source cluster enforced authentication, you must re-create the
credentials used by your applications on the destination |service| cluster.
|service| only supports :manual:`SCRAM-SHA-1 </core/security-scram-sha-1>` for
user authentication. See :doc:`/security-add-mongodb-users` for a tutorial on
creating MongoDB users in |service|.

.. _live-import-ip-whitelist:

IP Whitelisting
~~~~~~~~~~~~~~~

Source Cluster IP Whitelist
+++++++++++++++++++++++++++

If your source cluster is protected by a firewall, grant access to the
following |service| IP ranges:

- ``4.71.186.128/25``
- ``4.35.16.128/25``

|service| Cluster IP Whitelist
++++++++++++++++++++++++++++++

|service| only allows connections to a cluster from entries in the groupâ€™s
:doc:`whitelist </security-whitelist>`. You must add IP addresses such as
application servers to the group whitelist manually. Do this before beginning
the migration procedure.

|service| temporarily adds the IP address of the |service| migration
to the group whitelist. During the migration procedure, you cannot edit
or delete this entry. |service| removes the entry automatically once the
procedure completes.

For documentation on adding entries to the |service| whitelist, see
:doc:`/security-whitelist`.

Cut Over Downtime
~~~~~~~~~~~~~~~~~

The live migration procedure requires shutting down your applications as part
of the cut over process. This results in some downtime while the migration
procedure completes, as well as the time required to update your applications
to point to the destination cluster and restart them.

Destination Cluster Configuration
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

When configuring the destination cluster, consider the following:

- The live migration process streams data through a migration application
  server running in AWS US-East. This implicitly requires two network hops to
  reach the destination cluster irrespective of the location of the source and
  destination clusters. Due to the potential latency, the live migration
  application may not be able to keep up with a source cluster that has an
  extremely heavy write load. You can instead use the
  :doc:`mongomirror </reference/mongomirror>` tool directly from the source cluster,
  pointing to the destination |service| cluster.

- The live migration process may not be able to keep up with a source cluster
  whose write workload is greater than what can be transferred and applied to
  the destination cluster. You may need to scale the destination cluster up to
  a instance with more processing power, bandwidth or disk IO.

- The destination |service| cluster must be a replica set.

- You cannot select an ``M0`` (Free Tier) cluster as the destination for
  live migration.

Data Transfer Charges
~~~~~~~~~~~~~~~~~~~~~

|service| charges for data transfer between the |service| cluster and
another server. The migration procedure incurs data charges based on the
amount of data transferred from the source cluster to the |service| cluster.

For more information on data transfer charges, see :ref:`data-transfer-costs`.

Procedure
---------

.. include:: /includes/steps/atlas-live-import.rst

.. _live-migration-support:

Migration Support
-----------------

If you have any questions regarding migration support beyond what is covered
in this documentation, or if you encounter an error during migration, please
file a support ticket through the |service| UI.

To file a support ticket,

#. Click :guilabel:`Support` in the left-hand navigation

#. For :guilabel:`Atlas Issue Category`, select ``Other``

#. For :guilabel:`Priority`, select the appropriate priority. For questions,
   please select ``Medium Priority``. If there was a failure in migration,
   please select ``High Priority``.

#. For :guilabel:`Request Summary`, please include ``Live Migration`` in the
   your summary.

#. For :guilabel:`More details`, please include any other relevant details to
   your question or migration error.
