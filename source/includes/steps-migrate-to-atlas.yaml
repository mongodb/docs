title: Launch your target replica set in MongoDB Atlas.
ref: launch-target-cluster
level: 4
stepnum: 1
content: |
   
   See :doc:`Create a MongoDB Account </cloud/account>` and 
   `Create a New Cluster 
   <https://docs.atlas.mongodb.com/tutorial/create-new-cluster/>`__
   for instructions.

   .. note::

      Your target cluster must use ``M10`` or larger instance nodes.
      For development or staging environments, deploy a cluster
      with ``M10`` or ``M20`` instance nodes. For production workloads,
      select ``M30`` or larger instance nodes.
---
title: Open Atlas Live Migration Service.
ref: open-live-migration-service
level: 4
stepnum: 2
content: |

  a. Navigate to your Atlas cluster. Click the ellipsis (:guilabel:`...`)
     button and select :guilabel:`Migrate Data to this Cluster`.

     .. figure:: /images/atlas-deployment.png
        :figwidth: 700px
        :alt: This image highlights the Migrate Data to this Cluster
              option on a cluster card in Atlas. 

  #. Click :guilabel:`General Live Migration`.
---
title: Click :guilabel:`I'm ready to migrate`.
ref: click-ready-migrate
level: 4
stepnum: 3
---
title: Add the IP address for the Atlas Live Migration Service on your AWS source cluster.
ref: whitelist-migration-service
level: 4
stepnum: 4
content: |

   At the top of the :guilabel:`Migrate Data to Cluster` modal, Atlas displays
   the IP address ranges that must be accessible from your source cluster.
   The address ranges displayed depend on the location of your target
   cluster and can change, so verify that you enter the address ranges
   as displayed in the modal.

   AWS EC2 servers are protected from unauthorized network access using
   `Security Groups <https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/security-group-rules-reference.html>`_.
   To add new IP address ranges to the IP access list, either create a 
   new Security Group, or modify your existing Security Group to permit 
   inbound network access from the displayed IP address ranges. 

   Here is an example security group that grants access to Atlas Live Migration Service.

   .. figure:: /images/aws-inbound-rules.png
      :figwidth: 760

   If you create a new Security Group, you must associate it with
   the EC2 instances running your source cluster. In the AWS EC2 console,
   click the :guilabel:`Actions` dropdown and select :guilabel:`Change
   Security Group`.

   .. figure:: /images/aws-change-security-group.gif
      :figwidth: 760

   For additional information on creating or modifying Security Groups, see `Adding Rules to a Security Group
   <https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-network-security.html#adding-security-group-rule>`_
   in the AWS EC2 documentation.
      
---
title: Validate your AWS credentials with Atlas Live Migration Service.
ref: validate-credentials
level: 4
stepnum: 5
content: |

   a. On the :guilabel:`Migrate Data to Cluster` modal, enter the hostname
      and port number of the primary node in your source AWS source cluster
      that Atlas will use to perform the data migration.

      .. note::
      
         The address must be resolvable over the public internet, so do not use
         the private IP address of the node.

   #. Enter the MongoDB username and password from the AWS source cluster
      in :guilabel:`Username/Password`.

   #. If TLS/SSL is enabled on the source cluster, toggle the :guilabel:`Is TLS/SSL enabled`
      to :guilabel:`Yes` and upload the CA file that your source AWS cluster
      uses.

   #. Click :guilabel:`Validate`.
---
title: Click :guilabel:`Start Migration`.
ref: start-migration
level: 4
stepnum: 6
content: |

   A countdown timer in a progress bar indicates how much time remains
   before your target cluster is ready to migrate data from your source
   cluster. Wait until the countdown timer and the :guilabel:`Prepare to Cutover`
   button are green before proceeding to the next step.

---
title: Click :guilabel:`Prepare to Cutover`.
ref: start-cutover
stepnum: 7
content: |

---
title: Perform the cutover.
ref: perform-the-cutover
stepnum: 8
content: |
  .. include:: /includes/live-migrate-cutover.rst
...
