---
level: 4
ref: deploy-adl-step1
source: 
  file: steps-adf-deploy-source.yaml
  ref: adf-log-in
---
level: 4
ref: deploy-adl-step2
source: 
  file: steps-adf-deploy-source.yaml
  ref: adf-left-nav
---
level: 4
ref: deploy-adl-step3
source: 
  file: steps-adf-deploy-source.yaml
  ref: configure-new-fdi
replacement:
  dfi-template: "Select :guilabel:`Manual Setup`."
---
level: 4
ref: deploy-adl-step4
source: 
  file: steps-adf-deploy-source.yaml
  ref: select-fdi-cp
replacement: 
  cloud-provider: "We recommend that you select the same cloud provider 
  as the cloud provider that is hosting your data. {+adl+} is currently
  only available in |aws| and you must use a {+fdi+} hosted in the same
  cloud as your {+dl+} dataset to query." 
---
level: 4
ref: deploy-adl-step5
source: 
  file: steps-adf-deploy-source.yaml
  ref: enter-fdi-name
---
level: 4
ref: deploy-adl-step6
source: 
  file: steps-adf-deploy-source.yaml
  ref: select-configure-method
---
title: "Specify your {+dl+} data store or online archive and configure virtual databases and virtual collections that map to your data store."
level: 4
ref: config-adl-data-store
content: | 

  .. tabs:: 

     .. tab:: Visual Editor 
        :tabid: visual

        a. Select one of the following from the :guilabel:`Data Sources`
           dropdown: 
           
           - :guilabel:`Atlas Data Lake` to configure a {+fdi+} for
             data in {+adl+} pipelines 
           - :guilabel:`Atlas Online Archive` to configure a {+fdi+} for
             archived data. 

           Corresponds to :datalakeconf-adl:`stores.[n].provider` 
           |json| configuration setting.

        #. (Optional) Click the :icon-fa4:`pencil` for the:

           - Database to edit the database name. Defaults to 
             ``VirtualDatabase[n]``. 

             Corresponds to :datalakeconf-adl:`databases.[n].name` 
             |json| configuration setting.
          
           - Collection to edit the collection name. Defaults to 
             ``VirtualCollection[n]``. 
       
             Corresponds to :datalakeconf-adl:`databases.[n].collections.[n].name` 
             |json| configuration setting.
     
           - View to edit the view name. 
            
           You can click: 
     
           - :guilabel:`Add Database` to add databases and 
             collections. 
           - :icon-fa4:`plus` associated with the database to 
             add collections to the database. 
           - :icon-fa4:`plus` associated with the collection to 
             add :manual:`views </core/views/>` on the 
             collection. To create a view, you must specify: 
       
             - The name of the view.
             - The :manual:`pipeline </core/aggregation-pipeline/>` 
               to apply to the view.

               .. note:: 

                  The view definition pipeline can't include the 
                  ``$out`` or the ``$merge`` stage. If the view 
                  definition includes nested pipeline stages such 
                  as ``$lookup`` or ``$facet``, this restriction 
                  applies to those nested pipelines as well.

               To learn more about views, see: 

               - :manual:`Views </core/views/>`
               - :manual:`db.createView </reference/method/db.createView/>`
               
             - :icon-fa4:`trash-o` associated with the database, 
               collection, or view to remove it.

        #. Drag and drop the :guilabel:`Data Lake Dataset` or
           :guilabel:`Atlas Online Archive` to map  
           with the collection.
             
           Corresponds to :datalakeconf-adl:`databases.[n].collections.[n].dataSources` 
           |json| configuration setting.

        #. Select the dropdown associated with the {+adl+} dataset to
           specify one of the following: 

           .. list-table:: 
              :widths: 15 85

              * - Wildcard collection 
                - If you select :guilabel:`*wildcard`, {+adf+} generates
                  collection names dynamically for the datasets in this
                  datasource.  
             
                  {+adf+} maps collections to only the dataset names
                  whose prefix match the following value:

                  .. code-block:: shell 
                     :copyable: false 

                     v1$atlas$snapshot${clusterName}${dbName}${collectionName}

                  Corresponds to
                  :datalakeconf-adl:`databases.[n].collections.[n].dataSources.[n].datasetPrefix` 
                  |json| configuration setting.

                  {+adf+} also trims up to ``5`` fields from the left of
                  the dataset name before mapping the remaining fields
                  to a wildcard collection name. 

                  Corresponds to
                  :datalakeconf-adl:`databases.[n].collections.[n].dataSources.[n].trimLevel` 
                  |json| configuration setting.

              * - Latest dataset 
                - If you select :guilabel:`latest`, {+adf+} maps only
                  the latest dataset (for the most recently captured
                  snapshot) to the collection. {+adf+} maps collections
                  to the following dataset name prefix:  

                  .. code-block:: shell 
                     :copyable: false 

                     v1$atlas$snapshot${clusterName}${dbName}${collectionName}

                  Corresponds to
                  :datalakeconf-adl:`databases.[n].collections.[n].dataSources.[n].datasetPrefix` 
                  |json| configuration setting.

     .. tab:: JSON Editor 
        :tabid: json

        Your configuration for {+adl+} dataset data store or online
        archive should look similar to the following:

        .. literalinclude:: /includes/data-federation/adl-config-format.json 
           :language: json
           :linenos:

        To learn more about these configuration settings, see
        :ref:`adf-configuration-file-adl`. 

        a. Define your dataset or online archive as a data store in
           your {+fdi+} storage configuration.

           Edit the |json| configuration settings shown in the UI 
           for ``stores``. Your ``stores`` cofiguration setting 
           should resemble the following:

           .. literalinclude:: /includes/data-federation/adl-stores-config-format.json 
              :language: json
              :linenos:

        #. Define virtual databases, collections, and views for 
           your dataset or online archive in your {+fdi+} storage
           configuration.

           .. literalinclude:: /includes/data-federation/adl-databases-config-format.json 
              :language: json
              :linenos:

---
title: "Repeat steps in the Visual Editor or |json| Editor tab above to
       define additional {+dl+} datasets." 
optional: true
level: 4
ref: additional-adl-data-stores 
content: | 
  To add other data stores for federated queries, see: 

  - :ref:`Create AWS Data Store From the UI <deploy-s3>` or
    :ref:`Create Azure Data Store From the UI <deploy-azure>`  
  - :ref:`Create HTTP or HTTPS Data Store From the
    UI <deploy-http-datastore>`
  - :ref:`Create Atlas Data Store From the UI <deploy-atlas-datastore>`

---

title: "Click :guilabel:`Save` to create the federated database      
       instance with virtual databases, collections, and views mapped 
       to your {+dl+} dataset or online archive."
ref: save-configuration-adl
stepnum: 9
inherit:
  file: steps-adf-deploy-source.yaml
  ref: save-configuration
...
