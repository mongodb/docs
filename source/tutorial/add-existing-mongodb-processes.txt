=======================================
Add Existing MongoDB Processes to |mms|
=======================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

|mms| provides a wizard for adding your existing MongoDB deployments to
monitoring and management. The wizard prompts you to install an
{+aagent+} if none exists, and then prompts you to identify the
:term:`cluster <sharded cluster>`, the :term:`replica set`, or the
:term:`standalone` to add. You can choose to add the deployment to
:ref:`Monitoring <monitoring-functional-overview>` or to both
:ref:`Monitoring <monitoring-functional-overview>` and
:ref:`Automation <automation>`.

Considerations
--------------

Unique Names
~~~~~~~~~~~~

Deployments must have unique names within the projects.

.. include:: /includes/important-unique-names-deployment-items.rst

MongoDB Configuration Options
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Automation does not support all MongoDB options. To review which
options are supported, see
:doc:`/reference/cluster-configuration-process-options`.

|tls|
~~~~~

If you enable |tls|, the |fqdn| for the host serving a MongoDB process
must match the :abbr:`SAN (Subject Alternative Name)` for the |tls|
certificate on that host.

.. caution::

   Though you can use one |tls| certificate with many
   :abbr:`SANs (Subject Alternative Names)` or a wildcard |tls|
   certificate on each host, you should not. You should follow
   :rfc:`RFC 2818, section 3.1 <2818#section-3.1>`: keep the scope of
   |tls| certificates as narrow as possible. This prevents
   man-in-the-middle attacks.

Preferred Hostnames
~~~~~~~~~~~~~~~~~~~

Set up a preferred hostname if you:

- Require a specific hostname, |fqdn|, |ipv4| address or |ipv6|
  address to access the MongoDB process, or
- Must specify the hostname to use for hosts with multiple aliases.

To learn more, see the :guilabel:`Preferred Hostnames` setting
in :ref:`group-settings-page`.

.. cond:: onprem

   .. include:: /includes/fact-restore-deleted-host.rst

Managing Windows MongoDB Services
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

If you are adding an existing MongoDB process that runs as a Windows
Service to Automation, Automation:

- Stops and disables the existing service
- Creates and starts a new service

Authentication
~~~~~~~~~~~~~~

If the |mms| project has MongoDB authentication settings enabled
for its deployments, the MongoDB deployment to import must support
the project's authentication mechanism.

When Adding a Deployment to Be Monitored but not Managed
````````````````````````````````````````````````````````

If your MongoDB deployment requires authentication, you must
:doc:`provide the necessary credentials </tutorial/edit-host-authentication-credentials/>`
for monitoring when adding the deployment to |mms|.

- If the deployment does not use Automation, but *did* use Backup,
  Monitoring, or both, you can find those credentials where the
  credentials were before updating to the {+mdbagent+}.

- If the deployment does not use Automation, but *will* use Backup,
  Monitoring, or both, you must add the credentials you granted
  those functions to |mms|:

  - For Monitoring:

    1. Navigate to :guilabel:`Deployment` :icon-fa5:`arrow-right`
       :guilabel:`<deployment>` :icon-fa5:`arrow-right`
       :icon-mms:`ellipsis` :icon-fa5:`arrow-right`
       :guilabel:`Monitoring Settings`.

    2. Click :guilabel:`Credentials`.

    3. Add the appropriate credentials:

       .. include:: /includes/tabs-monitoring-auth-settings.rst

  - For Backup:

    1. Navigate to :guilabel:`Backup` :icon-fa5:`arrow-right`
       :guilabel:`<backup-deployment>` :icon-fa5:`arrow-right`
       :icon-mms:`ellipsis` :icon-fa5:`arrow-right`
       :guilabel:`Edit Credentials`.

    2. Click :guilabel:`Credentials`.

    3. Add the appropriate credentials:

       .. include:: /includes/tabs-backup-auth-settings.rst

When Adding a Deployment to be Managed
``````````````````````````````````````

- If the deployment *uses* Automation, |mms| uses the credentials
  from the legacy Automation Agent. You can delete the credentials
  from the legacy Backup, and Monitoring Agents. The {+mdbagent+}
  uses those credentials for its Automation, Backup, and Monitoring
  functions.

- If the deployment *will* use Automation but did not prior to being
  imported, you need to:

  1. :manual:`Add the MongoDB Agent user </core/security-users/>`
     to your databases.

  2. Add the MongoDB Agent user to |mms|:

     a. Navigate to :guilabel:`Deployment` :icon-fa5:`arrow-right`
        :guilabel:`Security` :icon-fa5:`arrow-right`
        :guilabel:`Edit Settings` :icon-fa5:`arrow-right`
        :guilabel:`Edit Credentials`.

     .. cond:: cloud

        #. Continue through the modal until you see the
           :guilabel:`Configure Cloud Manager Agents` page

     .. cond:: onprem

        #. Continue through the modal until you see the
           :guilabel:`Configure Ops Manager Agents` page

     #. Add the appropriate credentials:

        .. include:: /includes/tabs-mongodbagent-auth-settings.rst

.. _automation-updated-security-settings:

Automation and Updated Security Settings Upon Import
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/fact-imported-users-to-automation.rst

.. _add-existing-mongodb-prerequisites:

Prerequisites
-------------

.. include:: /includes/prerequisite-for-adding-existing-deployment-to-automation.rst

.. important::

   .. include:: /includes/fact-import-sharded-cluster-to-automation-user-requirements.rst

.. _add-existing-mongodb-hosts:

Add MongoDB Processes
---------------------

.. include:: /includes/steps/add-existing-mongodb-processes.rst
