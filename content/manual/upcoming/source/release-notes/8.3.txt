.. _release-notes-8.3:

=============================
Release Notes for MongoDB 8.3
=============================

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: twocols

.. include:: /includes/in-dev.rst

General Changes
---------------

serverStatus Output
~~~~~~~~~~~~~~~~~~~

:dbcommand:`serverStatus` includes the following new fields in its output:

- ``aggregate.withExtension`` sub-field in ``metrics.commands.aggregate``, tracking success and failure counts
- :serverstatus:`shardingStatistics.databaseCriticalSectionStatistics`
- :serverstatus:`shardingStatistics.collectionCriticalSectionStatistics`
- :serverstatus:`shardingStatistics.databaseVersionUpdateCounters`
- :serverstatus:`metrics.extension`
- :serverstatus:`metrics.extension.totalAggStageExecMicros`
- :serverstatus:`metrics.extension.apiCallSuccesses`
- :serverstatus:`metrics.extension.apiCallFailures`
- :serverstatus:`metrics.extension.vectorSearch`
- :serverstatus:`metrics.extension.vectorSearch.legacyVectorSearchUsed`
- :serverstatus:`metrics.extension.vectorSearch.extensionVectorSearchUsed`
- :serverstatus:`metrics.extension.vectorSearch.onViewKickbackRetries`
- :serverstatus:`metrics.extension.vectorSearch.inSubpipelineKickbackRetries`

MongoDB 8.3 removes the ``service`` field in the :dbcommand:`serverStatus` output.

.. |serverstatus| replace:: :dbcommand:`serverStatus`
.. include:: /includes/fact-serverstatus-excl-fields-w-none.rst

For details, see :ref:`<serverstatus-excl-fields>`.

You can also optionally specify ``lockContentionMetrics: 1`` in the 
:dbcommand:`serverStatus` command to include :ref:`server-status-lockContentionMetrics`
in the output.

String Conversion Enhancements
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Starting in MongoDB 8.3, :expression:`$toString` can convert additional
BSON types to strings, including objects, arrays, regular expressions,
MaxKeys, MinKeys, and timestamps. For details, see
:expression:`$toString`.

cachePressureQueryPeriodMilliseconds Parameter
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

MongoDB 8.3 adds the ``cachePressureQueryPeriodMilliseconds`` parameter 
which sets the time interval MongoDB waits between checks for storage engine cache 
pressure. If the storage engine is under cache pressure, MongoDB aborts the oldest
transaction. For details, see :parameter:`cachePressureQueryPeriodMilliseconds`.

diagnosticDataCollectionDirectorySizeMB Parameter
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

MongoDB 8.3 increases the default value of 
:parameter:`diagnosticDataCollectionDirectorySizeMB` from ``200`` to ``500``
MiB. 

BSONObjectTooLarge Code for Upsert Errors
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Starting in 8.3, upsert operations that produce a :ref:`BSON object <bson-types>`
that is too large return the :error:`10334` ``BSONObjectTooLarge`` error code. 
In earlier versions, upsert operations that produce a BSON object that is too 
large return the ``17419`` or ``17420`` error codes.

checkBSONConformance Field
~~~~~~~~~~~~~~~~~~~~~~~~~~

Starting in 8.3, MongoDB no longer automatically enables the 
``checkBSONConformance`` field in the :method:`db.collection.validate()` method
when ``full`` is ``true``.

New Expression $subtype
~~~~~~~~~~~~~~~~~~~~~~~

MongoDB 8.3 introduces a new :expression:`$subtype` expression to extract the
subtype of binary data objects. 

Sharding
--------

findShardsOnConfigTimeoutMS Parameter
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

MongoDB 8.3 adds the ``findShardsOnConfigTimeoutMS`` parameter 
which sets the timeout in milliseconds for ``find`` operations 
against the ``config.shards`` namespace. For details, see 
:parameter:`findShardsOnConfigTimeoutMS`.

config.csrs.indexes Removed
~~~~~~~~~~~~~~~~~~~~~~~~~~~

MongoDB 8.3 removes the ``config.csrs.indexes`` namespace.

Time Series
~~~~~~~~~~~

Starting in MongoDB 8.3, creating an index with the name of ``"_id_"`` or
specifying a hint of ``"_id_"`` on time series collections returns an error. 

Starting in MongoDB 8.3, :dbcommand:`refineCollectionShardKey` for time-series 
collections only accepts shard keys specified using the collection's
logical meta and time fields. MongoDB no longer supports specifying keys using 
the underlying buckets format.

Geospatial Index Generation
~~~~~~~~~~~~~~~~~~~~~~~~~~~

Starting in MongoDB 8.3, if a document contains both GeoJSON and
legacy numeric coordinate fields, geospatial index generation prioritizes
GeoJSON coordinates.

If your documents contain legacy numeric coordinate values that 
precede GeoJSON coordinates and existing indexes rely on that behavior, 
you might need to rebuild your geospatial indexes.

This change may require you to rebuild geospatial indexes if your
documents contain legacy numeric coordinate values that precede
GeoJSON coordinates and existing indexes rely on that behavior.
Review geospatial queries to confirm they return expected results.

Logging
-------

Fields to Track Use of Memory by Queries
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Starting in MongoDB 8.3, you can use the following new fields to track
query memory use:

.. list-table::
   :header-rows: 1

   * - Field
     - Description

   * - ``inUseTrackedMemBytes``
     - Number of bytes of tracked memory in use by the current query
       operation.

   * - ``peakTrackedMemBytes``
     - Maximum number of bytes of tracked memory in use by the current
       query operation.

Both fields appear in the following places:

- :ref:`current-op-agg` output
- :method:`db.currentOp()` output
- :ref:`Database profiler <profiler>` output
- :ref:`Log messages <log-messages-ref>`
- :ref:`Slow query log messages <log-message-json-examples-slow-op>`

The ``peakTrackedMemBytes`` field also appears in the following places:

- :ref:`Explain results <explain-results>`
- :method:`PlanCache.list()` output
- :pipeline:`$planCacheStats` output

.. toctree::
   :titlesonly:
   :hidden:
   
   Compatibility Changes </release-notes/8.3-compatibility>
   Changelog </release-notes/8.3-changelog>
