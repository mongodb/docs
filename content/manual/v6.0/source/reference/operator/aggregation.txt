.. Remember to update /reference/aggregation-quick-reference.txt too.
    
   Quick Reference contains information on different expressions, such
   as field paths, and expression objects. Make appropriate edits.

.. _aggregation-pipeline-operators:

==============================
Aggregation Pipeline Operators
==============================

.. default-domain:: mongodb

.. meta::
   :description: Contains a list of aggregation operators to use in aggregation stages.

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

The aggregation pipeline operators are compatible with MongoDB Atlas and on-premise environments.

.. include:: /includes/extracts/operators-toc-explanation.rst

.. COMMENT - this page omits the sections on Expressions in general
   as well as Literals, Field Paths, and Expression Objects which
   are in the /reference/aggregation-quick-reference.txt.
   This page only focuses on operators.

Compatibility
-------------

.. |operator-method| replace:: the aggregation pipeline operators

.. include:: /includes/fact-compatibility.rst

.. _aggregation-expression-operators:

Expression Operators
--------------------

These expression operators are available to construct :ref:`expressions
<aggregation-expressions>` for use in the :doc:`aggregation pipeline
stages </reference/operator/aggregation-pipeline>`.

.. include:: /includes/intro-aggregation-operator-expressions.rst

Arithmetic Expression Operators
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/extracts/agg-operators-arithmetic.rst


Array Expression Operators
~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/extracts/agg-operators-array.rst

Boolean Expression Operators
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/extracts/agg-operators-boolean.rst

.. _aggregation-comparison-operators:

Comparison Expression Operators
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/extracts/agg-operators-comparison.rst

.. _aggregation-conditional-expression-operators:

Conditional Expression Operators
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/extracts/agg-operators-conditional.rst

Custom Aggregation Expression Operators
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/extracts/agg-operators-custom-aggregation.rst

Data Size Operators
~~~~~~~~~~~~~~~~~~~

.. include:: /includes/extracts/agg-operators-data-size.rst

Date Expression Operators
~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/extracts/agg-operators-date.rst

Literal Expression Operator
~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/extracts/agg-operators-literal.rst

Miscellaneous Operators
~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/extracts/agg-operators-miscellaneous.rst


Object Expression Operators
~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/extracts/agg-operators-objects.rst

Set Expression Operators
~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/extracts/agg-operators-set.rst

String Expression Operators
~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/extracts/agg-operators-string.rst

Text Expression Operator
~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/extracts/agg-operators-text.rst

Timestamp Expression Operators
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/extracts/agg-operators-timestamp.rst

Trigonometry Expression Operators
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/extracts/agg-operators-trigonometry.rst

Type Expression Operators
~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/extracts/agg-operators-type.rst

.. _agg-operators-group-accumulators:

Accumulators (``$group, $bucket, $bucketAuto, $setWindowFields``)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/intro-aggregation-accumulator.rst

.. include:: /includes/extracts/agg-operators-accumulators-group.rst

Accumulators (in Other Stages)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Some operators that are available as accumulators for the
:pipeline:`$group` stage are also available for use in other stages but
not as accumulators. When used in these other stages, these operators
do not maintain their state and can take as input either a single
argument or multiple arguments. For details, refer to the specific
operator page.

.. include:: /includes/extracts/agg-operators-accumulators-project.rst

Variable Expression Operators
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/extracts/agg-operators-variable-project.rst

Window Operators
~~~~~~~~~~~~~~~~

.. include:: /includes/extracts/agg-operators-window.rst

Alphabetical Listing of Expression Operators
--------------------------------------------

.. list-table::
   :widths: 30,70
   :header-rows: 1

   * - Name

     - Description

   * - :expression:`$abs`

     - Returns the absolute value of a number.

   * - :group:`$accumulator`

     - Returns the result of a user-defined accumulator function.

   * - :expression:`$acos`

     - Returns the inverse cosine (arc cosine) of a value in radians.

   * - :expression:`$acosh`

     - Returns the inverse hyperbolic cosine (hyperbolic arc cosine) of a value in radians.
   

   * - :expression:`$add`

     - Adds numbers to return the sum, or adds numbers and a date to return
       a new date. If adding numbers and a date, treats the numbers as
       milliseconds. Accepts any number of argument expressions, but at
       most, one expression can resolve to a date.
   

   * - :group:`$addToSet`

     - Returns an array of *unique* expression values for each group.
       Order of the array elements is undefined.
   
       .. versionchanged:: 5.0

          Available in :pipeline:`$setWindowFields` stage.
   

   * - :expression:`$allElementsTrue`

     - Returns ``true`` if *no* element of a set evaluates to ``false``,
       otherwise, returns ``false``. Accepts a single argument expression.
   

   * - :expression:`$and`

     - Returns ``true`` only when *all* its expressions evaluate to
       ``true``. Accepts any number of argument expressions.
   

   * - :expression:`$anyElementTrue`

     - Returns ``true`` if *any* elements of a set evaluate to ``true``;
       otherwise, returns ``false``. Accepts a single argument expression.
   

   * - :expression:`$arrayElemAt`

     - Returns the element at the specified array index.
   

   * - :expression:`$arrayToObject`

     - Converts an array of key value pairs to a document.
   

   * - :expression:`$asin`

     - Returns the inverse sine (arc sine) of a value in radians.
   

   * - :expression:`$asinh`

     - Returns the inverse hyperbolic sin (hyperbolic arc sine) of a value in radians.
   

   * - :expression:`$atan`

     - Returns the inverse tangent (arc tangent) of a value in radians.
   

   * - :expression:`$atan2`

     - Returns the inverse tangent (arc tangent) of ``y / x`` in radians,
       where ``y`` and ``x`` are the first and second values passed to the
       expression respectively.
   

   * - :expression:`$atanh`

     - Returns the inverse hyperbolic tangent (hyperbolic arc tangent) of a value in radians.
   

   * - :group:`$avg`

     - Returns an average of numerical values. Ignores non-numeric values.
   
       .. versionchanged:: 5.0

          Available in :pipeline:`$setWindowFields` stage.
   

   * - :expression:`$binarySize`

     - Returns the size of a given string or binary data value's content in
       bytes.
   
       .. versionadded:: 4.4

   * - :group:`$bottom`

     - Returns the bottom element within a group according to the specified 
       sort order.
   
       .. versionadded:: 5.2

       Available in :pipeline:`$group` and
       :pipeline:`$setWindowFields` stages.

   * - :group:`$bottomN`

     - Returns an aggregation of the bottom ``n`` fields within a group,
       according to the specified sort order.

       .. versionadded:: 5.2

       Available in :pipeline:`$group` and
       :pipeline:`$setWindowFields` stages.

   * - :expression:`$bsonSize`

     - Returns the size in bytes of a given document (i.e. bsontype
       ``Object``) when encoded as :term:`BSON`.

       .. versionadded:: 4.4
   

   * - :expression:`$ceil`

     - Returns the smallest integer greater than or equal to the specified number.
   

   * - :expression:`$cmp`

     - Returns: ``0`` if the two values are
       equivalent, ``1`` if the first value is greater than the
       second, and ``-1`` if the first value is less than the
       second.
   

   * - :expression:`$concat`

     - Concatenates any number of strings.
   

   * - :expression:`$concatArrays`

     - Concatenates arrays to return the concatenated array.
   

   * - :expression:`$cond`

     - A ternary operator that evaluates one expression, and depending on
       the result, returns the value of one of the other two expressions.
       Accepts either three expressions in an ordered list or three named
       parameters.
   

   * - :expression:`$convert`

     - Converts a value to a specified type.
   

   * - :expression:`$cos`

     - Returns the cosine of a value that is measured in radians.


   * - :expression:`$cosh`
  
     - Returns the hyperbolic cosine of a value that is measured in
       radians.
 

   * - :group:`$count`

     - Returns the number of documents in the group or window.
   
       .. versionadded:: 5.0

          Available in :pipeline:`$group` and
          :pipeline:`$setWindowFields` stages.

       Distinct from the :pipeline:`$count` pipeline stage.


   * - :group:`$covariancePop`

     - Returns the population covariance of two numeric
       :ref:`expressions <aggregation-expressions>`.

       .. versionadded:: 5.0

          Available in :pipeline:`$setWindowFields` stage.


   * - :group:`$covarianceSamp`

     - Returns the sample covariance of two numeric
       :ref:`expressions <aggregation-expressions>`.

       .. versionadded:: 5.0

          Available in :pipeline:`$setWindowFields` stage.

   * - :expression:`$dateAdd`

     - Adds a number of time units to a date object.

   * - :expression:`$dateDiff`

     - Returns the difference between two dates.

   * - :expression:`$dateFromParts`

     - Constructs a BSON Date object given the date's constituent
       parts.
   
   * - :expression:`$dateSubtract`

     - Subtracts a number of time units from a date object.

   * - :expression:`$dateTrunc`
      
     - Truncates a date.

   * - :expression:`$dateToParts`

     - Returns a document containing the constituent parts of a date.
   

   * - :expression:`$dateFromString`

     - Returns a date/time as a date object.
   

   * - :expression:`$dateToString`

     - Returns the date as a formatted string.
   

   * - :expression:`$dayOfMonth`

     - Returns the day of the month for a date as a number between 1 and 31.
   

   * - :expression:`$dayOfWeek`

     - Returns the day of the week for a date as a number between 1 (Sunday)
       and 7 (Saturday).
   

   * - :expression:`$dayOfYear`

     - Returns the day of the year for a date as a number between 1 and 366
       (leap year).
   

   * - :expression:`$degreesToRadians`

     - Converts a value from degrees to radians.
   

   * - :group:`$denseRank`

     - Returns the relative position of a sorted document. There are
       no gaps in the positions.
   
       .. versionadded:: 5.0

          Available in :pipeline:`$setWindowFields` stage.


   * - :group:`$derivative`

     - Returns the average rate of change within the specified
       :ref:`window <setWindowFields-window>`.
   
       .. versionadded:: 5.0

          Available in :pipeline:`$setWindowFields` stage.


   * - :expression:`$divide`

     - Returns the result of dividing the first number by the second. Accepts
       two argument expressions.
   

   * - :group:`$documentNumber`

     - Returns the position of a document (known as the document number)
       in the :ref:`partition <setWindowFields-partitionBy>`.

       .. versionadded:: 5.0

          Available in :pipeline:`$setWindowFields` stage.


   * - :expression:`$eq`

     - Returns ``true`` if the values are
       equivalent.
   

   * - :expression:`$exp`

     - Raises *e* to the specified exponent.


   * - :group:`$expMovingAvg`

     - Returns the exponential moving average for the numeric
       :ref:`expression <aggregation-expressions>`.

       .. versionadded:: 5.0

          Available in :pipeline:`$setWindowFields` stage.


   * - :expression:`$filter`

     - Selects a subset of the array to return an array with only the elements
       that match the filter condition.
   

   * - :group:`$first`

     - Returns a value from the first document for each group. Order is
       only defined if the documents are sorted.
   
       .. versionchanged:: 5.0

          Available in :pipeline:`$setWindowFields` stage.
   
       Distinct from the :expression:`$first` array operator.


   * - :expression:`$first`

     - Returns the first array element.
   
       .. versionadded:: 4.4
   
       Distinct from the :group:`$first` accumulator.

   * - :expression:`$firstN`
  
     - Returns a specified number of elements from the beginning of an 
       array.
       Distinct from the :group:`$firstN` accumulator.

       .. versionadded:: 5.2

   * - :group:`$firstN`

     - Returns an aggregation of the first ``n`` fields within a group.
       Only meaningful when documents are in a defined order.
       Distinct from the :expression:`$firstN` array operator.

       .. versionadded:: 5.2

       Available in :pipeline:`$group`, 
       :ref:`expression <aggregation-expressions>` and 
       :pipeline:`$setWindowFields` stages.

   * - :expression:`$floor`

     - Returns the largest integer less than or equal to the specified number.
   
   * - :expression:`$function`

     - Defines a custom aggregation function.

       .. versionadded:: 4.4

   * - :expression:`$getField`

     - Returns the value of a specified field from a document. 
       You can use :expression:`$getField` to retrieve the value of 
       fields with names that contain periods (``.``) or start 
       with dollar signs (``$``).

       .. versionadded: 5.0

   * - :expression:`$gt`

     - Returns ``true`` if the first value is
       greater than the second.
   

   * - :expression:`$gte`

     - Returns ``true`` if the first value is
       greater than or equal to the second.
   

   * - :expression:`$hour`

     - Returns the hour for a date as a number between 0 and 23.
   

   * - :expression:`$ifNull`

     - Returns either the non-null result of the first expression or the
       result of the second expression if the first expression results in a
       null result. Null result encompasses instances of undefined values or
       missing fields. Accepts two expressions as arguments. The result of
       the second expression can be null.
   

   * - :expression:`$in`

     - Returns a boolean indicating whether a specified value is in an array.
   

   * - :expression:`$indexOfArray`

     - Searches an array for an occurrence of a specified value and returns
       the array index of the first occurrence. If the substring is not found,
       returns ``-1``.
   

   * - :expression:`$indexOfBytes`

     - Searches a string for an occurrence of a substring and returns the
       UTF-8 byte index of the first occurrence. If the substring is not
       found, returns ``-1``.
   

   * - :expression:`$indexOfCP`

     - Searches a string for an occurrence of a substring and returns the
       UTF-8 code point index of the first occurrence. If the
       substring is not found, returns ``-1``.
   

   * - :group:`$integral`

     - Returns the approximation of the area under a curve.
   
       .. versionadded:: 5.0

          Available in :pipeline:`$setWindowFields` stage.


   * - :expression:`$isArray`

     - Determines if the operand is an array. Returns a boolean.
   

   * - :expression:`$isNumber`

     - Determines if the expression resolves to an integer, double, decimal,
       or long.
   

   * - :expression:`$isoDayOfWeek`

     - Returns the weekday number in ISO 8601 format, ranging from
       ``1`` (for Monday) to ``7`` (for Sunday).
   

   * - :expression:`$isoWeek`

     - Returns the week number in ISO 8601 format, ranging
       from ``1`` to ``53``. Week
       numbers start at ``1`` with the week (Monday through Sunday)
       that contains the year's first Thursday.
   

   * - :expression:`$isoWeekYear`

     - Returns the year number in ISO 8601 format. The year starts
       with the Monday of week 1 (ISO 8601) and ends with the Sunday of the
       last week (ISO 8601).
   

   * - :group:`$last`

     - Returns a value from the last document for each group. Order is
       only defined if the documents are sorted.
   
       .. versionchanged:: 5.0

          Available in :pipeline:`$setWindowFields` stage.
   
       Distinct from the :expression:`$last` array operator.
   

   * - :expression:`$last`

     - Returns the last array element.
      
       .. versionadded:: 4.4
   
       Distinct from the :group:`$last` accumulator.
       
   * - :expression:`$lastN`

     - Returns a specified number of elements from the end of an array.
       Distinct from the :group:`$lastN` accumulator.

       .. versionadded:: 5.2 

   * - :group:`$lastN`

     - Returns an aggregation of the last ``n`` fields within a group.
       Only meaningful when documents are in a defined order.
       Distinct from the :expression:`$lastN` array operator.

       .. versionadded:: 5.2

       Available in :pipeline:`$group`, 
       :ref:`expression <aggregation-expressions>` and 
       :pipeline:`$setWindowFields` stages.

   * - :expression:`$let`

     - Defines variables for use within the scope of a subexpression and
       returns the result of the subexpression. Accepts named parameters.
   
       Accepts any number of argument expressions.

   * - :group:`$linearFill`

     - .. include:: /includes/fact-linear-fill-description.rst

       .. versionadded:: 5.3

   * - :expression:`$literal`

     - Return a value without parsing. Use for values that the aggregation
       pipeline may interpret as an expression. For example, use a
       :expression:`$literal` expression to a string that starts with a
       ``$`` to avoid parsing as a field path.
   

   * - :expression:`$ln`

     - Calculates the natural log of a number.

   * - :group:`$locf`

     - .. include:: /includes/fact-locf-description.rst

       .. versionadded:: 5.2

   * - :expression:`$log`

     - Calculates the log of a number in the specified base.

   * - :expression:`$log10`

     - Calculates the log base 10 of a number.

   * - :expression:`$lt`

     - Returns ``true`` if the first value is less
       than the second.
   

   * - :expression:`$lte`

     - Returns ``true`` if the first value is less
       than or equal to the second.
   

   * - :expression:`$ltrim`

     - Removes whitespace or the specified characters from the beginning of a string.
   

   * - :expression:`$map`

     - Applies a subexpression to each element of an array and returns the
       array of resulting values in order. Accepts named parameters.
   

   * - :group:`$max`

     - Returns the highest expression value for each group.
   
       .. versionchanged:: 5.0

          Available in :pipeline:`$setWindowFields` stage.

   * - :expression:`$maxN`

     - Returns the ``n`` largest values in an array.
       Distinct from the :group:`$maxN` accumulator.

       .. versionadded:: 5.2
   
   * - :group:`$maxN`

     - Returns an aggregation of the ``n`` maximum valued elements in a
       group.
       Distinct from the :expression:`$maxN` array operator.
   
       .. versionadded:: 5.2

          Available in :pipeline:`$group`, 
          :pipeline:`$setWindowFields`
          and as an :ref:`expression <aggregation-expressions>`.

   * - :expression:`$mergeObjects`

     - Combines multiple documents into a single document.
   

   * - :expression:`$meta`

     - Access available per-document metadata related to the
       aggregation operation.
   

   * - :group:`$min`

     - Returns the lowest expression value for each group.
   
       .. versionchanged:: 5.0

          Available in :pipeline:`$setWindowFields` stage.

   * - :expression:`$minN`

     - Returns the ``n`` smallest values in an array.
       Distinct from the :group:`$minN` accumulator.

       .. versionadded:: 5.2

   * - :group:`$minN`

     - Returns an aggregation of the ``n`` minimum valued elements in a
       group.
       Distinct from the :expression:`$minN` array operator.
   
       .. versionadded:: 5.2

          Available in :pipeline:`$group`, 
          :pipeline:`$setWindowFields`
          and as an :ref:`expression <aggregation-expressions>`.

   * - :expression:`$millisecond`

     - Returns the milliseconds of a date as a number between 0
       and 999.
   

   * - :expression:`$minute`

     - Returns the minute for a date as a number between 0 and 59.
   

   * - :expression:`$mod`

     - Returns the remainder of the first number divided by the second.
       Accepts two argument expressions.
   

   * - :expression:`$month`

     - Returns the month for a date as a number between 1
       (January) and 12 (December).
   

   * - :expression:`$multiply`

     - Multiplies numbers to return the product. Accepts any number of
       argument expressions.
   

   * - :expression:`$ne`

     - Returns ``true`` if the values are *not*
       equivalent.
   

   * - :expression:`$not`

     - Returns the boolean value that is the opposite of its argument
       expression. Accepts a single argument expression.
   

   * - :expression:`$objectToArray`

     - Converts a document to an array of documents representing key-value pairs.
   

   * - :expression:`$or`

     - Returns ``true`` when *any* of its expressions evaluates to ``true``.
       Accepts any number of argument expressions.
   

   * - :expression:`$pow`

     - Raises a number to the specified exponent.


   * - :group:`$push`

     - Returns an array of expression values for documents in each
       group.
   
       .. versionchanged:: 5.0

          Available in :pipeline:`$setWindowFields` stage.
   

   * - :expression:`$radiansToDegrees`

     - Converts a value from radians to degrees.


   * - :expression:`$rand`

     - Returns a random float between 0 and 1.


   * - :expression:`$range`

     - Outputs an array containing a sequence of integers according to
       user-defined inputs.


   * - :group:`$rank`

     - Returns the document position (known as the rank) relative to
       other sorted documents.
   
       .. versionadded:: 5.0

          Available in :pipeline:`$setWindowFields` stage.


   * - :expression:`$reduce`

     - Applies an expression to each element in an array and combines them
       into a single value.
   

   * - :expression:`$regexFind`

     - Applies a regular expression (regex) to a string and returns
       information on the *first* matched substring.
   

   * - :expression:`$regexFindAll`

     - Applies a regular expression (regex) to a string and returns
       information on the all matched substrings.
   

   * - :expression:`$regexMatch`

     - Applies a regular expression (regex) to a string and returns
       a boolean that indicates if a match is found or not.
   

   * - :expression:`$replaceOne`

     - Replaces the first instance of a matched string in a given input.

       .. versionadded:: 4.4


   * - :expression:`$replaceAll`

     - Replaces all instances of a matched string in a given input.

       .. versionadded:: 4.4


   * - :expression:`$reverseArray`

     - Returns an array with the elements in reverse order.
   

   * - :expression:`$round`

     - Rounds a number to a whole integer *or* to a specified decimal place.
   

   * - :expression:`$rtrim`

     - Removes whitespace or the specified characters from the end of a string.


   * - :expression:`$sampleRate`

     - Randomly select documents at a given rate. Although the exact
       number of documents selected varies on each run, the quantity
       chosen approximates the sample rate expressed as a percentage
       of the total number of documents.


   * - :expression:`$second`

     - Returns the seconds for a date as a number between 0 and 60
       (leap seconds).
   

   * - :expression:`$setDifference`

     - Returns a set with elements that appear in the first set but not in
       the second set; i.e. performs a
       `relative complement <http://en.wikipedia.org/wiki/Complement_(set_theory)>`_
       of the second set relative to the first. Accepts exactly two
       argument expressions.
   

   * - :expression:`$setEquals`

     - Returns ``true`` if the input sets have the same distinct elements.
       Accepts two or more argument expressions.

   * - :expression:`$setField`

     - Adds, updates, or removes a specified field in a document. 
       You can use :expression:`$setField` to add, update,
       or remove fields with names that contain periods (``.``) or 
       start with dollar signs (``$``).

       .. versionadded:: 5.0
   
   * - :expression:`$setIntersection`

     - Returns a set with elements that appear in *all* of the input sets.
       Accepts any number of argument expressions.
   

   * - :expression:`$setIsSubset`

     - Returns ``true`` if all elements of the first set appear in the
       second set, including when the first set equals the second set; i.e.
       not a `strict subset <http://en.wikipedia.org/wiki/Subset>`_.
       Accepts exactly two argument expressions.
   

   * - :expression:`$setUnion`

     - Returns a set with elements that appear in *any* of the input sets.
   

   * - :group:`$shift`

     - Returns the value from an :ref:`expression
       <aggregation-expressions>` applied to a document in a specified
       position relative to the current document in the output.

       .. versionadded:: 5.0

          Available in :pipeline:`$setWindowFields` stage.


   * - :expression:`$size`

     - Returns the number of elements in the array. Accepts a single
       expression as argument.
   

   * - :expression:`$sin`

     - Returns the sine of a value that is measured in radians.
   
   * - :expression:`$sinh`
  
     - Returns the hyperbolic sine of a value that is measured in
       radians.

   * - :expression:`$slice`

     - Returns a subset of an array.
   
   * - :expression:`$sortArray`
     - Sorts an array based on its elements.

   * - :expression:`$split`

     - Splits a string into substrings based on a delimiter. Returns an
       array of substrings. If the delimiter is not found within the string,
       returns an array containing the original string.
   

   * - :expression:`$sqrt`

     - Calculates the square root.
   

   * - :group:`$stdDevPop`

     - Returns the population standard deviation of the input values.
   
       .. versionchanged:: 5.0

          Available in :pipeline:`$setWindowFields` stage.
   

   * - :group:`$stdDevSamp`

     - Returns the sample standard deviation of the input values.
   
       .. versionchanged:: 5.0

          Available in :pipeline:`$setWindowFields` stage.
   

   * - :expression:`$strcasecmp`

     - Performs case-insensitive string comparison and returns: ``0`` if two
       strings are equivalent, ``1`` if the first string is greater than the
       second, and ``-1`` if the first string is less than the second.
   

   * - :expression:`$strLenBytes`

     - Returns the number of UTF-8 encoded bytes in a string.
   

   * - :expression:`$strLenCP`

     - Returns the number of UTF-8 `code points
       <http://www.unicode.org/glossary/#code_point>`_ in a string.
   

   * - :expression:`$substr`

     - Deprecated. Use :expression:`$substrBytes` or :expression:`$substrCP`.
   

   * - :expression:`$substrBytes`

     - Returns the substring of a string. Starts with the
       character at the specified UTF-8 byte index (zero-based) in the string
       and continues for the specified number of bytes.
   

   * - :expression:`$substrCP`

     - Returns the substring of a string. Starts with the
       character at the specified UTF-8 `code point (CP)
       <http://www.unicode.org/glossary/#code_point>`_ index (zero-based)
       in the string and continues for the number of code points specified.
   

   * - :expression:`$subtract`

     - Returns the result of subtracting the second value from the first. If
       the two values are numbers, return the difference. If the two values
       are dates, return the difference in milliseconds. If the two values
       are a date and a number in milliseconds, return the resulting date.
       Accepts two argument expressions. If the two values are a date and a
       number, specify the date argument first as it is not meaningful to
       subtract a date from a number.
   

   * - :group:`$sum`

     - Returns a sum of numerical values. Ignores non-numeric values.
   
       .. versionchanged:: 5.0

          Available in :pipeline:`$setWindowFields` stage.
   

   * - :expression:`$switch`

     - Evaluates a series of case expressions. When it finds an expression
       which evaluates to ``true``, ``$switch`` executes a specified
       expression and breaks out of the control flow.
   

   * - :expression:`$tan`

     - Returns the tangent of a value that is measured in radians.


   * - :expression:`$tanh`
  
     - Returns the hyperbolic tangent of a value that is measured in
       radians.

   * - :expression:`$toBool`

     - Converts value to a boolean.
   

   * - :expression:`$toDate`

     - Converts value to a Date.
   

   * - :expression:`$toDecimal`

     - Converts value to a Decimal128.
   

   * - :expression:`$toDouble`

     - Converts value to a double.
   

   * - :expression:`$toInt`

     - Converts value to an integer.
   

   * - :expression:`$toLong`

     - Converts value to a long.
   

   * - :expression:`$toObjectId`

     - Converts value to an ObjectId.
   

   * - :group:`$top`

     - Returns the top element within a group according to the specified 
       sort order.
   
       .. versionadded:: 5.2

       Available in :pipeline:`$group` and
       :pipeline:`$setWindowFields` stages.

   * - :group:`$topN`

     - Returns an aggregation of the top ``n`` fields within a group,
       according to the specified sort order.
   
       .. versionadded:: 5.2

       Available in :pipeline:`$group` and
       :pipeline:`$setWindowFields` stages.

   * - :expression:`$toString`

     - Converts value to a string.
   

   * - :expression:`$toLower`

     - Converts a string to lowercase. Accepts a single argument expression.
   

   * - :expression:`$toUpper`

     - Converts a string to uppercase. Accepts a single argument expression.
   

   * - :expression:`$trim`

     - Removes whitespace or the specified characters from the
       beginning and end of a string.
   

   * - :expression:`$trunc`

     - Truncates a number to a whole integer *or* to a specified
       decimal place.
   

   * - :expression:`$tsIncrement`

     - .. include:: /includes/tsIncrement-introduction.rst

       .. versionadded:: 5.1


   * - :expression:`$tsSecond`

     - .. include:: /includes/tsSecond-introduction.rst

       .. versionadded:: 5.1


   * - :expression:`$type`

     - Return the BSON data type of the field.

   * - :expression:`$unsetField`

     - Removes a specified field from a document. An alias for 
       :expression:`$setField` to remove fields with names that contain
       periods (``.``) or that start with dollar signs (``$``).

       .. versionadded:: 5.0

   * - :expression:`$week`

     - Returns the week number for a date as a number between 0 (the
       partial week that precedes the first Sunday of the year) and 53
       (leap year).
   

   * - :expression:`$year`

     - Returns the year for a date as a number (e.g. 2014).
   

   * - :expression:`$zip`

     - Merge two arrays together.
   


.. toctree::
   :titlesonly: 
   :hidden: 

   $abs </reference/operator/aggregation/abs>
   $accumulator </reference/operator/aggregation/accumulator>
   $acos </reference/operator/aggregation/acos>
   $acosh </reference/operator/aggregation/acosh>
   $add </reference/operator/aggregation/add>
   $addToSet </reference/operator/aggregation/addToSet>
   $allElementsTrue </reference/operator/aggregation/allElementsTrue>
   $and </reference/operator/aggregation/and>
   $anyElementTrue </reference/operator/aggregation/anyElementTrue>
   $arrayElemAt </reference/operator/aggregation/arrayElemAt>
   $arrayToObject </reference/operator/aggregation/arrayToObject>
   $asin </reference/operator/aggregation/asin>
   $asinh </reference/operator/aggregation/asinh>
   $atan </reference/operator/aggregation/atan>
   $atan2 </reference/operator/aggregation/atan2>
   $atanh </reference/operator/aggregation/atanh>
   $avg </reference/operator/aggregation/avg>
   $binarySize </reference/operator/aggregation/binarySize>
   $bottom </reference/operator/aggregation/bottom>
   $bottomN </reference/operator/aggregation/bottomN>
   $bsonSize </reference/operator/aggregation/bsonSize>
   $ceil </reference/operator/aggregation/ceil>
   $cmp </reference/operator/aggregation/cmp>
   $concat </reference/operator/aggregation/concat>
   $concatArrays </reference/operator/aggregation/concatArrays>
   $cond </reference/operator/aggregation/cond>
   $convert </reference/operator/aggregation/convert>
   $cos </reference/operator/aggregation/cos>
   $cosh </reference/operator/aggregation/cosh>
   $count-accumulator </reference/operator/aggregation/count-accumulator>
   $covariancePop </reference/operator/aggregation/covariancePop>
   $covarianceSamp </reference/operator/aggregation/covarianceSamp>
   $dateAdd </reference/operator/aggregation/dateAdd>
   $dateDiff </reference/operator/aggregation/dateDiff>
   $dateFromParts </reference/operator/aggregation/dateFromParts>
   $dateFromString </reference/operator/aggregation/dateFromString>
   $dateSubtract </reference/operator/aggregation/dateSubtract>
   $dateToParts </reference/operator/aggregation/dateToParts>
   $dateToString <reference/operator/aggregation/dateToString>
   $dateTrunc </reference/operator/aggregation/dateTrunc>
   $dayOfMonth </reference/operator/aggregation/dayOfMonth>
   $dayOfWeek </reference/operator/aggregation/dayOfWeek>
   $dayOfYear </reference/operator/aggregation/dayOfYear>
   $degreesToRadians </reference/operator/aggregation/degreesToRadians>
   $denseRank </reference/operator/aggregation/denseRank>
   $derivative </reference/operator/aggregation/derivative>
   $divide </reference/operator/aggregation/divide>
   $documentNumber </reference/operator/aggregation/documentNumber>
   $eq </reference/operator/aggregation/eq>
   $exp </reference/operator/aggregation/exp>
   $expMovingAvg </reference/operator/aggregation/expMovingAvg>
   $filter </reference/operator/aggregation/filter>
   $first </reference/operator/aggregation/first>
   $firstN </reference/operator/aggregation/firstN>
   $first (array operator) </reference/operator/aggregation/first-array-element>
   $floor </reference/operator/aggregation/floor>
   $function </reference/operator/aggregation/function>
   $getField </reference/operator/aggregation/getField>
   $gt </reference/operator/aggregation/gt>
   $gte </reference/operator/aggregation/gte>
   $hour </reference/operator/aggregation/hour>
   $ifNull </reference/operator/aggregation/ifNull>
   $in </reference/operator/aggregation/in>
   $indexOfArray </reference/operator/aggregation/indexOfArray>
   $indexOfBytes </reference/operator/aggregation/indexOfBytes>
   $indexOfCP </reference/operator/aggregation/indexOfCP>
   $integral </reference/operator/aggregation/integral>
   $isArray </reference/operator/aggregation/isArray>
   $isNumber </reference/operator/aggregation/isNumber>
   $isoDayOfWeek </reference/operator/aggregation/isoDayOfWeek>
   $isoWeek </reference/operator/aggregation/isoWeek>
   $isoWeekYear </reference/operator/aggregation/isoWeekYear>
   $last </reference/operator/aggregation/last>
   $lastN </reference/operator/aggregation/lastN>
   $last (array operator) </reference/operator/aggregation/last-array-element>
   $let </reference/operator/aggregation/let>
   $linearFill </reference/operator/aggregation/linearFill>
   $literal </reference/operator/aggregation/literal>
   $ln </reference/operator/aggregation/ln>
   $locf </reference/operator/aggregation/locf>
   $log </reference/operator/aggregation/log>
   $log10 </reference/operator/aggregation/log10>
   $lt </reference/operator/aggregation/lt>
   $lte </reference/operator/aggregation/lte>
   $ltrim </reference/operator/aggregation/ltrim>
   $map </reference/operator/aggregation/map>
   $max </reference/operator/aggregation/max>
   $maxN </reference/operator/aggregation/maxN>
   $maxN-array-element </reference/operator/aggregation/maxN-array-element>
   $mergeObjects </reference/operator/aggregation/mergeObjects>
   $meta </reference/operator/aggregation/meta>
   $min </reference/operator/aggregation/min>
   $minN </reference/operator/aggregation/minN>
   $minN-array-element </reference/operator/aggregation/minN-array-element>
   $millisecond </reference/operator/aggregation/millisecond>
   $minute </reference/operator/aggregation/minute>
   $mod </reference/operator/aggregation/mod>
   $month </reference/operator/aggregation/month>
   $multiply </reference/operator/aggregation/multiply>
   $ne </reference/operator/aggregation/ne>
   $not </reference/operator/aggregation/not>
   $objectToArray </reference/operator/aggregation/objectToArray>
   $or </reference/operator/aggregation/or>
   $pow </reference/operator/aggregation/pow>
   $push </reference/operator/aggregation/push>
   $radiansToDegrees </reference/operator/aggregation/radiansToDegrees>
   $rand </reference/operator/aggregation/rand>
   $range </reference/operator/aggregation/range>
   $rank </reference/operator/aggregation/rank>
   $reduce </reference/operator/aggregation/reduce>
   $regexFind </reference/operator/aggregation/regexFind>
   $regexFindAll </reference/operator/aggregation/regexFindAll>
   $regexMatch </reference/operator/aggregation/regexMatch>
   $replaceOne </reference/operator/aggregation/replaceOne>
   $replaceAll </reference/operator/aggregation/replaceAll>
   $reverseArray </reference/operator/aggregation/reverseArray>
   $round </reference/operator/aggregation/round>
   $rtrim </reference/operator/aggregation/rtrim>
   $sampleRate </reference/operator/aggregation/sampleRate>
   $second </reference/operator/aggregation/second>
   $setDifference </reference/operator/aggregation/setDifference>
   $setEquals </reference/operator/aggregation/setEquals>
   $setField </reference/operator/aggregation/setField>
   $setIntersection </reference/operator/aggregation/setIntersection>
   $setIsSubset </reference/operator/aggregation/setIsSubset>
   $setUnion </reference/operator/aggregation/setUnion>
   $shift </reference/operator/aggregation/shift>
   $size </reference/operator/aggregation/size>
   $sin </reference/operator/aggregation/sin>
   $sinh </reference/operator/aggregation/sinh>
   $slice </reference/operator/aggregation/slice>
   $sortArray </reference/operator/aggregation/sortArray>
   $split </reference/operator/aggregation/split>
   $sqrt </reference/operator/aggregation/sqrt>
   $stdDevPop </reference/operator/aggregation/stdDevPop>
   $stdDevSamp </reference/operator/aggregation/stdDevSamp>
   $strcasecmp </reference/operator/aggregation/strcasecmp>
   $strLenBytes </reference/operator/aggregation/strLenBytes>
   $strLenCP </reference/operator/aggregation/strLenCP>
   $substr </reference/operator/aggregation/substr>
   $substrBytes </reference/operator/aggregation/substrBytes>
   $substrCP </reference/operator/aggregation/substrCP>
   $subtract </reference/operator/aggregation/subtract>
   $sum </reference/operator/aggregation/sum>
   $switch </reference/operator/aggregation/switch>
   $tan </reference/operator/aggregation/tan>
   $tanh </reference/operator/aggregation/tanh>
   $toBool </reference/operator/aggregation/toBool>
   $toDate </reference/operator/aggregation/toDate>
   $toDecimal </reference/operator/aggregation/toDecimal>
   $toDouble </reference/operator/aggregation/toDouble>
   $toInt </reference/operator/aggregation/toInt>
   $toLong </reference/operator/aggregation/toLong>
   $toObjectId </reference/operator/aggregation/toObjectId>
   $top </reference/operator/aggregation/top>
   $topN </reference/operator/aggregation/topN>
   $toString </reference/operator/aggregation/toString>
   $toLower </reference/operator/aggregation/toLower>
   $toUpper </reference/operator/aggregation/toUpper>
   $tsIncrement </reference/operator/aggregation/tsIncrement>
   $tsSecond </reference/operator/aggregation/tsSecond>
   $trim </reference/operator/aggregation/trim>
   $trunc </reference/operator/aggregation/trunc>
   $type </reference/operator/aggregation/type>
   $unsetField </reference/operator/aggregation/unsetField>
   $week </reference/operator/aggregation/week>
   $year </reference/operator/aggregation/year>
   $zip </reference/operator/aggregation/zip>

For the pipeline stages, see
:doc:`/reference/operator/aggregation-pipeline`.
