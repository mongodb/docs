=====================================
Configure Backup Agent for MONGODB-CR
=====================================

.. default-domain:: mongodb

If your MongoDB deployment enforces access control, the MMS Backup
Agent must authenticate to MongoDB as a user with the proper access.

To authenticate using ``MONGODB-CR``, create a user in the ``admin``
database with the appropriate roles in MongoDB.

Considerations
--------------

To authenticate to sharded clusters, create both shard-local users on
each shard, as well cluster-wide users:

- Create cluster users while connected to the :program:`mongos` these
  credentials persist to the config servers.

- Create shard-local users by connecting directly to the replica set
  for each shard.

.. only:: saas

   .. include:: /includes/fact-auth-backup-requirements.rst

Prerequisites
-------------

.. include:: /includes/prerequisites-create-user-for-agent.rst

MongoDB 2.6
-----------

2.6.4 and After
~~~~~~~~~~~~~~~

To backup MongoDB instances running 2.6.4 and later, create a user in
the ``admin`` database with an operation that resembles the following:

.. code-block:: javascript

   use admin
   db.createUser(
      {
        user: "<username>",
        pwd: "<password>",
        roles: [ { role: "backup", db: "admin" } ]
      }
   )

See :ref:`Access Control for MongoDB 2.6.4
<access-control-backup-2.6.4>` for more information on the
required access.

2.6.0 through 2.6.3
~~~~~~~~~~~~~~~~~~~

To backup MongoDB 2.6.0 through 2.6.3 instances, create a user in the
``admin`` database with an operation that resembles the following:

.. code-block:: javascript

   use admin
   db.createUser(
      {
        user: "<username>",
        pwd: "<password>",
        roles: [ 
           "clusterAdmin",
           "readAnyDatabase",
           "userAdminAnyDatabase",
           { role: "readWrite", db: "admin" },
           { role: "readWrite", db: "local" },
        ]
      }
   )

See :ref:`Access Control for MongoDB 2.6
<access-control-backup-2.6.3>` for more information on the
required access.

MongoDB 2.4
-----------

To backup MongoDB 2.4 instances, create a user in the ``admin``
database with an operation that resembles the following:

.. code-block:: javascript

   use admin
   db.addUser(
      {
        user: "<username>",
        pwd: "<password>",
        roles: [
           "clusterAdmin",
           "readAnyDatabase",
           "userAdminAnyDatabase"
        ],
        otherDBRoles: { 
           local: ['readWrite'],
           admin: ['readWrite']
        }
      }
   )

See :ref:`Access Control for MongoDB 2.4
<access-control-backup-2.4>` for more information on the
required access.

Host Settings
-------------

.. include:: /includes/fact-access-control-host-settings.rst
