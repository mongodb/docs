========================================
Seed a New Secondary from Backup Restore
========================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

Overview
--------

When a new secondary member is added to a replica set, MongoDB will
synchronize data to that new secondary as it would with any member of
the replica set. This can be very resource or time intensive if the
database is large.

As an alternative to the regular synchronization, the new secondary
member can first be "seeded" with data from an existing backup. This
limits performance impact to the new secondary and allows the active
MongoDB process to continue storing and retrieving data.

Prerequisites
-------------

To seed a secondary from a backup restore file, you must have:

- A backup restore file.

- The :file:`seedSecondary.sh` and :file:`seedSecondary.bat` scripts
  included in the backup restore file.

When you run the :file:`seedSecondary.sh` script on a Unix-based system or
:file:`seedSecondary.bat` script on a Windows-based system as part of this
tutorial, you must provide the replica set's oplog size in gigabytes. 

.. seealso::
   See **Check the Size of the Oplog** on 
   :manual:`Troubleshoot Replica Sets </tutorial/troubleshoot-replica-sets>` 
   if you do not have the size.

.. _seed-secondary-considerations:

Considerations
--------------

An |mms| backup stores all database files in a single directory.
If you run MongoDB with the ``directoryPerDb`` option, then after
restore you must redistribute the files to the different databases. |mms|
Backup does not provide restoration artifacts that use the
``directoryPerDb`` option.

.. important::
   The ``seedSecondary`` script is omitted from the restore files if you
   have:

   - Blacklisted databases or collections or 
   - The legacy sync cluster connection configuration servers for a sharded
     cluster

     Deployments using replica set configuration servers are unaffected.
  
   If you were to have received the script as part of the restore files, then
   tried to apply it, the secondary would become inconsistent with the other
   members.
     
.. seealso:: :manual:`Upgrade Config Servers to Replica Set </tutorial/upgrade-config-servers-to-replica-set/>`.

Seeding a new secondary from a backup restore requires an oplog window on the
current primary that spans back to the snapshot's timestamp.

Procedure
---------

.. include:: /includes/steps/backup-seed-new-secondary.rst
