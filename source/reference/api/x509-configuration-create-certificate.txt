======================================
Create an X.509 Certificate for a User
======================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

Create a new |service|-managed X.509 certificate for the specified 
database user.

.. important::
   If you are managing your own |certauth| (CA) in 
   :ref:`Self-Managed X.509 <self-managed-x509>` mode, you must 
   generate certificates for database users using your own CA.

.. include:: /includes/fact-projects-groups-synonyms.rst

Prerequisites
-------------

To generate an |service|-managed certificate for a database user, that 
user must have an ``x509Type`` set to ``MANAGED``.

Required Roles
--------------

You must have the :atlasrole:`Atlas admin` role to use this endpoint.

Resource
--------

.. include:: /includes/api-base-url.rst

.. code-block:: none

   POST /groups/{GROUP-ID}/databaseUsers/{USERNAME}/certs

Request
-------

Path Parameters
~~~~~~~~~~~~~~~

.. list-table::
   :header-rows: 1

   * - Name
     - Type
     - Necessity
     - Description

   * - ``GROUP-ID``
     - string
     - Required
     - Identifier for the |service| project associated with the X.509
       configuration.

   * - ``USERNAME``
     - string
     - Required
     - Username of the database user to create a certificate for.

Query Parameters
~~~~~~~~~~~~~~~~

.. include:: /includes/api/no-query-single-parameters.rst

Body Parameters
~~~~~~~~~~~~~~~

.. list-table::
   :header-rows: 1

   * - Name
     - Type
     - Description
     - Default

   * - ``monthsUntilExpiration``
     - number
     - A number of months that the created certificate is valid for 
       before expiry, up to 24 months.
     - 3

Response
--------

The response is a concatenated X.509 certificate and private key.

Example
-------

Request
~~~~~~~

The following example creates and returns an X.509 certificate.



.. code-block:: sh

   curl --request POST \
    --user "{publicApiKey}:{privateApiKey}" \
    --header "Content-Type: application/json" \
    --digest "https://cloud.mongodb.com/api/atlas/v1.0/groups/{groupId}/databaseUsers/{username}/certs?pretty=true" \
    --data '{"monthsUntilExpiration":12}'

Response
~~~~~~~~

The following partial example shows an X.509 certificate and private 
key returned:

.. code-block:: none
   :linenos:

   -----BEGIN CERTIFICATE-----
   MIIFCTCCAvGgAwIBAgIIbbbwIuB41jMwDQYJKoZIhvcNAQELBQAwSTEhMB8GA1UE
   ...
   RU6XlZVzscjSFPjuXfGcprc+cXH2bXQ4tfH3KFOPETdHfWtxe7F1nq4zPwgQ
   -----END CERTIFICATE-----
   -----BEGIN PRIVATE KEY-----
   MIIJQgIBADANBgkqhkiG9w0BAQEFAASCCSwwggkoAgEAAoICAQC8kbepjB1PB62e
   ...
   q0cjL/n1kRCfS5lJTsu7XkYDy6reEQ==
   -----END PRIVATE KEY-----
