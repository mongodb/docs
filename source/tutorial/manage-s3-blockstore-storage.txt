=====================================
Manage S3 Blockstore Snapshot Storage
=====================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. include:: /includes/fact-backup-snapshot-store-options.rst

This tutorial covers backing up your MongoDB databases as snapshots stored in
S3 and S3-compatible buckets. The metadata for :term:`S3 snapshot stores <S3
Snapshot Store>` is stored in a MongoDB database.

.. include:: /includes/note-add-capacity-using-multiple-stores.rst

Prerequisites
-------------

Metadata Storage Prerequisites
++++++++++++++++++++++++++++++

- :doc:`Deploy the dedicated MongoDB instance(s) 
  </tutorial/prepare-backing-mongodb-instances>` to serve the :term:`S3 snapshot 
  store <S3 Snapshot Store>` metadata and :term:`Oplog Store <Oplog Store
  Database>`. Serve these instances on the same hosts as the |onprem| server,
  the :term:`backing databases`, or snapshot stores. Attach storage volume(s)
  with enough capacity to store the databases these instances manage.

- Ensure the host serving the |onprem| :term:`Backup Daemon` service has
  enough capacity to store the :term:`head` database.

- Secure the instance that stores your :term:`S3 snapshot store 
  <S3 Snapshot Store>` metadata database using :ref:`authentication 
  <configure-auth-backing>` and :ref:`SSL <configure-ssl-backing>`. 
  S3 snapshot store metadata databases support 
  `all authentication mechanisms 
  <https://docs.mongodb.com/manual/reference/connection-string/#urioption.authMechanism>`_.

AWS S3 Storage Prerequisites
++++++++++++++++++++++++++++

1. Make sure you have an 
   `IAM user <https://docs.aws.amazon.com/IAM/latest/UserGuide/id_users_create.html>`_ 
   on :abbr:`AWS (Amazon Web Services)`.

#. Create your own 
   `AWS access keys <https://aws.amazon.com/developers/access-keys/>`_ for your 
   :abbr:`IAM (Identity and Access Management)` user. This allows you to create 
   :abbr:`S3 (Simple Storage Service)` buckets and store snapshot files in them. 
   MongoDB does not create or issue :abbr:`AWS (Amazon Web Services)` access keys.

#. Create your own `S3 bucket
   <http://docs.aws.amazon.com/AmazonS3/latest/dev/UsingBucket.html#create-bucket-intro>`_ 
   to store your :term:`S3 snapshot store <S3 Snapshot Store>` snapshots.

   .. note::
      The :abbr:`IAM (Identity and Access Management)` user for which you
      created the :abbr:`AWS (Amazon Web Services)` access keys must 
      `own <http://docs.aws.amazon.com/AmazonS3/latest/user-guide/set-bucket-permissions.html>`_ 
      the :abbr:`AWS (Amazon Web Services)` :abbr:`S3 (Simple Storage Service)` 
      Bucket.

IBM Cloud Object Storage Prerequisites
++++++++++++++++++++++++++++++++++++++

1. Create an Access Key and Secret Key using IBM credential tools.
#. Create your own S3-compatible bucket.

DellEMC Elastic Cloud Storage Prerequisites
+++++++++++++++++++++++++++++++++++++++++++

1. Create an Access Key and Secret Key from your `ECS User ID <https://www.emc.com/techpubs/ecs/ecs_s3_supported_features-1.htm#GUID-D21EE42B-CA1D-4425-A29D-386320CAD31A>`_.
#. Create your own S3-compatible bucket.

.. _add-s3-blockstore:

Add an S3 Blockstore
--------------------

.. include:: /includes/steps/admin-add-s3-blockstore.rst

.. _edit-s3-blockstore:

Edit an Existing S3 Blockstore
------------------------------

Once created, S3 snapshot stores are listed directly on the :guilabel:`Snapshot
Storage` page in a table. Each row contains the settings for each S3
blockstore.

.. include:: /includes/steps/admin-edit-s3-blockstore.rst

.. _delete-s3-blockstore:

Delete an S3 Blockstore
-----------------------

.. include:: /includes/steps/admin-delete-s3-blockstore.rst
