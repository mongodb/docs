==================================================================
Configure How the MongoDB Agent Manages Config Files and Passwords
==================================================================

.. default-domain:: mongodb

.. include:: /includes/styles/corrections.rst

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

.. versionadded:: 4.2

To meet advanced auditing or compliance needs, you may need to do one
or both of the following actions:

- Store the |mongod| or |mongos| (collectively, the MongoDB process)
  configuration in memory to avoid writing passwords to disk.
- Remove {+mdbagent+} passwords from the {+mdbagent+} configuration
  file and read the passwords passed in the shell command.

.. _mdbagent-config-inmem:

Store MongoDB Process Configuration Files in Memory
---------------------------------------------------

By default, the {+mdbagent+} writes MongoDB process configuration files
to disk on its host. These configuration files might contain the
following credentials:

- :setting:`net.tls.certificateKeyFilePassword`
- :setting:`net.tls.clusterPassword`
- :setting:`security.kmip.clientCertificatePassword`
- :setting:`security.ldap.bind.queryPassword`

You might not want to write these credentials to disk. To avoid writing
credentials to disk, you can choose to retain them in memory.

In your {+mdbagent+}
:ref:`configuration file <mongodb-agent-config-file-location>`, set
:setting:`enableLocalConfigurationServer` to ``true``. Changing this setting results in the following actions:

- The {+mdbagent+} caches your MongoDB process configuration in memory.
- The MongoDB configuration file on disk contains only a
  :configexpansion:`directive <__rest>` that points to the full
  configuration file.

When the {+mdbagent+} uses an in-memory MongoDB configuration,
the MongoDB process requests the full configuration file from its
local {+mdbagent+}. The Agent requests the configuration file using the |url| in the :configexpansion:`__rest`
expansion directive.

Considerations
~~~~~~~~~~~~~~

.. _ext-config-availability:

Impacts Availability of MongoDB Deployments
```````````````````````````````````````````

.. include:: /includes/consideration-external-config-impacts-availability.rst

Limits Importing Existing MongoDB Deployments
`````````````````````````````````````````````

You can't :doc:`import </tutorial/add-existing-mongodb-processes>`
MongoDB processes that store configuration files in memory. When the
{+mdbagent+} stores its configuration in memory, MongoDB
redacts any credentials after it starts. Therefore, MongoDB
can't retrieve the credentials needed to import the process.

.. _mdbagent-config-nopass:

Remove Passwords from the MongoDB Agent Configuration File
----------------------------------------------------------

You can set the {+mdbagent+} to read its passwords as shell command
flags rather than read from its configuration file. To use this
feature, add the following settings to the {+mdbagent+}\'s
configuration file:

.. cond:: onprem

   - :setting:`mmsApiKeyExec`
   - :setting:`tlsMMSServerClientCertificatePasswordExec`

.. cond:: cloud

   - :setting:`mmsApiKeyExec`
