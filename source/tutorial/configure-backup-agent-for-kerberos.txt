=======================================
Configure the Backup Agent for Kerberos
=======================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

:term:`MongoDB Enterprise` provides support for Kerberos. Kerberos is a
generic authentication protocol available starting from MongoDB
Enterprise version 2.6. The Backup Agent can authenticate to hosts using
Kerberos.

.. include:: /includes/extracts/note-manage-agent-auth-with-automation-kerberos.rst

Prerequisites
-------------

You must configure the Kerberos Key Distribution Center (KDC) to grant
tickets that are valid for at least four hours. The Backup Agent takes
care of periodically renewing the ticket. The KDC service provides session
tickets and temporary session keys to users and computers.

Procedures
----------

Create Kerberos Principal
~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/steps/kerberos-create-principal.rst

Create MongoDB User for the Principal
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/fact-kerberos-principal-as-user.rst

Use the following commands to create the users from a :program:`mongo`
shell connected to your MongoDB deployment:

MongoDB 3.0 or Later
````````````````````
.. code-block:: javascript

   use $external
   db.createUser(
      {
        user: "<Kerberos Principal>",
        roles: [
           { role: "backup", db: "admin" }
        ]
      }
   )

MongoDB 2.6
```````````

.. code-block:: javascript

   use $external
   db.createUser(
      {
        user: "<Kerberos Principal>",
        roles: [ 
           "clusterAdmin",
           "readAnyDatabase",
           "userAdminAnyDatabase",
           { role: "readWrite", db: "admin" },
           { role: "readWrite", db: "local" },
        ]
      }
   )

See :doc:`/reference/required-access-backup-agent` for more information on the required access.

If you are using the same Kerberos Principal for both the Monitoring and
Backup Agents, the user must possess the required roles for both the
backup agent, **and** the :doc:`monitoring
agent</reference/required-access-monitoring-agent>`.

Edit Agent Configuration File
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Edit the ``/etc/mongodb-mms/backup-agent.config`` file.

.. include:: /includes/steps/kerberos-agent-config-file.rst

Host Settings
~~~~~~~~~~~~~

.. include:: /includes/fact-access-control-host-settings.rst

Configure Kerberos Environment
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/steps/kerberos-configure-environment.rst
