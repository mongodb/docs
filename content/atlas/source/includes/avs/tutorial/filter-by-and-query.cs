using System.Reflection.Emit;
using MongoDB.Bson;
using MongoDB.Bson.Serialization.Attributes;
using MongoDB.Bson.Serialization.Conventions;
using MongoDB.Driver;
using MongoDB.Driver.Search;

public class vectorSearchFilterQuery 
{
  // define connection to your Atlas cluster
  private const string MongoConnectionString = "<CONNECTION-STRING>";

  public static void Main(string[] args){
    var camelCaseConvention = new ConventionPack { new CamelCaseElementNameConvention() };
    ConventionRegistry.Register("CamelCase", camelCaseConvention, type => true);

    // connect to your Atlas cluster
    var mongoClient = new MongoClient(MongoConnectionString);

    // define namespace
    var moviesDatabase = mongoClient.GetDatabase("sample_mflix");
    var moviesCollection = moviesDatabase.GetCollection<EmbeddedMovie>("embedded_movies");

    // define vector embeddings to search
    var vector = new[] {-0.019292723,-0.030946309,0.005839784,-0.04159953,-0.024749251,0.016928228,-0.02539884,-0.0073728086,-0.011361271,-0.02061788,0.024489418,0.00059843174,0.0026113384,-0.0029410035,0.012972246,-0.01266694,0.037805945,-0.020968657,0.016213683,-0.01843527,-0.01708413,0.00073159696,0.012335651,0.006275007,0.01401808,-0.02286545,0.0070934864,-0.018838013,0.016408559,-0.015083402,0.0006394369,0.001509477,-0.0053818254,-0.0039657266,-0.017201055,-0.024073683,-0.017019171,-0.0046542883,-0.0069895526,0.01269942,-0.010347916,0.025606707,-0.0123876175,-0.026100392,-0.012322659,-0.012718907,0.005560462,-0.018253386,-0.018162442,0.008762924,0.011088444,0.01507041,-0.009730808,-0.012673436,0.002483045,-0.01507041,0.00839266,0.018591171,0.011276824,-0.02728264,-0.0006560825,-0.028893614,-0.016317617,0.025022078,0.01109494,-0.0075676846,0.0021160285,-0.0018139707,-0.009055238,0.0016272146,0.019526575,0.01060775,0.011653584,0.012348643,0.015707005,-0.012465568,-0.007346825,0.0015346485,0.0077625606,0.0142909065,0.017175071,0.0031375035,0.008931817,0.009269602,0.01686327,0.009243619,-0.00015376935,0.039702736,0.010334924,-0.00477771,0.007314346,-0.002679545,-0.0034363135,0.031232126,-0.021085583,0.016005816,-0.01491451,-0.02165722,0.015317254,-0.017382938,0.019968294,-0.0050895116,-0.012627965,-0.010757155,-0.02150132,-0.018305352,0.0011221609,0.0009207891,0.0049563465,0.006041156,-0.0033518672,0.018799039,0.013433453,-0.03965077,0.011484692,-0.023268195,0.024190607,0.009503453,0.011971883,-0.032583266,0.016031798,0.011640593,0.019058872,-0.008918825,0.017343964,-0.0011189131,0.008074362,-0.031959664,0.015862906,-0.0034428092,0.019604526,-0.020942675,0.0031992143,-0.017512856,-0.028192062,0.020552922,-0.01950059,0.006492619,-0.035285547,-0.040352322,0.02863378,0.025658673,-0.016213683,-0.0006187313,-0.023242211,-0.0033323795,-0.008295221,0.001950384,0.005700123,-0.02360598,0.034428094,-0.010393387,0.011166395,0.004144363,0.0077690566,0.015940856,-0.0017717476,-0.004959594,-0.00081644923,-0.019461617,-0.006414668,0.0016150349,0.0020185905,-0.0071389573,0.027022805,0.023294177,-0.0031456235,-0.013537386,0.012524031,-0.017967567,0.008782412,0.0017603799,-0.016577452,0.004482148,-0.0004494328,0.030270739,0.017473882,0.021085583,-0.025723632,-0.023411103,0.030842375,0.02503507,0.01821441,0.014953485,0.0019552559,0.019851368,0.0031017764,-0.025814574,0.03208958,-0.013875172,-0.007002544,0.0051382305,-0.013537386,0.0031829746,-0.6751544,-0.013394477,-0.030244755,-0.014524758,0.008431635,0.00015387085,-0.009938676,0.018331336,-0.0010945535,0.004199578,-0.001654822,0.027672391,-0.0016678137,-0.013271055,-0.051005546,-0.01970846,-0.01229018,-0.02660707,0.016434543,0.012082312,-0.023346145,0.03793586,-0.017733715,0.0063691973,0.031959664,0.0026178344,0.009951668,-0.03468793,-0.018708097,0.0026941607,-0.0058202967,0.010179023,0.003501272,0.0076196515,0.061424915,-0.009341056,0.003262549,0.054305445,0.022852458,0.046068687,0.0123876175,-0.017512856,0.015278278,0.0051447265,0.0069700647,0.021033617,0.01588889,-0.015278278,0.011562643,0.001703541,0.011354775,-0.005014809,-0.00086476223,0.013940129,0.017110113,0.014628692,0.024619335,0.01244608,0.0077170897,0.0016491382,-0.021150542,0.009406015,-0.012738395,-0.006417916,-0.007652131,0.02982902,0.0025691153,0.012010857,0.009016263,-0.031154176,0.021943038,0.003066049,-0.00996466,-0.02189107,0.006859635,0.0127643775,0.038871266,0.00012534992,-0.011919916,0.008684974,-0.0018919212,-0.010679205,-0.021540293,0.0010815618,0.025022078,-0.014706642,-0.029725086,0.013667303,0.013329518,0.010601254,0.0012788738,0.0024603095,0.0022995367,0.016538477,-0.0036246935,0.028321978,0.015473154,0.004582834,0.024775235,-0.045445085,-0.0054857596,0.011322295,-0.005177206,0.014109022,-0.0068531395,0.0034947763,-0.0013543882,-0.0005074896,0.033700556,-0.030114837,0.0073598167,-0.017512856,-0.009691833,-0.0039592306,-0.00865899,-0.022839468,0.02652912,0.0062132967,0.010237486,-0.0026665532,0.016317617,-0.009243619,0.019344691,-0.010211502,0.006768693,0.00051479746,-0.0041183797,-0.022007996,-0.006625784,0.01348542,0.0034395615,-0.0104843285,0.009224131,-0.004043677,-0.006547834,0.0070869904,0.00583004,-0.01950059,0.016798312,-0.016980195,-0.013167121,-0.008814891,-0.0069051064,-0.004638049,-0.0033843466,-0.044171892,-0.009574908,-0.011757519,-0.00026957848,0.0021192764,-0.0026486896,0.002002351,-0.0077105938,0.0075611887,0.014563733,-0.01206932,-0.014459799,-0.017720724,-0.014173981,-0.024632327,0.026633054,0.008996775,-0.010744164,0.021254476,0.01282284,0.0029377558,0.02652912,0.015953848,-0.0071389573,-0.018682113,0.019019898,0.013706279,0.0034298175,0.0022183384,0.018721087,0.029283367,-0.0066355276,-0.000007352255,-0.0031277598,-0.008100346,-0.019045882,-0.005885255,-0.021904062,-0.009886709,0.007898974,0.014524758,0.01874707,0.033544656,-0.016148724,0.02270955,0.013167121,-0.0058722636,0.016837286,-0.021254476,-0.003108272,0.009548924,0.02225484,0.0041541066,0.012848824,0.049472522,0.039209053,0.015369221,0.022215864,0.0036409332,0.007470247,-0.010321932,0.009308577,-0.016655402,0.033778507,0.0074247755,0.0071389573,-0.0076716184,-0.012465568,-0.001217975,-0.0015265286,0.024788227,-0.017356956,0.026892887,-0.012485055,-0.009782775,-0.008996775,-0.014784592,0.0003020578,0.006226288,-0.0055344785,-0.0026519375,0.020734806,0.0003016518,0.004784206,-0.030036887,-0.010133552,0.014446807,-0.021540293,0.0058657676,0.017253023,-0.01903289,0.007249387,0.0060703875,0.007658627,-0.0011294688,-0.0041151317,0.02060489,0.02654211,-0.02225484,0.0081782965,-0.0003700614,0.02795821,0.0011481445,-0.012504543,0.027178707,-0.01851322,-0.00380333,0.0018643137,0.022995368,0.008535569,-0.025541747,0.005099255,0.002382359,-0.0010385267,0.021449352,0.008782412,0.0077105938,0.014940494,0.007866494,0.008931817,-0.020072227,-0.005950214,0.0142909065,-0.015005452,-0.007346825,0.016772328,-0.019734442,0.0057910653,0.008522577,0.008620015,0.0018724336,-0.00052494725,0.017214047,-0.0022686815,-0.012608477,-0.008132825,-0.045834836,0.017798675,0.010562279,-0.006278255,-0.013615336,-0.019370675,-0.019994278,-0.01950059,0.023800856,-0.009685338,0.011699056,-0.026373219,-0.0037188837,-0.02382684,-0.014251932,0.011354775,-0.020020261,0.003462297,-0.022137914,0.001950384,-0.028244028,-0.0031553672,-0.028425913,0.016395567,0.031465977,0.01401808,0.008243254,0.011854957,-0.009561916,0.0012325906,-0.004004702,0.0069116023,0.0028516855,-0.00779504,-0.0035662309,-0.032193515,-0.018980922,0.022540657,0.019955302,0.003800082,-0.025385847,-0.015499138,-0.0048816437,0.11879641,0.047004092,-0.00556371,-0.0073793046,-0.0014810576,-0.01986436,-0.01986436,-0.0031992143,0.009789271,-0.008775916,0.03118016,0.0069505773,-0.0006146714,0.031985648,0.02083874,-0.008080858,0.006021668,0.007918461,0.019201782,-0.036013085,-0.019916328,0.005765082,0.0042905197,0.0076196515,-0.007067503,-0.011335287,0.032791134,0.001556572,-0.011634097,-0.0040826523,-0.02728264,0.006677751,0.005492255,-0.02165722,-0.0038682886,-0.0044561643,-0.015239303,0.015174344,0.035025712,-0.0014493902,0.0059274784,-0.012595486,0.0073598167,0.011172891,0.00063618895,-0.02847788,0.011647088,0.034895796,-0.011374262,-0.012043336,0.034220226,0.008522577,-0.0042710323,-0.0067881807,-0.00018888763,-0.016291633,-0.0030611772,0.0027315118,-0.007112974,0.017811667,-0.019669484,-0.015226311,0.011543155,-0.011335287,0.012524031,-0.022241848,0.0006646084,-0.010049106,-0.008645998,-0.0081718005,-0.011250841,-0.008762924,-0.017980559,0.023268195,0.027516492,-0.0108545935,0.009561916,-0.02157927,-0.008074362,0.017408922,-0.021527302,-0.02764641,-0.011919916,-0.040430274,-0.018552195,0.001990983,-0.025541747,-0.025996458,-0.012517535,0.01041937,0.02382684,-0.008542065,0.026022442,-0.00034407794,0.0036506772,-0.007821023,0.024684293,0.024931137,0.024476426,0.01610975,0.039105117,-0.01978641,-0.0044139414,-0.005891751,-0.006339966,-0.004063165,-0.023047335,0.010334924,-0.008015899,0.040430274,0.008119834,-0.0064958665,0.010523304,0.0026519375,0.0060573956,0.02300836,0.0008034575,0.018331336,-0.0041703465,0.005550718,0.02600945,0.0025658673,0.015083402,0.024632327,-0.0035954623,-0.007398792,0.0062100487,-0.045367133,0.012913783,0.011406742,-0.01829236,0.019591535,-0.019175798,-0.0007157633,-0.019994278,-0.025502773,-0.011906924,-0.013979105,-0.0026210821,-0.033986375,-0.03333679,-0.017577816,0.005258404,0.0061808173,0.0030059624,-0.02135841,-0.0031943424,-0.02743854,-0.024554376,0.0063627013,-0.026243301,-0.0075546927,-0.017123105,-0.010146543,0.0018610657,-0.031881712,-0.022072954,-0.0069116023,0.009094213,0.02556773,0.027256656,0.012348643,0.02946525,-0.006489371,0.003304772,-0.005602685,0.022423731,0.0061191064,-0.029361317,0.021774145,0.02113755,-0.014070047,0.012101799,0.0038065778,-0.0060184207,0.012049832,0.012062824,0.0029637392,-0.006138594,-0.0062620156,-0.016369583,-0.0212155,-0.009672346,-0.03523358,-0.029127466,-0.0030092103,0.023307169,-0.0019341443,0.009263106,0.009509949,0.03531153,-0.0077755526,0.0068531395,-0.005417553,-0.00517071,-0.012686428,-0.014407832,-0.018474245,0.01507041,0.016304625,0.0034493052,0.011815981,-0.01596684,-0.0019552559,0.014563733,0.049134735,-0.003262549,0.0007173873,-0.0012796858,-0.0030563052,-0.01166008,-0.010068594,-0.012088808,-0.03411629,0.021852095,0.0056806356,0.012426593,0.0032999003,-0.03411629,-0.015758973,0.0062132967,0.0061743213,0.028919598,0.0066485195,0.036324885,0.0146806585,-0.0180715,-0.0101010725,0.027022805,-0.002284921,0.00165807,0.02525593,-0.00906823,-0.00052251125,-0.0022508178,-0.011120924,0.00057326024,-0.043054603,-0.011952395,0.03232343,-0.011354775,0.010919552,-0.016382575,-0.013316527,-0.012998229,0.026282277,-0.014186973,0.038091764,0.0016467022,-0.036298905,-0.018110476,0.00020827372,-0.002098165,0.0020234624,-0.002335264,-0.025957484,0.028321978,-0.028945582,0.00057326024,-0.006330222,-0.021085583,0.027204689,-0.009997139,-0.0025577475,0.007697602,-0.00828223,-0.010380395,-0.03050459,0.011582131,0.019968294,-0.02300836,0.0040274374,-0.010991006,0.009483965,0.000020566014,0.018266376,-0.0135114025,-0.0209037,0.0077235852,-0.0018204666,-0.0044951397,0.003314516,-0.006479627,-0.0075222137,-0.025372855,-0.00049896375,-0.020513946,-0.0060541476,0.012186246,-0.013381485,-0.020033253,-0.020176161,0.0014055432,0.017291997,-0.0030092103,0.005748842,0.012601981,0.02623031,-0.029673118,0.00928909,-0.010815618,0.0355194,-0.014836559,0.005654652,0.011510676,0.0005298191,0.02795821,-0.028685747,0.013180113,0.0066030486,-0.012244709,-0.02196902,0.010529799,-0.007957437,0.00036803144,0.021644227,-0.0033875944,-0.007587172,-0.010406379,0.026451169,-0.008723949,0.014199965,0.00928909,-0.012309668,0.0026681772,-0.031128192,0.00035300976,-0.01150418,-0.024905153,-0.00062522717,-0.0061775693,0.022579633,-0.014927502,-0.005164214,-0.016122742,-0.026840921,-0.014381849,0.008860362,-0.01664241,-0.015382213,0.01882502,0.03042664,0.018227402,0.012088808,0.008288726,-0.005303875,0.009535932,-0.02300836,-0.009834742,-0.005027801,-0.020513946,0.011263832,-0.0003122076,0.0010474585,-0.018773055,-0.0018123467,-0.027542474,0.006466635,-0.032921053,0.023930773,0.059450172,-0.008061371,-0.00836018,0.007314346,0.000028571663,0.020890707,0.012498047,0.020578906,0.021371402,-0.038871266,-0.0021387641,0.014589717,-0.021007633,-0.00008287305,-0.00016128019,0.00944499,-0.0074962303,0.012595486,-0.0004494328,0.012731899,-0.006723222,-0.005407809,0.019227766,-0.0062555196,-0.021605253,-0.042690836,0.0030027144,0.0031829746,0.011906924,-0.020799765,-0.0046218093,0.0045536025,0.0017392683,-0.008327701,-0.0009386527,-0.010185519,0.005365586,-0.0067167263,0.0112313535,-0.0040176935,0.0059729493,0.020851731,0.025658673,-0.0053363545,-0.0047907014,0.00321383,-0.007697602,-0.011192379,0.0011911795,-0.024645317,0.031673845,0.0046153134,0.0066420236,0.0045990734,0.009730808,-0.017694741,0.0039202557,-0.01348542,0.009107205,0.022618609,-0.017473882,0.005310371,-0.008366676,-0.011322295,0.0029880987,-0.014940494,-0.009685338,-0.021800129,-0.018734079,-0.017954575,-0.009457982,-0.01992932,0.0041118837,-0.032271467,-0.024008723,0.027776325,0.2096346,-0.010289453,-0.0006889679,0.016850278,-0.0029491235,0.026425185,0.019630508,0.0146157,0.002918268,0.0135114025,0.014784592,-0.0009954915,-0.001705165,-0.0024408218,-0.012712411,-0.00850309,-0.0026178344,-0.017058145,-0.014005088,-0.016746344,0.004443173,0.022046972,-0.01423894,-0.02181312,0.016707368,-0.01843527,0.013381485,0.004199578,0.012900791,0.012504543,-0.008041883,-0.026711004,0.0021225244,-0.012653948,-0.022839468,0.0042288094,-0.009542428,-0.009828246,0.008314709,0.0022670575,0.008106842,0.01768175,-0.013355502,-0.016239667,0.0108545935,-0.016850278,-0.023735898,0.025775598,0.0064081727,0.008132825,-0.029647136,-0.015356229,-0.0009451486,0.03154393,-0.0053266105,-0.00077260216,0.020202145,0.00917866,-0.021943038,-0.009730808,-0.004186586,0.024944128,-0.0067037344,-0.011984874,-0.01874707,0.055500686,-0.028451895,0.007749569,0.024983102,-0.0027509995,-0.006021668,-0.011315799,-0.021709187,-0.010815618,-0.006352958,-0.018851005,0.031569913,-0.003939743,0.025450805,0.005505247,-0.0022589376,-0.011270328,0.0037188837,0.014381849,0.00010159941,-0.018123468,0.011322295,0.015525121,-0.006671255,-0.00092809694,0.007216908,-0.024125649,-0.01656446,-0.014628692,0.00809385,0.023138277,0.010529799,0.04630254,-0.023995731,-0.007976924,-0.028321978,0.0027639912,0.00035300976,-0.026918871,-0.016070774,0.0038423052,-0.0065056104,0.023112293,0.012530527,-0.012264196,0.008788908,-0.006219792,0.008444627,-0.012082312,-0.0069895526,0.015512129,-0.0051349825,-0.010237486,0.008080858,-0.025216954,-0.013992097,-0.021267468,0.014589717,0.004728991,0.013992097,-0.015732989,0.0017376443,-0.004241801,-0.009159172,-0.029855004,0.015681023,0.0009605763,0.018396294,-0.008620015,-0.018526211,0.020786773,0.015005452,-0.0029848507,0.0055377265,-0.009490461,0.017188063,-0.013251568,-0.004725743,-0.0011619482,-0.003413578,-0.019578543,0.00074377673,-0.0026097144,-0.018526211,-0.0042093215,-0.004566594,-0.031206144,-0.019227766,-0.028270012,0.010633734,-0.01582393,-0.0072948583,-0.019357683,-0.005959958,0.014147998,-0.0069116023,0.0179156,0.025983466,-0.018734079,-0.008529073,-0.0042223134,-0.16598238,0.023450078,0.020072227,-0.012127783,0.026996821,-0.0044659083,0.033596624,0.015382213,-0.020059235,-0.006957073,-0.004131371,-0.007704098,-0.045912787,-0.025619699,-0.011608114,0.011075453,-0.0131346425,0.010822114,0.0061028665,-0.0028663012,0.03058254,-0.0022199624,0.00070926745,0.0067816847,0.00966585,-0.01761679,-0.0013405845,0.016343601,-0.011549651,-0.005550718,-0.01664241,0.009094213,0.031595897,0.03380449,0.017499864,0.014303898,-0.019799402,0.008990279,-0.0068531395,-0.0058105527,0.0003647835,0.021007633,0.028685747,-0.01940965,0.015758973,0.03312892,0.014888526,-0.015187336,0.0031553672,0.0062132967,0.00081523124,-0.046042703,0.012355139,0.0023157764,0.021683203,0.0355194,0.001603667,-0.0056124288,0.008009404,-0.011588627,-0.02390479,-0.0014908013,0.010029618,-0.024528392,-0.024229582,-0.028659763,0.009315073,-0.00030835066,-0.025242938,0.015460162,-0.025100028,-0.0068531395,-0.007548197,-0.012705916,0.010737668,0.00065486453,-0.01491451,0.0053460984,-0.0032479332,0.010685701,-0.0004721683,0.047108024,0.00048475404,-0.0123941135,0.032063596,-0.00048434807,-0.018630145,-0.024294542,-0.009672346,-0.017291997,0.014784592,-0.017123105,0.017045153,0.0065088584,0.0077170897,0.01326456,0.013011221,0.0034298175,0.019526575,-0.013602344,-0.021995004,0.010685701,0.005882007,0.0023807352,0.009250114,0.03793586,0.02225484,0.009100709,0.020410012,-0.0012902415,0.008483602,-0.008314709,0.0052876356,0.025502773,-0.0048166853,0.023021352,0.005014809,-0.012355139,0.020773781,-0.0037578589,0.051837016,-0.0017798675,-0.036298905,0.010549287,-0.017655766,-0.0077625606,-0.09198147,-0.01128332,0.008119834,-0.006729718,-0.006677751,0.012991733,-0.010783139,-0.0034363135,-0.0050505362,0.01348542,-0.012835832,-0.019162806,-0.0050050654,0.00017112549,0.038949218,0.0050960076,0.008912329,-0.0072298995,-0.0052356687,0.015875898,-0.02946525,0.027204689,0.0016296506,-0.013940129,-0.002387231,0.0017652517,-0.03125811,0.03344072,-0.0009345928,-0.010211502,-0.0008980536,0.011250841,-0.0012829336,-0.013979105,0.012621469,-0.005566958,-0.017902609,-0.012452576,0.022267831,-0.030634508,-0.0077755526,0.002919892,0.01431689,-0.0072234035,0.0012926775,-0.010003635,-0.0024570615,0.02024112,0.011101436,-0.008607023,-0.01994231,0.003800082,-0.030972293,-0.027178707,0.019201782,0.031569913,-0.015161353,-0.013498411,-0.0022232104,-0.014810576,-0.0023303921,-0.023554012,-0.010646725,0.024190607,0.010900064,-0.002192355,-0.0074377675,0.0016937972,0.011744527,0.0019520079,-0.0076716184,0.025801582,-0.020968657,-0.001605291,-0.019344691,-0.0068921144,-0.021202508,0.00055742654,0.03793586,-0.011478197,-0.010724676,-0.019006906,-0.00865899,-0.020215137,0.00004577556,0.018954938,0.0022248344,0.034661945,-0.012465568,-0.021566277,-0.0053883214,0.0017408923,-0.009393023,-0.0053363545,0.01469365,0.012783865,-0.0022264584,0.012199238,-0.01940965,0.013173617,-0.025749616,-0.007665123,-0.085849375,0.011517172,-0.0021566278,0.001750636,0.0093280645,-0.0075157178,-0.0046055694,-0.008509586,-0.0038293134,0.010997502,-0.03440211,0.020137187,0.019695468,-0.0039202557,-0.0006053336,-0.01559008,0.009633371,-0.010939039,0.009600891,0.011906924,-0.0076131555,0.008399156,0.010334924,-0.0058625196,0.009191651,0.0025967227,-0.013121651,0.040820025,-0.012355139,-0.008483602,0.0022979127,-0.014472791,-0.009269602,0.002874421,-0.0033908424,-0.026334243,-0.024450442,-0.00389752,0.031465977,0.015174344,0.007203916,0.0019649996,0.0007985856,-0.0069960486,-0.013706279,0.007112974,-0.0006183253,0.0006654203,0.026944855,-0.005823544,0.014173981,0.015226311,-0.0146546755,-0.0039072637,-0.009191651,0.014368857,0.01881203,-0.0016937972,0.019747434,-0.015122377,0.014225948,-0.00036336255,0.006723222,-0.01582393,0.0031375035,-0.015564096,-0.009659354,-0.002674673,0.030296722,-0.01694122,0.005602685,-0.007730081,0.0033453712,0.01315413,-0.011705551,-0.00073200295,0.020565914,-0.012296676,-0.0065803127,0.011452213,-0.007834015,-0.019370675,-0.016837286,-0.0013901155,0.030764425,0.031362046,-0.012900791,0.01566803,0.0023482558,0.021046609,0.020955665,0.0067751887,0.011867949,-0.006684247,-0.016746344,0.011725039,-0.029699102,-0.0043489826,0.012166758,0.034765877,-0.016408559,0.0072948583,-0.018838013,-0.03754611,-0.013784229,0.024086673,-0.0050700237,-0.031881712,0.012543518,0.016694378,0.026165351,-0.0045081316,-0.022228856,0.013758246,-0.0089707915,0.002489541,-0.0043457346,-0.027594442,-0.018708097,0.03762406,0.0065673213,0.0108480975,0.033466704,-0.017824657,0.026866905,0.0112248575,0.028685747,-0.016317617,-0.018708097,-0.003368107,-0.009360543,0.022631599,-0.019305715,-0.0024473178,-0.016798312,0.017525848,-0.014576725,0.04326247,-0.040742077,0.040949944,0.0033226358,0.0071389573,-0.000924849,-0.03357064,-0.031569913,0.00024988787,0.019214774,-0.025749616,-0.0041118837,0.028607797,-0.0032528052,0.0056741396,-0.0010417746,-0.011569139,0.013024213,-0.0044074454,0.019552559,-0.0042775283,-0.0030904086,0.0076261475,0.024320524,0.012959254,0.0048556603,0.0042710323,-0.011523668,0.019175798,-0.019877352,-0.022956394,-0.03765004,-0.023333153,0.0010807498,-0.005953462,-0.010822114,0.007801536,-0.024268558,-0.009581403,-0.027048789,-0.0046672802,0.0059664533,-0.03305097,0.025593715,-0.008301717,-0.042508952,0.004186586,0.013706279,-0.01401808,0.0018334583,0.008236759};

    // define options 
    var options = new VectorSearchOptions<EmbeddedMovie>() {
        Filter = Builders<EmbeddedMovie>.Filter.And(
          Builders<EmbeddedMovie>.Filter.Nin("genres", new[] {"Drama", "Western", "Crime"}),
          Builders<EmbeddedMovie>.Filter.In("genres", new[] {"Action", "Adventure", "Family"}),
          Builders<EmbeddedMovie>.Filter.Gt("year", 1960),
          Builders<EmbeddedMovie>.Filter.Lt("year", 2000)          
        ),
        IndexName = "default",
        NumberOfCandidates = 200
    };

    // run query
    var results = moviesCollection.Aggregate()
                .VectorSearch(m => m.Embedding, vector, 10, options)
                .Project(Builders<EmbeddedMovie>.Projection
                  .Include(m => m.Title)
                  .Include(m => m.Plot)
                  .Include(m => m.Year)
                  .Include(m => m.Genres)
                  .Exclude(m => m.Id))
                .ToList();

    // print results
    foreach (var movie in results)
      {
        Console.WriteLine(movie.ToJson());
      }
  }
}

[BsonIgnoreExtraElements]
public class EmbeddedMovie
{
    [BsonIgnoreIfDefault]
    public ObjectId Id { get; set; }
    public string Title { get; set; }
    public string Plot { get; set; }
    public int Year { get; set; }
    [BsonElement("genres")]
    public string[] Genres { get; set; } 
    [BsonElement("plot_embedding")]
    public double[] Embedding { get; set; }
}