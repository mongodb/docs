.. _connect-from-outside-k8s:

==============================================================
Connect to a MongoDB Database Resource from Outside Kubernetes
==============================================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

The following procedure describes how to connect to a MongoDB resource
deployed by |k8s| from outside of the |k8s| cluster, including how to
control port mapping.

Prerequisite
------------

Compatible MongoDB Versions
~~~~~~~~~~~~~~~~~~~~~~~~~~~

For your databases to be accessed outside of |k8s|, they must run
MongoDB 4.2.3 or later.

Procedure
---------

How you connect to a MongoDB resource that the |k8s-op-short| deployed
from outside of the |k8s| cluster depends on the resource.

.. tabs-deployments::

   .. tab::
      :tabid: standalone

      This procedure uses the following example:

      .. literalinclude:: /includes/code-examples/yaml-files/example-standalone.yaml
         :language: yaml
         :start-after: START-standalone-exposed-full
         :end-before: END-standalone-exposed-full
         :linenos:
         :lineno-start: 20
         :emphasize-lines: 15

      To connect to your |k8s-op-short|-deployed MongoDB 
      standalone resource from outside of the |k8s| cluster:

      .. include:: /includes/steps/enable-external-standalone.rst

   .. tab::
      :tabid: repl

      .. tabs::

         .. tab:: Kubernetes
            :tabid: kubernetes

            .. important::

               This procedure explains the least complicated way to 
               enable external connectivity. Other utilities can be 
               used in production.

            To connect to your |k8s-op-short|-deployed MongoDB replica 
            set resource from outside of the |k8s| cluster:

            .. include:: /includes/steps/enable-split-horizon.rst
         
         .. tab:: OpenShift
            :tabid: openshift

            To connect to your |k8s-op-short|-deployed MongoDB replica 
            set resource from outside of the |k8s| cluster with OpenShift:

            .. include:: /includes/steps/enable-split-horizon-openshift.rst

   .. tab::
      :tabid: shard

      For this procedure, you must deploy a |tls|\-enabled sharded MongoDB
      cluster in the |k8s-op-short|.
      Provide the external |dns| names (|san-dns|\s) for each member of
      the MongoDB sharded cluster.

      The |san-dns| for each MongoDB hosts corresponds to:

      .. code-block:: sh
         :copyable: false

         <mdb-resource-name><shard><pod-index>.<external-domain>
         <mdb-resource-name><config><pod-index>.<external-domain>
         <mdb-resource-name><mongos><pod-index>.<external-domain>

         Each |tls| certificate requires the |fqdn| (|san-dns|) that
         corresponds to the |fqdn| that this host has outside the
         sharded cluster deployed with the |k8s-op-short|.

         .. literalinclude:: /includes/code-examples/yaml-files/example-sharded-cluster.yaml
            :language: yaml
            :start-after: START-exposed-sharded-tls-full
            :end-before: END-exposed-sharded-tls-full
            :linenos:
            :lineno-start: 1
            :emphasize-lines: 19-24
            :copyable: false

      To connect to your |k8s-op-short|-deployed MongoDB sharded
      cluster resource from outside of the |k8s| cluster:

      .. include:: /includes/steps/enable-external-sharded.rst
