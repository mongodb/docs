.. _ref-multi-analyzers:

==============
Multi Analyzer
==============

.. default-domain:: mongodb

.. meta::
   :keywords: multiple analyzers, alternate search analyzer, multi path option
   :description: Use the ``multi`` object to specify alternate analyzers to also index the field with. Then you can search with the default or the alternate analyzer.

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

You can use the ``multi`` object in your index definition to specify 
alternate analyzers with which to also index the field. When you index 
a field with alternate analyzers in addition to the default analyzer, 
you can search the collection with either the default or the alternate 
analyzer. This page demonstrates how to specify alternate analyzers in 
your :ref:`index definition <ref-index-definitions>` using ``multi``.

.. _ref-multi-limitations:

Multi Analyzer Limitations
--------------------------

The ``multi`` path option is available only to fields of
type :ref:`string <bson-data-types-string>`.

|fts| does not support nesting multiple layers of ``multi`` objects.

Examples 
--------

The following examples demonstrate index definitions on the fields in the
``sample_mflix.movies`` collection. If you load the collection on your
{+cluster+}, you can create the example indexes using the Visual Editor or
the |json| Editor in the {+atlas-ui+} or using {+mongosh+}. 

----------

.. |arrow| unicode:: U+27A4

|arrow| Use the **Select your language** drop-down menu to set the 
interface for the example on this page.

----------

.. tabs-selector:: drivers

Single Field Example
~~~~~~~~~~~~~~~~~~~~

The following example index definition specifies an index on the
``title`` field  using the ``standard`` analyzer. The index definition
also specifies :ref:`lucene.french <ref-language-analyzers>` analyzer as
an alternate analyzer for the ``title`` field, with the name
``frenchAnalyzer``. 

.. tabs-drivers::

   .. tab::
      :tabid: atlas-ui

      .. include:: /includes/fts/analyzers/multi/single_exmpl_index_ui.rst

   .. tab::
      :tabid: shell

      .. literalinclude:: /includes/fts/analyzers/multi/single_exmpl_index_mongosh.js 
         :language: javascript 
         :copyable: true 
         :linenos:

The following query uses the alternate analyzer, named 
``frenchAnalyzer``, to search for the string ``liberte``. 

.. tabs-drivers::

   .. tab::
      :tabid: atlas-ui

      .. include:: /includes/fts/analyzers/multi/single_exmpl_query_ui.rst

   .. tab::
      :tabid: shell

      .. include:: /includes/fts/analyzers/multi/single_exmpl_query_mongosh.rst

The document in the results is a match because the ``frenchAnalyzer``
reduced both the indexed string ``è Nous la Libertè`` and query term
``liberte`` to the base word ``libert``. |fts| won't return this
document for a search with the ``standard`` analyzer because it doesn't
remove diacritics. Each analyzer generates the following tokens
(searchable terms) for the index and query: 

.. list-table:: 
   :header-rows: 1

   * - Analyzer 
     - Index Tokens
     - Query Tokens

   * - Standard Analyzer 
     - ``è``, ``nous``, ``la``, ``libertè``
     - ``libertè``

   * - French Analyzer 
     - ``è``, ``libert``
     - ``libert``

Multiple Fields Example 
~~~~~~~~~~~~~~~~~~~~~~~

The following example index definition specifies an index on the
``title`` and ``plot`` fields using the ``standard`` analyzer. The index
definition also specifies :ref:`lucene.french
<ref-language-analyzers>` as an alternate analyzer for the ``title``
and the ``plot`` fields.

.. tabs-drivers::

   .. tab::
      :tabid: atlas-ui

      .. include:: /includes/fts/analyzers/multi/mltpl_exmpl_index_ui.rst

   .. tab::
      :tabid: shell

      .. literalinclude:: /includes/fts/analyzers/multi/mltpl_exmpl_index_mongosh.js 
         :language: javascript 
         :copyable: true 
         :linenos:

The following query searches for matches for the string ``revolution`` in the
``title`` and the ``plot`` fields by using the alternate analyzer named
``frenchAnalyzer``.  

.. tabs-drivers::

   .. tab::
      :tabid: atlas-ui

      .. include:: /includes/fts/analyzers/multi/mltpl_exmpl_query_ui.rst

   .. tab::
      :tabid: shell

      .. include:: /includes/fts/analyzers/multi/mltpl_exmpl_query_mongosh.rst 

The documents in the results contain the query term in both the
``title`` and the ``plot`` fields. Each analyzer creates the following
tokens (searchable terms) for the ``title`` field for each document in
the results:  

.. list-table:: 

   * - Year
     - Analyzer
     - Index Tokens
     - Query Tokens
  
   * - 2012
     - | Standard Analyzer
       | French Analyzer
     - | ``revolution``
       | ``revolution``
     - | ``revolution`` 
       | ``revolution`` 

   * - 1985
     - | Standard Analyzer
       | French Analyzer
     - | ``revolution``
       | ``revolution``
     - | ``revolution``
       | ``revolution`` 

   * - 2014
     - | Standard Analyzer
       | French Analyzer
     - | ``angels``, ``of``, ``revolution``
       | ``angels``, ``of``, ``revolution``
     - | ``revolution``
       | ``revolution``

   * - 1970
     - | Standard Analyzer
       | French Analyzer
     - | ``start``, ``the``, ``revolution``, ``without``, ``me``
       | ``start``, ``the``, ``revolution``, ``without``
     - | ``revolution``
       | ``revolution``

   * - 1989 
     - | Standard Analyzer
       | French Analyzer
     - | ``la``, ``rèvolution``, ``franèaise``
       | ``revolution``, ``franeais`` 
     - | ``revolution``
       | ``revolution``


For the fifth document in the results, the ``frenchAnalyzer`` removed
the diacritics in the ``title`` field to match the document to the query
term.