.. _mongorestore:

================
``mongorestore``
================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. |arrow| unicode:: U+27A4
.. |tool-binary| replace:: :binary:`~bin.mongorestore`
.. |mongodb-aws-example| replace:: :ref:`mongorestore-example-connect-using-aws-iam`

Synopsis
--------

The :binary:`~bin.mongorestore` program loads data from either a binary
database dump created by :binary:`~bin.mongodump` or the standard input
into a :binary:`~bin.mongod` or :binary:`~bin.mongos` instance.

.. include:: /includes/extracts/require-cmd-line-mongorestore.rst

.. seealso::

   :binary:`~bin.mongodump` which provides the corresponding
   binary data export capability.

Versioning
~~~~~~~~~~

.. include:: /includes/extracts/dbtools-version-single.rst

.. admonition:: Quick links to older documentation
   :class: note

   - `MongoDB 4.2 mongorestore <https://docs.mongodb.com/v4.2/reference/program/mongorestore>`__
   - `MongoDB 4.0 mongorestore <https://docs.mongodb.com/v4.0/reference/program/mongorestore>`__
   - `MongoDB 3.6 mongorestore <https://docs.mongodb.com/v3.6/reference/program/mongorestore>`__

This documentation is for version ``{+release+}`` of |tool-binary|. 

Compatibility
-------------

MongoDB Server Compatibility
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/extracts/dbtools-compatibility-single.rst

Platform Support
~~~~~~~~~~~~~~~~

|tool-binary| version ``{+release+}`` is supported on the following
platforms:

.. include:: /includes/fact-platform-support.rst

Installation
------------

.. include:: /includes/fact-see-install-guide.rst

Syntax
------

The :binary:`~bin.mongorestore` command has the following form:

.. code-block:: sh

   mongorestore <options> <connection-string> <directory or file to restore>

.. include:: /includes/extracts/require-cmd-line-mongorestore.rst

For example, to restore from a ``dump`` directory to a local
:binary:`~bin.mongod` instance running on port ``27017``:

.. code-block:: sh

   mongorestore  dump/

As :binary:`~bin.mongorestore` restores from the ``dump/`` directory,
it creates the database and collections as needed and logs its progress:

.. code-block:: sh
   :copyable: false

   2019-07-08T14:37:38.942-0400	preparing collections to restore from
   2019-07-08T14:37:38.944-0400	reading metadata for test.bakesales from dump/test/bakesales.metadata.json
   2019-07-08T14:37:38.944-0400	reading metadata for test.salaries from dump/test/salaries.metadata.json
   2019-07-08T14:37:38.976-0400	restoring test.salaries from dump/test/salaries.bson
   2019-07-08T14:37:38.985-0400	no indexes to restore
   2019-07-08T14:37:38.985-0400	finished restoring test.salaries (10 documents, 0 failures)
   2019-07-08T14:37:39.009-0400	restoring test.bakesales from dump/test/bakesales.bson
   2019-07-08T14:37:39.011-0400	restoring indexes for collection test.bakesales from metadata
   2019-07-08T14:37:39.118-0400	finished restoring test.bakesales (21 documents, 0 failures)
   2019-07-08T14:37:39.118-0400	restoring users from dump/admin/system.users.bson
   2019-07-08T14:37:39.163-0400	restoring roles from dump/admin/system.roles.bson
   2019-07-08T14:37:39.249-0400	31 document(s) restored successfully. 0 document(s) failed to restore.

You can also restore a specific collection or collections from the
``dump/`` directory. For example, the following operation restores a
single collection from corresponding data files in the ``dump/``
directory:

.. code-block:: sh

   mongorestore --nsInclude=test.purchaseorders dump/

If the ``dump/`` directory does not contain the corresponding data file
for the specified namespace, no data will be restored. For example, the
following specifies a collection namespace that does not have a
corresponding data in the ``dump/`` directory:

.. code-block:: sh

   mongorestore --nsInclude=foo.bar dump/

The :binary:`~bin.mongorestore` outputs the following messages:

.. code-block:: sh
   :copyable: false

   2019-07-08T14:38:15.142-0400	preparing collections to restore from
   2019-07-08T14:38:15.142-0400	0 document(s) restored successfully. 0 document(s) failed to restore.

For more examples, see :ref:`mongorestore-examples`.

For more information on the options and arguments, see
:ref:`mongorestore-options`.

Behavior
--------

Insert Only
~~~~~~~~~~~

:binary:`~bin.mongorestore` can create a new database or add data to an
existing database. However, :binary:`~bin.mongorestore` performs inserts
only and does not perform updates. That is, if restoring documents to
an existing database and collection and existing documents have the
same value ``_id`` field as the to-be-restored documents,
:binary:`~bin.mongorestore` will *not* overwrite those documents.

Rebuild Indexes
~~~~~~~~~~~~~~~

:binary:`~bin.mongorestore` recreates indexes recorded by
:binary:`~bin.mongodump`.

.. note::

   For MongoDB installations with ``featureCompatibilityVersion`` (fCV)
   set to ``"4.0"`` or earlier, creating indexes will
   :limit:`error if an index key in an existing document exceeds the
   limit <Index Key Limit>`. 

   To avoid this issue, consider using hashed indexes or indexing a
   computed value instead. If you want to resolve the index issue after
   restoring the data, you can disable the default index key length
   validation on the target database by setting the :program:`mongod`
   instance's :parameter:`failIndexKeyTooLong` parameter to false.

Version Compatibility
~~~~~~~~~~~~~~~~~~~~~

In general, use corresponding versions of :binary:`~bin.mongodump`
and :binary:`~bin.mongorestore`. That is, to restore data files
created with a specific version of :binary:`~bin.mongodump`, use the
corresponding version of :binary:`~bin.mongorestore`.

Exclude ``system.profile`` Collection
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

:binary:`~bin.mongorestore` does not restore the :data:`system.profile
<<database>.system.profile>` collection data.

FIPS
~~~~

:binary:`~bin.mongorestore` automatically creates FIPS-compliant
connections to a :binary:`~bin.mongod`/:binary:`~bin.mongos` that is
:manual:`configured to use FIPS mode </tutorial/configure-fips>`.

Write Concern
~~~~~~~~~~~~~

If you specify write concern in both the
:option:`--writeConcern <mongorestore --writeConcern>` option and the
:option:`--uri <mongorestore --uri>` connection string option, the
:option:`--writeConcern <mongorestore --writeConcern>` value overrides
the write concern specified in the URI string.

.. _mongorestore-required-access:

Required Access
---------------

To restore data to a MongoDB deployment that has :manual:`access control
</core/authorization>` enabled, the :authrole:`restore` role provides
the necessary privileges to restore data from backups *if* the data does
not include :data:`system.profile <<database>.system.profile>`
collection data and you run :binary:`~bin.mongorestore` without the
:option:`--oplogReplay <mongorestore --oplogReplay>` option.

If the backup data includes :data:`system.profile
<<database>.system.profile>` collection data or you run
:binary:`~bin.mongorestore` with the
:option:`--oplogReplay <mongorestore --oplogReplay>` option, you need
additional privileges:

.. container::

   .. list-table::
      :widths: 20 80

      * - ``system.profile``

        - If the backup data includes :data:`system.profile
          <<database>.system.profile>` collection data and the target
          database does not contain the :data:`system.profile
          <<database>.system.profile>` collection,
          :binary:`~bin.mongorestore` attempts to create the collection
          even though the program does not actually restore
          ``system.profile`` documents. As such, the user requires
          additional privileges to perform
          :authaction:`createCollection` and
          :authaction:`convertToCapped` actions on the
          :data:`system.profile <<database>.system.profile>`
          collection for a database.

          Both the built-in roles :authrole:`dbAdmin` and
          :authrole:`dbAdminAnyDatabase` provide the additional
          privileges.

      * - ``--oplogReplay``

        - To run with :option:`--oplogReplay <mongorestore
          --oplogReplay>`, create a :ref:`user-defined role
          <create-user-defined-role>` that has :authaction:`anyAction`
          on :ref:`resource-anyresource`.

          Grant only to users who must run :binary:`~bin.mongorestore`
          with :option:`--oplogReplay <mongorestore --oplogReplay>`.

Usage in Backup Strategy
------------------------

Standalones/Replica Sets
~~~~~~~~~~~~~~~~~~~~~~~~

For an overview of :binary:`~bin.mongorestore` usage as part of a
backup and recovery strategy, see
:manual:`Back Up and Restore with MongoDB Tools</tutorial/backup-and-restore-tools>`.

Sharded Clusters
~~~~~~~~~~~~~~~~

.. include:: /includes/extracts/sharded-clusters-backup-restore-mongodump-mongorestore-restriction.rst
   
.. _mongorestore-options:

Options
-------

.. binary:: mongorestore

.. program:: mongorestore

.. option:: --help

   Returns information on the options and use of :program:`mongorestore`.


.. option:: --verbose, -v

   Increases the amount of internal reporting returned on standard output
   or in log files. Increase the verbosity with the ``-v`` form by
   including the option multiple times, (e.g. ``-vvvvv``.)
   


.. option:: --quiet

   Runs :program:`mongorestore` in a quiet mode that attempts to limit the amount
   of output.

   This option suppresses:
   
   - output from :term:`database commands <database command>`
   
   - replication activity
   
   - connection accepted events
   
   - connection closed events


.. option:: --version

   Returns the :program:`mongorestore` release number.


.. option:: --uri=<connectionString>
   
   Specifies the resolvable :manual:`URI connection string
   </reference/connection-string/>` of the MongoDB deployment, enclosed
   in quotes:
   
   .. code-block:: none
   
      --uri="mongodb://[username:password@]host1[:port1][,host2[:port2],...[,hostN[:portN]]][/[database][?options]]"
   
   .. include:: /includes/extracts/uri-positional-mongorestore.rst

   For information on the components of the connection string, see
   the :manual:`Connection String URI Format
   </reference/connection-string/>` documentation. 
   
   .. include:: /includes/fact-uri-with-conflicting-info.rst      


.. option:: --host=<hostname><:port>, -h=<hostname><:port>

   *Default*: localhost:27017

   Specifies the resolvable hostname of the MongoDB deployment. By
   default, :program:`mongorestore` attempts to connect to a MongoDB
   instance running on the localhost on port number ``27017``.
   
   To connect to a replica set, specify the
   :setting:`~replication.replSetName` and a seed list of set members, as in
   the following:
   
   .. code-block:: none
   
      --host=<replSetName>/<hostname1><:port>,<hostname2><:port>,<...>
   
   When specifying the replica set list format, :program:`mongorestore` always connects to
   the :term:`primary <Primary>`. 
   
   You can also connect to any single member of the replica set by specifying
   the host and port of only that member:
   
   .. code-block:: none
   
      --host=<hostname1><:port>

   If you use IPv6 and use the ``<address>:<port>`` format, you must
   enclose the portion of an address and port combination in
   brackets (e.g. ``[<address>]``).

   .. include:: /includes/extracts/uri-used-with-host.rst


.. option:: --port=<port>

   *Default*: 27017

   Specifies the TCP port on which the MongoDB instance listens for
   client connections.
   
   .. include:: /includes/extracts/uri-used-with-port.rst


.. option:: --ssl

   Enables connection to a :binary:`~bin.mongod` or :binary:`~bin.mongos` that has
   TLS/SSL support enabled.
   
   .. include:: /includes/extracts/uri-used-with-ssl.rst

   .. include:: /includes/extracts/ssl-facts-see-more.rst
   


.. option:: --sslCAFile=<filename>

   Specifies the :file:`.pem` file that contains the root certificate chain
   from the Certificate Authority. Specify the file name of the
   :file:`.pem` file using relative or absolute paths.
   
   .. include:: /includes/extracts/uri-used-with-sslcafile.rst

   .. include:: /includes/extracts/ssl-facts-see-more.rst


.. option:: --sslPEMKeyFile=<filename>

   Specifies the :file:`.pem` file that contains both the TLS/SSL certificate
   and key. Specify the file name of the :file:`.pem` file using relative
   or absolute paths.
   
   This option is required when using the :option:`--ssl` option to connect
   to a :binary:`~bin.mongod` or :binary:`~bin.mongos` that has
   :setting:`~net.ssl.CAFile` enabled *without*
   :setting:`~net.ssl.allowConnectionsWithoutCertificates`.
   
   .. include:: /includes/extracts/uri-used-with-sslpemkeyfile.rst

   .. include:: /includes/extracts/ssl-facts-see-more.rst
   


.. option:: --sslPEMKeyPassword=<value>

   Specifies the password to de-crypt the certificate-key file (i.e.
   :option:`--sslPEMKeyFile`). Use the :option:`--sslPEMKeyPassword` option only if the
   certificate-key file is encrypted. In all cases, the :program:`mongorestore` will
   redact the password from all logging and reporting output.
   
   If the private key in the PEM file is encrypted and you do not specify
   the :option:`--sslPEMKeyPassword` option, the :program:`mongorestore` will prompt for a passphrase. See
   :ref:`ssl-certificate-password`.
   
   .. include:: /includes/extracts/uri-used-with-sslpemkeypassword.rst

   .. include:: /includes/extracts/ssl-facts-see-more.rst


.. option:: --sslCRLFile=<filename>

   Specifies the :file:`.pem` file that contains the Certificate Revocation
   List. Specify the file name of the :file:`.pem` file using relative or
   absolute paths.
   
   .. include:: /includes/extracts/ssl-facts-see-more.rst
   


.. option:: --sslAllowInvalidCertificates

   Bypasses the validation checks for server certificates and allows
   the use of invalid certificates. When using the
   :setting:`~net.ssl.allowInvalidCertificates` setting, MongoDB logs as a
   warning the use of the invalid certificate.
   
   .. include:: /includes/extracts/ssl-facts-invalid-cert-warning-clients.rst
   
   .. include:: /includes/extracts/uri-used-with-sslallowinvalidcertificates.rst

   .. include:: /includes/extracts/ssl-facts-see-more.rst
   


.. option:: --sslAllowInvalidHostnames

   Disables the validation of the hostnames in TLS/SSL certificates. Allows
   :program:`mongorestore` to connect to MongoDB instances even if the hostname in their
   certificates do not match the specified hostname.
   
   .. include:: /includes/extracts/uri-used-with-sslallowinvalidhostnames.rst
   
   .. include:: /includes/extracts/ssl-facts-see-more.rst


.. option:: --username=<username>, -u=<username>

   Specifies a username with which to authenticate to a MongoDB database
   that uses authentication. Use in conjunction with the :option:`--password` and
   :option:`--authenticationDatabase` options.

   .. include:: /includes/extracts/uri-used-with-username.rst

   .. include:: /includes/extracts/mongodb-aws-username-mongorestore.rst


.. option:: --password=<password>, -p=<password>

   Specifies a password with which to authenticate to a MongoDB database
   that uses authentication. Use in conjunction with the :option:`--username` and
   :option:`--authenticationDatabase` options.

   To prompt the user for the password, pass the :option:`--username`
   option without :option:`--password` or specify an empty string as the
   :option:`--password` value, as in ``--password=""`` .

   .. include:: /includes/extracts/uri-used-with-password.rst

   .. include:: /includes/extracts/mongodb-aws-password-mongorestore.rst


.. option:: --awsSessionToken=<AWS Session Token>

   .. include:: /includes/extracts/mongodb-aws-session-token-mongorestore.rst


.. option:: --authenticationDatabase=<dbname>

   Specifies the authentication database where the specified :option:`--username` has been created.
   See :ref:`user-authentication-database`.

   .. include:: /includes/fact-auth-database-use-external.rst
   
   .. include:: /includes/extracts/uri-used-with-authenticationdatabase.rst


.. option:: --authenticationMechanism=<name>

   *Default*: SCRAM-SHA-1

   Specifies the authentication mechanism the :program:`mongorestore` instance uses to
   authenticate to the :binary:`~bin.mongod` or :binary:`~bin.mongos`.

   .. versionchanged:: 100.1.0
   
      Starting in version ``100.1.0``, :program:`mongorestore` adds support
      for the ``MONGODB-AWS`` authentication mechanism when connecting
      to a `MongoDB Atlas
      <https://www.mongodb.com/cloud/atlas?tck=docs_server>`__ cluster.

   .. include:: /includes/list-table-auth-mechanisms.rst
   
   .. include:: /includes/extracts/uri-used-with-authenticationmechanism.rst


.. option:: --gssapiServiceName=<serviceName>

   Specify the name of the service using :manual:`GSSAPI/Kerberos
   </core/kerberos>`. Only required if the service does not use the
   default name of ``mongodb``.
   
   This option is available only in MongoDB Enterprise.
   


.. option:: --gssapiHostName=<hostname>

   Specify the hostname of a service using :manual:`GSSAPI/Kerberos
   </core/kerberos>`. *Only* required if the hostname of a machine does
   not match the hostname resolved by DNS.
   
   This option is available only in MongoDB Enterprise.
   


.. option:: --db=<database>, -d=<database>

   
   Specifies the destination database for :program:`mongorestore` to restore data
   *into* when restoring from a BSON file. If the database does not
   exist, :program:`mongorestore` creates the database. For example, the following
   restores the ``salaries`` collection into the ``reporting`` database.
   
   .. code-block:: sh
      :copyable: false
   
      mongorestore --db=reporting dump/test/salaries.bson 
   
   If you do not specify :option:`--db`, :program:`mongorestore` takes the database name
   from the data files.
   
   The use of :option:`--db` and :option:`--collection` options are
   deprecated when restoring from a directory or an archive file.
   Instead, to restore from an archive or a directory, see
   :option:`--nsInclude` instead.
   
   .. include:: /includes/extracts/uri-used-with-db.rst


.. option:: --collection=<collection>, -c=<collection>

   
   Specifies the name of the destination collection for :program:`mongorestore` to
   restore data *into* when restoring from a BSON file. If
   you do not specify :option:`--collection`, :program:`mongorestore` takes
   the collection name from the input filename. If the input file has an
   extension, MongoDB omits the extension of the file from the collection
   name.
   
   .. code-block:: sh
      :copyable: false
   
      mongorestore --db=reporting --collection=employeesalaries dump/test/salaries.bson 
   
   The use of :option:`--db` and :option:`--collection` options are
   deprecated when restoring from a directory or an archive file.
   Instead, to restore from an archive or a directory, see
   :option:`--nsInclude` instead.


.. option:: --nsExclude=<namespace pattern>
   
   Specifies a :term:`namespace` pattern (e.g. ``"test.myCollection"``,
   ``"reporting.*"``, ``"dept*.bar"``) to *exclude* the matching
   namespaces from the restore. In the pattern, you can use asterisks
   ``*`` as *wild cards*. For an example of the wildcard pattern, see
   :ref:`example-basic-wildcard-usage`.
   
   You can specify :option:`--nsExclude` multiple times to exclude multiple namespace
   patterns.


.. option:: --nsInclude=<namespace pattern>

   Specifies a :term:`namespace` pattern (e.g. ``"test.myCollection"``,
   ``"reporting.*"``, ``"dept*.bar"``) to restore only the namespaces
   that match the pattern. In the pattern, you can use asterisks ``*``
   as *wild cards*. For an example of the wildcard pattern, see
   :ref:`example-basic-wildcard-usage`.
   
   You can specify :option:`--nsInclude` multiple times to include multiple namespace
   patterns.
   
   If source directory or file (i.e. the directory/file from which you
   are restoring the data) does not contain data files that match the
   namespace pattern, no data will be restored.
   
   For collection names that contain non-ascii characters,
   :binary:`~bin.mongodump` outputs the corresponding filenames with
   percent-encoded names. However, to restore these collections, do not
   use the encoded names. Instead, use the namespace with the non-ascii
   characters.
  
   For example, if the dump directory contains
   ``dump/test/caf%C3%A9s.bson``, specify ``--nsInclude "test.caf√©s"``.


.. option:: --nsFrom=<namespace pattern>

   Use with :option:`--nsTo` to rename a :term:`namespace` during the
   restore operation. :option:`--nsFrom` specifies the collection in the
   dump file, while :option:`--nsTo` specifies the name that should be
   used in the restored database.

   .. include:: /includes/extracts/ns-pattern-complex-from.rst
   


.. option:: --nsTo=<namespace pattern>

   Use with :option:`--nsFrom` to rename a :term:`namespace` during the
   restore operation. :option:`--nsTo` specifies the new collection
   name to use in the restored database, while
   :option:`--nsFrom` specifies the name in the dump file.

   .. include:: /includes/extracts/ns-pattern-complex-to.rst
   


.. option:: --objcheck

   Forces :program:`mongorestore` to validate all requests from clients
   upon receipt to ensure that clients never insert invalid documents into
   the database. For objects with a high degree of sub-document nesting,
   :option:`--objcheck` can have a small impact on performance.


.. option:: --drop

   Before restoring the collections from the dumped backup, drops the
   collections from the target database. :option:`--drop` does not drop
   collections that are not in the backup.
   
   When the restore includes the ``admin`` database, :program:`mongorestore` with
   :option:`--drop` removes all user credentials and replaces them with the
   users defined in the dump file. Therefore, in systems with
   :setting:`~security.authorization` enabled, :program:`mongorestore` must be able
   to authenticate to an existing user *and* to a user defined in the
   dump file. If :program:`mongorestore` can't authenticate to a user defined in the
   dump file, the restoration process will fail, leaving an empty
   database.

   If a collection is dropped and recreated as part of the restore, the
   newly created collection has a different UUID unless :option:`--drop
   <mongorestore --drop>` is used with :option:`--preserveUUID
   <mongorestore --preserveUUID>`.
   
.. option:: --preserveUUID

   Restored collections use the UUID from the restore data instead of
   creating a new UUID for collections that are dropped and recreated
   as part of the restore.

   To use :option:`--preserveUUID <mongorestore --preserveUUID>`, you
   must also include the :option:`--drop <mongorestore --drop>` option.

.. option:: --dryRun

   Runs :program:`mongorestore` without actually importing any data, returning the
   :program:`mongorestore` summary information. Use with ``--verbose`` to produce
   more detailed summary information.


.. option:: --oplogReplay

   After restoring the database dump, replays the :term:`oplog` entries
   from a bson file.
   When used in conjunction with :option:`mongodump --oplog`,
   :binary:`mongorestore --oplogReplay <~bin.mongorestore>`
   restores the database to the point-in-time backup captured with the
   ``mongodump --oplog`` command. 
   
   :program:`mongorestore` searches for any valid source  for the bson file
   in the following locations:
   
   - The top level of the dump directory, as in the case of a dump created
     with :option:`mongodump --oplog`.
   
   - The path specified by :option:`--oplogFile`.
   
   - ``<dump-directory>/local/oplog.rs.bson``, as in the case of a dump
     of the ``oplog.rs`` collection in the ``local`` database
     on a :binary:`~bin.mongod` that is a member of a replica set.
   
   If there is an ``oplog.bson`` file at the top level of the dump
   directory **and** a path specified by :option:`--oplogFile`,
   :program:`mongorestore` returns an error.
      
   If there is an ``oplog.bson`` file at the top level of the dump directory,
   :program:`mongorestore` restores that file as the oplog. If there are also bson
   files in the ``dump/local`` directory, :program:`mongorestore` restores them like
   normal collections.
   
   If you specify an oplog file using :option:`--oplogFile`,
   :program:`mongorestore` restores that file as the oplog. If there are also bson
   files in the ``dump/local`` directory, :program:`mongorestore` restores them like
   normal collections.
   
   For an example of :option:`--oplogReplay`, see :ref:`backup-restore-oplogreplay`.
   
   .. note::
   
      When using :binary:`~bin.mongorestore` with :option:`--oplogReplay` to restore
      a replica set, you must 
      restore a full dump of a :term:`replica set` member created 
      using :binary:`~bin.mongodump --oplog <mongodump>`. 
      :binary:`~bin.mongorestore` with :option:`--oplogReplay` fails if you use any of 
      the following options to limit the data be restored:
   
      - :option:`--db`
      - :option:`--collection`
      - :option:`--nsInclude`
      - :option:`--nsExclude`
   
   .. seealso:: :ref:`mongorestore Required Access <mongorestore-required-access>`
   
   .. seealso:: :option:`mongodump --oplog`


.. option:: --oplogLimit=<timestamp>

   Prevents :program:`mongorestore` from applying :term:`oplog` entries
   with timestamp newer than or equal to ``<timestamp>``. Specify
   ``<timestamp>`` values in the form of ``<time_t>:<ordinal>``, where
   ``<time_t>`` is the seconds since the UNIX epoch, and ``<ordinal>``
   represents a counter of operations in the oplog that occurred in the
   specified second.
   
   You must use :option:`--oplogLimit` in conjunction with the
   :option:`--oplogReplay` option.


.. option:: --oplogFile=<path>

   Specifies the path to the oplog file containing oplog data for the
   restore. Use with :option:`--oplogReplay`. 
   
   If you specify :option:`--oplogFile` and there is an :file:`oplog.bson`
   file at the top level of the dump directory, :program:`mongorestore` returns an 
   error.


.. option:: --convertLegacyIndexes

   .. versionadded:: 100.0.0

   Removes any invalid index options specified in the corresponding
   :binary:`~bin.mongodump` output, and rewrites any legacy index key
   values to use valid values.

   - *Invalid index options* are any options specified to an index that
     are not listed as a :ref:`valid field<createIndexes-method-options>` for
     the :dbcommand:`createIndexes` command. For example, ``name`` and 
     ``collation`` are valid, but an arbitrary ``custom_field`` is not.
     With ``--convertLegacyIndexes`` specified, any invalid index
     options found are dropped.

   - *Legacy index key values* are any values for
     :ref:`index type <index-types>` that are
     :ref:`no longer supported<3.4-index-validation>`. For example,
     ``1`` and ``-1`` are valid index key values, but ``0`` or an empty
     string are legacy values. With ``--convertLegacyIndexes``
     specified, any legacy index key values found are rewritten as
     ``1``. Non-empty string values are not replaced.

   Without the ``--convertLegacyIndexes`` option specified, the presence
   of invalid index options or legacy index key values could cause the
   index build to fail.

   If the :option:`--noIndexRestore <mongorestore --noIndexRestore>`
   option is specified to :program:`mongorestore`, the
   ``--convertLegacyIndexes`` option is ignored.


.. option:: --keepIndexVersion

   Prevents :program:`mongorestore` from upgrading the index to the latest
   version during the restoration process.


.. option:: --noIndexRestore

   Prevents :program:`mongorestore` from restoring and building indexes as
   specified in the corresponding :binary:`~bin.mongodump` output.


.. option:: --noOptionsRestore

   Prevents :program:`mongorestore` from setting the collection options,
   such as those specified by the :dbcommand:`collMod` :term:`database
   command`, on restored collections.


.. option:: --restoreDbUsersAndRoles

   Restore user and role definitions for the given database. See
   :manual:`system.roles Collection</reference/system-roles-collection>`
   and
   :manual:`system.users Collection</reference/system-users-collection>`
   for more information.
   


.. option:: --writeConcern=<document>

   *Default*: majority

   Specifies the :term:`write concern` for each write operation that :program:`mongorestore`
   performs.
   
   Specify the write concern as a document with :ref:`w options <wc-w>`:
      
   .. code-block:: sh
   
      --writeConcern="{w:'majority'}"

   
   If the write concern is also included in the :option:`--uri
   connection string <--uri>`, the command-line
   :option:`--writeConcern` overrides the write concern specified in
   the URI string.


.. option:: --maintainInsertionOrder

   *Default*: false
  
   If specified, :program:`mongorestore` inserts the documents in the
   order of their appearance in the input source. That is, both the
   bulk write batch order and document order within the batches are
   maintained.
   
   Specifying :option:`--maintainInsertionOrder` also enables
   :option:`--stopOnError <mongorestore --stopOnError>` and sets
   :option:`numInsertionWorkersPerCollection 
   <mongorestore --numInsertionWorkersPerCollection>` to 1.
   
   If unspecified, :program:`mongorestore` may perform the insertions in
   an arbitrary order.


.. option:: --numParallelCollections=<int>, -j=<int>

   *Default*: 4

   Number of collections :program:`mongorestore` should restore
   in parallel.

   If you specify ``-j`` when restoring a *single* collection, ``-j``
   maps to the :option:`--numInsertionWorkersPerCollection` option rather than
   :option:`--numParallelCollections`.


.. option:: --numInsertionWorkersPerCollection=<int>

   *Default*: 1

   Specifies the number of insertion workers to run concurrently per collection.


   For large imports, increasing the number of insertion workers
   may increase the speed of the import.
   


.. option:: --stopOnError

   Forces :program:`mongorestore` to halt the restore when it encounters an
   error.

   By default, :binary:`~bin.mongorestore` continues when it encounters
   duplicate key and document validation errors. To ensure that the
   program stops on these errors, specify
   :option:`--stopOnError <mongorestore --stopOnError>`.


.. option:: --bypassDocumentValidation

   Enables :program:`mongorestore` to bypass :manual:`document validation </core/schema-validation>`
   during the operation. This lets you insert documents that do not
   meet the validation requirements.

.. _mongorestore-path-option:

.. option:: --gzip

   Restores from compressed files or data stream created by
   :binary:`~bin.mongodump --gzip <mongodump>`
   
   To restore from a dump directory that contains compressed files, run
   :binary:`~bin.mongorestore` with the :option:`--gzip` option.
   
   To restore from a compressed archive file, run :binary:`~bin.mongorestore` with
   both the :option:`--gzip`  and the `--archive` options.
   


.. option:: --archive=<file>

   Restores from the specified archive file or, if the file is
   unspecified, from the standard input (``stdin``):

   - To restore from an archive file, run :program:`mongorestore` with
     the ``--archive`` option and the archive filename

   - To restore from the standard input, run :program:`mongorestore`
     with the ``--archive`` option but *omit* the filename.

   .. note::
   
      - You cannot use the ``--archive`` option with the :option:`--dir`
        option. 
   
      - If you use the :option:`--archive` option with the :option:`\<path\>`
        parameter, :program:`mongorestore` ignores :option:`\<path\>` parameter.
    
      - :program:`mongorestore` still supports the positional ``-`` parameter to
        restore a *single* collection from the standard input.


.. option:: <path>

   
   The directory path or BSON file name from which to restore data.
   
   You cannot specify both the ``<path>`` argument and the ``--dir``
   option, which also specifies the dump directory, to :program:`mongorestore`.


.. option:: --dir=string

   Specifies the dump directory.
   
   - You cannot specify both the ``--dir`` option and the ``<path>``
     argument, which also specifies the dump directory, to :program:`mongorestore`.
   
   - You cannot use the ``--archive`` option with the ``--dir`` option.


.. _mongorestore-examples:

Examples
--------

.. include:: /includes/extracts/require-cmd-line-mongorestore.rst

Restore with Access Control
~~~~~~~~~~~~~~~~~~~~~~~~~~~

In the following example, :binary:`~bin.mongorestore` restores from
``/opt/backup/mongodump-2011-10-24`` to a :binary:`~bin.mongod`
instance running on port ``27017`` on the host
``mongodb1.example.net``. The :option:`--uri <mongorestore --uri>`
string omits the user's password to have :binary:`~bin.mongorestore`
prompt for the password.

.. code-block:: sh

   mongorestore --uri="mongodb://user@mongodb1.example.net:27017/?authSource=admin" /opt/backup/mongodump-2011-10-24

Alternatively, you can specify the host, port, username, and
authentication database using :option:`--host <mongorestore --host>`,
:option:`--port <mongorestore --port>`, :option:`--username <mongorestore
--username>`, and :option:`--authenticationDatabase <mongorestore
--authenticationDatabase>`.  Omit :option:`--password <mongorestore
--password>` to have :binary:`~bin.mongorestore` prompt for the password:

.. code-block:: sh

   mongorestore --host=mongodb1.example.net --port=27017 --username=user --authenticationDatabase=admin /opt/backup/mongodump-2011-10-24

Restore a Collection
~~~~~~~~~~~~~~~~~~~~

To restore a specific collection, use :option:`--nsInclude
<mongorestore --nsInclude>`, passing in the full namespace
(``<database>.<collection>``) of the collection.

For example, the following restores the collection named
``purchaseorders`` in the database ``test`` from the corresponding
files located in the ``dump/`` directory.

.. code-block:: sh

   mongorestore --nsInclude=test.purchaseorders dump/

The :binary:`~bin.mongorestore` outputs the results, including the
number of documents restored:

.. code-block:: sh
   :copyable: false
   
   2019-06-28T19:23:42.858-0400   preparing collections to restore from
   2019-06-28T19:23:42.858-0400   reading metadata for test.purchaseorders from dump/test/purchaseorders.metadata.json
   2019-06-28T19:23:42.893-0400   restoring test.purchaseorders from dump/test/purchaseorders.bson
   2019-06-28T19:23:42.896-0400   restoring indexes for collection test.purchaseorders from metadata
   2019-06-28T19:23:42.991-0400   finished restoring test.purchaseorders (6 documents, 0 failures)
   2019-06-28T19:23:42.991-0400   6 document(s) restored successfully. 0 document(s) failed to restore.

If the ``dump/`` directory does not contain the corresponding data
files for the specified namespace, no data will be restored:

.. code-block:: sh
   :copyable: false

   2019-07-08T14:39:57.121-0400. preparing collections to restore from
   2019-07-08T14:39:57.121-0400  0 document(s) restored successfully. 0 document(s) failed to restore.

Alternatively, you can restore a specific collection using the
:option:`--db <mongorestore --db>`, :option:`--collection <mongorestore
--collection>`, and a ``.bson`` file:

.. code-block:: sh

   mongorestore --db=test --collection=purchaseorders dump/test/purchaseorders.bson

.. code-block:: sh
   :copyable: false

   2019-06-30T12:21:44.777-0400   checking for collection data in dump/test/purchaseorders.bson
   2019-06-30T12:21:44.779-0400   reading metadata for test.purchaseorders from dump/test/purchaseorders.metadata.json
   2019-06-30T12:21:44.813-0400   restoring test.purchaseorders from dump/test/purchaseorders.bson
   2019-06-30T12:21:44.881-0400   restoring indexes for collection test.purchaseorders from metadata
   2019-06-30T12:21:44.987-0400   finished restoring test.purchaseorders (6 documents, 0 failures)
   2019-06-30T12:21:44.987-0400   6 document(s) restored successfully. 0 document(s) failed to restore.

.. _example-basic-wildcard-usage:

Restore Collections Using Wild Cards
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

:option:`--nsInclude <mongorestore --nsInclude>` and
:option:`--nsExclude <mongorestore --nsExclude>` support specifying the
:term:`namespaces <namespace>` you wish to include or exclude from a
restore operation using asterisks as *wild cards*.

The following example restores the documents in the ``dump/``
sub-directory of the current directory that match the specified
namespace pattern. The :option:`--nsInclude <mongorestore --nsInclude>`
statement specifies to only restore documents in the ``transactions``
database while :option:`--nsExclude <mongorestore --nsExclude>`
instructs :binary:`~bin.mongorestore` to exclude collections whose
names end with ``_dev``. :binary:`~bin.mongorestore` restores data to
the :binary:`~bin.mongod` instance running on the localhost interface
on port ``27017``.

.. code-block:: sh

   mongorestore --nsInclude='transactions.*' --nsExclude='transactions.*_dev' dump/

.. _example-complex-wildcard-usage:

Change Collections' Namespaces during Restore
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

You can use the :option:`--nsFrom <mongorestore --nsFrom>` and
:option:`--nsTo <mongorestore --nsTo>` options to change the namespace
of the collection that you are restoring.
:option:`--nsFrom <mongorestore --nsFrom>` and :option:`--nsTo
<mongorestore --nsTo>` support using asterisks as wild cards *and*
support using dollar signs to delimit "wild card" variables to use in
the replacement.

Consider a database ``data`` that you have exported to a ``dump/``
directory using :binary:`~bin.mongodump`. The ``data`` database
contains the following collections:

- ``sales_customer1``
- ``sales_customer2``
- ``sales_customer3``
- ``users_customer1``
- ``users_customer2``
- ``users_customer3``

Using :option:`--nsFrom <mongorestore --nsFrom>` and :option:`--nsTo
<mongorestore --nsTo>`, you can restore the data into different
namespaces. The following operation

- restores the ``sales_<customerName>`` collections in the ``data``
  database to ``sales`` collections in the ``<customerName>`` database,
  and

- restores the ``users_<customerName>`` collections to ``users``
  collections in the ``<customerName>`` database.

.. code-block:: sh

   mongorestore --nsInclude='data.*' --nsFrom='data.$prefix$_$customer$' --nsTo='$customer$.$prefix$'

.. _mongorestore-example-copy-clone-database:

Copy/Clone a Database
~~~~~~~~~~~~~~~~~~~~~

Starting in version 4.2, MongoDB removes the deprecated ``copydb``
command and ``clone`` command.

As an alternative, users can use :binary:`~bin.mongodump` and
:binary:`~bin.mongorestore` (with the ``mongorestore`` options
:option:`--nsFrom <mongorestore --nsFrom>` and :option:`--nsTo
<mongorestore --nsFrom>`).

.. include:: /includes/extracts/clone-copy-db-same-instance.rst

.. _mongorestore-example-archive-file:

Restore from an Archive File
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

To restore from an archive file, run :binary:`~bin.restore` with the new
``--archive`` option and the archive filename.

.. code-block:: sh

   mongorestore --archive=test.20150715.archive 

.. _mongorestore-example-archive-file-db:

Restore a Database from an Archive File
````````````````````````````````````````

To restore from an archive file, run :binary:`~bin.restore` with the new
``--archive`` option and the archive filename. For example, the
following operation restores the ``test`` database from the file
``test.20150715.archive``.

.. code-block:: sh

   mongorestore --archive=test.20150715.archive  --nsInclude="test.*"


.. _mongorestore-example-gzip:

Restore from Compressed Data
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

:binary:`~bin.mongorestore` can restore from compressed files or
compressed archive files created by :binary:`~bin.mongodump`.

To restore from a dump directory that contains compressed files, run
:binary:`~bin.mongorestore` with the :option:`--gzip <mongorestore
--gzip>`. For example, the following operation restores the ``test``
database from the compressed files located in the default ``dump``
directory:

.. code-block:: sh

   mongorestore --gzip  --nsInclude="test.*" dump/

To restore from a compressed archive file, run
:binary:`~bin.mongorestore` with the :option:`--gzip <mongorestore
--gzip>` option and the :option:`--archive <mongorestore --archive>`
option. For example, the following operation restores the ``test``
database from the archive file ``test.20150715.gz``.

.. code-block:: sh

   mongorestore --gzip --archive=test.20150715.gz --nsInclude="test.*"

.. _mongorestore-example-archive-stdin:

Restore a Database from Standard Input
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

To restore from the standard input, run :binary:`~bin.mongorestore`
with the :option:`--archive <mongorestore --archive>` option but *omit*
the filename. For example:

.. code-block:: sh

   mongodump --archive --db=test --port=27017 | mongorestore --archive --port=27018

.. _mongorestore-example-connect-using-aws-iam:

Connect to a MongoDB Atlas Cluster using AWS IAM Credentials
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. versionadded:: 100.1.0

To connect to a `MongoDB Atlas
<https://www.mongodb.com/cloud/atlas?tck=docs_server>`__ cluster which
has been configured to support authentication via `AWS IAM credentials
<https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html>`__,
provide a :option:`connection string <mongorestore --uri>` to
|tool-binary| similar to the following:

.. code-block:: none

   mongorestore 'mongodb+srv://<aws access key id>:<aws secret access key>@cluster0.example.com/testdb?authSource=$external&authMechanism=MONGODB-AWS' <other options>

Connecting to Atlas using AWS IAM credentials in this manner uses the
``MONGODB-AWS`` :urioption:`authentication mechanism <authMechanism>`
and the ``$external`` :urioption:`authSource`, as shown in this example.

If using an `AWS session token
<https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_temp_use-resources.html>`__,
as well, provide it with the ``AWS_SESSION_TOKEN``
:urioption:`authMechanismProperties` value, as follows:

.. code-block:: none

   mongorestore 'mongodb+srv://<aws access key id>:<aws secret access key>@cluster0.example.com/testdb?authSource=$external&authMechanism=MONGODB-AWS&authMechanismProperties=AWS_SESSION_TOKEN:<aws session token>' <other options>

If the AWS access key ID, the secret access key, or the session token
include the 'at' sign ``@``, colon ``:``, slash ``/``, or the percent
sign ``%`` characters, those characters must be converted using
`percent encoding <https://tools.ietf.org/html/rfc3986#section-2.1>`__.

Alternatively, the AWS access key ID, secret access key, and optionally
session token can each be provided outside of the connection string
using the :option:`--username`, :option:`--password`, and
:option:`--awsSessionToken` options instead, like so:

.. code-block:: none

   mongorestore 'mongodb+srv://cluster0.example.com/testdb?authSource=$external&authMechanism=MONGODB-AWS' --username <aws access key id> --password <aws secret access key> --awsSessionToken <aws session token> <other options>

When provided as command line parameters, these three options do not
require percent encoding.

You may also set these credentials on your platform using standard
`AWS IAM environment variables
<https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-envvars.html#envvars-list>`__.
|tool-binary| checks for the following environment variables when you
use the ``MONGODB-AWS``
:urioption:`authentication mechanism <authMechanism>`:

- ``AWS_ACCESS_KEY_ID``
- ``AWS_SECRET_ACCESS_KEY``
- ``AWS_SESSION_TOKEN``

If set, these credentials do not need to be specified in the connection
string or via their explicit options.

.. note::

   If you chose to use the AWS environment variables to specify these
   values, you cannot mix and match with the corresponding explicit or 
   connection string options for these credentials. Either use the
   environment variables for access key ID *and* secret access key
   (*and* session token if used), **or** specify each of these using the
   explicit or connection string options instead.

The following example sets these environment variables in the ``bash``
shell:

.. code-block:: none

   export AWS_ACCESS_KEY_ID='<aws access key id>'
   export AWS_SECRET_ACCESS_KEY='<aws secret access key>'
   export AWS_SESSION_TOKEN='<aws session token>'

Syntax for setting environment variables in other shells will be
different. Consult the documentation for your platform for more
information.

You can verify that these environment variables have been set with the
following command:

.. code-block:: none

   env | grep AWS

Once set, the following example connects to a MongoDB Atlas cluster
using these environment variables:

.. code-block:: none

   mongorestore 'mongodb+srv://cluster0.example.com/testdb?authSource=$external&authMechanism=MONGODB-AWS'  <other options>
