===================================
Rotate your AWS Customer Master Key
===================================

.. default-domain:: mongodb

.. meta::
   :keywords: encryption

.. include:: /includes/fact-atlas-free-tier-limits.rst

.. include:: /includes/serverless-preview-dont-use.rst

.. include:: /includes/fact-atlas-key-rotation.rst

|service| does *not* automatically rotate the |aws| customer master key
(CMK) used for |aws|\-provided Encryption at Rest.

|service| automatically creates an
:alert:`alert <AWS encryption key elapsed time since last rotation is above (n) days>`
to remind you to rotate your |cmk| every 90 days by default when you
:ref:`enable Encryption at Rest <security-aws-kms>` for |a-service|
project.

|aws| |kms| supports
:aws:`automatic CMK rotation </kms/latest/developerguide/rotate-keys.html>`.
|aws| automatic |cmk| rotation does not require you to update the
|service| Encryption at Rest project settings, including the |cmk| ID.

This page explains how to create a new key and update the |cmk| ID in
|service| to rotate your |service| project |cmk|. This method of key
rotation supports more granular control of the rotation period compared
to |aws| |kms| automatic |cmk| rotation.

.. important:: {+Cloud-Backup+}s with Encryption at Rest

   For clusters using :doc:`Encryption at Rest </security-aws-kms>` and
   :ref:`backup-cloud-provider`, |service| uses the project's |cmk| and
   |aws| |iam| user credentials at the time of the snapshot to
   automatically encrypt the snapshot data files. This is an additional
   layer of encryption on the existing encryption applied to all
   |service| storage and snapshot volumes.

   |service| does *not* re-encrypt snapshots with the new |cmk| after
   rotation. Do *not* delete the old |cmk| until you check *every*
   backup-enabled cluster in the project for any snapshots still using
   that |cmk|. |service| deletes backups in accordance to the
   :ref:`cloud-provider-retention-policy`. After |service| deletes all
   snapshots depending on a given |cmk|, you can delete that |cmk|
   safely.

Procedure
---------

.. include:: /includes/steps/rotate-aws-kms-cmk.rst

Related Topics
--------------

- To learn more about MongoDB Encryption at Rest, see
  :manual:`Encryption at Rest </core/security-encryption-at-rest/>` in
  the MongoDB server documentation.

- To learn more about Encryption at Rest with {+Cloud-Backup+}s, see :ref:`encrypted-cloud-provider-snapshot`.
