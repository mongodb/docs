stepnum: 1
level: 4
source:
  file: steps-source-upgrade-onprem.yaml
  ref: shutdown
pre: |
  Shut down the |application|:
---
stepnum: 2
level: 4
# Note: This step is borrowed from the deb install procedure, not from steps-source-upgrade.
source:
  file: steps-install-on-prem-with-deb-packages.yaml
  ref: download
---
title: "Install the |onprem| package on each server being used for |onprem|."
stepnum: 3
level: 4
ref: install
content: |
  a. Install the ``.deb`` package on each |application| server and each Backup
     Daemon server by issuing the following command, where ``<version>`` is
     the version of the ``.deb`` package:

     .. code-block:: sh

        sudo dpkg -i mongodb-mms_<version>_x86_64.deb

  b. When prompted whether to overwrite the currently installed version of
     conf-mms.properties, type ``N``, to keep the currently installed version.

  The installer preserves the existing ``conf-mms.properties`` configuration
  file and names the new configuration file ``conf-mms.properties.dpkg-dist``.
  Both are located in ``/opt/mongodb/mms/conf/``.

# .. note::

#    If the server runs only a Backup Daemon and does not have an existing
#    ``conf-mms.properties`` file, copy the file from an |application| server
#    to the Backup Daemon server. This preserves the :setting:`mongo.mongoUri`
#    string for connecting to the Backup Database. Copy the
#    ``conf-mms.properties`` file to the ``/opt/mongodb/mms/conf`` directory
#    on Backup Daemon server. Create the directory if it does not exist.

# On servers that run the |onprem| Application, the installer preserves your existing
# ``conf-mms.properties`` configuration file and names the new configuration
# file ``conf-mms.properties.rpmnew``. Both are located in
# ``/opt/mongodb/mms/conf/``.

# On servers that run only the Backup Daemon, the installer creates the
# ``/opt/mongodb/mms/`` directory and creates the ``conf-mms.properties``
# configuration file in ``/opt/mongodb/mms/conf/``.
---
stepnum: 4
level: 4
source:
  file: steps-source-upgrade-onprem.yaml
  ref: start
---
stepnum: 5
level: 4
source:
  file: steps-source-upgrade-onprem.yaml
  ref: restart-ops-manager
---
stepnum: 6
level: 4
source:
  file: steps-source-upgrade-onprem.yaml
  ref: upgrade-install-agents
...
