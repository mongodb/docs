=======================
MMS Functional Overview
=======================

.. default-domain:: mongodb

Overview
--------

The MongoDB Management Service (MMS) is a service for monitoring and
backing up a MongoDB infrastructure.

MMS Monitoring
~~~~~~~~~~~~~~

MMS provides real-time reporting, visualization and alerting on key database and
hardware indicators and presents the data in an intuitive web dashboard.

A lightweight Monitoring Agent runs within your infrastructure and
connects to the configured MongoDB instances.  The Monitoring Agent
collect statistics from the nodes in your deployment and transmit it
back to MMS.  The MMS user interface allowsthe user to view the
visualized data and set alerts.

.. _mms-backup-functional-overview:

MMS Backup
~~~~~~~~~~

Engineered specifically for MongoDB, MMS Backup features scheduled
snapshots and point in time recovery. Once the service is up and running,
MMS provides a web interface to support backup and restoration. MMS
Backup supports horizontal scaling.

A lightweight Backup Agent runs within your infrastructure and connects to the
configured MongoDB instances. The agent performs an initial sync and then
tails the oplog of a :term:`replica setâ€™s <replica set>` :term:`primary`.
For a :term:`sharded cluster`, the
Backup Agent tails the primary of each shard and each config server. The
agent ships initial sync and oplog data over HTTPS back to the MMS Backup service.

The MMS Backup service recreates every replica set you backup and applies the
:term:`oplog` entries sent by the Backup Agents. MMS then maintains a standalone
MongoDB database on disk, also called a *head*, for each backed up replica
set. Each head is consistent with the original primary up to the last
oplog supplied by the agent. The initial sync and tailing of the oplog are
all done using standard MongoDB queries.

To backup a replica set, the Backup service uses a :program:`mongod` with
a version equal to or greater than the version of the replica set it backs up.

Operations
``````````

The MMS Backup service recreates every replica set you back up and
applies the oplog entries the Backup Agents send. The production
replica set, or sharded cluster, is not aware of the copy of the
backup data. The initial sync and tailing of the oplog are all done
using standard MongoDB queries.

The service takes scheduled snapshots of all heads and retains
those snapshots based on a user-defined policy. |backup| captures
snapshots of replica sets interval based on an observed change
in oplog time. Sharded clusters snapshots temporarily stop the
balancer via the :program:`mongos` so that they can insert a marker
token into all shards and config servers in the cluster. MMS takes a
snapshot when the marker tokens appear in the backup data.

Compression and block-level deduplication technology reduces snapshot data
size. The snapshot only stores the differences between successive snapshots.
Snapshots use only a fraction of the disk space required for full snapshots.

.. _restores:

Restores
````````

MMS Backup lets you restore data from a scheduled snapshot or from a
selected checkpoint or point in time between snapshots. Sharded clusters
use checkpoints, and replica sets use point-in-time restores.

When you restore from a snapshot, MMS reads directly from the Backup
Blockstore Database
and transfers files via an HTTPS download link (pull) or by the MMS
service sending files via SSH (push).

When you restore from checkpoint or point in time, MMS first creates a
local restore of a snapshot from the blockstore. MMS then applies stored
oplogs until the specified point. MMS delivers the backup via the same
HTTPS or SSH mechanisms.

.. only:: hosted

   The amount of oplog to keep per backup is configurable and affects the
   time window available for checkpoint and point-in-time restores.
