=====================
Using the MMS Console
=====================

This document provides a high level overview of the MMS web console
and describes the basic functionality. The best way to learn about
MMS's capabilities is to browse the interface with live data. For
additional documentation of the MMS console see the
":doc:`/monitoring/mms-console`" document . If you haven't done so already,
please :doc:`install the MMS agent </monitoring/install>` before proceeding.

Hosts
-----

The "Hosts" section is the primary location for monitoring information
in the MMS console. This tabbed interface provides access to all of
your monitored objects. The tabs you see depend on the types of
processes in your deployment. The tab:

- "**Hosts**" displays all non-arbiter ``mongod`` instances.

- "**Mongos**" displays all ``mongos`` instances.

- "**Conf**" displays all database configuration servers.

- "**Arbiters**" lists the ``mongod`` processes functioning as
  arbiters in replica sets.

- "**Agents**" lists the MMS agents attached to this MMS account.

The remaining "Host" section tabs contain information about the
monitoring process and environment. The tab:

- "**Agent Log**" displays a log of the MMS agent's activity.

- "**Pings**" provides access to the raw JSON document of the last 20
  pings sent to MMS by the agent.

.. index:: host aliases
   single: setting; host aliases

- "**Host Aliases**" shows the mapping between system hostnames and
  the names provided by the monitored process (e.g. ``mongod`` and
  ``mongos``.) In most cases, hosts are automatically aliased during
  auto-discovery. If needed, you may modify and configure the alias
  mapping in the "Settings" section of the console in the "Preferred
  Hostnames" section.

  .. note::

     When you add or update a "Preferred Hostname" value, this action
     resets all previous hostname aliases.

- "**CommandLine**" shows the run time configuration options set in
  the configuration file and on the command line for each host.

All of these interfaces, except for the Command Line, provide a search
field in the upper right corner to filter the lists in real time.

.. note::

   If you see a hostname in displayed in orange on the host page, this
   means that:

   - MMS has detected startup warnings for this host. You can
     see the warning in the last ping for the host.

   - MMS suspects that the host has a low ``ulimit`` setting that is
     less than ``1024``. MMS infers the host's ``ulimit`` setting
     using the total number of
     available and current connections.

   MMS outlines deactivated hosts in a brown box on the host
   page. If you have deactivated hosts, MMS will add a warning icon
   with a red border on the Hosts page.

   .. important:: If you have deactivated hosts, review all
      deactivated hosts to ensure that they are still in use, and
      remove all hosts that are not active. Then click on the
      *Reactivate All Hosts* button.

.. _host-views:

Host Views
~~~~~~~~~~

Each non-arbiter process in the "Hosts" section links to an overview
of the data collected for that process. On each of these pages, MMS
provides the following tabs:

- "**Stats**," which displays charts using data provided by the MMS
  agent. These charts display information about the ``mongod`` process
  itself.

- "**Hardware**," which displays information gathered about underlying
  system. To collect this information, you will need to install and
  run the ``munin-node`` software on the nodes running MongoDB.

  On Debian and Ubuntu systems, use the "``sudo apt-get install
  munin-node``" command. Red Hat, CentOS and Fedora users should issue
  the "``sudo yum install munin-node``" command.

  See the :ref:`installation documentation <mms-munin>` for
  more information.

- "**DB Stats**," which displays charts on a per-database basis. When
  you select the "DB Stats" tab, a drop down list appears on the tab
  that allows you to select a database. An "edit" button appears next
  in the tab that allows you to remove a database from the DB stats
  drop down after removing a database from MongoDB. It is impossible
  to delete a database from your instance using this interface.

  The DB Stats tab will not appear until approximately 30 minutes after you
  add the host to MMS. DB Stats information updates every 5 minutes,
  or less frequently to reduce the impact on the database. If the "DB
  stats" operation impacts the performance of your database, as is
  possible when installations have a large number of databases and
  collections, you may disable DB Stats collection from the settings
  interface.

- "**Last Ping**," which displays the raw JSON document sent by the
  agent to MMS.

- "**Daily Pings**," which displays the raw JSON content of the last
  ping for every day. This page displays pings from the last 20 days.

- "**Profile Data**," which displays information on performance
  gathered by the database profiler. See the section on :ref:`database
  profiling <db-profiling-section>` for more information.

- "**Notes**," which provides an interface for users to add
  descriptive notes regarding a host for future reference.

Host Groups
~~~~~~~~~~~

From the Hosts page, you can display groups of hosts in one view. By
following a link from the "Cluster" or "Repl Set" columns, you can see
a side-by-side comparison of charts from all hosts in a given cluster
or replica set.

.. index:: host labels

Host Labels
~~~~~~~~~~~

"Host Labels" provide a method to narrow the list of hosts in the MMS
display. This is particularly crucial if you monitor a large number of
hosts and want to access a more limited set of hosts.

A pencil icon on the "Hosts" tab itself opens a dialogue where you may
create a new host label. After adding the first label, a drop down box
appears where you can narrow the view by selecting a group.

To add hosts to a label or labels, click on the "Edit Host," button (a
pencil) in the left column in the host table. In the dialogue box that
returns, the third tab allows you to select or remove labels from this
host.

Hosts may belong to none, one, or multiple labels.

.. index:: removing hosts
.. index:: procedure; removing hosts
.. _removing-hosts:

Removing Hosts
~~~~~~~~~~~~~~

MMS cannot ignore any hosts added in the discovery process. You can
always manually delete a host from the MMS dashboard by clicking on
the trash icon on the far right of the host entry on the host page.
If you want to add monitoring for a host that you have deleted from
MMS, you must add this host manually using the "``+``" icon on the top
of the "Hosts" page.

.. index:: database profiling
.. _db-profiling-section:

DB Profiling
~~~~~~~~~~~~

MMS can collect data from MongoDB's profiler to provide statistics
about performance and database operations.

This data can include sensitive information, including the content of
database queries. Ensure that exposing this to MMS is consistent with
your information security practices. Additionally, be aware that the
profiler can consume resources which may adversely affect MongoDB
performance. Consider the implications before enabling profiling.

To allow MMS to collect profile data for a specific host, click the
"Enable profile data transmission," button, with a clock icon, in the
far right column of the host listing. It is the middle of the three
icons. This raises a dialogue box that describes the implications of
DB profiling and allows you to enable the transmission of the
profiling data to MMS.

.. note::

   The MMS agent attempts to minimize its effect on the monitored
   systems. If resource intensive operations, like polling profile
   data, begins to impact the performance of the database, MMS will
   throttle the frequency that it collects data. See the
   ":ref:`db-stats-warning`" section for more information about the
   agent's throttling process.

   When enabled, MMS samples profiling data from monitored
   instances: the agent only sends the most recent 20 entries from
   last minute.

When you select "Enable Profile Info Transmission," the agent will
begin sending profile data to MMS. All configuration changes made in
the MMS console can take up to 2 minutes to propagate to the agent and
another minute before profiling data appears in the MMS interface.

However, to begin collecting profile data you need to modify the value
of ``setProfilingLevel`` on the database itself. See the `database
profiler <http://www.mongodb.org/display/DOCS/Database+Profiler>`_
documentation for instructions for using the profiler. There is a link
at the bottom of the Host Statistics page that displays the profile
levels.

If you have profiling data, and wish to delete it from the system,
there is a button on the bottom of the "Profile Data" tab, that says
"Delete Profile Data." When you click on this button, the MMS Console
raises a confirmation dialogue. When you confirm, MMS will begin
removing stored profile data from this server's record.

.. note::

   If MMS is storing a large amount of profile data for your instance,
   the removal process will not be instantaneous.

Agents
~~~~~~

The agents tab of the host's section, contains information about the
deployed agents, and has the following fields:

- **Hostname:** the name of the host running the agent.

- **Address:** the IP address of the address running the agent.

- **Hosts:** the number of MongoDB instances this agent monitors.

- **Ping Count:** the number of pings (i.e. data payloads) sent by the
  agent since midnight GMT. Typically agents send pings every minute.

- **Conf Count:** the number of configuration requests sent by the
  agent since midnight GMT. Typically agents request configuration
  updates every two minutes.

- **Version:** the version of the agent software running on this agent
  instance.

- **Last Ping:** the last time this agent sent a ping to the MMS servers.

- **Last Conf:** the last time the agent made a configuration request
  of the MMS servers.

Remember, if you have more than one agent, only one agent actively
monitors MongoDB instances at once. See
:ref:`deploy-monitoring-architecture` for more information.

.. index:: alerts; events

Events
------

The "Events" section relays information about the MMS agent's
operations. Possible event types are:

- "**new host**" occurs when the agent identifies a new MongoDB host.

- "**restart**" occurs when a ``mongod`` or other monitored
  instance restarts.

- "**upgrade**" occurs after upgrading ``mongod`` to a new
  version.

- "**now secondary**" occurs when a ``mongod`` instance becomes
  secondary in a replica set.

- "**now primary**" occurs when a ``mongod`` instance becomes
  primary in a replica set.

.. index:: alerts

Alerts
------

The "Alerts" section provides access to MMS's alert system. This
section has three tabs: unresolved alerts, resolved alerts, and alert
settings. Following the installation of your first MMS agent, the
system configures an alert to send an email when the agent is
down. You can delete or modify this alert as you like.

.. index:: alerts; types

Types
~~~~~

.. only:: saas

   There are three possible alert types:

   - "**Old Host Version**" activates in response to ``mongod`` running
     an out of date version of MongoDB.

   - "**Host Down**" activates in response to a ``mongod`` or other
     monitored instance restarts or fails to check in to MMS within 9
     minutes. There are no "host down" alerts if the agent is down.

   - "**Agent Down**" activates in response to an agent that fails to
     report to MMS within 8 minutes.

   - "**Host Recovering**" activates when a replica set member enters
     ``RECOVERING`` status.

   - "**Metric Min/Max Value**" activates when a monitored metric
     passes a specified threshold.

.. only:: hosted

   There are two possible alert types:

   - "**Host Down**" activates int response to a ``mongod`` or other
     monitored instance restarts or fails to check in to MMS within 5
     minutes. There are no "host down" alerts if the agent is down.

   - "**Agent Down**" activates in response to an agent that fails to
     report to MMS within 5 minutes.

   - "**Host Recovering**" activates when a replica set member enters
     ``RECOVERING`` status.

   - "**Metric Min/Max Value**" activates when a monitored metric
     passes a specified threshold.

MMS will add additional alert types in the near future.

.. index:: alerts; notifications

Configuring Notifications
~~~~~~~~~~~~~~~~~~~~~~~~~

You can create notifications for any of the above alert types. Click on
the plus sign (e.g. ``+``) next to the word "Alerts" at the top of
these pages. This will raise a dialogue where you can create email or SMS
alerts for any of these event types.

You can configure the following options:

For all Alerts Except *Metric Min/Max Value*
````````````````````````````````````````````

- **Address** specifies an address to send alert emails. For SMS
  alerts specify the telephone number that will receive the alert.

  .. warning::

     Telephone numbers are not validated or checked, and users must
     ensure that they have entered the correct number into the Alerts
     interface.

- **Type** to select from text email, HTML formatted email, and SMS
  alerts.

- **Frequency Config (minutes)** to select how often to send alerts,
  in minutes.

- **Minimum Time Before Notification** specifies how long MMS will
  wait before sending a notification. Raising this value will increase
  the amount of time between the identification of an issue and the
  alert, but it may reduce potential false positives.

  You may also create multiple alerts with different minimum times
  before notification to implement alert escalation.

  .. important:: The time between re-notifications increases by the
     frequency amount every alert cycle (e.g. 5 minutes, 10 minutes,
     15 minutes, 20 minutes.)

For *Metric Min/Max Value* Alerts
`````````````````````````````````

- **Host Type** specifies the kind of monitored host. Options include:
  *standalone*, *primary*, *secondary*, *mongos*, *conf*, *master*,
  *slave*, and *individual/specific host*.

- **Replica Set** specifies a monitored replica set to include in the alert.

- **Field** specifies the metric to use in the alert.

- **Alert Value** specifies the alert threshold. Use the toggles in
  this field to select *greater than* or *less than* and *avg per
  second* or *total per epoch*.

- **Contact Type** specifies the method of contact. Select from text
  email, HTML formatted email, and SMS alert.

- **Contact Frequency Config (minutes)** to select how often to send
  alerts, in minutes.

- **Contact Min Time Before Notification** specifies how long MMS will
  wait before sending a notification. Raising this value will increase
  the amount of time between the identification of an issue and the
  alert, but it may reduce potential false positives.

  You may also create multiple alerts with different minimum times
  before notification to implement alert escalation.

  .. important:: The time between re-notifications increases by the
     frequency amount every alert cycle (e.g. 5 minutes, 10 minutes,
     15 minutes, 20 minutes.)

.. index:: alerts; unresolved

Unresolved Alerts
~~~~~~~~~~~~~~~~~

The "Unresolved" tab displays a list of all monitored instances that
have current unresolved alerts. Check this tab to make sure that there
are no outstanding alerts.

.. index:: alerts; resolved

Resolved Alerts
~~~~~~~~~~~~~~~

The "Resolved" tab displays a record of all historical alerts. Use
this tab as a record of past activity.

.. index:: alerts; setting
   single: setting; alerts

Alert Settings
~~~~~~~~~~~~~~

The "Settings" tab provides an interface for configuring alerts. Using
the function buttons in the right hand column you can delete and
disable existing alerts.

Next Steps
----------

The MMS web console contains a great deal of functionality beyond the
scope of this overview. Continue to explore the functionality
addressed above in your own system, with your own data. The
":doc:`/monitoring/mms-console`" document provides a deeper exploration of key
usage patterns for the MMS console.
