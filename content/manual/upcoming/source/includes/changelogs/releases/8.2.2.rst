.. _8.2.2-changelog:

8.2.2 Changelog
---------------

Sharding
~~~~~~~~

:issue:`SERVER-106590` moveChunk and movePrimary lock contention during
critical section

Query
~~~~~

- :issue:`SERVER-110916` Use-after-move in
  targetShardsAndAddMergeCursors()
- :issue:`SERVER-112127` Fix ambiguous hash value handling in FieldPath

Storage
~~~~~~~

:issue:`WT-15608` Aggregated timestamp validation can fail with a 0
timestamped page deleted structure

WiredTiger
``````````

- :issue:`WT-14034` Fix resolving the prepared key multiple times
  because of reserved updates
- :issue:`WT-15088` Commit may be rolled back after we have logged the
  transaction
- :issue:`WT-15168` Understand empty "extractor" configuration strings
- :issue:`WT-15210` Change eviction to scrub eviction when the cache
  usage is less than eviction target
- :issue:`WT-15455` Don't skip prepared update pages during cursor walk
- :issue:`WT-15477` Track eviction max stats per database run
- :issue:`WT-15548` Disable checkpoint_cleanup config in test/format if
  all related options are off
- :issue:`WT-15563` Investigate making cache tolerant to change app
  step-wise eviction to incremental eviction
- :issue:`WT-15736` Split "maximum page size seen at eviction" to 3
  seperate statistics

Build and Packaging
~~~~~~~~~~~~~~~~~~~

:issue:`SERVER-111406` Change Stream breaks on document with top-level
$v

Internals
~~~~~~~~~

- :issue:`SERVER-93265` Support Windows resource file generation (.rc
  files) in Bazel
- :issue:`SERVER-95570` BatchedDeleteStage can sometimes find the record
  it is deleting twice
- :issue:`SERVER-95726` Time-series meta-only delete and update should
  respect control.closed
- :issue:`SERVER-99623` High CPU usage in range deleter service
- :issue:`SERVER-103774` Disallow compound wildcard indexes from being
  used as a shard key index
- :issue:`SERVER-103807` Slow query
  timeWaitingMicros.storageExecutionMicros accumulates across sessions
- :issue:`SERVER-103855` Add serverStatus metrics about logging
- :issue:`SERVER-104007` Track delinquent interrupt checks
- :issue:`SERVER-105047` Query using $or and $ne on sharded collection
  can include orphan documents
- :issue:`SERVER-106162` [test-only] Reevaluate ignoring write concern
  errors in drop FSM state
- :issue:`SERVER-106854` Timeseries reopen verification function does
  not properly handle meta in different order
- :issue:`SERVER-106908` Enable ingress request rate limiting by default
- :issue:`SERVER-107161` Make ftdc async test resilient to collector
  timeouts
- :issue:`SERVER-107532` Ensure new Mongo shell connection creation
  returns informative error code
- :issue:`SERVER-107546` Dump global WT state if too many write
  conflicts are hit in a row for the same transaction
- :issue:`SERVER-107837` In SBE spilling replace tassert with uassert
- :issue:`SERVER-107873` Report number of Queryable Encryption
  collections using each index type in serverStatus
- :issue:`SERVER-107973` [8.2] Revert SERVER-107176: "Introduce
  placeholder configureBackgroundTask command"
- :issue:`SERVER-108002` replayWorkloadRecordingFile should not
  terminate mongo on failure
- :issue:`SERVER-108016` Update additional assertions in
  RateLimitIsValidAfterQueueing for slow machines
- :issue:`SERVER-108040` Update markFailed to check current step
- :issue:`SERVER-108052` DocumentSourceInternalSetWindowFields doesn't
  have sort key metadata in bounded sorts
- :issue:`SERVER-108318` Introduce new error label indicating a failure
  is unconditionally retryable
- :issue:`SERVER-108364` local.replset.minvalid writes are untimestamped
  but may fail if encountering a timestamped entry in the ident
  beforehand
- :issue:`SERVER-108366` Prepared Transactions with apiVersion
- :issue:`SERVER-108547` configure retry attempts for
  evergreen_activate_gen_tasks.py
- :issue:`SERVER-108581` Find query remaining time is calculated
  incorrectly in mongos
- :issue:`SERVER-108626` Coverity analysis defect 156320: Uninitialized
  scalar field
- :issue:`SERVER-108723` Coverity analysis defect 155003: Data race
  condition
- :issue:`SERVER-108916` Remove PGO/BOLT builds from 8.2
- :issue:`SERVER-108945` Handle $elemMatch with empty path under a
  contained $or correctly
- :issue:`SERVER-109003` Mark write_without_shard_key_with_moveChunk.js
  and timeseries_list_catalog.js with 'requires_getmore'
- :issue:`SERVER-109033` Coverity analysis defect 152012: Double lock
- :issue:`SERVER-109137` Calculation of expireAt in QueryAnalysisWriter
  can hit integer overflow
- :issue:`SERVER-109213` Increase logging when index bounds are deemed
  invalid
- :issue:`SERVER-109276` KVDropPendingIdentReaper::dropIdentsOlderThan
  should check for interrupt
- :issue:`SERVER-109299` Allow ExceededTimeLimit error for update
  operations in refine_collection_shard_key_nested_crud_ops.js
- :issue:`SERVER-109355` Reconcile pins only after reopening
  CollectionCatalog in RTS
- :issue:`SERVER-109490` Rank fusion tests share collections and search
  indexes, causing flaky tests
- :issue:`SERVER-109493` Disable "uncaught exception in noexcept"
  Coverity check
- :issue:`SERVER-109515` Disable oidc_e2e_azure_machine tests
- :issue:`SERVER-109541` Coverity analysis defect 149896: Data race
  condition
- :issue:`SERVER-109677` Destroy PinnedConnectionTaskExecutor before
  shutting down the underlying executor
- :issue:`SERVER-109836` Add BES evergreen variables in Server that are
  currently present in MMS
- :issue:`SERVER-109937` Change the default of
  skipAuthenticationToSearchIndexManagementServer to false for Community
  Server and Enterprise Server
- :issue:`SERVER-110083` Remove the change_stream_serverless_fuzzer
  tasks
- :issue:`SERVER-110118` Coverity analysis defect 176650: Using a moved
  object
- :issue:`SERVER-110184` Fix
  command_registration_startup_behavior_fcv.js now that command registry
  properly works on older versions
- :issue:`SERVER-110215` Add retry mechanism to
  test_api_version_compatibility task
- :issue:`SERVER-110254` Support swapping $match before "complex
  renames" when a flag says there are no arrays
- :issue:`SERVER-110291` Add serverStatus metric for spill engine
  sessions
- :issue:`SERVER-110345` config.rangeDeletions docs for uncompleted
  range deletion tasks could get deleted due to non-exact delete filter
- :issue:`SERVER-110423` $group can use a distinct scan on a sparse
  index, which hides null/missing results
- :issue:`SERVER-110425` Develop and add an Evergreen task to upload
  SBOM to Kondukto using SilkBomb for master, v7.0, v8.0, v8.1, v8.2
- :issue:`SERVER-110480` Add core_analyzer_distro_name to s390x/ppc
  variants
- :issue:`SERVER-110716` Authenticate before issuing getParameter in
  commands_lib.js
- :issue:`SERVER-110845` Use deleteMany instead of drop in
  index_key_expression.js
- :issue:`SERVER-110890` Coverity analysis defect 175049: Logically dead
  code
- :issue:`SERVER-110953` Check no orphaned document is present on a
  recipient shard before starting cloning a range
- :issue:`SERVER-111058` Fix throw_hook configuration locking
- :issue:`SERVER-111131` Create a metric to track delayed FTDC
  collections
- :issue:`SERVER-111135` Retry configureFailPoint in rollback_test.js
- :issue:`SERVER-111139` Prepend all calls to RateLimiter's token bucket
  with proper mutex acquisition
- :issue:`SERVER-111245` Coverity analysis defect 176940: Dereference of
  potentially null field
- :issue:`SERVER-111295` Python code is not getting formatted by Ruff
- :issue:`SERVER-111349` Rewrite RateLimitIsValidAfterQueueing unit test
- :issue:`SERVER-111427` Load SASL before locking code pages
- :issue:`SERVER-111460` Pin code pages for mongos
- :issue:`SERVER-111486` $group can still use a distinct scan on a
  sparse index if an alternative index is available
- :issue:`SERVER-111610` Add delays in
  ocsf_audit_remote_local_intermediate.js
- :issue:`SERVER-111794` Add ddlLockOptimisticRecoveryWaitTimeout
  parameter
- :issue:`SERVER-111914` Client-based rate limiting exemption
- :issue:`SERVER-112035` Downgrade proxy protocol disconnected to INFO
- :issue:`SERVER-112117` Make oplog sampling yield and lock-free
- :issue:`SERVER-112118` Track and log how long it takes oplog sampling
  to stop after its been interrupted
- :issue:`SERVER-112119` Fix
  check_async_oplog_samping_truncates_new_writes.js to hang during
  initial sampling, not after
- :issue:`SERVER-112120` Test that async oplog sampling doesn't block
  operations after startup
- :issue:`SERVER-112121` Test that async oplog sampling doesn't block
  rollback-to-stable
- :issue:`SERVER-112122` Test that async oplog sampling doesn't block
  FCBIS
- :issue:`SERVER-112123` Test that async oplog sampling doesn't block
  replica set initialization and reconfiguration
- :issue:`SERVER-112124` Test that async oplog sampling doesn't block
  shutdown
- :issue:`SERVER-112182` Create a testing server parameter to simulate
  oplog slowness
- :issue:`SERVER-112183` Start async oplog sampling towards the end of
  startup
- :issue:`SERVER-112229` backport gitignore for new auto_header tool
- :issue:`SERVER-112419` [v8.2] Prepare oplog sampling 8.2 branch for
  release
- :issue:`SERVER-112429` Make SBE hash lookup tests more efficient
- :issue:`SERVER-112467` Track and report the number of pending proxy
  connections
- :issue:`SERVER-112520` Failure to write to geo index when inserting a
  document to timeseries existing bucket
- :issue:`SERVER-112541` Show throughput in oplog sampling/scanning logs
- :issue:`SERVER-112810` Fix error code in
  ingress_request_rate_limiter_app_exemption.js
- :issue:`SERVER-112846` Change in repl set reconfigure test

