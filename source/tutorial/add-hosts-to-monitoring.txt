.. _tutorial-monitoring:

===========================
Add Hosts to MMS Monitoring
===========================

.. default-domain:: mongodb

Overview
--------

You can monitor existing MongoDB deployments in MMS by adding the hosts and
ports of the deployments to MMS. MMS will start monitoring the
:program:`mongod` and :program:`mongos` instances on the added hosts.

If you add hosts in an environment that uses authentication, you must add each
host separately. You must explicitly set the authentication credentials on
each :program:`mongod` instance.

If you add hosts to MMS Monitoring in an environment that does *not* use
authentication, you can manually add one host from a replica set or a sharded
cluster as a seed. Once the Monitoring Agent has the seed host, it
automatically discovers all other nodes in the replica set or sharded cluster
based on the current replica set or cluster configuration. For details, see
:ref:`host-discovery-without-auth`.

Considerations
--------------

Unique Replica Set Names
~~~~~~~~~~~~~~~~~~~~~~~~

Do not add two different replica sets with the same name. MMS uses the replica
set name to identify which set a member belongs to.

Preferred Hostnames
~~~~~~~~~~~~~~~~~~~

If the host is accessible only by specific hostname or IP address, or
you need to specify the hostname to use for servers with multiple aliases, set up a
preferred hostname. For details, see the :guilabel:`Preferred Hostnames`
setting in :doc:`/core/settings`.

.. _host-discovery-without-auth:

Host Discovery in Environments without Authentication
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Once the Monitoring Agent has a seed host it discovers all other nodes
in the replica set or sharded cluster. These clusters, and their respective
seed hosts, include:

- Master databases, after adding slave databases.

- Shard clusters, after adding ``mongos`` instances.

- Replica sets, after adding any member of the set.

Once you add these seed nodes, the Monitoring Agent will fetch this
information *from* the MMS servers. Thus, when configuring the
monitoring environment, you may need to wait for several update cycles
(e.g. 5-10 minutes) to complete the auto-discovery process and host
identification. During this period, you may see duplicate hosts in the
MMS web console. This is normal.

The Monitoring Agent fetches configuration and reports to |monitoring| every
minute, so, again, there may be a delay of several minutes before data
and host information propagate to the MMS console.

.. index:: adding hosts
   single: hosts; adding

Add Hosts
---------

If your deployments use authentication, perform this procedure for each host.
If your deployment does not use authentication, add one host from a replica
set or sharded cluster and MMS will discover the other nodes in the replica
set or sharded cluster.

.. include:: /includes/steps/add-host.rst

.. index:: host discovery
   single: hosts; discovery

Additional Information
----------------------

:doc:`/tutorial/nav/manage-hosts`
