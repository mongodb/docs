=================================
Prepare Backing MongoDB Instances
=================================

.. default-domain:: mongodb

Overview
--------

Backing MongoDB instances are dedicated :term:`replica sets <replica set>`
that store data to support |onprem| operations and **store no other
data**. |onprem| requires a separate backing replica set for each of the
two backing databases: the :ref:`mms-application-database` and the
:ref:`mms-backup-blockstore-database`.

A backing MongoDB replica set:

- Stores data in support of |onprem| operations and **stores no other data**.

- Must run MongoDB 2.4.9 or later.

- Must have the MongoDB ``security.javascriptEnabled`` set to ``true``, which
  is the default. The |application| uses the :query:`$where` query and
  requires this setting be enabled on the |application| database.

- Must **not** run the MongoDB ``notablescan`` option.

Prerequisites
-------------

Deploy servers that meet the requirements described here.

.. important::

   Deploy servers that comply with the :manual:`Production Notes
   </administration/production-notes>` in the MongoDB manual.

If a server hosts |onprem| components as well as a member of the backing
replica set, you must sum the :doc:`hardware requirements
</core/requirements>` for each component to determine the requirements for
the server.

Ensure that firewall rules allow access to the :doc:`ports
</reference/on-prem>` that the instances runs on.

Configure as many servers as needed for your deployment. As needs change,
you can later add capacity by provisioning additional backing servers.

|application| Database Hardware
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/requirements-application-database.rst

|onprem| Backup Blockstore Database Hardware
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/requirements-backup-blockstore-database.rst

Procedure
---------

Do **not** use MongoDB instances that store other data.

Install MongoDB
~~~~~~~~~~~~~~~

Install MongoDB on each server. See :manual:`Install MongoDB </installation/>`
in the MongoDB manual.

Deploy the Replica Sets
~~~~~~~~~~~~~~~~~~~~~~~

Deploy a replica set for each database using the :manual:`Deploy a Replica
Set </tutorial/deploy-replica-set>` procedure in the MongoDB manual.
