.. _conf-mms.properties:

======================
|onprem| Configuration
======================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: twocols

|onprem| stores configuration settings both globally in the
|application| Database and locally on each server. Global settings
apply to all your |onprem| servers. Local settings apply to the server
on which they are configured. Any local settings on a server override
the global settings.

You configure global settings through the |onprem| interface during
installation. You can edit global settings at any time through the
:guilabel:`Admin` interface by clicking the :guilabel:`General` tab and
then clicking :guilabel:`Ops Manager Config`.

You configure local settings through a server's ``conf-mms.properties``
file. Each server's ``conf-mms.properties`` must contain the connection
string and authentication settings for accessing the |onprem|
Application Database. The ``conf-mms.properties`` file also contains
any overrides of global settings specific to that server.

The location of the ``conf-mms.properties`` file depends on how you
installed |onprem|, as described in the table below.

.. list-table::
   :widths: 35 65
   :header-rows: 1

   * - Install method

     - ``conf-mms.properties`` location

   * - ``rpm`` or ``deb`` package

     - ``/opt/mongodb/mms/conf/``

   * - ``tar.gz`` archive

     - ``<install-directory>/conf/``

   * - ``msi`` file (Windows)

     - ``<install-folder>\Server\Config``

       By default, this is: ``C:\MMSData\Server\Config``.

Bypass Initial Configuration via the User Interface
---------------------------------------------------

If you would like to skip the initial setup wizard after creating the 
first account and either edit the ``conf-mms.properties`` file or use 
the API to configure |onprem|, change the following settings. This 
setting can help if you are automating the deployment of |onprem| 
instances.

.. setting:: mms.ignoreInitialUiSetup

   *Type*: boolean

   Set this to ``true`` to allow full use of |onprem| without 
   requiring the first user account to complete the initial setup 
   wizard.

   .. warning::

      |onprem| performs its regular pre-flight check to verify that it
      has all of the required settings. If one or more of those
      settings are not included in ``conf-mms.properties``, |onprem|
      refuses to start and lists which fields are missing in
      the log file.

   Before starting |onprem|, add the following required settings to 
   ``conf-mms.properties`` to enable basic |onprem| functionality:

   .. list-table::
      :widths: 40 40 20
      :header-rows: 1

      * - UI Setting
        - ``conf-mms.properties`` Setting
        - Required
      * - :setting:`URL to Access Ops Manager`
        - ``mms.centralUrl``
        - Required
      * - None
        - :setting:`mongo.mongoUri`
        - Required
      * - :setting:`Client Certificate Mode`
        - ``mms.https.ClientCertificateMode``
        - Required
      * - :setting:`"From" Email Address <From Email Address>`
        - ``mms.fromEmailAddr``
        - Required
      * - :setting:`"Reply To" Email Address <Reply To Email Address>`
        - ``mms.replyToEmailAddr``
        - Required
      * - :setting:`Admin Email Address`
        - ``mms.adminEmailAddr``
        - Required
      * - :setting:`Email Delivery Method Configuration`
        - ``mms.emailDaoClass``
        - Required
      * - :setting:`Transport`
        - ``mms.mail.transport``
        - Required
      * - :setting:`SMTP Server Hostname`
        - ``mms.mail.hostname``
        - Required
      * - :setting:`SMTP Server Port`
        - ``mms.mail.port``
        - Required
      * - :setting:`User Authentication Method`
        - ``mms.userSvcClass``
        - Optional
      * - :setting:`Snapshot Interval`
        - ``brs.snapshotSchedule.interval``
        - Optional
      * - :setting:`Base Retention of Snapshots`
        - ``brs.snapshotSchedule.retention.base``
        - Optional
      * - :setting:`Daily Retention of Snapshots`
        - ``brs.snapshotSchedule.retention.daily``
        - Optional
      * - :setting:`Weekly Retention of Snapshots`
        - ``brs.snapshotSchedule.retention.weekly``
        - Optional
      * - :setting:`Monthly Retention of Snapshots`
        - ``brs.snapshotSchedule.retention.monthly``
        - Optional
      * - :setting:`Versions Directory`
        - ``automation.versions.directory``
        - Optional

   .. note::

      Fields marked as *Optional* have default values. If you want to change
      them, you can provide the setting a nd a new value.

   .. example::

      To configure |a-mms| installation with the minimum functionality, 
      add the following settings to ``conf-mms.properties``:

      .. code-block:: ini
         :class: copyable-code

         mms.ignoreInitialUiSetup=true
         mongo.mongoUri=mongodb://db1.example.com:27017,db2.example.com:27017,db3.example.com:27017
         mms.centralUrl=http://localhost:8080
         mms.fromEmailAddr=example@example.com
         mms.replyToEmailAddr=example@example.com
         mms.adminEmailAddr=example@example.com
         mms.mail.transport=smtps
         mms.mail.hostname=mail.example.com
         mms.mail.port=465

      The values are examples. Substitute values appropriate to your 
      |onprem| installation. You may add any of the other settings 
      specified in this reference. 

Web Server Settings
-------------------

Configure global settings through the :guilabel:`Admin` interface.
|onprem| stores global settings in the |application| database.

.. setting:: URL to Access Ops Manager

   *Type*: string

   The fully qualified URL and port number of the |application|. For
   example:

   .. code-block:: ini

      http://mms.example.com:8080

   To use a port other than ``8080``, see :doc:`/tutorial/manage-ports`.

   Corresponds to configuration file setting: ``mms.centralUrl``

.. setting:: HTTPS PEM Key File

   *Type*: string

   Absolute path to the PEM file that contains the |application|'s
   valid certificate and private key. The PEM file is required if the
   |application| will use HTTPS to encrypt connections between the
   |application|, the agents, and the web interface.

   The default port for HTTPS access to the |application| is ``8443``,
   as set in ``<install_dir>/conf/mms.conf`` file. If you change this
   default, you must also change the port specified in the
   :setting:`URL to Access Ops Manager` setting.

   Corresponds to configuration file setting: ``mms.https.PEMKeyFile``

.. setting:: HTTPS PEM Key File Password

   *Type*: string

   The password for the HTTPS PEM key file. This is required if the PEM
   file contains an encrypted private key. If storing this in the
   :ref:`conf-mms.properties <conf-mms.properties>` file, you can
   encrypt the password using the |onprem| ``credentialstool``. See
   :ref:`encrypt-mongodb-user-credentials`.

   Corresponds to configuration file setting: ``mms.https.PEMKeyFilePassword``

.. setting:: Client Certificate Mode

   *Type*: string

   Specifies the how many SSL certificates are required for
   transactions between |mms| and clients. Accepted values are:

   .. list-table::
      :header-rows: 1
      :stub-columns: 1

      * - UI
        - ``conf-mms.properties``
      * - None
        - ``none``
      * - Required for Agents Only
        - ``agents_only``
      * - Required for All Requests
        - ``required``

   Corresponds to configuration file setting: ``mms.https.ClientCertificateMode``

.. setting:: CA File

   *Type*: string

   Specifies the filesystem location of a certificate authority file
   containing the list of acceptable client certificates.

   .. code-block:: ini

      /path/to/ca_file.pem

   Corresponds to configuration file setting: ``mms.https.CAFile``

   .. cond:: onprem

      .. note::

         If you want to use a private certificate authority, you must
         add ``mms.https.CAFile`` as a custom property on the
         :guilabel:`Custom` tab of the |mms| Config page in the
         **Admin** interface.

.. setting:: Load Balancer Remote IP Header

   *Type*: string

   If you use a load balancer with the |application|, set this to the
   |http| header field the load balancer uses to identify the
   originating client's IP address to the |onprem| host. When you
   specify :setting:`Load Balancer Remote IP Header`, do not allow
   clients to connect directly to any |onprem| host. A load
   balancer placed in front of the |onprem| hosts must not
   return cached content.

   Once :setting:`Load Balancer Remote IP Header` is set, |onprem|
   enables the following |http| headers:

   .. list-table::
      :widths: 30 70
      :header-rows: 1

      * - |http| Header
        - Forwards to |mms|

      * - :rfc:`X-Forwarded-Host <7239#section-5.3>`
        - Original host that the client requested in the Host |http|
          request header.

      * - :rfc:`X-Forwarded-Proto <7239#section-5.4>`
        - Protocol used to make the |http| request.

      * - `X-Forwarded-Server <https://www.eclipse.org/jetty/javadoc/current/org/eclipse/jetty/server/ForwardedRequestCustomizer.html>`__
        - Hostname of the proxy server.

      * - `X-Proxied-Https <https://www.eclipse.org/jetty/javadoc/current/org/eclipse/jetty/server/ForwardedRequestCustomizer.html>`__
        - |https| status of a request.


   To learn more, see
   :doc:`/tutorial/configure-application-high-availability`.

   Corresponds to configuration file setting: ``mms.remoteIp.header``

.. setting:: mms.minimumTLSVersion

   *Type*: string

   Specifies the TLS version required for clients to connect to |mms|.
   This property affects all clients, such as browsers used
   to connect to the |mms| ``Admin`` interface and command-line tools,
   such as curl, used to connect to the REST API. The following values 
   are accepted:

   * TLSv1

   * TLSv1.1

   * TLSv1.2 (default)

   .. note::

      TLSv1.2 requires connecting clients to meet the following minimum
      requirements:

      * Browser supports TLS version 1.2

      * ``curl`` version 7.34.0+

      * OpenSSL version 1.0.1+

   To set :setting:`minimum.TLSVersion`, click :guilabel:`Config` and 
   then click the :guilabel:`Custom` tab.

.. setting:: mms.disableCiphers

   *Type*: string

   Specifies a list of TLS cipher suites which your instance of |mms| will 
   not accept when clients connect to the |application| and API. Specify 
   TLS cipher suite names as a comma-separated list, as in the following 
   example:

   .. code-block:: ini

      mms.disableCiphers = TLS_DHE_RSA_WITH_3DES_EDE_CBC_SHA, TLS_DHE_RSA_WITH_AES_256_CBC_SHA256

   .. important::
      Cipher suite names used in |mms| must follow `RFC 5246 
      <https://tools.ietf.org/html/rfc5246#appendix-C>`_  naming
      conventions. Do not use the OpenSSL naming convention. For 
      convenience, Ops Manager logs a list of all supported cipher suite 
      names during startup. If Ops Manager does not recognize a TLS 
      cipher suite name, it logs the following warning:

        Your config lists the following as ciphers which should be 
        disabled. However, they are not recognised by the JDK. Please 
        check the format of the entries and list of enabled ciphers. 
        [*unrecognized_cipher_name*]
      
  
   To set :setting:`mms.disableCiphers`, click :guilabel:`Config` and 
   then click the :guilabel:`Custom` tab.

.. _email-address-settings:

Email Settings
--------------

The following email address settings are mandatory. You **must** define
these settings before you can use the |application|.

.. setting:: From Email Address

   *Type*: string

   The email address used for sending the general emails, such as
   |onprem| alerts. You can include an alias with the email address.

   .. code-block:: ini

      Ops Manager Alerts <mms-alerts@example.com>

   Corresponds to configuration file setting: ``mms.fromEmailAddr``

.. setting:: Reply To Email Address

   *Type*: string

   The email address from which to send replies to general emails.

   Corresponds to configuration file setting: ``mms.replyToEmailAddr``

.. setting:: Admin Email Address

   *Type*: string

   The email address of the |onprem| admin. This address receives
   emails related to problems with |onprem|.

   Corresponds to configuration file setting: ``mms.adminEmailAddr``

.. setting:: Email Delivery Method Configuration

   *Type*: string

   The email interface to use.

   This setting is labeled in different ways for the user interface 
   and the configuration file.

   .. list-table::
      :widths: 20 20 60
      :header-rows: 1

      * - Delivery Method 
        - UI Setting
        - Configuration Setting (``mms.emailDaoClass``)

      * - :abbr:`AWS (Amazon Web Services)` :abbr:`SES (Simple Email Service)`
        - :abbr:`AWS (Amazon Web Services)` Simple Email Service
        - ``com.xgen.svc.core.dao.email.AwsEmailDao``.
      * - :abbr:`SMTP (Simple Mail Transfer Protocol)`
        - :abbr:`SMTP (Simple Mail Transfer Protocol)` Email Server
        - ``com.xgen.svc.core.dao.email.JavaEmailDao``

   Corresponds to configuration file setting: ``mms.emailDaoClass``

   If you set this to :abbr:`AWS (Amazon Web Services)` Simple Email 
   Service, you must set:

   .. list-table::
      :widths: 40 60
      :header-rows: 1

      * - UI Setting
        - Configuration File Setting

      * - :setting:`AWS Endpoint`
        - ``aws.ses.endpoint``

      * - :setting:`AWS Access Key`
        - ``aws.accesskey``

      * - :setting:`AWS Secret Key`
        - ``aws.accesskey``

   If you set this to :abbr:`SMTP (Simple Mail Transfer Protocol)` 
   Email Server, you must set:

   .. list-table::
      :widths: 40 60
      :header-rows: 1

      * - UI Setting
        - Configuration File Setting

      * - :setting:`Transport`
        - ``mms.mail.transport``

      * - :setting:`SMTP Server Hostname`
        - ``mms.mail.hostname``

      * - :setting:`SMTP Server Port`
        - ``mms.mail.port``

      * - :setting:`Username`
        - ``mms.mail.username``

      * - :setting:`Password`
        - ``mms.mail.password``

      * - :setting:`Use SSL`
        - ``mms.mail.tls``

:abbr:`SMTP (Simple Mail Transfer Protocol)` Email Server Settings
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

*Conditional. These settings appear if * 
:setting:`Email Delivery Method Configuration` 
*is* ``SMTP Email Server`` *.* 

.. setting:: Transport

   *Type*: string

   *Default*: smtp

   The transfer protocol your email provider specifies:

   - ``smtp`` (standard :abbr:`SMTP (Simple Mail Transfer Protocol)`) 
   - ``smtps`` (secure :abbr:`SMTP (Simple Mail Transfer Protocol)`)

   Corresponds to configuration file setting: ``mms.mail.transport``

.. setting:: SMTP Server Hostname

   *Type*: string

   *Default*: localhost

   Email hostname your email provider specifies. 

   .. code-block:: ini

      mail.example.com

   Corresponds to configuration file setting: ``mms.mail.hostname``

.. setting:: SMTP Server Port

   *Type*: number

   *Default*: 25

   Port number for :abbr:`SMTP (Simple Mail Transfer Protocol)` your 
   email provider specifies.

   Corresponds to configuration file setting: ``mms.mail.port``

.. setting:: Username

   *Type*: string

   User name of the email account. If unset, defaults to disabled 
   :abbr:`SMTP (Simple Mail Transfer Protocol)` authentication.

   Corresponds to configuration file setting: ``mms.mail.username``

.. setting:: Password

   *Type*: string

   Password for the email account. If unset, defaults to disabled 
   :abbr:`SMTP (Simple Mail Transfer Protocol)` authentication.

   Corresponds to configuration file setting: ``mms.mail.password``

.. setting:: Use SSL

   *Type*: boolean

   *Default*: false

   Set this to ``true`` if the transfer protocol uses |tls-ssl|.

   Corresponds to configuration file setting: ``mms.mail.tls``

:abbr:`AWS (Amazon Web Services)` Simple Email Service Settings
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

*Conditional. These settings appear if* 
:setting:`Email Delivery Method Configuration` 
*is* ``AWS Simple Email Service`` *.* 

.. setting:: AWS Endpoint

   *Type*: string

   *Default*: https://email.us-east-1.amazonaws.com

   Sets the `sending API endpoint <https://docs.aws.amazon.com/ses/latest/DeveloperGuide/regions.html#region-endpoints>`_ for the 
   :abbr:`AWS (Amazon Web Services)` 
   :abbr:`SES (Simple Email Service)`.

   Corresponds to configuration file setting: ``aws.ses.endpoint``

.. setting:: AWS Access Key

   *Type*: string

   The access key ID for :abbr:`AWS (Amazon Web Services)`.

   Corresponds to configuration file setting: ``aws.accesskey``

.. setting:: AWS Secret Key

   *Type*: string

   The secret access key for :abbr:`AWS (Amazon Web Services)`.

   Corresponds to configuration file setting: ``aws.secretkey``

User Authentication Method
--------------------------

.. setting:: User Authentication Method

   *Type*: string

   *Default*: ``com.xgen.svc.mms.svc.user.UserSvcDb``

   Select whether to store authentication credentials in the |onprem|
   Application Database or in an external authentication source.

   .. list-table::
      :widths: 40 60
      :header-rows: 1

      * - Auth Method
        - Accepted Value

      * - External Source
        - ``com.xgen.svc.mms.svc.user.UserSvcCrowd``
      
      * - Internal Database
        - ``com.xgen.svc.mms.svc.user.UserSvcDb``

   Corresponds to configuration file setting: ``mms.userSvcClass``

Authentication through |onprem| Application Database
----------------------------------------------------

.. setting:: Password Changes Before Reuse

   *Type*: number

   The number of previous passwords to remember. You cannot reuse a
   remembered password as a new password.

   Corresponds to configuration file setting: ``mms.password.minChangesBeforeReuse``

.. setting:: Failed Login Attempts Before Account Lock

   *Configuration file setting*: ``mms.password.maxFailedAttemptsBeforeAccountLock``

   *Type*: number

   The number of failed login attempts before an account becomes
   locked. Only an |a-mms| Administrator can unlock a locked account.
 
   Corresponds to configuration file setting: 
   ``mms.password.maxFailedAttemptsBeforeAccountLock``

.. setting:: Days Inactive Before Account Lock

   *Configuration file setting*: ``mms.password.maxDaysInactiveBeforeAccountLock``

   *Type*: number

   The maximum number of days with no visits to the |mms| website
   before |mms| locks an account.

   Corresponds to configuration file setting: 
   ``mms.password.maxDaysInactiveBeforeAccountLock``

.. setting:: Days Before Password Change Required

   *Type*: number

   The number of days a password is valid before the password expires.

   Corresponds to configuration file setting: ``mms.password.maxDaysBeforeChangeRequired``

.. only:: onprem

   .. setting:: Invitation Only Mode

      *Type*: boolean

      If true, new users can register by invitation only. The
      invitation provides a URL that displays the registration link.

      If false, new users can register if they have the |mms| URL.

      Corresponds to configuration file setting: ``mms.user.invitationOnly``

.. _ldap-settings:
.. _ldap-user-settings:
.. _default-ldap-separator:
.. _ldap-global-role-settings:

Authentication through LDAP
---------------------------

These settings configure |mms| to use an LDAP server for
authentication. If you use LDAP authentication, users must belong to an
LDAP group to log into |mms|. You must create LDAP groups for each
|mms| :doc:`user role </reference/user-roles>`.

*Settings that begin with "mms.ldap.global.role"* assign |mms|
:ref:`global roles <global-roles>` to the members of the specified LDAP
groups. Specify groups using the format used by the LDAP attribute
specified in the :setting:`LDAP User Group` setting. You can specify
multiple groups using the ``;;`` delimiter. To change the default
delimiter, use the :setting:`mms.ldap.group.separator` setting. Each
|mms| global role provides its level of access to all the |mms|
:doc:`projects </tutorial/manage-projects>` in the deployment. To provide
access to specific groups, use :doc:`group-level roles </reference/user-roles>`.

.. setting:: LDAP URI

   *Type*: string

   The URI for the LDAP or SSL LDAP server.  

   .. code-block:: ini

      mms.ldap.url=ldaps://acme-dc1.acme.example.com:3890

   Corresponds to configuration file setting: ``mms.ldap.url``

.. setting:: LDAP SSL CA File

   *Type*: string

   A file containing one or more trusted certificates in PEM format.
   Use this setting if you are using LDAPS and the server
   is using a certificate that is not from a well-known CA.

   .. code-block:: ini

      mms.ldap.ssl.CAFile=/opt/CA.pem

   Corresponds to configuration file setting: ``mms.ldap.ssl.CAFile``

.. setting:: LDAP SSL PEM Key File

   *Type*: string

   A file containing a client certificate and private key. Use this
   setting when your SSL LDAP server requires client certificates.

   .. code-block:: ini

      mms.ldap.ssl.PEMKeyFile=/opt/keyFile.pem

   Corresponds to configuration file setting: ``mms.ldap.ssl.PEMKeyFile``

.. setting:: LDAP SSL PEM Key File Password

   *Type*: string

   The password for :setting:`LDAP SSL PEM Key File`. Use this setting
   if the ``PEMKeyFile`` is encrypted.

   .. code-block:: ini

      mms.ldap.ssl.PEMKeyFilePassword=<password>

   Corresponds to configuration file setting: ``mms.ldap.ssl.PEMKeyFilePassword``

.. setting:: LDAP Bind Dn

   *Type*: string

   The LDAP user used to execute searches for other users.

   .. code-block:: ini

      mms.ldap.bindDn=authUser@acme.example.com

   Corresponds to configuration file setting: ``mms.ldap.bindDn``

.. setting:: LDAP Bind Password

   *Type*: string

   The password for the search user.

   .. code-block:: ini

      mms.ldap.bindPassword=<password>

   Corresponds to configuration file setting: ``mms.ldap.bindPassword``

.. setting:: LDAP User Base Dn

   *Type*: string

   The base Distinguished Name (DN) that |mms| uses to search for
   users. Escape the ``=`` sign with ``\``.

   .. code-block:: ini

      mms.ldap.user.baseDn=DC\=acme,DC\=example,DC\=com

   Corresponds to configuration file setting: ``mms.ldap.user.baseDn``

.. setting:: LDAP User Search Attribute

   *Type*: string

   The LDAP field used for the LDAP search. This is typically a
   username or an email address. The value of this field is also used
   as the |mms| username.

   .. code-block:: ini

      mms.ldap.user.searchAttribute=<myAccountName>

   Corresponds to configuration file setting: ``mms.ldap.user.searchAttribute``

.. setting:: LDAP User Group

   *Type*: string

   The LDAP user attribute that contains the list of LDAP groups the
   user belongs to.  The LDAP attribute can use any format to list the
   groups, including Common Name (``cn``) or Distinguished Name
   (``dn``). All |mms| settings in this configuration file that specify
   groups must match the chosen format.

   .. code-block:: ini
   
      mms.ldap.user.group=memberOf

   Corresponds to configuration file setting: ``mms.ldap.user.group``

.. setting:: LDAP Global Role Owner

   *Type*: string

   The LDAP group that has full privileges for the |mms| deployment,
   including full access to all |mms| :doc:`projects </tutorial/manage-projects>`
   and all administrative permissions. Users in the specified
   LDAP group receive the :ref:`global owner <global-owner-role>` role
   in |mms|. Specify the group using the format that is used by the
   LDAP attribute specified in the :setting:`LDAP User Group` setting.

   .. COMMENT/QUESTION: Should the LDAP examples use ;; as the delimiter?

   .. code-block:: ini

      mms.ldap.global.role.owner=CN\=MMSGlobalOwner,OU\=MMS,OU\=acme Groups,DC\=acme,DC\=example,DC\=com

   Corresponds to configuration file setting: ``mms.ldap.global.role.owner``

.. setting:: LDAP User First Name

   *Type*: string

   The :abbr:`LDAP (Lightweight Directory Access Protocol)` user attribute
   that contains the user's first name. After successful :abbr:`LDAP
   (Lightweight Directory Access Protocol)` authentication, |mms| synchronizes
   the specified :abbr:`LDAP (Lightweight Directory Access Protocol)`
   attribute with the first name from the |mms| user record.

   Per `RFC2256 <https://www.ietf.org/rfc/rfc2256.txt>`_, the default
   :abbr:`LDAP (Lightweight Directory Access Protocol)` attribute is
   ``givenName``.

   .. code-block:: ini

      mms.ldap.user.firstName=givenName

   Corresponds to configuration file setting: ``mms.ldap.user.firstName``

.. setting:: LDAP User Last Name

   *Type*: string

   The :abbr:`LDAP (Lightweight Directory Access Protocol)` user attribute
   that contains the user's last name. After successful :abbr:`LDAP
   (Lightweight Directory Access Protocol)` authentication, |mms| synchronizes
   the specified :abbr:`LDAP (Lightweight Directory Access Protocol)`
   attribute with the last name from the |mms| user record.

   Per `RFC2256 <https://www.ietf.org/rfc/rfc2256.txt>`_, the default
   :abbr:`LDAP (Lightweight Directory Access Protocol)` attribute is ``sn``
   for *surname*.

   .. code-block:: ini

      mms.ldap.user.lastName=sn

   Corresponds to configuration file setting: ``mms.ldap.user.lastName``

.. setting:: LDAP User Email

   *Type*: string

   The :abbr:`LDAP (Lightweight Directory Access Protocol)` user attribute
   that contains the user's email address. After successful :abbr:`LDAP
   (Lightweight Directory Access Protocol)` authentication, |mms| synchronizes
   the specified :abbr:`LDAP (Lightweight Directory Access Protocol)`
   attribute with the email address from the |mms| user record.

   Per `RFC2256 <https://www.ietf.org/rfc/rfc2256.txt>`_, the default
   :abbr:`LDAP (Lightweight Directory Access Protocol)` attribute is ``mail``.

   .. code-block:: ini

      mms.ldap.user.email=mail

   Corresponds to configuration file setting: ``mms.ldap.user.email``

.. setting:: LDAP Global Role Automation Admin

   *Type*: string

   The LDAP group whose members have the :ref:`global automation admin
   role <global-automation-admin-role>` in |mms|. Specify groups using
   the format used by the LDAP attribute specified in the
   :setting:`LDAP User Group` setting. You can specify multiple groups
   using the ``;;`` delimiter. To change the default delimiter, use the
   :setting:`mms.ldap.group.separator` setting.

   .. code-block:: ini

      mms.ldap.global.role.automationAdmin=CN\=MMS-AutomationAdmin,OU\=MMS,OU\=acme Groups,DC\=acme,DC\=example,DC\=com

   Each |mms| global role provides its level of access to all the |mms|
   :doc:`projects </tutorial/manage-projects>` in the deployment. To provide
   access to specific projects, use :ref:`group-level roles <global-roles>`.

   Corresponds to configuration file setting: ``mms.ldap.global.role.automationAdmin``

.. setting:: LDAP Global Role Backup Admin

   *Type*: string

   The LDAP group whose members have the :ref:`global backup admin role
   <global-backup-admin-role>` in |mms|. 

   .. code-block:: ini

      mms.ldap.global.role.backupAdmin=CN\=MMS-BackupAdmin,OU\=MMS,OU\=acme Groups,DC\=acme,DC\=example,DC\=com

   Corresponds to configuration file setting: ``mms.ldap.global.role.backupAdmin``

.. setting:: LDAP Global Role Monitoring Admin

   *Type*: string

   The LDAP group whose members have the :ref:`global monitoring admin
   role <global-monitoring-admin-role>` in |mms|. 

   .. code-block:: ini

      mms.ldap.global.role.monitoringAdmin=CN\=MMS-MonitoringAdmin,OU\=MMS,OU\=acme Groups,DC\=acme,DC\=example,DC\=com

   Corresponds to configuration file setting: ``mms.ldap.global.role.monitoringAdmin``

.. setting:: LDAP Global Role User Admin

   *Type*: string

   The LDAP group whose members have the :ref:`global user admin role
   <global-user-admin-role>` in |mms|. 

   .. code-block:: ini

      mms.ldap.global.role.userAdmin=CN\=MMS-UserAdmin,OU\=MMS,OU\=acme Groups,DC\=acme,DC\=example,DC\=com

   Corresponds to configuration file setting: ``mms.ldap.global.role.userAdmin``

.. setting:: LDAP Global Role Read Only

   *Type*: string

   The LDAP group whose members have the :ref:`global read-only role
   <global-read-only-role>` in |mms|. 

   .. code-block:: ini

      mms.ldap.global.role.readOnly=CN\=MMS-ReadOnly,OU\=MMS,OU\=acme Groups,DC\=acme,DC\=example,DC\=com

   Corresponds to configuration file setting: ``mms.ldap.global.role.readOnly``

.. setting:: mms.ldap.group.separator

   To set this, click :guilabel:`Config` and then click the
   :guilabel:`Custom` tab.

   *Type*: string

   Each of the global role values takes a delimited list of groups:

   .. code-block:: ini

      "dbas,sysadmins"

   If a group value contains the delimiter, the delimiter must be set
   to another value. 

   .. example:: 
      If you have the group value ``"CN\=foo,DN\=bar"`` and the
      delimiter is ``,`` then |mms| parses ``"CN\=foo,DN\=bar"`` as two
      elements rather than as the description for a single group.

   Change the delimiter by adding the
   :setting:`mms.ldap.group.separator` setting to the configuration
   file and specifying a different delimiter.

   Starting with |mms| 1.5, the default delimiter is ``;;``.

Multi-Factor Authentication (MFA) Settings
------------------------------------------

.. setting:: Multi-factor Auth Level

   *Type*: string

   *Default*: OFF

   Configures the :doc:`two-factor authentication </tutorial/manage-two-factor-authentication>` "level":

   - ``OFF``: Disables two-factor authentication. |onprem| does not
     use two-factor authentication.

   - ``OPTIONAL``: Users can choose to set up two-factor authentication
     for their |onprem| account.

   - ``REQUIRED_FOR_GLOBAL_ROLES``: Users who possess a 
     :ref:`global role <global-roles>` **must** set up two-factor
     authentication. Two factor authentication is optional for all
     other users.

   - ``REQUIRED``: **All** users must set up two-factor authentication
     for their |onprem| account.

   Two-factor authentication is recommended for the security of your
   |onprem| deployment.

   Corresponds to configuration file setting: ``mms.multiFactorAuth.level``.

   .. warning::

      If enabling ``mms.multiFactorAuth.level`` through the
      configuration file, you must create a :ref:`user account
      <add-users>` first before updating the configuration file.
      Otherwise, you will not be able to login to |mms|.

   .. note::

      If you enable :ref:`Twilio integration <enable-twilio>`
      (optional), ensure that |mms| servers can access the
      ``twilio.com`` domain.

.. setting:: mms.multiFactorAuth.require

   In |onprem| 1.8 and later, :setting:`mms.multiFactorAuth.level`
   replaces :setting:`mms.multiFactorAuth.require`.

   *Type*: boolean

   *Default*: false

   When ``true``, |mms| will require two-factor authentication for
   users to log in or to perform certain destructive operations within
   the application.

   If you configure 
   :ref:`Twilio integration <twilio-sms-alert-settings>`, users may 
   obtain their second factor tokens via Google Authenticator, SMS, or 
   voice calls. Otherwise, the only mechanism to provide two-factor 
   authentication is Google Authenticator.

.. setting:: Multi-factor Auth Allow Reset

   *Type*: boolean

   *Default*: false

   When ``true``, |mms| allows users to reset their two-factor
   authentication settings via email in an analogous fashion to
   resetting their passwords.

   To reset two-factor authentication, a user must:

   - be able to receive email at the address associated with the user 
     account.
   - know the user account's password.
   - know the :term:`agent API key` for each |mms| group the user
     belongs to.

   Corresponds to configuration file setting: ``mms.multiFactorAuth.allowReset``

.. setting:: Multi-factor Auth Issuer

   *Type*: string

   If Google Authenticator provides two-factor authentication, this
   string is the ``issuer`` in the Google Authenticator app. If
   left blank, the ``issuer`` is the domain name of the |mms|
   installation.

   Corresponds to configuration file setting: ``mms.multiFactorAuth.issuer``

Other Authentication Options
----------------------------

.. setting:: ReCaptcha Enabled

   *Type*: boolean

   Set to ``true`` to require `reCaptcha
   <https://www.google.com/recaptcha>`_ validation when a new user
   registers. You must have a `reCaptcha account
   <https://www.google.com/recaptcha/admin>`_.

   Corresponds to configuration file setting: ``reCaptcha.enabled``

.. setting:: ReCaptcha Public Key

   *Type*: string

   The reCaptcha public key associated with your account.

   Corresponds to configuration file setting: ``reCaptcha.public.key``

.. setting:: ReCaptcha Private Key

   *Type*: string

   The reCaptcha private key associated with your account.

   Corresponds to configuration file setting: ``reCaptcha.private.key``

.. setting:: Session Max Hours

   *Type*: number

   The number of hours before a session on the |mms| website expires.

   Set this value to ``0`` to use browser session cookies only.

   Corresponds to configuration file setting: ``mms.session.maxHours``

Security Settings
-----------------

.. setting:: mms.security.hstsMaxAgeSeconds

   *Type*: integer

   *Default*: ``0`` (Can use HTTP or HTTPS.)

   How long (in seconds) |mms| limits browser connections to use
   :abbr:`HTTPS (Secure Hypertext Transport Protocol)`. This value must
   be a positive integer.

   .. seealso::
      To learn how to deploy :abbr:`HSTS (HTTP Strict Transport
      Security)`, see `HTTP Strict Transport Security
      <https://en.wikipedia.org/w/index.php?title=HTTP_Strict_
      Transport_Security&oldid=774831831>`_, `RFC6797
      <https://tools.ietf.org/html/rfc6797>`_ and `hstspreload.org
      <https://hstspreload.org/#deployment-recommendations>`_.

   Corresponds to configuration page setting: :guilabel:`HSTS Preload Maximum Age`.

.. setting:: mms.security.disableBrowserCaching

   *Type*: boolean

   *Default*: ``false``

   When ``true``, |mms| makes all :abbr:`HTTP (Hypertext Transport
   Protocol)` responses not cacheable.

   Corresponds to configuration page setting: 
   :guilabel:`Disable Browser Caching`.

HTTP/HTTPS Proxy Settings
-------------------------

|mms| can pass all outgoing HTTP and HTTPS requests through an HTTP
or HTTPS proxy.

.. setting:: Proxy Host

   *Type*: string

   Specify the hostname of the HTTP or HTTPS proxy to which you wish to
   connect.

   .. code-block:: ini

      proxy.example.com

   Corresponds to configuration file setting: ``http.proxy.host``

.. setting:: Proxy Port

   *Type*: integer

   Specify the port on which you wish to connect to the host. You must
   specify both the :setting:`Proxy Port` and :setting:`Proxy Host`
   to use a proxy.

   Corresponds to configuration file setting: ``http.proxy.port``

.. setting:: Proxy Username

   *Type*: string

   If the proxy requires authentication, use this setting
   to specify the username with which to connect to the proxy.

   Corresponds to configuration file setting: ``http.proxy.username``

.. setting:: Proxy Password

   *Type*: string

   If the proxy requires authentication, use this setting
   to specify the password with which to connect to the proxy.

   Corresponds to configuration file setting: ``http.proxy.password``

.. _twilio-sms-configure:
.. _twilio-sms-alert-settings:

Twilio Integration Settings
---------------------------

To receive alert notifications via SMS or two-factor verification code,
you must have a `Twilio <http://www.twilio.com/docs/quickstart>`_
account.

.. setting:: Account SID

   *Type*: string

   `Twilio <http://www.twilio.com/docs/quickstart>`_ account ID.

   Corresponds to configuration file setting: ``twilio.account.sid``

.. setting:: Twilio Auth Token

   *Type*: string

   Twilio API token.

   Corresponds to configuration file setting: ``twilio.auth.token``

.. setting:: Twilio From Number

   *Type*: string

   Twilio phone number.

   Corresponds to configuration file setting: ``twilio.from.num``

.. _automation-versions-settings:

MongoDB Version Management
--------------------------

The following settings determine how |onprem| knows what MongoDB
releases exist and how the MongoDB binaries are supplied to the
|onprem| server. The Automation Agents and Backup Daemons use these
binaries when deploying MongoDB.

.. setting:: Version Manifest Source

   *Type*: string

   *Default*: mongodb

   Set this to ``Local`` if your Automation Agents and Backup Daemons
   will not have internet access to download MongoDB binaries. If you
   set this to ``Local``, an |onprem| admin must manually provide the
   version manifest and the MongoDB binaries, as described in
   :doc:`/tutorial/configure-local-mode`.

   Corresponds to configuration file setting: ``automation.versions.source``

.. _Versions Directory:

.. setting:: Versions Directory

   *Type*: string

   *Default*: 

   Windows:
     ``C:\MMSData\MongoDBReleases``

   Linux / macOS:
     ``/opt/mongodb/mms/mongodb-releases/``

   Specify the directory on the |application| server where |onprem|
   stores the MongoDB binaries. The Automation Agent accesses the
   binaries when installing or changing versions of MongoDB on your
   deployments. If you set :setting:`Version Manifest Source` to run in
   ``Local`` mode, the Backup Daemons also access the MongoDB binaries
   from this directory. See :doc:`/tutorial/configure-local-mode` for
   more information.

   Corresponds to configuration file setting: ``automation.versions.directory``

.. _mongodb-release-autodownload:

.. setting:: Backup Versions Auto Download

   *Type*: boolean

   Indicates whether the Backup Daemons automatically install the
   versions of MongoDB needed by the daemons.

   If ``true`` 
      The daemons retrieve the binaries either from MongoDB Inc. over
      the internet.

   If ``false``
      Backup Daemons do not have internet access and require that an
      |onprem| administrator manually download and extract every
      archived version of a MongoDB release needed by the system's
      backup daemons. The administrator must place the extracted
      binaries into the :setting:`Versions Directory` on the |onprem|
      servers.  

      .. warning::
         Set to ``false`` when |onprem| is running in :doc:`Local Mode
         </tutorial/configure-local-mode>`.

   Corresponds to configuration file setting: ``mongodb.release.autoDownload``

.. _Backup-Versions-Auto-Download-Enterprise-Builds:

.. setting:: Backup Versions Auto Download Enterprise Builds

   *Type*: boolean

   If :setting:`Backup Versions Auto Download` is set to ``true``,
   specify whether the Daemon should download binaries for the
   Enterprise Edition.

   .. warning::

      If you will run :term:`MongoDB Enterprise` and provision your own
      Linux servers, then you must manually install a set of
      dependencies to each server **before installing MongoDB**. See
      :doc:`/tutorial/configure-local-mode`.

.. setting:: Required Module For Backup
    
   *Type* string

   Specifies whether to use MongoDB Community or Enterprise binaries for
   :doc:`backup </tutorial/nav/backup-deployments>`. When ``Enterprise
   Required`` or ``Community Required`` is selected, |mms| only uses
   those binaries for backup. When ``Enterprise Preferred`` is selected,
   |mms| uses Enterprise binaries if available and Community binaries if
   they are not. 

   .. note::
   
      When ``Enterprise Required`` is selected, you must either set 
      `Backup-Versions-Auto-Download-Enterprise-Builds`_ to ``true`` or
      manually place Enterprise binaries in the `Versions Directory`_
      in :doc:`Local Mode </tutorial/configure-local-mode>`.

   .. warning::

      Backup fails when either ``Enterprise Required`` or ``Community
      Required`` is selected, but the `Versions Directory`_ does not
      contain the required binary.


.. _automation-backup-compression-settings:

Backup Snapshots
----------------

The following settings determine:

- How much |onprem| compresses file system store snapshots.
- How frequently |onprem| takes snapshots.
- How long |onprem| stores snapshots.

To set these values, click the :guilabel:`Admin` link, then
the :guilabel:`General` tab, then the :guilabel:`Ops Manager Config`
page, and then the :guilabel:`Backup` section.

.. seealso::
   See :ref:`snapshot-frequency-and-retention` to learn more about
   how often snapshots are taken and how long they can be retained.

.. setting:: File System Store Gzip Compression Level

   *Type*: integer

   *Default*: 6

   Determines how much |onprem| compresses file system-based
   snapshots. The level ranges from ``0`` to ``9``:

   - ``0`` provides no compression.
   
   - ``1`` to ``9`` increases the degree of compression at a cost of
     how fast the snapshot is compressed. Level ``1`` compresses
     snapshots the least but at the fastest speed. Level ``9``
     compresses snapshots the most but at the slowest speed.
   
   .. note:: 
      Changing :guilabel:`File System Store Gzip Compression Level`
      affects new snapshots only. It does not affect the compression
      level of existing snapshots.

   :guilabel:`File System Store Gzip Compression Level` corresponds
   to the ``backup.fileSystemSnapshotStore.gzip.compressionLevel``
   configuration file setting.

.. setting:: Snapshot Interval (Hours) 

   *Type*: integer

   *Default*: 24

   Specifies the time, in hours, between two consecutive snapshots.
   
   :guilabel:`Snapshot Interval (Hours)` corresponds to the 
   ``brs.snapshotSchedule.interval`` configuration file setting.

.. setting:: Base Retention of Snapshots (in Days) 

   *Type*: integer

   *Default*: 2

   Specifies how many days an interval snapshot is stored.
   
   :guilabel:`Base Retention of Snapshots (in Days)` corresponds to
   the ``brs.snapshotSchedule.retention.base`` configuration file 
   setting.

.. setting:: Daily Retention of Snapshots (in Days) 

   *Type*: integer

   *Default*: 0

   Specifies how many days a daily snapshot is stored.
   
   :guilabel:`Daily Retention of Snapshots (in Days)` corresponds to 
   the ``brs.snapshotSchedule.retention.daily`` configuration file 
   setting.

.. setting:: Weekly Retention of Snapshots (in Weeks)

   *Type*: integer

   *Default*: 2

   Specifies how many weeks a weekly snapshot is stored.
   
   :guilabel:`Weekly Retention of Snapshots (in Weeks)` corresponds 
   to the ``brs.snapshotSchedule.retention.weekly`` configuration 
   file setting.

.. setting:: Monthly Retention of Snapshots (in Months)

   *Type*: integer

   *Default*: 1

   Specifies how many months a monthly snapshot is stored.

   :guilabel:`Monthly Retention of Snapshots (in Months)` corresponds 
   to the ``brs.snapshotSchedule.retention.monthly`` configuration 
   file setting.

.. setting:: Restore Digest Method

   *Type*: string

   *Default*: ``SHA1``

   Specifies whether or not to generate a 
   `SHA1 <https://tools.ietf.org/html/rfc3174>`_ checksum
   for restore archive files. 

   Acceptable values are ``SHA1`` or ``NONE``.

   :guilabel:`Restore Digest Method` corresponds to the
   ``brs.restore.digest.method`` configuration file setting.

.. setting:: KMIP Server Host

   *Type*: string

   *Default*: None

   Specifies the hostname of a Key Management Interoperability Protocol
   (KMIP) server.

   :guilabel:`KMIP Server Host` corresponds to the 
   ``backup.kmip.server.host`` configuration file setting.

.. setting:: KMIP Server Port

   *Type*: integer

   *Default*: None

   Specifies the port of the KMIP server.

   :guilabel:`KMIP Server Port` corresponds to the 
   ``backup.kmip.server.port`` configuration file setting.

.. setting:: KMIP Server CA File

   *Type*: string

   *Default*: None

   Specifies a ``.PEM``-format file that contains one or more
   certificate authorities.

   :guilabel:`KMIP Server CA File` corresponds to the 
   ``backup.kmip.server.ca.file`` configuration file setting.

.. _queryable-snapshot-settings:

Queryable Snapshot Configuration
--------------------------------

The following settings are available for :doc:`/tutorial/query-backup`.

.. setting:: Proxy Server Port

   *Default*: ``25999``

   Port for the queryable backup host. Corresponds to
   ``brs.queryable.proxyPort`` in the configuration file setting.

   .. note::

      .. include:: /includes/extracts/queryable-backup-proxy-port.rst

.. setting:: Proxy Server PEM File

   Required when using Queryable Snapshot.

   The Certificate Authority (CA) PEM file that contains one or more
   trusted certificates and the associated private keys. Corresponds
   to ``brs.queryable.pem`` in the configuration file setting.

   .. include:: /includes/extracts/queryable-backup-pem-restriction.rst

   .. note::

      .. include:: /includes/extracts/queryable-backup-proxy-pem-file.rst

.. setting:: Proxy Server PEM File Password

   Required if :setting:`Proxy Server PEM File` is encrypted.

   Corresponds to ``brs.queryable.pem.pwd`` in the configuration file
   setting.

   .. note::

      .. include:: /includes/extracts/queryable-backup-proxy-pem-password.rst

.. setting:: Queryable Startup Timeout (Seconds)

   *Default*: ``60``

   Number of seconds to wait for the Queryable Snapshot to prepare before
   timing out. Corresponds to ``brs.queryable.mounttimeout`` in the
   configuration file setting.

.. setting:: Mongo Connection Timeout (Seconds)

   *Default*: ``30`` 

   Number of seconds to wait for a connection to the Queryable
   Snapshot :program:`mongod` instance before timing out. Corresponds
   to ``brs.queryable.connecttimeout`` in the configuration file
   setting.

.. setting:: Expiration (Hours)

   *Default*: ``24``

   Duration time in hours for a Queryable Snapshop once initiated.
   Corresponds to ``brs.queryable.expiration`` in the configuration
   file setting.

.. _data-migration-status:

.. setting:: Read Cache Size (MB)

   *Default*: ``512``

   Size in megabytes of the global snapshot cache that |mms| maintains
   for clients querying restored backup snapshots. Corresponds to the
   ``brs.queryable.lruCacheCapacityMB`` configuration file property.

|onprem| Data Migration
-----------------------

.. note::

   *Available only during schema data migration*

|onprem| indicates the status of schema data migration.

.. figure:: /images/ops-mgr-data-migration-status.png

.. _default-monitoring-data-retention:

Default Monitoring Data Retention
---------------------------------

|onprem| gathers metric data at a 10-second granularity. The
:guilabel:`Default Monitoring Data Retention` table determines how long
|onprem| stores metric data. For each increasing granularity level, |onprem|
computes the data based on the averages from the previous granularity level.

The table determines the default settings for new groups. If you change the
settings, |onprem| prompts you whether to also apply the settings to existing
groups. To change the settings for a specific group without changing
the |onprem| default settings, see :ref:`groups-page-admin-ui`.

Increasing the retention period for a granularity requires more storage on
the :ref:`Ops Manager Application Database <mms-application-database>`.

.. note::

   Decreasing the retention period for existing groups does not immediately
   recovery available disk space on the file system and can actually use more
   disk space in the short term during the transition to the shorter retention
   period.

Public API
----------

You can modify certain default behaviors of the :doc:`Public API
</core/api>`. To add the following settings, click the :guilabel:`Admin`
link, then the :guilabel:`General` tab, then the :guilabel:`Ops Manager
Config` page, and then the :guilabel:`Custom` section.

.. setting:: mms.publicApi.whitelistEnabled

   *Type*: boolean

   Certain API calls require that requests originate from a :ref:`whitelisted
   IP address <whitelist-for-api-operations>`. To turn off this requirement, add this setting and set
   its value to ``false``.

.. _config-monitoring-agent-failover:
.. _standby-monitoring-agent:

Monitoring Agent Session Failover
---------------------------------

**Beginning with Monitoring Agent version 5.0.0**, |mms| can distribute
monitoring assignments among up to 100 running Monitoring Agents. One agent is
the primary agent and the others share in monitoring responsibilities. If an
agent fails, |mms| redistributes that agent's monitoring assignments.
If you run more than 100
Monitoring Agents, the additional agents run as standby agents that are
completely idle, except to log their status as standby agents and to
periodically ask |onprem| whether they should receive monitoring assignments.

.. note:: Also beginning with version 5.0.0, the Monitoring Agent stores monitoring
          metrics at 10-second granularity.

**Prior to Monitoring Agent 5.0.0**, only the primary Monitoring Agent handles
monitoring assignments. All additional running agents are standby agents.

The following settings tune the interval |onprem| uses to determine if a
Monitoring Agent is unaccessible and the frequency with which standby agents
poll |onprem| to determine if they should receive monitoring assignments.

To add the following settings, click the :guilabel:`Admin` link, then
the :guilabel:`General` tab, then the :guilabel:`Ops Manager Config`
page, and then the :guilabel:`Custom` section.

.. setting:: mms.monitoring.agent.session.timeoutMillis

   *Type*: integer

   *Default*: ``90000``

   The interval that |mms| uses to determine if a standby agent
   should start monitoring. If |mms| does not hear from a
   Monitoring Agent for the duration specified, |mms|
   promotes a standby agent. Configuring the timeout below `90000` (90
   seconds) will cause |mms| to fail at startup with a configuration error.

.. setting:: mms.monitoring.agent.standbyCollectionFactor

   *Type*: Integer
   
   *Default*: ``4``

   Specifies how frequently a standby agent checks in with |mms| to see
   if it should start monitoring. The following values are
   permitted:

   - ``1``: the standby agents check every 55 seconds.

   - ``2``: the standby agents check in at twice the rate as ``1``, or
     approximately every 27 seconds.

   - ``3``: the standby agents check approximately every 18 seconds

   - ``4``: the standby agents check approximately every 14
     seconds.

All Clusters View
-----------------

.. setting:: mms.allclusters.onlyMembership

   *Type*: boolean

   *Default*: false

   Determines whether the :doc:`/tutorial/view-all-clusters` displays
   only the deployments to which an |onprem| administrator belongs (set
   the value to ``true``) or the deployments to which the administrator
   has access (set the value to ``false``).

.. _snmp-heartbeat-configure:

SNMP Heartbeat Settings
-----------------------

|onprem| uses SNMP v2c. You can configure the |application| to send a
periodic heartbeat trap notification (v2c) that contains an internal
health assessment of the |application|. The |application| can send
traps to one or more endpoints on the standard SNMP UDP port 162.

To configure the |application| to send trap notifications, first
download the Management Information Base (MIB) file at
`<http://downloads.mongodb.com/on-prem-monitoring/MMS-MONGODB-MIB.txt>`_ . 
Then add the following settings as custom settings. To do
so, click the :guilabel:`Admin` link, then the :guilabel:`General` tab,
then the :guilabel:`Ops Manager Config` page, and then the
:guilabel:`Custom` section.

.. setting:: snmp.default.hosts

   *Type*: string

   *Default*: blank

   Comma-separated list of hosts where 'heartbeat' traps will be sent
   on the standard UDP port 162. You must set
   :setting:`snmp.default.hosts` to enable the SNMP heartbeat
   functionality; otherwise, leaving the setting blank disables the
   SNMP heartbeat functionality.

.. setting:: snmp.listen.port

   *Type*: number

   *Default*: 11611

   Listening UDP port for SNMP. Setting to a number less than ``1024``
   will require running the |application| with root privileges.

.. setting:: snmp.default.heartbeat.interval

   *Type*: number

   *Default*: 300

   Number of seconds between heartbeat notifications.

.. setting:: snmp.community

   *Type*: string

   *Default*: public

   The snmp community for snmp traps sent by |onprem|.

Non-Uniform Memory Access (NUMA) Settings
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. setting:: mongodb.disable.numa

   *Type*: boolean

To disable NUMA for the :term:`head databases <head database>`:

1. Click the :guilabel:`Admin` link, then the :guilabel:`General` tab,
   then the :guilabel:`Ops Manager Config` page, and then the
   :guilabel:`Custom` section.

2. Add ``mongodb.disable.numa`` as a :guilabel:`Key` and set its
   :guilabel:`Value` to ``true``.

3. Click :guilabel:`Save`.

See :ref:`production-numa` in the MongoDB Production Notes to learn
more about NUMA.

.. important:: 
   
   Each |mms| instance with Backup Daemons enabled must have the ``numactl``
   service installed. If ``numactl`` is not installed and this setting is set
   to ``true``, backup jobs fail.

Backup Settings
---------------

To add the following settings, click the :guilabel:`Admin` link, then
the :guilabel:`General` tab, then the :guilabel:`Ops Manager Config`
page, and then the :guilabel:`Custom` section.

.. setting:: mms.alerts.BackupAgentConfCallFailure.maximumFailedConfCalls

   *Type*: integer

   *Default*: 10

   If the Backup Agent experiences more than this number of consecutive
   failed conf calls, |onprem| triggers the following 
   :doc:`global alert </tutorial/manage-global-alerts>`:

   :alert:`Backup Agent has too many conf call failures`

.. setting:: mms.alerts.OutsideSpaceUsedThreshold.maximumSpaceUsedPercent

   *Type*: integer

   *Default*: 85

   If the :term:`blockstore` uses at least this percentage of its total
   disk capacity, |onprem| triggers the following 
   :doc:`system alert </core/system-alerts>`:

   :alert:`Blockstore space used exceeds threshold`

.. setting:: mms.backup.minimumOplogWindowHours

   *Type*: float

   *Default*: 3

   This sets the minimum number of hours that the oplog should record.

   .. warning::
      MongoDB recommends only changing this value temporarily to permit
      a test backup job to execute. The minimum oplog size value should
      be reset to the default as soon as possible. If an oplog is set to
      too small of a value, it can result in a gap between a backup job
      and an oplog which makes the backup unusuable for restores. Stale
      backup jobs must be resynchronized before it can be used for
      restores. See also :ref:`troubleshoot-insufficient-oplog-size-error`

.. setting:: mms.backup.journal.heads

   *Type*: boolean

   *Default*: false

   This sets whether the :term:`HEAD database <head database>` should
   use :term:`journaling <journal>`.

   See :ref:`manage-backup-jobs` to enable or disable journaling for
   the :term:`head database` of a single backup job.

.. setting:: mms.backup.snapshot.maxWorkers

   *Type*: integer

   *Default*: 4

   This sets the number of files that are saved concurrently when
   taking a :term:`snapshot`. Increasing the value of this setting can
   improve :term:`backup job` performance when there are a large number
   of small files in a high latency environment.

.. setting:: mms.backup.snapshot.maxSumFileForWorkersMB

   *Type*: integer

   *Default*: 2048

   This sets the maximum cumulative size of files, in Megabytes, that
   are saved concurrently when taking a :term:`snapshot`.

Backup Daemon
-------------

The following settings are specific to a Backup Daemon and are set
through the :guilabel:`Admin` interface, through the :guilabel:`Backup`
tab's :ref:`Daemons page <daemons-interface>`. These settings **are
not** global but are specific to the daemon being configured. For a
given daemon, you can set these locally through the 
:ref:`conf-mms.properties <conf-mms.properties>` configuration file.

.. setting:: Head directory

   If the directory is already configured, the path is listed in the
   :guilabel:`Server` column.

   *Type*: string

   The dedicated disk partition on the Backup Daemon's server where the
   daemon stores the :term:`head databases <head database>`. The daemon
   maintains a head database for each shard or replica set it backs up.
   This directory must be writable by the mongodb-mms user and must end
   in a trailing slash. It is critical that this partition is sized
   appropriately.

   .. important::
      Data in this directory is dynamically created, maintained and
      destroyed by the Backup Daemon. This partition should not be used
      for any other purpose. This partition should *not* overlap with
      the partition used for the Backup Database.

.. Cannot find reference to "rootDirectory" anywhere in codebase.
..  Corresponds to configuration file setting: ``rootDirectory``

.. setting:: Number of Workers

   *Type*: number

   The number of replica sets that should be processed at a time.

   Corresponds to configuration file setting: ``numWorkers``

|application| Database Connection String
----------------------------------------

The following settings configure the |onprem| connection to the
:ref:`mms-application-database`. You must configure this setting in the
:ref:`conf-mms.properties <conf-mms.properties>` file on each |onprem|
server. To encrypt authentication information, see
:ref:`encrypt-mongodb-user-credentials`.

.. setting:: mongo.mongoUri

   *Type*: string

   The :manual:`connection string </reference/connection-string/>` used
   to access the |application| Database. The connection string **must**
   include the following if applicable:

   - All members of the replica set, if the |application| database is a
     replica set.

   - Authentication credentials for the :parameter:`authentication
     mechanism <authenticationMechanisms>` used on the |application|
     database.

   See the following example connection strings:

   - **Replica Sets:** If you use a :term:`replica set` for the
     database's :doc:`backing instance </tutorial/prepare-backing-mongodb-instances>`, 
     specify all members of the replica set, as shown in the following
     example. If you omit the port number, |onprem| uses the default
     ``27017`` port for all hosts.

     .. code-block:: ini

        mongo.mongoUri=mongodb://db1.example.com:40000,db2.example.com:40000,db3.example.com:40000

     .. note::

        |onprem| does not require the
        :ref:`replicaSet <replica-set-options>` option in the |uri|.

   - **Default MongoDB Authentication:** For a MongoDB instance using
     the MongoDB ``SCRAM-SHA-1`` or ``MONGODB-CR`` challenge-response
     mechanisms, the connection string must include authentication
     credentials. The |application| must authenticate as a MongoDB user
     with the following roles:

     - :authrole:`readWriteAnyDatabase`

     - :authrole:`dbAdminAnyDatabase`.

     - :authrole:`clusterAdmin` if the database is a sharded cluster,
       otherwise :authrole:`clusterMonitor`

     Prefix the hostname with the MongoDB username and password in the
     form ``<username>:<password>@``

     .. code-block:: ini

        mongo.mongoUri=mongodb://mongodbuser1:password@mydb1.example.com:40000

   - **x.509 Certificate Authentication:** For a MongoDB instance using
     ``MONGODB-X509`` authentication, you must first add the value of
     the **subject** from the client certificate as a MongoDB user, as
     described in :manual:`Use x.509 Certificates to Authenticate
     Clients </tutorial/configure-x509-client-authentication>` in the
     MongoDB manual. The client certificate is contained in the PEM
     file you specify in the :setting:`mongodb.ssl.PEMKeyFile` setting.
     Once you have created the user, prefix the host specified in
     :setting:`mongo.mongoUri` with the name of the new user and append
     ``authMechanism=MONGODB-X509`` after the specified port:

     .. code-block:: ini

        mongo.mongoUri=mongodb://<new_mongodb_user>@mydb1.example.com:40000/?authMechanism=MONGODB-X509

   - **LDAP Authentication:** For a MongoDB instance using LDAP, prefix
     the hostname with the MongoDB username and password in the form
     ``<username>:<password>@``, and append the
     ``authMechanism=PLAIN&authSource=$external`` options after the
     port:

     .. code-block:: ini

        mongo.mongoUri=mongodb://mongodbuser1:password@mydb1.example.com:40000/?authMechanism=PLAIN&authSource=$external

   - **Kerberos Authentication:** For a MongoDB instance using
     Kerberos, prefix the hostname with the Kerberos user principal and
     specify the authentication mechanism, ``authMechanism=GSSAPI``,
     after the port.

     Kerberos user principal names have the form ``<username>@<KERBEROS
     REALM>``. You must escape the user principal, replacing symbols
     with the URL encoded representation. A Kerberos user principal of
     ``username@REALM.EXAMPLE.COM`` would therefore become
     ``username%40REALM.EXAMPLE.COM``.

     This is an example of Kerberos authentication:

     .. code-block:: ini

        mongo.mongoUri=mongodb://username%40REALM.EXAMPLE.COM@mydb1.example.com:40000/?authMechanism=GSSAPI

     To enable Kerberos authentication between the |application| and
     the :ref:`backup-database`, see :ref:`configuration-kerberos-settings`. 

     .. seealso::
        :data:`~uri.authMechanism` and :data:`~uri.authSource` in the 
        MongoDB manual.

.. setting:: mongo.encryptedCredentials

   *Type*: boolean

   To use encrypted credentials in :setting:`mongo.mongoUri`, encrypt
   the credentials using the |onprem| 
   :ref:`credentialstool <encrypt-mongodb-user-credentials>`, 
   enter them in the :setting:`mongo.mongoUri` setting, and set this to
   ``true``:

   .. code-block:: ini

      mongo.encryptedCredentials=true

.. _mongodb-ssl-settings:

SSL Connection to the Application Database
------------------------------------------

The following settings configure |onprem| to use SSL to encrypt
connections to the dedicated MongoDB instances that host the
:ref:`mms-application-database` and :ref:`backup-database`. You must
configure this setting in the 
:ref:`conf-mms.properties <conf-mms.properties>` file on each |onprem| 
server.

.. setting:: mongo.ssl

   *Type*: boolean

   Enables SSL connection to the :ref:`mms-application-database` when
   set to ``true``.

.. setting:: mongodb.ssl.CAFile

   *Type*: string

   The name of the PEM file that contains the root certificate chain
   from the Certificate Authority that signed the MongoDB server
   certificate.

.. setting:: mongodb.ssl.PEMKeyFile

   *Type*: string

   The name of the PEM file that contains the X509 certificate and
   private key. Required if the MongoDB instance is running with the
   :option:`--sslCAFile <mongod.--sslCAFile>` option or 
   :setting:`net.ssl.CAFile` setting.

   If you authenticate using the ``MONGODB-X509`` authentication
   mechanism, you also enter this as the name of the user in the
   :setting:`mongoUri` connection string.

.. setting:: mongodb.ssl.PEMKeyFilePassword

   *Type*: string

   Required if the PEM file contains an encrypted private key. Specify
   the password for PEM file. You can encrypt the password using the
   |onprem| ``credentialstool``. See :ref:`encrypt-mongodb-user-credentials`.

.. _configuration-kerberos-settings:

Kerberos Authentication to the Application Database
---------------------------------------------------

To enable Kerberos authentication between |onprem| and the
:ref:`mms-application-database`, configure the following settings in 
the :ref:`conf-mms.properties <conf-mms.properties>` file on each 
|onprem| server. You must configure all required Kerberos settings to 
enable Kerberos authentication.

.. setting:: jvm.java.security.krb5.conf

   *Type*: string

   Optional. The path to an alternate Kerberos configuration file. The
   value is set to JVM's java.security.krb5.conf.
   
   .. code-block:: properties

      jvm.java.security.krb5.conf=/etc/conf/krb5.conf

.. setting:: jvm.java.security.krb5.kdc

   *Type*: string

   Required if using Kerberos. The IP/FQDN (Fully Qualified Domain
   Name) of the KDC server. The value will be set to JVM's
   java.security.krb5.kdc.
   
   .. code-block:: properties

      jvm.java.security.krb5.kdc=kdc.example.com

.. setting:: jvm.java.security.krb5.realm

   *Type*: string

   Required if using Kerberos. This is the default REALM for Kerberos.
   It is being used for JVM's java.security.krb5.realm.

   .. code-block:: properties

      jvm.java.security.krb5.realm=EXAMPLE.COM

.. setting:: mms.kerberos.principal

   *Type*: string

   Required if using Kerberos. The principal used to authenticate with
   MongoDB. This should be the exact same user on the
   :setting:`mongo.mongoUri` above.

   .. code-block:: properties

      mms.kerberos.principal=mms/mmsweb.example.com@EXAMPLE.COM

.. setting:: mms.kerberos.keyTab

   *Type*: string

   Required if using Kerberos. The absolute path to the keytab file for
   the principal.

   .. code-block:: properties

      mms.kerberos.keyTab=/path/to/mms.keytab

.. setting:: mms.kerberos.debug

   *Type*: boolean

   The debug flag to output more information on Kerberos authentication
   process.

   .. code-block:: properties

      mms.kerberos.debug=false

.. _encrypt-mongodb-user-credentials:

Encrypt User Credentials
------------------------

For configuration settings that store credentials, you can either store
the credentials in plain text or use the |onprem| ``credentialstool``
to encrypt the credentials. If you choose to store credentials in plain
text, reduce the permissions on the :ref:`conf-mms.properties <conf-mms.properties>` 
file on each server.

.. note:: 

   **Protect Plain Text Passwords**

   If you choose to store credentials in plain text, reduce the
   permissions on the :ref:`conf-mms.properties <conf-mms.properties>`
   file on each server.

   .. list-table::
      :widths: 25 75
      :header-rows: 1

      * - Operating System

        - Permission Changes

      * - Linux

        - ``sudo chmod 600 <install_dir>/conf/conf-mms.properties``

      * - Windows
         
        - Restrict access to only the users and/or groups that need to
          modify :ref:`conf-mms.properties <conf-mms.properties>`.

.. important::

   When installed with ``rpm`` or ``deb`` packages, the
   ``credentialstool`` tool requires root (``sudo``) privileges,
   because it modifies the ``/etc/mongodb-mms/gen.key`` file. |onprem|
   uses the ``gen.key`` to encrypt sensitive data in the database and
   configuration files.

Use the ``credentialstool`` to generate encrypted credentials for the MongoDB deployments:

.. include:: /includes/steps/encrypt-using-credentialstool.rst

.. _default-automation-paths:

Default Paths for Automation
----------------------------

You can modify various default paths for Automation. To modify these
paths, click the :guilabel:`Admin` link in the top right corner of
|onprem| to access the settings panels. From the :guilabel:`General`
tab, go to :guilabel:`Ops Manager Config` and select the
:guilabel:`Custom` tab.

.. setting:: automation.default.dataRoot

   *Default*: ``/data``

   The default data path for the MongoDB databases managed by Automation.

.. setting:: automation.default.downloadBase

   *Default*: ``/var/lib/mongodb-mms-automation``

   The default path for the Monitoring Agent, Backup Agent, and MongoDB
   binaries for the deployments managed by Automation on Linux/OSX.

.. setting:: automation.default.downloadBaseWindows

   *Default*:  ``%SystemDrive%\\MMSAutomation\\versions``

   The default path for the Monitoring Agent, Backup Agent, and MongoDB
   binaries for the deployments managed by Automation on Windows.

.. setting:: automation.default.monitoringAgentLogFile

   *Default*:  ``/var/log/mongodb-mms-automation/monitoring-agent.log``

   The default path for the Monitoring Agent logs on Linux/OSX.

.. setting:: automation.default.monitoringAgentLogFileWindows

   *Default*:  ``%SystemDrive%\\MMSAutomation\\log\\mongodb-mms-automation\\monitoring-agent.log``

   The default path for the Monitoring Agent logs on Windows.

.. setting:: automation.default.backupAgentLogFile

   *Default*:  ``/var/log/mongodb-mms-automation/backup-agent.log``

   The default path for the Backup Agent logs on Linux/OSX.

.. setting:: automation.default.backupAgentLogFileWindows

   *Default*:  ``%SystemDrive%\\MMSAutomation\\log\\mongodb-mms-automation\\backup-agent.log``

   The default path for the Backup Agent logs on Windows.

.. setting:: automation.default.certificateAuthorityFile

   The default path for the Certificate Authority (CA) file on Linux/OSX.
   
.. setting:: automation.default.certificateAuthorityFileWindows

   The default path for the Certificate Authority (CA) file on Windows.
