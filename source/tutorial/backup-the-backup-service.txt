================
Back Up |onprem|
================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. tabs-pillstrip:: platforms

Deploying the |onprem| Backup Blockstore and Application databases as
:term:`replica sets <replica set>` is key to protect the databases from
failure.

Ensure you configure and deploy your replica sets for failover and
redundancy.

.. seealso::

   To learn more about replica set architecture:

   - :manual:`Replica Set High Availability </core/replica-set-high-availability>`
   - :manual:`Replica Set Deployment Architectures </core/replica-set-architectures>`

Beyond using MongoDB's replication capabilities, you can create
backups for the Backup Blockstore database and Application database,
both for longterm storage of snapshots, and for backing
up |onprem| for disaster recovery purposes.

To restore |onprem|, you only need backups of the Application database
and the Backup Blockstore database. |onprem|'s other components are
stateless: you can rebuild them from the installation package if need
be.

.. important::

   Your Backup installation cannot back up |onprem|. If you wish to
   use |onprem| to back up |onprem|, you will need *two* |onprem|
   installations: one to back up your MongoDB deployment,
   and another to back up your |onprem| databases.

Back Up with the Public API
---------------------------

The |mms| Public API allows you to programmatically restore snapshots
on your desired schedule, and store them offline. Ideally, you should
save the backups to a tape drive, appending the new snapshots daily
until the drive is full, and then store the drive offsite.

Programmatically restoring snapshots has the same impact on a
snapshot as a typical restore.

See :doc:`the API documentation </reference/api/restore-jobs>` for how
to restore jobs using this method.

This method backs up the snapshots only: you **cannot** use the backups
to restore |onprem| in the event that a Blockstore database is lost.

.. _backup-opsmgr:

Shut Down and Back Up |onprem|
------------------------------

To perform a full backup of all snapshots contained in |onprem|,
including the point-in-time restores:

.. tabs-platforms::

   .. tab::
      :tabid: windows

      Use this procedure to back up the |application| on hosts running
      Microsoft Windows:

      .. include:: /includes/steps/backup-om-windows.rst

   .. tab::
      :tabid: debian

      Use this procedure to back up the |application| on hosts
      installed using ``deb`` packages:

      .. include:: /includes/steps/backup-om-linux.rst

   .. tab::
      :tabid: rhel

      Use this procedure to back up the |application| on hosts
      installed using ``rpm`` packages:

      .. include:: /includes/steps/backup-om-linux.rst

   .. tab::
      :tabid: linux

      Use this procedure to back up Linux systems that don't use
      ``deb`` or ``rpm`` packages.

      .. include:: /includes/steps/backup-om-linux.rst

While this procedure makes all of |onprem|'s backup snapshots *and* the
|pit| restores available, it involves significant downtime, During the
shutdown, |onprem|, monitoring, and automation are unavailable.

As a result, if one of your MongoDB instances fails:

- You may lose the data that |onprem| didn't back up prior to shutdown.
- You can't be alerted of the loss of data.

.. seealso:: :manual:`Back up and Restore with Filesystem Snapshots
   </tutorial/backup-with-filesystem-snapshots/>`.
