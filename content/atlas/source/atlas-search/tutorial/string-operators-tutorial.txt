.. facet::
   :name: programming_language
   :values: csharp, go, java, javascript/typescript, kotlin, python, shell

.. _query-nonstring-tutorial:

==============================================
How to Search Non-Alphabetical Data as Strings
==============================================

.. default-domain:: mongodb

.. meta::
   :keywords: convert date field to string, convert number field to string, queryString operator, autocomplete operator, logical and, logical or, compound operator, should clause, code example, java sync, node.js, compass
   :description: In this tutorial, learn how to create a materialized view to query non-string fields with operators that only support strings.

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. composable-tutorial::
   :options: deployment-type, interface, language
   :defaults: atlas, mongosh, None

   This tutorial demonstrates how to run string-specific queries against
   non-string fields by converting the fields to strings and storing
   them in a :manual:`materialized view </core/materialized-views/>`.
   The materialized view lets you use string-specific operators to query
   the converted fields and keep the original data intact in the source
   collection.

   This tutorial takes you through the following steps:

   1. :ref:`Create a materialized view on a sample collection <query-nonstring-create-mv>`
   #. :ref:`Create {+fts+} indexes on the materialized view <query-nonstring-create-index>`
   #. :ref:`Run {+fts+} queries against the converted fields in the
      materialized view <query-nonstring-run-queries>`

   .. include:: /includes/fts/fts-design-patterns-prereqs.rst

   .. _query-nonstring-create-mv:

   Create a Materialized View
   --------------------------

   This section demonstrates how to create a 
   :manual:`materialized view </core/materialized-views/>` 
   named ``airbnb-mat-view`` on the 
   :ref:`sample_airbnb.listingsAndReviews <sample-airbnb>` collection. 
   This view stores various numeric and date fields from the source 
   collection as string fields.

   .. .. selected-content::
   ..    :selections: atlas, atlas-admin-api, None

   .. selected-content::
      :selections: atlas, atlas-ui, None

      .. include:: /includes/fts/string-tutorial/steps-create-materialized-view-ui.rst

   .. .. selected-content::
   ..    :selections: atlas, atlas-cli, None

   .. .. selected-content::
   ..    :selections: local-onprem, atlas-cli, None

   .. selected-content::
      :selections: atlas, compass, None

      .. include:: /includes/fts/string-tutorial/steps-create-materialized-view-compass.rst

   .. selected-content::
      :selections: local-onprem, compass, None

      .. include:: /includes/fts/string-tutorial/steps-create-materialized-view-compass.rst

   .. selected-content:: 
      :selections: atlas, mongosh, None

      .. include:: /includes/fts/string-tutorial/steps-create-materialized-view-mongosh.rst

   .. selected-content:: 
      :selections: local-onprem, mongosh, None

      .. include:: /includes/fts/string-tutorial/steps-create-materialized-view-mongosh.rst

   .. .. selected-content::
   ..    :selections: atlas, driver, c

   ..    .. include:: /includes/fts/string-tutorial/steps-create-materialized-view-c.rst

   .. .. selected-content::
   ..    :selections: local-onprem, driver, c

   ..    .. include:: /includes/fts/string-tutorial/steps-create-materialized-view-c.rst

   .. selected-content::
      :selections: atlas, driver, csharp

      .. include:: /includes/fts/string-tutorial/steps-create-materialized-view-csharp.rst

   .. selected-content::
      :selections: local-onprem, driver, csharp

      .. include:: /includes/fts/string-tutorial/steps-create-materialized-view-csharp.rst

   .. .. selected-content::
   ..    :selections: atlas, driver, cpp

   .. .. selected-content::
   ..    :selections: local-onprem, driver, cpp

   .. selected-content::
      :selections: atlas, driver, go

      .. include:: /includes/fts/string-tutorial/steps-create-materialized-view-go.rst

   .. selected-content::
      :selections: local-onprem, driver, go

      .. include:: /includes/fts/string-tutorial/steps-create-materialized-view-go.rst

   .. selected-content::
      :selections: atlas, driver, java-sync

      .. include:: /includes/fts/string-tutorial/steps-create-materialized-view-java.rst

   .. selected-content::
      :selections: local-onprem, driver, java-sync

      .. include:: /includes/fts/string-tutorial/steps-create-materialized-view-java.rst

   .. .. selected-content::
   ..    :selections: atlas, driver, kotlin-coroutine

   .. .. selected-content::
   ..    :selections: local-onprem, driver, kotlin-coroutine

   .. selected-content::
      :selections: atlas, driver, nodejs

      .. include:: /includes/fts/string-tutorial/steps-create-materialized-view-nodejs.rst

   .. selected-content::
      :selections: local-onprem, driver, nodejs

      .. include:: /includes/fts/string-tutorial/steps-create-materialized-view-nodejs.rst
       
   .. selected-content::
      :selections: atlas, driver, python

      .. include:: /includes/fts/string-tutorial/steps-create-materialized-view-python.rst

   .. selected-content::
      :selections: local-onprem, driver, python

      .. include:: /includes/fts/string-tutorial/steps-create-materialized-view-python.rst

   .. _query-nonstring-create-index:

   Create |fts| Indexes on the Materialized View 
   ---------------------------------------------

   To run the queries in the :ref:`query-nonstring-run-queries` stage of
   this tutorial, you need to create |fts| indexes on the converted
   string fields in your ``airbnb_mat_view`` materialized view.

   The following |json| definitions define {+fts+} indexes on the
   ``airbnb_mat_view`` materialized view. You can use dynamic or static
   mappings to specify which fields you want to index in your
   collection, depending on the type of queries you want to run. To
   learn more about field mappings or {+fts+} index syntax, see
   :ref:`fts-field-mappings` or :ref:`ref-index-definitions`,
   respectively.
   
   .. tabs:: 

      .. tab:: Dynamic Mappings
         :tabid: dynamic

         The following |json| {+fts+} index definition uses
         :ref:`dynamic mappings <fts-dynamic-mappings>` to index the
         fields in the materialized view. You can use this index to run
         queries using the :ref:`queryString <querystring-ref>`
         operator.

         You can't run queries using the :ref:`autocomplete
         <autocomplete-ref>` operator against dynamically indexed
         fields.

         .. literalinclude:: /includes/fts/string-tutorial/mv-index-definition-dynamic.json 

      .. tab:: Static Mappings
         :tabid: static

         The following |json| {+fts+} index definition uses :ref:`static
         mappings <fts-static-mappings>` to index the fields in the
         materialized view as the :ref:`autocomplete type
         <bson-data-types-autocomplete>`. You can use this index to run
         queries using the :ref:`autocomplete operator
         <autocomplete-ref>`.
         
         You can't run queries using the :ref:`queryString
         <querystring-ref>` operator against fields indexed as type
         ``autocomplete``.
   
         .. literalinclude:: /includes/fts/string-tutorial/mv-index-definition-static.json
   
   To learn how to create the indexes defined above using your preferred
   interface, see :ref:`fts-manage-indexes`.

   .. _query-nonstring-run-queries:

   Run Queries on the Converted Fields 
   -----------------------------------

   You can run queries against the numeric and date fields that were 
   converted to strings. This tutorial uses :ref:`queryString <querystring-ref>` and 
   :ref:`autocomplete <autocomplete-ref>` operators to search for properties. The query 
   uses the following pipeline stages:

   - :pipeline:`$search` stage to search the collection
   - :pipeline:`$limit` stage to limit the output to ``5`` results 
   - :pipeline:`$project` stage to exclude ``_id``

   In this section, you connect to your |service| {+cluster+} and run 
   the sample queries using the operator against the fields in the 
   ``airbnb_mat_view`` collection. 

   .. note:: 

      You can't run :ref:`near <near-ref>` or :ref:`range <range-ref>` queries against 
      the date and number fields that were converted to strings in your 
      materialized view.

   .. .. selected-content::
   ..    :selections: atlas, atlas-admin-api, None

   .. selected-content::
      :selections: atlas, atlas-ui, None

      .. include:: /includes/fts/date-number-to-string/procedures/steps-fts-date-number-query-ui.rst

   .. .. selected-content::
   ..    :selections: atlas, atlas-cli, None

   .. .. selected-content::
   ..    :selections: local-onprem, atlas-cli, None

   .. selected-content::
      :selections: atlas, compass, None

      .. include:: /includes/fts/date-number-to-string/procedures/steps-fts-date-number-query-compass.rst

   .. selected-content::
      :selections: local-onprem, compass, None

      .. include:: /includes/fts/date-number-to-string/procedures/steps-fts-date-number-query-compass.rst

   .. selected-content:: 
      :selections: atlas, mongosh, None

      .. include:: /includes/fts/date-number-to-string/procedures/steps-fts-date-number-query-mongosh.rst

   .. selected-content:: 
      :selections: local-onprem, mongosh, None

      .. include:: /includes/fts/date-number-to-string/procedures/steps-fts-date-number-query-mongosh.rst

   .. .. selected-content::
   ..    :selections: atlas, driver, c

   .. .. selected-content::
   ..    :selections: local-onprem, driver, c

   .. selected-content::
      :selections: atlas, driver, csharp

      .. include:: /includes/fts/date-number-to-string/procedures/steps-fts-date-number-query-csharp.rst

   .. selected-content::
      :selections: local-onprem, driver, csharp

      .. include:: /includes/fts/date-number-to-string/procedures/steps-fts-date-number-query-csharp.rst

   .. .. selected-content::
   ..    :selections: atlas, driver, cpp

   .. .. selected-content::
   ..    :selections: local-onprem, driver, cpp

   .. selected-content::
      :selections: atlas, driver, go

      .. include:: /includes/fts/date-number-to-string/procedures/steps-fts-date-number-query-query-go.rst

   .. selected-content::
      :selections: local-onprem, driver, go

      .. include:: /includes/fts/date-number-to-string/procedures/steps-fts-date-number-query-query-go.rst

   .. selected-content::
      :selections: atlas, driver, java-sync

      .. include:: /includes/fts/date-number-to-string/procedures/steps-fts-date-number-query-java.rst

   .. selected-content::
      :selections: local-onprem, driver, java-sync

      .. include:: /includes/fts/date-number-to-string/procedures/steps-fts-date-number-query-java.rst

   .. .. selected-content::
   ..    :selections: atlas, driver, kotlin-coroutine

   ..    .. include:: /includes/fts/date-number-to-string/procedures/steps-fts-date-number-query-kotlin.rst

   .. .. selected-content::
   ..    :selections: local-onprem, driver, kotlin-coroutine

   ..    .. include:: /includes/fts/date-number-to-string/procedures/steps-fts-date-number-query-kotlin.rst

   .. selected-content::
      :selections: atlas, driver, nodejs

      .. include:: /includes/fts/date-number-to-string/procedures/steps-fts-date-number-query-nodejs.rst

   .. selected-content::
      :selections: local-onprem, driver, nodejs

      .. include:: /includes/fts/date-number-to-string/procedures/steps-fts-date-number-query-nodejs.rst

   .. selected-content::
      :selections: atlas, driver, python

      .. include:: /includes/fts/date-number-to-string/procedures/steps-fts-date-number-query-python.rst

   .. selected-content::
      :selections: local-onprem, driver, python

      .. include:: /includes/fts/date-number-to-string/procedures/steps-fts-date-number-query-python.rst