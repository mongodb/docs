.. _scale-cluster:

================
Modify a Cluster
================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

|service| Configuration Options
-------------------------------

You can modify the following properties of your |service| cluster:

.. list-table::
   :widths: 20 40

   * - :ref:`Cloud Provider & Region <scale-cluster-cloud-provider>`

     - .. include:: /includes/fact-modify-cloud-provider.rst

       .. note::

          .. include:: /includes/fact-modify-cloud-provider-live-migrate.rst

       For dedicated clusters with a :guilabel:`Cluster Tier` of
       ``M10`` or larger, you can modify cluster's region.

   * - :ref:`Deploy or Configure a multi-region cluster <scale-cluster-region>`
     - You can deploy or modify a multi-region cluster.

       Only available for cluster with a :guilabel:`Cluster Tier`
       of ``M10`` or larger.

   * - :ref:`Cluster Tier <scale-cluster-instance>`

     - You can modify the cluster tier.

   * - :ref:`Cluster Storage Options <scale-cluster-storage>`

     - You can modify the storage options for the selected cluster tier.

       Only available for cluster with a :guilabel:`Cluster Tier`
       of ``M10`` or larger.

   * - :ref:`MongoDB Version <scale-cluster-version>`

     - You can upgrade the major MongoDB version of the cluster.

       Only available for cluster with a :guilabel:`Cluster Tier`
       of ``M10`` or larger.

       You cannot downgrade the MongoDB version of a cluster.

   * - :ref:`Deploy a Sharded Cluster <scale-cluster-sharding>`

     - If your cluster is a replica set, you can upgrade the deployment
       to a sharded cluster.

       Only available for clusters with a :guilabel:`Cluster Tier` of
       ``M30`` or larger.

   * - :ref:`Modify the Number of Shards <scale-cluster-shardNum>`

     - You can configure the number of shards in the sharded cluster. 

       Only available for sharded cluster deployments.

   * - :ref:`Enable or Disable Backup <scale-cluster-backups>`

     - You can enable or disable backups for the cluster. Only
       available for clusters with a :guilabel:`Cluster Tier` of
       ``M10`` or larger.

   * - :ref:`Enable or Disable the Business Intelligence Connector <create-cluster-enable-bi>`

     - You can enable or disable the |bic| for this cluster.

       .. include:: /includes/extracts/cluster-option-bi-cluster-requirements.rst

   * - :ref:`Confirm and Deploy <scale-cluster-payment>`

     - Confirm and deploy your cluster with the selected changes.

Considerations
--------------

Migration, Availability, and Performance Impact
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The time required for an :term:`initial sync` and resynchronizing data
across storage volumes increases linearly with the amount of data in
the cluster. Making changes to a cluster often requires migrating to
new servers and storage volumes, which can take a long time. However,
cluster changes can be made more quickly in some cases. For example,
changing the tier of a cluster on AWS does not require an
initial sync.

.. admonition:: Changes to Free/Shared Tier clusters result in limited downtime
   :class: note

   All changes to ``M0``, ``M2``, and ``M5`` clusters require 7-10 minutes of downtime.

To maximize availability:

- For a replica set, |service| migrates one node at a time, starting
  with the secondary nodes first and then the primary.

- For a sharded cluster, |service| performs the migration of the shards
  independently of each other. For each shard (i.e. replica set),
  |service| migrates one node at a time, starting with the secondary
  nodes first and then the primary.

:manual:`Retryable writes </core/retryable-writes>` should prevent any
write errors during the election of a new primary. On average, an
election can take five seconds.

Migration can affect performance if your primary is already reaching
operational capacity: each newly migrated replica set node must
perform an :term:`initial sync` from the primary, adding to the
operational load. Migrations can also affect performance if
:manual:`read preferences </core/read-preference>` are set to read from
secondaries: the replica set is down one secondary during the
migration.

.. include:: /includes/fact-auto-index.rst

.. Note to writers: beginning in v20160712, a cluster tier change
.. with no disk change does not require an initial sync

Host Names Can Become Inconsistent with Respect to Node Types
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/fact-node-type-topology-warning.rst

Billing
~~~~~~~

As you modify your cluster, you can compare the costs of different
options before applying them. The :guilabel:`Cluster Overview` box
displays the cost of the selected configuration, excluding data
transfer.

.. admonition:: Free Tier
   :class: important

   Upgrading an ``M0`` Free Tier cluster to an ``M2`` or greater paid
   tier cluster starts billing for the cluster. See :doc:`billing` for
   complete documentation on |service| billing.

The following sections provide complete documentation for each of the
|service| cluster scaling configuration options.

.. _scale-cluster-open-dialog:

Open the :guilabel:`Editing Cluster` Dialog
-------------------------------------------

For the cluster you want to modify, click the ellipses :guilabel:`...`
icon, then select :guilabel:`Edit Configuration`.

Alternatively, if you are already viewing the specific cluster,
click the :guilabel:`Configuration` button.

For ``M0`` Free Tier clusters, you can also click the
:guilabel:`Upgrade` button for the cluster.

.. _scale-cluster-region:
.. _scale-cluster-cloud-provider:

Modify the :guilabel:`Cloud Provider & Region`
----------------------------------------------

Considerations
~~~~~~~~~~~~~~

- .. include:: /includes/fact-modify-cloud-provider.rst

- .. include:: /includes/fact-modify-cloud-provider-live-migrate.rst


Procedure
~~~~~~~~~

Select :guilabel:`Cloud Provider & Region` to view the
currently configured cloud provider and region for the cluster.

Select the desired cloud provider and region for your cluster.

If you are upgrading from an |service| ``M0`` Free Tier or ``M2/M5``
shared-tier cluster, you can change the cloud provider backing your
cluster by selecting from the available cloud providers.

For details on cloud providers and regions for both single-region
and multi-region clusters,
see :ref:`create-cluster-cloud-provider-region`.

For more information on moving a cluster to a new region, see
:ref:`move-cluster`.

.. _scale-cluster-storage:
.. _scale-cluster-instance:

Modify the :guilabel:`Cluster Tier`
-----------------------------------

You can change the cluster tier, as well as the memory, storage,
and |iops| (speed) specifications for the selected cluster.

Free and Shared-Tier Cluster Considerations
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- You cannot downgrade an ``M10+`` cluster to an 
  ``M0`` Free Tier or ``M2/M5`` Shared-Tier Starter instance size.

- Changing the cluster tier from an ``M0`` Free Tier or ``M2/M5``
  Shared-Tier cluster to an ``M10`` or larger cluster tier requires
  downtime.

Procedure
~~~~~~~~~

Select your preferred cluster tier. The selected instance
size dictates the  memory, storage, and IOPS specification for each
data-bearing server [#data-bearing]_ in the cluster.

For more information on cluster tiers, see
:ref:`create-cluster-instance`.

From the :guilabel:`Cluster Tier` section, you can also
:ref:`create-cluster-storage`.

Modify :guilabel:`Additional Settings`
--------------------------------------

From the :guilabel:`Additional Settings` section, you can

- :ref:`scale-cluster-version`,
- :ref:`scale-cluster-backups`,
- :ref:`scale-cluster-sharding`,
- :ref:`scale-cluster-shardNum`,
- :ref:`scale-cluster-enable-bi`,
- :ref:`scale-cluster-enable-encryption`, and
- :ref:`scale-cluster-more-configuration-options`.

.. _scale-cluster-version:

Upgrade the MongoDB Version of the Cluster
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. container:: admonition

   Select :guilabel:`Additional Settings` to view the currently
   configured MongoDB version for the cluster.

   .. include:: /includes/extracts/fact-mongodb-version-downgrade-restriction-scale.rst

#. Select the new MongoDB version from the
   :guilabel:`Select a version` dropdown. |service| supports the
   following upgrade paths:

   - MongoDB 3.4 -> MongoDB 3.6
   - MongoDB 3.6 -> MongoDB 4.0
   - MongoDB 4.0 -> MongoDB 4.2

   .. note::

      If you have a sharded cluster running a MongoDB version less than
      4.2, you cannot upgrade that sharded clusterâ€™s MongoDB version to
      4.2 if you are using
      :doc:`Continuous Backups </backup/continuous-backups>`. Sharded
      clusters running MongoDB 4.2 must use
      :doc:`/backup/cloud-provider-snapshots`.

   See :doc:`/tutorial/major-version-change` for the
   MongoDB-recommended procedure for a major version change. This
   procedure includes creating a staging cluster for the purpose of
   testing and validating application and cluster performance and
   functionality on the new MongoDB version.

.. _scale-cluster-sharding:

Scale your Replica Set to a Sharded Cluster
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. note::

   Sharded clusters running MongoDB 4.2 must use
   :doc:`/backup/cloud-provider-snapshots`.

To deploy your cluster as a :term:`sharded cluster <sharded cluster>`,
toggle :guilabel:`Shard your cluster (M30 and up)` to ``Yes``.

For more information on deploying a sharded cluster, see
:ref:`create-cluster-sharding`.

.. _scale-cluster-shardNum:

Modify the :guilabel:`Number of Shards`
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/extracts/cluster-option-clusterShardingNum.rst

.. _scale-cluster-backups:

Enable or Disable Backup for the Cluster
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Backups are automatically enabled for ``M2`` and ``M5`` shared-tier
clusters and cannot be disabled. For more information, see
:doc:`/backup/m2-m5-snapshots`.

To enable backups for an ``M10+`` |service| cluster, toggle
:guilabel:`Turn on Backup (M10 and up)` to ``Yes``.
If enabled, |service| takes snapshots of your databases at
regular intervals and retains them according to your project's
:ref:`retention policy <retention-policy>`.

For detailed descriptions of the available backup options, see
:ref:`create-cluster-backups`.

.. _scale-cluster-enable-bi:

Enable or Disable |bic| for the Cluster
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

To enable `BI Connector for Atlas
<https://docs.mongodb.com/bi-connector/master/>`__ for this cluster,
toggle :guilabel:`Enable Business Intelligence Connector (M10 and
up)` to :guilabel:`Yes`.

For more information on the |bic|, see
:ref:`create-cluster-enable-bi`.

.. _scale-cluster-enable-encryption:

Enable Encryption at Rest
~~~~~~~~~~~~~~~~~~~~~~~~~

To enable |service| Encryption at Rest for this cluster,
toggle :guilabel:`Encryption At Rest with WiredTiger Encrypted Storage Engine (M10 and up)`
to :guilabel:`Yes`.

For more information on |service| Encryption at Rest, see
:ref:`create-cluster-enable-encryption`.

.. _scale-cluster-more-configuration-options:

Configure Additional Configuration Options
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Configure additional options for your cluster from this section.

For details on these options, see
:ref:`create-cluster-more-configuration-options`.

.. _scale-cluster-payment:

Confirm and Deploy Your Changes
-------------------------------

Click :guilabel:`Confirm & Deploy` deploy your changes.

If you are upgrading from an ``M0`` Free Tier cluster, |service|
prompts you to enter payment information before deploying your
changes.

.. include:: /includes/footnote-databearing.rst

.. class:: hidden

   .. toctree::
      :titlesonly:
      
      /tutorial/major-version-change
      /tutorial/move-cluster
