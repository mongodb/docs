stepnum: 1
source:
  ref: ulimits
  file: steps-prepare-servers-basic-install.yaml
---
stepnum: 2
source:
  ref: install-mongodb
  file: steps-prepare-servers-basic-install.yaml
---
title: Create the data directories for the replica set.
stepnum: 3
ref: data-directories
pre: |
  Create a data directory for each replica set member and set
  ``mongod.mongod`` as each data directory's owner.
action:
  - pre: |
      For example, the following command creates the directory ``/data`` and
      then creates a data directory for each member of the replica set. You
      can use different directory names:
    language: sh
    code: |
      sudo mkdir -p /data /data/mdb1 /data/mdb2 /data/mdb3
  - pre: |
      The following command sets ``mongod.mongod`` as owner of the new
      directories:
    language: sh
    code: |
      sudo chown mongod:mongod /data /data/mdb1 /data/mdb2 /data/mdb3
---
title: Start a separate MongoDB instance for each replica set member.
stepnum: 4
ref: mongod-instances
pre: |
  Start each :program:`mongod` instance on its own dedicated port number and
  with the data directory you created in the last step. For each instance,
  specify ``mongod`` as the user. Start each instance with the replSet
  :manual:`command-line option </reference/program/mongod>` specifying the
  name of the replica set.
action:
  pre: |
    For example, the following three commands start three members of a new
    replica set named ``rs0``:
  language: sh
  code: |
    sudo -u mongod mongod --port 27017 --dbpath /data/mdb1 --replSet rs0 --logpath /data/mdb1/mongodb.log --fork

    sudo -u mongod mongod --port 27018 --dbpath /data/mdb2 --replSet rs0 --logpath /data/mdb2/mongodb.log --fork

    sudo -u mongod mongod --port 27019 --dbpath /data/mdb3 --replSet rs0 --logpath /data/mdb3/mongodb.log --fork
---
title: Connect to one of the members.
stepnum: 5
ref: connect
action:
  pre: |
    For example, the following command connects to the member running on port ``27017``:
  language: sh
  code: |
    mongo --port 27017
---
title: Initiate the replica set and add members.
stepnum: 6
ref: initiate
action:
  pre: |
    In the :program:`mongo` shell, issue the :manual:`rs.initiate()
    </reference/method/rs.initiate>` and :manual:`rs.add()
    </reference/method/rs.add>` methods, as shown in the following example.
    **Replace the hostnames in the example** with the hostnames of your
    servers:
  language: sh
  code: |
    rs.initiate()
    rs.add("mdb.example.net:27018")
    rs.add("mdb.example.net:27019")
---
title: Verify the replica set configuration.
stepnum: 7
ref: verify-configuration
action:
  pre: |
    Issue the :manual:`rs.conf() </reference/method/rs.conf>` method and
    verify that the ``members`` array lists the three members:
  language: sh
  code: |
    rs.conf()
---
title: Add data to the replica set.
stepnum: 8
ref: add-data
action:
  pre: |
    Issue the following ``for`` loop to create a collection titled
    ``testData`` and populate it with 25,000 documents, each with an ``_id``
    field and a field ``x`` set to a random string.
  language: javascript
  code: |
    for (var i = 1; i <= 25000; i++) {
      db.testData.insert( { x : Math.random().toString(36).substr(2, 15) } );
      sleep(0.1);
    }
---
title: Confirm data entry.
stepnum: 9
ref: confirm-data
action:
  - pre: |
      After the script completes, you can view a document in the ``testData``
      collection by issuing the following:
    language: javascript
    code: |
      db.testData.findOne()
  - pre: |
      To confirm that the script inserted 25,000 documents into the
      collection, issue the following:
    language: javascript
    code: |
      db.testData.count()
---
title: Open the MMS home page in a web browser and register the first user.
stepnum: 10
ref: register
action:
  - pre: |
      Enter the following URL in a web browser, where ``<ip_address>`` is the
      IP address of the server:
    language: none
    code: |
      http://<ip_address>:8080
  - pre: |
      Click the :guilabel:`Register` link and enter the user's information.
      When you finish, you are logged into the MMS application. For more
      information on creating and managing users, see
      :doc:`/tutorial/manage-users`.
---
title: Set up monitoring for the replica set.
stepnum: 11
ref: set-up-monitoring
pre: |
content: |
  If you have installed the :ref:`MMS Backup Daemon <backup-daemon>`, click
  the :guilabel:`Get Started` button for :guilabel:`Backup` and follow the
  instructions. This will set up both monitoring and backup. Otherwise click
  the :guilabel:`Get Started` button for :guilabel:`Monitoring` and follow
  instructions.

  When prompted to add a host, enter the hostname and port of one of the
  replica set members in the form ``<hostname>:<port>``. For example:
  ``mdb.example.net:27018``

  When you finish the instructions, MMS On Prem is running and
  monitoring the replica set.
...
