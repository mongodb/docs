=================
Snapshot Schedule
=================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: twocols

This resource allows you to view and configure various properties of snapshot
creation and retention for a replica set or cluster.

Endpoints
---------

Get the Snapshot Schedule
~~~~~~~~~~~~~~~~~~~~~~~~~

Get the snapshot schedule for a cluster. ``CLUSTER-ID`` must be the ID of
either a replica set or a sharded cluster.

.. code-block:: none

   GET /api/public/v1.0/groups/GROUP-ID/backupConfigs/CLUSTER-ID/snapshotSchedule

Update the Snapshot Schedule
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Change the parameters of snapshot creation and retention. Any
combination of the snapshot schedule's attributes can be modified.

.. code-block:: none

   PATCH /api/public/v1.0/groups/GROUP-ID/backupConfigs/CLUSTER-ID/snapshotSchedule

Sample Entity
-------------

.. code-block:: javascript

   {
     "groupId": "525ec8394f5e625c80c7404a",
     "clusterId": "5640e0cbe4b012df7a3fe85a",
     "snapshotIntervalHours": 6,
     "snapshotRetentionDays": 3,
     "clusterCheckpointIntervalMin": 15,
     "dailySnapshotRetentionDays": 14,
     "weeklySnapshotRetentionWeeks": 6,
     "monthlySnapshotRetentionMonths": 12,
     "pointInTimeWindowHours": 24
   }

Entity Fields
-------------

.. only:: onprem

   .. list-table::
      :widths: 10 10 80
      :header-rows: 1

      * - Name
        - Type
        - Description
      * - ``groupId``
        - string
        - ID of the group that owns the backup configuration.
      * - ``clusterId``
        - string
        - ID of the cluster to which this backup configuration applies.
      * - ``snapshotIntervalHours``
        - number
        - Number of hours between snapshots. Supported values are ``6``, ``8``, ``12``, and ``24``.
      * - ``snapshotRetentionDays``
        - number
        - Number of days to keep recent snapshots. Supported values are ``1`` - ``5``.
      * - ``clusterCheckpointIntervalMin``
        - number
        - Number of minutes between successive cluster checkpoints. This only
          applies to sharded clusters. This number determines the granularity of
          point-in-time restores for sharded clusters. Supported values are ``15``, ``30``, and ``60``.
      * - ``dailySnapshotRetentionDays``
        - number
        - Number of days to retain daily snapshots. Supported values are ``1`` - ``365``.
      * - ``weeklySnapshotRetentionWeeks``
        - number
        - Number of weeks to retain weekly snapshots. Supported values are ``1`` - ``52``.
      * - ``monthlySnapshotRetentionMonths``
        - number
        - Number of months to retain monthly snapshots. Supported values are ``1`` - ``36``.
      * - ``pointInTimeWindowHours``
        - number
        - Number of hours in the past for which a point-in-time snapshot
          can be created.
      * - ``referenceHourOfDay``
        - number
        - Hour of the day to schedule snapshots using a 24 hour clock. 
          Default value is ``0`` (midnight), and supported values are ``0`` - ``23``.
      * - ``referenceMinuteOfHour``
        - number
        - Minute of the hour to schedule snapshots. Default value is ``0``
          and supported values are ``0`` - ``59``.
      * - ``referenceTimeZoneOffset``
        -  string
        - The `ISO-8601 timezone offset <https://en.wikipedia.org/w/index.php?title=ISO_8601&oldid=770632564#Time_offsets_from_UTC>`_
          where the |onprem| host resides. To avoid problems with daylight
          saving time, use UTC. The default is ``+0000``, which is equivalent
          to UTC. ``Z`` is also a supported value and equivalent to UTC. 

.. only:: cloud

   .. list-table::
      :widths: 10 10 80
      :header-rows: 1

      * - Name
        - Type
        - Description
      * - ``groupId``
        - string
        - ID of the group that owns the backup configuration.
      * - ``clusterId``
        - string
        - ID of the cluster to which this backup configuration applies.
      * - ``snapshotIntervalHours``
        - number
        - Number of hours between snapshots. Supported values are ``6``, ``8``, ``12``, and ``24``.
      * - ``snapshotRetentionDays``
        - number
        - Number of days to keep recent snapshots. Supported values are ``1`` - ``5``.
      * - ``clusterCheckpointIntervalMin``
        - number
        - Number of minutes between successive cluster checkpoints. This only
          applies to sharded clusters. This number determines the granularity of
          point-in-time restores for sharded clusters. Supported values are ``15``, ``30``, and ``60``.
      * - ``dailySnapshotRetentionDays``
        - number
        - Number of days to retain daily snapshots. Supported values are ``1`` - ``365``.
      * - ``weeklySnapshotRetentionWeeks``
        - number
        - Number of weeks to retain weekly snapshots. Supported values are ``1`` - ``52``.
      * - ``monthlySnapshotRetentionMonths``
        - number
        - Number of months to retain monthly snapshots. Supported values are ``1`` - ``36``.
      * - ``pointInTimeWindowHours``
        - number
        - Number of hours in the past for which a point-in-time snapshot
          can be created. You cannot change this value for a snapshot.

Links
-----

.. list-table::
   :header-rows: 1

   * - Relation
     - Description
   * - ``self``
     - Me
   * - ``http://mms.mongodb.com/cluster``
     - The cluster that this backup configuration is for.
   * - ``http://mms.mongodb.com/group``
     - The group that owns this backup configuration.
   * - ``http://mms.mongodb.com/backupConfig``
     - The backup configuration that this schedule belongs to.

Examples
--------

Get a Snapshot Schedule
~~~~~~~~~~~~~~~~~~~~~~~

Request
```````

.. only:: cloud

   .. code-block:: none

      curl -i -u "username:apiKey" --digest "https://cloud.mongodb.com/api/public/v1.0/groups/525ec8394f5e625c80c7404a/backupConfigs/53bc556ce4b049c88baec825/snapshotSchedule"

.. only:: onprem

   .. code-block:: none

      curl -i -u "username:apiKey" --digest "https://<ops-manager-host>/api/public/v1.0/groups/525ec8394f5e625c80c7404a/backupConfigs/53bc556ce4b049c88baec825/snapshotSchedule"

Response
````````

.. code-block:: none

   HTTP/1.1 200 OK

   {
     "groupId" : "525ec8394f5e625c80c7404a",
     "clusterId" : "53bc556ce4b049c88baec825",
     "snapshotIntervalHours" : 6,
     "snapshotRetentionDays" : 2,
     "dailySnapshotRetentionDays" : 7,
     "weeklySnapshotRetentionWeeks" : 4,
     "monthlySnapshotRetentionMonths" : 13,
     "pointInTimeWindowHours": 24,
     "links": [ ... ]
   }

Update a Snapshot Schedule
~~~~~~~~~~~~~~~~~~~~~~~~~~

Request
```````

.. only:: cloud

   .. code-block:: none

      curl -i -u "username:apiKey" -H "Content-Type: application/json" --digest -X PATCH "https://cloud.mongodb.com/api/public/v1.0/groups/525ec8394f5e625c80c7404a/backupConfigs/53bc556ce4b049c88baec825/snapshotSchedule" --data '
      {
        "snapshotIntervalHours": 8,
        "dailySnapshotRetentionDays": 14,
        "monthlySnapshotRetentionMonths": 6
      }'

.. only:: onprem

   .. code-block:: none

      curl -i -u "username:apiKey" -H "Content-Type: application/json" --digest -X PATCH "https://<ops-manager-host>/api/public/v1.0/groups/525ec8394f5e625c80c7404a/backupConfigs/53bc556ce4b049c88baec825/snapshotSchedule" --data '
      {
        "snapshotIntervalHours": 8,
        "dailySnapshotRetentionDays": 14,
        "monthlySnapshotRetentionMonths": 6
      }'

Response
````````

.. code-block:: none

   HTTP/1.1 200 OK

   {
     "groupId" : "525ec8394f5e625c80c7404a",
     "clusterId" : "53bc556ce4b049c88baec825",
     "snapshotIntervalHours" : 8,
     "snapshotRetentionDays" : 2,
     "dailySnapshotRetentionDays" : 14,
     "weeklySnapshotRetentionWeeks" : 4,
     "monthlySnapshotRetentionMonths" : 6,
     "pointInTimeWindowHours": 24,
     "links": [ ... ]
   }
