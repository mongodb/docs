========================
Import Data into Cluster
========================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

Data Import Tools
-----------------

You can bring data from existing MongoDB deployments or JSON/CSV files
into |service| using one of the following:

.. list-table::
   :header-rows: 1
   :widths: 35 65

   * - Tools
     - Use Case

   * - :doc:`Live Migrate a replica set </import/live-import>`.

     - To migrate from a MongoDB *replica set*
       into an |service| replica set cluster.

       |service| replica set live migration supports the following 
       migration paths:

       .. list-table::
          :header-rows: 1
          :widths: 45 70
 
          * - | Source Replica Set
              | MongoDB Version
            - | Destination |service| Replica Set
              | MongoDB Version
 
          * - 2.6
            - 3.4 or 3.6
 
          * - 3.0
            - 3.4 or 3.6
 
          * - 3.2
            - 3.4 or 3.6
 
          * - 3.4
            - 3.4 or 3.6

          * - 3.6
            - 3.6

       See :doc:`replica set live migration </import/live-import>`
       documentation for complete prerequisites and instructions.

   * - :doc:`Live Migrate a sharded cluster </import/live-import-sharded>`.

     - To migrate from a MongoDB sharded cluster to an |service| 
       sharded cluster. |service| 
       :doc:`global clusters </global-cluster>` are not valid
       destinations for Live Migration.

       .. list-table::
          :header-rows: 1
          :widths: 45 70

          * - | Source Sharded Cluster
              | MongoDB Version
            - | Destination Sharded Cluster
              | MongoDB Version
        
          * - 3.4
            - 3.4

          * - 3.6
            - 3.6

       See :doc:`sharded cluster live migration </import/live-import-sharded>`
       documentation for complete prerequisites and instructions.

   * - :doc:`mongomirror </import/mongomirror>`

     - To migrate from a MongoDB *replica set* into an |service| 
       cluster.

       :doc:`mongomirror </import/mongomirror>` does not require you to
       shut down your existing replica set or applications.

       .. important::

          - The source MongoDB replica set must be version 2.6 or 
            greater.

          - :doc:`mongomirror </import/mongomirror>` does not import 
            user/role data or copy the ``config`` database.

       See the tutorial :doc:`/import/mongomirror`.

   * - :doc:`mongorestore </import/mongorestore>`

     - To seed an |service| cluster with a BSON dump backup of an
       existing MongoDB deployment.

       .. important::

          :doc:`mongorestore </import/mongorestore>` does not restore
          ``system.profile`` collection data.

       See the tutorial :doc:`/import/mongorestore`.

   * - :doc:`mongoimport </import/mongoimport>`

     - To load data from a ``JSON`` or a ``CSV`` file into an |service|
       cluster.

       .. important::

          :binary:`mongoimport` uses :manual:`strict mode
          representation for certain BSON types
          </reference/mongodb-extended-json>`

       See the tutorial :doc:`/import/mongoimport`.

You can also restore from an |service| cluster backup data to another
|service| cluster. For information, see :doc:`/restore-cluster`.

.. _import-strategies:

Import Strategies for Common Cluster Configurations
---------------------------------------------------

The following table covers the best import strategy for common cluster
configurations:

.. list-table::
   :header-rows: 1
   :widths: 45 55

   * - Cluster Configuration
     - Import Strategy

   * - A :term:`replica set`.

     - Use :doc:`Live Migrate </import/live-import>`.

       You must provide the hostname of the :term:`primary` to the Live
       Migrate tool.

       If the cluster is not running MongoDB version 2.6 through 3.6, 
       you must first upgrade it to at least 2.6 first.

       You must have access to the primary node's :term:`oplog`. If the
       cluster runs with authentication, you must have credentials that
       provide read access to the primary and its :term:`oplog`.

       See :ref:`live-import-migration-validation` for the full
       list of migration requirements.

   * - A sharded cluster with multiple shards.

     - If your application can tolerate a short period of downtime,
       use :doc:`Live Migrate </import/live-import-sharded>`. The source
       cluster must run MongoDB 3.4 or 3.6. If the sharded cluster is
       not running MongoDB 3.4 or 3.6, you must upgrade it to either
       MongoDB 3.4 or 3.6.

       If the source cluster enforces authentication, specify a user to
       |service| that exists on every shard *and* the config server
       replica set. The user must have permission to:

       - Stop or start the sharded cluster balancer.
       - Read all databases and collections on the host.
       - Read the oplog on the host.

       See :ref:`live-import-sharded-migration-validation` for the full
       list of migration requirements.

       If near-continuous uptime is a requirement, please contact
       MongoDB. From the |service| UI, click :guilabel:`Support`. Fill
       out a Support ticket, noting your uptime requirements and cluster
       configuration in the :guilabel:`More details` text entry.

       If some downtime is OK and your sharded cluster does not run a 
       supported MongoDB version, you may use :binary:`mongodump` and
       :binary:`mongorestore`. See :doc:`/import/mongorestore` and
       :manual:`Backup Sharded Cluster with Database Dumps
       </tutorial/backup-sharded-cluster-with-database-dumps>`.

   * - A "single :term:`shard`" :term:`sharded cluster` in ``Compose``. This is
       the standard configuration for new MongoDB deployments in ``Compose``.

     - Use :doc:`Live Migrate </import/live-import>`.

       You must `enable the oplog proxy
       <https://www.compose.com/articles/connecting-to-the-oplog-on-the-new-mon
       godb/>`_.

       You must specify the hostname and credentials for the oplog proxy when
       connecting from Live Migrate.

       See :ref:`live-import-migration-validation` for the full
       list of migration requirements.

   * - A standalone MongoDB node.

     - Convert the standalone MongoDB to a single-node replica set and use
       :doc:`Live Migrate </import/live-import>`.

       If the standalone node is not running MongoDB version 2.6 through 3.6, 
       you must upgrade it to at least 2.6 first.

       If you are running with authentication enabled, you must have
       credentials that provide read access to the primary and its oplog.

       If you cannot convert the standalone to a replica set, use
       :binary:`mongodump` and :binary:`mongorestore`. See
       :doc:`/import/mongorestore`.

   * - A shared multi-tenant cluster, or a cluster where you have no oplog
       access.

     - Use :binary:`mongodump` and :binary:`mongorestore`. See
       :doc:`/import/mongorestore`.

       If you are running with authentication enabled, you must have
       credentials that provide read access to the primary.


|service| has built-in support for :doc:`scaling </scale-cluster>` an ``M0``
Free Tier cluster to an ``M10+`` paid cluster. Alternatively, use
:binary:`mongodump` and :binary:`mongorestore` to copy data from an ``M0``
Free Tier cluster to an ``M10+`` cluster. See :doc:`/import/mongorestore`.

.. class:: hidden

   .. toctree::
      :titlesonly:

      /import/live-import
      /import/live-import-sharded
      /import/mongomirror
      /import/mongorestore
      /import/mongoimport
