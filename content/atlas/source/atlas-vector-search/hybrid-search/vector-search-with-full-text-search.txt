.. _avs-reciprocal-rank-fusion:

===================================================================
Perform Hybrid Search with {+avs+} and |fts|
===================================================================

.. default-domain:: mongodb

.. facet::
   :name: genre
   :values: tutorial

.. facet::
   :name: programming_language
   :values: javascript/typescript, shell, python

.. meta::
   :keywords: MongoDB vector search, vector search, $vectorSearch, $vectorSearch pipeline stage, MongoDB vector search pipeline stage, MongoDB vector search query, MongoDB vector search index, $vectorSearch filter examples, $vectorSearch query examples, $vectorSearch pipeline stage examples, approximate nearest neighbor search, sematic search, $search, MongoDB search, $rankFusion, $scoreFusion
   :description: Learn how to perform a hybrid search on your vector embeddings that combines full-text and semantic search to return relevant results from your MongoDB cluster.

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

This tutorial demonstrates a hybrid search that is an aggregation of
full-text and semantic search for the same query criteria. While
full-text is effective in finding exact matches for query terms,
semantic search provides the added benefit of identifying semantically
similar documents even if the documents don't contain the exact query
term. This ensures that synonymous and contextually similar matches are
also included in the combined results of both methods of search.

Conversely, if you have tokens for proper nouns or specific keywords in
your dataset that you don't expect to be considered in the training of
an embedding model in the same context that they are used in your
dataset, your vector search might benefit from being combined with a
full-text search.   

You can also set weights for each method of search per query. Based on
whether full-text or semantic search results are most relevant and
appropriate for a query, you can increase the weight for that search
method per query. 

About the Tutorial 
------------------

This tutorial demonstrates how to run a hybrid search combining {+avs+}
and |fts| queries on the ``sample_mflix.embedded_movies`` collection,
which contains details about movies, for unified search results.
Specifically, this tutorial takes you through the following steps: 

1. Create a {+avs+} index on the ``plot_embedding_voyage_3_large``
   field. This field contains vector embeddings that represent the
   summary of a movie's plot. 
#. Create a |fts| index on the ``title`` field in the
   ``sample_mflix.embedded_movies`` collection. This field contains the 
   movie's name as a text string. 
#. Run a query that uses :pipeline:`$rankFusion` or
   :pipeline:`$scoreFusion` to combine the results from a
   :pipeline:`$vectorSearch` query against the
   ``plot_embedding_voyage_3_large`` field and a :pipeline:`$search` 
   query against the ``title`` field.

Prerequisites 
-------------

Before you begin, complete the :ref:`prerequisites <avs-hybrid-search-prereqs>`. 

Procedures 
----------

.. composable-tutorial::
   :options: pipeline-stage, interface, language
   :defaults: rank-fusion, driver, nodejs

   Create the {+avs+} and |fts| Indexes 
   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

   .. include:: /includes/avs/hybrid-search/fact-create-indexes-intro.rst

   .. selected-content:: 
      :selections: rank-fusion, compass, None

      .. include:: /includes/avs/hybrid-search/shared-index/steps-create-index-compass.rst

   .. selected-content:: 
      :selections: rank-fusion, mongosh, None

      .. include:: /includes/avs/hybrid-search/shared-index/steps-create-index-mongosh.rst

   .. selected-content:: 
      :selections: rank-fusion, driver, nodejs

      .. include:: /includes/avs/hybrid-search/shared-index/steps-create-index-nodejs.rst

   .. selected-content:: 
      :selections: rank-fusion, driver, python

      .. include:: /includes/avs/hybrid-search/shared-index/steps-create-index-python.rst

   .. selected-content:: 
      :selections: score-fusion, compass, None

      .. include:: /includes/avs/hybrid-search/shared-index/steps-create-index-compass.rst

   .. selected-content:: 
      :selections: score-fusion, mongosh, None

      .. include:: /includes/avs/hybrid-search/shared-index/steps-create-index-mongosh.rst
    
   .. selected-content:: 
      :selections: score-fusion, driver, nodejs

      .. include:: /includes/avs/hybrid-search/shared-index/steps-create-index-nodejs.rst

   .. selected-content:: 
      :selections: score-fusion, driver, python

      .. include:: /includes/avs/hybrid-search/shared-index/steps-create-index-python.rst

   Run a Combined {+avs+} and |fts| Query 
   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

   .. selected-content:: 
      :selections: rank-fusion, compass, None

      .. include:: /includes/avs/hybrid-search/rrf-tutorial/fact-run-query-intro.rst

      .. include:: /includes/avs/hybrid-search/rrf-tutorial/steps-run-query-compass.rst

      .. include:: /includes/avs/hybrid-search/rrf-tutorial/fact-query-details.rst

   .. selected-content:: 
      :selections: rank-fusion, mongosh, None

      .. include:: /includes/avs/hybrid-search/rrf-tutorial/fact-run-query-intro.rst

      .. include:: /includes/avs/hybrid-search/rrf-tutorial/steps-run-query-mongosh.rst

      .. include:: /includes/avs/hybrid-search/rrf-tutorial/fact-query-details.rst

   .. selected-content:: 
      :selections: rank-fusion, driver, nodejs

      .. include:: /includes/avs/hybrid-search/rrf-tutorial/fact-run-query-intro.rst

      .. include:: /includes/avs/hybrid-search/rrf-tutorial/steps-run-query-nodejs.rst

      .. include:: /includes/avs/hybrid-search/rrf-tutorial/fact-query-details.rst

   .. selected-content:: 
      :selections: rank-fusion, driver, python

      .. include:: /includes/avs/hybrid-search/rrf-tutorial/fact-run-query-intro.rst

      .. include:: /includes/avs/hybrid-search/rrf-tutorial/steps-run-query-python.rst

      .. include:: /includes/avs/hybrid-search/rrf-tutorial/fact-query-details.rst

   .. selected-content:: 
      :selections: score-fusion, compass, None

      .. include:: /includes/avs/hybrid-search/score-fusion-tutorial/fact-run-query-intro.rst

      .. include:: /includes/avs/hybrid-search/score-fusion-tutorial/steps-run-query-compass.rst

      .. include:: /includes/avs/hybrid-search/score-fusion-tutorial/fact-query-details.rst

   .. selected-content:: 
      :selections: score-fusion, mongosh, None

      .. include:: /includes/avs/hybrid-search/score-fusion-tutorial/fact-run-query-intro.rst

      .. include:: /includes/avs/hybrid-search/score-fusion-tutorial/steps-mongosh-query.rst

      .. include:: /includes/avs/hybrid-search/score-fusion-tutorial/fact-query-details.rst
    
   .. selected-content:: 
      :selections: score-fusion, driver, nodejs

      .. include:: /includes/avs/hybrid-search/score-fusion-tutorial/fact-run-query-intro.rst

      .. include:: /includes/avs/hybrid-search/score-fusion-tutorial/steps-run-query-nodejs.rst

      .. include:: /includes/avs/hybrid-search/score-fusion-tutorial/fact-query-details.rst

   .. selected-content:: 
      :selections: score-fusion, driver, python

      .. include:: /includes/avs/hybrid-search/score-fusion-tutorial/fact-run-query-intro.rst

      .. include:: /includes/avs/hybrid-search/score-fusion-tutorial/steps-run-query-python.rst

      .. include:: /includes/avs/hybrid-search/score-fusion-tutorial/fact-query-details.rst
