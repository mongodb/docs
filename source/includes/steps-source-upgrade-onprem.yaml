title: "Take a full backup of the |onprem| backing databases."
stepnum: 0
level: 4
ref: backup
---
title: "Stop all existing |onprem| services."
stepnum: 0
level: 4
ref: shutdown
content: |

  a. Shut down the |application|:

     .. code-block:: sh

        sudo service mongodb-mms stop

  b. If you are upgrading from a pre-2.0 Ops Manager Application,
     and you are also running a Backup Daemon on the machine, shut 
     down the Backup Daemon service:
    
     .. code-block:: sh
     
        sudo service mongodb-mms-backup-daemon stop
        
---
title: "Uninstall the Backup Daemon package. (Pre-2.0 only)"
stepnum: 0
level: 4
ref: uninstall-daemon
content: |

  Do the following on **every server** where the Backup Daemon is
  installed:

  a. Create a backup copy of each ``conf-daemon.properties`` file to
     preserve the existing configuration.

  b. Uninstall the Backup Daemon package.

# ---
# The "Download" step goes here. Each upgrade procedure borrows this step from the OS-appropriate install procedure.
# ---
# The "Install" step goes here. Each upgrade procedure has its own step.
---
title: "Start |onprem| on every server."
stepnum: 0
level: 4
ref: start
pre: |
  Issue the following command:
action:
  language: sh
  code: |
    sudo service mongodb-mms start
---
title: "Log into |onprem| as a user with the Global Owner role."
stepnum: 0
level: 4
ref: log-in-as-global-owner
content: |

  |onprem| displays a setup wizard for entering the |onprem|
  configuration in the Application Database.

---
title: "Complete the |onprem| configuration setup."
stepnum: 0
level: 4
ref: configuration
content: |

  The setup wizard walks you through several pages to configure
  the Application Database. Refer to your existing
  ``conf-mms.properties`` file as needed. 

  .. seealso::

     :doc:`/reference/configuration` for the mapping of
     ``conf-mms.properties`` parameters to setup wizard fields.

  .. important::

     Make sure you click :guilabel:`Save` on each tab, even if you do
     not make any changes.

---
title: "Copy the connection string to the new |onprem| instances."
stepnum: 0
level: 4
ref: replace-connection-string
content: |

  a. Copy the :setting:`mongo.mongoUri` string from the
     ``conf-mms.properties`` file of the server that was upgraded to
     the current version of |onprem|.

  b. Replace the :setting:`mongo.mongoUri` string in each
     ``conf-mms.properties`` file in each servers which previously only
     hosted a Backup Daemon.

     .. note::

        The former Backup Daemon only servers used a different config
        file, but the upgrade to |onprem| on those servers created a
        ``conf-mms.properties`` file. For these new instances to
        properly connect to the databases, this string must be
        replaced.

---
title: "Restart all |onprem| services."
stepnum: 0
level: 4
ref: restart-ops-manager
---
title: "For any Backup Agents that were installed manually, update their configurations to use port 8080."
stepnum: 0
level: 4
ref: backup-agent-configuration
content: |

  Beginning with |onprem| 2.0, Backup Agents access |onprem| through
  port 8080. The Automation Agent automatically updates the ports on
  managed Backup Agents. For any Backup Agents that were installed
  **manually**, you must edit the agent's :doc:`configuration file
  </reference/backup-agent>` and set the ``mothership`` property to
  access |onprem| on port 8080.

...
