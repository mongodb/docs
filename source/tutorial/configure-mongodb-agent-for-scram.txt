==========================================
Configure MongoDB Agent for Authentication
==========================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

MongoDB 4.0 supports the :manual:`SCRAM </core/security-scram/>`
authentication mechanism with the ``SHA-256`` and ``SHA-1`` hash
functions. ``SCRAM-SHA-1`` (:rfc:`RFC 5802 <5802>`) and
``SCRAM-SHA-256`` (:rfc:`RFC 7677 <7677>`) are |ietf| standards that
define best practice methods for implementation of challenge-response
mechanisms for authenticating users with passwords.

In MongoDB 3.0 to 3.6, MongoDB's default authentication mechanism is
``SCRAM-SHA-1``. Prior to MongoDB 3.0, MongoDB used MongoDB Challenge
and Response (``MONGODB-CR``) as the default. ``MONGODB-CR`` is a
challenge-response mechanism that authenticates users through passwords.

The MongoDB Agent can use ``SCRAM-SHA-1`` or ``SCRAM-SHA-256``
to authenticate to hosts that enforce access control. To authenticate
using ``SCRAM-SHA-1`` or ``SCRAM-SHA-256``, create a user in the
``admin`` database with the appropriate roles in MongoDB.

.. include:: /includes/extracts/note-manage-agent-auth-with-automation-mongodbcr.rst

Prerequisites
-------------

Configure Deployments to Use Authentication
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/fact-access-control-host-settings.rst

Create MongoDB User for the Agent
---------------------------------

.. include:: /includes/prerequisites-create-user-for-agent.rst

.. include:: /includes/considerations-agent-access-control.rst

To automate instances, create a user in the ``admin`` database with an
operation that resembles the following:

.. literalinclude:: /includes/code-examples/create-user.js
   :language: javascript
   :lines: 2,3-4,7-17
   :linenos:

To learn more about the required access, see
:ref:`Access Control <access-control-automation-agent-2.6>`.
