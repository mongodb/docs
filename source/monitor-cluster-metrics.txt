.. _monitor-cluster-metrics:

====================
View Cluster Metrics
====================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

|service| collects and displays metrics for your servers, databases,
and MongoDB processes.

.. note::
   The number of servers displayed on the :guilabel:`Metrics` page at any given time 
   depends on the browser screen size. You can utilize the :guilabel:`Toggle Members` 
   section to control which servers get displayed. Hover over the ``S`` and ``P`` icons to 
   find out which servers they represent. 

.. tabs::

   .. tab:: All Cluster Metrics
      :tabid: all-metrics
       
      View Metrics for All Atlas Clusters in a Project
      ------------------------------------------------
       
      The :guilabel:`Clusters` view displays all clusters in a 
      |service| :ref:`project <projects>`. |service| displays up to four
      of the following charts for each cluster in the project:
       
      .. list-table::
         :widths: 35 65
         :header-rows: 1
        
         * - Chart
        
           - Data
        
         * - :guilabel:`Operations`
        
           - Displays the aggregated read (:guilabel:`R`) and write 
             (:guilabel:`W`) operations on the cluster. 
        
             For a replica set, the chart shows operations for the
             :term:`primary`. 
        
             For a :term:`sharded cluster`, the chart shows
             the sum of the operations on each primary in the cluster.
        
         * - :guilabel:`Logical Size`
              
             ``M0/M2/M5`` *Clusters Only*
        
           - Displays the sum of total bytes of the documents and index data
             across all databases in the cluster.
        
         * - :guilabel:`Disk Usage`
              
             ``M10+`` *Clusters Only*
        
           - The total bytes of used disk space for the cluster.
        
             For a replica set, the chart shows the disk usage of the
             primary host machine.
        
             For a sharded cluster, the chart shows the sum of disk usage
             on each primary host in the cluster. 

         * - :guilabel:`Total Index Size`

             ``M10+`` *Clusters Only*

           - The total bytes of disk space used by indexes for every 
             database in the cluster.
        
         * - :guilabel:`Connections`

           - The total number of active connections to the cluster.
             For a replica set, the chart shows the number of active 
             connections to the primary. For a sharded cluster, 
             the chart shows the sum of all active connections to each primary in the cluster.

         * - :guilabel:`Disk IOPS`

             ``M10+`` *Clusters Only*

           - The sum of read and write input/output operations per 
             second (IOPS) for the cluster. 

         * - :guilabel:`Disk Latency` :sup:`1`

           - The latency, in milliseconds, of the disk partition used
             by MongoDB.

         * - :guilabel:`Util %` :sup:`1`

           - The percentage of time during which the partition is 
             receiving and servicing requests. This includes requests
             from all processes, not just MongoDB processes.

      :sup:`1` Clusters which use :ref:`NVMe SSDs <nvme-storage>` for storage
      display ``Disk Latency`` and ``Disk Util %`` charts using the
      maximum value across the physical drives that make up the
      :abbr:`RAID (Redundant Array of Independent Disks)`. The following
      :ref:`cluster tiers <create-cluster-instance>` display RAID-based
      metrics if they use :ref:`NVMe <nvme-storage>`:

      - ``M80``
      - ``M200``
      - ``M400``

   .. tab:: Replica Set Metrics
      :tabid: replica-metrics
      
      View Metrics for an Atlas Replica Set
      -------------------------------------
       
      To view the metrics for a specific |service| cluster in a 
      :ref:`project <projects>`, click the :guilabel:`Metrics` button for
      that cluster. Alternatively, click on the name of the cluster to open
      the cluster overview, then click the :guilabel:`Metrics` tab.
       
      The :guilabel:`Metrics` view has three distinct sections:

      Chart Controls
      ~~~~~~~~~~~~~~

      |service| provides the following controls for the :guilabel:`Metric` 
      view. Adjusting any of these options affects all charts displayed under 
      the :guilabel:`Metrics` view:
       
      .. list-table::
         :widths: 35 65
         :header-rows: 1
       
         * - Control
           - Function
        
         * - :guilabel:`Granularity`

           - Modifies the granularity of metrics displayed for each chart.
             Select a granularity between 1 minute and 1 day (24 hours).
             Select ``Auto`` to automatically adjust the granularity based 
             on the selected :guilabel:`Zoom` or :guilabel:`Current Display`
             date controls. ``Auto`` granularity selects the highest fidelity
             granularity available for the time range.
        
         * - :guilabel:`Zoom`

           - Modifies the date range of metrics displayed for each chart. 
             Select a zoom range between 1 hour and 5 years. Adjusting
             the :guilabel:`Zoom` automatically adjusts the
             :guilabel:`Current Display` date range. 
        
         * - :guilabel:`Current Display`

           - Modifies the start and end date-time range of metrics displayed 
             for each chart. Modifying the start and end date sets the 
             value of :guilabel:`Zoom` to ``custom`` and overrides the
             previously selected zoom level.
        
         * - :guilabel:`Toggle Members`

           - Limit charts to the selected replica set members. The
             ``P`` icon represents the :term:`Primary` replica set member,
             while the ``S`` icon represents a :term:`Secondary`
             member.
        
         * - :guilabel:`Add Chart`

           - Select one or more charts to display or hide. Adding
             charts using this dropdown is identical to adding charts
             from the :guilabel:`Toggle Charts` section of the 
             :guilabel:`Metrics` view.
  
         * - :guilabel:`Display Opcounters on Separate Charts`

           - Directs |service| to split the :guilabel:`Opcounters`
             chart into its individual components. You can then choose
             to chart one or more of those components.
        
         * - :guilabel:`Display Timeline Annotations`
  
           - Directs |service| to display or hide chart annotations. 
             Chart annotations consist of colored vertical lines that 
             indicate server events, such as a server restart or 
             a transition in member state.
       
      Chart Display
      ~~~~~~~~~~~~~
      
      When viewing charts, you can do the following:
      
      .. include:: /includes/list-tables/monitor-chart-controls.rst
       
      Chart Selection
      ~~~~~~~~~~~~~~~
       
      |service| displays the available metrics to chart for the
      selected cluster under the :guilabel:`Toggle Charts` header. 
      Metrics are grouped into two sections:
       
      :guilabel:`MongoDB Metrics`
         Metrics associated with the MongoDB process. For metrics 
         related to database performance, such as 
         :guilabel:`DB Storage`, |service| presents the sum total across
         all databases in the cluster.
       
         If you enable 
         :guilabel:`Display Opcounters on Separate Charts`, 
         |service| replaces the :guilabel:`Opcounters` option with the
         individual components of that chart. 
       
      :guilabel:`Hardware Metrics`
         Metrics associated with the host machines supporting the cluster.
       
         Charts marked with the ``+`` symbol are inactive, 
         while charts marked with the ``-`` symbol are active. Click
         on any chart to toggle the chart state. 

   .. tab:: Sharded Cluster Metrics
      :tabid: sharded-metrics

      View Metrics for an Atlas Sharded Cluster
      -----------------------------------------

      To view the metrics for a specific |service| cluster in a
      :ref:`project <projects>`, click the :guilabel:`Metrics` button
      for that cluster. Alternatively, click on the name of the cluster
      to open the cluster overview, then click the :guilabel:`Metrics`
      tab.

      The :guilabel:`Metrics` view has three distinct sections:

      Chart Controls
      ~~~~~~~~~~~~~~

      |service| provides the following controls for the 
      :guilabel:`Metric` view:

      .. list-table::
         :widths: 35 65
         :header-rows: 1

         * - Control
           - Function

         * - :guilabel:`Granularity`

           - Modifies the granularity of metrics displayed for each chart.
             Select a granularity between 1 minute and 1 day (24 hours).
             Select ``Auto`` to automatically adjust the granularity based
             on the selected :guilabel:`Zoom` or :guilabel:`Current Display`
             date controls.
             
             ``Auto`` granularity selects the highest fidelity
             granularity available within the selected time range and sharded
             cluster metric rendering limits.
             
             .. note:: Sharded Cluster Metric Rendering Limits
                       
                In the Sharded Cluster metrics view, |service| renders a maximum of:
                 
                - 100,000 total data points and
                - 3,000 data points for a single series.
                 
                As a result, when rendering metrics for large deployments over a
                long period of time, |service| may display metrics at a lower
                granularity than expected. To learn more about the granularity at
                which |service| stores metric data, see
                :ref:`monitoring-storage-granularity`.

         * - :guilabel:`Zoom`
           - Modifies the date range of metrics displayed for each chart. 
              Select a zoom range between 1 hour and 5 years. Adjusting
              the :guilabel:`Zoom` automatically adjusts the
              :guilabel:`Current Display` date range. 

         * - :guilabel:`Display Data`
           - Directs |service| to display data based on the selected option
             
             - ``Individually`` - displays the selected metrics for
               each shard as an individual line.
             
             - ``Sum`` - displays the sum of the selected metrics 
               across all shards in the cluster.
             
             - ``Averaged`` - displays the average of the selected metrics 
               across all shards in the cluster.
           
         * - :guilabel:`Current Display`
           - Modifies the start and end date-time range of metrics displayed 
              for each chart. Modifying the start and end date sets the 
              value of :guilabel:`Zoom` to ``custom`` and overrides the
              previously selected zoom level.

         * - :guilabel:`Display`
           - Selects which metric to chart. You can display no more than
             one chart at a time. 

         * - :guilabel:`View`
           - Selects which sharded cluster components to display
              
             - ``SHARDS`` - displays metrics for each shard in the sharded cluster.
              
             - ``MONGOS`` - displays metrics for each :binary:`bin.mongos` in the sharded cluster.
              
             - ``CONFIGS`` - displays metrics for the config server in the sharded cluster config server replica set.

      Chart Display
      ~~~~~~~~~~~~~

      When viewing charts, you can do the following:

      .. list-table::
         :widths: 35 65
         :header-rows: 1

         * - Task

           - Action

         * - Zoom in on a period of time.
           - Click and drag the mouse pointer over a portion of the chart.
             To reset to the originally selected range (zoom out), double-click
             the chart.
             
             .. note::
             
                When you zoom in on one period of time, the
                :guilabel:`Current Display` date range in the chart control
                section automatically updates to reflect the selected period.

         * - View statistics at a particular time.
           - Hover the mouse pointer over a point on the chart.

      Data Sources
      ~~~~~~~~~~~~

      |service| displays each data source that contributes to the 
      metric chart in a table below the chart. The table consists of 
      the following:

      .. list-table::
         :widths: 35 65
         :header-rows: 1

         * - Column
           - Description

         * - :guilabel:`Shard Name`
           - When :guilabel:`View` is set to ``SHARDS``, displays the name
             of each shard in the sharded cluster.
             
             When :guilabel:`View` is set to ``MONGOS`` or ``CONFIGS``,
             displays the name of each :binary:`mongos <bin.mongos>` or
             config server :binary:`mongod <bin.mongod>` process in the
             cluster.

             Click on a listed component to open the
             :guilabel:`Metrics` view for that component.

         * - :guilabel:`Alerts`
           - Indicates if there are any open alerts for the listed 
             shard or process. Click on the alert icon to open the
             :guilabel:`Alerts` view for that shard or process. For
             more information on responding to open alerts, see
             :doc:`/alert-resolutions`.

         * - :guilabel:`Data Size`
           - Only visible if :guilabel:`View` is set to ``SHARDS``.

             Indicates the logical size of all documents and indexes 
             on the shard.

         * - :guilabel:`Show`
           - Only visible if :guilabel:`View` is set to ``SHARDS``

             Indicates which replica set members to show on the selected
             chart. Select ``Primaries``, ``Secondaries`` or ``All``. 

         * - :guilabel:`Read`, :guilabel:`Write`, and :guilabel:`Queued`
           - Metric data related to the displayed chart. Hover over
             the corresponding column for a pop up with detailed
             information on the metrics shown.

   .. tab:: MongoDB Process Metrics
      :tabid: process-metrics

      View Metrics for a Single MongoDB Process
      -----------------------------------------

      To view the metrics for a specific MongoDB process in a 
      |service| cluster, click on that process from the
      cluster view. The |service| process view displays three tabs for
      monitoring metrics for the process:

      - The :guilabel:`Status` tab displays the process metrics |service|
        collects from the selected :binary:`mongod <bin.mongod>` or
        :binary:`mongos <bin.mongos>` process.

      - The :guilabel:`Hardware` tab displays hardware metrics for
        the host machine supporting the selected 
        :binary:`mongod <bin.mongod>` or :binary:`mongos <bin.mongos>`
        process.

      - The :guilabel:`DB Stats` tab displays the database metrics for the
        selected database.

        |service| retrieves database metrics every 20 minutes by default but
        adjusts frequency when necessary to reduce the impact on database
        performance. If the collection of database statistics still affects
        performance, you can disable collection by clicking 
        :guilabel:`Settings` from the left-hand navigation, 
        then :guilabel:`Project Settings`, and then setting 
        :guilabel:`Collect Database Specific Statistics` to :guilabel:`No`.

      The view for each tab has three distinct sections:

      Chart Controls
      ~~~~~~~~~~~~~~

      |service| provides the following controls for the :guilabel:`Status`,
      :guilabel:`Hardware`, and :guilabel:`DB Stats` 
      views. Adjusting any of these options affects all charts displayed under 
      the selected view:

      .. include:: /includes/list-tables/monitor-view-chart-controls.rst
      
      Chart Display
      ~~~~~~~~~~~~~

      When viewing charts, you can do the following:

      .. include:: /includes/list-tables/monitor-chart-controls.rst
      
      Chart Selection
      ~~~~~~~~~~~~~~~

      |service| displays the available metrics to chart for the
      selected cluster under the :guilabel:`Toggle Charts` header. 

      Charts marked with the ``+`` symbol are inactive, 
      while charts marked with the ``-`` symbol are active. Click
      on any chart to toggle the chart state. 

   .. tab:: Real Time Metrics
      :tabid: realtime-metrics

      View Real Time Cluster Metrics
      ------------------------------
 
      .. note:: Availability

         |service| supports :guilabel:`Real Time` metrics for
         ``mongod`` or ``mongos`` processes and replica
         set clusters. For sharded clusters, you can view 
         :guilabel:`Real Time` metrics for each shard replica set.
         You must have the :authrole:`Project Owner <Project Owner>`
         |service| user role to access the :guilabel:`Real Time` tab.

      To view Real Time metrics for a specific |service| cluster in a 
      :ref:`project <projects>`, click the :guilabel:`Metrics` button 
      for that cluster. Alternatively, click on the name of the cluster
      to open the cluster overview, then click the 
      :guilabel:`Metrics` tab. From the :guilabel:`Metrics` tab,
      click :guilabel:`Real Time` to open the 
      :doc:`Real-Time Performance Panel </real-time-performance-panel>`.
      
      For complete documentation on the |service| real time metrics, 
      see :doc:`Real-Time Performance Panel 
      </real-time-performance-panel>` 

   .. tab:: Atlas Search Metrics
      :tabid: fts-metrics

      View Atlas Search Metrics
      -------------------------

      .. note:: Availability

         |fts| metrics are available for |service| clusters with at
         least one active |fts| index. To set up an |fts| index, see
         :ref:`fts-top-ref`.

      The following |fts| metrics are available:
      - :guilabel:`Search Process Memory`
      - :guilabel:`Search Process CPU`
      - :guilabel:`Search Normalized Process CPU`
      - :guilabel:`Search Disk Space Used`

      Chart Controls
      ~~~~~~~~~~~~~~

      |service| provides the following controls for the metrics charts.
      Adjusting any of these options affects all charts displayed under 
      the selected view:

      .. include:: /includes/list-tables/monitor-view-chart-controls.rst

      Chart Display
      ~~~~~~~~~~~~~

      When viewing charts, you can do the following:

      .. include:: /includes/list-tables/monitor-chart-controls.rst

      Chart Selection
      ~~~~~~~~~~~~~~~

      |service| displays the available metrics to chart for the
      selected cluster under the :guilabel:`Toggle Charts` header. 

      Charts marked with the ``+`` symbol are inactive, 
      while charts marked with the ``-`` symbol are active. Click
      on any chart to toggle the chart state.

.. _monitoring-storage-granularity:

Monitoring Data Storage Granularity
-----------------------------------

|service| stores metrics data at increasing granularity levels. For each
increasing granularity level, |service| computes the metrics data based
on the averages from the previous granularity level. The length of
retention depends on the granularity. |service| computes the metrics data
based on the averages from the previous granularity level.


.. example::

   After 48 hours' worth of data is collected, each group of
   60 minutes is compacted into a single unit of an hour. After 63 days,
   each group of 24 hours is compacted into a single unit of a day.

Metrics data is gathered at a 1-minute granularity. |service| retains
different granularities of metric data for different periods of time:

.. list-table::
   :header-rows: 1

   * - Data Period
     - Duration of Retention

   * - 1 minute
     - 48 hours

   * - 5 minutes
     - 48 hours

   * - 1 hour
     - 63 days

   * - 1 day
     - Forever

|service| retains all database-specific statistics. MongoDB log data is
retained at a maximum rate of 2000 lines per 2 minutes.

Free Tier and Shared Cluster Monitoring Considerations
------------------------------------------------------

- ``M0`` Free Tier and ``M2/M5`` Shared clusters support a subset of
  the metrics and charts available. For complete documentation on
  the limitations of ``M0/M2/M5`` clusters,
  see :ref:`atlas-free-tier`.
  
- .. include:: /includes/fact-free-tier-monitoring-pause.rst
