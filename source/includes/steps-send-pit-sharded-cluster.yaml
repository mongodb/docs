title: "Restore the snapshot data files to the destination host."
level: 4
ref: copy
content: |
  Extract the snapshot archive for the :term:`config server` and for
  each :term:`shard` to a temporary location.

  .. example::

     .. code-block:: sh

        tar -xvf {backupRestoreName}.tar.gz
        mv {backupRestoreName} {temp-database-path}
---
title: "Run the MongoDB Backup Restore Utility (Point-in-Time Restore Only)."
level: 4
ref: mbru-binary
edition: onprem
content: |

  a. Download the MongoDB Backup Restore Utility to your host.

     .. note::

        If you closed the restore panel, click :guilabel:`Backup`, then
        :guilabel:`More` and then :guilabel:`Download MongoDB Backup
        Restore Utility`.

  b. Run the MongoDB Backup Restore Utility on your destination host.
     Run it once for the config server and each shard.

     .. only:: onprem

        .. class:: copyable-code
        .. code-block:: sh

           ./mongodb-backup-restore-util --https --host <targetHost> \
             --port <targetPort> \
             --opStart <opLogStartTimeStamp> \
             --opEnd <opLogEndTimeStamp> \
             --logFile <logPath> \
             --oplogSourceAddr <opsManagerHost}:<port> \
             --apiKey <apiKey> \
             --seedReplSetMember \
             --oplogSizeMB <size> \
             --seedTargetPort <port> \
             --ssl \
             --sslCAFile <path> \
             --sslPEMKeyFile <path>

        The ``mongodb-backup-restore-util`` command uses the following
        options:

        .. list-table::
           :widths: 25 15 60
           :header-rows: 1

           * - Option
             - Required
             - Description

           * - ``--https``
             - Optional
             - Use if you need :abbr:`TLS (Transport Security Layer)` /
               :abbr:`SSL (Secure Sockets Layer)` to connect to the
               ``--oplogSourceAddr``.

           * - ``--host``
             - Required
             - Provide the hostname or IP address for the host that
               serves :program:`mongod` to which the :term:`oplog`
               should be applied.

           * - ``--port``
             - Required
             - Provide the port for the host that serves
               :program:`mongod` to which the :term:`oplog` should be
               applied.

           * - ``--opStart``
             - Required
             - Provide the
               :ref:`BSON timestamp <document-bson-type-timestamp>` for
               the first Oplog entry you want to include in the restore.

           * - ``--opEnd``
             - Required
             - Provide the
               :ref:`BSON timestamp <document-bson-type-timestamp>` for
               the last Oplog entry you want to include in the restore.

           * - ``--logFile``
             - Required
             - Provide a path, including file name, where the log is
               written.

           * - ``--oplogSourceAddr``
             - Required
             - Provide the URL for the :term:`Oplog <Oplog Store
               Database>`.

           * - ``--apiKey``
             - Required
             - Provide your |mms| Agent
               :doc:`API Key </tutorial/manage-agent-api-key>`.

           * - ``--seedReplSetMember``
             - Optional
             - Use flag for a replica set member to re-create the oplog
               collection and seed it with the correct timestamp.
               Requires ``--oplogSizeMB`` and ``--seedTargetPort``.

           * - ``--oplogSizeMB``
             - Optional
             - The oplog size in MB. Required if ``--seedReplSetMember``
               is set.

           * - ``--seedTargetPort``
             - Optional
             - The port for the replica set's :term:`primary`. This may
               or may not be different from the `ephemeral port
               <https://en.wikipedia.org/wiki/Ephemeral_port?oldid=797306581>`_
               used. Required if ``--seedReplSetMember`` is set.

           * - ``--ssl``
             - Optional
             - Use if you need :abbr:`TLS (Transport Security Layer)` /
               :abbr:`SSL (Secure Sockets Layer)` to apply oplogs to the
               mongod.

           * - ``--sslCAFile``
             - Optional
             - Path to the :abbr:`CA (Certificate Authority)` file.
               Required if ``--ssl`` is set.

           * - ``--sslPEMKeyFile``
             - Optional
             - Path to the :abbr:`PEM (privacy-enhanced mail)`
               certificate file. Required if ``--ssl`` is set.

     .. only:: cloud

        .. class:: copyable-code
        .. code-block:: sh

           ./mongodb-backup-restore-util --https --host <targetHost> \
             --port <targetPort> \
             --opStart <opLogStartTimeStamp> \
             --opEnd <opLogEndTimeStamp> \
             --logFile <logPath> \
             --oplogSourceAddr api-backup-dev.mongodb.com \
             --apiKey <apiKey> \
             --seedReplSetMember \
             --oplogSizeMB <size> \
             --seedTargetPort <port> \
             --ssl \
             --sslCAFile <path> \
             --sslPEMKeyFile <path>

        The ``mongodb-backup-restore-util`` command uses the following
        options:

        .. list-table::
           :widths: 25 15 60
           :header-rows: 1

           * - Option
             - Required
             - Description

           * - ``--https``
             - Optional
             - Use if you need TLS/SSL to connect to the
               ``--oplogSourceAddr``.

           * - ``--host``
             - Required
             - Provide the hostname or IP address for the host that
               serves :program:`mongod` to which the :term:`oplog`
               should be applied.

           * - ``--port``
             - Required
             - Provide the port for the host that serves
               :program:`mongod` to which the :term:`oplog` should be
               applied.

           * - ``--opStart``
             - Required
             - Provide the timestamp for the first Oplog entry you want
               to include in the restore.

           * - ``--opEnd``
             - Required
             - Provide the timestamp for the last Oplog entry you want
               to include in the restore.

           * - ``--logFile``
             - Required
             - Provide a path, including file name, where the log is
               written.

           * - ``--oplogSourceAddr``
             - Required
             - Provide the URL for the :term:`Oplog <Oplog Store
               Database>`. This is ``api-backup-dev.mongodb.com`` for
               |mms|.

           * - ``--apiKey``
             - Required
             - Provide your |mms| Agent
               :doc:`API Key </tutorial/manage-agent-api-key>`.

           * - ``--seedReplSetMember``
             - Optional
             - Use flag for a replica set member to re-create the oplog
               collection and seed it with the correct timestamp.
               Requires ``--oplogSizeMB`` and ``--seedTargetPort``.

           * - ``--oplogSizeMB``
             - Optional
             - The oplog size in MB. Required if ``--seedReplSetMember``
               is set.

           * - ``--seedTargetPort``
             - Optional
             - The port for the replica set's :term:`primary`. This may
               or may not be different from the `ephemeral port
               <https://en.wikipedia.org/wiki/Ephemeral_port?oldid=797306581>`_
               used. Required if ``--seedReplSetMember`` is set.

           * - ``--ssl``
             - Optional
             - Use if you need :abbr:`TLS (Transport Security Layer)` /
               :abbr:`SSL (Secure Sockets Layer)` to apply oplogs to the
               mongod.

           * - ``--sslCAFile``
             - Optional
             - Path to the :abbr:`CA (Certificate Authority)` file.
               Required if ``--ssl`` is set.

           * - ``--sslPEMKeyFile``
             - Optional
             - Path to the :abbr:`PEM (privacy-enhanced mail)`
               certificate file. Required if ``--ssl`` is set.

---
title: "Copy the completed snapshots to restore."
level: 4
ref: distribute
content: |

  - For the config server, copy the restored config server database to
    the working database path of each :term:`replica set` member.

  - For each shard, copy the restored shard database to the working
    database path of each replica set member.

...
