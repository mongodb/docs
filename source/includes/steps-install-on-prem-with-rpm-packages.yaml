title: "Download the latest version of the |onprem| package."
stepnum: 1
level: 4
# This step is shared by the upgrade procedure and the basic install procedure.
ref: download
content: |

  a. In a browser, go to `http://www.mongodb.com
     <https://www.mongodb.com/>`_ and click on the `Download
     <https://www.mongodb.com/lp/download/mongodb-enterprise>`_ button.

  b. Complete the form.

  c. On the :guilabel:`MongoDB Download Center` page, click on the
     :guilabel:`Ops Manager` tab.

  d. Select ``RedHat 5+ / CentOS 5+ / SUSE 11+ / Amazon Linux`` from the
     :guilabel:`Platforms` dropdown menu.

  e. Select ``RPM`` from the :guilabel:`Packages` dropdown menu.

  f. Click :guilabel:`Download`.

  .. note::

     The downloaded package is named
     ``mongodb-mms-<version>.x86_64.rpm``, where ``<version>`` is the
     version number.

---
title: "Install the |onprem| package on each server being used for |onprem|."
stepnum: 2
level: 4
ref: install
pre: |
  Install the ``.rpm`` package by issuing the following command, where
  ``<version>`` is the version of the ``.rpm`` package:
action:
  language: sh
  code: |
    sudo rpm -ivh mongodb-mms-<version>.x86_64.rpm
post: |
  When installed, the base directory for the |onprem| software is
  ``/opt/mongodb/mms/``. The ``.rpm`` package creates a new system user
  ``mongodb-mms`` under which the server runs.
---
title: "*Only* if you installed to RHEL 7.1 or 7.2, replace symlinks with scripts."
stepnum: 3
level: 4
# This step is shared by the upgrade, simple install, and basic install procedures.
ref: workaround-rhel
content: |
  As a result of `RHEL Bug 1285492 <https://bugzilla.redhat.com/show_bug.cgi?id=1285492>`_,
  the version of ``systemd`` found in RHEL 7.1 and 7.2 |onprem| will not start automatically
  on boot up.

  To work around this:

  a. Replace the symbolic links to the scripts with the scripts themselves.
     Copy the scripts from ``/opt/mongodb/mms/bin/mongodb-mms`` to
     ``/etc/init.d``.

  b. In the copied scripts, change the line:

     .. code-block:: ini

        ABS_PATH="$( resolvepath $0 )"

     to:

     .. code-block:: ini

        SCRIPTPATH=/opt/mongodb/mms/bin/mongodb-mms
        ABS_PATH="$( resolvepath $SCRIPTPATH )"

---
stepnum: 4
level: 4
source:
  file: steps-source-install-onprem.yaml
  ref: configure-app-db-connection
pre: |
  On a server that is to run the |onprem|, open
  ``/opt/mongodb/mms/conf/conf-mms.properties`` with root privileges and
  configure the settings described here, as appropriate.
---
stepnum: 5
level: 4
source:
  file: steps-source-install-onprem.yaml
  ref: start-application
---
stepnum: 6
level: 4
source:
  file: steps-source-install-onprem.yaml
  ref: home-page
---
stepnum: 7
level: 4
source:
  file: steps-source-install-onprem.yaml
  ref: configure-app
---
stepnum: 8
level: 4
source:
  file: steps-source-install-onprem.yaml
  ref: sync-genkey
post: |
  Use ``scp`` to copy the ``gen.key`` file from the ``/etc/mongodb-mms/``
  directory on the current server to the same directory on the other servers.
---
stepnum: 9
level: 4
source:
  file: steps-source-install-onprem.yaml
  ref: load-balancer
---
stepnum: 10
level: 4
source:
  file: steps-source-install-onprem.yaml
  ref: configure-backup-database-uri
...
