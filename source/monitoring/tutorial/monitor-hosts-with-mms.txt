==================================
Monitoring Hosts with |monitoring|
==================================

.. start-content

The Monitoring agent automatically discovers MongoDB processes based on
existing cluster configuration. You'll have to manually "seed" at
least one of these hosts from the MMS console.

.. index:: adding hosts
   single: hosts; adding

To add a host to |monitoring|, click the "plus" (``+ ADD HOST``) button 
at the top of the Hosts page. This raises a query
element for the hostname, port, and optionally an admin DB username and
password. Provide the necessary information and select "Add."

.. index:: host discovery
   single: hosts; discovery

Once it has a seed host, the Monitoring agent will discover any other
nodes from associated clusters. These clusters, and their respective
seed hosts, include:

- Master databases, after adding slave databases.

- Shard clusters, after adding ``mongos`` instances.

- Replica sets, after adding any member of the set.

Once you add these seed nodes, the Monitoring agent will fetch this
information *from* the MMS servers. Thus, when configuring the
monitoring environment, you may need to wait for several update cycles
(e.g. 5-10 minutes) to complete the auto-discovery process and host
identification. During this period, you may see duplicate hosts in the
MMS web console. This is normal.

The Monitoring agent fetches configuration and reports to |monitoring| every
minute, so, again, there may be a delay of several minutes before data
and host information propagate to the MMS console.

You can find immediate evidence of a working installation in the agent
output or logs. For more information, check the MMS console's "Hosts,"
section in the "Agent Log" and "Pings" tabs. Once |monitoring| has data, you
can view and begin using the statistics.

.. index:: agent timeout
   single: agent; timeout
   single: timeout

If the agent cannot collect information about a host for 24 hours, the
|monitoring| system deactivates the instance in the MMS agent and
console. Deactivated hosts must be manually reactivated from the MMS
console if you wish to collect data from these hosts.

.. end-content

.. _authentication-privileges:

Additional Considerations for MongoDB 2.4 Nodes
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

If you are monitoring a MongoDB 2.4 instance with
authentication enabled, you must have elevated privileges
to collect complete performance data. At a minimum, the user will need 
to possess:

- the ``clusterAdmin`` role, **and**

- the ``readAnyDatabase`` role.

If MMS is running with :ref:`DB Profiling <db-stats-warning>` enabled,
the user requires additional permissions. In addition to the
``clusterAdmin`` and ``readAnyDatabase`` roles, the user must possess
**either**:

- the ``dbAdminAnyDatabase role``, **or** 

- the ``dbAdmin`` role on the specific databases being profiled.

.. seealso:: 
   - `User Privilege Roles in MongoDB <http://docs.mongodb.org/manual/reference/user-privileges/>`_.

.. _monitoring-architecture:

Monitoring Architecture
~~~~~~~~~~~~~~~~~~~~~~~

Only one Monitoring agent per group or environment will report to
|monitoring| at a time, but you can run multiple instances of the agent
to provide redundancy. Secondary agents act as hot standbys. If you
stop the agent process, |monitoring| removes the agent from the
“Agents” tab within a day. If a Monitoring agent is offline, the last
ping times for that agent do not update. To install a second or third
agent, simply repeat the installation process in the :doc:`installation
guide </monitoring/install>` for each new agent. You can also
:ref:`automate agent installation <automated-agent-installation>`.

.. note:: 

   When the Monitoring agent restarts, there is a five minute delay
   before that agent will begin collecting data and sending pings to
   |monitoring|. If you have multiple agents, this delay permits other
   agents in your infrastructure to become the "primary agent" and for
   MMS to determine which agent will be primary.

   During this interval, the restarted Monitoring agent will not
   collect data.
