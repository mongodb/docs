===========================
Configure Public API Access
===========================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. cond:: onprem

   To access the |mms| |api|, you must generate an |api| key for either
   :ref:`programmatic access <mms-prog-api-key>` for an organization or
   a :ref:`Personal API Key (deprecated) <mms-personal-api-key>`
   for |a-mms| user.

   .. admonition:: Preferred Method to Use API
      :class: important

      MongoDB recommends using
      :ref:`Programmatic API Keys <mms-prog-api-key>` instead of
      :ref:`Personal API Keys (deprecated)<mms-personal-api-key>`.

.. cond:: cloud

   To access the |mms| |api| :ref:`programmatically
   <mms-prog-api-key>`, you must generate an |api| key for your
   organization.

   .. admonition:: Personal API Key Deprecation
      :class: important

      Personal API Keys are deprecated. You cannot create new Personal
      API Keys, but existing Personal API Keys continue to function.

.. admonition:: API Keys cannot use the |mms| User Interface
   :class: note

   |api| keys that are associated with an organization are not
   associated with user credentials and cannot log in to the |service|
   user interface.

Prerequisite
------------

.. _whitelist-for-api-operations:

Enable API Whitelisting for Your Organization
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

For |mms| users with a non-empty |api| whitelist, all |api|
access must originate from a whitelisted |ipv4| address. Ensure your
configured whitelist entries provide appropriate coverage for all
clients which require |api| access. An empty |api| whitelist grants
access to all |api| endpoints except those that explicitly require
whitelisting.

|mms| supports requiring |api| whitelisting at the organization
level, such that any |api| activity for all projects within that
organization must originate from an entry on each respective
|mms| user's |api| whitelist. For organizations that require |api|
whitelisting, |mms| users cannot access any |api| operations until
they define at least one |api| whitelist entry.

To require an |api| whitelist for an Organization:

1. Log into |mms|.

#. Access the Organization using the :guilabel:`Context` picker in
   the top-left hand corner of the |mms| UI.

#. Click :guilabel:`Settings` from the left hand navigation.

#. Toggle the :guilabel:`Require IP Whitelist for Public API`
   setting to :guilabel:`On`.


.. _mms-prog-api-key:

Programmatic API Keys
---------------------

To grant programmatic access to an organization or project using only
the :doc:`API </api>`, you can create an |api| key. |api| Keys:

- Have two parts: a Public Key and a Private Key.

  .. cond:: onprem

     These serve the same function as a username and Personal |api| Key
     when making |api| requests to |service|.

- Cannot be used to log into |service| through the user interface.

- Must be granted roles as you would Users to make sure the |api| Keys
  can call |api| endpoints without errors.

- Can belong to one organization, but may be granted access to
  any number of projects in that organization.

.. cond:: onprem

   Programmatic API Keys can be set globally through the
   :ref:`API Key <add-global-api-key>` page in the Admin interface.

.. _about-org-app-api-keys:

Manage Programmatic Access to an Organization
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. admonition:: Required Permissions
   :class: note

   To perform any of the following actions, you must have the
   :authrole:`Organization Owner` role.

.. _create-org-app-api-key:

Create an API Key in an Organization
````````````````````````````````````

.. include:: /includes/app-api-key-create-in-org.rst

.. _view-org-app-api-key:

View the Details of an API Key in an Organization
`````````````````````````````````````````````````

.. include:: /includes/app-api-key-view-details-in-org.rst

.. _change-org-app-api-key-roles:

Change an API Key in an Organization
`````````````````````````````````````

You can change the roles, description, or whitelist of an |api| Key in
an Organization.

.. include:: /includes/app-api-key-change-in-org.rst

.. _delete-org-app-api-key:

Delete an API Key from an Organization
``````````````````````````````````````

.. include:: /includes/app-api-key-delete-from-org.rst

.. _about-project-app-api-keys:

Manage Programmatic Access to a Project
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. admonition:: Required Permissions
   :class: note

   To perform any of the following actions, you must have either the
   :authrole:`Project User Admin` role.

.. _create-project-app-api-key:

Create an API Key for a Project
```````````````````````````````

.. include:: /includes/app-api-key-create-in-project.rst

.. _view-project-app-api-key:

View the Details of an API Key in a Project
```````````````````````````````````````````

.. include:: /includes/app-api-key-view-details-in-project.rst

.. _change-project-app-api-key-roles:

Change an API Key's Roles in a Project
``````````````````````````````````````

.. include:: /includes/app-api-key-change-roles-in-project.rst

.. _delete-project-app-api-key:

Delete an API Key from a Project
````````````````````````````````

.. include:: /includes/app-api-key-delete-from-project.rst

.. _mms-personal-api-key:

Personal API Keys (Deprecated)
------------------------------

.. include:: /includes/fact-personal-apikeys-deprecated-ui.rst

.. cond:: onprem

   To access the |api|, each user must generate an |api| key.

Each user can have up to 10 |api| keys associated with their account.
Each key can be either enabled or disabled but all count toward the 10
key limit.

An |api| key is like a password. Keep it secret.

Access Control
~~~~~~~~~~~~~~

Your |mms| :doc:`roles </reference/user-roles>` determine which
:doc:`API resources </reference/api>` you can use. Your |mms| roles
apply to both the interface and the |api|.

.. _generate-public-api-key:
.. _generate-personal-api-key:

.. cond:: onprem

   Generate Personal API Keys
   ~~~~~~~~~~~~~~~~~~~~~~~~~~

   .. important::

      When you generate a key, |mms| displays it *one time only*. You
      must copy it. |mms| will never display the full key again.

   .. include:: /includes/steps/generate-public-api-key.rst

Limit API Operations to Whitelisted IPv4 Addresses
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

To access whitelisted |api| operations, you must configure your
:doc:`API whitelist </reference/api/whitelist>` with the |ipv4|
addresses from which you will issue the whitelisted commands. You also
must have the :authrole:`Organization Owner` role to issue whitelisted
commands.

Address-based whitelists protect |api| operations. Only client requests
that originate from a whitelisted |ipv4| address are permitted to
perform the operations.

Users have their own whitelists and own |api| keys. When you issue an
|api| call, you must use an |api| key from your user account and must
issue the command from an address on your user account's whitelist. You
cannot use your key to issue a whitelisted |api| request from an
address on another user's whitelist, unless, of course, you've added
that address to your own whitelist.

.. _configure-access-to-whitelisted-ops:
.. _add-personal-api-key-whitelist:

Add an IPv4 Address to the API Whitelist
````````````````````````````````````````

.. include:: /includes/steps/configure-access-to-whitelisted-operations.rst

Delete an IPv4 Address from the API Whitelist
`````````````````````````````````````````````

.. include:: /includes/steps/delete-address-access-to-whitelisted-operations.rst
