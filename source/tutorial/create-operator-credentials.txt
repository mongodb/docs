.. _create-k8s-credentials:
.. _create-k8s-secret:

=========================================
Create Credentials for the |k8s-op-short|
=========================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

For the |k8s-op-short| to create or update |k8s-objs| in your |com|
Project, you need to store your
:ref:`Programmatic API Key <create-org-app-api-key>` as a |k8s|
|k8s-secret|. Creating a secret stores authentication credentials so
only |k8s| can access them.

Multiple secrets can exist in the same namespace. Each user should
have their own secret.

Prerequisites
-------------

To create credentials for the |k8s-op-short|, you must:

1. Have or create an |onprem|
   :opsmgr:`Organization </tutorial/manage-organizations>`.

   .. note::

      Unlike earlier |k8s-op-short| versions, use the Operator to
      create your |mms| project. The Operator adds additional metadata
      to Projects that it creates to help manage the deployments.

#. Have or generate a
   :ref:`Programmatic API Key <create-org-app-api-key>`.

#. Grant this new |svc-api-key| the :authrole:`Project Owner` role.

#. Add the |ipaddr| or |cidr| block of any hosts that serve the
   |k8s-op-short| to the
   :ref:`API Whitelist <configure-access-to-whitelisted-ops>`.


Procedure
---------

To create your |k8s| secret:

1. Make sure you have the Public and Private Keys for your desired
   |onprem| |svc-api-key|.

2. Invoke the following |k8s| command to create your secret:

   .. code-block:: sh

      kubectl -n <metadata.namespace> \
        create secret generic <myCredentials> \
        --from-literal="user=<publicKey>" \
        --from-literal="publicApiKey=<privateKey>"

   .. note::

      The ``-n`` flag limits the |k8s-ns| to which this secret
      applies. All MongoDB |k8s| resources must be in the same
      namespace with the |k8s-secrets| and |k8s-configmaps|. The
      |k8s-op-short| does not use either the secrets or ConfigMaps.

3. Invoke the following |k8s| command to verify your secret:

   .. code-block:: sh

      kubectl describe secrets/<myCredentials> -n <metadata.namespace>

   This command returns a secret description in the shell:

   .. code-block:: sh

      Name:         <myCredentials>
      Namespace:    <metadata.namespace>
      Labels:       <none>
      Annotations:  <none>

      Type:  Opaque

      Data
      ====
      publicApiKey:  31 bytes
      user:          22 bytes

