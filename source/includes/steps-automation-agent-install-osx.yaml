title: "Login to |mms|."
stepnum: 1
ref: login
---
title: "Begin or Manage a Deployment"
stepnum: 2
ref: begin-deployment
content: |

  When you reach the :guilabel:`Install an Automation Agent on each
  server` page, all hosts are listed.

  a. Click on the :guilabel:`Install Agent` menu of the first MongoDB
     host.

  b. Select :guilabel:`Mac OSX - TAR`.
---
title: Download the latest version of the Automation Agent archive.
stepnum: 3
ref: download-automation-agent-osx
pre: |
  From the Terminal, issue this command: 
action:
  language: sh
  copyable: true
  code: |
    curl -OL https://cloud.mongodb.com/download/agent/automation/mongodb-mms-automation-agent-latest.osx_x86_64.tar.gz
edition:
  - cloud
---
title: Download the latest version of the Automation Agent archive.
stepnum: 3
ref: download-automation-agent-osx
pre: |
  From the Terminal, issue this command: 
action:
  language: sh
  copyable: true
  code: |
    curl -OL <OpsManagerHost>:<Port>/download/agent/automation/mongodb-mms-automation-agent-latest.osx_x86_64.tar.gz

edition:
  - onprem
---
title: "Install the Automation Agent."
stepnum: 4
ref: extract
pre: |
  To install the agent, extract the archive. For example:
action:
  language: sh
  copyable: true
  code: |
    tar -xf mongodb-mms-automation-agent-latest.osx_x86_64.tar.gz
post: |
  The Automation Agent is installed.
---
title: "Generate an agent API key or retrieve an existing agent API key for your |mms| project." 
stepnum: 5
ref: retrieve-automation-mms-api-key
pre: |
      a. Click :guilabel:`+ Generate Key`.

         .. include:: /includes/extracts/agent-api-key-generate-note.rst

      b. Enter your password and click :guilabel:`Verify`.
  
      c. Click :guilabel:`+ Generate Key` again.

      .. include:: /includes/extracts/agent-api-key-admonition.rst
---
stepnum: 6
source:
  file: steps-automation-agent-install-from-archive.yaml
  ref: configure-automation-group-api-cloud
edition:
  - cloud
---
stepnum: 6
source:
  file: steps-automation-agent-install-from-archive.yaml
  ref: configure-automation-group-api-onprem
edition:
  - onprem
---
stepnum: 7
source:
  file: steps-source-install-agent.yaml
  ref: proxy
replacement:
  agentname: "Automation"
  httpProxy: ":asetting:`httpProxy`"
  configfile: "<install-directory>/local.config"
---
stepnum: 8
source:
  file: steps-automation-agent-install-from-archive.yaml
  ref: create-automation-directory
---
title: "Assign permissions to the system user that runs the Automation Agent."
stepnum: 9
ref: assign-automation-agent-permissions
content: |
  Run the following commands:

  .. code-block:: shell

    # Create mongodb user and group if they do not exist
 
    if ! sudo /usr/bin/id -g mongodb &>/dev/null; then
        sudo /usr/sbin/groupadd -r mongodb
    fi
 
    # Create mongodb user if they do not exist and assign 
    # them to the mongodb group
 
    if ! sudo /usr/bin/id mongodb &>/dev/null; then
        sudo /usr/sbin/useradd -M -r -g mongodb \
          -d /var/lib/mongo -s /bin/false \
          -c mongodb mongodb > /dev/null 2>&1
    fi
 
    # Grant the mongodb:mongodb user and group permissions 
    # to manage deployments.
 
    sudo chown mongodb:mongodb /var/lib/mongodb-mms-automation
    sudo chown mongodb:mongodb /var/log/mongodb-mms-automation
    sudo chown mongodb:mongodb /data
---
title: "Start the Automation Agent."
stepnum: 10
ref: start-automation-agent
action:
  pre: |
    Issue the following command:
  language: sh
  copyable: true
  code: |
    nohup ./mongodb-mms-automation-agent --config=local.config >> /var/log/mongodb-mms-automation/automation-agent.log 2>&1 &
---
title: "Verify that the Automation Agent can connect to |mms|."
stepnum: 11
ref: verify-automation-agent
content: 
  Click :guilabel:`Verify Agent` on the :guilabel:`Automation Agent Installation Instructions` modal.
...
