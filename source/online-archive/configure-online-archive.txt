.. _config-online-archive:

========================
Configure Online Archive
========================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. _config-online-archive-intro:

Overview
--------

You can configure data in a collection to be archived by specifying an 
archiving rule. The archiving rule can be a: 

- Combination of a date that is used to determine when to archive data 
  and a numeric value representing the number of days that the 
  |service| cluster stores the data. 
- Custom query that is used to select the documents to archive.

To configure your |service| cluster for online archive: 

1. Create an archiving rule by providing the collection namespace and 
   the criteria for selecting data to archive in the collection.

2. (Optional) Specify commonly queried fields to partition archived   
   data.

.. _config-online-archive-ui:

Configure Online Archive Through the UI  
---------------------------------------

To configure an :guilabel:`Online Archive`, in your |service| UI: 

.. include:: /includes/steps/config-online-archive.rst

.. _config-online-archive-api:

Configure Online Archive Through the API  
----------------------------------------

To configure an online archive from the API, send a ``POST`` request to 
the :ref:`onlineArchives <api-online-archive>` endpoint. If the cluster 
already has an ``Active`` online archive with the same archiving rule 
for the same database and collection, the operation will fail. However,
if the existing online archive is in ``Paused`` or ``Deleted`` state, 
the new online archive is created and its status is set to ``Active``. 
To learn more about the |api| syntax and options, see 
:ref:`api-online-archive-create-one`.

Limitations 
-----------

You can create up to 50 online archives per cluster and up to 20 can be 
active per cluster. The following limitations apply:

- You can configure multiple online archives in the same namespace, but 
  only one can be active at any given time. 
- You cannot create multiple online archives on the same fields in the 
  same collection.
