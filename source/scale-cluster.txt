================
Modify a Cluster
================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

|service| Configuration Options
-------------------------------

.. list-table::

   * - :ref:`Cloud Provider & Region <scale-cluster-cloud-provider>`

     - .. include:: /includes/fact-modify-cloud-provider.rst

       .. note::

          .. include:: /includes/fact-modify-cloud-provider-live-migrate.rst

       For dedicated clusters with an :guilabel:`Instance Size` of
       ``M10`` or larger, you can modify cluster's region.

   * - :ref:`Deploy or Configure a multi-region cluster <scale-cluster-region>`
     - You can deploy or modify a multi-region cluster.

       Only available for cluster with an :guilabel:`Instance Size`
       of ``M10`` or larger.

   * - :ref:`Instance Size <scale-cluster-instance>`

     - You can modify the instance size of the cluster.

   * - :ref:`Instance Storage Options <scale-cluster-storage>`

     - You can modify the storage options for the selected instance 
       size.

       Only available for cluster with an :guilabel:`Instance Size`
       of ``M10`` or larger.

   * - :ref:`MongoDB Version <scale-cluster-version>`

     - You can upgrade the major MongoDB version of the cluster.

       Only available for cluster with an :guilabel:`Instance Size`
       of ``M10`` or larger.

       You cannot downgrade the MongoDB version of a cluster.

   * - :ref:`Deploy a Sharded Cluster <scale-cluster-sharding>`

     - If your cluster is a replica set, you can upgrade the deployment
       to a sharded cluster.

       Only available for clusters with an :guilabel:`Instance Size` of
       ``M30`` or larger.

   * - :ref:`Modify the Number of Shards <scale-cluster-shardNum>`

     - You can configure the number of shards in the sharded cluster. 

       Only available for sharded cluster deployments.

   * - :ref:`Enable or Disable Backup <scale-cluster-backups>`

     - You can enable or disable backups for the cluster. Only
       available for clusters with an :guilabel:`Instance Size` of
       ``M10`` or larger.

   * - :ref:`Enable or Disable the Business Intelligence Connector <create-cluster-enable-bi>`

     - You can enable or disable the |bic| for this cluster.

       .. include:: /includes/extracts/cluster-option-bi-cluster-requirements.rst

   * - :ref:`Confirm and Deploy <scale-cluster-payment>`

     - Confirm and deploy your cluster with the selected changes.

Considerations
--------------

Migration, Availability, and Performance Impact
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The time required for an :term:`initial sync` and resynchronizing data
across storage volumes increases linearly with the amount of data in
the cluster. Making changes to a cluster often requires migrating to
new servers and storage volumes, which can take a long time. However,
cluster changes can be made more quickly in some cases. For example,
changing the instance size of a cluster on AWS does not require an
initial sync.

.. admonition:: Changes to Free/Shared Tier clusters result in limited downtime
   :class: note

   All changes to ``M0``, ``M2``, and ``M5`` clusters require 7-10 minutes of downtime.

To maximize availability:

- For a replica set, |service| migrates one node at a time, starting
  with the secondary nodes first and then the primary.

- For a sharded cluster, |service| performs the migration of the shards
  independently of each other. For each shard (i.e. replica set),
  |service| migrates one node at a time, starting with the secondary
  nodes first and then the primary.

:manual:`Retryable writes </core/retryable-writes>` should prevent any
write errors during the election of a new primary. On average, an
election can take five seconds.

Migration can affect performance if your primary is already reaching
operational capacity: each newly migrated replica set node must
perform an :term:`initial sync` from the primary, adding to the
operational load. Migrations can also affect performance if
:manual:`read preferences </core/read-preference>` are set to read from
secondaries: the replica set is down one secondary during the
migration.

.. include:: /includes/fact-auto-index.rst

.. Note to writers: beginning in v20160712, an instance size change
.. with no disk change does not require an initial sync

Host Names Can Become Inconsistent with Respect to Node Types
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/fact-node-type-topology-warning.rst

Billing
~~~~~~~

As you modify your cluster, you can compare the costs of different
options before applying them. The :guilabel:`Cluster Overview` box
displays the cost of the selected configuration, excluding data
transfer.

.. admonition:: Free Tier
   :class: important

   Upgrading an ``M0`` Free Tier cluster to an ``M2`` or greater paid
   tier cluster starts billing for the cluster. See :doc:`billing` for
   complete documentation on |service| billing.

The following sections provide complete documentation for each of the
|service| cluster scaling configuration options.

.. _scale-cluster-open-dialog:

A. Open the :guilabel:`Editing Cluster` Dialog
----------------------------------------------

.. container:: admonition

   For the cluster you want to modify, click the ellipses :guilabel:`...`
   icon, then select :guilabel:`Edit Configuration`.

   Alternatively, if you are already viewing the specific cluster,
   click the :guilabel:`Configuration` button.

   For ``M0`` Free Tier clusters, you can also click the
   :guilabel:`Upgrade` button for the cluster.

.. _scale-cluster-cloud-provider:

B. Modify the :guilabel:`Cloud Provider & Region` of the Cluster
----------------------------------------------------------------

Modify the Cloud Provider of the Cluster
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. important::

   .. include:: /includes/fact-modify-cloud-provider.rst

   .. include:: /includes/fact-modify-cloud-provider-live-migrate.rst

.. container:: admonition

   Select :guilabel:`Cloud Provider & Region` to view the
   currently configured cloud provider and region for the cluster.

   If you are upgrading from an |service| ``M0`` Free Tier or ``M2/M5``
   Shared Tier cluster, you can change the cloud provider backing your
   cluster by selecting from the available cloud providers.

Modify the Region of the Cluster
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. container:: admonition

   Review the available regions for the selected cloud provider. 

   .. include:: /includes/fact-M0-modify-region.rst

   Regions marked as |star| are
   :guilabel:`Recommended` regions that provide higher availability
   compared to other regions. For more information, see: 

   - :ref:`AWS Recommended Regions <amazon-aws-availability-zones>`.   
   - :ref:`GCP Recommended Regions <google-gcp-availability-zones>`.   
   - :ref:`Azure Recommended Regions <microsoft-azure-availability-zones>`.

   .. include:: /includes/extracts/fact-no-node-restriction-base.rst

   .. |star| unicode:: U+2605

   The choice of cloud provider and region affects the 
   configuration options for the available instance sizes, network 
   latency for clients accessing your cluster, and the 
   :doc:`cost of running the cluster </billing>`.

.. _scale-cluster-region:

Deploy or Modify a Multi-Region Cluster
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. container:: admonition

   .. include:: /includes/extracts/cluster-option-clusterProviderRegionOnly.rst

.. _scale-cluster-instance:

C. Modify the :guilabel:`Cluster Tier` of the Cluster
-----------------------------------------------------

.. admonition:: Free/Shared Tier Considerations
   :class: note

   - You cannot downgrade an ``M10+`` cluster to an 
     ``M0`` Free Tier or ``M2/M5`` Shared Starter instance size.

   - Changing the cluster tier from a shared tier cluster (``M0``/``M2``/``M5``) 
     to an ``M10`` or larger cluster tier requires downtime.

You can change the instance size, as well as the memory, storage,
and |iops| (speed) specifications for the selected instance size.

.. include:: /includes/extracts/cluster-option-clusterInstance.rst

.. _scale-cluster-storage:

Customize the Storage Settings of the Selected Instance
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. container:: admonition

   .. include:: /includes/cluster-settings/customize-storage.rst

D. Modify the :guilabel:`Additional Settings` of the Cluster
------------------------------------------------------------

.. container:: admonition

   From the :guilabel:`Additional Settings` section, you can

   - :ref:`scale-cluster-version`,
   - :ref:`scale-cluster-backups`,
   - :ref:`scale-cluster-sharding`,
   - :ref:`scale-cluster-shardNum`,
   - :ref:`scale-cluster-enable-bi`,
   - :ref:`scale-cluster-enable-encryption`, and
   - :ref:`scale-cluster-more-configuration-options`.

.. _scale-cluster-version:

Upgrade the MongoDB Version of the Cluster
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. container:: admonition

   Select :guilabel:`Additional Settings` to view the currently
   configured MongoDB version for the cluster.

   .. include:: /includes/extracts/fact-mongodb-version-downgrade-restriction-scale.rst

   Select the new MongoDB version from the :guilabel:`Select a version`
   dropdown. |service| supports the following upgrade paths:

   - MongoDB 3.4 -> MongoDB 3.6
   - MongoDB 3.6 -> MongoDB 4.0

   See :doc:`/tutorial/major-version-change` for the
   MongoDB-recommended procedure for a major version change. This
   procedure includes creating a staging cluster for the purpose of
   testing and validating application and cluster performance and
   functionality on the new MongoDB version.

.. _scale-cluster-sharding:

Scale your Replica Set to a Sharded Cluster
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. container:: admonition

   .. include:: /includes/extracts/cluster-option-clusterSharding.rst

.. _scale-cluster-shardNum:

Modify the :guilabel:`Number of Shards` in your sharded cluster
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. container:: admonition

   .. include:: /includes/extracts/cluster-option-clusterShardingNum.rst

.. _scale-cluster-backups:

Enable or Disable Backup for the Cluster
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. container:: admonition

   .. include:: /includes/extracts/cluster-option-clusterBackup.rst

   You can disable backups for the cluster by toggling this option to
   :guilabel:`No`. Once you disable backup, |service| immediately
   deletes any backup snapshots for the cluster. See 
   :doc:`/backup-cluster` for more information.

.. _scale-cluster-enable-bi:

Enable or Disable |bic| for the Cluster
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. container:: admonition

   .. include:: /includes/extracts/cluster-option-bi.rst

.. _scale-cluster-enable-encryption:

Enable Encryption at Rest
~~~~~~~~~~~~~~~~~~~~~~~~~

.. container:: admonition
   
   .. include:: /includes/extracts/cluster-option-encryption-at-rest.rst

.. _scale-cluster-more-configuration-options:

Configure Additional Configuration Options
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. container:: admonition

   .. include:: /includes/extracts/cluster-option-more-configuration-options.rst

.. _scale-cluster-payment:

E. Confirm and Deploy Your Changes
----------------------------------

.. container:: admonition

   Click :guilabel:`Confirm & Deploy` deploy your changes.

   If you are upgrading from an ``M0`` Free Tier cluster, |service|
   prompts you to enter payment information before deploying your
   changes.

.. include:: /includes/footnote-databearing.rst


.. class:: hidden

   .. toctree::
      :titlesonly:
      
      /tutorial/major-version-change
