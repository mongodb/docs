==========================
Backup Agent Configuration
==========================

.. default-domain:: mongodb

Configuration File
------------------

The name and location of the Backup Agent configuration file depend on the
operating system:

- RHEL, CentOS, Amazon Linux, and Ubuntu all use a package manager to
  install the agent. The package manager creates the following agent
  configuration file:

  ``/etc/mongodb-mms/backup-agent.config``

- OS X, Windows, and other Linux systems use either a ``tar`` or ``msi``
  file for the installation. The Backup Agent stores its configuration in
  the following file:

  ``<installation directory>/local.config``

Settings
--------

.. _backup-connection-settings:

Connection Settings
~~~~~~~~~~~~~~~~~~~

For the Backup Agent communication with the MMS Servers, the following
connection settings are **required**:

.. bsetting:: mmsApiKey

   *Type*: string

   The MMS agent API key for a MMS group. To retrieve the key from the MMS
   interface, click the :guilabel:`Administration` tab, then the
   :guilabel:`Agents` page, and then the link for your operating system.
   MMS will display the MMS API key used by your MMS group.

   For example:

   .. code-block:: ini

      mmsApiKey=abc123

.. bsetting:: mothership

   *Type*: string

   The hostname of the MMS Backup Web Server.

.. bsetting:: https

   *Type*: boolean

   Toggles communication with the MMS Backup web server over HTTPS.

HTTP Proxy Settings
~~~~~~~~~~~~~~~~~~~

.. bsetting:: httpProxy

   .. versionadded:: 1.4.4.34-1

   *Type*: string

   To connect to the MMS HTTP Service via a proxy, specify the URL of
   the proxy. For example:

   .. code-block:: ini

      httpProxy=http://example-proxy.com:8080

.. _backup-mongodb-ssl-settings:

MongoDB SSL Settings
~~~~~~~~~~~~~~~~~~~~

Specify these settings when the Backup Agent is connecting to MongoDB
instances with SSL.

.. bsetting:: sslClientCertificate

   *Type*: string

   The path to the private key, client certificate, and
   optional intermediate certificates in PEM format. The agent will
   use the client certificate when connecting to any configured MongoDB that
   use SSL and require client certificates, i.e. that are running using the
   :option:`--sslCAFile <mongod --sslCAFile>` option.

.. bsetting:: sslClientCertificatePassword

   *Type*: string

   The password needed to decrypt the private key in the sslClientCertificate
   file. This setting is only necessary if the client certificate PEM file is
   encrypted.

.. bsetting:: sslTrustedServerCertificates

   *Type*: string

   The path on disk that contains the trusted certificate authority certificates
   in PEM format. These certificates will verify the server certificate
   returned from any MongoDBs running with SSL. For example:

   .. code-block:: ini

      sslTrustedServerCertificates=/etc/mongodb-mms/mongodb-certs.pem

.. bsetting:: sslRequireValidServerCertificates

   *Type*: boolean

   Use this option to disable certificate verification by setting this
   value to ``false``. That configuration is only recommended for
   testing purposes as it makes connections susceptible to man-in-the-middle
   attacks.

.. _backup-mongodb-kerberos-settings:

MongoDB Kerberos Settings
~~~~~~~~~~~~~~~~~~~~~~~~~

Specify these settings if the Backup Agent authenticates to hosts using
Kerberos. For more information, see
:doc:`/tutorial/connect-to-hosts-with-kerberos-authentication`.

.. bsetting:: krb5Principal

   *Type*: string

   The Kerberos principal used by the agent. For example:

   .. code-block:: ini

      krb5Principal=mmsagent/myhost@EXAMPLE.COM

.. bsetting:: krb5Keytab

   *Type*: string

   The *absolute* path to Kerberos principal's keytab file. For
   example:

   .. code-block:: ini

      krb5Keytab=/etc/mongodb-mms/backup-agent.keytab

.. _backup-server-ssl-settings:

MMS Server SSL Settings
~~~~~~~~~~~~~~~~~~~~~~~

.. only:: onprem

   Advanced SSL settings used by the Backup Agent when communicating to the
   MMS Backup Web Server.

.. only:: classic or cloud

   Advanced SSL settings used by the Backup Agent when communicating to the
   MMS Backup Service.

.. bsetting:: sslTrustedMMSBackupServerCertificate

   By default the Backup Agent will use the trusted root CAs installed on the
   system. If the agent cannot find the trusted root CAs, configure
   these settings manually.

   .. only:: onprem

      If the MMS Backup Server is using a self-signed SSL certificate
      this setting is required.

   The path on disk that contains the trusted certificate authority certificates
   in PEM format. The agent will use this certificate to verify that
   the agent is communicating with the designated MMS Backup
   Server. For example:

   .. code-block:: ini

      sslTrustedMMSBackupServerCertificate=/etc/mongodb-mms/mms-certs.pem

.. only:: onprem

   .. bsetting:: sslRequireValidMMSBackupServerCertificate

      *Type*: boolean

      You can disable certificate verification by setting this value
      to  ``false``. That configuration is only recommended for
      testing purposes as it makes connections susceptible to
      *man-in-the-middle* attacks.
