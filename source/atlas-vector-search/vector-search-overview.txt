:noprevnext:

.. _fts-vector-search:

================================================
Perform Semantic Search with Atlas Vector Search 
================================================

.. default-domain:: mongodb

.. facet::
   :name: genre
   :values: tutorial

.. meta::
   :description: Learn how to create and manage an Atlas Vector Search index for vector embeddings and perform vector search on the indexed field.

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

Overview
--------

You can perform semantic search on data in your |service| {+cluster+}
running MongoDB v6.0.11, v7.0.2, or later using {+avs+}. You can store
vector embeddings for any kind of data along with other data in your
collection on the |service| {+cluster+}. {+avs+} supports embeddings
that are less than and equal to 4096 dimensions in width. 

.. note:: 

   For optimal performance, we recommend deploying :ref:`separate search
   nodes for workload isolation <configure-search-nodes>`. Search nodes
   support concurrent query execution to improve individual query
   latency. To learn more, see :ref:`vectorSearch-concurrent-queries`.

When you define an {+avs+} index on your collection, you can seamlessly
index vector data along with your other data and then perform semantic
search against the indexed fields. 

{+avs+} uses the |hnsw| algorithm to perform the semantic search. You can
use {+avs+} support for |ann| queries to search for results similar to a
selected product, search for images, etc. 

About {+avs+} Indexes 
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

You must index the fields that contain vector embeddings of |bson|
``double`` data type for performing semantic search against the vector
data. To perform a vector search against your data, create an {+avs+}
``vectorSearch`` type index for your data. In the {+avs+} index
definition, you must index the field that contains the vector data as
the ``vector`` type. 

You can also optionally index fields for pre-filtering the data against
which you want to run your {+avs+} query. You can pre-filter your data
by boolean, numeric, and string values. To pre-filter the data, you must
index your boolean, numeric, and string fields as the ``filter`` type in
the {+avs+} index definition that indexes your vector data field. 

To learn more about indexing your fields for {+avs+}, see
:ref:`avs-types-vector-search`. 

About {+avs+} Queries 
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

{+avs+} queries take the shape of an :manual:`aggregation pipeline stage 
</aggregation>`. The {+avs+} :pipeline:`$vectorSearch` stage must be the
first stage in the pipeline. You can run {+avs+} queries only against
fields indexed as the ``vector`` type in a ``vectorSearch`` type index. 

You can pre-filter data against which you want to perform semantic
search using an :abbr:`MQL (MongoDB Query Language)` match expression
that compares an indexed field with boolean, number, or string values. 
{+avs+} supports some :manual:`comparison query
</reference/operator/query-comparison/>` and :manual:`aggregation  
pipeline </reference/operator/aggregation/>` operators in the filter in
your :pipeline:`$vectorSearch` query. 

To learn more about pre-filtering and querying your data using {+avs+},
see :ref:`return-vector-search-results`. 

Procedure 
---------

This section describes how to index vector embeddings in your data on
an |service| {+cluster+} and run queries that search vector embeddings. 

.. procedure:: 
   :style: normal 

   .. step:: Define your {+avs+} index.

      In your {+avs+} ``vectorSearch`` type index definition, you
      can index the field that contains the vector embeddings and the
      fields that you want to pre-filter your data by.

      a. *Required*. Index the field that contains vector data in your
         collection as the :ref:`vector <avs-types-vector-search>` type
         (lines 3 - 8 below). 
      #. *Optional*. Index boolean, numeric, and string fields as the
         :ref:`filter <avs-types-vector-search>` type (lines 9 - 12
         below) to enable vector search on filtered data.   
      
      The {+avs+} index has the following syntax.

      .. code-block:: json 
         :copyable: true 
         :linenos:

         {
           "fields":[ 
             {
               "type": "vector",
               "path": "<field-name>",
               "numDimensions": <number-of-dimensions>,
               "similarity": "euclidean | cosine | dotProduct"
             },
             {
               "type": "filter",
               "path": "<field-name>"
             },
             ...
           ]
         }
      
      To learn more, see :ref:`avs-types-vector-search`.

   .. step:: Construct your vector search query. 

      Use the :pipeline:`$vectorSearch` pipeline stage in your query. 

      .. code-block:: json 
         :copyable: true 
         :linenos:

         {
           "$vectorSearch": {
             "index": "<index-name>",
             "path": "<field-to-search>",
             "queryVector": [<array-of-numbers>],
             "numCandidates": <number-of-candidates>,
             "limit": <number-of-results>,
             "filter": {<filter-specification>}
           }
         }

      To learn more about this pipeline stage, see
      :ref:`return-vector-search-results`. 

   .. step:: (Optional) Specify whether you want the score for the documents in the results.

      Use ``vectorSearchScore`` in the :pipeline:`$project` stage after
      your :pipeline:`$vectorSearch` stage to retrieve the score for the
      documents in the results. To learn more, see :ref:`scoring-ref`. 

   .. step:: Run your query.

      Verify your query syntax and then run it using {+mongosh+} or a
      :ref:`supported driver <vectorSearch-agg-pipeline-clients>`. 

Next Steps 
----------

1. :ref:`Review the {+avs+} index definition <avs-types-vector-search>`.
2. :ref:`Create the {+avs+} index <avs-create-index>` using one of the
   supported clients.

.. toctree::
   :titlesonly:

   Create and Manage Indexes </atlas-vector-search/manage-indexes>
   Create and Run Queries </atlas-vector-search/vector-search-stage>
   Tutorials: Semantic Search </atlas-vector-search/tutorials>
   AI Integrations </atlas-vector-search/ai-integrations>
   Changelog </atlas-vector-search/changelog>
