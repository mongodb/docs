==============================
Automation Agent Configuration
==============================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. include:: /includes/extracts/automation-agent-configuration-overview.rst

.. warning::

   If you edit these settings through the :guilabel:`Settings` or
   :guilabel:`Deployments`, in the case of authentication or SSL, in
   |mms|, those changes overwrite any changes made manually in this
   configuration file.

Configuration File Location per Operating System
------------------------------------------------

The location of the Automation Agent configuration file depends on your
operating system:

.. list-table::
   :widths: 30 20 50

   * - Operating System
     
     - Installation Method
       
     - Config File Path

   * - RHEL, CentOS, Amazon Linux and Ubuntu

     - package manager

     - ``/etc/mongodb-mms/automation-agent.config``

   * - OS X or other Linux distributions

     - ``tar``
     
     - ``/path/to/install/local.config``

   * - Windows

     - ``msi``
     
     - ``\path\to\install\local.config``

Settings
--------

|mms| provides default values for many of the Automation Agent
Configuration settings. 

.. important:: 
   You must set the :asetting:`mmsGroupId` and :asetting:`mmsApiKey`
   values.

.. _automation-agent-connection-settings:

Connection Settings
~~~~~~~~~~~~~~~~~~~

.. asetting:: mmsGroupId

   *Type*: string

   Specifies the ID of your |mms| group. In |mms|, click
   :guilabel:`Settings`, then :guilabel:`Agents` and then click on the
   appropriate operating system under :guilabel:`Agent Downloads`.

   When the :guilabel:`Automation Agent Installation Instructions` box
   appears, these values can be copied directly from this box using the
   :guilabel:`Copy` buttons.

   This setting is usually set when the Automation Agent is installed
   and *it is required*.

   .. code-block:: ini

      mmsGroupId=8zvbo2s2asigxvmpnkq5yexf

.. asetting:: mmsApiKey

   *Type*: string

   Specifies the |mms| agent API key of your |mms| group. To retrieve
   this key from |mms|, click :guilabel:`Settings`, then
   :guilabel:`Agents` and then click on the appropriate operating
   system under :guilabel:`Agent Downloads`.

   When the :guilabel:`Automation Agent Installation Instructions` box
   appears, these values can be copied directly from this box using the
   :guilabel:`Copy` buttons.

   This setting is usually set when the Automation Agent is installed and *it is required*.

   .. code-block:: ini

      mmsApiKey=rgdte4w7wwbnds9nceuodx9mcte2zqem

.. asetting:: mmsBaseUrl

   *Type*: string

   Specifies the URL of the |application|.

   .. include:: /includes/extracts/automation-agent-configuration-mmsbaseurl.rst

.. asetting:: logFile

   *Type*: string

   Specifies the path to which |mms| should write the Automation Agent's log.

   *By default, this path is*
   ``/var/log/mongodb-mms-automation/automation-agent.log``.

   .. code-block:: ini
   
      logFile=/path/to/mongodb-mms-automation/automation-agent.log

.. asetting:: mmsConfigBackup

   *Type*:

   Specifies the path to the |mms| :ref:`automation configuration <automation-configuration-sample-entity>` 
   backup file. This file describes the desired state of the
   deployment.

   .. code-block:: ini

      mmsConfigBackup=/path/to/mms-cluster-config-backup.json

Logging Settings
~~~~~~~~~~~~~~~~

.. asetting:: logLevel

   *Type*: string

   Specifies the level of logging granularity. 

   Choose from the following severity levels, from most to least
   verbose:
   
   - ``DEBUG``
   - ``ROUTINE``
   - ``INFO``
   - ``WARN``
   - ``ERROR``
   - ``DOOM``

   By default, :asetting:`logLevel` is ``INFO``.

   .. code-block:: ini
   
      logLevel=ROUTINE 

   Each level includes the log items included in the succeeding levels.

   .. example::

      - If you choose ``DEBUG``, the Automation Agent logs all
        messages, including ``ROUTINE``, ``INFO``, ``WARN``, ``ERROR``
        and ``DOOM``.

      - If you choose ``DOOM``, the Automation Agent only logs ``DOOM``
        messages.

.. asetting:: maxLogFiles

   *Type*: integer

   Specifies the maximum number of rotated log files to retain. 

   By default, :asetting:`maxLogFiles` is ``10``. You can change the
   value to retain a different quantity of rotated log files.

   .. code-block:: ini

      maxLogFiles=15

.. asetting:: maxLogFileSize

   *Type*: integer

   Specifies the maximum size, in bytes, of a log file before the logs
   are rotated.

   .. code-block:: ini

      maxLogFileSize=536870912

HTTP Proxy Settings
~~~~~~~~~~~~~~~~~~~

.. asetting:: httpProxy

   *Type*: string

   Specifies the URL of an HTTP proxy server the Automation Agent can use.

   .. code-block:: ini

      httpProxy=http://proxy.example.com:8080

.. _automation-mongodb-kerberos-settings:

MongoDB Kerberos Settings
~~~~~~~~~~~~~~~~~~~~~~~~~

Specify these settings if the Automation Agent authenticates to hosts
using Kerberos. See
:doc:`/tutorial/configure-backup-agent-for-kerberos`.

.. asetting:: krb5ConfigLocation

   *Type*: string

   Specifies an *absolute* path to an non-system-standard location for
   the Kerberos configuration file.

   .. code-block:: ini

      krb5ConfigLocation=/path/to/krb_custom.conf

.. _automation-server-ssl-settings:

|mms| Server SSL Settings
~~~~~~~~~~~~~~~~~~~~~~~~~

Specify the settings the Automation Agent uses when communicating with
|mms| using SSL.

.. asetting:: sslTrustedMMSServerCertificate

   *Type*: string

   Specifies the *absolute* path that contains the trusted CA
   certificates in ``PEM`` format. The absolute path must be used
   because the Automation Agent may pass this certificate to the other
   agents, which may have different paths relative to the Automation
   Agent. This certificate verifies that the agent is talking to the
   designated |mms| instance.

   .. code-block:: ini

      sslTrustedMMSServerCertificate=/path/to/ca.pem

.. asetting:: sslRequireValidMMSServerCertificates

   *Type*: boolean

   Specifies if |mms| should validate SSL certificates.

   Set this option to ``false`` to disable certificate verification.

   .. warning::

      Setting this option to ``false`` is only recommended for testing
      purposes. It makes connections between |mms| and MongoDB
      deployments susceptible to *man-in-the-middle* attacks.

   .. code-block:: ini

      sslRequireValidMMSServerCertificates=true

.. only:: onprem

   .. asetting:: sslMMSServerClientCertificate

      *Type*: string

      Specifies the path to the file containing the client's private
      key, certificate, and optional intermediate certificates in
      ``PEM`` format. The Automation Agent uses the client certificate
      when connecting to |onprem| over SSL if |onprem| requires client
      certificates, such as when |onprem| runs with :guilabel:`Client
      Certificate Mode` is set to ``Required for Agents Only`` or
      ``Required for All Requests``.

      .. seealso::
         Review the Client Certificate Mode section of
         :doc:`/reference/configuration` for how to specify this
         setting in the |application|.

      .. code-block:: ini

         sslMMSServerClientCertificate=/path/to/client.pem

   .. asetting:: sslMMSServerClientCertificatePassword

      *Type*: string

      Specifies the password needed to decrypt the private key in
      the ``sslMMSServerClientCertificate`` file. This setting is
      required when the client certificate ``PEM`` file is
      encrypted.

      .. code-block:: ini

           sslServerClientCertificatePassword=password