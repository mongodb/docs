.. _security-aws-kms:

==============================
Encryption at Rest via AWS KMS
==============================

.. default-domain:: mongodb

.. meta::
   :keywords: encryption

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. include:: /includes/fact-atlas-free-tier-limits.rst

|service| enables you to use the :abbr:`AWS (Amazon Web Services)` Key
Management Service (AWS KMS) to encrypt your MongoDB cluster database
files and :ref:`cloud providers snapshots <backup-cloud-provider>`. 
MongoDB uses your AWS customer master key (CMK) to encrypt and decrypt 
your MongoDB master keys, which are used to encrypt your database keys. 
|service| automatically rotates your MongoDB master keys every ninety 
days. Encryption at Rest is an additional layer of encryption on top of 
the |service| storage and snapshot volume encryption enabled for all
|service| clusters.

This procedure covers configuring Encryption at Rest via 
AWS KMS for an |service| project. For instructions on
enabling Encryption at Rest when deploying an |service| cluster, see
:ref:`create-cluster-enable-encryption`. For instructions on
enabling Encryption at Rest for an existing |service| cluster,
see :ref:`scale-cluster-enable-encryption`.

For instructions on rotating the currently configured
:abbr:`CMK (customer master key)` or changing the 
:abbr:`IAM (Identity and Access Management)` user credentials for
a |service| project, see :doc:`/tutorial/security-aws-kms-rotate-key`.

.. _aws-ksm-prereqs:

Prerequisites
-------------

.. include:: /includes/fact-aws-kms-prereqs.rst

.. _security-aws-kms-restrictions:

.. include:: /includes/fact-kms-restrictions.rst

Procedure
---------

You must enable Encryption at Rest using your Key Management for a
project before you can enable Encryption at Rest using your Key
Management for a cluster in that project. See
:ref:`create-cluster-enable-encryption`
for instructions on deploying a cluster with Encryption at Rest using
your Key Management. See
:ref:`Modify a Cluster <scale-cluster-enable-encryption>` for 
instructions on enabling Encryption at Rest for an existing cluster.

.. note::

   You must disable Encryption at Rest on each cluster in a project
   before you can disable the feature for the project.
    
To enable Encryption at Rest for a project:
    
.. include:: /includes/steps/enable-encryption-for-project.rst
   
|service| automatically creates an
:alert:`customer master key rotation alert 
<AWS encryption key elapsed time since last rotation is above 365 days>`
once you configure Encryption at Rest for a project. You can reset
this alert at any time by rotating your
:abbr:`CMK (customer master key)`. 

.. class:: hidden

   .. toctree::
      :titlesonly:

      /tutorial/security-aws-kms-rotate-key
