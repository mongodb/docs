.. _api-download-query-log:

=====================================
Download Query Logs for One {+dl+}
=====================================

.. default-domain:: mongodb

.. meta::
   :keywords: |data-lake|

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

.. include:: /includes/fact-projects-groups-synonyms.rst

.. include:: /includes/api-requirements.rst

Use this endpoint to download query logs for a specific {+data-lake+}. 

Required Roles 
--------------

You must have :authrole:`Project Data Access Read Only` or higher role 
to download the query logs for your {+dl+}.

.. include:: /includes/api-base-url.rst

Resource 
--------

.. code-block:: none

   GET /groups/{GROUP-ID}/dataLakes/{NAME}/queryLogs.gz

Request Parameters 
------------------

Request Path Parameters
~~~~~~~~~~~~~~~~~~~~~~~

.. list-table::
   :header-rows: 1
   :widths: 15 10 75

   * - Path Element
     - Necessity
     - Description

   * - ``GROUP-ID``
     - Required
     - Unique identifier for the :atlas:`project </api/#group-id>` 
       that contains the {+dl+} for which you want to download query 
       logs.

   * - ``NAME``
     - Required
     - Name of the {+data-lake-short+} for which you want to 
       download query logs.

       You can use the :doc:`/reference/api/dataLakes-get-all-tenants`
       endpoint to retrieve all {+data-lake+}s associated with the
       project. The ``name`` field in the response of that endpoint
       corresponds to the ``NAME`` parameter here.

Request Query Parameters
~~~~~~~~~~~~~~~~~~~~~~~~

.. list-table::
   :header-rows: 1
   :widths: 20 10 70

   * - Field
     - Necessity
     - Description

   * - ``endDate``
     - Optional
     - |Epoch-time| that specifies the end point for the range of log
       messages to retrieve. Default is current timestamp.

   * - ``startDate``
     - Optional
     - |Epoch-time| that specifies starting point for the range of
       log messages to retrieve. Default is 4 hours before the
       current timestamp.

Request Body Parameters
~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/no-body-parameters.rst

Response
--------

The endpoint downloads a compressed log file to your current working 
directory  with either the name you specified using the ``--output`` 
option or the default filename in the following format if you specified 
the ``-OJ`` option: 

.. code-block:: shell 
   :copyable: false 

   <data-lake-name>_<startdate>_<enddate>_queries.log.gz

Example
-------

The following example command downloads the logs for queries on the 
{+dl+} to a file named :file:`dataLakeQueryLog.gz`. The command 
downloads the log file to the directory from which you made the 
request. 

Request
~~~~~~~

.. code-block:: none

   curl -u "username:apiKey" --digest \
    --header "Accept: application/gzip" \
    --request GET "https://cloud.mongodb.com/api/atlas/v1.0/groups/{GROUP-ID}/dataLakes/{NAME}/queryLogs.gz" \
    --output "dataLakeQueryLog.gz"

Response
~~~~~~~~

The example ``curl`` command saves the log file to 
:file:`dataLakeQueryLog.gz` in the current working directory and shows 
the following progress output. 

.. code-block:: none
   :copyable: false

   % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                  Dload  Upload   Total   Spent    Left  Speed
   100   106  100   106    0     0    301      0 --:--:-- --:--:-- --:--:--   301
   100 62883    0 62883    0     0  65915      0 --:--:-- --:--:-- --:--:--  374k
