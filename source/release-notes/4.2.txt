========================================================
Release Notes for MongoDB 4.2 (Development Series 4.1.x)
========================================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol


.. include:: /includes/in-dev.rst

Removed Commands and Methods
----------------------------

.. list-table::
   :header-rows: 1

   * - Removed Command
     - Removed Method
     - Notes

   * - ``group``

     - ``db.collection.group()``

     - Use :method:`db.collection.aggregate()` with the
       :pipeline:`$group` stage instead.

   * - ``eval``

     - 

     - The MongoDB 4.2 :binary:`~bin.mongo` shell methods
       :method:`db.eval()` and :method:`db.collection.copyTo()` can
       only be run when connected to MongoDB 4.0 or earlier.


   * - ``copydb``

     - 

     - The corresponding :binary:`~bin.mongo` shell helpers
       ``db.copyDatabase()`` can only be run when connected to MongoDB
       4.0 or earlier.

       As an alternative, users can use :binary:`~bin.mongodump` and
       :binary:`~bin.mongorestore` or write a script using the drivers.

   * - ``clone``

     - 

     - The corresponding :binary:`~bin.mongo` shell helpers
       ``db.cloneDatabase()`` can only be run when connected to MongoDB
       4.0 or earlier.

       As an alternative, users can use :binary:`~bin.mongodump` and
       :binary:`~bin.mongorestore` or write a script using the drivers.

   * - ``geoNear``

     - 

     - Use :method:`db.collection.aggregate()` with the
       :pipeline:`$geoNear` stage instead.

       For more information, see :ref:`4.2-compat-remove-geoNear`.

   * - ``parallelCollectionScan``
     - 
     -


   * - ``repairDatabase``

     - ``db.repairDatabase()``

     - For more information, see :ref:`4.2-compat-remove-repairDatabase`.



Remove ``maxScan`` Option
~~~~~~~~~~~~~~~~~~~~~~~~~

MongoDB removes the deprecated option ``maxScan`` for the
:dbcommand:`find` command and the :binary:`~bin.mongo` shell helper
``cursor.maxScan()``. Use either the ``maxTimeMS`` option for the
:dbcommand:`find` command or the helper :method:`cursor.maxTimeMS()` instead.

Deprecate ``SSL`` Options
~~~~~~~~~~~~~~~~~~~~~~~~~

MongoDB 4.2 deprecates the ``SSL`` options for :binary:`~bin.mongod` and
:binary:`~bin.mongos` in favor of equivalent ``TLS`` versions. The 
deprecated options can be found under :ref:`SSL Options for mongod 
<ssl-mongod-options>` for the command-line options and under
:ref:`net-ssl-conf-options` for the configuration file options.

General Improvements
--------------------

``outputConfig`` Option
~~~~~~~~~~~~~~~~~~~~~~~

MongoDB 4.2 adds the :option:`--outputConfig <mongod --outputConfig>` option for 
:binary:`~bin.mongod` and :binary:`~bin.mongos`, which outputs the resolved 
YAML configuration document to ``stdout`` and halts the server instance.

Add ``TLS`` Options
~~~~~~~~~~~~~~~~~~~

MongoDB 4.2 adds ``TLS`` options for :binary:`~bin.mongod` and 
:binary:`~bin.mongos` to replace deprecated ``SSL`` versions.  These
options are identical to the ``SSL`` options, as MongoDB has always
supported TLS 1.0 and later. The new options can be found under 
:ref:`TLS Options for mongod <tls-mongod-options>` for the command-line options
and under :ref:`net-tls-conf-options` for the configuration file options.

``$out`` Stage Enhancements
~~~~~~~~~~~~~~~~~~~~~~~~~~~

MongoDB 4.2 adds a new syntax for the :pipeline:`$out` aggregation stage. With
the new syntax, you can:

- merge the output with an existing collection

- replace the content of an existing collection with the output

- output to a collection in a different database

- output to an existing sharded collection.

An example of using the new syntax to merge output with an existing collection
in a different database is:

.. code-block:: javascript
  
   { $out: { to : "employees", mode : "insertDocuments", db : "hr" } }

With the older, still-supported syntax, you can only replace the content of an
existing collection with the output and you cannot output to a sharded
collection.

An example of the old syntax is: 

.. code-block:: javascript
   
   { $out: "stock" }

``startAfter`` Option for Change Streams
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

MongoDB 4.2 adds ``startAfter`` as an option for :ref:`changeStreams`, which
starts a new change stream after the event indicated by a resume token. With
this option, you can start a change stream from an
:ref:`invalidate event <change-event-invalidate>`, thereby guaranteeing no
missed notifications after the previous stream was invalidated.

Changes Affecting Compatibility
-------------------------------

Some changes can affect compatibility and may require user actions. For
a detailed list of compatibility changes, see
:doc:`/release-notes/4.2-compatibility`.

.. _4.2-upgrade:

Upgrade Procedures
------------------

.. admonition:: Feature Compatibility Version

   To upgrade, the 4.0 instances must have
   ``featureCompatibilityVersion`` set to ``4.0``. To check the version:

   .. code-block:: javascript

      db.adminCommand( { getParameter: 1, featureCompatibilityVersion: 1 } )

   For specific details on verifying and setting the
   ``featureCompatibilityVersion`` as well as information on other
   prerequisites/considerations for upgrades, refer to the individual
   upgrade instructions:

   - :doc:`/release-notes/4.2-upgrade-standalone`

   - :doc:`/release-notes/4.2-upgrade-replica-set`

   - :doc:`/release-notes/4.2-upgrade-sharded-cluster`

If you need guidance on upgrading to 4.2, `MongoDB offers major version
upgrade services
<https://www.mongodb.com/products/consulting?jmp=docs>`_
to help ensure a smooth transition without interruption to your MongoDB application.

Report an Issue
---------------

To report an issue, see
https://github.com/mongodb/mongo/wiki/Submit-Bug-Reports for
instructions on how to file a JIRA ticket for the MongoDB server or one
of the related projects.

.. class:: hidden

   .. toctree::

      /release-notes/4.2-compatibility
      /release-notes/4.2-upgrade-standalone
      /release-notes/4.2-upgrade-replica-set
      /release-notes/4.2-upgrade-sharded-cluster
      /release-notes/4.2-downgrade-standalone
      /release-notes/4.2-downgrade-replica-set
      /release-notes/4.2-downgrade-sharded-cluster
