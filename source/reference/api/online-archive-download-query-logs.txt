.. _api-online-archive-download-query-logs:

==================================
Download Online Archive Query Logs
==================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

You can download the :ref:`online archive <online-archive-overview>` 
query logs using the API or the |service| :ref:`UI <query-logs>`. 

.. include:: /includes/api-requirements.rst

.. include:: /includes/fact-projects-groups-synonyms.rst

Required Roles 
--------------

You must have :authrole:`Project Data Access Read Only` or higher role 
to download the query logs for online archives.

.. _api-online-archive-download-query-logs-resource:

Resource 
--------

.. include:: /includes/api-base-url-new.rst

.. code-block:: none

   GET /groups/{GROUP-ID}/clusters/{CLUSTER-NAME}/onlineArchives/queryLogs.gz

.. _api-online-archive-download-query-logs-params:

Request Parameters
------------------

.. _api-online-archive-download-query-logs-path-params:

Request Path Parameters
~~~~~~~~~~~~~~~~~~~~~~~

.. list-table::
   :header-rows: 1
   :widths: 15 10 75

   * - Path Element
     - Necessity
     - Description

   * - ``GROUP-ID``
     - Required
     - Unique identifier of the :ref:`project <projects>`
       that contains the specified cluster.

   * - ``CLUSTER-NAME``
     - Required
     - Name of the cluster.

.. _api-online-archive-download-query-logs-query-params:

Request Query Parameters
~~~~~~~~~~~~~~~~~~~~~~~~

.. list-table::
   :header-rows: 1
   :widths: 20 10 70

   * - Field
     - Necessity
     - Description

   * - ``archiveOnly`` 
     - Optional
     - Flag that indicates whether to download logs for queries against 
       your online archive only or both your online archive and 
       cluster. Value can be one of the following: 

       - ``true`` - to download logs for queries on online archive 
         only 
       - ``false`` - to download logs for queries on both cluster and 
         online archive 

       If omitted, defaults to ``false``.

   * - ``endDate``
     - Optional
     - |Epoch-time| that specifies the end point for the range of log
       messages to retrieve. Default is the current timestamp.

   * - ``startDate``
     - Optional
     - |Epoch-time| that specifies starting point for the range of
       log messages to retrieve. Default is 4 hours prior to the
       current timestamp.

.. _api-online-archive-download-query-logs-response:

Response Elements 
-----------------

The endpoint downloads to your current working directory a compressed 
log file  with either the name you specified using the ``--output`` 
option or the default filename if you specified the ``-OJ`` option. The 
default filename varies based on whether you are downloading logs for 
queries against your online archive only or both your online archive 
and cluster.

.. tabs:: 

   .. tab:: Online Archive Only 
      :tabid: oaonly

      .. code-block:: shell 
         :copyable: false 

         <cluster-name>_archive_only_<startdate>_<enddate>_queries.log.gz

   .. tab:: Online Archive and Cluster 
      :tabid: oaandcluster

      .. code-block:: shell 
         :copyable: false 

         <cluster-name>_cluster_archive_<startdate>_<enddate>_queries.log.gz

.. _api-online-archive-download-query-logs-eg:

Example 
-------

The following example command downloads the logs for queries against 
the online archive only to a file named ``oaquerylog.gz``. It 
downloads the log file to the directory from 
which you made the request. 

Example Request 
~~~~~~~~~~~~~~~

.. code-block:: shell

   curl --user "{PUBLIC-KEY}:{PRIVATE-KEY}" --digest \
        --header "Accept: application/gzip" \
        --request GET "https://cloud.mongodb.com/api/atlas/v1.0/groups/{GROUP-ID}/clusters/{CLUSTER-NAME}/onlineArchives/queryLogs.gz?archiveOnly=true" \
        --output "oaquerylog.gz"

Example Response 
~~~~~~~~~~~~~~~~

The ``curl`` command in this example saves the log file to 
:file:`oaquerylog.gz` in the current working directory and shows the 
following progress output. 

.. code-block:: json 
   :copyable: false 

   % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
   100   106  100   106    0     0    233      0 --:--:-- --:--:-- --:--:--   233
   100 2683k    0 2683k    0     0   541k      0 --:--:--  0:00:04 --:--:--  755k
