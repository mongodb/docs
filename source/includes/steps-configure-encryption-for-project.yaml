---
ref: click-security-advanced
stepnum: 1
inherit:
  file: steps-source-project-nav.yaml
  ref: project-nav-advanced-page
---
ref: toggle-encryption-on
stepnum: 2
level: 4
source:
  file: steps-enable-encryption-for-project.yaml
  ref: toggle-encryption-on
---
title: "Enter your key management provider account credentials and provide an encryption key."
stepnum: 3
level: 4
ref: select-kms
---
title: "Click :guilabel:`Save`."
stepnum: 4
level: 4
ref: click-save
---
title: "Allow access to or from the |service| control plane."
stepnum: 5
level: 4
ref: access-atlas-control-plane
optional: true
content: |

  Depending on your Key Management Service configuration, you may 
  have to add |service| control plane IP addresses to enable 
  Encryption at Rest for your project so that |service| can communicate with your 
  KMS. To enable communication between |service| and KMS:

  a. Send a GET request to the ``controlPlaneIPAddresses`` endpoint. 
     The :oas-atlas-op:`API endpoint </controlPlaneIPAddresses>` returns a list of 
     inbound and outbound |service| control plane IP addresses in CIDR categorized by 
     cloud provider and region, similar to the following:

     .. code-block:: json

        {
          "controlPlane": {
            "inbound": {
              "aws": { // cloud provider
                "us-east-1": [ // region
                  "3.92.113.229/32",
                  "3.208.110.31/32",
                  "107.22.44.69/32"
                  ...,
                ],
                ...
              }
            },
            "outbound": {
              "aws": { // cloud provider
                "us-east-1": [ // region
                  "3.92.113.229/32",
                  "3.208.110.31/32",
                  "107.22.44.69/32"
                  ...,
                ],
                ...
              }
            }
          },
          "data_federation": {
            "inbound": {},
            "outbound" {}
          },
          "app_services": {
            "inbound": {},
            "outbound" {}
          },
          ...
        }

  b. Add the returned IP addresses to your cloud provider's IP access list.
     See the prerequisites for managing customer keys with :ref:`AWS <aws-ksm-prereqs>`, 
     :ref:`Azure <azure-kms-prereqs>`, and :ref:`GCP <gcp-kms-prereqs>` for more information.

...
