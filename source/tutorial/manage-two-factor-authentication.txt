================================================
Manage Two-Factor Authentication for On Prem MMS
================================================

.. default-domain:: mongodb

.. NOTE - This procedure shows up only in the documentation for On Prem MMS.

Overview
--------

When enabled, two-factor authentication requires a user to enter a
verification code to log in and to perform certain protected operations.
Operations that require two-factor authentication include:

- restoring and deleting snapshots,

- stopping and terminating Backup for a :term:`sharded cluster` or
  :term:`replica set`,

- inviting and adding users,

- generating new two-factor authentication backup codes, and

- saving phone numbers for two-factor authentication.

Administrators with access to the MMS Application's
``<install_dir>/conf/conf-mms.properties`` file on your servers can enable
two-factor authentication through the file's
``mms.multiFactorAuth.require`` setting. Administrators can also enable
two-factor authentication to use Twilio to send verification codes to uses.

Users configure two-factor authentication on their accounts through their
:ref:`MMS user profiles <profile-page>`, where they select whether to
receive their verification codes through voice calls, text messages (SMS),
or the Google Authenticator application. If your organization does not use
`Twilio <http://www.twilio.com/docs/quickstart>`_, then users can receive
codes only through Google Authenticator.

Administrators can reset accounts for individual users as needed. Reseting
a user's account clears out the user's existing settings for two-factor
authentication. When the user next performs an action that requires
verification, MMS forces the user to re-enter settings for two-factor
authentication.

Procedures
----------

Enable Two-factor Authentication
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/steps/enable-two-factor-authentication.rst

Enable Twilio Integration
~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/steps/enable-twilio-integration.rst

Reset a User's Two-factor Authentication Account
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Reseting the user's account clears out any existing two-factor
authentication information. The user will be forced to set it up again at
the next login.

You must have the ``global user admin`` or ``global owner`` :doc:`role
</reference/user-roles>` to perform this procedure.

.. include:: /includes/steps/manage-two-factor-authentication-for-user.rst
