.. _provision-migration-host:

==========================
Provision a Migration Host
==========================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol
   
To live migrate your  MongoDB deployment managed in |mms| to
|service-short|, provision a server for the migration host.

Overview
--------

The migration host is a server on which you install a dedicated {+mdbagent+}.
This {+mdbagent+} automates live migration operations. It requires that
you set its configuration option ``agentFeatureCloudMigrationEnabled`` to ``true``.

You use the migration host to manage the live migration process of your
deployment from |mms| to |service-short|. You can't use the migration host
for any other purposes.

After you provision the migration host, its server appears under the
:guilabel:`Servers` tab. A {+mdbagent+} on the migration host runs a
one-time migration of data from |mms| to |service-short| and reports the
live migration status back to |mms|.

To learn about starting a live migration from |mms|, see
:ref:`Migrate a Deployment to Atlas <migrate-to-atlas>` and review the
:ref:`workflow for live migration to Atlas <lm-workflow>`.

Considerations
--------------

If you plan to migrate more than one deployment at a time, create a
dedicated migration host for each of the deployments that you want
to migrate to |service-short|.

.. _live-migration-host-supported-platforms:

Prerequisites
-------------

The migration host must use a 64-bit chip architecture and one of the
following supported platforms:

- Amazon Linux 2 (``linux-x86_64-enterprise-amazon2``)
- Debian 8.x, 9.x, 10, 11
- ARM64: Ubuntu 16.04, Ubuntu 18.x, Ubuntu 20.x
- PowerPC (``ppc64le``): RHEL 7.x/8.x
- zSeries (``s390x``): RHEL 7.x/8.x
- RHEL 7.x, 8.x
- SLES 12, 15
- Ubuntu 18.x, 20.x

.. note::
   The configuration of a migration host for live migration is not
   supported on Windows or macOS. You can still live migrate your data
   from a Windows-based deployment to |service-short| if you
   provision your migration host on one of the platforms it supports. 
   You can't live migrate your data from a macOS-based deployment to 
   |service-short|.

If |mms| is running in local mode, you must have outgoing 
access to the following server to download :atlas:`mongomirror 
</reference/mongomirror/>`.

.. code-block:: none
   :copyable: false

   translators-connectors-releases.s3.amazonaws.com

.. _live-migration-host-resource-requirements:

Migration Host Resource Requirements
-------------------------------------

The live migration process is CPU-intensive and requires sufficient
network bandwidth. Use a cloud instance or an on-premises server with
enough resources to help ensure a successful migration.

For a replica set migration, a host with 2-4 CPU cores and 4-8 GB of RAM
is typically sufficient. For a sharded cluster migration,
a host with 2-4 CPU cores per shard is typically sufficient.
Avoid host environments that have been characterized as having
low network bandwidth.

You may also need to provision additional storage for the
:setting:`cloudMigrationOplogPath` option described in the following
procedure.

Procedure
---------

.. include:: /includes/steps/install-agent-live-migration.rst

Next Steps
----------

Once you have provisioned the migration host, you can switch to
|service-short| and follow the steps in the wizard to
:atlas:`start the live migration process </migration-from-com>`.
