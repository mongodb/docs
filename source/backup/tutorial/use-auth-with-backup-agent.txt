==================================================
Use MongoDB Authentication with the |backup| Agent
==================================================

If you are using |backup| with a MongoDB instance with authentication
enabled, there are additional steps you will need to take before you
can start using |backup|.

Create a New User for the |backup| Agent
----------------------------------------

Connect to the :program:`mongod` or :program:`mongos` instance you
will be backing up using the :program:`mongo` shell.

Create a new user for the |backup| Agent using a command that
resembles the following:

.. code-block:: javascript

   use admin
   db.addUser(
   {
       user: 'USERNAME',
       pwd: 'PASSWORD',
       roles: ['readAnyDatabase', 'clusterAdmin', 'userAdminAnyDatabase'],
       otherDBRoles: {local: ['readWrite'], admin: ['readWrite']}
   } )

.. TODO: following note is true until BRS-837 gets resolved

.. note:: 

   There is currently no way to change the |backup| Agent username and
   password after you have enabled backup on a replica set or sharded
   cluster and performed an initial sync.

You can now install the |backup| Agent. See:
:doc:`/backup/tutorial/install-and-start-backup-agent` for more
information. You will need to provide the username and password during
the |backup| setup process.
