:orphan:

==========================
Backup Agent Configuration
==========================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. include:: /includes/legacy-agents/fact-backup-agent-deprecated.rst

This page describes possible settings for Backup Agent. These
values are set after first launching |mms| and not through manual
editing of these files.

.. cond:: onprem

   See :doc:`/reference/configuration/` for the
   |mms| settings and their values.

.. warning::

   Do **not** edit these settings for a Backup Agent that is managed by
   an Automation Agent. If you do, the Automation Agent can overwrite
   any changes you make. If you are not using the Automation Agent, you
   must edit these settings manually.

Configuration File Location on Each Platform
--------------------------------------------

The location of the Backup Agent configuration file depends on your
platform:

.. include:: /includes/list-table-backup-agent-conf-file-locations.rst

Backup Agent Settings
---------------------

|mms| provides the values for these Backup Agent settings when |mms|
is initially configured.

.. important::
   You must set the :bsetting:`mmsApiKey` value.

.. _backup-connection-settings:

Connection Settings
~~~~~~~~~~~~~~~~~~~

For the Backup Agent to communicate with the |mms| servers, these
connection settings are **required**:

.. bsetting:: mmsGroupId

   *Type*: string

   Specifies the ID of your |mms| project. The project ID is displayed
   in the :guilabel:`Project Settings` page
   (:guilabel:`Settings` > :guilabel:`Project Settings`).

   .. cond:: cloud

      *Required*.

   .. cond:: onprem

      This setting is usually set when the Automation Agent is
      installed and is required to bind the server to a project.

   .. code-block:: ini

      mmsGroupId=8zvbo2s2asigxvmpnkq5yexf

.. bsetting:: mmsApiKey

   *Type*: string

   Specifies the |mms| agent API key of your |mms| project.

   .. include:: /includes/extracts/agent-api-key-specify.rst

   This setting is usually set when the Backup Agent is installed and
   *it is required*.

   .. code-block:: ini

      mmsApiKey=rgdte4w7wwbnds9nceuodx9mcte2zqem

.. bsetting:: mothership

   *Type*: string

   Specifies the URL of the |application|.

.. bsetting:: mothershipResponseHeaderTimeout

   *Type*: integer

   Specifies the length of time in seconds the Backup Agent
   waits to get a response from the |application|. If the agent does
   not get a response within the time specified with this value, it
   resets the connection to the |application| and tries to reconnect.
   Default setting is ``90`` seconds.

.. bsetting:: https

   *Type*: boolean

   Specifies whether or not communication with the |mms| web server
   uses Secure |http|.

.. _backup-logging-settings:

Logging Settings
~~~~~~~~~~~~~~~~

.. bsetting:: logFile

   *Type*: string

   Specifies the absolute path to the log file. If this is not
   specified, the log writes to standard error (``stderr``) on UNIX-
   and Linux-based systems and to the Event Log on Windows systems.

.. bsetting:: maxLogFileSizeBytes

   *Type*: integer

   Specifies the maximum size, in bytes, of a log file before the logs
   are rotated. If unspecified, the Backup Agent does not rotate
   logs based on file size. This is optional.

   .. code-block:: ini

      maxLogFileSizeBytes=536870912

.. bsetting:: maxLogFileDurationHrs

   *Type*: float

   Specifies the number of hours after which the log file is rotated.
   This is optional and only supported on UNIX- and Linux-based
   systems.

   .. note::
      You can manually rotate the Backup Agent logs. Issue a user
      signal 1 kill command for the Backup Agent process:

      .. code-block:: sh

         kill -SIGUSR1 <backupAgentID>

      This rotates the Backup Agent log file.

HTTP Proxy Settings
~~~~~~~~~~~~~~~~~~~

.. bsetting:: httpProxy

   *Type*: string

   Specifies the |url| of an |http| proxy server the Backup Agent can
   use.

   .. code-block:: ini

      httpProxy=http://proxy.example.com:8080

.. _backup-mongodb-kerberos-settings:

MongoDB Kerberos Settings
~~~~~~~~~~~~~~~~~~~~~~~~~

Specify these settings if the Backup Agent authenticates to hosts using
Kerberos. See :doc:`/tutorial/configure-backup-agent-for-kerberos` for
more information.

.. bsetting:: krb5Principal

   *Type*: string

   Specifies the Kerberos principal the Backup Agent uses.

   .. code-block:: ini

      krb5Principal=mmsagent/myhost@EXAMPLE.COM

.. bsetting:: krb5Keytab

   *Type*: string

    Specifies the *absolute* path to Kerberos principal's keytab file.

   .. code-block:: ini

      krb5Keytab=/path/to/backup-agent.keytab

.. bsetting:: krb5ConfigLocation

   *Type*: string

   Specifies the *absolute* path to an non-system-standard location for
   the Kerberos configuration file.

   .. code-block:: ini

      krb5ConfigLocation=/path/to/krb_custom.conf

.. bsetting:: gsappiServiceName

   *Type*: string

   Specifies the service name with the :bsetting:`gssapiServiceName`
   option.

   *By default, MongoDB uses* ``mongodb`` *as its service name.*

.. include:: /includes/fact-set-krb5ccname.rst

.. _backup-mongodb-ssl-settings:

MongoDB TLS Settings
~~~~~~~~~~~~~~~~~~~~

Specify these settings when the Backup Agent connects to MongoDB
deployments using |tls|. To learn more, see
:doc:`/tutorial/configure-backup-agent-for-ssl`.

.. bsetting:: sslClientCertificate

   *Type*: string

   Specifies the path to the private key, client certificate, and
   optional intermediate certificates in ``PEM`` format. The Backup
   Agent uses the client certificate when connecting to a MongoDB
   deployment that uses |tls| and requires client certificates (one
   that runs with the :option:`--tlsCAFile <mongod.--tlsCAFile>`
   option).

.. bsetting:: sslClientCertificatePassword

   *Type*: string

   Specifies the password needed to decrypt the private key in the
   ``sslClientCertificate`` file. This setting is needed when the
   client certificate PEM file is encrypted.

.. bsetting:: sslClientCertificateSubject

   *Type*: string

   Specifies the certificate's subject, which contains the
   Distinguished Name (DN). If not set, |mms| extracts this value from
   the certificate.

.. bsetting:: sslTrustedServerCertificates

   *Type*: string

   Specifies the path that contains the trusted CA certificates in
   ``PEM`` format. These certificates verify the server certificate
   returned from any MongoDB deployments running with |tls|.

   .. code-block:: ini

      sslTrustedServerCertificates=/path/to/mongodb-certs.pem

.. bsetting:: sslRequireValidServerCertificates

   *Type*: boolean

   Specifies if the Backup Agent should validate |tls| certificates
   presented by the MongoDB deployments.

   .. warning::

      Setting this option to ``false`` disables certificate
      verification and makes connections between the Backup Agent and
      MongoDB deployments susceptible to *man-in-the-middle* attacks.
      Setting this option to ``false`` is only recommended for testing
      purposes.

.. _monitoring-server-ssl-settings:
.. _backup-server-ssl-settings:

|mms| Server TLS Settings
~~~~~~~~~~~~~~~~~~~~~~~~~

Specify the settings the Backup Agent uses when communicating with
|mms| using |tls|.

.. bsetting:: sslTrustedMMSBackupServerCertificate

   Specifies the path that contains the trusted CA certificates in
   ``PEM`` format. The Backup Agent uses this certificate to verify
   that the agent is communicating with the designated |mms| instance.

   *By default, the Backup Agent uses the trusted root CAs installed
   on the system.*

   If the Backup Agent cannot find the trusted root CAs,
   configure these settings manually.

   .. cond:: onprem

      If |mms| is using a self-signed |tls| certificate, this setting
      is required.

   .. code-block:: ini

      sslTrustedMMSBackupServerCertificate=/path/to/mms-certs.pem

.. additional settings are in the following extracts file:

.. include:: /includes/extracts/backup-agent-configuration-ssl.rst
