.. facet::
   :name: programming_language
   :values: csharp, go, java, javascript/typescript, python

.. _local-rag:

===========================================================
Build a Local RAG Implementation with {+avs+}
===========================================================

.. default-domain:: mongodb

.. facet::
   :name: genre
   :values: tutorial

.. meta::
   :description: How to implement retrieval-augmented generation (RAG) for MongoDB Vector Search using local embedding models and chat models.
   :keywords: RAG, local RAG, LLM, code example, sample dataset, Node.js, Java (Sync), Python, java sync, node.js, go, .NET, local deployment, vector database, Hugging Face

.. dismissible-skills-card::
   :skill: RAG with MongoDB
   :url: https://learn.mongodb.com/skills?openTab=gen+ai

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

This tutorial demonstrates how to implement
retrieval-augmented generation (RAG)
locally, without the need for |api| keys or credits.
To learn more about |rag|, see :ref:`ai-key-concepts`.

Specifically, you perform the following actions:

#. Create a local |service| {+deployment+}.
#. Set up the environment.
#. Use a local embedding model to generate vector embeddings.
#. Create a {+avs+} index on your data.
#. Use a local LLM to answer questions on your data.

.. composable-tutorial::
   :options: language-no-interface, index-creation-method
   :defaults: python, driver

   .. selected-content::
      :selections: python, driver

      .. cta-banner::
         :url: https://github.com/mongodb/docs-notebooks/blob/main/use-cases/local-rag.ipynb
         :icon: Code

         Work with a runnable version of this tutorial as a :github:`Python notebook <mongodb/docs-notebooks/blob/main/use-cases/local-rag.ipynb>`.

      .. note::

         For a local |rag| implementation with LangChain, see :ref:`langchain-local-rag`.

   .. selected-content::
      :selections: python, atlas-cli

      .. cta-banner::
         :url: https://github.com/mongodb/docs-notebooks/blob/main/use-cases/local-rag.ipynb
         :icon: Code

         Work with a runnable version of this tutorial as a :github:`Python notebook <mongodb/docs-notebooks/blob/main/use-cases/local-rag.ipynb>`.

      .. note::

         For a local |rag| implementation with LangChain, see :ref:`langchain-local-rag`.

   .. collapsible::
      :heading: About this Tutorial
      :expanded: false

      In this tutorial, you create a local |service|
      {+deployment+} by using the :ref:`{+atlas-cli+}
      <atlas-programmatic-access-cli-overview>`. The {+atlas-cli+}
      is the command-line interface for |service-fullname|, and you can use
      the {+atlas-cli+} to interact with |service| from the terminal for
      various tasks, including creating local |service| {+deployments+}.
      To learn more, see
      :atlascli:`Manage Local and Cloud Deployments from the Atlas CLI </atlas-cli-local-cloud>`.

      You can also use a MongoDB Community or Enterprise cluster with 
      :ref:`Search and Vector Search <community-search-deploy>` installed.  

      .. note::

         Local |service| {+deployments+} are intended for testing only.
         For production environments, :ref:`deploy a {+cluster+} <create-new-cluster>`.
            
      .. selected-content::
         :selections: csharp, driver

         You also use the following open-source models in this tutorial:

         - `Nomic Embed Text <https://ollama.com/library/nomic-embed-text>`__ embedding model
         - `Mistral 7B <https://ollama.com/library/mistral>`__ generative model

         There are several ways to download and deploy |llm|\s locally.
         In this tutorial, you download `Ollama <https://ollama.com/>`__ and pull
         the open source models listed above to perform |rag| tasks.

         This tutorial also uses the `Microsoft.Extensions.AI.Ollama
         <https://aka.ms/meai-ollama-nuget>`__ package to connect to these models
         and integrate them with {+avs+}. If you prefer different models or a
         different framework, you can adapt this tutorial by replacing
         the Ollama model names with their equivalents for your preferred setup.

      .. selected-content::
         :selections: csharp, atlas-cli

         You also use the following open-source models in this tutorial:

         - `Nomic Embed Text <https://ollama.com/library/nomic-embed-text>`__ embedding model
         - `Mistral 7B <https://ollama.com/library/mistral>`__ generative model

         There are several ways to download and deploy |llm|\s locally.
         In this tutorial, you download `Ollama <https://ollama.com/>`__ and pull
         the open source models listed above to perform |rag| tasks.

         This tutorial also uses the `Microsoft.Extensions.AI.Ollama
         <https://aka.ms/meai-ollama-nuget>`__ package to connect to these models
         and integrate them with {+avs+}. If you prefer different models or a
         different framework, you can adapt this tutorial by replacing
         the Ollama model names with their equivalents for your preferred setup.

      .. selected-content::
         :selections: go, driver

         You also use the following open-source models in this tutorial:

         - `Nomic Embed Text <https://ollama.com/library/nomic-embed-text>`__ embedding model
         - `Mistral 7B <https://ollama.com/library/mistral>`__ generative model

         There are several ways to download and deploy |llm|\s locally.
         In this tutorial, you download `Ollama <https://ollama.com/>`__ and pull
         the open source models listed above to perform |rag| tasks.

         This tutorial also uses the `Go language port of LangChain
         <https://tmc.github.io/langchaingo/docs/>`__, a popular
         open-source LLM framework, to connect to these models and
         integrate them with {+avs+}. If you prefer different models or a
         different framework, you can adapt this tutorial by replacing
         the Ollama model names or LangChain library components
         with their equivalents for your preferred setup.

      .. selected-content::
         :selections: go, atlas-cli

         You also use the following open-source models in this tutorial:

         - `Nomic Embed Text <https://ollama.com/library/nomic-embed-text>`__ embedding model
         - `Mistral 7B <https://ollama.com/library/mistral>`__ generative model

         There are several ways to download and deploy |llm|\s locally.
         In this tutorial, you download `Ollama <https://ollama.com/>`__ and pull
         the open source models listed above to perform |rag| tasks.

         This tutorial also uses the `Go language port of LangChain
         <https://tmc.github.io/langchaingo/docs/>`__, a popular
         open-source LLM framework, to connect to these models and
         integrate them with {+avs+}. If you prefer different models or a
         different framework, you can adapt this tutorial by replacing
         the Ollama model names or LangChain library components
         with their equivalents for your preferred setup.

      .. selected-content::
         :selections: java-sync, driver

         There are several ways to download and deploy |llm|\s locally.
         In this tutorial, you download `Ollama <https://ollama.com/>`__ and pull
         the following open source models to perform |rag| tasks:

         - `Nomic Embed Text <https://ollama.com/library/nomic-embed-text>`__
           embedding model
         - `Mistral 7B <https://ollama.com/library/mistral>`__ generative model

         This tutorial also uses `LangChain4j
         <https://docs.langchain4j.dev/intro/>`__, a popular
         open-source LLM framework for Java, to connect to these models and
         integrate them with {+avs+}. If you prefer different models or a
         different framework, you can adapt this tutorial by replacing
         the Ollama model names or LangChain4j library components
         with their equivalents for your preferred setup.

      .. selected-content::
         :selections: java-sync, atlas-cli

         There are several ways to download and deploy |llm|\s locally.
         In this tutorial, you download `Ollama <https://ollama.com/>`__ and pull
         the following open source models to perform |rag| tasks:

         - `Nomic Embed Text <https://ollama.com/library/nomic-embed-text>`__
           embedding model
         - `Mistral 7B <https://ollama.com/library/mistral>`__ generative model

         This tutorial also uses `LangChain4j
         <https://docs.langchain4j.dev/intro/>`__, a popular
         open-source LLM framework for Java, to connect to these models and
         integrate them with {+avs+}. If you prefer different models or a
         different framework, you can adapt this tutorial by replacing
         the Ollama model names or LangChain4j library components
         with their equivalents for your preferred setup.

      .. selected-content::
         :selections: nodejs, driver

         You also use the following open-source models in this tutorial:

         - `mxbai-embed-large-v1 <https://huggingface.co/mixedbread-ai/mxbai-embed-large-v1>`__ embedding model
         - `Mistral 7B <https://docs.mistral.ai/getting-started/models/>`__ generative model

         There are several ways to download and deploy |llm|\s locally.
         In this tutorial, you download the Mistral 7B model
         by using `GPT4All <https://gpt4all.io/index.html>`__,
         an open-source ecosystem for local LLM development.

      .. selected-content::
         :selections: nodejs, atlas-cli

         You also use the following open-source models in this tutorial:

         - `mxbai-embed-large-v1 <https://huggingface.co/mixedbread-ai/mxbai-embed-large-v1>`__ embedding model
         - `Mistral 7B <https://docs.mistral.ai/getting-started/models/>`__ generative model

         There are several ways to download and deploy |llm|\s locally.
         In this tutorial, you download the Mistral 7B model
         by using `GPT4All <https://gpt4all.io/index.html>`__,
         an open-source ecosystem for local LLM development.

      .. selected-content::
         :selections: python, driver

         When working through this tutorial, you use an interactive Python notebook.
         This environment allows you to create and execute individual code blocks without
         running the entire file each time.

         You also use the following open-source models in this tutorial:

         - `mxbai-embed-large-v1 <https://huggingface.co/mixedbread-ai/mxbai-embed-large-v1>`__ embedding model
         - `Mistral 7B <https://docs.mistral.ai/getting-started/models/>`__ generative model

         There are several ways to download and deploy |llm|\s locally.
         In this tutorial, you download the Mistral 7B model
         by using `GPT4All <https://gpt4all.io/index.html>`__,
         an open-source ecosystem for local LLM development.

      .. selected-content::
         :selections: python, atlas-cli

         When working through this tutorial, you use an interactive Python notebook.
         This environment allows you to create and execute individual code blocks without
         running the entire file each time.

         You also use the following open-source models in this tutorial:

         - `mxbai-embed-large-v1 <https://huggingface.co/mixedbread-ai/mxbai-embed-large-v1>`__ embedding model
         - `Mistral 7B <https://docs.mistral.ai/getting-started/models/>`__ generative model

         There are several ways to download and deploy |llm|\s locally.
         In this tutorial, you download the Mistral 7B model
         by using `GPT4All <https://gpt4all.io/index.html>`__,
         an open-source ecosystem for local LLM development.

   Prerequisites
   ~~~~~~~~~~~~~

   In addition to the :ref:`common prerequisites <avs-tutorials-prereqs>`,
   this tutorial requires the following:

   .. selected-content::
      :selections: csharp, driver

      .. include:: /includes/avs/local-rag/prerequisites-csharp.rst

   .. selected-content::
      :selections: csharp, atlas-cli

      .. include:: /includes/avs/local-rag/prerequisites-csharp.rst

   .. selected-content::
      :selections: go, driver

      .. include:: /includes/avs/local-rag/prerequisites-go.rst

   .. selected-content::
      :selections: go, atlas-cli

      .. include:: /includes/avs/local-rag/prerequisites-go.rst

   .. selected-content::
      :selections: java-sync, driver

      .. include:: /includes/avs/local-rag/prerequisites-java-sync.rst

   .. selected-content::
      :selections: java-sync, atlas-cli

      .. include:: /includes/avs/local-rag/prerequisites-java-sync.rst

   .. selected-content::
      :selections: nodejs, driver

      .. include:: /includes/avs/local-rag/prerequisites-nodejs.rst

   .. selected-content::
      :selections: nodejs, atlas-cli

      .. include:: /includes/avs/local-rag/prerequisites-nodejs.rst

   .. selected-content::
      :selections: python, driver

      .. include:: /includes/avs/local-rag/prerequisites-python.rst

   .. selected-content::
      :selections: python, atlas-cli

      .. include:: /includes/avs/local-rag/prerequisites-python.rst

   Create a Local {+Deployment+}
   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

   In this section, you create local |service| {+deployment+} loaded with
   the :ref:`sample AirBnB listings <sample-airbnb>` dataset to use as a vector
   database.

   .. note::

      If you already have an existing local deployment or a MongoDB Community or Enterprise cluster with 
      :ref:`Search and Vector Search <community-search-deploy>` installed,
      with the ``sample_airbnb.listingsAndReviews`` sample data
      loaded, you can skip this step.

   .. include:: /includes/search-shared/steps-create-local-deployment-atlas-cli.rst

   Set Up the Environment
   ~~~~~~~~~~~~~~~~~~~~~~

   .. selected-content::
      :selections: csharp, driver

      In this section, you set up the environment for this tutorial. Create
      a project, install the required packages, and define a connection
      string:

      .. include:: /includes/avs/local-rag/avs-local-rag-set-up-environment-csharp.rst

   .. selected-content::
      :selections: csharp, atlas-cli

      In this section, you set up the environment for this tutorial. Create
      a project, install the required packages, and define a connection
      string:

      .. include:: /includes/avs/local-rag/avs-local-rag-set-up-environment-csharp.rst

   .. selected-content::
      :selections: go, driver

      In this section, you set up the environment for this tutorial. Create
      a project, install the required packages, and define a connection
      string:

      .. include:: /includes/avs/local-rag/avs-local-rag-set-up-environment-go.rst

   .. selected-content::
      :selections: go, atlas-cli

      In this section, you set up the environment for this tutorial. Create
      a project, install the required packages, and define a connection
      string:

      .. include:: /includes/avs/local-rag/avs-local-rag-set-up-environment-go.rst

   .. selected-content::
      :selections: java-sync, driver

      In this section, you set up the environment for this tutorial. Create
      a project, install the required packages, and define a connection
      string:

      .. include:: /includes/avs/local-rag/avs-local-rag-set-up-environment-java.rst

   .. selected-content::
      :selections: java-sync, atlas-cli

      In this section, you set up the environment for this tutorial. Create
      a project, install the required packages, and define a connection
      string:

      .. include:: /includes/avs/local-rag/avs-local-rag-set-up-environment-java.rst

   .. selected-content::
      :selections: nodejs, driver

      In this section, you set up the environment for this tutorial. Create
      a project, install the required packages, and define a connection
      string:

      .. include:: /includes/avs/local-rag/avs-local-rag-set-up-environment-javascript.rst

   .. selected-content::
      :selections: nodejs, atlas-cli

      In this section, you set up the environment for this tutorial. Create
      a project, install the required packages, and define a connection
      string:

      .. include:: /includes/avs/local-rag/avs-local-rag-set-up-environment-javascript.rst

   .. selected-content::
      :selections: python, driver

      In this section, you set up the environment for this tutorial.

      .. include:: /includes/ai-integrations/langchain/local-rag-set-up-environment.rst

   .. selected-content::
      :selections: python, atlas-cli

      In this section, you set up the environment for this tutorial.

      .. include:: /includes/ai-integrations/langchain/local-rag-set-up-environment.rst

   .. _local-rag-embeddings:

   Generate Embeddings with a Local Model
   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

   In this section, you load an embedding model locally and
   generate vector embeddings by using data from the
   :ref:`sample_airbnb <sample-airbnb>` database,
   which contains a collection called ``listingsAndReviews``.

   .. selected-content::
      :selections: csharp, driver

      .. include:: /includes/avs/local-rag/avs-local-rag-generate-embeddings-with-local-model-csharp.rst

   .. selected-content::
      :selections: csharp, atlas-cli

      .. include:: /includes/avs/local-rag/avs-local-rag-generate-embeddings-with-local-model-csharp.rst

   .. selected-content::
      :selections: go, driver

      .. include:: /includes/avs/local-rag/avs-local-rag-generate-embeddings-with-local-model-go.rst

   .. selected-content::
      :selections: go, atlas-cli

      .. include:: /includes/avs/local-rag/avs-local-rag-generate-embeddings-with-local-model-go.rst

   .. selected-content::
      :selections: java-sync, driver

      .. include:: /includes/avs/local-rag/avs-local-rag-generate-embeddings-with-local-model-java.rst

   .. selected-content::
      :selections: java-sync, atlas-cli

      .. include:: /includes/avs/local-rag/avs-local-rag-generate-embeddings-with-local-model-java.rst

   .. selected-content::
      :selections: nodejs, driver

      .. include:: /includes/avs/local-rag/avs-local-rag-generate-embeddings-with-local-model-javascript.rst

   .. selected-content::
      :selections: nodejs, atlas-cli

      .. include:: /includes/avs/local-rag/avs-local-rag-generate-embeddings-with-local-model-javascript.rst

   .. selected-content::
      :selections: python, driver

      .. include:: /includes/avs/local-rag/avs-local-rag-generate-embeddings-python.rst

   .. selected-content::
      :selections: python, atlas-cli

      .. include:: /includes/avs/local-rag/avs-local-rag-generate-embeddings-python.rst

   This code might take several minutes to run. After it's finished, you can
   view your vector embeddings by connecting to your local {+deployment+}
   from {+mongosh+} or your application using your {+deployment+}'s
   connection string. Then you can run :manual:`read operations
   </crud/#read-operations>` on the ``sample_airbnb.listingsAndReviews``
   collection.

   .. tip::

      You can convert the embeddings in the sample data to |bson| vectors for
      efficient storage and ingestion of vectors in |service|. To learn
      more, see :ref:`how to convert native embeddings to BSON vectors
      <avs-bindata-vector-subtype>`.

   Create the {+avs+} Index
   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

   To enable vector search on the ``sample_airbnb.listingsAndReviews``
   collection, create a {+avs+} index.

   .. selected-content::
      :selections: csharp, driver

      To create a {+avs+} index for a collection using the :driver:`MongoDB C# driver </csharp/current/fundamentals/indexes/>` v3.1.0 or later, perform the following steps:

      .. include:: /includes/avs/local-rag/create-index-programmatically-csharp.rst

   .. selected-content::
      :selections: go, driver

      To create a {+avs+} index for a collection using the :driver:`MongoDB Go driver </go/current/fundamentals/indexes/>` v2.0 or later, perform the following steps:

      .. include:: /includes/avs/local-rag/create-index-programmatically-go.rst

      .. note:: Programmatic Index Creation

         The MongoDB Go driver supports programmatic {+avs+} index creation starting
         in v1.16.0, but the preceding code shows the syntax for the v2.x driver.

   .. selected-content::
      :selections: java-sync, driver

      To create a {+avs+} index for a collection using the
      :driver:`MongoDB Java driver </java/sync/current/fundamentals/indexes/>`
      v5.2.0 or later, perform the following steps:

      .. include:: /includes/avs/local-rag/create-index-programmatically-java.rst

   .. selected-content::
      :selections: nodejs, driver

      To create a {+avs+} index for a collection using the
      :driver:`MongoDB Node driver </node/current/fundamentals/indexes/>`
      v6.6.0 or later, perform the following steps:

      .. include:: /includes/avs/local-rag/create-index-programmatically-javascript.rst

   .. selected-content::
      :selections: python, driver

      To create a {+avs+} index for a collection using the
      `PyMongo <https://www.mongodb.com/docs/languages/python/pymongo-driver/current/indexes/atlas-search-index/>`__
      driver v4.7 or later, perform the following steps:

      .. include:: /includes/avs/local-rag/create-index-programmatically-python.rst

   .. selected-content::
      :selections: csharp, atlas-cli

      To create a {+avs+} index using the {+atlas-cli+}, perform the following steps:

      .. include:: /includes/avs/local-rag/local-rag-create-index-cli-nomic-dims.rst

   .. selected-content::
      :selections: go, atlas-cli

      To create a {+avs+} index using the {+atlas-cli+}, perform the following steps:

      .. include:: /includes/avs/local-rag/local-rag-create-index-cli-nomic-dims.rst

   .. selected-content::
      :selections: java-sync, atlas-cli

      To create a {+avs+} index using the {+atlas-cli+}, perform the following steps:

      .. include:: /includes/avs/local-rag/local-rag-create-index-cli-nomic-dims.rst

   .. selected-content::
      :selections: nodejs, atlas-cli

      To create a {+avs+} index using the {+atlas-cli+}, perform the following steps:

      .. include:: /includes/avs/local-rag/local-rag-create-index-cli-nomic-dims.rst

   .. selected-content::
      :selections: python, atlas-cli

      To create a {+avs+} index using the {+atlas-cli+}, perform the following steps:

      .. include:: /includes/avs/local-rag/local-rag-create-index-cli-nomic-dims.rst

   Answer Questions with the Local LLM
   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

   .. selected-content::
      :selections: csharp, driver

      This section demonstrates a sample |rag| implementation
      that you can run locally using {+avs+} and Ollama.

      .. include:: /includes/avs/local-rag/perform-qa-csharp.rst

   .. selected-content::
      :selections: csharp, atlas-cli

      This section demonstrates a sample |rag| implementation
      that you can run locally using {+avs+} and Ollama.

      .. include:: /includes/avs/local-rag/perform-qa-csharp.rst

   .. selected-content::
      :selections: go, driver

      This section demonstrates a sample |rag| implementation
      that you can run locally using {+avs+} and Ollama.

      .. include:: /includes/avs/local-rag/perform-qa-go.rst

   .. selected-content::
      :selections: go, atlas-cli

      This section demonstrates a sample |rag| implementation
      that you can run locally using {+avs+} and Ollama.

      .. include:: /includes/avs/local-rag/perform-qa-go.rst

   .. selected-content::
      :selections: java-sync, driver

      This section demonstrates a sample |rag| implementation
      that you can run locally using {+avs+} and Ollama.

      .. include:: /includes/avs/local-rag/perform-qa-java.rst

   .. selected-content::
      :selections: java-sync, atlas-cli

      This section demonstrates a sample |rag| implementation
      that you can run locally using {+avs+} and Ollama.

      .. include:: /includes/avs/local-rag/perform-qa-java.rst

   .. selected-content::
      :selections: nodejs, driver

      This section demonstrates a sample |rag| implementation
      that you can run locally using {+avs+} and GPT4All.

      .. include:: /includes/avs/local-rag/perform-qa-javascript.rst

   .. selected-content::
      :selections: nodejs, atlas-cli

      This section demonstrates a sample |rag| implementation
      that you can run locally using {+avs+} and GPT4All.

      .. include:: /includes/avs/local-rag/perform-qa-javascript.rst

   .. selected-content::
      :selections: python, driver

      This section demonstrates a sample |rag| implementation
      that you can run locally using {+avs+} and GPT4All.

      In your notebook, run the following code snippets:

      .. include:: /includes/ai-integrations/langchain/local-rag-perform-qa.rst

   .. selected-content::
      :selections: python, atlas-cli

      This section demonstrates a sample |rag| implementation
      that you can run locally using {+avs+} and GPT4All.

      In your notebook, run the following code snippets:

      .. include:: /includes/ai-integrations/langchain/local-rag-perform-qa.rst
