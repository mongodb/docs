.. _unsupported-commands:

=============================
Unsupported Commands in Atlas
=============================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: onecol

.. _free-tier-command-limitations:

Unsupported Commands in ``M0/M2/M5`` Clusters
---------------------------------------------

.. |starter| replace:: ``M0`` {+free-clusters+} and ``M2``/``M5`` {+shared-cluster+}

|service| |starter|\s don't support all functionality available to
other clusters.

.. important::

   |starter|\s don't support read or write operations on the ``admin``
   database.

To learn more about ``M0``/``M2``/``M5`` limitations, see
:ref:`atlas-free-tier`.

.. note::

   |service| returns the same error message for unsupported commands 
   and invalid syntax. If |service| returns an error, ensure that you 
   use a supported command and verify the syntax. For more information 
   and examples, see the :manual:`database commands 
   </reference/command>`.

.. _free-shard-commands-with-limits:

Limited Commands
~~~~~~~~~~~~~~~~

The following commands can be run with limitations in |starter|\s:

.. list-table::
   :header-rows: 1
   :widths: 15 85

   * - Command
     - Limitation

   * - :dbcommand:`aggregate`
     -

       - Limits the ``maxTimeMs`` parameter to 300 seconds
         (``300000``).
       - Ignores the ``allowDiskUsage`` parameter.
       - Doesn't support :manual:`$accumulator 
         </reference/operator/aggregation/accumulator/>` and 
         :manual:`$function </reference/operator/aggregation/function/>` 
         operators.

   * - :dbcommand:`count`
     -

       - Doesn't support the :query:`$where` operator.
       - Limits the :dbcommand:`count` operation on the ``local``
         database to the ``system.replset`` and  ``oplog.rs`` collections.

   * - :dbcommand:`distinct`
     - Doesn't support :query:`$where` operator.

   * - :dbcommand:`find`

     -

       - Doesn't support the :query:`$where` operator.
       - Limits the :dbcommand:`find` operation on the ``local`` database to the ``oplog.rs`` collection.
       - Limits the :dbcommand:`find` operation to using an equality condition when
         querying the ``ns`` field in the ``oplog.rs`` collection on
         the ``local`` database.

         .. code-block:: json

            { "ns" : "test.foo" }

   * - :dbcommand:`getParameter`

     - Limits execution to these two documents:

       - ``{ "getParameter": 1, "authSchemaVersion": 1 }``
       - ``{ "getParameter": 1, "authenticationMechanisms": 1 }``

   * - :method:`db.killOp()`
     - Limits the :method:`db.killOp()` method to to the MongoDB user
       who ran the operation.

   * - :dbcommand:`serverStatus`
     - Limits response to the following fields:

       .. hlist::
          :columns: 2

          - ``$clusterTime.clusterTime``
          - ``$clusterTime.operationTime``
          - ``$clusterTime.signature.hash``
          - ``$clusterTime.signature.keyId``
          - ``$clusterTime.signature``
          - ``asserts.msg``
          - ``asserts.regular``
          - ``asserts.rollovers``
          - ``asserts.user``
          - ``asserts.warning``
          - ``atlasVersion.gitVersion``
          - ``atlasVersion.version``
          - ``connections.available``
          - ``connections.current``
          - ``connections.totalCreated``
          - ``extra_info.note``
          - ``extra_info.page_faults``
          - ``host``
          - ``localTime``
          - ``mem.bits``
          - ``mem.mapped``
          - ``mem.mappedWithJournal``
          - ``mem.resident``
          - ``mem.supported``
          - ``mem.virtual``
          - ``metrics.atlas.bytesInWrites``
          - ``metrics.atlas.connectionPool.totalCreated``
          - ``network.bytesIn``
          - ``network.bytesOut``
          - ``network.numRequests``
          - ``ok``
          - ``opcounters.command``
          - ``opcounters.delete``
          - ``opcounters.getmore``
          - ``opcounters.insert``
          - ``opcounters.query``
          - ``opcounters.update``
          - ``opcountersRepl.command``
          - ``opcountersRepl.delete``
          - ``opcountersRepl.getmore``
          - ``opcountersRepl.insert``
          - ``opcountersRepl.query``
          - ``opcountersRepl.update``
          - ``pid``
          - ``process``
          - ``repl.electionId``
          - ``repl.hosts[]``
          - ``repl.ismaster``
          - ``repl.lastWrite.lastWriteDate``
          - ``repl.lastWrite.majorityOpTime.t``
          - ``repl.lastWrite.majorityOpTime.ts``
          - ``repl.lastWrite.majorityWriteDate``
          - ``repl.lastWrite.opTime.t``
          - ``repl.lastWrite.opTime.ts``
          - ``repl.me``
          - ``repl.primary``
          - ``repl.rbid``
          - ``repl.secondary``
          - ``repl.setName``
          - ``repl.setVersion``
          - ``repl.tags.nodeType``
          - ``repl.tags.provider``
          - ``repl.tags.region``
          - ``repl.tags``
          - ``storageEngine.backupCursorOpen``
          - ``storageEngine.dropPendingIdents``
          - ``storageEngine.name``
          - ``storageEngine.oldestRequiredTimestampForCrashRecovery``
          - ``storageEngine.persistent``
          - ``storageEngine.readOnly``
          - ``storageEngine.supportsCommittedReads``
          - ``storageEngine.supportsPendingDrops``
          - ``storageEngine.supportsSnapshotReadConcern``
          - ``uptime``
          - ``uptimeEstimate``
          - ``uptimeMillis``
          - ``version``

   * - :dbcommand:`usersInfo`

     - Limits to the following document:

       .. code-block:: json

          { "user": "<MYUSER>", "db": "admin" }

.. _free-shard-unsupported-commands:

Unsupported Commands
~~~~~~~~~~~~~~~~~~~~

The following commands are unsupported:

.. note::

   The commands available for clusters of all other tiers, ``M10`` and
   larger, correspond to the privileges defined for the built-in
   |service| MongoDB roles.

   .. seealso::

      To learn more about permissions, see
      :ref:`Atlas User Privileges <atlas-user-privileges>`.

.. hlist::
   :columns: 3

   - ``_migrateClone``
   - ``_recvChunkAbort``
   - ``_recvChunkCommit``
   - ``_recvChunkStart``
   - ``_recvChunkStatus``
   - ``_transferMods``
   - :authaction:`appendOplogNote`
   - :dbcommand:`applyOps`
   - :dbcommand:`authenticate`
   - :authaction:`authSchemaUpgrade`
   - :dbcommand:`checkShardingIndex`
   - :dbcommand:`cleanupOrphaned`
   - ``cloneCollection``
   - :dbcommand:`cloneCollectionAsCapped`
   - :dbcommand:`compact`
   - :dbcommand:`connPoolSync`
   - ``copydbgetnonce``
   - ``copydbsaslstart``
   - :dbcommand:`createRole`
   - :dbcommand:`createUser`
   - ``currentOpCtx``
   - :dbcommand:`dataSize`
   - :dbcommand:`dbHash`
   - :dbcommand:`diagLogging`
   - :dbcommand:`dropAllRolesFromDatabase`
   - :dbcommand:`dropAllUsersFromDatabase`
   - :dbcommand:`dropRole`
   - ``enableFreeMonitoring``
   - ``forcerror``
   - :dbcommand:`fsync`
   - :dbcommand:`fsyncUnlock`
   - ``getDiagnosticData``
   - ``getPrevError``
   - :dbcommand:`getShardMap`
   - :dbcommand:`getShardVersion`
   - :dbcommand:`grantPrivilegesToRole`
   - :dbcommand:`grantRolesToRole`
   - :dbcommand:`grantRolesToUser`
   - ``handshake``
   - :dbcommand:`hostInfo`
   - :dbcommand:`invalidateUserCache`
   - :dbcommand:`killAllSessions`
   - :dbcommand:`killAllSessionsByPattern`
   - :dbcommand:`killSessions`
   - :dbcommand:`lockInfo`
   - :dbcommand:`logRotate`
   - ``shardedFinish``
   - :dbcommand:`mapReduce`
   - :dbcommand:`planCacheClear`
   - :dbcommand:`planCacheClearFilters`
   - :dbcommand:`planCacheListFilters`
   - ``planCacheListPlans``
   - ``planCacheListQueryShapes``
   - :dbcommand:`planCacheSetFilter`
   - :dbcommand:`reIndex`
   - ``repairCursor``
   - ``repairDatabase``
   - ``replSetDeclareElectionWinner``
   - ``replSetElect``
   - :dbcommand:`replSetFreeze`
   - ``replSetFresh``
   - :dbcommand:`replSetGetConfig`
   - ``replSetGetRBID``
   - :dbcommand:`replSetGetStatus`
   - :authaction:`replSetHeartbeat`
   - :dbcommand:`replSetInitiate`
   - :dbcommand:`replSetMaintenance`
   - :dbcommand:`replSetReconfig`
   - ``replSetRequestVotes``
   - :dbcommand:`replSetStepDown`
   - ``replSetStepUp``
   - :dbcommand:`replSetSyncFrom`
   - ``replSetUpdatePosition``
   - :dbcommand:`resetError`
   - :authaction:`resync`
   - :dbcommand:`revokePrivilegesFromRole`
   - :dbcommand:`revokeRolesFromRole`
   - :dbcommand:`revokeRolesFromUser`
   - :dbcommand:`setFeatureCompatibilityVersion`
   - ``setLogLevel``
   - :dbcommand:`setParameter`
   - ``setProfilingLevel``
   - :dbcommand:`shutdown`
   - :dbcommand:`updateRole`
   - :dbcommand:`updateUser`
   - :dbcommand:`validate`

.. include:: /includes/fact-limitation-mongorestore.rst

Aggregation Pipeline
~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/fact-planCacheStats-not-supported.rst

.. _paid-tier-command-limitations:

Unsupported Commands in ``M10+`` Clusters
-----------------------------------------

|service| requires clients to authenticate to access an |service|
cluster. |service| provides a curated list of
:ref:`Database User Privileges <atlas-user-privileges>`.
These privileges provide access to a subset of MongoDB commands.

.. _limited-commands-paid:

Limited Commands
~~~~~~~~~~~~~~~~

|service| limits the :method:`db.killOp()` method to
the MongoDB user who ran the operation.

.. _unsupported-commands-paid:

Unsupported Commands
~~~~~~~~~~~~~~~~~~~~

The following table lists the most common commands and shell methods
that database user privileges do not support. To ensure cluster 
stability and performance, |service| subsumes or restricts the 
functionality that these commands provide.

Administrative
``````````````

.. list-table::
   :widths: 40 30 30 
   :header-rows: 1

   * - Commands
     - Shell Method
     - Privilege Actions

   * - :dbcommand:`setParameter`
     - :method:`db.setLogLevel() <db.setLogLevel>`

       Others that use :dbcommand:`setParameter`.
     - :authaction:`setParameter`

   * - :dbcommand:`logRotate`
     - 
     - :authaction:`logRotate`

   * - :dbcommand:`shutdown`
     - :method:`db.shutdownServer() <db.shutdownServer>`
     - :authaction:`shutdown`

   * - ``eval``
     - ``db.eval()``
     - 

   * - :dbcommand:`fsync`
     - :method:`db.fsyncLock() <db.fsyncLock>`
     - :authaction:`fsync`

   * - :dbcommand:`setFeatureCompatibilityVersion`
     -
     -

Sessions
````````

.. list-table::
   :widths: 40 30 30 
   :header-rows: 1

   * - Commands
     - Shell Method
     - Privilege Actions
  
   * - :dbcommand:`killAllSessions`
     - 
     - :authaction:`killAnySession`

Replication
```````````

.. list-table::
   :widths: 40 30 30
   :header-rows: 1

   * - Commands
     - Shell Method
     - Privilege Actions
  
   * - :dbcommand:`replSetFreeze`
     - :method:`rs.freeze() <rs.freeze>`
     - :authaction:`replSetStateChange`

   * - :dbcommand:`replSetInitiate`
     - :method:`rs.initiate() <rs.initiate>`
     - 

   * - :dbcommand:`replSetMaintenance`
     -
     - :authaction:`replSetStateChange`

   * - :dbcommand:`replSetReconfig`
     - :method:`rs.reconfig() <rs.reconfig>`
     - 

   * - :dbcommand:`replSetResizeOplog`
     -
     - 

   * - :dbcommand:`replSetStepDown`
     - :method:`rs.stepDown() <rs.stepDown>`
     - :authaction:`replSetStateChange`

   * - :dbcommand:`replSetSyncFrom`
     - :method:`rs.syncFrom() <rs.syncFrom>`
     - :authaction:`replSetStateChange`

   * - ``resync``
     -
     - :authaction:`resync`

.. note:: Limitation for ``mongorestore``

   ``M10+`` {+clusters+} don't support the :dbtools:`--preserveUUID
   </mongorestore/#std-option-mongorestore.--preserveUUID>` option for 
   |mongorestore|.

Sharding
````````

.. list-table::
   :widths: 40 30 30
   :header-rows: 1

   * - Commands
     - Shell Method
     - Privilege Actions

   * -
     - :method:`sh.disableBalancing() <sh.disableBalancing>`
     - 

   * -
     - :method:`sh.enableBalancing() <sh.enableBalancing>`
     - 

   * - :dbcommand:`removeShard`
     -
     - :authaction:`removeShard`

   * - :dbcommand:`refineCollectionShardKey` [1]_
     - 
     - :authaction:`refineCollectionShardKey`

.. [1] This command is not supported on :ref:`global write <global-writes-collections>` clusters only.

User and Role Management
````````````````````````

.. note::
   
   As an alternative, see the available :ref:`user-roles`.

.. list-table::
   :widths: 40 30 30
   :header-rows: 1

   * - Commands
     - Shell Method
     - Privilege Actions

   * - :dbcommand:`createUser`
     - :method:`db.createUser() <db.createUser>`
     - :authaction:`createUser`

   * - ``getUser`` [2]_
     - :method:`db.getUser() <db.getUser>` and
       :method:`db.getUsers() <db.getUsers>` [2]_
     - 

   * - :dbcommand:`dropUser`
     - :method:`db.dropUser() <db.dropUser>`
     - :authaction:`dropUser`

   * - :dbcommand:`grantRolesToUser`
     - :method:`db.grantRolesToUser() <db.grantRolesToUser>`
     - :authaction:`grantRole`

   * - :dbcommand:`revokeRolesFromUser`
     - :method:`db.revokeRolesFromUser() <db.revokeRolesFromUser>`
     - :authaction:`revokeRole`

   * - :dbcommand:`updateUser`
     - :method:`db.updateUser() <db.updateUser>`
     - 

   * - :dbcommand:`createRole`
     - :method:`db.createRole() <db.createRole>`
     - :authaction:`createRole`

   * - :dbcommand:`dropRole`
     - :method:`db.dropRole() <db.dropRole>`
     - :authaction:`dropRole`

   * - :dbcommand:`updateRole`
     - :method:`db.updateRole() <db.updateRole>`
     - 

.. [2] You can call ``getUser`` for your own user account.

Aggregation Pipeline
~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/fact-planCacheStats-not-supported.rst

MongoDB 4.2+ Incompatibility
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

MongoDB versions 4.2 and later do not support the following commands 
and methods:

.. list-table::
   :widths: 40 60
   :header-rows: 1

   * - Commands
     - Shell Method

   * - ``parallelCollectionScan``
     -
   * - ``clone``
     - :method:`db.cloneDatabase() <db.cloneDatabase>`
   * - ``copydb``
     - :method:`db.copyDatabase() <db.copyDatabase>`


Contact Support
~~~~~~~~~~~~~~~

Contact |service| :doc:`support </support>` if your use case 
requires access to a command that the |service| database user 
privileges don't currently support.

.. _atlas-serverless-command-limitations:

Unsupported Commands in {+Serverless-Instances+}
------------------------------------------------

|service| {+serverless-instances+} don't support the following 
:manual:`database commands </reference/command>` and {+mongosh+}
:manual:`shell methods </reference/method>`:

.. list-table::
   :header-rows: 1

   * - Database Command
     - Shell Method

   * - :dbcommand:`addShard`
     - :method:`sh.addShard() <sh.addShard>`

   * - :dbcommand:`addShardToZone`
     - :method:`sh.addShardToZone() <sh.addShardToZone>`

   * - :dbcommand:`applyOps`
     - 

   * - :dbcommand:`balancerCollectionStatus`
     - :method:`sh.balancerCollectionStatus()
       <sh.balancerCollectionStatus>`

   * - :dbcommand:`balancerStart`
     - :method:`sh.startBalancer() <sh.startBalancer>`

   * - :dbcommand:`balancerStatus`
     - 

   * - :dbcommand:`balancerStop`
     - :method:`sh.stopBalancer() <sh.stopBalancer>`

   * - :dbcommand:`clearJumboFlag`
     - 

   * - :dbcommand:`dbHash`
     - 

   * - :dbcommand:`enableSharding`
     - :method:`sh.enableSharding() <sh.enableSharding>`

   * - :dbcommand:`flushRouterConfig`
     - 

   * - | ``geoNear`` 
       | (deprecated in MongoDB v4.0)
     -

   * - :dbcommand:`geoSearch`
     - 

   * - :dbcommand:`getShardMap`
     - 

   * - :dbcommand:`getShardVersion`
     - 

   * - :dbcommand:`listShards`
     - 

   * - :dbcommand:`mergeChunks`
     - 

   * - :dbcommand:`moveChunk`
     - :method:`sh.moveChunk() <sh.moveChunk>`

   * - :dbcommand:`movePrimary`
     - 

   * - :dbcommand:`refineCollectionShardKey`
     - 

   * - :dbcommand:`removeShard`
     - 

   * - :dbcommand:`removeShardFromZone`
     - :method:`sh.removeShardFromZone() <sh.removeShardFromZone>`

   * - :dbcommand:`profile`
     - :method:`db.setProfilingLevel() <db.setProfilingLevel>`

   * - :dbcommand:`shardCollection`
     - :method:`sh.shardCollection() <sh.shardCollection>`

   * - | :dbcommand:`shardConnPoolStats` 
       | (deprecated in MongoDB v4.4)
     - 

   * - :dbcommand:`split`
     - | :method:`sh.splitAt() <sh.splitAt>`
       | :method:`sh.splitFind() <sh.splitFind>`

   * - :dbcommand:`top`
     - 

   * - :dbcommand:`updateZoneKeyRange`
     - :method:`sh.updateZoneKeyRange() <sh.updateZoneKeyRange>`

   * - :dbcommand:`validate`
     - :method:`db.collection.validate() <db.collection.validate>`

.. include:: /includes/fact-limitation-mongorestore.rst
