=====================================================
Install or Upgrade the On-Prem MMS Monitoring: Debian
=====================================================

.. default-domain:: mongodb

Overview
--------

|mms| is a service to monitor and back up a MongoDB infrastructure. This
tutorial describes the basic process to install or upgrade the MMS Application Package.
To install the backup server, see :doc:`Backup Server
</tutorial/install-on-prem-backup-server>`.

At a high level, a basic installation will look like the following.
The estimated setup time is less than an hour.

#. Configure an MMS Application Server that meets the :doc:`hardware
   requirements </core/requirements>`.

#. Install a single MongoDB replica set to be used for the MMS
   application database, as described in
   :doc:`/tutorial/prepare-backing-mongodb-instances`.

#. Install an SMTP email server as appropriate for your environment.

#. Install the MMS Application Package.

#. Configure the MMS server's URL, email addresses, and Mongo URI connection strings.
   See :doc:`/reference/configuration` for more information.

#. Start up the MMS application. See
   :doc:`/tutorial/start-and-stop-application` for more information.

#. Optionally install the backup server, as described in :doc:`Backup
   Server </tutorial/install-on-prem-backup-server>`.

Prerequisites
-------------

Configure an MMS Application Server that meets the :doc:`hardware
requirements </core/requirements>`.

Confirm your environment meets the :doc:`/core/requirements`.

Install and Start MMS Application Database
------------------------------------------

Install a single MongoDB replica set to be used for the MMS application
database, as described in
:doc:`/tutorial/prepare-backing-mongodb-instances`. For additional
information, see the :manual:`MongoDB Installation tutorials
</installation>`.

Install the MMS Application Package
-----------------------------------

1. Download the latest On-Prem Monitoring releases from
   `the downloads page <http://www.mongodb.com/commercialsupport/downloads>`_.

#. Install the DEB by issuing command in the following form:

   .. code-block:: sh

      sudo dpkg --install mongodb-mms_<version>_x86_64.deb

   Replace ``<version>`` with the version of the ``.deb`` you
   obtained. When installed, the base directory for the MMS software is
   ``/opt/mongodb/mms/``. The DEB package will also create a new system
   user ``mongodb-mms`` under which the server will run.

   When complete, |mms| is installed in the ``/opt/mongodb/mms``
   directory.

#. Configure the MMS application, authentication, email, replication, and
   optional Kerberos integration. See the :doc:`/reference/configuration`
   page. To configure your |mms| deployment for high availability, see
   :doc:`/tutorial/configure-application-high-availability`.

Upgrade the MMS Software Package
--------------------------------

If you have an existing On Prem MMS deployment, use the following
procedure to upgrade to the latest release. There are no supported
downgrade paths for On Prem MMS.

Upgrade |mms| from 1.3 and Later
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

#. *Recommended.* Take a full backup of the MMS database before
   beginning the upgrade procedure.

#. Shut down MMS, using the following command:

   .. code-block:: sh

      sudo service mongodb-mms stop

#. If you are running MMS Backup, also shutdown the MMS Backup Daemon. Note, this may be
   installed on a different server. If is *critical* that this is also shut down.

   .. code-block:: sh

      sudo service mongodb-mms-backup-daemon stop

#. Save a copy of your previous configuration file

   .. code-block:: sh

      sudo cp /opt/mongodb/mms/conf/conf-mms.properties ~/.

#. Upgrade the package

   .. code-block:: sh

      sudo dpkg -i mongodb-mms_<version>_x86_64.deb

#. Fill in the new configuration file at /opt/mongodb/mms/conf/conf-mms.properties
   using your old file as a reference point.

#. Start MMS, using the following command:

   .. code-block:: sh

      sudo service mongodb-mms start

#. Update all Monitoring Agents and Backup Agents. See :ref:`upgrade-mms-agent` for
   more information.

#. If you are running MMS Backup, also update the Backup Daemon Package and any Backup Agent. See
   :doc:`/tutorial/install-on-prem-backup-server` and :ref:`tutorial-install-backup-agent` for
   more information.

Upgrade |mms| from 1.2 and Earlier
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Due to the `company name change
<http://www.mongodb.com/press/10gen-announces-company-name-change-mongodb-i
nc>`_, the name of the MMS package changed between versions 1.2 and 1.3.
Therefore, to upgrade the |mms| server from *any* version before 1.3, use
the following procedure:

#. *Recommended.* Take a full backup of the MMS database before
   beginning the upgrade procedure.

#. Shut down MMS, using the following command:

   .. code-block:: sh

      /etc/init.d/10gen-mms stop

#. Download the latest package from
   `the downloads page <http://www.mongodb.com/commercialsupport/downloads>`_
   and proceed with the instructions
   for a fresh install. Do not attempt to use your package manager
   to do an upgrade.

   When complete, |mms| is installed in the ``/opt/mongodb/mms``
   directory.

#. Follow all procedures for a new install include configuring the
   options in ``/opt/mongodb/mms/conf/conf-mms.properties``. If you
   used encrypted authentication credentials you will need to
   regenerate these manually.  *Do not copy the credentials from
   your old properties file. Old credentials will not work.*

#. Start MMS using the new package name:

   .. code-block:: sh

      sudo /etc/init.d/mongodb-mms start

#. Update any Monitoring Agent. See :ref:`upgrade-mms-agent` for
   more information.
