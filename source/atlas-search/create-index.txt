.. _ref-create-index:
.. _default-index-definition:

============================
Create an Atlas Search Index
============================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. include:: /includes/atlas-search-api-note.rst

.. include:: /includes/atlas-search-out-agg.rst

When you create a new |fts| index, choose a configuration method. 

.. figure:: /images/create-fts-index.png
     :alt: Screenshot of Create an Atlas Search Index modal window
     :figwidth: 650px
     :border:

You can use either the default index definition or specify a custom
definition for the index. The default index definition is dynamic 
mapping of fields in the documents and will work with any collection. 
If you wish to create a custom index definition for static mapping, you 
can specify which fields to index with which analyzer and as which data 
type. 

.. include:: /includes/fact-fts-index-field-order.rst

.. include:: /includes/default-fts-index-name.rst

Prerequisites
-------------

To create an |fts| index, you must have an Atlas cluster with:

- MongoDB version ``4.2`` or higher
- At least one collection

.. include:: /includes/fact-fts-required-roles.rst

Procedure
---------

.. include:: /includes/steps/create-fts-index.rst

.. _node-status-ref:

Node Status
-----------

The |fts| Indexes tab in the right-side panel of the |service| UI 
displays information about |fts| indexes for the selected namespace. 
The :guilabel:`Status` column shows the current state of the index
on the primary node of the cluster. Click the :guilabel:`View 
status details` link below the status to view the state of the index 
on all the nodes of the cluster.

.. figure:: /images/fts-index-status.png
     :alt: Screenshot of Atlas Search Index information panel
     :figwidth: 700px

When the :guilabel:`Status` column reads :guilabel:`Active`, the index
is ready to use. In other states, queries against the index may return
incomplete results.

.. list-table::
   :header-rows: 1

   * - Status
     - Description

   * - Not Started 
     - |service| has not yet started building the index.

   * - Initial Sync 
     - |service| is building the index or re-building the 
       index after an edit. In this state, |fts| does not serve queries.

   * - Active
     - Index is ready to use.

   * - Recovering
     - Replication encountered an error. This state commonly occurs 
       when the current replication point is no longer available on the 
       |mongod| oplog. You can still query the existing index until it 
       updates and its status changes to :guilabel:`Active`. Use the 
       error in the :guilabel:`View status details` modal window to 
       troubleshoot the issue. To learn more, see 
       :ref:`atlas-search-alerts`.

   * - Failed 
     - |service| could not build the index. Use the error  
       in the :guilabel:`View status details` modal window to 
       troubleshoot the issue. To learn more, see 
       :ref:`atlas-search-alerts`.

   * - Delete in Progress
     - |service| is deleting the index from the cluster nodes.

While |service| builds the index and after the build completes, the 
:guilabel:`Documents` column shows the percentage and number of 
documents indexed. The column also shows the total number of documents 
in the collection.
