======
Backup
======

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. cond:: onprem

   Logs Display ``MongodVersionException``
   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

   The ``MongodVersionException`` can occur if the
   :ref:`Backup Daemon <backup-daemon>`\'s host cannot access the
   internet to download the version or versions of MongoDB required
   for the backed-up databases. Each database requires a version of
   MongoDB that matches the database's version. Specifically, for each
   instance you must run the latest stable release of that release
   series.

   If the Daemon runs without access to the internet, see
   :doc:`/tutorial/configure-local-mode` to install the appropriate
   binaries.

.. _troubleshoot-insufficient-oplog-size-error:

Insufficient Oplog Size Error
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

When using the |mms| interface to back up a MongoDB cluster, |mms|
checks to see if the cluster's oplogs are, based on their recent
usage, large enough to hold a minimum of 3 hours worth of data based
on the last 24 hours of usage patterns. If the oplogs are not large
enough, it may be possible that the oplogs may have turned over
multiple times, creating a gap between where a backup
ends and an oplog starts.

If the oplog size check fails, the user cannot enable backups and is
shown the warning:

.. warning::

   Insufficient oplog size: The oplog window must be at least 3
   hours over the last 24 hours for all members of replica set
   <name>. Please increase the oplog.

If possible, wait to start a backup until the oplog has had
sufficient time to meet the size requirement.

.. cond:: onprem

   If this is not possible, the minimum oplog size value can be
   changed. See :setting:`mms.backup.minimumOplogWindowHours` for how
   to set this value.

   .. warning::
      Do not change the minimum oplog size unless you are certain
      smaller backups still provide useful backups.

   .. important::

      MongoDB recommends only changing this value temporarily to permit
      a test backup job to execute. The minimum oplog size value should
      be reset to the default as soon as possible. If an oplog is set
      to too small of a value, it can result in a gap between a backup
      job and an oplog which makes the backup unusuable for restores.
      Stale backup jobs must be resynchronized before it can be used
      for restores.

   Understanding the risks given, you can start backups using this
   changed minimum value. Once you pass the 24 hour mark, you should
   reset this minimum value to preserve the sanity check for the global
   Ops Manager installation going forward.

