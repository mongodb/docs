title: "Download the latest version of the Automation Agent archive."
stepnum: 1
ref: download-automation-agent-rpm
pre: |
  On a system shell, issue a ``curl`` command to download the ``rpm``
  for the agent that works on your platform:
action:
  - heading: "For RHEL / CentOS (7.x) and SUSE 12 on x64 architecture:"
    language: sh
    code: |
      curl -OL https://cloud.mongodb.com/download/agent/automation/mongodb-mms-automation-agent-manager-latest.x86_64.rhel7.rpm
  - heading: "For RHEL / CentOS (7.x) on PowerPC architecture (managing MongoDB 3.4 or later deployments only):"
    language: sh
    code: |
      curl -OL https://cloud.mongodb.com/download/agent/automation/mongodb-mms-automation-agent-manager-latest.ppc641e.rhel7.rpm
  - heading: "For RHEL/CentOS (5.X, 6.X), SUSE 11, and Amazon Linux on x64 architecture:"
    language: sh
    code: |
      curl -OL https://cloud.mongodb.com/download/agent/automation/mongodb-mms-automation-agent-manager-latest.x86_64.rpm
edition:
  - cloud
---
title: "Download the latest version of the Automation Agent archive."
stepnum: 1
ref: download-automation-agent-rpm
pre: |
  On a system shell, issue a ``curl`` command to download the ``rpm``
  for the agent that works on your platform:

  .. note::
     Replace ``<OpsManagerHost:Port>`` with the hostname and port
     of your |onprem| installation.

action:
  - heading: "For RHEL / CentOS (7.x) and SUSE 12 on x64 architecture:"
    language: sh
    code: |
      curl -OL https://<OpsManagerHost:Port>/download/agent/automation/mongodb-mms-automation-agent-manager-latest.x86_64.rhel7.rpm
  - heading: "For RHEL / CentOS (7.x) on PowerPC architecture (managing MongoDB 3.4 or later deployments only):"
    language: sh
    code: |
      curl -OL https://<OpsManagerHost:Port>/download/agent/automation/mongodb-mms-automation-agent-manager-latest.ppc641e.rhel7.rpm
  - heading: "For RHEL/CentOS (5.X, 6.X), SUSE 11, and Amazon Linux on x64 architecture:"
    language: sh
    code: |
      curl -OL https://<OpsManagerHost:Port>/download/agent/automation/mongodb-mms-automation-agent-manager-latest.x86_64.rpm
edition:
  - onprem
---
title: "Install the Automation Agent Package"
stepnum: 2
ref: extract
action:
  - heading: "For RHEL / CentOS (7.x) and SUSE 12 on x64 architecture:"
    language: sh
    code: |
      sudo rpm -U mongodb-mms-automation-agent-manager-latest.x86_64.rhel7.rpm
  - heading: "For RHEL / CentOS (7.x) on PowerPC architecture (managing MongoDB 3.4 or later deployments only):"
    language: sh
    code: |
      sudo rpm -U mongodb-mms-automation-agent-manager-latest.ppc641e.rhel7.rpm
  - heading: "For RHEL/CentOS (5.X, 6.X), SUSE 11, and Amazon Linux on x64 architecture:"
    language: sh
    code: |
      sudo rpm -U mongodb-mms-automation-agent-manager-latest.x86_64.rpm
---
title: "Generate an agent API key or retrieve an existing agent API key for your |mms| group." 
stepnum: 3
ref: retrieve-automation-mms-api-key
pre: |
      a. Click :guilabel:`+ Generate Key`.

      .. note::

         The button appears only if the current user is the group owner and
         the group either has no api keys or only the original key.

      b. Enter your password and click :guilabel:`Verify`.
  
      c. Click :guilabel:`+ Generate Key` again.

      .. include:: /includes/extracts/agent-api-key-admonition.rst

      To retrieve an existing API key, go to the :guilabel:`Agent API Keys`
      tab. To navigate to the tab, select :guilabel:`Deployment`  view, then
      click the :guilabel:`Agents` tab and then the :guilabel:`Agent API
      Keys` tab.
---
title: "Edit the ``automation-agent.config`` file."
stepnum: 4
ref: configure-automation-group-api-cloud
action:
  - heading: "Edit the ``automation-agent.config`` file."
    language: sh
    code: |
      sudo vi /etc/mongodb-mms/automation-agent.config
  - heading: "For ``mmsGroupId``, enter your GroupID as the value. For ``mmsApiKey``, enter the group's :term:`agent API key`."
    language: none
    code: |
       mmsGroupId=<Group ID>
       mmsApiKey=<agent API key>
  - heading: "For SUSE 11+ deployments only, configure the ``sslTrustedMMSServerCertificate`` setting."
    language: none
    code: |
       sslTrustedMMSServerCertificate=/etc/ssl/certs/UTN_USERFirst_Hardware_Root_CA.pem
edition:
  - cloud
---

title: "Edit the ``automation-agent.config`` file."
stepnum: 4
ref: configure-automation-group-api-onprem
source:
  file: steps-automation-agent-install-from-archive.yaml
  ref: configure-automation-group-api-onprem
pre: |
   In the directory where you installed the Automation Agent, edit the
   ``automation-agent.config`` file to either:

   .. include:: /includes/extracts/server-pool-agent-config-choice.rst

   For SUSE 11+ deployments only, also configure the
   :asetting:`sslTrustedMMSServerCertificate` setting.
   
   Open the file with an editor.  For example:
   
   .. code-block:: sh

      sudo vi /etc/mongodb-mms/automation-agent.config   

edition:
  - onprem
replacement:
   additionalstep: |
      For SUSE 11+ deployments only, configure the
      ``sslTrustedMMSServerCertificate`` setting. Omit this step for
      other operating systems.
   
      .. code-block:: sh

         sslTrustedMMSServerCertificate=/etc/ssl/certs/UTN_USERFirst_Hardware_Root_CA.pem

---
stepnum: 5
source:
  file: steps-source-install-agent.yaml
  ref: proxy
replacement:
  agentname: "Automation"
  httpProxy: ":asetting:`httpProxy`"
  configfile: "/etc/mongodb-mms/automation-agent.config"
---
title: "Prepare the data directory."
stepnum: 6
ref: prepare-data-dir
# Do NOT use program tag on ``mongod`` user below
pre: |
  The data directory stores MongoDB data and must be owned by the
  ```mongod``` user. For an existing MongoDB deployment, ensure the
  directory has the ``mongod`` user as owner. If no MongoDB
  deployment exists, create the directory and set the owner.
action:
  pre: |
    The following commands create a data directory and set the
    owner as the ``mongod`` user:
  language: sh
  code: |
    sudo mkdir /data 
    sudo chown mongod:mongod /data
---
title: "Start the Automation Agent."
stepnum: 7
ref: start-automation-agent
action:
  pre: |
    Issue the following command:
  language: sh
  code: |
    sudo service mongodb-mms-automation-agent start
...
