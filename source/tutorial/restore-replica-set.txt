===================================
Restore a Replica Set from a Backup
===================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

Overview
--------

When you restore a replica set from backup, |mms| provides you with a
restore file for the selected restore point. For an overview of the
restore process, please see :doc:`/core/restore-overview`.

Considerations
--------------

``BinData``
+++++++++++

.. include:: /includes/considerations-restore-bindata-change.rst

``restoreInfo.txt``
+++++++++++++++++++

The backup restore file includes a metadata file, ``restoreInfo.txt``.
This file captures the options the database used when the snapshot was
taken. The database must be run with the listed options after it has
been restored.

.. include:: /includes/extracts/fact-restoreInfo-file.rst

Prerequisites
-------------

.. include:: /includes/extracts/fact-restore-from-encrypted-backup-prereq.rst

.. include:: /includes/extracts/encrypted-backup-display-kmip-info.rst

Oplog Size
++++++++++

To seed each replica set member, you will use the
:file:`seedSecondary.sh` or :file:`seedSecondary.bat` script included
in the backup restore file. When you run the script, you will provide
the replica set's oplog size, in gigabytes.

.. seealso::
   See the **Check the Size of the Oplog** section of the 
   :manual:`Troubleshoot Replica Sets </tutorial/troubleshoot-replica-sets>` 
   if you do not have the size.

Client Requests During Restoration
++++++++++++++++++++++++++++++++++

.. include:: /includes/considerations-restore-in-isolation.rst

Secure Copy (``SCP``) Delivery
++++++++++++++++++++++++++++++

.. include:: /includes/note-scp-key-pair-requirement.rst

.. include:: /includes/note-windows-scp-issue.rst

Automatic Restore
-----------------

To have |mms| automatically restore the backup, perform the
:ref:`select the snapshot <select-snapshot-replica-set>` procedure.

Manual Restore
--------------

To restore the backup manually, perform the following:

1. :ref:`Select and Retrieve the Snapshot<select-snapshot-replica-set>`.

2. :ref:`Unmanage the Replica Set<unmanage-replset>`.

3. :ref:`Restore the Replica Set Manually<restore-replset-manually>`.

4. :ref:`Reimport the Replica Set<reimport-replset>`.

.. _select-snapshot-replica-set:

Select the Snapshot
+++++++++++++++++++

.. include:: /includes/steps/download-snapshot-replica-set.rst

.. _unmanage-replset:

Unmanage the Replica Set
++++++++++++++++++++++++

Before attempting to restore the data manually, 
:doc:`remove the replica set from Automation </tutorial/unmanage-deployment>`.

.. _restore-replset-manually:

Restore the Replica Set Manually
++++++++++++++++++++++++++++++++

Follow the tutorial from the MongoDB Manual to  
:manual:`restore the replica set </tutorial/restore-replica-set-from-backup>` 

.. _reimport-replset:

Reimport the Replica Set
++++++++++++++++++++++++

To manage the replica set with automation again, 
:doc:`import the replica set </tutorial/add-existing-mongodb-processes>` 
back into |mms|.

