.. _node-angular-integration:

==============================
Integrate MongoDB with Angular
==============================

.. facet::
   :name: genre
   :values: tutorial

.. meta::
   :keywords: web app, mean, code example, full-stack, javascript, typescript
   :description: Build a complete MEAN stack application that uses MongoDB, Express, Angular, and Node.js. Learn how to connect to MongoDB and query sample data.

.. contents:: On this page 
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

Overview
--------

In this guide, you can learn how to create an **Angular** web application
that uses the **MEAN stack**. The MEAN stack is a web development framework
that uses MongoDB, Express, Angular, and Node.js and consists of the following
layers:

- **Database layer**: MongoDB provides data storage and retrieval.
- **Application layer**: Express and Node.js make up the middle tier for server-side logic.
- **Presentation layer**: Angular implements the user interface and front-end interactions.

Why Use MongoDB in an Angular Application?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Angular is a TypeScript framework used to create dynamic web applications.
It provides built-in packages for a range of application features, and its
component-based architecture makes applications highly reusable. 

Since TypeScript is built on JavaScript, each element of the MEAN stack
is based on JavaScript and JSON. As a result, the integration between these
elements is straightforward. The Angular front end creates JSON documents that
MongoDB can store directly in BSON format, a binary JSON extension, and
Express provides a minimalist framework that uses JavaScript. MongoDB
provides advanced indexing and querying features for BSON documents and includes
a native Node.js driver, which makes it an ideal data store for JavaScript
applications.

.. _node-angular-qs-tutorial:

Quick Start Tutorial
--------------------

This tutorial shows you how to build a web application by using the 
MEAN stack. The application accesses sample restaurant data, queries
the data, and displays the results on a locally hosted site. The tutorial
also includes instructions for connecting to a MongoDB cluster hosted
on MongoDB Atlas and accessing and displaying data from your database.

.. tip::

   If you prefer to connect to MongoDB by using the Node.js driver without
   Angular, see the :driver:`Get Started with the Node.js Driver </node/current/get-started/>`
   guide.

.. _node-angular-set-up:

Set Up Your Project
~~~~~~~~~~~~~~~~~~~

Follow the steps in this section to install the project dependencies,
create an Atlas cluster, and set up the application directories.

.. procedure::
   :style: connected

   .. step:: Verify the prerequisites.

      To create the Quick Start application, install the following software in
      your development environment:

      .. list-table::
         :header-rows: 1

         * - Prerequisite
           - Notes

         * - `Node.js <https://nodejs.org/>`__
           - Download either the **Latest LTS** or **Latest Release** version.
  
         * - `Angular CLI <https://angular.io/cli>`__
           - Install globally by running ``npm install -g @angular/cli`` in your terminal.
  
         * - Code editor
           - Use the editor of your choice.
  
         * - Terminal app and shell 
           - For MacOS users, use Terminal or a
             similar app. For Windows users, use PowerShell.          

   .. step:: Create a MongoDB Atlas cluster.
      
      MongoDB Atlas is a fully managed cloud database service that hosts your
      MongoDB deployments. If you do not have a MongoDB deployment, you can create a MongoDB
      cluster for free by completing the
      `MongoDB Get Started <https://www.mongodb.com/docs/get-started/?language=nodejs>`__
      tutorial. The MongoDB Get Started tutorial also demonstrates how to load sample
      datasets into your cluster, including the ``sample_restaurants`` database
      that is used in this tutorial. 

      To connect to your MongoDB cluster, you must use a **connection URI**. To
      learn how to retrieve your connection URI, see the `Add your connection string
      <https://www.mongodb.com/docs/get-started/?language=nodejs#add-your-connection-string>`__
      section of the MongoDB Get Started tutorial.

      .. important::

         Save your connection string in a secure location.

   .. step:: Create your project directories.

      Run the following commands in your terminal to create a directory for 
      your project named ``angular-quickstart``:

      .. code-block:: bash

         mkdir angular-quickstart
         cd angular-quickstart

      Then, run the following commands from the ``angular-quickstart`` directory
      to create a folder for the back end named ``server`` and initialize the
      ``package.json`` file:

      .. code-block:: bash

         mkdir server
         cd server
         npm init -y

   .. step:: Modify your ``package.json`` file.

      Navigate to the ``package.json`` file in the ``angular-quickstart/server``
      directory. To use `ECMAScript modules <https://nodejs.org/api/esm.html#modules-ecmascript-modules>`__,
      the standard format for packaging JavaScript code for reuse, replace the
      existing line that specifies the ``"type"`` field with the following line:

      .. code-block:: bash

         "type": "module",

   .. step:: Install the dependencies.

      Run the following command to install the ``mongodb``, ``express``, ``cors``,
      and ``dotenv`` dependencies:

      .. code-block:: bash

         npm install mongodb express cors dotenv

      This command installs MongoDB, the Express web framework, the
      ``cors`` Node.js package for cross-origin resource sharing, and
      Dotenv to load environment variables.

      Next, run the following command to install TypeScript and the required type definitions:

      .. code-block:: bash

         npm install -D typescript @types/node @types/cors @types/express tsx

      This command installs TypeScript, type definitions for Node.js and Express,
      and ``tsx``, a tool for running TypeScript files directly.

Configure the Back End
~~~~~~~~~~~~~~~~~~~~~~

After setting up the project structure and dependencies, follow
the steps in this section to configure your web server and 
connect to MongoDB.

.. procedure::
   :style: connected

   .. step:: Configure your Express web server.

      Create a file named ``server.ts`` in your ``angular-quickstart/server`` directory
      and paste the following code:

      .. literalinclude:: /includes/node-frameworks/angular/server.ts
         :caption: angular-quickstart/server/server.ts
         :language: typescript

   .. step:: Set environment variables.

      In the ``server`` directory, create an ``.env`` file and paste the
      following code:

      .. code-block:: none

         MONGODB_URI=<connection string>
         PORT=5050

      Replace the ``<connection string>`` placeholder with the connection
      string that you saved in a :ref:`previous step <node-angular-set-up>`.

   .. step:: Connect your server to the database.

      In the ``server`` directory, create a subdirectory named ``db``.
      Add a new file named ``connection.ts`` to this subdirectory and paste
      the following code:

      .. literalinclude:: /includes/node-frameworks/angular/connection.ts
         :caption: angular-quickstart/server/db/connection.ts
         :language: typescript

      This file connects to your MongoDB deployment, accesses the
      ``sample_restaurants`` database, and tests the 
      database connection.

   .. step:: Create server API endpoints.

      In the ``server`` directory, create a subdirectory named ``routes``.
      Create a file named ``restaurant.ts`` in this subdirectory and
      paste the following code:

      .. literalinclude:: /includes/node-frameworks/angular/restaurant-routes.ts
         :caption: angular-quickstart/server/routes/restaurant.ts
         :language: typescript

      This file accesses the ``restaurants`` collection in the 
      ``sample_restaurants`` database and defines the following ``GET``
      endpoints:

      - ``/``: Retrieves all restaurants from the sample collection
      - ``/browse``: Retrieves restaurants that match the query criteria,
        which filters for restaurants in Queens that contain the word ``"Moon"`` in the name

Configure the Front End
~~~~~~~~~~~~~~~~~~~~~~~

After setting up the application's back end, follow the steps in
this section to configure Angular and add the front end components.

.. procedure::
   :style: connected

   .. step:: Create the Angular application.

      Navigate to the ``angular-quickstart`` directory and run the following command
      to create a new Angular application:

      .. code-block:: bash

         ng new client

      This command prompts you to respond to a series of configuration questions.
      For each question, choose the following responses:
      
      - Which stylesheet system would you like to use? Select **Tailwind CSS**
      - Do you want to enable Server-Side Rendering (SSR) and Static Site Generation (SSG/Prerendering)? Enter **N**
      - Which AI tools do you want to configure with Angular best practices? Select the tools of your choice

      After running the command, your project has a ``client`` directory
      that contains front-end scaffolding. The command also configures your
      project to use TailwindCSS, a framework for UI formatting.

   .. step:: Install Zone.js.

      Run the following commands from your project's root directory to install Zone.js:

      .. code-block:: bash

         cd client
         npm install zone.js

      Your application uses the Zone.js library for tracking changes and
      automatically updating the UI.

   .. step:: Create the restaurant service.

      From the ``client`` directory, run the following command to generate
      a service that handles API calls to your back end:

      .. code-block:: bash

         ng generate service restaurant

      Navigate to the ``client/src/app/restaurant.ts`` file and replace
      the contents with the following code:

      .. literalinclude:: /includes/node-frameworks/angular/restaurant.ts
         :caption: angular-quickstart/client/src/app/restaurant.ts
         :language: typescript

      This service defines methods to fetch restaurant data from your Express API.

   .. step:: Configure routing.

      Navigate to the ``client/src/app/app.routes.ts`` file and replace the 
      contents with the following code:

      .. literalinclude:: /includes/node-frameworks/angular/app.routes.ts
         :caption: angular-quickstart/client/src/app/app.routes.ts
         :language: typescript

      This file configures client-side routing and defines
      the following routes:

      - ``/``: Displays all restaurants from the ``/restaurant/`` API endpoint
      - ``/browse``: Displays filtered restaurants from the ``/restaurant/browse`` API endpoint

   .. step:: Update the application configuration.

      Navigate to the ``client/src/app/app.config.ts`` file and replace the 
      contents with the following code:

      .. literalinclude:: /includes/node-frameworks/angular/app.config.ts
         :caption: angular-quickstart/client/src/app/app.config.ts
         :language: typescript

      This configuration enables HTTP client functionality for making API requests.

   .. step:: Create the restaurant list component.

      Run the following command from the ``client`` directory to generate
      a component for displaying restaurants:

      .. code-block:: bash

         ng generate component restaurant-list

      Navigate to the ``client/src/app/restaurant-list/restaurant-list.ts``
      file and replace the contents with the following code:

      .. literalinclude:: /includes/node-frameworks/angular/restaurant-list.ts
         :caption: angular-quickstart/client/src/app/restaurant-list/restaurant-list.ts
         :language: typescript

      Then, navigate to the ``client/src/app/restaurant-list/restaurant-list.html``
      file and replace the contents with the following code:

      .. literalinclude:: /includes/node-frameworks/angular/restaurant-list.html
         :caption: angular-quickstart/client/src/app/restaurant-list/restaurant-list.html
         :language: html

      This component retrieves and displays the restaurant information based
      on the current route.

   .. step:: Update the main application component.

      Navigate to the ``client/src/app/app.ts`` file and replace
      the contents with the following code:

      .. literalinclude:: /includes/node-frameworks/angular/app.ts
         :caption: angular-quickstart/client/src/app/app.ts
         :language: typescript

      Then, navigate to the ``client/src/app/app.html`` file and replace
      the contents with the following code:

      .. literalinclude:: /includes/node-frameworks/angular/app.html
         :caption: angular-quickstart/client/src/app/app.html
         :language: html

      This is the main application component that includes navigation and renders
      the appropriate child components based on the current route.

   .. step:: Update your main file.

      Navigate to the ``client/src/main.ts`` file and replace
      the contents with the following code:

      .. literalinclude:: /includes/node-frameworks/angular/main.ts
         :caption: angular-quickstart/client/src/main.ts
         :language: typescript

      This file acts as the entry point to your application,
      and it applies and renders your configuration.

Run Your Application
~~~~~~~~~~~~~~~~~~~~

Finally, follow the steps in this section to run your application and
view the rendered restaurant data.

.. procedure::
   :style: connected

   .. step:: Run the server application.

      From your ``server`` directory, run
      the following command to start the server:

      .. code-block:: bash

         npx tsx server.ts

      If successful, this command outputs the following information:

      .. code-block:: bash
         :copyable: false

         Pinged your deployment. You successfully connected to MongoDB!
         Server listening on port 5050

   .. step:: Run the client application.

      In a separate terminal window, navigate to the ``client``
      directory. Run the following command to start the Angular front end:

      .. code-block:: bash

         ng serve
    
      If successful, this command outputs the following information:

      .. code-block:: bash
         :copyable: false

         Application bundle generation complete.
         Watch mode enabled. Watching for file changes...
         NOTE: Raw file sizes do not reflect development server per-request transformations.
            ➜  Local:   http://localhost:4200/
            ➜  press h + enter to show help

      Your Angular application makes HTTP requests from port ``4200`` to
      port ``5050`` to retrieve data.

   .. step:: Open the application site.

      Open the http://localhost:4200/ URL. The initial
      landing page displays a list of all restaurants in the ``sample_restaurants.restaurants``
      collection:

      .. figure:: /figures/angular-landing.png
         :alt: The landing page that displays all restaurants

      Then, click the :guilabel:`Filtered Restaurants` link in the navigation bar
      to view the restaurants that match the ``name`` and ``borough`` field query:

      .. figure:: /figures/angular-filtered.png
         :alt: The web page that displays the matching restaurants

Congratulations on completing the Quick Start tutorial!

After you complete these steps, you have an Angular web application that
connects to your MongoDB deployment, runs a query on sample restaurant data,
and renders the results on a locally hosted website.

Additional Resources
--------------------

To learn more about Angular, MongoDB, and the MEAN stack, view the following resources:

- `Angular <https://angular.dev/overview>`__ documentation
- `Express <https://expressjs.com/>`__ documentation
- :driver:`Node.js driver </node/current/>` documentation
- `What is the MEAN stack? <https://www.mongodb.com/resources/languages/mean-stack>`__ article