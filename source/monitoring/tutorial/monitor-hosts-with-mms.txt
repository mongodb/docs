=========================
Monitoring Hosts with MMS
=========================

.. start-content

The MMS agent automatically discovers MongoDB processes based on
existing cluster configuration. You'll have to manually "seed" at
least one of these hosts from the MMS console.

.. index:: adding hosts
   single: hosts; adding

To add a host to MMS, click the "plus" (``+ ADD HOST``) button 
at the top of the Hosts page. This raises a query
element for the hostname, port, and optionally an admin DB username and
password. Provide the necessary information and select "Add."

.. index:: host discovery
   single: hosts; discovery

Once it has a seed host, the agent will discover any other nodes
from associated clusters. These clusters, and their respective seed
hosts, include:

- Master databases, after adding slave databases.

- Shard clusters, after adding ``mongos`` instances.

- Replica sets, after adding any member of the set.

Once you add these seed nodes, the MMS agent will fetch this
information *from* the MMS servers. Thus, when configuring the
monitoring environment, you may need to wait for several update cycles
(e.g. 5-10 minutes) to complete the auto-discovery process and host
identification. During this period, you may see duplicate hosts in the
MMS web console. This is normal.

The agent fetches configuration and reports to MMS every minute, so,
again, there may be a delay of several minutes before data and host
information propagate to the MMS console.

You can find immediate evidence of a working installation in the agent
output or logs. For more information, check the MMS console's "Hosts,"
section in the "Agent Log" and "Pings" tabs. Once MMS has data, you
can view and begin using the statistics.

.. index:: agent timeout
   single: agent; timeout
   single: timeout

If the agent cannot collect information about a host for 24 hours, the
MMS system deactivates the instance in the MMS agent and
console. Deactivated hosts must be manually reactivated from the MMS
console if you wish to collect data from these hosts.

.. end-content

.. _monitoring-architecture:

Monitoring Architecture
~~~~~~~~~~~~~~~~~~~~~~~

Only one agent per group or environment will report to MMS at a time, 
but you can run multiple instances of the agent to provide redundancy. 
Secondary agents act as hot standbys. If you stop the agent process, 
MMS removes the agent from the “Agents” tab within a day. If an agent 
is offline the last ping times for that agent do not update. To install 
a second or third agent, simply repeat the installation process in the
:doc:`installation guide </monitoring/install>` for each new agent. You
can also :ref:`automate agent installation <automated-agent-installation>`.

   ..note:: When the MMS agent restarts, there is a five minute delay 
   before that agent will begin collecting data and sending pings to MMS.
   If you have multiple agents, this delay permits other agents in your 
   infrastructure to become the "primary agent" and for MMS to determine
   which agent will be primary.
   
   During this interval, the restarted MMS agent will not collect data.


