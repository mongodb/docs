.. _k8s-om-specification:

==================================
Ops Manager Resource Specification
==================================

.. include:: /includes/styles/corrections.rst

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecols

.. include:: /includes/admonitions/om-resource-alpha.rst

The :gh:`MongoDB Enterprise Kubernetes Operator </mongodb/mongodb-enterprise-kubernetes>`
creates a containerized |onprem| deployment from specification files
that you write.

After you create or update an |onprem| resource specification, you
direct |k8s-op-full| to apply this specification to your |k8s|
environment. |k8s-op-short| creates the services and custom |k8s|
resources that |onprem| requires, then deploys |onprem| and its backing
application database in containers in your |k8s| environment.

Each |onprem| resource uses an |k8s-obj| specification in |yaml| to
define the characteristics and settings of the deployment.

Example
-------

The following example shows a resource specification for an |onprem|
deployment:

.. literalinclude:: /reference/k8s/example-ops-manager.yaml
   :language: yaml
   :linenos:

Required |onprem| Resource Settings
-----------------------------------

This section describes settings that you must use for all |onprem|
resources.

.. opsmgrkube:: apiVersion

   *Type*: string

   *Required*. Version of the MongoDB |k8s| resource schema.

.. opsmgrkube:: kind

   *Type*: string

   *Required*. Kind of MongoDB Kubernetes resource to create. Set this
   to ``MongoDBOpsManager``.

.. opsmgrkube:: metadata.name

   *Type*: string

   *Required*. Name of the MongoDB |k8s| resource you are creating.

   .. include:: /includes/fact-resource-name-char-limit.rst

.. opsmgrkube:: spec.replicas

   *Type*: number

   *Required*. Number of |onprem| instances to run in parallel.

   The minimum accepted value is ``1``.

   .. include:: /includes/admonitions/note-highly-available-om.rst

.. opsmgrkube:: spec.version

   *Type*: number

   *Required*. Version of |onprem| that you want to install
   on this MongoDB |k8s| resource.

.. opsmgrkube:: spec.adminCredentials

   *Type*: string

   *Required*. Name of the |k8s| |k8s-secret| you created for
   the |onprem| admin user. When you deploy the |onprem| resource,
   |k8s-op-short| creates a user with these credentials.

   The admin user is granted the
   :opsmgr:`Global Owner </reference/user-roles/#global-automation-admin-role>`
   role.

.. opsmgrkube:: spec.applicationDatabase.members

   *Type*: integer

   *Required*. Number of members in the :opsmgr:`Application Database
   </core/system-overview/#application-database>` replica set.

.. _optional-om-k8s-settings:

Optional |onprem| Resource Settings
-----------------------------------

|onprem| resources can use the following settings:

.. opsmgrkube:: spec.applicationDatabase

   *Type*: collection

   |onprem| :opsmgr:`Application Database </core/system-overview/#application-database>`
   resource definition.

   The following settings from the
   :ref:`replica set <replica-set-settings>` resource specification are
   optional:

   - ``spec.applicationDatabase.``:setting:`~spec.persistent`
   - ``spec.applicationDatabase.``:setting:`~spec.logLevel`
   - ``spec.applicationDatabase.``:setting:`~spec.featureCompatibilityVersion`
   - ``spec.applicationDatabase.podSpec.``:setting:`~spec.podSpec.cpu`
   - ``spec.applicationDatabase.podSpec.``:setting:`~spec.podSpec.cpuRequests`
   - ``spec.applicationDatabase.podSpec.``:setting:`~spec.podSpec.memory`
   - ``spec.applicationDatabase.podSpec.``:setting:`~spec.podSpec.memoryRequests`
   - ``spec.applicationDatabase.podSpec.``:setting:`~spec.podSpec.persistence.single`
   - ``spec.applicationDatabase.podSpec.persistence.multiple.``:setting:`~spec.podSpec.persistence.multiple.data`
   - ``spec.applicationDatabase.podSpec.persistence.multiple.``:setting:`~spec.podSpec.persistence.multiple.journal`
   - ``spec.applicationDatabase.podSpec.persistence.multiple.``:setting:`~spec.podSpec.persistence.multiple.logs`
   - ``spec.applicationDatabase.podSpec.``:setting:`~spec.podSpec.podAffinity`
   - ``spec.applicationDatabase.podSpec.``:setting:`~spec.podSpec.podAntiAffinityTopologyKey`
   - ``spec.applicationDatabase.podSpec.``:setting:`~spec.podSpec.nodeAffinity`
   - :opsmgrkube:`spec.applicationDatabase.version`

.. opsmgrkube:: spec.applicationDatabase.passwordSecretKeyRef.name

   *Type*: string

   Name of the :ref:`secret <om-db-user-secret>` that contains the
   password for the |onprem| database user ``mongodb-ops-manager``.
   |onprem| uses this password to :ref:`authenticate to the Application
   Database <app-db-auth>`.

.. opsmgrkube:: spec.applicationDatabase.passwordSecretKeyRef.key

   *Type*: string

   Name of the field in the :ref:`secret <om-db-user-secret>` that
   contains the password for the |onprem| database user
   ``mongodb-ops-manager``. |onprem| uses this password to
   :ref:`authenticate to the Application Database <app-db-auth>`.

   The default value is ``password``.

.. opsmgrkube:: spec.applicationDatabase.version

   *Type*: number

   Version of MongoDB that is installed on the |onprem|
   :opsmgr:`Application Database </core/system-overview/#application-database>`.

   Default value is {+bndl-version-val+}.

   .. include:: /includes/admonitions/note-deploy-om-offline.rst

   .. note::

      If you update this value to a later version, consider setting
      :setting:`spec.featureCompatibilityVersion` to give yourself the
      option to downgrade if necessary.

.. opsmgrkube:: spec.backup.enabled

   *Type*: boolean

   Flag that enables Backup for your |onprem| resource. When set to
   ``false``, Backup is disabled.

   Default value is ``true``.

.. opsmgrkube:: spec.backup.headDB

   *Type*: collection

   Configuration settings for the :ref:`head database <backup-daemon>`.
   |k8s-op-short| creates a |k8s-pvc| with the specified configuration.

   .. list-table::
      :widths: 20 20 60
      :header-rows: 1

      * - Scalar
        - Data Type
        - Description

      * - ``labelSelector``
        - string
        - `Tag
          <https://kubernetes.io/docs/concepts/storage/persistent-volumes/#selector>`__
          used to bind mounted volumes to directories.

      * - ``storage``
        - string
        - Minimum size of |k8s-pv| that should be mounted. This value is
          expressed as an integer followed by a unit of storage in
          |jedec| notation.

          Default value is ``30G``.

          .. seealso::

             :ref:`backup-hardware-requirements`

          .. example::

             If the head database requires 60 gigabytes of storage
             space, set this value to ``60G``.

      * - ``storageClass``
        - string
        - Type of storage specified in a |k8s-pvc|. You may create
          this storage type as a |k8s-sc| object before using it in this
          |k8s-obj| specification.

          .. note::

             .. include:: /includes/admonitions/fact-reclaimpolicy-to-retain.rst

.. opsmgrkube:: spec.backup.jvmParameters

   *Type*: array of strings

   *Optional*. |jvm| parameters passed to the |onprem| backup service
   in the container.

   This |k8s-op-short| parameter defaults to an empty list.

   .. code-block:: yaml

      spec:
        backup:
          jvmParameters: ["-XX:+UseStringCache"]

   .. admonition:: Change the JVM Memory Heap values at your own risk
      :class: warning

      |k8s-op-short| calculates the |jvm| memory heap values of the
      backup service based on the container's memory. Changing the
      ``-Xms`` and ``-Xmx`` values can cause issues with |onprem|.

.. opsmgrkube:: spec.backup.opLogStores

   *Type*: collection

   *Required if you enable Backup.*

   Array of :ref:`oplog stores <backup-database-specifications>` used
   for Backup. Each item in the array references a MongoDB database
   resource deployed in the |k8s| cluster by the |k8s-op-short|.

.. opsmgrkube:: spec.backup.opLogStores.name

   *Type*: string

   *Required if you enable Backup.*

   Name of the oplog store.

   .. important::

      Once specified, do not edit the name of the oplog store.

.. opsmgrkube:: spec.backup.opLogStores.mongodbResourceRef.name

   *Type*: string

   *Required if you enable Backup.*

   Name of the MongoDB database resource that you create to store oplog
   slices. You must deploy this database resource in the same namespace
   as the |onprem| resource.

   .. include:: /includes/admonitions/fact-backing-db-auth.rst

   If a MongoDB database resource with this name doesn't exist, the
   |onprem| resource enters a ``Pending`` state. The |k8s-op-short|
   retries every 10 seconds until a MongoDB database resource with this
   name is created.

.. opsmgrkube:: spec.backup.opLogStores.mongodbUserRef.name

   *Type*: string

   *Required if ``SCRAM`` authentication is enabled on the oplog
   store database.*

   Name of the MongoDB user resource used to connect to the oplog store
   database. Deploy this user resource in the same
   namespace as the |onprem| resource and with the
   :manual:`readWriteAnyDatabase
   </reference/built-in-roles/#readWriteAnyDatabase>` and
   :manual:`dbAdminAnyDatabase
   </reference/built-in-roles/#dbAdminAnyDatabase>` roles.

.. opsmgrkube:: spec.backup.podSpec.cpu

   *Type*: string

   Maximum CPU capacity that must be available on a |k8s|
   |k8s-node| to host the :ref:`backup-daemon`.

   This value maps to the
   :k8sdocs:`limits field </reference/generated/kubernetes-api/v1.10/#resourcerequirements-v1-core>`
   for CPU for the created pod.

.. opsmgrkube:: spec.backup.podSpec.cpuRequests

   *Type*: string

   Minimum CPU capacity for the |k8s-node| being created to host
   the :ref:`backup-daemon`. If omitted, this value is set to
   :opsmgrkube:`spec.backup.podSpec.cpu`.

   This value maps to the
   :k8sdocs:`requests field </reference/generated/kubernetes-api/v1.11/#resourcerequirements-v1-core>`
   for CPU for the created pod.

   The requested value must be less than or equal to
   :opsmgrkube:`spec.backup.podSpec.cpu`.

.. opsmgrkube:: spec.backup.podSpec.memory

   *Type*: string

   Maximum memory capacity that must be available on a |k8s| |k8s-node|
   to host the :ref:`backup-daemon` on |k8s|. This value is expressed as
   an integer followed by a unit of memory in |jedec| notation.

   This value maps to the
   :k8sdocs:`limits field </reference/generated/kubernetes-api/v1.10/#resourcerequirements-v1-core>`
   for memory for the created pod.

   The |k8s-op-short| calculates and sets parameters for Java heap size
   based on the container's memory.

   .. admonition:: Limit this value to less than 32 GB
      :class: warning

      Setting this value to a value greater than 32 GB (``32G``) can
      cause issues with the backup service. Excessive heaps can cause
      unpredictable results in |onprem|.

.. opsmgrkube:: spec.backup.podSpec.memoryRequests

   *Type*: string

   Minimum memory capacity for the |k8s-node| being created to host
   the :ref:`backup-daemon`. If omitted, this value is set to
   :opsmgrkube:`spec.backup.podSpec.memory`.

   This value maps to the
   :k8sdocs:`requests field </reference/generated/kubernetes-api/v1.10/#resourcerequirements-v1-core>`
   for memory for the created pod.

   The requested value must be less than or equal to
   :opsmgrkube:`spec.backup.podSpec.memory`.

   .. note::

      Set this value to at least ``4.5G``. Values of less than ``4.5G``
      might result in an error.

.. opsmgrkube:: spec.backup.podSpec.nodeAffinity

   *Type*: collection

   |k8s| |k8s-rule| to place the :ref:`backup-daemon` |k8s-pods| on a
   specific range of |k8s-nodes|.

   .. example::

      A user can isolate "dev" and "testing" environments to ensure
      |k8s-pods| go to |k8s-nodes| with appropriate labels.

.. opsmgrkube:: spec.backup.podSpec.podAffinity

   *Type*: collection

   |k8s| |k8s-rule| to determine if multiple
   :ref:`backup-daemon` |k8s-pods| must be co-located with other |k8s-pods|.

   .. seealso::

      The |k8s| documentation for use cases on
      `affinity and anti-affinity <https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#more-practical-use-cases>`__

.. opsmgrkube:: spec.backup.podSpec.podTemplate

   *Type*: collection

   :k8sdocs:`Template </concepts/workloads/pods/pod-overview/#pod-templates>`
   for the |k8s| pods that the |k8s-op| creates for the the
   :ref:`backup-daemon`.

   Template values take precedence over values specified in
   ``spec.backup.podSpec``.

   .. note::

      The |k8s-op-short| doesn't validate the fields you provide
      in :opsmgrkube:`spec.backup.podSpec.podTemplate`.

.. opsmgrkube:: spec.backup.podSpec.podTemplate.metadata

   *Type*: collection

   Metadata for the |k8s| pods that the |k8s-op| creates for the
   :ref:`backup-daemon`.

   To review which fields you can add to
   :opsmgrkube:`spec.backup.podSpec.podTemplate.metadata`, see
   the :k8sdocs:`Kubernetes documentation
   </reference/generated/kubernetes-api/v1.11/#objectmeta-v1-meta>`.

.. opsmgrkube:: spec.backup.podSpec.podTemplate.spec

   *Type*: collection

   Specifications of the |k8s| pods that the |k8s-op| creates for
   the :ref:`backup-daemon`.

   To review which fields you can add to
   :opsmgrkube:`spec.backup.podSpec.podTemplate.spec`, see the
   :k8sdocs:`Kubernetes documentation
   </reference/generated/kubernetes-api/v1.11/#podspec-v1-core>`.

   .. note::

      When you add containers to
      ``spec.backup.podSpec.podTemplate.spec.containers``,
      the |k8s-op-short| adds them to the |k8s| pod. These containers are
      appended to the :ref:`backup-daemon` containers in the pod.

.. opsmgrkube:: spec.backup.s3Stores.name

   *Type*: string

   *Required if you enable Backup.*

   Name of the |s3| snapshot store.

   .. important::

      Once specified, do not edit the name of the |s3| snapshot store.

.. opsmgrkube:: spec.backup.s3Stores.mongodbResourceRef.name

   *Type*: string

   *Required if you enable Backup.*

   Name of the MongoDB database resource that you create to store
   metadata for the |s3| snapshot store. You must deploy this database
   resource in the same namespace as the |onprem| resource.

   If you enable ``SCRAM`` authentication on this database, you must:

   - Specify a MongoDB version earlier than v4.0 in the database
     resource definition.
   - Create a MongoDB user resource to connect |onprem| to the
     database.
   - Specify the
     :opsmgrkube:`~spec.backup.s3Stores.mongodbUserRef.name` of the
     user in the |onprem| resource definition.

.. opsmgrkube:: spec.backup.s3Stores.mongodbUserRef.name

   *Type*: string

   *Required if SCRAM authentication is enabled on the metadata
   database of the S3 snapshot store.*

   Name of the MongoDB user resource used to connect to the metadata
   database of the |s3| snapshot store. Deploy this user resource in the
   same namespace as the |onprem| resource and with the
   :manual:`readWriteAnyDatabase
   </reference/built-in-roles/#readWriteAnyDatabase>` and
   :manual:`dbAdminAnyDatabase
   </reference/built-in-roles/#dbAdminAnyDatabase>` roles.

.. opsmgrkube:: spec.backup.s3Stores.s3SecretRef.name

   *Type*: string

   *Required if you enable Backup.*

   Name of the secret that contains the ``accessKey`` and
   ``secretKey`` fields. The :ref:`backup-daemon` uses the values
   of these fields as credentials to access your
   |aws| |s3| or |s3|-compatible bucket. The |s3|
   snapshot store can't be configured if the secret is missimg either
   key.

.. opsmgrkube:: spec.backup.s3Stores.pathStyleAccessEnabled

   *Type*: boolean

   Indicates the style of the bucket endpoint URL.

   .. list-table::
      :widths: 30 30 30
      :header-rows: 1

      * - Value
        - Description
        - Example

      * - ``true``
        - Path-style URL
        - ``s3.amazonaws.com/<bucket>``

      * - ``false``
        - Virtual-host-style URL
        - ``<bucket>.s3.amazonaws.com``

   Default value is ``true``.

.. opsmgrkube:: spec.backup.s3Stores.s3BucketEndpoint

   *Type*: string

   *Required if you enable Backup.*

   URL of the |aws| |s3| bucket or |s3|-compatible bucket that hosts the
   snapshot store.

.. opsmgrkube:: spec.backup.s3Stores.s3BucketName

   *Type*: string

   *Required if you enable Backup.*

   Name of the |aws| |s3| bucket or |s3|-compatible bucket that hosts
   the snapshot store.

.. opsmgrkube:: spec.clusterDomain

   *Type*: string

   |k8s| assigns each |k8s-pod| a |fqdn|. The |k8s-op-short| calculates
   the |fqdn| for each |k8s-pod| using a provided ``clusterDomain``.
   |k8s| does not provide an |api| to query these hostnames.

.. opsmgrkube:: spec.clusterName

   .. admonition:: ``spec.clusterName`` is Deprecated
      :class: important

      Use :setting:`spec.clusterDomain` instead.

   *Type*: string

   |k8s| assigns each |k8s-pod| a |fqdn|. The |k8s-op-short| calculates
   the |fqdn| for each |k8s-pod| using a provided ``clusterName``. |k8s|
   does not provide an |api| to query these hostnames.

.. opsmgrkube:: spec.configuration

   *Type*: collection

   |onprem| configuration properties.
   See :opsmgr:`Ops Manager Configuration Settings
   </reference/configuration/>` for property names and descriptions.
   Each property takes a value of type ``string``.

   .. include:: /includes/admonitions/mms-centralurl-external-mdb.rst

.. opsmgrkube:: spec.externalConnectivity

   *Type*: collection

   Configuration object that enables external connectivity to |onprem|.
   If provided, the |k8s-op-short| creates a |k8s| :k8sdocs:`service
   </concepts/services-networking/service/>` that allows traffic
   originating from outside of the |k8s| cluster to reach the |onprem|
   application.

   If not provided, the |k8s-op-short| does not create a |k8s| service.
   You must create one manually or use a third-party solution that
   enables you to route external traffic to the |application| in your
   |k8s| cluster.

.. opsmgrkube:: spec.externalConnectivity.type

   *Type*: string

   The |k8s| service :k8sdocs:`ServiceType
   </concepts/services-networking/service/#publishing-services-service-types>`
   that exposes |onprem| outside of |k8s|.

   *Required* if :opsmgrkube:`spec.externalConnectivity.type` is
   present.

   Accepted values are: ``LoadBalancer`` and ``NodePort``.
   ``LoadBalancer`` is recommended if your cloud provider supports it.
   Use ``NodePort`` for local deployments.

.. opsmgrkube:: spec.externalConnectivity.port

   *Type*: integer

   If :opsmgrkube:`spec.externalConnectivity.type` is ``NodePort``, the
   port on the |k8s| service from which external traffic is routed to
   the |application|.

   .. note::

      You must configure your network's firewall to allow traffic over
      this port.

   If :opsmgrkube:`spec.externalConnectivity.type` is ``LoadBalancer``,
   the load balancer resource that your cloud provider creates routes
   traffic to this port on the |k8s| service. You don't need to provide
   this value. |k8s| uses an open port within the default range and
   handles internal traffic routing appropriately.

   In both cases, if this value is not provided, the |k8s| service
   routes traffic from an available port within the following default
   range to the |application|: ``30000``-``32767``.

.. opsmgrkube:: spec.externalConnectivity.loadBalancerIP

   *Type*: string

   The IP address the ``LoadBalancer`` |k8s| service uses when the
   |k8s-op-short| creates it.

   This setting can only be used if your cloud provider supports it and
   :opsmgrkube:`spec.externalConnectivity.type` is ``LoadBalancer``. To
   learn more about the
   :k8sdocs:`Type LoadBalancer
   </concepts/services-networking/service/#loadbalancer>`, see the
   |k8s| documentation.

.. opsmgrkube:: spec.externalConnectivity.externalTrafficPolicy

   *Type*: string

   Routing policy for external traffic to the |onprem| |k8s| service.
   The service routes external traffic to node-local or cluster-wide
   endpoints depending the value of this setting.

   Accepted values are: ``Cluster`` and ``Local``. To learn which of
   values meet your requirements, see :k8sdocs:`Source IPs in Kubernetes
   </tutorials/services/source-ip/>` in the |k8s| documentation.

   .. note::
      If you select ``Cluster``, the ``Source-IP`` of your clients are
      lost during the network hops that happen at the |k8s|
      network boundary.

.. opsmgrkube:: spec.externalConnectivity.annotations

   *Type*: collection

   Key-value pairs that allow you to provide cloud provider-specific
   configuration settings.

   To learn more about
   :k8sdocs:`Annotations </concepts/overview/working-with-objects/annotations/>`
   and
   :k8sdocs:`TLS support on AWS </concepts/services-networking/service/#ssl-support-on-aws>`,
   see the |k8s| documentation.

.. opsmgrkube:: spec.jvmParameters

   *Type*: array of strings

   *Optional*. |jvm| parameters passed to the |application| in the
   container. Any parameters given replace the default |jvm| parameters
   for the |application|.

   This |k8s-op-short| parameter defaults to an empty list.

   .. code-block:: yaml

      spec:
        jvmParameters: ["-XX:+HeapDumpOnOutOfMemoryError","-XX:HeapDumpPath=/tmp"]

   .. admonition:: Change the JVM Memory Heap values at your own risk
      :class: warning

      |k8s-op-short| calculates its |jvm| memory heap values of the
      |application| based on the container's memory. Changing the
      ``-Xms`` and ``-Xmx`` values can cause issues with |onprem|.

.. opsmgrkube:: spec.podSpec.cpu

   *Type*: string

   Maximum CPU capacity that must be available on a |k8s|
   |k8s-node| to host |onprem| on |k8s|.

   This value maps to the
   :k8sdocs:`limits field </reference/generated/kubernetes-api/v1.10/#resourcerequirements-v1-core>`
   for CPU for the created pod.

.. opsmgrkube:: spec.podSpec.cpuRequests

   *Type*: string

   Minimum CPU capacity for the |k8s-node| being created to host
   |onprem| on |k8s|. If omitted, this value is set to
   :opsmgrkube:`spec.podSpec.cpu`.

   This value maps to the
   :k8sdocs:`requests field </reference/generated/kubernetes-api/v1.11/#resourcerequirements-v1-core>`
   for CPU for the created pod.

   The requested value must be less than or equal to
   :opsmgrkube:`spec.podSpec.cpu`.

.. opsmgrkube:: spec.podSpec.memory

   *Type*: string

   Maximum memory capacity that must be available on a
   |k8s| |k8s-node| to host |onprem| on |k8s|. This value is
   expressed as an integer followed by a unit of memory in
   |jedec| notation.

   .. example::

      If |onprem| on |k8s| requires 6 gigabytes of memory, set
      this value to ``6G``.

   This value maps to the
   :k8sdocs:`limits field </reference/generated/kubernetes-api/v1.10/#resourcerequirements-v1-core>`
   for memory for the created pod.

   The |k8s-op-short| calculates and sets parameters for Java heap size
   based on the container's memory.

   .. admonition:: Limit this value to less than 32 GB
      :class: warning

      Setting this value to a value greater than 32 GB (``32G``) can
      cause issues with the |application|. Excessive heaps can cause
      unpredictable results in |onprem|.

.. opsmgrkube:: spec.podSpec.memoryRequests

   *Type*: string

   Minimum memory capacity for the |k8s-node| being created to host
   |onprem| on |k8s|. If omitted, this value is set to
   :opsmgrkube:`spec.podSpec.memory`.

   This value maps to the
   :k8sdocs:`requests field </reference/generated/kubernetes-api/v1.10/#resourcerequirements-v1-core>`
   for memory for the created pod.

   The requested value must be less than or equal to
   :opsmgrkube:`spec.podSpec.memory`.

   .. note::

      MongoDB recommends setting this value to at least ``5G``.

.. opsmgrkube:: spec.podSpec.podAntiAffinityTopologyKey

   *Type*: string

   Sets a |k8s-rule| to spread |onprem| |k8s-pods|
   to different locations. A location can be a single node, rack, or
   region. This key defines which node
   `label <https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/>`__
   is used to `determine equal location <https://kubernetes.io/docs/concepts/configuration/assign-pod-node/>`__
   for nodes. By default, |k8s-op-short| tries to spread pods across
   different hosts.

.. opsmgrkube:: spec.podSpec.nodeAffinity

   *Type*: collection

   |k8s| |k8s-rule| to place |onprem| |k8s-pods| on a
   specific range of |k8s-nodes|.

   .. example::

      A user can isolate "dev" and "testing" environments to ensure
      |k8s-pods| go to |k8s-nodes| with appropriate labels.

.. opsmgrkube:: spec.podSpec.podAffinity

   *Type*: collection

   |k8s| |k8s-rule| to determine if multiple
   |onprem| |k8s-pods| must be co-located with other |k8s-pods|.

   .. seealso::

      The |k8s| documentation for use cases on
      `affinity and anti-affinity <https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#more-practical-use-cases>`__

.. opsmgrkube:: spec.podSpec.podTemplate

   *Type*: collection

   :k8sdocs:`Template </concepts/workloads/pods/pod-overview/#pod-templates>`
   for the |k8s| pods that the |k8s-op| creates for |onprem| on |k8s|.

   Template values take precedence over values specified in
   ``spec.podSpec``.

   .. note::

      The |k8s-op-short| doesn't validate the fields you provide
      in :opsmgrkube:`spec.podSpec.podTemplate`.

.. opsmgrkube:: spec.podSpec.podTemplate.metadata

   *Type*: collection

   Metadata for the |k8s| pods that the |k8s-op| creates for |onprem| on
   |k8s|.

   To review which fields you can add to
   :opsmgrkube:`spec.podSpec.podTemplate.metadata`, see the
   :k8sdocs:`Kubernetes documentation
   </reference/generated/kubernetes-api/v1.11/#objectmeta-v1-meta>`.

.. opsmgrkube:: spec.podSpec.podTemplate.spec

   *Type*: collection

   Specifications of the |k8s| pods that the |k8s-op| creates for
   |onprem| on |k8s|.

   To review which fields you can add to
   :opsmgrkube:`spec.podSpec.podTemplate.spec`, see the
   :k8sdocs:`Kubernetes documentation
   </reference/generated/kubernetes-api/v1.11/#podspec-v1-core>`.

   .. note::

      When you add containers to
      ``spec.podSpec.podTemplate.spec.containers``,
      the |k8s-op-short| adds them to the |k8s| pod. These containers are
      appended to the |onprem| containers in the pod.

