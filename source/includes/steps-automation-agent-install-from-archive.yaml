title: Download the latest version of the Automation Agent archive.
stepnum: 1
ref: download-automation-agent-archive
pre: |
  On a system shell, issue a ``curl`` command to download the archive
  for the agent that works on your platform:
action:
  - heading: "For RHEL / CentOS (7.x) and SUSE 12 on x64 architecture:"
    language: sh
    code: |
      curl -OL https://cloud.mongodb.com/download/agent/automation/mongodb-mms-automation-agent-latest.rhel7_x86_64.tar.gz
  - heading: "For RHEL / CentOS (7.x) on PowerPC architecture:"
    language: sh
    code: |
      curl -OL https://cloud.mongodb.com/download/agent/automation/mongodb-mms-automation-agent-latest.rhel7_ppc641e.tar.gz
  - heading: "For all other Linux distributions:"
    language: sh
    code: |
      curl -OL https://cloud.mongodb.com/download/agent/automation/mongodb-mms-automation-agent-latest.linux_x86_64.tar.gz
edition:
  - cloud
---
title: Download the latest version of the Automation Agent archive.
stepnum: 1
ref: download-automation-agent-archive
pre: |
  On a system shell, issue a ``curl`` command to download the archive
  for the agent that works on your platform:

  .. note::
     Replace ``<OpsManagerCentralURL>`` with the URL of your |onprem|
     installation.

action:
  - heading: "For RHEL / CentOS (7.x) and SUSE 12 on x64 architecture:"
    language: sh
    code: |
      curl -OL https://<OpsManagerCentralURL>/download/agent/automation/mongodb-mms-automation-agent-latest.rhel7_x86_64.tar.gz
  - heading: "For RHEL / CentOS (7.x) on PowerPC architecture:"
    language: sh
    code: |
      curl -OL https://<OpsManagerCentralURL>/download/agent/automation/mongodb-mms-automation-agent-latest.rhel7_ppc641e.tar.gz
  - heading: "For all other Linux distributions:"
    language: sh
    code: |
      curl -OL https://<OpsManagerCentralURL>/download/agent/automation/mongodb-mms-automation-agent-latest.linux_x86_64.tar.gz
edition:
  - onprem
---
title: "Install the Automation Agent."
stepnum: 2
ref: extract
pre: |
  To install the agent that works on your platform, issue the
  appropriate command to extract the archive:
action:
  language: sh
  code: |
    tar -xf mongodb-mms-automation-agent-latest.*.tar.gz
post: |
  The Automation Agent is installed.
---
title: "Edit the ``local.config`` file to include your Group ID and agent API key."
stepnum: 3
ref: configure-automation-group-api-cloud
pre: |
  In the directory where you installed the Automation Agent, edit the
  ``local.config`` file.

  - For ``mmsGroupId``, enter your GroupID as the value. 
  - For ``mmsApiKey``, enter the group's :term:`agent API key`.
action:
  language: none
  code: |
    mmsGroupId=<Group ID>
    mmsApiKey=<agent API key>
edition:
  - cloud
---
title: "Edit the ``local.config`` file."
stepnum: 3
ref: configure-automation-group-api-onprem
pre: |
   In the directory where you installed the Automation Agent, edit the
   ``local.config`` file to either:

   .. include:: /includes/extracts/server-pool-agent-config-choice.rst

action:
   - heading: Configure for a Specific Group
     pre: |
        Update the following configuration keys:

        - For ``mmsGroupId``, set to your GroupID. 
        - For ``mmsApiKey``, set to the group's :term:`agent API key`.
        - For ``mmsBaseUrl``, set to the URL of the |application|. Include the port number.

     language: none
     code: |
       mmsGroupId=<Group ID>
       mmsApiKey=<agent API key>
       mmsBaseUrl=<application URL>
     post: |
       Do not configure the server pool settings:
       :asetting:`serverPoolKey`, :asetting:`serverPoolPropertiesFile`,
       :asetting:`serverPoolStateFile`.

       {{additionalstep}}

   - heading: Configure for a Server Pool
     pre: |
        Update the following configuration keys:

        - For  :asetting:`serverPoolKey`, set to the Server Pool Key.

          .. include:: /includes/extracts/server-pool-key-location.rst

        - For :asetting:`serverPoolPropertiesFile`, set to the full
          filepath of a file that contains server properties. Ensure
          the Automation Agent can read the file.

          .. include:: /includes/extracts/server-pool-properties-file-content-description.rst

          .. include:: /includes/extracts/server-pool-properties-file-note.rst

        - For :asetting:`serverPoolStateFile`, set to the full
          filepath of the file to be used by the Automation Agent.

          .. include:: /includes/extracts/server-pool-state-file-permission.rst
     language: none
     code: |
       serverPoolKey=somekeyabc123
       serverPoolPropertiesFile=<path to server properties file>
       serverPoolStateFile=<path to server state file>
     post: |
        Do not configure the group settings:
        :asetting:`mmsGroupId`, :asetting:`mmsApiKey`, and
        :asetting:`mmsBaseUrl`.

        {{additionalstep}}

edition:
  - onprem
replacement:
   additionalstep: ""
---
stepnum: 4
source:
  file: steps-source-install-agent.yaml
  ref: proxy
replacement:
  agentname: "Automation"
  httpProxy: ":asetting:`httpProxy`"
  configfile: "<install-directory>/local.config"
---
title: "Create the automation and data directories."
stepnum: 5
ref: create-automation-directory
action:
  pre: |
    Create the directories for the automation agent binaries and logs and MongoDB databases. 

    The system user that runs the Automation Agent should own these directories.

    By default, you should create the following directories: 

  language: sh
  code: |
     sudo mkdir -m 755 -p /var/lib/mongodb-mms-automation
     sudo mkdir -m 755 -p /var/log/mongodb-mms-automation
     sudo mkdir -m 755 -p /data

  post: |

    .. topic:: Using a Different Path for the Automation Agent Binaries

       If you do not want to use the ``/var/lib/`` path to store your Automation
       Agent binaries, you can change the default locations for these files in
       the |mms| application.

       a. Click :guilabel:`Settings`, then :guilabel:`Agents`.

       b. Click the pencil icon to the right of the directory path shown in the
          :guilabel:`Download Directory (Linux/MacOS)` listing.

       c. Change the directory path to your preferred path.

       d. Click :guilabel:`Save`.

       e. Create the directory that you specified in the |mms| application on
          the systems hosting Automation Agents.

       f. Edit, then save the 
          :ref:`Automation Agent configuration file <automation-agent-config-file-location>` 
          to change the :asetting:`mmsConfigBackup` file location.

---
title: "Start the Automation Agent."
stepnum: 6
ref: start-automation-agent
action:
  pre: |
    Issue the following command:
  language: sh
  code: |
    nohup ./mongodb-mms-automation-agent >> automation-agent.log 2>&1 &
...
