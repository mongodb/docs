.. _create-cluster-storage:

=========================
Customize Cluster Storage
=========================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

Each cluster tier comes with a default set of resources.
Clusters of size M10 and larger provide the ability to customize
your storage capacity.

.. figure:: /images/customize-storage.png
   :figwidth: 720px
   :alt: Image showing storage customization

|service| provides the following storage configuration options,
depending on the selected cloud provider and cluster tier.

.. _storage-class-ui:

Cluster Class (AWS only)
------------------------

Clusters of size M40 and larger on AWS offer multiple options,
including:

- :guilabel:`Low CPU`
- :guilabel:`General`
- :guilabel:`Local NVMe SSD`

Locally attached ephemeral :ref:`NVMe SSDs <nvme-storage>`
offer the highest level of speed and performance.

Select the :guilabel:`Class` box with your preferred speed.
Changes to cluster class affect :ref:`cost <instance-size-costs>`.

.. _storage-capacity-ui:

Storage Capacity
----------------

The size of the server data volume. To change this, either:

- Specify the exact disk size in the text box, *or*

- Move the slide bar until the text box displays your preferred
  disk size.

Changes to storage capacity affect
:ref:`cost <instance-size-costs>`.

.. _change-storage-capacity-aws:

Changing Storage Capacity on |aws|
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

|aws| allows one storage capacity upgrade every six hours. When you 
upgrade a cluster's storage capacity for the first time during a 
six-hour period, |service| modifies the size of the servers' data 
volumes with zero downtime. If you upgrade the cluster's storage 
capacity again within six hours, |service| provisions new volumes and 
synchronizes data from the old to the new volumes to work around the 
|aws| limitation. During this time, you can still access your cluster, 
but each node that |aws| modifies is unavailable until |aws| attaches 
the new volume.

|aws| does not allow in-place storage capacity downgrades. If you 
downgrade a cluster's storage capacity, |service| provisions new 
volumes and synchronizes data from the old to the new volumes to work 
around the |aws| limitation. During this time, you can still access your 
cluster, but each node that |aws| modifies is unavailable until |aws| 
attaches the new volume.

This behavior also applies when you enable storage auto-scaling and 
|service| changes cluster storage.

To learn more about |aws| volume modification limitations, see 
:aws:`Requirements When Modifying Volumes 
</AWSEC2/latest/UserGuide/modify-volume-requirements.html#elastic-volumes-limitations>`
in the |aws| documentation.

.. _storage-iops-ui:

IOPS (configurable for AWS only)
--------------------------------

.. include:: /includes/cluster-settings/provision-iops-note.rst

If you select or deselect :guilabel:`Provision IOPS` for an existing
cluster, |service| provisions new volumes and synchronizes data from
the old to the new volumes.

.. _configuration-storage-considerations:

Minimum Disk Capacity to RAM Ratios
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/fact-aws-minimum-iops.rst

|service| has a 4 TB disk capacity limit on all replica sets and
shards, regardless of cluster tier. To expand total cluster
storage beyond 4 TB, enable :ref:`sharding
<cluster-option-sharding>`.

For clusters with :guilabel:`Auto-Expand Storage` enabled,
|service| respects the calculated maximum storage for the
selected cluster tier. Users whose disk capacity reaches the
allowable limit receive notification by email.

For more information on the default resources and available
configuration options for each cloud service provider, see:

- :ref:`AWS Configuration Options <amazon-aws-configuration-options>`
- :ref:`GCP Configuration Options <google-gcp-configuration-options>`
- :ref:`Azure Configuration Options
  <microsoft-azure-configuration-options>`.

Auto-Scale
----------

Use :guilabel:`Auto-scale` options to configure your cluster to
automatically scale your cluster tier and storage in response to
cluster usage. Cluster storage auto-scaling is enabled by default.

To configure your cluster to automatically scale its cluster tier,
check the :guilabel:`Cluster tier` checkbox. When you
enable cluster tier scaling, by default, your cluster can only scale
up. To allow your cluster to scale down, check the
:guilabel:`Allow cluster to be scaled down` checkbox. Specify a
range of cluster tiers to which your cluster can scale.

To opt out of cluster storage scaling, un-check the
:guilabel:`Storage` checkbox.

For more information on cluster auto-scaling and when auto-scaling
occurs, see :ref:`how-auto-scale-works`.

.. seealso:: :ref:`connection-limits`
