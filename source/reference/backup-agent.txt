==========================
Backup Agent Configuration
==========================

.. default-domain:: mongodb

.. _connection-settings:

Connection Settings
~~~~~~~~~~~~~~~~~~~

For the Backup Agent comminication with the MMS Servers, the following
connection settings are **required**:

.. setting:: mmsApiKey

   *Type*: string

   The MMS agent API key for a MMS group. The API Key can be found in the MMS
   interface on the :guilablel:`Settings` in the :guilabel:`Agent API
   Settings` section. For example:

   .. code-block:: ini

      mmsApiKey=abc123

.. setting:: mothership

   *Type*: string

   The hostname of the MMS Backup Web Server.

.. setting:: https

   *Type*: boolean

   Toggles communication with the MMS Backup web server over HTTPS.

.. _mongodb-ssl-settings:

MongoDB SSL Settings
~~~~~~~~~~~~~~~~~~~~

Specify these settings when the Backup Agent is connecting to MongoDB
instances with SSL.

.. setting:: sslTrustedServerCertificates

   *Type*: string

   The path on disk that contains the trusted certificate authority certificates
   in PEM format. These certificates will verify the server certificate
   returned from any MongoDBs running with SSL. For example:

   .. code-block:: ini

      sslTrustedServerCertificates=/etc/mongodb-mms/mongodb-certs.pem

.. setting:: sslRequireValidServerCertificates

   *Type*: boolean

   Use this option to disable certificate verification by setting this
   value to ``false``. That configuration is only recommended for
   testing purposes as it makes connections susceptible to MITM attacks.

.. _mongodb-kerberos-settings:

MongoDB Kerberos Settings
~~~~~~~~~~~~~~~~~~~~~~~~~

See :doc:`/tutorial/connect-to-hosts-with-kerberos-authentication`

.. setting:: krb5Principal

   *Type*: string

   The Kerberos principal used by the agent. For example:

   .. code-block:: ini

      krb5Principal=mmsagent/myhost@EXAMPLE.COM

.. setting:: krb5Keytab

   *Type*: string

   The *absolute* path to Kerberos principal's keytab file. For
   example:

   .. code-block:: ini

      krb5Keytab=/etc/mongodb-mms/backup-agent.keytab

.. _server-ssl-settings:

MMS Server SSL Settings
~~~~~~~~~~~~~~~~~~~~~~~

.. only:: hosted

   Advanced SSL settings used by the Backup Agent when communicating to the
   MMS Backup Web Server.

.. only:: saas

   Advanced SSL settings used by the Backup Agent when communicating to the
   MMS Backup Service.

.. setting:: sslTrustedMMSBackupServerCertificate

   By default the Backup Agent will use the trusted root CAs installed on the
   system. If the agent cannot found the trusted root CAs, configure
   these settings manually.

   .. only:: hosted

      If the MMS Backup Server is using a self-signed SSL certificate
      this setting is required.

   The path on disk that contains the trusted certificate authority certificates
   in PEM format. The agent will use this certificate to verify that
   the agent is communicating with the designated MMS Backup
   Server. For example:

   .. code-block:: ini

      sslTrustedMMSBackupServerCertificate=/etc/mongodb-mms/mms-certs.pem

.. only:: hosted

   .. setting:: sslRequireValidMMSBackupServerCertificate

      *Type*: boolean

      You can disable certificate verification by setting this value
      to  ``false``. That configuration is only recommended for
      testing purposes as it makes connections susceptible to
      *man-in-the-middle* attacks.
