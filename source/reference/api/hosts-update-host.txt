=============
Update a Host
=============

.. only:: cloud

   .. include:: /includes/api-base-url.rst

.. only:: onprem

   ..  include:: /includes/api-base-url-onprem.rst

Syntax
------

.. code-block:: sh

   PATCH /api/public/v1.0/groups/{GROUP-ID}/hosts/{HOST-ID}

Request Path Parameters
~~~~~~~~~~~~~~~~~~~~~~~

.. list-table::
   :header-rows: 1
   :widths: 15 10 75

   * - Path Element
     - Required/Optional
     - Description

   * - ``GROUP-ID``

     - Required.

     - The unique identifier for the group whose hosts you want to
       update.

   * - ``HOST-ID``

     - Required
     
     - The unique identifier of the host that you want to update.

Request Query Parameters
~~~~~~~~~~~~~~~~~~~~~~~~

This endpoint does not use HTTP query parameters.

Request Body Parameters
~~~~~~~~~~~~~~~~~~~~~~~

You can specify the following fields:

.. list-table::
   :header-rows: 1
   :widths: 15 10 75

   * - Path Element
     - Required/Optional
     - Description
   * - ``username``

     - Required if ``authMechanismName`` is ``MONGODB_CR``. Otherwise 
       illegal.

     - Username for connecting to this MongoDB process.

   * - ``password``

     - Required if ``authMechanismName`` is ``MONGODB_CR``. Otherwise 
       illegal.

     - Password for connecting to this MongoDB process. If the process's ``authMechanismName``
       is ``MONGODB_CR``, then you must include this field when creating the
       process or updating its credentials. However, it will never be exposed when
       a host entity is returned.

   * - ``sslEnabled``

     - Optional

     - Is SSL enabled for this MongoDB process? Must be ``true`` if the
       ``authMechanismName`` is ``MONGODB_X509``. Default is ``false``
       if omitted.

   * - ``logsEnabled``

     - Optional

     - Is |mms| collecting logs for this MongoDB process? Default is 
       ``false`` if omitted.

   * - ``alertsEnabled``

     - Optional

     - Are alerts enabled for this MongoDB process? Default is ``true``
       if omitted.

   * - ``profilerEnabled``

     - Optional

     - Is |mms| collecting profile information from this MongoDB process?
       Default is ``false`` if omitted.

   * - ``muninPort``

     - Optional

     - What port should be used to collect Munin stats from this MongoDB 
       process? Default is 0 and Munin stats are not collected if omitted.
       
   * - ``authMechanismName``

     - Optional

     - The authentication mechanism used to connect to this MongoDB process. 
       Default is ``NONE`` if omitted. If ``authMechanismName`` is ``NONE``
       then any existing value for ``username`` and ``password`` will be
       cleared out. If set to ``MONGODB_CR`` then you must provide the 
       ``username`` and ``password``. Possible values are:

       .. include:: /includes/possibleValues-api-authMechanismName.rst

Response Elements
~~~~~~~~~~~~~~~~~

The response includes a ``results`` array of container information.
Each container information has the following fields:

.. list-table::
   :header-rows: 1

   * - Field
     - Description

   * - ``id``
     - Unique identifier.

   * - ``groupId``
     - ID of the group that owns this MongoDB process.

   * - ``clusterId``
     - The ID of the cluster to which the MongoDB process belongs.

   * - ``hostname``
     - Primary hostname. A MongoDB process typically has several aliases, so the primary is
       the best available name as decided by |mms|.

   * - ``port``
     - Port that MongoDB process (``mongod`` or ``mongos``) listens on.

   * - ``typeName``
     - Type for this MongoDB process. Possible values are:

       - ``STANDALONE``
       - ``REPLICA_PRIMARY``
       - ``REPLICA_SECONDARY``
       - ``REPLICA_ARBITER``
       - ``RECOVERING``
       - ``MASTER``
       - ``SLAVE``
       - ``SHARD_MONGOS``
       - ``SHARD_CONFIG``
       - ``SHARD_STANDALONE``
       - ``SHARD_PRIMARY``
       - ``SHARD_SECONDARY``
       - ``NO_DATA``

       The type for new hosts added to |mms| will be ``NO_DATA``
       until the Monitoring Agent receives its first ping.

   * - ``lastPing``
     - When the last ping for this MongoDB process was received.

   * - ``ipAddress``
     - IP address of this MongoDB process.

   * - ``version``
     - Version of MongoDB running for this process.

   * - ``hasStartupWarnings``
     - Are there startup warnings for this MongoDB process?

   * - ``sslEnabled``
     - Is SSL enabled for this MongoDB process? Must be ``true`` if the
       ``authMechanismName`` is ``MONGODB_X509``.

   * - ``logsEnabled``
     - Is |mms| collecting logs for this MongoDB process?

   * - ``uptimeMsec``
     - Number of milliseconds since this process last restarted.

   * - ``lastRestart``
     - Date this process last restarted.

   * - ``deactivated``
     - Whether the host is currently active.

   * - ``lastDataSizeBytes``
     - The size of the host's databases on disk. This number **does not**
       include the data in the :manual:`local </reference/local-database>`
       database.

   * - ``lastIndexSizeBytes``
     - The size of the host's database indexes on disk. This number **does
       not** include the size of the index for the :manual:`local
       </reference/local-database>` database.

   * - ``shardName``
     - Name of the shard this process belongs to. Only present if the process is part
       of a sharded cluster.

   * - ``replicaSetName``
     - Name of the replica set this process belongs to. Only present if this process is
       part of a replica set.

   * - ``replicaStateName``
     - Current state of this MongoDB process within a replica set. Only present if this
       process is part of a replica set. See :manual:`Replica Set Member States
       </reference/replica-states>` for possible values.

   * - ``created``
     - Date this MongoDB process was created or first discovered by |mms|.

   * - ``hostEnabled``
     - Is this process currently enabled? MongoDB processes can be manually disabled in the |mms|
       UI.

   * - ``journalingEnabled``
     - Is journaling enabled for this MongoDB process?

   * - ``alertsEnabled``
     - Are alerts enabled for this MongoDB process?

   * - ``muninEnabled``
     - Are Munin stats being collected for this MongoDB process?

   * - ``profilerEnabled``
     - Is |mms| collecting profile information from this MongoDB process?

   * - ``lowUlimit``
     - Does this MongoDB process's server have a low ``ulimit`` setting?

   * - ``muninPort``
     - What port should be used to collect Munin stats from this MongoDB process?

   * - ``authMechanismName``
     - The authentication mechanism used to connect to this MongoDB process. Possible values
       are:

       .. include:: /includes/possibleValues-api-authMechanismName.rst

   * - ``username``
     - Username for connecting to this MongoDB process. Only present when the
       ``authMechanismName`` is ``MONGODB_CR``.

   * - ``aliases``
     - A list of alternate hostname:port combinations that |mms| has discovered for
       the MongoDB process.

   * - ``displayName``
     - The MongoDB process's display name in |mms|. If this is not set, |mms|
       displays the hostname instead. To unset this, use an empty string
       (``""``) as the value of this field.

   * - ``links``
     - A list of links to sub-resources and related resources.

Example Request
---------------

.. only:: cloud

   .. code-block:: none

      curl -u "username:apiKey" -H "Content-Type: application/json" --digest -i -X PATCH "https://cloud.mongodb.com/api/public/v1.0/groups/533c5895b91030606f21033a/hosts/680ab316473d6b28f966364b947134fc" --data '
      {
        "sslEnabled": true,
        "username": "mongo",
        "password": "M0ng0DB!:)"
      }'

.. only:: onprem

   .. code-block:: none

      curl -u "username:apiKey" -H "Content-Type: application/json" --digest -i -X PATCH "https://<ops-manager-host>/api/public/v1.0/groups/533c5895b91030606f21033a/hosts/680ab316473d6b28f966364b947134fc" --data '
      {
        "sslEnabled": true,
        "username": "mongo",
        "password": "M0ng0DB!:)"
      }'

Example Response
----------------

.. code-block:: none

   HTTP/1.1 200 OK

   {
     "id" : "680ab316473d6b28f966364b947134fc",
     "groupId" : "533c5895b91030606f21033a",
     "clusterId" : "45cbedf1e4b010e0058b532e",
     "hostname" : "localhost",
     "port" : 26000,
     "typeName": "REPLICA_SECONDARY",
     "lastPing" : "2016-08-15T17:57:12Z",
     "ipAddress": "127.0.0.1",
     "version" : "3.2.0",
     "hasStartupWarnings" : false,
     "sslEnabled" : true,
     "logsEnabled" : false,
     "created" : "2014-04-22T19:56:50Z",
     "uptimeMsec": 489182394,
     "deactivated" : false,
     "lastDataSizeBytes" : 470208719,
     "lastIndexSizeBytes" : 110420592,
     "replicaSetName": "rs1",
     "replicaStateName" : "SECONDARY",
     "hostEnabled" : true,
     "journalingEnabled" : false,
     "alertsEnabled" : true,
     "hidden" : false,
     "muninEnabled" : false,
     "profilerEnabled" : false,
     "lowUlimit" : false,
     "authMechanismName" : "MONGODB_CR",
     "username" : "mongo",
     "links" : [ ... ]
   }