=================================
Edit a Deployment's Configuration
=================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

You can modify a deployment's configuration and topology, including its
MongoDB versions, storage engines, and numbers of hosts or shards. You 
can make modifications at all levels of a deployment's topology from a
top-level :term:`sharded cluster <sharded cluster>` or
:term:`replica set` to lower levels, such as a replica set within a
sharded cluster, or an individual process within a replica set. You can
also modify :term:`standalone <standalone>` processes.

.. note::

   If you make configuration changes to an individual MongoDB process
   within a cluster, any future changes to the cluster no longer apply
   to the child process. 

   .. example:: 

      If you turn off journaling for a replica set member and then 
      later change the journal commit interval for the replica set, 
      the change does not apply to the member.

Considerations
--------------

MongoDB Version
~~~~~~~~~~~~~~~

To choose which versions of MongoDB are available to |mms|, see
:doc:`/tutorial/configure-available-mongodb-version`.

.. include:: /includes/considerations-change-mongodb-version.rst

Storage Engine
~~~~~~~~~~~~~~

If you run or upgrade to MongoDB 3.0 or higher and modify the MongoDB
storage engine, |mms| shuts down and restarts the MongoDB process. For 
a multi-member replica set, |mms| performs a rolling 
:term:`initial sync` of each member.

|mms| creates backup directories during the migration from one storage
engine to the other as long as the server has adequate disk space. 
|mms| *does not* delete the backup directories once the migration is 
complete. The backup directories are safe to keep and will not affect
any future storage engine conversion, but they do take up disc space. 
If desired, you can delete them. The backup directories are located in 
the :program:`mongod`'s data directory.

.. example::

   If the data directory was ``/data/process``, the backup would be
   ``/data/process.bak.UNIQUENAME``. The ``UNIQUENAME`` is a random
   string that |mms| generates.

Before you can change the storage engine for a standalone instance or
single-member replica set, you must give the Automation Agent write
access to the MongoDB data directory's *parent* directory. The agent
creates a temporary backup of the data in parent directory when 
updating the storage engine.

You cannot change the storage engine on a :term:`config server`. For
more information on storage engines and the available options, see
:manual:`Storage </core/storage>` in the MongoDB manual.

Fixed Properties
~~~~~~~~~~~~~~~~

You cannot modify the following settings after a deployment has been 
created:

- :option:`database path <--dbpath>`
- host or :option:`port <--port>` to which a MongoDB process is 
  assigned

You *can* modify the following deployment settings:

- :option:`log path <--logpath>` at the process level
- :doc:`advanced options </reference/deployment-advanced-options>`

Deployment Topology
~~~~~~~~~~~~~~~~~~~

You can make modifications at all levels of a deployment's topology,
including child processes. You can also modify the topology itself.
To do so use this tutorial or one of the more specific tutorials 
available in this section of the manual, such as 
:doc:`/tutorial/migrate-member-to-new-hardware` or
:doc:`/tutorial/convert-standalone-to-replica-set`.

Project-Level Modifications
~~~~~~~~~~~~~~~~~~~~~~~~~~~

Some modifications that affect a deployment occur at the project level.
The following changes affect every MongoDB process in the project. For
these changes, use the specified tutorials:

- To enable SSL for the deployment, see
  :doc:`/tutorial/enable-ssl-for-a-deployment`.

- To enable authentication for the deployment, see
  :doc:`/tutorial/nav/security-enable-authentication`.

- To add or modify MongoDB users and roles for the deployment, see
  :doc:`/tutorial/manage-mongodb-users`.

Multiple Modifications
~~~~~~~~~~~~~~~~~~~~~~

You can combine multiple modifications into one deployment. 

.. example::
   You could make all the following modifications before clicking the
   :guilabel:`Review Changes` button:

   - Add the latest stable version of MongoDB to the 
     :ref:`version-manager`.

   - Enable SSL for the deployment's MongoDB processes.

   - Add a new sharded cluster running the latest stable version of 
     MongoDB from above.

When you click :guilabel:`Review Changes`, the review displays all the
changes on one screen for you to confirm before deploying.

Prerequisites
-------------

Your deployment must be running a version of the :term:`Automation
Agent` that is compatible with |mms|. If your deployment is not running
a compatible version of the agent, |mms| displays a banner prompting you to update your agents.

Procedure
---------

To edit the deployment's configuration:

.. include:: /includes/steps/edit-deployment.rst
