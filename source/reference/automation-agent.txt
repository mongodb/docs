==============================
Automation Agent Configuration
==============================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. include:: /includes/extracts/automation-agent-configuration-overview.rst

.. warning::

   If you edit these settings through the :guilabel:`Settings` or
   :guilabel:`Deployments`, in the case of authentication or SSL, in
   |mms|, those changes overwrite any changes made manually in this
   configuration file.

.. _automation-agent-config-file-location:

Configuration File Location on Each Platform
--------------------------------------------

The location of the Automation Agent configuration file depends on
your platform:

.. include:: /includes/list-table-automation-agent-conf-file-locations.rst

Settings
--------

|mms| provides default values for many of the Automation Agent
Configuration settings.

.. _automation-agent-connection-settings:

Connection Settings
~~~~~~~~~~~~~~~~~~~

.. asetting:: mmsGroupId

   *Type*: string

   Specifies the ID of your |mms| project. In |mms|, click
   :guilabel:`Settings`, then :guilabel:`Agents` and then click on the
   appropriate operating system under :guilabel:`Agent Downloads`.

   When the :guilabel:`Automation Agent Installation Instructions` box
   appears, these values can be copied directly from this box using the
   :guilabel:`Copy` buttons.

   .. only:: cloud

      *Required*.

   .. only:: onprem

      This setting is usually set when the Automation Agent is
      installed and is required to bind the server to a project.

   .. code-block:: ini

      mmsGroupId=8zvbo2s2asigxvmpnkq5yexf

   .. only:: onprem

      .. include:: /includes/extracts/server-pool-agent-group-settings.rst

.. asetting:: mmsApiKey

   *Type*: string

   Specifies the |mms| agent API key of your |mms| project.

   .. include:: /includes/extracts/agent-api-key-specify.rst

   .. only:: cloud

      *Required*.

   .. only:: onprem

      This setting is usually set when the Automation Agent is
      installed and is required to bind the server to a project.

   .. code-block:: ini

      mmsGroupId=8zvbo2s2asigxvmpnkq5yexf

   .. only:: onprem

      .. include:: /includes/extracts/server-pool-agent-group-settings.rst

.. _mmsBaseUrl:

.. asetting:: mmsBaseUrl

   *Type*: string

   .. include:: /includes/extracts/automation-agent-configuration-mmsbaseurl.rst

.. only:: onprem

   .. asetting:: serverPoolKey

      .. include:: /includes/fact-server-pools-deprecated.rst

      Specifies the Server Pool Key. Required if adding the server to a
      server pool. If using a server pool, do not set
      :asetting:`mmsGroupId` and :asetting:`mmsApiKey`

      .. include:: /includes/extracts/server-pool-key.rst

      .. code-block:: ini

         serverPoolKey=somekeyabc123

   .. asetting:: serverPoolPropertiesFile

      Specifies the full filepath of a file that contains server
      properties. Required if adding the server to a server pool. If
      using a server pool, do not set :asetting:`mmsGroupId` and
      :asetting:`mmsApiKey`

      .. include:: /includes/extracts/server-pool-properties-file.rst

      Ensure the Automation Agent can read the file.

      .. code-block:: ini

         serverPoolPropertiesFile=/path/to/some/propertiesfile.txt

   .. asetting:: serverPoolStateFile

      Specifies the full filepath of the file to be used by the
      Automation Agent. Required if adding the server to a server pool.
      If using a server pool, do not set :asetting:`mmsGroupId` and
      :asetting:`mmsApiKey`

      .. include:: /includes/extracts/server-pool-state-file-permission.rst

      .. code-block:: ini

         serverPoolStateFile=/path/to/some/statefile.txt

.. asetting:: logFile

   *Type*: string

   Specifies the path to which |mms| should write the Automation Agent's log.

   *By default, this path is*
   ``/var/log/mongodb-mms-automation/automation-agent.log``.

   .. code-block:: ini

      logFile=/path/to/mongodb-mms-automation/automation-agent.log

.. asetting:: mmsConfigBackup

   *Type*:

   Specifies the path to the |mms|
   :ref:`automation configuration <automation-configuration-sample-entity>`
   backup file. This file describes the desired state of the deployment.

   .. code-block:: ini

      mmsConfigBackup=/path/to/mms-cluster-config-backup.json

   .. note::
      When |onprem| is installed, it stores this configuration backup
      file in ``/var/lib/mongodb-mms-automation/``.

.. asetting:: dialTimeoutSeconds

   *Type*: int

   Specifies the number of seconds to wait before a connection times out.
   By default, connections time out after 40 seconds. However, The
   Automation Agent may frequently time out of connections for one or
   more of the following reasons:

   - High network latency

   - High server load

   - Large SSL keys

   - Lack of SSL accelerator

   - Insufficient CPU speed

   MongoDB recommends gradually increasing the value of the
   :setting:`dialTimeoutSeconds` Automation Agent configuration setting
   to prevent frequent premature connection timeouts.

   .. code-block:: ini

      dialTimeoutSeconds=40

   .. note::
      Increasing this value also increases the time required to deploy
      configuration changes to the Automation Agent. Experiment with
      small, incremental increases until you determine the optimum
      value for your deployment.

Logging Settings
~~~~~~~~~~~~~~~~

.. asetting:: logLevel

   *Type*: string

   Specifies the level of logging granularity.

   Choose from the following severity levels, from most to least
   verbose:

   - ``DEBUG``
   - ``INFO``
   - ``WARN``
   - ``ERROR``
   - ``FATAL``

   By default, :asetting:`logLevel` is ``INFO``.

   .. code-block:: ini

      logLevel=ROUTINE

   Each level includes the log items included in the succeeding levels.

   .. example::

      - If you choose ``DEBUG``, the Automation Agent logs all
        messages, including ``INFO``, ``WARN``, ``ERROR``
        and ``FATAL``.

      - If you choose ``FATAL``, the Automation Agent only logs
        ``FATAL`` messages.

.. asetting:: maxLogFiles

   *Type*: integer

   Specifies the maximum number of rotated log files to retain.

   By default, :asetting:`maxLogFiles` is ``10``. You can change the
   value to retain a different quantity of rotated log files.

   .. code-block:: ini

      maxLogFiles=15

.. asetting:: maxLogFileSize

   *Type*: integer

   Specifies the maximum size, in bytes, of a log file before the logs
   are rotated. If unspecified, the Automation Agent does not rotate
   logs based on file size. This is optional.

   .. code-block:: ini

      maxLogFileSize=536870912

.. asetting:: maxLogFileDurationHrs

   *Type*: float

   Specifies the number of hours after which the logs (regular and verbose) are rotated. This is optional.

.. note::
   On UNIX- and Linux-based systems you can manually rotate the
   Automation Agent logs. Issue a user signal 1 kill command for the
   Automation Agent process:

   .. code-block:: sh

      kill -SIGUSR1 <automationAgentID>

   This rotates the Automation Agent regular and verbose logs.


HTTP Proxy Settings
~~~~~~~~~~~~~~~~~~~

.. asetting:: httpProxy

   *Type*: string

   Specifies the URL of an HTTP proxy server the Automation Agent can use.

   .. code-block:: ini

      httpProxy=http://proxy.example.com:8080

.. _automation-mongodb-kerberos-settings:

MongoDB Kerberos Settings
~~~~~~~~~~~~~~~~~~~~~~~~~

Specify these settings if the Automation Agent authenticates to hosts
using Kerberos.

.. asetting:: krb5ConfigLocation

   *Type*: string

   Specifies an *absolute* path to an non-system-standard location for
   the Kerberos configuration file.

   .. code-block:: ini

      krb5ConfigLocation=/path/to/krb_custom.conf

.. include:: /includes/fact-set-krb5ccname.rst

.. asetting:: backupAgentKrb5CCName

   *Type* string

   Specifies the ``KRB5CC`` environment variable that the Automation
   Agent sets for Backup Agent process. Used only to authenticate the
   Backup Agent to your MongoDB deployment when the Automation Agent
   starts the agent.

   .. code-block:: ini

      backupAgentKrb5CCName=/path/to/credentials_cache_file

.. asetting:: monitoringAgentKrb5CCName

   *Type* string

   Specifies the ``KRB5CC`` environment variable that the Automation
   Agent sets for the Monitoring Agent process. Used only to authenticate
   the Monitoring Agent to your MongoDB deployment when the Automation
   Agent starts the agent.

   .. code-block:: ini

      monitoringAgentKrb5CCName=/path/to/credentials_cache_file

.. _automation-server-ssl-settings:

|mms| SSL Settings
~~~~~~~~~~~~~~~~~~

Specify the settings the Automation Agent uses when communicating with
|mms| using SSL.

.. asetting:: sslTrustedMMSServerCertificate

   *Type*: string

   Specifies the *absolute* path that contains the trusted CA
   certificates in ``PEM`` format. The absolute path must be used
   because the Automation Agent may pass this certificate to the other
   agents, which may have different paths relative to the Automation
   Agent. This certificate verifies that the agent is talking to the
   designated |mms| instance.

   .. code-block:: ini

      sslTrustedMMSServerCertificate=/path/to/ca.pem

.. asetting:: sslRequireValidMMSServerCertificates

   *Type*: boolean

   Specifies if the Automation Agent should validate SSL certificates
   presented by |mms|.

   .. warning::

      Setting this option to ``false`` disables certificate
      verification and makes connections between the Automation Agent
      and |mms| susceptible to *man-in-the-middle*
      attacks. Setting this option to ``false`` is only recommended for
      testing purposes.

   .. code-block:: ini

      sslRequireValidMMSServerCertificates=true

.. additional settings are in the following extracts file:

.. include:: /includes/extracts/automation-agent-configuration-ssl.rst
