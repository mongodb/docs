title: "Set the source for Backup Daemons and its Agents to install binaries to the :guilabel:`Ops Manager Application Server`."
stepnum: 1
level: 4
ref: edit-config-file
content: |

  a. Click :guilabel:`Admin` in the upper right corner to open system
     administration.

  #. From the :guilabel:`General` tab, click
     :guilabel:`Ops Manager Config`.

  #. Click the :guilabel:`Miscellaneous` tab at the top of the page.

  #. Scroll to the :guilabel:`MongoDB Version Management` heading.

  #. Select the following settings:

     .. list-table::
        :widths: 30 70
        :header-rows: 1

        * - Option
          - Action

        * - :guilabel:`Agents get the installers from:` under
            :guilabel:`Installer Download Source`

          - Select :guilabel:`Ops Manager Application Server`.

            All necessary installers are downloaded from |onprem|
            Application Servers. Agent hosts do not need an internet
            connection.

        * - :guilabel:`Ops Manager gets installers from:` under
            :guilabel:`Installer Download Source`
          - Select
            :guilabel:`Ops Manager Application Server Hard Drive`.

            An |onprem| administrator provides installers from the
            MongoDB Download Center into the
            :setting:`Versions Directory`. |onprem| serves them to
            Agent hosts. The Version Manifest must be
            :doc:`updated manually </tutorial/update-version-manifest>`.
            No hosts in the deployment require an internet connection.

            .. note::

               This option appears if :guilabel:`Agents get the
               installers from:` is set to :guilabel:`Ops Manager
               Application Server`.

        * - :guilabel:`Versions Directory`
          - Leave this value to the plaform default unless you need to
            change to meet a requirement for your environment.

            The default locations for the :setting:`Versions Directory`
            depend on your |onprem| host platform:

            .. list-table::
               :header-rows: 1
               :widths: 30 70

               * - Platform
                 - Versions Directory Default Path

               * - RHEL, Ubuntu
                 - ``/opt/mongodb/mms/mongodb-releases``

               * - Linux Archive
                 - ``<userSelected>/mongodb-releases``

               * - Windows
                 - ``C:\MMSData\MongoDBReleases``

            The |application| expects the MongoDB binaries to be
            stored in this directory on every |onprem| host.

        * - :guilabel:`Backup Versions Auto Download`
          - Select ``true`` unless your :term:`Backup Daemon` and
            |application| run on different platforms (chip
            architectures, operating systems, or operating system
            versions). If they run on separate platforms, select
            ``false``.

        * - :guilabel:`Backup Versions Auto Download Enterprise Builds`
          - Select ``true`` if you want the Backup Daemon to download
            MongoDB Enterprise builds as well as MongoDB Community
            builds.

        * - :guilabel:`Required Module for Backup`
          - Select which build of MongoDB you want the
            :term:`Backup Daemon` to use for the :term:`head database`.
            Select :guilabel:`Enterprise Required` if you want the 
            Backup Daemon to download only MongoDB Enterprise builds.

---
title: "Download the required MongoDB archives."
stepnum: 2
level: 4
ref: download-binaries
content: |

   Using a computer connected to the Internet, go to the MongoDB
   `Download Center <https://www.mongodb.com/download-center>`_
   and download the MongoDB binary archives for the appropriate
   platforms and versions.

   Binaries are stored as compressed archives (``.tgz`` for macOS or
   Linux and ``.zip`` for Windows).

   .. admonition:: Downloading Archives with Microsoft Internet Explorer and Edge Browsers
      :class: note

      If you download a binary archive using Microsoft Internet
      Explorer or Edge, the archive downloads with a ``.gz`` extension
      instead of a ``.tgz`` extension. You must change this file
      extension to ``.tgz`` before continuing.

   If you do not have a list of which versions you require,
   return to the :guilabel:`Prerequisites` section of this tutorial and 
   review the 
   :guilabel:`Determine which Binaries to Store Locally and Download`
   section.

   **To download a Community Edition:**

   a. Go to the `Community Server
      <https://www.mongodb.com/download-center#community>`_ tab in the
      Download Center.

   #. Click on the tab for the desired platform.

   #. In the :guilabel:`Version` list, click the desired platform
      version.

   #. To download the latest stable version, click
      :guilabel:`Download`.

      For the current stable version, click the :guilabel:`Download`
      button and in the dialog that appears, click on the
      :guilabel:`archive` link.

   #. To download the older versions, click
      :guilabel:`All Version Binaries`.

   #. Download the **archive file** for each MongoDB host platform
      that |onprem| manages.

   **To download an Enterprise Edition:**

   a. Go to the `Enterprise Server
      <https://www.mongodb.com/download-center#enterprise>`_ tab in the
      Download Center.

   #. Click on the tab for the desired platform.

   #. In the :guilabel:`Version` list, click the desired platform
      version.

   #. To download the latest stable version, click
      :guilabel:`Download`.

      For the current stable version, click the :guilabel:`Download`
      button and in the dialog that appears, click on the
      :guilabel:`archive` link.

   #. To download the older versions, click
      :guilabel:`Archived Releases`.

      For each platform and MongoDB version you want to download,
      click the link to the right of the :guilabel:`Archive` label.

---
title: "Populate all |onprem| hosts with the necessary MongoDB binaries and archives."
stepnum: 3
level: 4
ref: populate-with-binaries
content: |

  On *all* your |onprem| hosts, including those with enabled Backup
  Daemons, you must copy all of the archived binaries to the directory
  specified in the :setting:`Versions Directory`.
  This directory stores all of the MongoDB archived and extracted
  binaries that |onprem| needs to install and upgrade MongoDB
  deployments and :term:`head databases <head database>`.

---
title: "Ensure that the |mms| Linux user can read files in the Versions Directory. (Linux only)"
stepnum: 4
level: 4
ref: mongodb-mms-as-owner
content: |

  On a Linux platform, the ``mongodb-mms`` user needs the read
  permissions to the :setting:`Versions Directory`.

  a. Change ownership of all files and  directories in the Versions
     Directory to ``mongodb-mms``.

     .. code-block:: sh
        :class: copyable-code

        sudo chown -R mongodb-mms:mongodb-mms <path-to-the-versions-directory>/*

  b. Change permissions on all the files under the
     Versions Directory to allow the:

     - **Owner** to read and write them
     - **Group** to read them

     When you set these permissions, |onprem| can read and extract the
     archived binaries. Do not remove the execute permission from any
     directories under the
     :setting:`Versions Directory`. If you did, the
     :term:`Backup Daemon` cannot access any files inside those
     directories.

     .. code-block:: sh
        :class: copyable-code

        sudo chmod -R 640 <path-to-the-versions-directory>/*.tgz \
          <path-to-the-versions-directory>/*.zip

  If these steps were successful, the resulting list of the
  :setting:`Versions Directory` should look
  something like this:

  .. code-block:: sh

     -rw-r----- 1 mongodb-mms mongodb-mms 116513825 Apr 27 15:06 mongodb-linux-x86_64-2.6.9.tgz
     -rw-r----- 1 mongodb-mms mongodb-mms  51163601 May 22 10:05 mongodb-linux-x86_64-amazon-3.0.3.tgz
     -rw-r----- 1 mongodb-mms mongodb-mms  50972165 May 22 10:06 mongodb-linux-x86_64-suse12-3.6.4.tgz
     -rw-r----- 1 mongodb-mms mongodb-mms  95800685 Apr 27 15:05 mongodb-linux-x86_64-enterprise-amzn64-2.6.9.tgz
     -rw-r----- 1 mongodb-mms mongodb-mms  50594134 Apr 27 15:04 mongodb-linux-x86_64-enterprise-amzn64-3.0.2.tgz
     -rw-r----- 1 mongodb-mms mongodb-mms  50438645 Apr 27 15:04 mongodb-linux-x86_64-enterprise-suse12-3.6.4.tgz
     drwxrwx--- 1 mongodb-mms mongodb-mms      4096 Apr 27 15:04 mongodb-linux-x86_64-enterprise-suse12-3.6.4

  Repeat these steps on each |onprem| host.

---
title: "Update the version manifest for |onprem| on each |onprem| host."
stepnum: 5
level: 4
ref: update-version-manifest
action:

  - heading: "Update the Version Manifest using your Web Browser."
    pre: |

      The version manifest provides |onprem| with a list of all
      released MongoDB versions available to your |onprem| hosts.

      a. Click the :guilabel:`Update MongoDB Version Manifest from
         MongoDB, Inc.` button.

      b. The :term:`version manifest` should update automatically.

  - heading: "Update the Version Manifest offline."
    pre: |

      If the update via the web browser does not work, you need to
      copy and paste the :term:`version manifest` to your |onprem|
      hosts.
 
      a. From a computer that can access both the Internet, download
         the version manifest from |manifestlink|.

      #. Transfer the :term:`version manifest` to a computer that can
         connect to your |application|.

      #. Open the manifest JSON file.
 
      #. Select all of the contents and copy them to the clipboard.

      #. Log in to |onprem|.
 
      #. Click :guilabel:`Admin` in the upper right
         corner to open system administration.
 
      #. Click the :guilabel:`General` tab.
 
      #. Click :guilabel:`Version Manifest`.
 
      #. Click the :guilabel:`Update MongoDB Version Manifest` button.
 
      #. Paste the version manifest in the box.

      #. Click :guilabel:`Save`.

---
title: "Specify which versions the Automation Agents can download per project."
stepnum: 6
level: 4
ref: select-versions
content: |

  a. In |onprem|, click :guilabel:`Back To Project` in the upper left
     to exit system administration.

  #. Click the :guilabel:`Project` link at the top of the page and
     select the desired project.

  #. Click :guilabel:`Deployment`, then the :guilabel:`More` drop-down
     list, then :guilabel:`Version Manager`.

  #. Select the checkboxes for the versions of MongoDB that you have
     made available on the |application| host.

  .. important::
  
     For the selected versions, ensure that you have downloaded and
     placed the archived binaries in the 
     :setting:`Versions Directory`. Otherwise, |onprem| fails a
     pre-flight check when starting in :guilabel:`Local Mode`. 

     .. seealso::

        :ref:`Start Ops Manager When All Versions Are Not Downloaded <fix-local-mode-start-failure>`.

---
title: "Review and approve your changes."
stepnum: 7
level: 4
ref: confirm-deployment
content: |

  |mms| displays your proposed changes.

  a. If you are satisfied, click :guilabel:`Confirm & Deploy`.

  #. Otherwise, click :guilabel:`Cancel` and you can make
     additional changes.

...
