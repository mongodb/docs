==============================
Automation Agent Configuration
==============================

.. default-domain:: mongodb

Configuration File
------------------

The location of the Automation Agent configuration file depends on your
operating system:

- RHEL, CentOS, Amazon Linux, and Ubuntu all use a package manager to
  install the agent. The package manager creates the following agent
  configuration file::

     /etc/mongodb-mms/automation-agent.config

- OS X, Windows, and other Linux systems use either a ``tar`` or ``msi``
  file for the installation. The Automation Agent stores its configuration
  in the following file::

     <installation directory>/local.config

Settings
--------

|mms| provides default values for many of the Automation Agent
Configuration settings. However, you **must** set the
:asetting:`mmsGroupId` and :asetting:`mmsApiKey` values.

.. _automation-agent-connection-settings:

Connection Settings
~~~~~~~~~~~~~~~~~~~

.. asetting:: mmsGroupId

   *Type*: string

   **Required**. The ID of your |mms| group. You can find it in |mms| under the
   :guilabel:`Group Settings` page in the :guilabel:`Settings` tab.

   For example:

   .. code-block:: ini

      mmsGroupId=8zvbo2s2asigxvmpnkq5yexf

.. asetting:: mmsApiKey

   *Type*: string

   **Required**. The |mms| agent API key for the group. To retrieve the key from the |mms|
   interface, click the :guilabel:`Settings` tab, then the
   :guilabel:`Group Settings` page.

   For example:

   .. code-block:: ini

      mmsApiKey=rgdte4w7wwbnds9nceuodx9mcte2zqem

.. asetting:: mmsBaseUrl

   *Type*: string

   The URL of the |mms| Web Server.

   .. include:: /includes/extracts/automation-agent-configuration-mmsbaseurl.rst

.. asetting:: logFile

   *Type*: string

   The path to which |mms| should write the automation agent's log. By
   default, the path is
   ``/var/log/mongodb-mms-automation/automation-agent.log``, but you can
   choose an alternate location if desired.

   For example:

   .. code-block:: ini
   
      logFile=/var/log/mongodb-mms-automation/automation-agent.log

.. asetting:: mmsConfigBackup

   *Type*:

   The path to the file where the Automation Agent stores a backup copy
   of the |mms| :ref:`automation configuration
   <automation-configuration-sample-entity>`, which describes the
   desired state of the deployment.

   For example:

   .. code-block:: ini

      mmsConfigBackup=/var/lib/mongodb-mms-automation/mms-cluster-config-backup.json

Logging Settings
~~~~~~~~~~~~~~~~

.. asetting:: logLevel

   *Type*: string

   The level of logging granularity. You can choose from the following
   severity levels, from most verbose to least. By default,
   :asetting:`logLevel` is ``INFO``.
   
   - ``DEBUG``
   - ``ROUTINE``
   - ``INFO``
   - ``WARN``
   - ``ERROR``
   - ``DOOM``

   For example:

   .. code-block:: ini
   
      logLevel=ROUTINE 

   Each level includes the log items covered by the following levels.
   For instance, if you choose ``DEBUG``, the Automation Agent logs all
   messages, including ``ROUTINE``, ``INFO``, ``WARN``, ``ERROR``, and
   ``DOOM``. By contrast, if you choose ``DOOM``, the Automation Agent
   only logs ``DOOM`` messages.

.. asetting:: maxLogFiles

   *Type*: integer

   The maximum number of rotate log files to retain. By default,
   :asetting:`maxLogFiles` is ``10``. You can change the value to
   retain a different number of rotated log files. For example:

   .. code-block:: ini

      maxLogFiles: 15

.. asetting:: maxLogFileSize

   *Type*: integer

   Specifies the maximum size, in bytes, that a log file can be before
   triggering log rotation. For example:

   .. code-block:: ini

      maxLogFileSize=536870912

HTTP Proxy Settings
~~~~~~~~~~~~~~~~~~~

.. asetting:: httpProxy

   *Type*: string

   To configure the Automation Agent to use an HTTP proxy, specify the
   URL of the proxy. For example:

   .. code-block:: ini

      httpProxy=http://example-proxy.com:8080

.. _backup-mongodb-kerberos-settings:

MongoDB Kerberos Settings
~~~~~~~~~~~~~~~~~~~~~~~~~

Specify these settings if the Automation Agent authenticates to hosts using
Kerberos. See :doc:`/tutorial/configure-backup-agent-for-kerberos`.

.. msetting:: krb5ConfigLocation

   *Type*: string

   The *absolute* path to an non-system-standard location for the Kerberos configuration file. For
   example:

   .. code-block:: ini

      krb5ConfigLocation=/etc/krb_custom.conf

.. _automation-agent-ssl-settings:

MongoDB SSL Settings
~~~~~~~~~~~~~~~~~~~~

.. asetting:: sslTrustedMMSServerCertificate

   *Type*: string

   The path on disk that contains the trusted certificate authority
   certificates in PEM format. Because the Automation agent can pass
   :asetting:`sslTrustedMMSServerCertificate` to the other agents,
   which may have different paths relative to the automation agent,
   specify the **absolute path** to the certificate. This certificate
   verifies that the agent is talking to the |mms| servers.

   .. code-block:: ini

      sslTrustedMMSServerCertificate=/etc/ssl/ca.pem

.. asetting:: sslRequireValidMMSServerCertificates

   *Type*: boolean

   Use this option to disable certificate verification by setting this
   value to ``false``. This configuration is recommended only for
   testing purposes as it makes connections susceptible to man-in-the-middle
   attacks.

   .. code-block:: ini

      sslRequireValidMMSServerCertificates=true
