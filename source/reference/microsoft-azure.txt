.. _microsoft-azure:

===============
Microsoft Azure
===============

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

Synopsis
--------

|service| supports deploying clusters onto Microsoft Azure. This
page provides reference material related to |service| cluster deployments on
:abbr:`Azure (Microsoft Azure)`.

Depending on your instance size, |service| supports the following
:abbr:`Azure (Microsoft Azure)` regions:

.. list-table::
   :header-rows: 2
   :widths: 30 40 20 10

   * - 
     - 
     - M2/M5
     - M20+

   * - Azure Region
     - Location
     -
     - 

   * - ``centralus``
     - Iowa (Central US)
     - 
     - |checkmark|

   * - ``eastus``
     - Virginia (East US)
     - 
     - |checkmark|

   * - ``eastus2``
     - Virginia (East US)
     - |checkmark|
     - |checkmark|

   * - ``northcentralus``
     - Illinois (North Central US)
     - 
     - |checkmark|

   * - ``westus``
     - California (West US)
     - 
     - |checkmark|

   * - ``southcentralus``
     - Texas (South Central US)
     - 
     - |checkmark|

   * - ``northeurope``
     - Ireland (North Europe)
     - |checkmark|
     - |checkmark|

   * - ``westeurope``
     - Netherlands (West Europe)
     - 
     - |checkmark|

   * - ``westus2``
     - California (West US 2)
     - 
     - |checkmark|
     
   * - ``canadaeast``
     - Quebec City (Canada East)
     - 
     - |checkmark|

   * - ``canadacentral``
     - Toronto (Canada Central)
     - 
     - |checkmark|

   * - ``brazilsouth``
     - Sao Paulo (Brazil South)
     - 
     - |checkmark|

   * - ``australiaeast``
     - New South Wales (Australia East)
     - 
     - |checkmark|

   * - ``australiasoutheast``
     - Victoria (Australia Southeast)
     - 
     - |checkmark|

   * - ``uksouth``
     - London (UK South)
     - 
     - |checkmark|

   * - ``ukwest``
     - Cardiff (UK West)
     - 
     - |checkmark|

   * - ``centralindia``
     - Pune (Central India)
     - 
     - |checkmark|

   * - ``westindia``
     - Mumbai (West India)
     - 
     - |checkmark|

   * - ``southindia``
     - Chennai (South India)
     - 
     - |checkmark|

   * - ``eastasia``
     - Hong Kong (East Asia)
     - 
     - |checkmark|

   * - ``japaneast``
     - Tokyo (Japan East)
     - 
     - |checkmark|

   * - ``japanwest``
     - Osaka (Japan West)
     - 
     - |checkmark|

   * - ``southeastasia``
     - Singapore (Southeast Asia)
     - 
     - |checkmark|

   * - ``koreacentral``
     - Seoul (Korea Central)
     - 
     - |checkmark|

   * - ``koreasouth``
     - Busan (Korea South)
     - 
     - |checkmark|

.. |checkmark| unicode:: U+2713

.. _microsoft-azure-configuration-options:

Instance Configuration Options
------------------------------

Each |service| instance size comes with a default set of resources. |service|
provides the following resource configuration options:

Custom Storage Size
   The size of the server root volume. |service| clusters deployed onto
   :abbr:`Azure (Microsoft Azure)` use premium storage disks. 
   [#azure-disk-docs]_ |service| supports the following storage sizes:

   - ``32GB``
   - ``64GB``
   - ``128GB``
   - ``256GB``
   - ``512GB``
   - ``1024GB`` (``1TB``)
   - ``2048GB`` (``2TB``)
   - ``4095GB`` (~ ``4TB``)
   
   Workloads typically require less than ``2TB``.

|service| configures the following resources automatically and does not allow
user modification:

Storage Speed
   The input/output operations per second (IOPS) [#azure-disk-docs]_ the
   system can perform. This value is fixed based on the specified
   custom storage size.

Encrypted Storage Volumes
   :abbr:`Azure (Microsoft Azure)` storage volumes are
   `always encrypted 
   <https://azure.microsoft.com/en-us/blog/azure-managed-disks-sse/>`_.

.. _microsoft-azure-availability-zones:

Azure Fault Domains
-------------------

Each :abbr:`Azure (Microsoft Azure)` region includes a set number of fault
domains. Fault domains consist of a group of virtual machines that share a
common power source and network switch. For regions that have at least three
fault domains (3FD), |service| deploys clusters across three fault domains.
For regions that only have two fault domains (2FD), |service| deploys clusters
across two fault domains.

The |service| :doc:`Add New Cluster </create-new-cluster>` form marks regions
that support :abbr:`3FD (Three Fault Domain)` clusters as
:guilabel:`Recommended`, as they provide higher availability.

.. include:: /includes/extracts/fact-no-node-restriction-azure.rst

For general information on :abbr:`Azure (Microsoft Azure)` regions and fault 
domains, see `Manage the availability of Windows virtual machines in Azure
<https://docs.microsoft.com/en-us/azure/virtual-machines/windows/manage-availability>`_

Regions with at Least Three Fault Domains
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

If the selected :abbr:`Azure (Microsoft Azure)` region has at least three
fault domains, |service| clusters are split across three fault domains. For
example, a three node replica set cluster would have one node deployed onto
each zone.

.. include:: /images/microsoft-azure-3az.rst

:abbr:`3FD (Three Fault Domain)` clusters have higher availability
compared to :abbr:`2FD (Two Fault Domain)` clusters. However, not all
regions support :abbr:`3FD (Three Fault Domain)` clusters.


Regions with Only Two Fault Domains
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

If the selected :abbr:`Azure (Microsoft Azure)` region has two fault domains,
|service| clusters are split across the two fault domains. For example, a
three node replica set cluster would have two nodes deployed to one zone and
the remaining node deployed to the other zone.

.. include:: /images/microsoft-azure-2az.rst

:abbr:`2FD (Two Fault Domain)` clusters have a higher chance of loss of
availability in the event of the loss of an zone than :abbr:`3FD
(Three Fault Domain)` clusters. However, where latency or location are a
priority, a region that supports :abbr:`2FD (Two Fault Domain)` clusters
may be preferred.

.. [#azure-disk-docs]

   For detailed documentation on :abbr:`Azure (Microsoft Azure)` storage 
   options, see `High-performance Premium Storage and managed disks for VMs
   <https://docs.microsoft.com/en-us/azure/storage/storage-premium-storage>`_
