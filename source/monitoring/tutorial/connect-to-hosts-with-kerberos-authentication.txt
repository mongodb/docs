=============================================
Connect to Hosts with Kerberos Authentication
=============================================

.. admonition:: Enterprise Feature

   Only MongoDB Enterprise provides support for Kerberos.

Kerberos is a generic authentication protocol available in MongoDB
Enterprise after version 2.4. The |monitoring| agent can authenticate
to monitored hosts using Kerberos in addition to the default MongoDB
authentication protocol.

Install the :doc:`monitoring agent </monitoring/tutorial/set-up-mms>`
and all requirements before beginning to configure Kerberos.

Install Required Operating System Packages
------------------------------------------

Debian and Ubuntu Linux
~~~~~~~~~~~~~~~~~~~~~~~

Install the following required packages:

.. code-block:: sh

   sudo apt-get install krb5-user python-setuptools libkerb5-dev build-essential python-dev

Red Hat Enterprise, CentOS and Fedora Linux
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Install the following required packages:

.. code-block:: sh

   sudo yum install krb5-appl-clients.x86_64 python-setuptools gcc python-devel krb5-devel.x86_64

Install Python Requirements
---------------------------

.. code-block:: sh

   sudo easy_install pymongo kerberos

Configure Kerberos Environment
------------------------------

#. Create or configure the ``/etc/kerb5.conf`` file on the system to
   integrate this host into your Kerberos environment.

#. Ensure that the ``kinit`` binary is available at the
   ``/user/bin/kinit`` path.

Create Kerberos Principal and MongoDB User
------------------------------------------

#. Create or choose a Kerberos principal for the |monitoring| agent.

#. Generate a keytab for the Kerberos principal and copy it to the
   system where the monitoring agent runs.

   .. important:: Ensure that the user that will run the Monitoring
      agent is the same user that owns the keytab file.

#. Create a MongoDB user for the new Kerberos principal. See
   :doc:`/management/permissions` for more information about required
   authentication roles.

#. Edit the agent's ``settings.py`` file to inform the agent about the
   keytab and principal identifier. Set:

   - the ``krb5Principal`` to the name of the Kerberos principal.

     .. code-block:: python

        krb5Principal = <id>

   - Set the ``kerb5Keytab`` value to the complete absolute path of
     the keytab file:

     .. code-block:: python

        krb5Keytab = None
