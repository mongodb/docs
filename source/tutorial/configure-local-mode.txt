=======================================================
Configure Local Mode if Servers Have No Internet Access
=======================================================

.. default-domain:: mongodb

Overview
--------

If the servers that run your Automation Agents or Backup Daemons do not have
internet access, you must configure |onprem| to run in Local mode, and you
must manually provide the MongoDB binaries and :term:`version manifest
<version manifest>`. As MongoDB Inc. releases new versions, you must update
the binaries and manifest.

The Automation Agents require MongoDB binaries in order to install MongoDB on
new deployments and to change MongoDB versions on existing ones. The Backup
Daemons require the binaries in order to run the correct versions of
MongoDB for the databases being backed up.

In a default configuration, the agents and daemons access the binaries over
the internet from MongoDB Inc. The :setting:`Version Manifest Source` configuration
setting determines whether |onprem| runs in Internet mode or Local mode.

.. _versions-directory:

Versions Directory
~~~~~~~~~~~~~~~~~~

The versions directory on the |onprem| server(s) holds ``.tgz`` archive files
of the MongoDB binaries that the agents and daemons require in order to manage
and back up your deployments. You specify this directory in the
:setting:`Versions Directory` setting.

If you run in Local mode, you must manually download the binaries from MongoDB
Inc. and place them in this directory. The "mongodb-mms" user must have
permission to read the archives in this directory.

.. _version-manifest:

Version Manifest
~~~~~~~~~~~~~~~~

The MongoDB version manifest makes |onprem| aware of all released MongoDB
versions. In Local mode, the Automation Agents and Backup Daemons can deploy
versions for which archives exist in the :ref:`versions directory
<versions-directory>`. For a given |onprem| :term:`group`, the version must
also be selected in the group's :ref:`Version Manager <version-manager>`.

In Internet mode, |onprem| automatically updates the version manifest from
MongoDB, Inc. In Local mode, you must update the version manifest as MongoDB
releases new versions.

Required Access
---------------

To configure Local mode, you must have :ref:`Global Owner <global-owner-role>`
access to |onprem|.

Prerequisites
-------------

Before configuring |onprem| to run in Local mode, you must meet the
prerequisites described here.

.. _local-mode-determine-versions:

Determine Which Binaries to Store
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The :ref:`versions directory <versions-directory>` requires archives of
following versions of MongoDB:

- Versions that are used by existing deployments that you will import into |onprem|.

- Versions you will use to create new deployments through |onprem| Automation.

- Versions you will use during an intermediary step in an upgrade. For example,
  if you will import an existing deployment of MongoDB 2.6 Community and upgrade it
  to MongoDB 3.0 Community and then to MongoDB 3.0 Enterprise, you must include
  all those editions and versions.

- If you use both the MongoDB Community edition and the MongoDB Enterprise
  subscription edition, you must include the required versions of both.

The following table describes the archives required for specific versions:

.. list-table::
   :widths: 30 30 60
   :header-rows: 1

   * - Edition
     - Version
     - Archive
   * - Community
     - 2.6+, 2.4+
     - Linux archive at `<http://www.mongodb.org/downloads>`_.
   * - Community
     - 3.2+, 3.0+
     - Platform-specific archive available from `<http://www.mongodb.org/downloads>`_.
   * - Enterprise
     - 3.2+, 3.0+, 2.6+, 2.4+
     - Platform-specific archive available from `<http://mongodb.com/download>`_.

Download Binaries Before Importing a Deployment
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Populate the :ref:`versions directory <versions-directory>` with all required
MongoDB versions **before you import any existing MongoDB deployments** into
|onprem|. If a version is missing, the Automation Agent cannot take control of
the deployment.

Install Enterprise Dependencies (MongoDB Enterprise Only)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

If you will run :term:`MongoDB Enterprise` and use Linux servers, then you must
manually install a set of dependencies to each server **before installing MongoDB**.
The MongoDB manual provides the appropriate command to install the dependencies.
See the link for the server's operating system:

.. include:: /includes/list-links-per-os-for-enterprise-dependencies.rst

Procedure
---------

.. include:: /includes/steps/configure-local-mode.rst
