=========================================================
Configure "Local Mode" if Servers Have No Internet Access
=========================================================

.. default-domain:: mongodb

Overview
--------

If the servers that run your MongoDB deployments do not have internet
access, then you must configure |onprem| to run in "local" mode and
provide local access to MongoDB binaries.

The Automation Agents require access to MongoDB binaries in order to
install MongoDB on new deployments or change MongoDB versions on existing
ones. In a default configuration, the agents access the binaries over the
internet from MongoDB Inc. If you deploy MongoDB on servers that have no
internet access, you can run local mode and provide the Automation Agents
access to the binaries from a directory on the |application| server.

.. note::

   You can also configure offline binary access for the Backup Daemon,
   which is a separate set of steps. See the
   :ref:`mongodb.release.autoDownload <mongodb-release-autodownload>`
   setting.

Binaries Directory
~~~~~~~~~~~~~~~~~~

You specify the binaries directory in the :ref:`conf-mms.properties`
file and then place ``.tgz`` archives of the binaries in that directory.
The Automation Agents will use these archives for all MongoDB installs.
The "mongodb-mms" user must possess the permissions to read the ``.tgz``
files in the directory.

The following shows the ``ls -l`` output of the binaries directory for
an example |onprem| install that deploys only the versions of MongoDB
listed:

.. code-block:: sh

   $ cd /opt/mongodb/mms/mongodb-releases
   $ ls -l
   total 355032
   -rw-r----- 1 mongodb-mms staff 116513825 Apr 27 15:06 mongodb-linux-x86_64-2.6.9.tgz
   -rw-r----- 1 mongodb-mms staff  51163601 May 22 10:05 mongodb-linux-x86_64-amazon-3.0.3.tgz
   -rw-r----- 1 mongodb-mms staff  50972165 May 22 10:06 mongodb-linux-x86_64-suse11-3.0.3.tgz
   -rw-r----- 1 mongodb-mms staff  95800685 Apr 27 15:05 mongodb-linux-x86_64-enterprise-amzn64-2.6.9.tgz
   -rw-r----- 1 mongodb-mms staff  50594134 Apr 27 15:04 mongodb-linux-x86_64-enterprise-amzn64-3.0.2.tgz
   -rw-r----- 1 mongodb-mms staff  50438645 Apr 27 15:04 mongodb-linux-x86_64-enterprise-suse11-3.0.2.tgz

.. _version-manifest:

Version Manifest
~~~~~~~~~~~~~~~~

When you run in local mode, you provide |onprem| with the MongoDB version
manifest, which makes |onprem| aware of all released MongoDB versions. The
Automation Agents, however, can only deploy those versions available in
the binaries directory on the |application| server. Further, the agent for
a given group can only deploy an available version if that version is
selected for use in the group's Version Manager.

As MongoDB releases new versions, you must update the version manifest.

Prerequisites
-------------

Download Binaries Before Importing a Deployment
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Populate the binaries directory with all required MongoDB
versions **before you import a MongoDB deployment** into |onprem|.
If a version is missing, the
Automation Agents will not be able to take control of the deployment.

.. _local-mode-determine-versions:

Determine Which Binaries to Store
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Your binaries directory will require archives of following versions:

- versions used by existing deployments that you will import

- versions you will use to create new deployments

- versions you will use during an intermediary step in an upgrade. For
  example, if you will import an existing MongoDB 2.6 Community deployment
  and upgrade it first to MongoDB 3.0 Community and then to MongoDB 3.0
  Enterprise, you must include all those editions and versions.

If you use both the MongoDB Community edition and the MongoDB Enterprise
subscription edition, you must include the required versions of both.

The following table describes the archives required for specific versions:

.. list-table::
   :widths: 30 30 60
   :header-rows: 1

   * - Edition
     - Version
     - Archive
   * - Community
     - 2.6+, 2.4+
     - Linux archive at `<http://www.mongodb.org/downloads>`_.
   * - Community
     - 3.0+
     - Platform-specific archive available from `<http://www.mongodb.org/downloads>`_.
   * - Enterprise
     - 3.0+, 2.6+, 2.4+
     - Platform-specific archive available from `<http://mongodb.com/download>`_.

Install Dependencies (MongoDB Enterprise Only)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/extracts/fact-enterprise-dependencies-vanilla.rst

Required Access
---------------

You must have :ref:`Global Automation Admin
<global-automation-admin-role>` or :ref:`Global Owner <global-owner-role>`
access to perform this procedure.

Procedure
---------

.. include:: /includes/steps/configure-local-mode.rst
