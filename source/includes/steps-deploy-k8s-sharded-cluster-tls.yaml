---
title: "Copy the following example :term:`sharded cluster` |k8s| |k8s-obj| specification."
stepnum: 1
level: 4
ref: copy-k8s-example-tls-sc
content: |

   This is a |yaml| file that you can modify to meet your desired
   configuration. Change the highlighted settings to match your desired
   :term:`sharded cluster` configuration.

   .. literalinclude:: /reference/k8s/example-sharded-cluster-tls.yaml
      :language: yaml
      :emphasize-lines: 5-7,9-16,19-25

---
stepnum: 2
level: 4
ref: paste-k8s-example-tls-sc
source:
  file: steps-deploy-k8s-sharded-cluster.yaml
  ref: paste-k8s-example
---
title: "Configure the settings highlighted in the preceeding step as follows."
stepnum: 3
level: 4
ref: change-k8s-values-tls-sc
source:
  file: steps-deploy-k8s-sharded-cluster.yaml
  ref: change-k8s-values
---
title: "If you wish to enable TLS on your sharded cluster, add the TLS settings to the ConfigMap."
stepnum: 4
level: 4
ref: add-tls-settings-sc
source:
  file: steps-deploy-k8s-replica-set-tls.yaml
  ref: add-tls-settings
replacement:
  example: |
    The following example |k8s-configmap| configures a replica set to use
    |tls|:

    .. literalinclude:: /reference/k8s/example-sharded-cluster-tls.yaml
       :language: yaml
       :emphasize-lines: 19-25
---
title: "Add any additional accepted settings for a :term:`sharded cluster` deployment."
stepnum: 5
level: 4
ref: add-k8s-values-tls-sc
source:
  file: steps-deploy-k8s-sharded-cluster.yaml
  ref: add-k8s-values
---
stepnum: 6
level: 4
ref: save-object-spec-tls-sc
source:
  file: steps-deploy-k8s-sharded-cluster.yaml
  ref: save-object-spec
---
title: "Start your :term:`sharded cluster` deployment."
stepnum: 7
level: 4
ref: start-k8s-sharded-cluster-tls-sc
content: |

   Invoke the following |k8s| command to create your
   :term:`sharded cluster`:

   .. code-block:: sh

      kubectl apply -f <sharded-cluster-conf>.yaml

---
title: "Check the status of your deployment."
stepnum: 8
level: 4
ref: check-k8s-deployment-tls-sc
source:
  file: steps-deploy-k8s-replica-set-tls.yaml
  ref: check-k8s-deployment-tls-rs
---
title: "Approve the certificate for each host in your deployment."
stepnum: 9
level: 4
ref: approve-certificates-tls
content: |

  Approve the certificate for each config server using the following
  command:

  .. code-block:: sh

     kubectl certificate approve <metadata.name>-config-<member>.<namespace>

  Approve the certificate for each ``mongos`` using the following
  command:

  .. code-block:: sh

     kubectl certificate approve <metadata.name>-mongos-<member>.<namespace>

  Approve the certificate for each ``mongod`` host using the following
  command:

  .. code-block:: sh

     kubectl certificate approve <metadata.name>-mongod-<member>.<namespace>

  .. example::

     The following commands approve the certificates for the
     sharded cluster example in the previous step:

     .. code-block:: sh
        :copyable: false

        kubectl certificate approve my-secure-sc-config-0.my-namespace
        kubectl certificate approve my-secure-sc-config-1.my-namespace
        kubectl certificate approve my-secure-sc-config-2.my-namespace
        kubectl certificate approve my-secure-sc-mongos-0.my-namespace
        kubectl certificate approve my-secure-sc-mongos-1.my-namespace
        kubectl certificate approve my-secure-sc-0-0.my-namespace
        kubectl certificate approve my-secure-sc-0-1.my-namespace
        kubectl certificate approve my-secure-sc-0-2.my-namespace
        kubectl certificate approve my-secure-sc-1-0.my-namespace
        kubectl certificate approve my-secure-sc-1-1.my-namespace
        kubectl certificate approve my-secure-sc-1-2.my-namespace

  The |k8s-op-short| prints a message to the console when a certificate
  is approved.
---
title: "Track the status of your :term:`sharded cluster` deployment."
stepnum: 10
level: 4
ref: track-k8s-deployment-tls-sc
content: |

  .. include:: /includes/check-resource-status.rst

...
