title: "Login to |cloud|."
stepnum: 1
ref: login
edition:
  - cloud
---
title: "Login to |onprem|."
stepnum: 1
ref: login
edition:
  - onprem
---
title: "Begin or Manage a Deployment"
stepnum: 2
ref: begin-deployment
content: |

  When you reach the :guilabel:`Install an Automation Agent on each
  server` page, all hosts are listed.

  a. Click on the :guilabel:`Install Agent` menu of the first MongoDB
     host.

  b. Select :guilabel:`Windows - MSI`.
---
title: "Download the Automation Agent."
stepnum: 3
ref: download-automation-agent
content: |

  The :guilabel:`Automation Agent Installation Instructions` box
  displays the following information:

  .. only:: onprem

     - Base URL (Required for either binding to a project or adding the
       host to a server pool)

       .. include:: /includes/fact-server-pools-deprecated.rst

  - Project ID (Required for binding to a project)

  - :guilabel:`+ Generate Key` button to generate an Agent API Key
    (Required for binding to a project).

    .. include:: /includes/extracts/agent-api-key-generate-note.rst

    .. include:: /includes/extracts/agent-api-key-reuse.rst

    .. include:: /includes/extracts/agent-api-key-admonition.rst

  Some or all of these values are required in a later step, so keep
  this box open.

---
title: "Install the Automation Agent."
stepnum: 4
ref: install-automation-agent
content: |

  .. tabs::

     tabs:
       - id: interactive
         name: Interactive
         content: |

           a. After the ``MSI`` downloads, double-click
              :file:`mongodb-mms-automation-agent-<version>.windows_x86_64.msi`

           #. If a security warning appears, click :guilabel:`Run`.

           #. At the :guilabel:`Configuration/Log Folder` step

              Provide the directory into which these files are saved.

           #. At the :guilabel:`Key Type` step, select:

              .. cond:: onprem

                 - :guilabel:`Agent API Key` to bind to a specific
                   :term:`project` or
                 - :guilabel:`Server Pool Key` to add the host to a
                   :term:`server pool`.

              .. cond:: cloud

                 :guilabel:`Agent API Key` to bind to a specific
                 :term:`project`.

           #. Enter the appropriate agent keys.

              .. note::

                 These keys are provided in the :guilabel:`Automation
                 Agent Installation Instructions` modal described in
                 the previous step.

              .. cond:: onprem

                 If you selected :guilabel:`Agent API Key`, type the:

                 - :guilabel:`Base URL`
                 - :guilabel:`Project ID`
                 - :guilabel:`Agent API Key`

                 If you selected :guilabel:`Server Pool Key`, type the:

                 - :guilabel:`Base URL`
                 - :guilabel:`Project ID`
                 - :guilabel:`Server Pool Key`.

                 .. include:: /includes/extracts/server-pool-key-location.rst

              .. cond:: cloud

                 - Type your Project ID into the :guilabel:`Project ID`
                   box.

                 - Type your Agent API Key into the
                   :guilabel:`Agent API Key` box.

           #. At the :guilabel:`Automation Paths` step, specify the Log
              and Backup directories

           #. At the :guilabel:`Windows Firewall Configuration` step,
              click your preferred firewall configuration.

              If you click :guilabel:`Configure firewall rules allowing
              access from only the specified |ipaddr| addresses.`, type
              the necessary |ipv4| addresses into the provided box.

           #. (Conditional) Windows enables `Stealth Mode <https://technet.microsoft.com/en-us/library/dd448557(v=ws.10).aspx>`__
              for the Windows Firewall by default. If you have not
              disabled it on the MongoDB host on which you are
              installing the Automation Agent, you are asked to disable
              it. Stealth Mode significantly degrades the performance
              and capability of the :term:`Automation Agent`. Click
              :guilabel:`Disable Stealth Mode`.

           #. (Conditional) Windows does not enable `Disk Performance Counters <https://blogs.technet.microsoft.com/askcore/2012/03/16/windows-performance-monitor-disk-counters-explained/>`__
              by default. If you have not enabled Disk Performance
              Counters for the MongoDB host, click :guilabel:`Enable
              Disk Performance Counters`. The :term:`Automation Agent`
              uses these counters for some of its hardware monitoring
              activities.

           #. Click :guilabel:`Install`.

           #. Click :guilabel:`Finish` once setup is complete.

       - id: unattended
         name: Unattended
         content: |
           
           After the ``MSI`` downloads, you can run an unattended
           install. You run an unattended install from the command line
           in either the command interpreter or PowerShell. To learn
           more about unattended installs, see Microsoft's
           documentation on `Standard Installer Command-Line Options
           <https://docs.microsoft.com/en-us/windows/desktop/msi/standard-installer-command-line-options>`__

           To run the ``MSI`` installer unattended from the command
           line, you invoke ``msiexec.exe`` with the ``/q`` and ``/i``
           flags and a combination of required and optional
           parameters:

           .. cond:: cloud

              .. list-table::
                 :widths: 20 15 65
                 :header-rows: 1

                 * - Parameter
                   - Necessity
                   - Value

                 * - ``MMSAPIKEY``
                   - Required
                   - Agent |api| key of your |mms| project.
                 * - ``MMSGROUPID``
                   - Required
                   - Unique Identifier of your |mms| project. 
                 * - ``CONFIGLOGDIR``
                   - Optional
                   - Absolute file path to which |mms| should write the
                     Automation Agent configuration file.
                 * - ``LOGFILE``
                   - Optional
                   - Absolute file path to which |mms| should write the
                     Automation Agent log
                 * - ``MMSCONFIGBACKUP``
                   - Optional
                   - Absolute file path to the |mms| automation
                     configuration backup |json| file.

           .. cond:: onprem

              .. list-table::
                 :widths: 20 15 65
                 :header-rows: 1

                 * - Parameter
                   - Necessity
                   - Value

                 * - ``MMSAPIKEY``
                   - Required
                   - Agent |api| key of your |mms| project.
                 * - ``MMSBASEURL``
                   - Required
                   - |url| of the |mms| host.
                 * - ``MMSGROUPID``
                   - Required
                   - Unique Identifier of your |mms| project.
                 * - ``CONFIGLOGDIR``
                   - Optional
                   - Absolute file path to which |mms| should write the
                     Automation Agent configuration file.
                 * - ``LOGFILE``
                   - Optional
                   - Absolute file path to which |mms| should write the
                     Automation Agent log
                 * - ``MMSCONFIGBACKUP``
                   - Optional
                   - Absolute file path to the |mms| automation
                     configuration backup |json| file.

           .. example::

              To install the Automation Agent unattended, you would invoke ``msiexec.exe`` with the following options:

              .. code-block:: powershell

                 msiexec.exe /q /i "C:\PATH\TO\mongodb-mms-automation-agent-<VERSION>.windows_x86_64.msi" MMSGROUPID=<GROUP.ID> MMSAPIKEY=<AGENT.API.ID> MMSBASEURL="<http://opsmanager.example.com:8080>" LOGFILE="C:\MMSData\Server\Log\automation-agent.log" MMSCONFIGBACKUP="C:\MMSData\Automation\mms-cluster-config-backup.json"

---
title: "Verify the Automation Agent is running."
stepnum: 5
ref: verify-automation-agent
content: |

  The :term:`Automation Agent` starts automatically after installation.
  This step verifies that it is running and can communicate with |mms|.

---
title: "(Optional) Change the location of the Automation Agent binaries and configuration backup files."
stepnum: 6
ref: change-binary-directory
pre: |

   By default, the MongoDB binaries and |mms|
   configuration backup file are located in
   ``%SystemDrive%\MMSAutomation\versions``.

   .. note::
      Windows sets the ``%SystemDrive%`` environment variable to the
      drive on which you installed Windows. By default, you would be
      directed to install Windows on the ``C:`` drive. To find your
      ``%SystemDrive%``, issue with following command from `PowerShell
      <https://msdn.microsoft.com /en-us/powershell/>`__:

      .. code-block:: ps1

         get-childitem env:SystemDrive

   If you want to store these files in a different directory, follow
   these procedures:

action:
  - heading: "To change the location of the Automation Agent Binaries:"
    pre: |

      a. Click :guilabel:`Deployment`; :guilabel:`Agents`; and then
         :guilabel:`Downloads & Settings`.

      #. Below the :guilabel:`Download Directory` heading, click the
         pencil icon to the right of the path shown in
         :guilabel:`Download Directory (Windows)`.

      #. Change the path to the new path you want.

      #. Click :guilabel:`Save`.

      #. Create the new directory you specified on each host that runs
         an Automation Agent. Use Windows Explorer to move the file or
         issue the following command from a Command Prompt or
         `PowerShell <https://msdn.microsoft.com/en-us/powershell/>`__:

         .. code-block:: ps1

              md \<newPath>

         .. important::

            Make sure the system user that runs the Automation Agent
            can write to this new directory. This is usually the
            ``SYSTEM`` user, which requires no additional configuration
            unless you changed the user.

  - heading: "To change the location of the Automation Agent configuration backup:"
    pre: |

      a. Open the :ref:`Automation Agent configuration file
         <automation-agent-config-file-location>` in your preferred text
         editor.

      #. Change the :asetting:`mmsConfigBackup` setting to the new path
         for the configuration backup file. Replace ``X`` with the drive
         letter on which your backup is stored.

         .. code-block:: ini
            :class: copyable-code

            mmsConfigBackup=X:\<newPath>\mms-cluster-config-backup.json

      #. Save the :term:`Automation Agent` configuration file.

      #. Move the configuration backup file to the new directory. Use
         Windows Explorer to move the file or issue the following
         command from a Command Prompt or `PowerShell <https://msdn.microsoft.com/en-us/powershell/>`__:

         .. code-block:: ps1
            :class: copyable-code

            move %SystemDrive%\MMSAutomation\versions\mms-cluster-config-backup.json \<newPath>

---
title: "Repeat installation procedure for each MongoDB host."
stepnum: 7
ref: repeat
...
