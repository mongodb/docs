===================================
Restore a Replica Set from a Backup
===================================

.. default-domain:: mongodb

Overview
--------

When you restore a replica set from backup, |mms| provides you with a
restore file for the selected restore point. For an overview of the
restore process, please see :doc:`/core/restore-overview`.

Prerequisites
-------------

Oplog Size
++++++++++

To seed each replica set member, you will use the :file:`seedSecondary.sh`
or :file:`seedSecondary.bat` script included in the backup restore file. 
When you run the script, you
will provide the replica set's oplog size, in gigabytes. If you do not
have the size, see the section titled "Check the Size of the Oplog" on the
:manual:`Troubleshoot Replica Sets </tutorial/troubleshoot-replica-sets>`
page of the MongoDB manual.

Client Requests During Restoration
++++++++++++++++++++++++++++++++++

.. include:: /includes/considerations-restore-in-isolation.rst

SCP Delivery
++++++++++++

If you intend to use the ``SCP`` delivery method, you must :doc:`generate
a key pair </tutorial/generate-key-pair-for-scp-restores>` ahead of time.
Windows machines do not come with ``SCP`` and require additional setup
outside the scope of this manual.

Procedures
----------

Perform the following procedures in sequence. If you choose to have |mms|
automatically restore your snapshot, you will perform only the first few
steps of the first procedure, at which point you will be instructed to
skip the rest of the steps and procedures.

If you choose to manually restore the backup, perform all the procedures
below, in sequence. You will select the snapshot, distribute the restore
file to each server, restore the :term:`primary`, and then restore the
:term:`secondaries <secondary>`. If you restore to existing hardware, use
a different data directory than used previously. For alternative
approaches to restoring replica sets, see the procedure from the MongoDB
Manual to :manual:`Restore a Replica Set from a Backup
</tutorial/restore-replica-set-from-backup>`.

Select the Snapshot
+++++++++++++++++++

.. include:: /includes/steps/download-snapshot-replica-set.rst

Restore the Primary
+++++++++++++++++++

You must have a copy of the snapshot on the server that provides the
primary:

.. include:: /includes/steps/restore-primary.rst

Restore Each Secondary
++++++++++++++++++++++

After you have restored the primary you can restore all
secondaries. You must have a copy of the snapshot on all servers that
provide the secondaries:

.. include:: /includes/steps/restore-secondary.rst
