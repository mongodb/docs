---
stepnum: 1
ref: configure-okta-idp-add-app
title: Add a new application to your Okta account
content: |
  a. In the Okta top navigation, click the :guilabel:`Applications`
     tab.

  #. Click the :guilabel:`Add Application` button.

  #. Click the :guilabel:`Create New App` button.

  #. Select :guilabel:`Web` for the :guilabel:`Platform` field.

  #. Select :guilabel:`SAML 2.0` for the :guilabel:`Sign on method`
     field.

  #. Click the :guilabel:`Create` button.

---
stepnum: 2
ref: configure-okta-idp-create-saml
title: Create Okta SAML integration
content: |
  a. Fill in the :guilabel:`App name` text field with your desired
     application name.

  #. Optionally, add a logo image and set app visibility.

  #. Click the :guilabel:`Next` button.
---
stepnum: 3
ref: configure-okta-idp-download-cert
title: Download Okta certificate
content: |
  a. Click the :guilabel:`Download Okta Certificate` button.

  #. Rename the downloaded file to have a ``.cer`` extension instead of
     ``.cert``.
---
stepnum: 4
ref: configure-okta-idp-nav-to-fmc
title: Navigate to the Federation Management Console
inherit:
  file: steps-source-fed-auth-management.yaml
  ref: navigate-to-fmc
---
stepnum: 5
ref: configure-okta-idp-new-idp
title: Create a new Identity Provider
content: |
  a. In the |fmc| dashboard, click the
     :guilabel:`Manage Identity Providers` button.

  #. Click the :guilabel:`Setup Identity Provider` button.
---
stepnum: 6
ref: configure-okta-idp-saml-settings
title: Enter SAML settings
content: |

  a. In the FMC dashboard, fill in the data fields with the following
     values:

     .. list-table::
        :widths: 20 40
        :header-rows: 1

        * - Field
          - Value

        * - :guilabel:`Configuration Name`
          - A descriptive name of your choosing.

        * - :guilabel:`Issuer URI` and :guilabel:`Single Sign-On URL`
          - Click the :guilabel:`Fill With Placeholder Values` button to the
            right of the text fields. You will get the real values from Okta
            in a later step.

        * - :guilabel:`Identity Provider Signature Certificate`
          - Provide the ``.cer`` file you received from Okta 
            earlier.

            You can either:

            - Upload the certificate from your computer, or
   
            - Paste the contents of the certificate into a text box.

        * - :guilabel:`Request Binding`
          - :guilabel:`HTTP POST`

        * - :guilabel:`Response Signature Algorithm`
          - :guilabel:`SHA-256`

  #. Click the :guilabel:`Next` button.
---
stepnum: 7
ref: configure-okta-idp-saml-integration
title: Create SAML Integration
content: |
  a. In this step, copy values from the |service| |fmc| to the Okta :guilabel:`Create SAML Integration` page.

     .. list-table::
        :widths: 20 40
        :header-rows: 1

        * - Okta Data Field
          - Value

        * - :guilabel:`Single sign on URL`
          - Use the :guilabel:`Assertion Consumer Service URL` from the
            |service| FMC.

            Checkboxes:

            - Check :guilabel:`Use this for Recipient URL and Destination URL`.
            - Clear :guilabel:`Allow this app to request other SSO URLs`.

        * - :guilabel:`Audience URI (SP Entity ID)`
          - Use the :guilabel:`Audience URI` from the |service| FMC.

        * - :guilabel:`Default RelayState`
          - .. include:: /includes/optional-idp-relay-state-step.rst

        * - :guilabel:`Name ID format`
          - Unspecified

        * - :guilabel:`Application username`
          - Email

        * - :guilabel:`Update application username on`
          - Create and update

  #. Click the :guilabel:`Click Show Advanced Settings` link in the
     Okta configuration page and ensure that the following values are
     set:

     .. list-table::
        :widths: 20 40
        :header-rows: 1

        * - Okta Data Field
          - Value

        * - :guilabel:`Response`
          - Signed

        * - :guilabel:`Assertion Signature`
          - Signed

        * - :guilabel:`Signature Algorithm`
          - RSA-SHA256

        * - :guilabel:`Digest Algorithm`
          - SHA256

        * - :guilabel:`Assertion Encryption`
          - Unencrypted

  #. Leave the remaining :guilabel:`Advanced Settings` fields in their
     default state.

  #. Scroll down to the :guilabel:`Attribute Statements (optional)`
     section and create four attributes with the following values:

     .. list-table::
        :widths: 20 40 40
        :header-rows: 1

        * - Name
          - Name Format
          - Value

        * - firstName
          - Unspecified
          - user.firstName

        * - lastName
          - Unspecified
          - user.lastName

     .. important::

        The values in the **Name** column are case-sensitive. Enter
        them exactly as shown.

     .. note::

        These values may be different if Okta is connected to an Active
        Directory. For the appropriate values, use the Active Directory
        fields that contain a user's first name, last name, and full
        email address.

  #. (Optional) If you plan to use :doc:`role mapping 
     </security/manage-role-mapping/>`, scroll down to the 
     :guilabel:`Group Attribute Statements (optional)` section 
     and create an attribute with the following values:

     .. list-table::
        :widths: 25 25 25 25
        :header-rows: 1
        
        * - Name
          - Name Format
          - Filter
          - Value

        * - memberOf
          - Unspecified
          - Matches regex
          - ``.*``

     This filter matches all group names associated with the user. 
     To filter the group names sent to Atlas further, 
     adjust the :guilabel:`Filter` and :guilabel:`Value` fields.

  #. Click the :guilabel:`Next` button in the Okta configuration.

  #. Select the radio button marked :guilabel:`I'm an Okta customer
     adding an internal app`.

  #. Click the :guilabel:`Finish` button.
---
stepnum: 8
ref: configure-okta-idp-configure-fmc
title: Copy information back to the |service| FMC
content: |

  a. On the Okta application page, click
     :guilabel:`View Setup Instructions`
     in the middle of the page.

     .. note::

        The Okta setup instructions appear in a new browser tab.

  #. In the |service| |fmc|, click the :guilabel:`Finish` button to
     return to the :guilabel:`Identity Providers` page. Click the
     :guilabel:`Modify` button for your newly created |idp|.

  #. Fill in the following text fields:

     .. list-table::
        :widths: 20 40
        :header-rows: 1

        * - FMC Data Field
          - Value

        * - :guilabel:`Issuer URI`
          - Use the :guilabel:`Identity Provider Issuer` value from
            the Okta Setup Instructions page.

        * - :guilabel:`Single Sign-on URL`
          - Use the :guilabel:`Identity Provider Single Sign-On URL`
            value from the Okta Setup Instructions page.

  #. Close the Okta setup instructions browser tab.

  #. Click the :guilabel:`Next` button on the |service| FMC page.

  #. Click the :guilabel:`Finish` button the FMC
     :guilabel:`Edit Identity Provider` page.
---
stepnum: 9
ref: configure-okta-idp-assign-users
title: Assign users to your Okta application
content: |
  a. On the Okta application page, click the :guilabel:`Assignments`
     tab.

  #. Ensure that all your |service| organization users who will use the
     Okta service are enrolled.
...
