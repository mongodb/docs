=====================
Installation Overview
=====================

.. default-domain:: mongodb

.. _installation-sequence:

Installation Sequence
---------------------

To install |onprem| you must provision servers, install backing MongoDB
replica sets, and install the |onprem| packages. The :doc:`Basic Production
Installation </tutorial/install-basic-deployment>` describes the full
sequence for an installation that uses three RHEL or Amazon Linux servers.
For all other configurations or operating systems, follow this sequence:

.. include:: /includes/steps/installation-sequence.rst

.. _deployment-diagrams:

|onprem| Example Deployments
----------------------------

The following diagrams show example |onprem| deployments:

.. _on-prem-minimal-deployment-diagram:

Testing Deployment
~~~~~~~~~~~~~~~~~~

.. include:: /images/mms-onprem-test.rst

For a test deployment, you can deploy all of the |onprem|
components to a single server. Ensure you :ref:`configure
the appropriate ulimits <onprem-config-ulimits>` for the deployment.

The ``HEAD DB`` databases are dynamically created and maintained
by the Backup Daemon. They reside on the disk partition specified
in the ``conf-daemon.properties`` file.

Basic Deployment
~~~~~~~~~~~~~~~~

.. include:: /images/mms-onprem-medium.rst

**Server 1** must satisfy the combined hardware and software
requirements for the |application| hardware and |application|
database hardware.

**Server 2** must satisfy the combined hardware and software
requirements for the Backup Daemon hardware and Backup Blockstore
database hardware. The Backup Daemon automatically creates and
maintains the ``HEAD DB`` databases. These databases reside on the
disk partition specified in the ``conf-daemon.properties`` file.
Do not place the ``HEAD DB`` databases on the same disk partition
as the Backup Blockstore database, as this will reduce |backup|'s
performance.

**Server 3** hosts replica set members for the Backup Blockstore and
|application| databases. Replica sets provide data redundancy and
are strongly recommended, but are not required for |onprem|.
Server 3 must satisfy the combined hardware and software
requirements for the |application| database hardware and Backup
Blockstore database hardware.

See: :doc:`/tutorial/install-basic-deployment` for a complete guide to
deploying a basic |onprem| installation.

Advanced Deployment
~~~~~~~~~~~~~~~~~~~

.. include:: /images/mms-onprem-large.rst

An |onprem| deployment with high availability and data redundancy
includes two servers that host the |application| and |application|
databases, four servers that host two |backup| deployments, and an
additional server to host the :term:`arbiters <arbiter>` for each
replica set.

Deploy an HTTP Load Balancer to balance the HTTP traffic for the
|http-service| and Backup service. |onprem| does not supply
an HTTP Load Balancer: you must deploy and configure it yourself.

All of the software services need to be able to communicate with
the |application| databases, and the Backup Blockstore databases.
Configure your firewalls to allow traffic between these servers
on the :doc:`appropriate ports </reference/firewall-configuration>`.

- **Server 1** and **Server 2** must satisfy the combined hardware
  and software requirements for the |application| hardware and
  |application| database hardware.

- **Server 3**, **Server 4**, **Server 5**, and **Server 6** must
  satisfy the combined hardware and software requirements for the
  Backup Daemon hardware and Backup Blockstore database hardware.

  The Backup Daemon creates and maintains the ``HEAD DB`` databases. They
  reside on the disk partition specified in the
  ``conf-daemon.properties`` file. Only the Backup Daemon needs to
  communicate with the ``HEAD DB`` databases. As such, their :option:`net.bindIp` value
  is``127.0.0.1`` to prevent external communication.
  :option:`net.bindIp` specifies the IP address that
  :program:`mongod` and :program:`mongos` listens to for connections
  coming from applications.

  For best performance, each Backup server should have 2 partitions. One
  for the Backup Blockstore database, and one for the ``HEAD DB``
  databases.

- **Server 7** simply hosts the :term:`arbiters <arbiter>`.
  Arbiters have minimal resource requirements, but must be
  able to communicate with the |application| and Backup
  Blockstore replica set members. **Do not** deploy the arbiters
  on the same system as a member of their replica set.

See: :doc:`/tutorial/configure-application-high-availability` for
a more about deploying |onprem| for high availability.
