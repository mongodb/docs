.. This page is hidden from the TOC and from Google/Marian search indexing.

:orphan:

.. meta::
   :robots: noindex, nosnippet

.. _facet-tutorial:

============================
How to use Facets with |fts| 
============================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

This tutorial describes how to create an index with a :ref:`facet 
definition <fts-facet-definition>` on string, date, and numeric fields 
in the ``sample_mflix.movies`` collection. It shows how to run an |fts| 
query against those fields for results grouped by values for the string 
field and by ranges for the date and numeric fields, including the 
count for each of those groups. It takes you through the following 
steps: 

1. Set up an |fts| index with facet definition on the ``genres``, 
   ``released``, and ``year`` fields in the ``sample_mflix.movies`` 
   collection.
#. Run |fts| query against the ``released`` field in the 
   ``sample_mflix.movies`` collection for results grouped by values for 
   the ``genres`` field and by ranges for the ``year`` field.

Prerequisites 
-------------

To complete these tutorials, you must have the following: 

- An |service| cluster running MongoDB v4.4 or higher. 
- The :doc:`sample datasets </sample-data>` loaded into your |service| 
  cluster. You will use a collection with movie data from the |service| 
  sample dataset.
- {+mongosh+} on your local machine.
- The ``enableSearchMeta`` flag enabled for your v4.4 cluster and 
  ``featureFlagSearchMeta`` flag enabled for v5.0.0 or higher cluster. 
  To verify that the flag is set on your cluster, connect to your 
  cluster and run the following command:

  - For cluster running MongoDB v4.4:

    .. code-block:: shell 

       db.adminCommand( { getParameter : 1, "enableSearchMeta" : 1 } )
     
  - For cluster running MongoDB v5.0.0 or higher:

    .. code-block:: shell 

       db.adminCommand( { getParameter : 1, "featureFlagSearchMeta" : 1 } )

Create the |fts| Index for Facet 
--------------------------------

In this section, you will create an |fts| index on the ``genres``, 
``year``, and ``released`` fields in the ``sample_mflix.movies`` 
collection. 

.. include:: /includes/steps/fts-facet-tutorial-create-index.rst

Search the Collection 
---------------------

You can use :ref:`fts-facet-ref` in queries that use the 
:pipeline:`$search` and :pipeline:`$searchMeta` stages. In this 
section, connect to your |service| cluster and the run the sample query 
against the ``sample_mflix.movies`` collection using the 
:pipeline:`$searchMeta` stage. MongoDB recommends using the 
:pipeline:`$searchMeta` stage to retrieve metadata results only.

.. include:: /includes/steps/fts-facet-tutorial-search-coll.rst
