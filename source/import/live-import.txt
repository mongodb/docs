.. _live-import-replica:

============================================
Live Migrate (Pull) a Replica Set into Atlas
============================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. include:: /includes/serverless-preview-dont-use.rst

|service| can pull a source replica set to an |service| cluster using the
live migration process. |service| keeps the target cluster in sync with
the remote source cluster until you cut your applications over to the
target |service| cluster.

Once you reach the cutover step in the following procedure, stop
writes to the source cluster: stop your application instances,
point them to the |service| cluster, and restart them.

Restrictions
------------

You can't select an ``M0`` (Free Tier) or ``M2/M5`` shared cluster as the
source or target for live migration. To migrate data from an
``M0`` (Free Tier) or ``M2/M5`` shared cluster to a paid cluster,
:doc:`change the cluster tier and type </scale-cluster>`.

- Live migration does not support :ref:`VPC peering <vpc-peering>` or
  :ref:`private endpoints <private-endpoint>` for either the source or
  target cluster.

To live migrate a sharded cluster, see
:doc:`Live Migrate (Pull) a Sharded Cluster into Atlas </import/live-import-sharded>`.

Prerequisites
-------------

- Provide the hostname of the :term:`primary` node to the live migration
  service.
- If the cluster runs with authentication, grant the user that will run
  the migration process the following permissions:

  - Read all databases and collecions on the host.
  - Read access to the primary node's :term:`oplog`.

To learn more :ref:`live-import-security`.

.. include:: /includes/note-source-cluster-readiness.rst

.. _live-import-upgrade-path:

Migration Path
~~~~~~~~~~~~~~

|service| live migration (pull) supports the following migration paths:

.. include:: /includes/list-tables/mongomirror-upgrade-path.rst

.. important::

   If you are migrating from a MongoDB 3.6 cluster, update
   and test your applications in context of the target |service|
   cluster.

.. _live-import-ip-access-list:

.. include:: /includes/import/network-access.rst

.. _live-import-migration-validation:

Pre-Migration Validation
~~~~~~~~~~~~~~~~~~~~~~~~

Before starting the pull live migration procedure, |service| runs validation
checks on the source and target clusters.

- The source cluster is a replica set.

  If the source cluster is a standalone,
  :manual:`convert the standalone to a replica set first </tutorial/convert-standalone-to-replica-set>`
  before using the :doc:`pull-type live migration </import/live-import>`.

- The target |service| cluster is a replica set.

.. note::
   Unlike for :ref:`sharded clusters <live-import-sharded-migration-validation>`,
   live migrating your replica set to |service| does not require that
   |service| has connectivity to the hostname and port of each node in the source
   cluster. To run the migration process, |service| automatically
   discovers the hostnames for the replica set based on the hostname you
   provide. If this fails, |service| migrates the replica set using
   your provided reachable hostname. To learn more, see :ref:`Network Access <live-import-ip-access-list>`.

.. _live-import-security:

Source Cluster Security
~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/source-cluster-security.rst

If the source cluster uses a different authentication mechanism to 
connect, you can use :doc:`mongomirror </import/mongomirror>` to 
migrate data from the source cluster to the target |service| cluster.

.. include:: /includes/fact-failIndexKeyTooLong-import.rst

Considerations
--------------

.. include:: /includes/fact-network-encryption-pull-migration.rst


Target Cluster Configuration
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

When configuring the target cluster, consider the following:

.. include:: /includes/fact-live-migration-destination-cluster.rst

.. include:: /includes/fact-live-migration-perf-target-cluster.rst

- The target |service| cluster must be a replica set.

- You can't select an ``M0`` (Free Tier) or ``M2/M5`` shared-tier
  cluster as the target cluster for live migration.

- Do **not** change the ``featureCompatibilityVersion`` flag while
  |service| live migration is running.

Database Users and Roles
~~~~~~~~~~~~~~~~~~~~~~~~

|service| doesn't migrate any user or role data to the target cluster.

If the source cluster enforced authentication, you must re-create the
credentials used by your applications on the target |service| cluster.
|service| uses :ref:`SCRAM <authentication-scram>` for user authentication.
To learn more, see :doc:`/security-add-mongodb-users`.

Avoid Namespace Changes
~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/fact-mongomirror-namespace-changes.rst

Avoid Elections
~~~~~~~~~~~~~~~

.. include:: /includes/fact-avoid-elections.rst

Rolling Restarts
~~~~~~~~~~~~~~~~

.. include:: /includes/live-import-rolling-restarts.rst

Migrate Your Cluster
--------------------

.. note:: Staging and Production Migrations

   Consider running this procedure twice. Run a partial migration
   that stops at the :guilabel:`Perform the Cutover` step *first*. This
   creates an up-to-date |service|-backed staging cluster to test
   application behavior and performance using the latest
   :driver:`driver version </driver-compatibility-reference>` that
   supports the MongoDB version of the |service| cluster.

   After you test your application, run the full migration
   procedure using a separate |service| cluster to create your
   |service|-backed production environment.

.. important::

   Avoid making changes to the source cluster configuration while the
   live migration process runs, such as removing replica set members
   or modifying :binary:`mongod <bin.mongod>` runtime settings, such as
   ``featureCompatibilityVersion``.

.. include:: /includes/pre-migration-checklist.rst

Procedure
~~~~~~~~~

.. include:: /includes/steps/atlas-live-import.rst

.. _live-migration-support:

.. include:: /includes/live-migration-support.rst
