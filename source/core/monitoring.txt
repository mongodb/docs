.. _monitoring-architecture:

==========
Monitoring
==========

.. default-domain:: mongodb

Architecture
------------

.. include:: /includes/fact-host-for-monitoring-agent.rst

Agent Redundancy
----------------

Only one Monitoring agent per group or environment will report to |monitoring|
at a time. If your monitoring agent can connect to all hosts in your
deployment, a single monitoring agent is sufficient and strongly recommended.
Multiple agents can cause unexpected problems.

However, you can run a second instance of the
agent to provide redundancy as a hot standby. To install secondary
agents, simply repeat the installation process in the
:doc:`installation guide </monitoring/install>` for each hot standby
agent.

Stopping Agents
---------------

If you stop the agent process, |monitoring| removes the agent from the
:guilabel:`Agents` tab within a day. If a Monitoring agent is unavailable, the
last ping times for that agent do not update.

Collection Interval
-------------------

When the Monitoring agent restarts, there is a five minute delay
before that agent begins collecting data sending pings to
|monitoring|. If you have multiple agents, this delay permits other
agents in your infrastructure to become the primary agent and for
|monitoring| to determine which agent will be primary.

During this interval, the restarted Monitoring agent will not
collect data.

.. TODO copied over from tutorial -- but we actually have
   /reference/authentication.txt  which covers access control
   for monitoring

Access Control
-------------

.. _authentication-privileges:

Additional Considerations for MongoDB 2.4 Nodes
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

If you are monitoring a MongoDB 2.4 instance with
authentication enabled, you must have elevated privileges
to collect complete performance data. At a minimum, the user will need
to possess:

- the ``clusterAdmin`` role, **and**

- the ``readAnyDatabase`` role.

If MMS is running with :ref:`DB Profiling <db-stats-warning>` enabled,
the user requires additional permissions. In addition to the
``clusterAdmin`` and ``readAnyDatabase`` roles, the user must possess
**either**:

- the ``dbAdminAnyDatabase role``, **or**

- the ``dbAdmin`` role on the specific databases being profiled.

However, if you do not have DB Profiling enabled *and* you are not
collecting :dbcommand:`dbStats` data, the agent only needs permissions
provided by the ``clusterAdmin`` role.

.. seealso:: `User Privilege Roles in MongoDB
   <http://docs.mongodb.org/manual/reference/built-in-roles/>`_.
