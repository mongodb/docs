.. _configure-alerts:

========================
Configure Alert Settings
========================

.. meta::
   :description: Manage alert configurations in Ops Manager by creating, modifying, or deleting alert settings and choosing notification methods for specific projects.

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

Overview
--------

.. include:: /includes/extracts/manage-alert-configurations-overview.rst

Considerations
--------------

.. _sms-delivery-considerations:

SMS Delivery
~~~~~~~~~~~~

Many factors may affect alert delivery, including do not call lists,
caps for messages sent or delivered, delivery time of day, and message
caching.

Check with your telephone service contract for the costs associated
with receiving text messages.

If you choose SMS, |mms| sends alert text messages to all users in the
project who have a mobile number associated with their user account.

Alert Intervals
~~~~~~~~~~~~~~~

You can create multiple alert configurations with different
frequencies. The minimum frequency for an alert is 5 minutes.

The time between re-notifications increases by the frequency amount
every alert cycle up to a maximum of 24 hours. For example, if the
frequency amount is 5 minutes, and the alert condition is first
triggered at 9am, subsequent alerts occur at 9:05am, 9:15am, 9:30am,
etc.

You can set the time to elapse before |mms| sends an alert after an
alert condition occurs. This helps eliminate false positives.

Default Alert Configurations
----------------------------

.. tabs::

   .. tab:: Organization Alerts
      :tabid: org

      |mms| provides no default alerts for organizations.

   .. tab:: Project Alerts
      :tabid: project

      |mms| creates the following alert configurations for a project
      automatically upon creation of the project:

      - User joined the project (``JOINED_GROUP``)

      - Host's SSL certificate will expire within 30 days (``HOST_SSL_CERTIFICATE_STALE``)

      - {+magent+} is down (``MONITORING_AGENT_DOWN``)

      If you enable Backup, |mms| creates the following alert
      configurations for the project, if they do not already exist:

      - Backup oplog is behind (``OPLOG_BEHIND``)

      - Backup requires a resync (``RESYNC_REQUIRED``)

      - Cluster is missing an active mongos (``CLUSTER_MONGOS_IS_MISSING``)

      - Host has security recommendations

      - Query Targeting: Scanned Objects / Returned is

        .. note::

           The default configuration sends an alert only if the 
           ratio of documents scanned to documents returned meets or 
           exceeds the specified threshold for at least 10 minutes.

Recommended Alert Configurations
--------------------------------

To effectively monitor your deployment, consider configuring the
following alerts:

Recommended Host Alerts
~~~~~~~~~~~~~~~~~~~~~~~

- *Host is recovering*: Triggers when a MongoDB instance
  enters RECOVERING mode.

- *Replication Lag is*: Monitors the lag time of secondaries
  behind the primary.

- *Tickets Available: Writes/Reads*: Flags potential
  performance issues for the WiredTiger storage engine.

- *Replication Oplog*: Monitors the oplog window size.

- *Host is down*: Triggers when a host becomes unreachable.

- *Queues: Readers/Writers is*: Tracks operations waiting on
  locks.

- *Page faults is*: Investigate if consistently high
  (> 1000 avg/sec).

- *Host is exposed to the public Internet*: Triggers when
  authentication and firewall protection are missing.

- *Host does not have the latest version*: Triggers when the
  MongoDB version is outdated by two or more revisions.

Recommended Replica Set Alerts
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- *Replica set elected a new primary*: Triggers during an
  election event.

- *Number of unhealthy members > n*: Triggers when more
  than n members are unhealthy.

Recommended Sharded Cluster Alerts
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- *Cluster missing an active mongos*

Recommended Agent Alerts
~~~~~~~~~~~~~~~~~~~~~~~~

- *Monitoring Agent is down*

- *Backup Agent is down*

Recommended Backup Alerts
~~~~~~~~~~~~~~~~~~~~~~~~~

When you use the Backup component, configure the following
alerts:

- *Backup oplog is behind*

- *Backup requires a resync*

.. note::

   Tune these alerts for your specific workload and usage
   patterns.

.. _settings-for-mms-alert-notifications:

Default Settings for Notification Options
-----------------------------------------

.. tabs::
   :hidden:

   .. tab:: Organization Alerts
      :tabid: org

      You can configure default settings for the following
      notification options:

      - |mms| Organization

      - |mms| User

      - Email

      - SMS

      - HipChat

      - Slack

      - PagerDuty

      - Datadog

      - VictorOps

      - Opsgenie

   .. tab:: Project Alerts
      :tabid: project

      You can configure default settings for the following
      notification options:

      - |mms| Organization

      - |mms| User

      - Email

      - SMS

      - HipChat

      - Slack

      - PagerDuty

      - Datadog

      - VictorOps

      - Opsgenie

To configure default settings for one of the above notification
options, click :guilabel:`Integrations` under :guilabel:`Projects` in
the sidebar. Locate the notification option and enter the default
values.

|mms| will fill in the default values automatically when a user
selects that option when creating an alert configuration. If the key,
token, or |url| that is used to send the notification becomes invalid,
|mms| will send an email to the project owner and will eventually
remove the key, token, or |url|.

.. _create-alert-configuration:

Create an Alert Configuration
-----------------------------

When you create a new alert, you can clone an existing alert.

.. tabs::
   :hidden:

   .. tab:: Organization Alerts
      :tabid: org

      .. include:: /includes/steps/configure-org-alert.rst

   .. tab:: Project Alerts
      :tabid: project

      .. include:: /includes/steps/configure-project-alert.rst

.. _delete-alert-setting:

Delete an Alert Configuration
-----------------------------

.. tabs::
   :hidden:

   .. tab:: Organization Alerts
      :tabid: org

      .. include:: /includes/steps/delete-org-alert.rst

   .. tab:: Project Alerts
      :tabid: project

      .. include:: /includes/steps/delete-project-alert.rst

If you delete an alert setting, |mms| cancels active alerts related to
the setting. A deleted alert setting does not remain visible.

.. _disable-enable-alert-setting:

Disable or Enable an Alert Configuration
----------------------------------------

.. tabs::
   :hidden:

   .. tab:: Organization Alerts
      :tabid: org

      .. include:: /includes/steps/disable-org-alert.rst

   .. tab:: Project Alerts
      :tabid: project

      .. include:: /includes/steps/disable-project-alert.rst

If you disable an alert setting, |mms| cancels active alerts related to
the setting. A disabled alert setting remains visible but grayed-out
and can be later re-enabled.

If you need to disable an alert only for a period of time, you can
:ref:`suspend alerts <suspend-alerts-during-maintenance-window>`.

View the History of Changes to an Alert Configuration
-----------------------------------------------------

.. tabs::
   :hidden:

   .. tab:: Organization Alerts
      :tabid: org

      You can view all alerts, alert settings, and deleted alerts on 
      the :guilabel:`Organization Alerts` page. To learn more, see 
      :ref:`alerts-workflow`.

      .. include:: /includes/steps/alert-configuration-history-org.rst

   .. tab:: Project Alerts
      :tabid: project

      You can view open alerts, closed alerts, and alert 
      settings on the :guilabel:`Project Alerts` page. 
      |mms| sends notifications for all alerts 
      that appear on the :guilabel:`Open` tab. To learn more, 
      see :ref:`alerts-workflow`.

      .. include:: /includes/steps/alert-configuration-history.rst

.. _test-alert-configurations:

Test Alert Configurations
--------------------------

You can test your alert configurations to ensure they work correctly
before deploying them in production. This is particularly useful for
webhook notifications with custom templates.

.. tabs::
   :hidden:

   .. tab:: Project Alerts
      :tabid: project

      .. procedure::
         :style: normal

         .. step:: Navigate to Alert Settings

            Navigate to :guilabel:`Alerts` > :guilabel:`Alert Settings`.

         .. step:: Create or edit an alert configuration

            Create or edit an alert configuration.

         .. step:: Configure notification method

            In the :guilabel:`Send to` section, configure your notification
            method (webhook, email, etc.).

         .. step:: Test the configuration

            Click the :guilabel:`Test Alert` button next to the notification
            configuration.

         .. step:: Verify the test results

            |mms| sends a test notification with sample data to verify your
            configuration works correctly.

      For webhook notifications, the test includes:

      - Sample alert data rendered through your custom templates
      - Validation that your webhook endpoint is reachable
      - Verification that custom headers and body templates render correctly

   .. tab:: Global Alerts
      :tabid: global

      .. procedure::
         :style: normal

         .. step:: Navigate to Global Alert Settings

            Navigate to :guilabel:`Admin` > :guilabel:`Global Alert Settings`.

         .. step:: Create or edit a global alert configuration

            Create or edit a global alert configuration.

         .. step:: Configure notification method

            In the :guilabel:`Send to` section, configure your notification
            method.

         .. step:: Test the configuration

            Click the :guilabel:`Test Alert` button next to the notification
            configuration.

         .. step:: Verify the test results

            |mms| sends a test notification to verify the configuration.

      Global alert tests use sample data that represents the type of
      alerts that would be generated across multiple projects.

.. toctree::
   :titlesonly:
   :hidden:

   Global Alerts </tutorial/manage-global-alerts/>
   System Alerts </core/system-alerts/>
   Webhook Templating </tutorial/webhook-templating/>
      