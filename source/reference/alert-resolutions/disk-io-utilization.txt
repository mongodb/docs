.. _disk-io-util:

======================
Disk I/O % Utilization
======================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

Description
-----------

``Disk I/O % Utilization`` alerts indicate that the percentage of disk
|iops| utilized reaches a specified threshold. This threshold is
specified when the alert is created.

.. note::

   The utilization measurements for the following alerts include
   requests from all processes, not just MongoDB processes.

:alert:`Disk I/O % utilization on Data Partition
<Disk I/O % utilization on Data Partition is>`
occurs if the percentage of time during which requests are being
issued to any partition that contains the MongoDB collection data
meets or exceeds the threshold.

:alert:`Disk I/O % utilization on Index Partition
<Disk I/O % utilization on Index Partition is>`
occurs if the percentage of time during which requests are being
issued to any partition that contains the MongoDB index data meets
or exceeds the threshold.

:alert:`Disk I/O % utilization on Journal Partition
<Disk I/O % utilization on Journal Partition is>`
occurs if the percentage of time during which requests are being
issued to the partition that contains the MongoDB
:term:`journal` meets or exceeds the threshold.

Possible Observations
---------------------

These are a few possible methods to observe high Disk I/O %
Utilization:

- The disk |iops| use from the :guilabel:`Disk IOPS` graph in the
  cluster :doc:`metrics </monitor-cluster-metrics>` is higher than the
  provisioned |iops| from the Atlas cluster :doc:`configuration page
  </scale-cluster>`.

- There is a high :guilabel:`IOWait` curve in the
  :guilabel:`Normalized System CPU` :doc:`metric
  </monitor-cluster-metrics>`. IOWait measures the percentage of time
  the CPU is idle and waiting for an I/O operation to complete. The
  :guilabel:`Normalized System CPU` chart is located under the
  :guilabel:`Hardware Metrics` section of the :guilabel:`Metrics` tab.

Common Triggers
---------------

These are a few common events which may lead to high
Disk I/O % Utilization and trigger these alerts:

- :manual:`Unoptimized queries </core/query-optimization/>` can cause
  extra disk |iops| usage.

- There may be a one-time event which causes a spike in disk |iops|
  and exceeds the |iops| threshold, such as an :manual:`index build
  </core/index-creation/>`.

Possible Solutions
------------------

These are a few possible actions to consider to help resolve
``Disk I/O % Utilization`` alerts:

- :manual:`Optimize your queries </core/query-optimization/>`.

- Use the |service| :doc:`Performance Advisor </performance-advisor/>`
  to view slow queries and suggested :manual:`indexes </indexes>`.

- Review :manual:`Indexing Strategies </applications/indexes/>` for
  possible further indexing improvements.

  .. note::

     You may need to temporarily increase your cluster |iops| to create
     new indexes. To change a cluster's |iops|, go to the
     :guilabel:`Cluster Configuration` page and:

     .. list-table::
        :header-rows: 1
        :widths: 20 20 60

        * - Cloud Provider
          - Tier
          - Possible Actions

            .. _aws-iops-solutions:

        * - |aws|
          - ``M10``, ``M20``
          -
            - :ref:`Increase Storage Capacity <scale-cluster-storage>`
              or
            - :ref:`Upgrade Cluster Tier <scale-cluster-instance>`

        * - |aws|
          - ``M30`` or larger
          -
            - :ref:`Increase Cluster IOPS <scale-cluster-storage>`
              or
            - :ref:`Increase Storage Capacity <scale-cluster-storage>`
              or
            - :ref:`Upgrade Cluster Tier <scale-cluster-instance>`

        * - |gcp|
          - ``M10`` or larger
          -
            - :ref:`Increase Storage Capacity <scale-cluster-storage>`
              or
            - :ref:`Upgrade Cluster Tier <scale-cluster-instance>`

        * - Azure
          - ``M10`` or larger
          -
            - :ref:`Increase Storage Capacity <scale-cluster-storage>`
              or
            - :ref:`Upgrade Cluster Tier <scale-cluster-instance>`

- :manual:`Analyze Query Performance </tutorial/analyze-query-plan/>`
  to review how your queries are using your indexes.

- Increase your cluster |iops| in the :doc:`Cluster Configuration Page
  </scale-cluster>`.

Disk IOPS Burst Credits for |service| Clusters on |AWS|
-------------------------------------------------------

|service| clusters deployed to |aws| with following criteria may use
burst credits when exceeding configured |iops| thresholds during
periods of high disk I/O:

- Clusters where the :guilabel:`Provision IOPS` setting is disabled.

- Clusters configured with less than 1 TB of storage capacity.

  .. note::

     By default, all clusters smaller than the ``M140`` cluster tier
     are configured with less than 1 TB of storage capacity.

|aws| uses burst credits to temporarily increase |iops| beyond the
configured threshold during periods of high disk I/O activity. These
clusters refresh spent credits during periods of low disk I/0 activity.
When burst credits are exhausted, |aws| limits |iops| for these
clusters to the configured threshold. This may result in decreased disk
I/O performance on these clusters and a high :guilabel:`IOWait` curve
in the :guilabel:`Normalized System CPU`
:doc:`metric </monitor-cluster-metrics>`.

See the |aws| :aws:`EBS Volume Type documentation </AWSEC2/latest/UserGuide/EBSVolumeTypes.html>`
for more information about burst credits and the rates at which they
deplete and refresh.

If you regularly exceed your configured |iops| threshold, you can avoid
depleting your burst credits by increasing your configured |iops| with
any of the following actions:

- :ref:`Increase Cluster IOPS <scale-cluster-storage>` to increase the
  cluster's |iops| threshold.

- Enable the
  :ref:`Provision IOPS configuration option <storage-iops-ui>` option.
  Clusters configured with this option use **Provisioned IOPS SSD**
  (:aws:`io1 </AWSEC2/latest/UserGuide/EBSVolumeTypes.html#EBSVolumeTypes_piops>`) storage volumes,
  which do not use burst credits and offer greater |iops| thresholds.

- :ref:`Increase Storage Capacity <scale-cluster-storage>`. The
  |iops| threshold increases as you increase storage capacity. Clusters
  configured to use at least 1 TB of storage have baseline |iops|
  performance that is equal to or greater than the maximum burst
  performance. These volumes do not deplete burst credit balances.

- :ref:`Upgrade Cluster Tier <scale-cluster-instance>`. Larger cluster
  tiers include higher |iops| thresholds.

  .. note::

    Cluster tiers ``M140`` and larger are deployed with at least 1 TB
    of storage capacity by default. Clusters with 1 TB or more of
    storage capacity do not deplete burst credit balances.
