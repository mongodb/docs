.. _de-shard-collection-for-global-writes:

=============================================================
Shard a Global Collection for |global-write| in Data Explorer
=============================================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. note::

   - Global writes are only supported on global clusters, which
     require a cluster tier of ``M30`` or greater.
   
   - This document assumes prior knowledge of sharding semantics. Review
     the :manual:`Sharding documentation </sharding>` before continuing
     with this tutorial.

In sharded clusters, you can create :term:`zones <zone>` of sharded
data based on the :term:`shard key`. Your zones can segment data
based on geographic area. For a complete tutorial on sharding based
on geographic area, see
:manual:`Segmenting Data by Location
</tutorial/sharding-segmenting-data-by-location/>`.

The |service| Data Explorer only supports sharding Global Write
collections inside of a global cluster. To shard non-Global-Write
collections, you must use the :binary:`~mongo` shell or application
code. To learn more, see :manual:`Deploy a Sharded Cluster
</tutorial/deploy-shard-cluster/>`.

Required Roles
--------------

You must have the :authrole:`Project Owner`  or :authrole:`Organization Owner`
role for the cluster's |service| project to shard a collection for 
|global-write| in the Data Explorer.

Considerations
--------------

Review the restrictions and compatibility requirements for
:ref:`global-writes-collections` before beginning this procedure.

After selecting a shard key via the
Data Explorer, |service| attempts to shard the target collection. 
During this period, make sure that no user manually
shards the collection. If |service| detects that the target 
collection was sharded with a different key than that selected via 
the Data Explorer, |service| stops the procedure and 
displays a warning for that collection in the Data Explorer. You can 
Click :guilabel:`Unmanage Collection` to clear the warning.
This removes the collection from |service| management while leaving
the underlying collection and the manually chosen shard key intact.

Update Shard Key Value
~~~~~~~~~~~~~~~~~~~~~~

Starting in MongoDB 4.2, you can update a document’s shard key value
unless the shard key field is the immutable ``_id`` field. To learn
more, see :manual:`Change a Document’s Shard Key Value
</core/sharding-shard-key/#change-a-document-s-shard-key-value>`.

In MongoDB 4.0 and earlier, you cannot update the value of a shard key
field in an existing document in a Global Writes-enabled collection.

Procedure
---------

To shard a collection in a |global-write-cluster|:

.. include:: /includes/steps/shard-collection-for-global-writes.rst

|service| displays the compound shard key near the top of the
:guilabel:`Global Writes` tab after configuring the collection.
