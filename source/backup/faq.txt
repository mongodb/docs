=========================================
Frequently Asked Questions About |backup|
=========================================
.. default-domain:: mongodb

MMS Backup creates backups of MongoDB replica sets and sharded
clusters. After an initial sync to MongoDB's datacenters, MMS Backup
tails the operation log (:manual:`oplog </core/replica-set-oplog/>`)
to provide a continuous backup with point-in-time recovery of replica
sets and consistent snapshots of sharded clusters. For more
information, please review these frequently asked questions or create
an MMS Backup account.

.. contents::
   :backlinks: none
   :class: long-toc
   :local:

Requirements
------------

What version of MongoDB does |backup| require?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

For deployments using sharded clusters, |backup|
requires version 2.4.3 or later.

For deployments using replica sets, |backup| requires
version 2.0 or later.

What MongoDB permissions does the Backup agent require on MongoDB 2.4 Instances?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

If you are backing up a MongoDB 2.4 instance with authentication
enabled, the Backup agent requires elevated privileges. At a minimum,
the user will need:

- the ``readAnyDatabase`` role, **and**

- the ``clusterAdmin`` role, **and**

- the ability to write to the local and ``admin`` database (e.g., via
  the ``readWrite`` role), **and**

- the ``userAdminAnyDatabase`` role on the ``admin`` database.

.. seealso:: `User Privilege Roles in MongoDB <http://docs.mongodb.org/manual/reference/user-privileges/>`_.

Are there any limits to the types of deployments |backup| supports?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Yes. |backup| does not currently support standalone deployments.
|backup| has full support for replica sets and sharded clusters.

Why doesn't |backup| support standalone deployments?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

After an initial sync of your data to our servers, |backup| copies
data from the :term:`oplog` to provide a continuous backup with
point-in-time recovery. |backup| does not support standalone servers,
which do not have an oplog. To support backup with a single
:program:`mongod` instance, you can run a one-node
replica set.

.. seealso:: :manual:`Convert a Standalone to a Replica Set </tutorial/convert-standalone-to-replica-set/>`.

Interface
---------

How can I verify that I'm running the latest version of the Backup Agent?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

If your Backup agent is out of date, it will be highlighted in red on
the :guilabel:`Agents` tab of the "Hosts" page in the MMS interface.

Why is my Backup Agent highlighted in red?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

If your agent is highlighted in red on the :guilabel:`Agents` tab of
the "Hosts" page, your agent is out of date. For instructions on
updating the agent, see the :doc:`installation instructions
</backup/tutorial/install-and-start-backup-agent>`.

Operations
----------

How does |backup| work?
~~~~~~~~~~~~~~~~~~~~~~~

You install the Backup agent on a server in the same deployment with
your MongoDB infrastructure. The agent conducts an initial sync of
your data to our servers. After the initial sync, the agent tails the
:manual:`oplog </manual/core/replica-set-oplog/>` to provide a
continuous backup of your deployment.

Where should I run the Backup agent?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The Backup agent can run anywhere in your infrastructure that has
access to your ``mongod`` instances. To avoid contention for network
and CPU resources, do not run the Backup agent on the same hosts that
provide your ``mongod`` instances.

The primary resource requirement for the Backup agent is network access.

Start the Backup agent from the :file:`backup-agent` directory where you
extracted the archive.

Can I run the Backup and Monitoring Agents on a Single System?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/faq-backup-and-monitoring-agent-on-one-server.rst

Will the MongoDB Backup Service impact my production databases?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

|backup| will typically have minimal impact on
production MongoDB deployments. This impact will be similar to that of
adding a new secondary to a replica set.

By default, the Backup agent will perform its initial sync,
the most resource intensive operation for |backup|, against
a secondary member of the replica set to limit its impact.
You may optionally configure the Backup agent to
perform the initial sync against the primary, although this will
increase the impact of the initial sync operation.

Does the Backup agent modify my database?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The Backup agent writes a small token into the oplog of the source
database every hour. These tokens provide a heartbeat for |backup|
and have no effect on the source deployment. Each token is
less than 100 bytes.

Is my data safe?
~~~~~~~~~~~~~~~~

Yes, MMS uses enterprise-grade hardware co-located in secure data
centers to store all user data. The Backup agent
transmits all data using SSL. The data is not encrypted at rest. |backup| requires two-factor
authentication to provide any data for restores.

Is there a limit to Backup size?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

|backup| works optimally for deployments in which each replica set has
a data size of less than 2 TB. Within a sharded cluster, this means
that |backup| is optimized for clusters where each shard has a data
size of less than 2 TB.

There is currently no limit on the total size of snapshot storage.

If you wish to use |backup| for a larger deployment, please
`contact us <https://mms.mongodb.com/links/support>`_ for more information.

What is the load on the database during the initial Backup sync?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The impact of the initial backup synchronization should be similar to
syncing a new secondary replica set member. The backup agent does not
throttle its activity, and attempts to perform the sync as quickly as
possible.

Can I backup my standalone deployment?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

No. |backup| does not currently support standalone
deployments. To convert to a replica set, consult MongoDB's `replication
documentation <http://docs.mongodb.org/manual/replication/>`_.

Does the Backup Agent Support SSL?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The backup agent *always* connects to the MMS servers using an SSL (HTTPS)
connection.

The backup agent also can connect to replica sets and shared clusters
configured with SSL. See the :ref:`Backup Agent Configuration <backup-ssl>`
documentation for more information.

How Do I Delete a Backup Snapshot?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

You can delete replica set backup snapshots and snapshots for replica sets in a
sharded cluster set if the snapshots are not needed for point-in-time restores.

To delete a backup snapshot, go to the MMS :guilabel:`Backup` tab. Select
either :guilabel:`Replica Set Status` or :guilabel:`Sharded Cluster Status`.
Then click the name of the replica set or sharded cluster. On the list of
snapshots, click the :guilabel:`Delete` link to the right of a snapshot.

While sharded clusters do not have point-in-time restores, deleting a snapshot
from the :guilabel:`Sharded Cluster Status` page is limited by the
point-in-time restore constraints for replica sets in the sharded cluster.

Configuration
-------------

What are "excluded namespaces"?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Excluded namespaces are databases and collections that MMS will not
back up. This is useful for large databases or collections that
contain data that you will not need to restore: caches and logs, for example.

How can I prevent |backup| from backing up a collection?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

|backup| allows you to specify "excluded namespaces", which are
collections or databases that you do not want MMS to back up.

You can specify the namespaces to exclude when you initially enable
backup on a replica set or sharded cluster, or can edit the list at
any time by selecting the ":guilabel:`gear icon`" in the
:guilabel:`Sharded Cluster Status` or :guilabel:`Replcia Set Status`
tables in the MMS Console.

How can I change which namespaces are on the "excluded namespaces" list?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Click on the ":guilabel:`gear icon`" next to the name of the replica
set or sharded cluster whose excluded namespaces you want to modify in the
:guilabel:`Sharded Cluster Status` or :guilabel:`Replcia Set Status`
tables in the MMS Console. A modal window will open, where you can add
databases or collections to the list, or remove list items by clicking
on the red :guilabel:`x` icon.

Removing a namespace from the excluded namespaces list necessitates a
re-sync. |backup| handles this re-sync.

Restoration
-----------

How can MMS provide point-in-time restores for any point in time?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Although it is faster to provide a restore for the time at which a
snapshot was actually stored, this can be unideal when restoring a
replica set. In consequence, the Backup service
can build a restore to any point in time within a 24-hour period by
replaying the oplog to the desired time.

.. important:: For sharded clusters, |backup| only restores
   sharded clusters from a :doc:`stored snapshot
   </backup/tutorial/restore-from-snapshot/>`, which reflect *nearly*
   the same moment for each shard. |backup| will not build a
   custom snapshot for a sharded cluster.

Can I take snapshots more or less often than every 6 hours?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Yes. See :doc:`Activate MMS Backup for a Replica Set
</backup/tutorial/enable-backup-for-replica-set/>` and :doc:`Activate MMS
Backup for a Sharded Cluster
</backup/tutorial/enable-backup-for-sharded-cluster/>` for details.

.. _backup-faq-retention:

Can I set my own snapshot retention policy?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Yes. Backup snapshot retention is configurable.

The default snapshot retention policy is to maintain:

- 6-hour interval snapshots for 2 days,
- Daily snapshots stored for 1 week,
- Weekly snapshots stored for 1 month, and
- Monthly snapshots stored for 1 year.

You can customize both the frequency and schedule of snapshots that
MMS captures. This allows you to tune your backup strategy based on
your requirements.

For example you may choose to capture more frequent snapshots for the
most mission critical data, and capture snapshots less frequently for
less critical data.

Customizable snapshot retention polices give you greater control over
your backup costs. The pricing for MMS Backup depends on both snapshot
storage and oplog processing. By adjusting your retention policy, you
can control your snapshot storage costs. You can also control backup
costs by excluding non-critical databases and collections.

See :doc:`Activate MMS Backup for a Replica Set
</backup/tutorial/enable-backup-for-replica-set/>` and :doc:`Activate MMS
Backup for a Sharded Cluster
</backup/tutorial/enable-backup-for-sharded-cluster/>` for details about
configuring snapshot retention frequency and excluding namespaces for
non-critical databases and collections.

How many copies of my data does the Backup Service store?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Although we only charge you for only one copy of the data, |backup|
stores at least 3 copies of your data in at least 2 geographic
locations to ensure redundancy.

How long does it take to create a restore?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

All snapshots are set in compressed form from |backup| to your
infrastructure.

Within the US, |backup| sends snapshots at 50-100Mbps. Assuming a
compression factor of 4x and transmission speeds of 50Mbps, a 250 GB
snapshot will take 2.5 hours.

In addition, point-in-time restores that require creating a new
snapshot take additional time, which depends on the size of the
scheduled snapshot and the amount the oplog entries that |backup| must
apply to the preceding snapshot to roll forward to the requested
point-in-time of the backup.

Does |backup| perform any data validation?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

|backup| conducts basic corruption checks and provides an alert if any
component (e.g., the agent) is down or broken, but does not perform
explicit data validation. When it detects corruption, |backup| errs on
the side of caution and invalidates the current backup and sends an
alert.

How do I restore? What do I get when I restore?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

You can request a restore via MMS, where you can then choose which
snapshot to restore and how you want |backup| to deliver the
restore. All restores require
2-factor authentication. MMS will send an authorization code via SMS
code to your administrator. You must enter the authorization code into
the backup interface to begin the restore process.

.. include:: /includes/fact-two-factor-auth-India-limit.rst

|backup| delivers restores as ``tar.gz`` archives of
MongoDB data files.

Restore delivery options are:

- **SCP to your Infrastructure**: |backup| will transmit the
  backup to your infrastructure over a secure channel.  You must
  provide connection information for a host in your deployment.

- **Download**: |backup| will make your restore data
  available using a custom, one-time-use URL.

What is the SCP public key for |mms|?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

|mms| generates an SSH public key on a per user basis to
use when for delivering backups via SCP. To generate a public key, go
to the "Settings" page and choose "Backup and Restore Public Key,"
then type in a passphrase and click on "Generate a New Public Key".

The public key will generate an SSH key and display it. Add this key
to your authorized hosts file.

See the :ref:`Restore via Secure Copy <scp-ssh>` documentation
for more information about granting access via SSH public key.

Pricing
-------

How does |backup| calculate snapshot storage costs?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The snapshot storage cost depends on the *raw storage size*.

Raw storage size is the sum of all allocated extents, which is
typically smaller than file size.

The snapshot storage price is $0.08 per gigabyte per-month.

See :ref:`backup-faq-retention` for more information about snapshot
retention, which affects snapshot storage cost.

How does |backup| calculate the cost of inbound network data transfer?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

|backup| calculates the cost of data transfer using the
uncompressed data size at a rate of $1 per gigabytes. This cost only
applies only to oplog transfer, and not to transfer related to initial
sync.

What other costs does |backup| incur?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

In addition to snapshot storage costs and the network
transfer cost, |backup| incurs a minimum cost of $0.10 per replica set
per day.

For sharded clusters |backup| incurs a minimum cost of $0.10
per shard per day and $0.10 per config server per day. For example, a
sharded cluster with three config servers and two shards would incur a
cost of $0.50 per day.

What is the billing frequency and schedule?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

You will receive a monthly bill for |backup|; however, the
service calculates costs every day.

What is the cost of a restoration?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

There is no cost to create a restore.

How can I see an estimate of my backup costs?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

If you have monitoring installed, you can see an estimate of your
backup costs.

Before you register for backup, you can view the estimate in the
`backup section of the MMS site
<https://mms.mongodb.com/learn-more#backup>`_. After you register for backup, view
an estimate of backup costs by navigating to the:guilabel:`backup` tab
and the to the :guilabel:`replica set status` section. Hover over the
:guilabel:`i` icon to see the estimated monthly cost.

Free Tier
---------

What is the free tier?
~~~~~~~~~~~~~~~~~~~~~~

During your first 12 months using |backup|, any bill under $5 is
free. That's about enough to back up a 2GB database with 500MB of
oplog data churn per month.

What are the qualifications for the free tier?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The free tier is available to anyone registered for |backup| for
each monthly bill less than $5 within the first 12 months of using
|backup|.

Does the free tier expire?
~~~~~~~~~~~~~~~~~~~~~~~~~~

Yes, the free tier expires after 12 months of registering for |backup|.

What happens if my bill goes above $5?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

You will be charged standard pay-as-you-go service rates for that
month. If your bill goes back below $5, you will not be charged for
that month.

Can my free usage roll over?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

No, free usage cannot roll over.

How do I enroll in the free tier?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Inclusion in the free tier is automatic. If your bill is less than $5
in the first 12 months of using MMS Backup, you will not be charged.
