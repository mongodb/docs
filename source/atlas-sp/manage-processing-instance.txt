.. _manage-spi:

===================================================
Configure a {+SPI+}
===================================================

.. default-domain:: mongodb

.. meta::
   :keywords: atlas stream processing, atlas stream processing overview, streaming data, data stream, real time, data processing, apache kafka, kafka
   :description: Learn how MongoDB Atlas can connect to sources and sinks of streaming data to provide real time data processing leveraging the full power of MongoDB aggregation pipelines.

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

.. include:: includes/atlas-sp/private-preview.rst

An {+atlas-sp+} instance provides a context for all of your operations
on streaming data. The procedures in this page walk you through 
creating and configuring your {+spi+}s.

Prerequisites
-------------

To create and configure a stream processor, you must have the 
following:

- An |service| :ref:`project <manage-projects>`
- A user with the |service| :authrole:`Project Owner` role

.. _manage-spi-create:

Create a {+spi+}
-------------------------------------

To create a new {+spi+} using the {+atlas-ui+}:

.. procedure::
   :style: normal

   .. step:: Navigate to the :guilabel:`Stream Processing` 
      page.

      .. procedure::
         :style: connected

         .. step:: If it is not already displayed, select the project
            where you want to create a {+spi+} from the 
            :guilabel:`Projects` menu.

         .. step:: In the left-hand navigation pane, click 
            :guilabel:`Stream Processing` under the 
            :guilabel:`Services` menu.

   .. step:: Create your 
      {+spi+}.

      .. procedure::
         :style: connected

         .. step:: Click :guilabel:`Create instance` in the upper
            right corner.

         .. step:: In the modal window:

            - Enter a string for the :guilabel:`Instance Name`. Each 
              {+spi+} name must be unique within a project.
            
            - Select a :guilabel:`Cloud Provider` from the dropdown 
              menu.

            - Select a :guilabel:`Region` from the dropdown menu.

         .. step:: Click 
            :guilabel:`Create`.

.. _manage-spi-delete:

Delete a {+spi+}
-----------------------------------

To delete a {+spi+}:

.. procedure::
   :style: normal

   .. step:: Navigate to the :guilabel:`Stream Processing` 
      page.

      .. procedure::
         :style: connected

         .. step:: If it is not already displayed, select the project
            you want to create a {+spi+} in from the 
            :guilabel:`Projects` menu.

         .. step:: In the left-hand navigation pane, click 
            :guilabel:`Stream Processing` under the :guilabel:`Services` 
            menu.

   .. step:: Locate the overview panel of the {+spi+} you want to 
      delete and click the ellipsis :guilabel:`...` icon in the upper
      right.
         
   .. step:: Click 
      :guilabel:`Delete instance`.

   .. step:: When prompted, type the name of the {+spi+} in the
      text field and click :guilabel:`Delete`.

.. _manage-spi-connection-add:

Add a Connection to the Connection Registry
-------------------------------------------

To add a connection to your {+spi+}:

.. procedure::
   :style: normal

   .. step:: Navigate to the 
      :guilabel:`Connection Registry`.

      .. procedure::
         :style: connected

         .. step:: If it is not already displayed, select the project
            where you want to create a {+spi+} from the 
            :guilabel:`Projects` menu.

         .. step:: In the left-hand navigation pane, click 
            :guilabel:`Stream Processing` under the 
            :guilabel:`Services` menu.

         .. step:: Locate the overview panel of the {+spi+} you want to 
            modify and click :guilabel:`Configure`. 

         .. step:: Select the :guilabel:`Connection Registry` 
            tab.

   .. step:: Click 
      :guilabel:`+ Add connection`.

   .. step:: Add a new 
      connection.

      .. tabs:: 
            
         .. tab:: Apache Kafka
            :tabid: stream-connect-kafka

            To create a new connection to an {+kafka+} system:

            .. procedure::
               :style: connected

               .. step:: Select a :guilabel:`Kafka` 
                  connection.

               .. step:: Provide a :guilabel:`Connection Name`. Each
                  connection name must be unique within a {+spi+}.
                  This is the name used to reference the connection in 
                  {+atlas-sp+} :ref:`aggregations <stream-aggregation>`.

               .. step:: Specify an IP address for one or more 
                  `bootstrap servers <https://kafka.apache.org/documentation/#streamsconfigs_bootstrap.servers>`__
                  for your {+kafka+} system.

               .. step:: From the dropdown menu, select a 
                  :guilabel:`Security Protocol Method`. 
                  
                  {+atlas-sp+} supports ``SASL_PLAINTEXT`` or 
                  ``SASL_SSL``.

                  .. tabs:: 

                     .. tab:: ``SASL_PLAINTEXT``
                        :tabid: stream-connect-kafka-plain-auth

                        .. procedure::
                           :style: normal

                           .. step:: From the dropdown menu, select a
                              :guilabel:`SASL Mechanism`. 

                              {+atlas-sp+} supports:
                              
                              - ``PLAIN``

                              - ``SCRAM-SHA-256``

                              - ``SCRAM-SHA-512``

                           .. step:: Provide a :guilabel:`Username` for 
                              authentication.

                           .. step:: Provide a password for 
                              authentication.

                           .. step:: Click 
                              :guilabel:`Add connection`.

                     .. tab:: ``SASL_SSL``
                        :tabid: stream-connect-kafka-ssl-auth

                        .. procedure::
                           :style: normal

                           .. step:: From the dropdown menu, select a
                              :guilabel:`SASL Mechanism`. 

                              {+atlas-sp+} supports: 
                              
                              - ``PLAIN`` 

                              - ``SCRAM-SHA-256``

                              - ``SCRAM-SHA-512``

                           .. step:: Click :guilabel:`Upload` to upload 
                              your 
                              :guilabel:`Certificate Authority PEM file`

                           .. step:: Provide a :guilabel:`Username` for 
                              authentication.

                           .. step:: Provide a password for 
                              authentication.

                           .. step:: Click 
                              :guilabel:`Add connection`.

         .. tab:: {+service+} Database
            :tabid: stream-connect-atlas

            To create a new connection to an {+service+}
            :manual:`change stream <changeStreams>`:

            .. procedure::
               :style: connected

               .. step:: Select an :guilabel:`{+service+} Database` 
                  connection.

               .. step:: Provide a :guilabel:`Connection Name`. Each
                  connection name must be unique within an {+spi+}. 
                  This is the name used to reference the connection in 
                  {+atlas-sp+} :ref:`aggregations <stream-aggregation>`.

               .. step:: From the dropdown menu, select an 
                  :guilabel:`{+service+} {+Cluster+}`. {+atlas-sp+}
                  is only available on dedicated-tier {+clusters+}.

               .. step:: Click 
                  :guilabel:`Add connection`. 

.. _manage-spi-connection-modify:

Modify a Connection from the Connection Registry
------------------------------------------------

To modify a connection from a connection registry:

.. procedure::
   :style: normal

   .. step:: Navigate to the 
      :guilabel:`Connection Registry`.

      .. procedure::
         :style: connected

         .. step:: If it is not already displayed, select the project
            you want to create a {+spi+} in from the 
            :guilabel:`Projects` menu.

         .. step:: In the left-hand navigation pane, click 
            :guilabel:`Stream Processing` under the :guilabel:`Services` 
            menu.

         .. step:: Locate the overview panel of the {+spi+} that 
            contains the connection registry that you want to modify 
            and click :guilabel:`Configure` in the upper right.

   .. step:: Select the :guilabel:`Connection Registry` 
      tab.

   .. step:: For the connection that you want to modify in the table, 
      click the pencil icon in the :guilabel:`Actions` column.

   .. step:: Modify the fields you want to modify and click 
      :guilabel:`Save changes`.

.. _manage-spi-connection-delete:

Delete a Connection from the Connection Registry
------------------------------------------------

To delete a connection from a connection registry:

.. procedure::
   :style: normal

   .. step:: Navigate to the 
      :guilabel:`Connection Registry`.

      .. procedure::
         :style: connected

         .. step:: If it is not already displayed, select the project
            where you want to create a {+spi+} from the 
            :guilabel:`Projects` menu.

         .. step:: In the left-hand navigation pane, click 
            :guilabel:`Stream Processing` under the :guilabel:`Services` 
            menu.

         .. step:: Locate the overview panel of the {+spi+} that 
            contains the connection registry that you want to modify 
            and click :guilabel:`Configure` in the upper right.

   .. step:: Select the :guilabel:`Connection Registry` 
      tab.

   .. step:: For the connection you want to modify in the table, click
      the trash can icon in the :guilabel:`Actions` column of that 
      entry.

   .. step:: When prompted, click 
      :guilabel:`Delete`.
