:noprevnext:

===================================================
Install and Configure the {+osb+}
===================================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

.. include:: /includes/styles/corrections.rst

.. include:: /includes/note-k8s-documentation.rst

Prerequisites
-------------

.. _atlas-prerequisites:

|service| Prerequisites
~~~~~~~~~~~~~~~~~~~~~~~

To install the {+osb+}, you must:

1. Set up a :atlas:`payment method <billing/#billing-overview>` for
   |service| billing.

#. Create a :atlas:`project <manage-projects/#create-a-project>` in
   which your clusters will be deployed.

#. Have or generate a
   :atlas:`Programmatic API Key
   <configure-api-access/#programmatic-api-keys>`.

   a. Grant this new |svc-api-key| the :atlas:`Project Owner
      <reference/user-roles/#Project-Owner>` role.

   #. Add the |ipaddr| or |cidr| block of any hosts that serve the
      {+osb+} to the :atlas:`API Whitelist <security-whitelist>`.

.. _k8s-prerequisites:

|k8s| Prerequisites
~~~~~~~~~~~~~~~~~~~

1. Have a |k8s| solution available to use.

   If you need a |k8s| solution, see the |k8s|
   `documentation on picking the right solution <https://v1-13.docs.kubernetes.io/docs/setup/pick-right-solution/>`__.

#. Install the |k8s| |k8s-service-catalog|.

#. Install the |k8s| `Service Catalog CLI <https://svc-cat.io/docs/install/#installing-the-service-catalog-cli>`__.

Considerations
--------------

|k8s| Compatibility
~~~~~~~~~~~~~~~~~~~

{+osb+} is compatible with:

- |k8s| v1.13 or later
- |k8s| |k8s-service-catalog| v0.2.1 or later

.. _osb-scope:

{+osb+} Scope
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

When you create an instance of the {+osb+}, you register it with |k8s|
as either a cluster-scoped ``clusterServiceBroker`` or a
namespace-scoped ``serviceBroker``.

For more information on the use cases for cluster-scoped and
namespace-scoped brokers, see the `Kubernetes Service Catalog
documentation
<https://svc-cat.io/docs/namespaced-broker-resources/#cluster-scoped-vs-namespace-scoped-broker-resources>`__.

.. _osb-scope-cluster:

``ClusterServiceBroker``
````````````````````````

An {+osb+} instance that is registered as a ``ClusterServiceBroker`` is
available to the entire |k8s| cluster. When you deploy a |service|
replica set or sharded cluster, you must use the associated
``clusterServiceClass`` and ``clusterServicePlan`` resources.

.. _osb-scope-namespace:

``ServiceBroker``
`````````````````

An {+osb+} instance that is registered as a ``ServiceBroker`` is
available to only a single namespace within the |k8s| cluster. When you
deploy a |service| replica set or sharded cluster, you must use the
``serviceClass`` and ``servicePlan`` resources scoped to the same
namespace.


Multiple {+osb+} Instances
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

When you create an instance of the {+osb+}, you can deploy:

- A single {+osb+} instance scoped to the entire |k8s| cluster or
- Multiple {+osb+} instances scoped to their own namespaces within the
  |k8s| cluster

  .. important::

     If you choose to deploy multiple {+osb+} instances, deploy only
     one instance per |k8s-ns|. Multiple {+osb+} instances cannot
     coordinate with one another within the same namespace.

.. _default namespace: https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/#viewing-namespaces

.. _install-atlas-osb:

Install the {+osb+}
-------------------------------------

To deploy the {+osb+} in |k8s|, use the following procedure.

.. include:: /includes/steps/install-osb-k8s.rst

Next Steps
----------

After installing the {+osb+}, you can:

- :doc:`Set a whitelist </tutorial/whitelist-providers>` of allowed
  cloud service providers and instance sizes.
- Deploy a :doc:`replica set </tutorial/deploy-replica-set>` or
  :doc:`sharded cluster </tutorial/deploy-sharded-cluster>`.
- Create :doc:`database users </tutorial/manage-database-users>`.


.. toctree::
   :titlesonly:
   :hidden:

   /tutorial/whitelist-providers
