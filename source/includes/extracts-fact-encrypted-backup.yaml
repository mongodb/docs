ref: fact-encrypted-startup-options
content: |
   If the data files are encrypted, include the following
   :program:`mongod` options set to appropriate values:

   - :manual:`--enableEncryption </reference/program/mongod/#cmdoption--enableEncryption>`
   - :manual:`--kmipServerName </reference/program/mongod/#cmdoption--kmipServerName>`
   - :manual:`--kmipPort </reference/program/mongod/#cmdoption--kmipPort>` 
   - :manual:`--kmipServerCAFile </reference/program/mongod/#cmdoption--kmipServerCAFile>`
   - :manual:`--kmipClientCertificateFile  </reference/program/mongod/#cmdoption--kmipClientCertificateFile>` 

   .. include:: /includes/extracts/encrypted-backup-display-kmip-info.rst

edition: onprem
---
ref: fact-encrypted-startup-options
content: ""
edition: cloud
---
ref: fact-restore-from-encrypted-backup-prereq
content: |

   Restoring from Encrypted Backup
   +++++++++++++++++++++++++++++++
   
   To restore from an encrypted backup, you need the same master key
   used to encrypt the backup and either the same certificate as is on
   the Backup Daemon server or a new certificate provisioned with that
   key from the KMIP server.

edition: onprem
---
ref: fact-restore-from-encrypted-backup-prereq
content: ""
edition: cloud
---
ref: fact-encrypted-backups
content: |
   .. versionchanged:: 3.4

      Starting in |onprem| 3.4, if using the WiredTiger storage engine
      for backups (MongoDB 3.2 or greater), the WiredTiger encryption
      option is available for storing backup.
      
      For details on setting up encryption for backups, see
      :doc:`/tutorial/encrypt-snapshots`.

edition: onprem
---
ref: fact-encrypted-backups
content: |
   The WiredTiger encryption option is not available for storing
   backups. You can store backups using the WiredTiger storage engine,
   but you cannot enable the encryption option. If you restore from a
   backup, you restore unencrypted files.

edition: cloud
---
ref: fact-restoreInfo-file
content: |
   This file contains:

   - *Group name*

   - *Replica Set name*

   - *Cluster Id* (if applicable)

   - *Snapshot timestamp* (as Timestamp at UTC)

   - *Last Oplog applied* (as a BSON Timestamp at UTC)

   - *MongoDB version*

   - *Storage engine type*

   - ``mongod`` startup options used on the database when the snapshot was
     taken

   - *Encryption* (Only appears if encryption is enabled on the snapshot)

   - *Master Key UUID* (Only appears if encryption is enabled on the snapshot) 

     If restoring from an encrypted backup, you must have a certificate
     provisioned for this Master Key.

edition: onprem
---
ref: fact-restoreInfo-file
content: |
   This file contains:

   - *Group name*

   - *Replica Set name*

   - *Cluster Id* (if applicable)

   - *Snapshot timestamp* (as Timestamp at UTC)

   - *Last Oplog applied* (as a BSON Timestamp at UTC)

   - *MongoDB version*

   - *Storage engine type*

   - ``mongod`` startup options used on the database when the snapshot was
     taken

edition: cloud
---
ref: example-restoreInfo-file
content: |
   ..  code-block:: json

       Restore Information
       Group Name: test1
       Replica Set: config
       Cluster Id: bar
       Snapshot timestamp: Thu Dec 15 20:03:59 GMT 2016
       Last Oplog Applied: Thu Dec 15 20:04:45 GMT 2016 (1463688285, 2)
       MongoDB Version: 3.4.0
       Storage Engine: wiredTiger
       Startup Options: { "storage.directoryPerDB" : true }
       Encryption: enabled
       Master Key UUID: 7253

edition: onprem
---
ref: example-restoreInfo-file
content: |

   ..  code-block:: json

       Restore Information
       Group Name: test1
       Replica Set: config
       Cluster Id: bar
       Snapshot timestamp: Thu May 19 20:03:59 GMT 2016
       Last Oplog Applied: Thu May 19 20:04:45 GMT 2016 (1463688285, 2)
       MongoDB Version: 3.0.12
       Storage Engine: wiredTiger
       Startup Options: { "storage.directoryPerDB" : true }

edition: cloud
---
ref: encrypted-backup-display-kmip-info
content: |
     If the snapshot is encrypted, the restore panel displays the KMIP
     master key id and the KMIP server information. You can also find
     the information when you view the snapshot itself as well as in
     the ``restoreInfo.txt`` file.
edition: onprem
---
ref: encrypted-backup-display-kmip-info
content: ""
edition: cloud
---
ref: encrypted-backup-enable-encryption
content: |
    If the storage engine is :guilabel:`WiredTiger`, you can enable
    encryption. To enable encryption, select :guilabel:`Enable
    Encryption`. Select only if you have :ref:`set up KMIP server
    <setup-kmip-server-conf>` for your backups and :ref:`configured the
    group to use KMIP <configure-group-kmip>`.
edition: onprem
---
ref: encrypted-backup-enable-encryption
content: ""
edition: cloud
...