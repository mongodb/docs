.. _create-cluster-multi-region:

=========================================================
Multi-Region, Workload Isolation, and Replication Options
=========================================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

|service| supports adding cluster nodes in different geographic regions
with different workload priorities to direct application queries to the
most appropriate cluster nodes.

To configure multi-region and workload isolation cluster options, toggle
:guilabel:`Select Multi-Region, Workload Isolation, and Replication Options (M10+ clusters)`
to :guilabel:`Yes`.

.. figure:: /images/workload-isolation.png
   :figwidth: 720px
   :alt: Image showing workload isolation settings

.. include:: /includes/extracts/fact-no-node-restriction-base.rst

.. admonition:: AWS Only
   :class: note

   If this is the first ``M10+`` dedicated paid cluster for the
   selected region or regions *and* you plan on creating one or more
   |vpc| peering connections, please review the documentation
   on :doc:`VPC Peering Connections </security-vpc-peering>` before
   continuing.

.. _deploy-across-multiple-regions:

Electable Nodes for High Availability
-------------------------------------

.. include:: /includes/fact-electable-nodes-high-avail.rst

Each electable node can:

- Participate in replica set elections.
    
- Become the :term:`primary` as long as the majority of nodes in the
  replica set are available.

Configure Regions for Electable Nodes
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Click :guilabel:`Add a region` to add a new row for region
selection and select the region from the dropdown. Specify the
desired number of :guilabel:`Nodes` for the region. The total
number of electable nodes across all regions in the cluster must
be 3, 5, or 7.

When selecting a :guilabel:`Region`, regions marked as
:guilabel:`Recommended` provide higher availability compared to
other regions. For more information, see:

- :ref:`AWS Recommended Regions <amazon-aws-availability-zones>`.
- :ref:`GCP Recommended Regions <google-gcp-availability-zones>`.
- :ref:`Azure Recommended Regions <microsoft-azure-availability-zones>`.

To remove a region, click the :icon:`trash-alt` icon next to that
region. You cannot remove the :guilabel:`Highest Priority` region.

.. admonition:: Backup Data Center Location
   :class: note

   If this is the first cluster in the project *and* you
   intend to enable
   :ref:`continuous snapshot backups <create-cluster-backups>`,
   |service| selects the backup data center location for the
   project based on the geographical location of the
   cluster's :guilabel:`Highest Priority` region. To learn more
   about how |service| creates the backup data center, see
   :doc:`Fully Managed Backup Service </backup-cluster>`.

Improve the Availability of a Cluster
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

You can improve the redundancy and availability of a single region by
increasing the number of :guilabel:`Nodes` in that region. In a
single-region cluster, that region is your 
:guilabel:`Highest Priority` region. If you choose to add another
region, you may reconfigure the cluster to use that as your 
:guilabel:`Highest Priority` region.

To ensure availability during a full region outage, you need at least
one node in three different regions. To ensure availability during a
partial region outage, you must have at least three electable nodes in
a :guilabel:`Recommended` region *or* at least three electable nodes
across at least two regions.

Modify the Highest Priority Region in an Active Multi-Region Cluster
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

If you change the :guilabel:`Highest Priority` region in an active
multi-region cluster, |service| performs a rolling restart on all
nodes in that cluster. This change triggers an election which
selects a new ``PRIMARY`` in the region specified (assuming that the
number of nodes in each region remains the same and nothing else is
modified).

.. example::

    If you have an active 5-node cluster with the following
    configuration:

    - 3 nodes in ``us-east-1`` (the :guilabel:`Highest Priority` region,
      housing the primary node)
    - 2 nodes in ``us-west-2``

    You can choose to make ``us-west-2`` your 
    :guilabel:`Highest Priority` region by setting it as the first row
    of your cluster's :guilabel:`Electable nodes`. After the change, 
    |service| performs a rolling restart on all nodes and elects a new
    ``PRIMARY`` in ``us-west-2``. There is no initial sync or
    re-provisioning of servers required to make this configuration
    change.

.. _deploy-read-only-replicas:

Read-Only Nodes for Optimal Local Reads
---------------------------------------

Use read-only nodes to optimize local reads in
the nodes' respective service areas.

Click :guilabel:`Add a region` to select a region in which to
deploy read-only nodes. Specify the desired number of
:guilabel:`Nodes` for the region.

Read-only nodes cannot provide high availability because they
cannot participate in :term:`elections <election>`, or become the
:term:`primary` for their cluster. Read-only nodes have
distinct :manual:`read preference </core/read-preference>` tags
that allow you to direct queries to desired regions.

To remove a read-only region, click the :icon:`trash-alt` icon
next to that region.

.. _deploy-analytics-nodes:

Analytics Nodes for Workload Isolation
--------------------------------------

.. include:: /includes/fact-create-cluster-analytics-nodes.rst

Analytics nodes cannot participate in
:term:`elections <election>`, or become the :term:`primary` for
their cluster.

To remove an analytics node, click the :icon:`trash-alt` icon
next to that region.

Considerations
--------------

- .. include:: /includes/fact-node-type-topology-warning.rst

- .. include:: /includes/fact-remove-region-cross-region.rst 

- Having a large number of regions or having nodes spread across
  long distances may lead to long election times or replication lag.

- .. include:: /includes/fact-cross-region-limits.rst
