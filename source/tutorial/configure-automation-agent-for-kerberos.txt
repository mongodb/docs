:orphan:

===========================================
Configure the Automation Agent for Kerberos
===========================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. include:: /includes/styles/corrections.rst

.. include:: /includes/legacy-agents/fact-automation-agent-deprecated.rst

:product:`MongoDB Enterprise <mongodb-enterprise-advanced>` supports
Kerberos. Kerberos is a network authentication protocol.
{+aagent+} can authenticate to MongoDB instances using
Kerberos.

.. include:: /includes/note-manage-agent-auth-with-automation-kerberos.rst

Prerequisites
-------------

Configure KDC to Issue Tickets with Four-Hour Minimum Lifetime
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Kerberos tickets are only valid, or used to authenticate users, for a
limited time. You must configure the Kerberos Key Distribution Center
(KDC) to issue tickets that are valid for at least four hours. The
Automation Agent periodically renews the ticket. The |kdc| service
provides session tickets and temporary session keys to users and
computers.

Add Kerberos as Authentication Mechanism for Deployment
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/fact-access-control-host-settings.rst

For the purposes of this tutorial, you must ensure your:

- Deployment supports Kerberos authentication and
- Agents use Kerberos authentication.

To learn how to enable Kerberos authentication, see
:doc:`/tutorial/enable-kerberos-authentication-for-group`.

Configure Automation Agent Host to Use Kerberos
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/note-needed-kerberos-files-for-agent.rst

Procedures
----------

Create Kerberos User Principal for the Automation Agent
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/steps/kerberos-create-principal.rst

Create a User and Assign Roles for the Automation Agent UPN
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/fact-kerberos-principal-as-user.rst

From a |mongo| shell connected to your MongoDB deployment, 
issue the following commands to create the users:

.. literalinclude:: /includes/code-examples/create-user.js
   :language: javascript
   :lines: 1,3,6,8-17
   :linenos:

To learn about the required access for the Automation Agent, see 
:doc:`/reference/required-access-monitoring-agent`.

Edit the Automation Agent Configuration File
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Edit the Automation Agent configuration file. The following table lists
the default installation paths for some common platforms. Depending on
your deployment, you may need to substitute the default path for the
custom installation path used for your |mms| agent installation.

.. list-table::
   :header-rows: 1
   :widths: 40 60 

   * - Operating System
     - Path

   * - RHEL, Ubuntu
     - ``/etc/mongodb-mms/monitoring-agent.config``

   * - Linux Archive, macOS
     - ``<userSelected>/monitoring-agent.config``

   * - Windows
     - ``C:\MMSData\Automation\local.config``

.. include:: /includes/steps/kerberos-agent-config-file.rst
