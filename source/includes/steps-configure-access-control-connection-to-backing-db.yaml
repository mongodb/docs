source:
   file: steps-configure-ssl-connection-to-backing-mongodb.yaml
   ref: config-files
ref: config-files
stepnum: 1
---
title: "Configure |onprem| to connect to the |application| database."
stepnum: 2
level: 4
ref: configure-application-access-control
content: |
  :setting:`mongo.mongoUri` contains the connection string used to access
  the :ref:`mms-application-database`.

  The :setting:`mongo.mongoUri` reference provides examples of the
  connection string format for each authentication mechanism and details
  the required permissions for the connecting user.

  For an |application| database using
  Kerberos authentication, the :setting:`mongo.mongoUri` setting
  would resemble:

  .. code-block:: ini

     mongo.mongoUri=mongodb://username%40REALM.example.net@mydb1.example.net:40000/?authMechanism=GSSAPI
---
title: "Configure the Backup Daemon to connect to the |application| database."
stepnum: 3
level: 4
optional: true
ref: configure-daemon-access-control
pre: |
  If you have installed the Backup Daemon,
  you must configure :setting:`mongo.mongoUri` in ``conf-daemon.properties``
  so that the Backup Daemon can connect to the |application| database.
source:
  file: steps-configure-access-control-connection-to-backing-db.yaml
  ref: configure-application-access-control
post: |
  :setting:`mongo.mongoUri` should be idential in both ``conf-mms.properties``
  and ``conf-daemon.properties``.
---
title: "Configure any other authentication mechanism-specific settings in both ``conf-mms.properties`` and ``conf-daemon.properties``."
stepnum: 4
level: 4
ref: configure-auth
action:
  - pre: |
      If you are using Kerberos authentication, you must :ref:`configure
      the Kerberos settings <configuration-kerberos-settings>`,
      as in the following:
    language: ini
    code: |
      jvm.java.security.krb5.kdc=kdc.example.com
      jvm.java.security.krb5.realm=EXAMPLE.COM
      mms.kerberos.principal=mms/mmsweb.example.com@EXAMPLE.COM
      mms.kerberos.keyTab=/path/to/mms.keytab
  - pre: |
      If you are using x.509 Client Certificate Authentication, you must
      also be connecting over SSL. See: :ref:`configure-ssl-backing` for
      the SSL configuration instructions.
---
title: "Restart |onprem| and the Backup Daemon."
stepnum: 5
level: 4
ref: restart-onprem-and-daemon
pre: |
  If the |application| database is running over SSL, you can skip to the
  :ref:`SSL configuration tutorial <configure-ssl-backing>`, and then
  restart |onprem| and the Backup Daemon when you have completed those
  steps.
content: |
  Restart |onprem| and the Backup Daemon using the appropriate command
  for your distribution:

  Installed on Linux with DEB or RPM packages:

  .. code-block:: sh

     sudo service mongodb-mms restart
     sudo service mongodb-mms-backup-daemon restart

  Installed on Linux from an Archive:

  .. code-block:: sh

     <install_dir>/bin/mongodb-mms restart
     <install_dir>/bin/mongodb-mms-backup-daemon restart

  Installed on Windows:

  - Open ``Control Panel``, then ``System and Security``, then
    ``Administrative Tools``, and then ``Services``. In the Services
    list, right-click on the ``MongoDB Ops Manager HTTP Service`` and
    select ``Restart``.

  - On the Backup Daemon server, open ``Control Panel``, then ``System
    and Security``, then ``Administrative Tools``, and then
    ``Services``. Right-click on the ``MMS Backup Daemon Service`` and
    select ``Restart``.
...