================
Modify a Cluster
================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

.. include:: /includes/fact-projects-groups-synonyms.rst

.. note::

   This feature is not available for ``M0`` (Free Tier) clusters, and
   has limited functionality for ``M2`` and ``M5`` clusters. For more
   information, see :ref:`Atlas M0 (Free Tier), M2, and M5 Limitations
   <atlas-free-tier>`.

.. include:: /includes/api-requirements.rst

.. include:: /includes/api-base-url.rst

Syntax
------

.. code-block:: none

   PATCH /api/atlas/v1.0/groups/{GROUP-ID}/clusters/{CLUSTER-NAME}

Request Path Parameters
~~~~~~~~~~~~~~~~~~~~~~~

.. list-table::
   :header-rows: 1
   :widths: 15 10 75

   * - Path Element
     - Required/Optional
     - Description

   * - ``GROUP-ID``

     - Required.

     - The unique identifier for the :ref:`project <group-id>` containing the
       cluster.

   * - ``CLUSTER-NAME``

     - Required

     - The name of the cluster to modify.

Request Body Parameters
~~~~~~~~~~~~~~~~~~~~~~~

.. important::

   If modifying any of the ``providerSettings`` or ``replicationSpec`` values,
   you *must* specify the ``providerSettings.providerName``. For ``M2`` and
   ``M5`` clusters, you must also specify the
   ``providerSettings.backingProviderName``.

   You cannot modify a ``paused`` cluster other than to resume the
   cluster. Nor can you pause a cluster with pending changes.

.. include:: /includes/list-modify-cluster-request-body.rst

HTTP Response Elements
----------------------

.. include:: /includes/list-table-cluster-http-response.rst

Example
-------

Request
~~~~~~~

Single Region Modification Request
++++++++++++++++++++++++++++++++++

.. code-block:: shell

   curl -i -u "{username}:{apiKey}" --digest -H "Content-Type: application/json" -X PATCH "https://cloud.mongodb.com/api/atlas/v1.0/groups/5356823b3794de37132bb7b/clusters/datastore2" --data '
   {
     "diskSizeGB" : 320,
     "providerSettings" : {
       "providerName" : "AWS",
       "diskIOPS" : 2400,
       "encryptEBSVolume" : false,
       "instanceSizeName" : "M40",
       "regionName" : "EU_WEST_1"
     },
     "replicationFactor" : 3,
     "encryptionAtRestProvider" : "AWS"
   }'

Multi Region Modification Request
+++++++++++++++++++++++++++++++++

.. code-block:: shell

   curl -i -u "{username}:{apiKey}" --digest -H "Content-Type: application/json" -X POST "https://cloud.mongodb.com/api/atlas/v1.0/groups/5356823b3794de37132bb7b/clusters" --data '
   {
     "providerSettings" : {
       "providerName" : "AWS",
       "diskIOPS" : 480,
       "instanceSizeName" : "M10"
     },
     "replicationSpec": {
         "US_EAST_1": {
           "electableNodes": 3,
           "priority": 7,
           "readOnlyNodes" : 0
         },
         "US_EAST_2": {
           "electableNodes": 0,
           "priority" : 6,
           "readOnlyNodes" : 2
         },
         "US_WEST_1": {
           "electableNodes" : 0,
           "priority" : 5,
           "readOnlyNodes": 2
         }
      }
      "encryptionAtRestProvider" : "AWS"
   }'

Global Cluster Modification Request
+++++++++++++++++++++++++++++++++++

.. code-block:: shell

   curl -X PATCH -i --digest -u "{username:{apiKey}" -H "Content-Type: application/json" \
    "https://cloud.mongodb.com/api/atlas/v1.0/groups/6c392af480eef519ea5deeb1/clusters/GlobalCluster1?pretty=true" \
    --data '
    {
      "replicationSpecs": [
      {
        "id" : "5b4ccad387d9d64d6e43f881",
        "regionsConfig" : {
          "EU_CENTRAL_1" : {
            "electableNodes" : 3,
            "priority" : 7,
            "readOnlyNodes" : 0
          }
        },
        "zoneName" : "Zone 1"
      }]
    }'

Response
~~~~~~~~

Single Region Modification Response
+++++++++++++++++++++++++++++++++++

.. code-block:: json

   {
     "name" : "datastore2",
     "backupEnabled" : true,
     "biConnector": {
       "enabled": false,
       "readPreference": "secondary"
     },
     "clusterType": "REPLICASET",
     "diskSizeGB" : 320,
     "encryptionAtRestProvider" : "AWS",
     "groupId" : "5356823b3794de37132bb7b",
     "id": "59ef6621c0c6e378559875ed",
     "mongoDBVersion" : "3.2.8",
     "mongoURI" : "mongodb://mongo-shard-00-00.mongodb.net:27017,mongo-shard-00-01.mongodb.net:27017,mongo-shard-00-02.mongodb.net:27017",
     "mongoURIUpdated" : "2017-10-23T21:26:17Z",
     "mongoURIWithOptions" : "mongodb://mongo-shard-00-00.mongodb.net:27017,mongo-shard-00-01.mongodb.net:27017,mongo-shard-00-02.mongodb.net:27017/?ssl=true&authSource=admin&replicaSet=mongo-shard-0",
     "numShards" : 1,
     "paused" : false,
     "providerSettings" : {
       "providerName" : "AWS",
       "diskIOPS" : 2400,
       "encryptEBSVolume" : false,
       "instanceSizeName" : "M40",
       "regionName" : "EU_WEST_1"
     },
     "replicationFactor" : 3,
     "srvAddress" : "mongodb+srv://mongo-shard-00-00.mongodb.net:27017,mongo-shard-00-01.mongodb.net:27017,mongo-shard-00-02.mongodb.net:27017",
     "stateName" : "UPDATING"
   }

Multi Region Modification Response
++++++++++++++++++++++++++++++++++

.. code-block:: json

   {
      "name" : "datastore2",
      "backupEnabled": false,
      "biConnector": {
        "enabled": false,
        "readPreference": "secondary"
      },
      "clusterType": "REPLICASET",
      "diskSizeGB": 160.0,
      "encryptionAtRestProvider" : "AWS",
      "groupId": "5356823b3794de37132bb7b",
      "id": "59ef6621c0c6e378559875ed",
      "links": [{
         "href": "https://cloud.mongodb.com/api/atlas/v1.0/groups/5356823b3794de37132bb7b/clusters/DataStore2",
         "rel": "self"
      }],
      "mongoDBMajorVersion": "3.4",
      "mongoDBVersion": "3.4.9",
      "mongoURI" : "mongodb://mongo-shard-00-00.mongodb.net:27017,mongo-shard-00-01.mongodb.net:27017,mongo-shard-00-02.mongodb.net:27017",
      "mongoURIUpdated" : "2017-10-23T21:26:17Z",
      "mongoURIWithOptions" : "mongodb://mongo-shard-00-00.mongodb.net:27017,mongo-shard-00-01.mongodb.net:27017,mongo-shard-00-02.mongodb.net:27017/?ssl=true&authSource=admin&replicaSet=mongo-shard-0",
      "name": "DataStore2",
      "numShards": 1,
      "paused" : false,
      "providerSettings": {
         "providerName": "AWS",
         "diskIOPS": 480,
         "encryptEBSVolume": true,
         "instanceSizeName": "M10"
      },
      "replicationSpec": {
         "US_EAST_1": {
            "electableNodes": 3,
            "priority": 7,
            "readOnlyNodes": 0
         },
         "US_EAST_2": {
            "electableNodes": 2,
            "priority": 6,
            "readOnlyNodes": 0
         },
         "US_WEST_1": {
            "electableNodes": 2,
            "priority": 5,
            "readOnlyNodes": 2
         }
      },
      "srvAddress" : "mongodb+srv://mongo-shard-00-00.mongodb.net:27017,mongo-shard-00-01.mongodb.net:27017,mongo-shard-00-02.mongodb.net:27017",
      "stateName": "UPDATING"
   }

Global Cluster Modification Response
++++++++++++++++++++++++++++++++++++

.. code-block:: json

   {
     "autoScaling" : {
     "diskGBEnabled" : true
     },
     "backupEnabled" : false,
     "biConnector" : {
       "enabled" : false,
       "readPreference" : "secondary"
     },
     "clusterType" : "GEOSHARDED",
     "diskSizeGB" : 40.0,
     "encryptionAtRestProvider" : "NONE",
     "groupId" : "6c392af480eef519ea5deeb1",
     "id" : "5b4ccb5587d9d64d6e440d04",
     "links" : [ {
       "href" : "https://cloud.mongodb.com/api/atlas/v1.0/groups/6c392af480eef519ea5deeb1/clusters/GlobalCluster1",
       "rel" : "self"
     }, {
       "href" : "https://cloud.mongodb.com/api/atlas/v1.0/groups/6c392af480eef519ea5deeb1/clusters/GlobalCluster1/restoreJobs",
       "rel" : "http://mms.mongodb.com/restoreJobs"
     }, {
       "href" : "https://cloud.mongodb.com/api/atlas/v1.0/groups/6c392af480eef519ea5deeb1/clusters/GlobalCluster1/snapshots",
       "rel" : "http://mms.mongodb.com/snapshots"
     } ],
     "mongoDBMajorVersion" : "3.6",
     "mongoDBVersion" : "3.6.6",
     "mongoURI" : "mongodb://globalcluster1-shard-00-00-mlrwc.mongodb.net:27016,globalcluster1-shard-00-01-mlrwc.mongodb.net:27016,globalcluster1-shard-00-02-mlrwc.mongodb.net:27016,globalcluster1-shard-01-00-mlrwc.mongodb.net:27016,globalcluster1-shard-01-01-mlrwc.mongodb.net:27016,globalcluster1-shard-01-02-mlrwc.mongodb.net:27016",
     "mongoURIUpdated" : "2018-07-16T17:06:18Z",
     "mongoURIWithOptions" : "mongodb://globalcluster1-shard-00-00-mlrwc.mongodb.net:27016,globalcluster1-shard-00-01-mlrwc.mongodb.net:27016,globalcluster1-shard-00-02-mlrwc.mongodb.net:27016,globalcluster1-shard-01-00-mlrwc.mongodb.net:27016,globalcluster1-shard-01-01-mlrwc.mongodb.net:27016,globalcluster1-shard-01-02-mlrwc.mongodb.net:27016/?ssl=true&authSource=admin&replicaSet=GlobalCluster1-shard-0",
     "name" : "GlobalCluster1",
     "paused" : false,
     "providerSettings" : {
       "providerName" : "AWS",
       "diskIOPS" : 120,
       "encryptEBSVolume" : true,
       "instanceSizeName" : "M30"
     },
     "replicationSpecs" : [ {
       "id" : "5b4ccad387d9d64d6e43f881",
       "numShards" : 1,
       "regionsConfig" : {
         "EU_CENTRAL_1" : {
           "electableNodes" : 3,
           "priority" : 7,
           "readOnlyNodes" : 0
         }
       },
       "zoneName" : "Zone 1"
     } ],
     "srvAddress" : "mongodb+srv://globalcluster1-shard-00-00-mlrwc.mongodb.net:27016,globalcluster1-shard-00-01-mlrwc.mongodb.net:27016,globalcluster1-shard-00-02-mlrwc.mongodb.net:27016,globalcluster1-shard-01-00-mlrwc.mongodb.net:27016,globalcluster1-shard-01-01-mlrwc.mongodb.net:27016,globalcluster1-shard-01-02-mlrwc.mongodb.net:27016",
     "stateName" : "UPDATING"
   }

.. [1] .. include:: /includes/extracts/fact-3.2-eol-upgrade.rst
