.. _c-mongodb-search:

==========================
Run a MongoDB Search Query
==========================

.. facet::
   :name: genre
   :values: reference

.. meta::
   :keywords: full text, text analyzer, meta, pipeline, scoring
   :description: Learn about how to use MongoDB Search in the C driver.

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

Overview
--------

In this guide, you can learn how to use the {+driver-short+} to
run :atlas:`{+search+} </atlas-search/>` queries on a collection.
{+search+} enables you to perform full-text searches on collections
hosted on MongoDB Atlas. {+search+} indexes specify the behavior of the
search and which fields to index.

Sample Data
~~~~~~~~~~~

The example in this guide uses the ``movies`` collection in the ``sample_mflix``
database from the :atlas:`Atlas sample datasets </sample-data>`. To learn how to
create a free MongoDB Atlas cluster and load the sample datasets, see the
`Get Started <https://www.mongodb.com/docs/get-started/>`__ guide.

Run a {+search+} Query
--------------------------

This section shows how to create an aggregation pipeline to run a
{+search+} query on a collection. In your ``bson_t`` structure that represents
your pipeline stages, add the ``$search`` stage to specify the search criteria.
Then, call the ``mongoc_collection_aggregate()`` function and pass your pipeline
as a parameter.

.. tip:: 

   To learn more about aggregation operations, see the :ref:`c-aggregation`
   guide. 

Before running a {+search+} query, you must create a {+search+} index
on your collection. To learn how to programmatically create a {+search+}
index, see the :ref:`c-atlas-search-index-create` section of the MongoDB Search
Indexes guide.

{+search+} Example
~~~~~~~~~~~~~~~~~~~~~~~

This example runs a {+search+} query by performing the
following actions:

- Creates a ``$search`` stage that instructs the driver
  to query for documents in which the ``title`` field contains
  the word ``"Alabama"``

- Creates a ``$project`` stage that instructs the driver to
  include the ``title`` field in the query results

- Passes the pipeline stages to the ``mongoc_collection_aggregate()`` function and
  prints the results

.. io-code-block::
   :copyable:

   .. input:: /includes/mongodb-search.c
      :start-after: start-search
      :end-before: end-search
      :language: c
      :dedent:
   
   .. output::
      :language: console
      :visible: false

      { "_id" : { "$oid" : "..." }, "title" : "Alabama Moon" }
      { "_id" : { "$oid" : "..." }, "title" : "Sweet Home Alabama" }
      { "_id" : { "$oid" : "..." }, "title" : "Crazy in Alabama" }

Additional Information
----------------------

To learn more about {+search+}, see :atlas:`{+search+} </atlas-search/>`
in the Atlas documentation.

API Documentation
~~~~~~~~~~~~~~~~~

To learn more about the ``mongoc_collection_aggregate()`` function, see the
`API documentation <{+api-libmongoc+}/mongoc_collection_aggregate.html>`__.
