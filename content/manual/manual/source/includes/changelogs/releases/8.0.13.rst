.. _8.0.13-changelog:

8.0.13 Changelog
----------------

Sharding
~~~~~~~~

:issue:`SERVER-94315` Shard filtering bug with collation

Query
~~~~~

- :issue:`SERVER-98461` findAndModify where query does not have shard
  key does not return WCE on failure
- :issue:`SERVER-103519` Ensure update and bulkWrite commands return WCE
  in sharded cluster case

Storage
~~~~~~~


WiredTiger
``````````

- :issue:`WT-11813` Fix cache_eviction_target_strategy_dirty stat in
  eviction
- :issue:`WT-13612` Time aggregate merge logic incorrect for chunk
  merge, page split scenario
- :issue:`WT-14617` Add stats to track how many times the cache fill
  ratio is reaching the configured trigger values
- :issue:`WT-14649` Track stats to find out cache fill ratio whenever
  app thread eviction requested
- :issue:`WT-14657` Track stats for oldest id rollback due to cache
  stuck

Internals
~~~~~~~~~

- :issue:`SERVER-77172` "abortExpiredTransactions" thread can get stuck
  if it fails to checkout a session
- :issue:`SERVER-82180` Capped inserts on the primary can have a
  different natural ordering from secondaries
- :issue:`SERVER-84081` FLE2 write error hides write concern error
- :issue:`SERVER-89883` removeShard should hint about how to move data
  of tracked unsharded collections
- :issue:`SERVER-90282` Add more diagnostics to tassert failures
- :issue:`SERVER-91686` Improve mongod's signal handler to print out
  current thread's command object
- :issue:`SERVER-92764` Extend diagnostic logging on tassert failure to
  dump contents of CurOp/OpDebug
- :issue:`SERVER-92767` Extend diagnostic logging on tassert failure to
  apply to additional commands
- :issue:`SERVER-94327` Add unittest for killAllExpiredTransactions
- :issue:`SERVER-95134` Add mechanism to avoid asserting while
  extracting debug info within tassert handler
- :issue:`SERVER-96135` Ensure user data is appropriately redacted for
  tassert/invariant log extensions
- :issue:`SERVER-96136` Move ScopedDebugInfo logging after stack trace
  and tassert/invariant message
- :issue:`SERVER-96137` Add runtime knob to disable additional logging
  for tassert/invariant
- :issue:`SERVER-96564` Extend diagnostic logging in
  tassert/invariant/signal handling to apply to additional commands
- :issue:`SERVER-96565` Add an end-to-end mongot passthrough which has a
  single shard
- :issue:`SERVER-96839` Pass writeConcern from UMCs into UMCTransaction
- :issue:`SERVER-97174` validate command on secondaries reads unfinished
  oplog batch
- :issue:`SERVER-98129` Write e2e tests ensuring QE commands are not
  logged by tassert logging mechanism
- :issue:`SERVER-98294` Avoid deadlock state when hitting an invariant
  within the logging code for handling an invariant
- :issue:`SERVER-98465` Improve documentation for ScopedDebugInfo /
  CommandDiagnosticPrinter
- :issue:`SERVER-98655` Test when the removeShard command response
  reaches BSONObjMaxUserSize
- :issue:`SERVER-98667` Consider incrementally logging ScopedDebugInfos
  from the stack
- :issue:`SERVER-98928` Add basic safety checks to command diagnostic
  printer
- :issue:`SERVER-99119` Change geo-related invariants to tasserts
- :issue:`SERVER-99235` removeShard hint follow up task, fix test
  comment
- :issue:`SERVER-99733` Add tests for diagnostic printing on shards
- :issue:`SERVER-99767` Rename CommandDiagnosticPrinter and expose
  eligibility checks
- :issue:`SERVER-99787` Change default value of searchTLSMode from
  disabled to global
- :issue:`SERVER-99868` Improve debuggability of
  batch_write_exec/batch_write_op
- :issue:`SERVER-99915` FLE2 findAndModify should also return WCE from
  transaction API result
- :issue:`SERVER-100421` Resharding failure leads to all values inserted
  as zeroes in atlas log ingestion
- :issue:`SERVER-100528` Investigate all commands that accept write
  concern for WCE handling
- :issue:`SERVER-100872`  Handle V8 int32-to-double coercion in magic
  restore consistency checker
- :issue:`SERVER-100936` Mongos must return WCE as a top-level error for
  create collection
- :issue:`SERVER-100937` Mongos must return WCE on dropIndexes
- :issue:`SERVER-100938` Mongos must return WCE on createIndexes
- :issue:`SERVER-100939` Mongos should return WCE on no-op
  setFeatureCompatibilityVersion
- :issue:`SERVER-100942` setDefaultRWConcernDefault must return WCE
- :issue:`SERVER-100943` abortTransaction must wait for write concern
  and return WCEs on failure
- :issue:`SERVER-100990` Prevent SBE use in cases where $lookup pushdown
  may not use index
- :issue:`SERVER-101043` Fix the list of collections to move returned by
  removeShard
- :issue:`SERVER-101121` Make invariant/signal handler logging output
  valid json
- :issue:`SERVER-101124` Lower the default value of
  remainingReshardingOperationTimeThresholdMillis to 500 milliseconds
- :issue:`SERVER-101135` priority_takeover_two_nodes_equal_priority.js
  should use lower electionTimeoutMillis
- :issue:`SERVER-101238` [v8.0] Backport the removeShard hint about how
  to move data of tracked unsharded collections
- :issue:`SERVER-101363` agg_out.js should tolerate
  CollectionUUIDMismatch errors for $out
- :issue:`SERVER-101381` query_with_txn_prepared.js should relax
  document count check
- :issue:`SERVER-101386` Test all commands that accept write concern
  against timeseries collections
- :issue:`SERVER-101387` Test all commands that accept write concern
  against FLE collections
- :issue:`SERVER-101495` auth_no_pri.js should use a lower
  electionTimeoutMillis
- :issue:`SERVER-101806` Fix command_diagnostics_sharded.js to run
  commands only on mongos
- :issue:`SERVER-101810` Use runtime platform parameters for
  listenBacklog
- :issue:`SERVER-102302` Disable SBE on collections with an index with a
  hashed path prefix of a non-hashed path
- :issue:`SERVER-102428` Logical initial sync allocates double
  maxIndexBuildMemoryUsageMegabytes
- :issue:`SERVER-102439` Data race in writeConflictRetryLimit server
  parameter
- :issue:`SERVER-102477` Revert change preventing tuning
  taskExecutorPoolSize on 7.0+
- :issue:`SERVER-102571` Check against WriteConcernError category when
  processing QE transactions
- :issue:`SERVER-102670` [v8.1] Incorrect ordered time-series insert
  error handling
- :issue:`SERVER-102765` Create collection can be rollbacked and not
  retried on a Replica Set cluster
- :issue:`SERVER-102961` Add reason to setUserWriteBlockMode
- :issue:`SERVER-103249` Skip fast count validation on diagnostic
  logging tests
- :issue:`SERVER-103326` Coverity analysis defect 173263: Dereference
  before null check
- :issue:`SERVER-103664` Ensure Operations Are Quiesced Before Stopping
  Secondaries in
  mongos_writes_wait_for_write_concern_sharded_addl_crud_ops.js
- :issue:`SERVER-103927` [v8.0] switch CI from scons to bazel
- :issue:`SERVER-104220` Router must take into account drop collection
  write concern error
- :issue:`SERVER-104543` Don't fail stacktrace collection if we're
  unable to resolve a symbol
- :issue:`SERVER-104857` Rename search_end_to_end_X suites to
  mongot_e2e_X
- :issue:`SERVER-105528` Fix FLE2 findAndModify write concern error
  reporting in mongod
- :issue:`SERVER-106154` Fix oldest_ts being older than the
  newest_start_durable_ts during export/import
- :issue:`SERVER-106354` Missing resource lock acquisition when applying
  batch of inserts to a capped collection
- :issue:`SERVER-106432` Disable FIPs tests on SLES 15 SP5
- :issue:`SERVER-106487` point_in_time_lookups_drop_pending.js is flaky
  when checking that a PIT read creates a new instance for the
  collection after a drop
- :issue:`SERVER-106492` Include multiplanner metrics in FTDC
- :issue:`SERVER-106577` [v8.0] Prepare SPM-4070 8.0 branch for release
- :issue:`SERVER-106589` New server parameter to provision more memory
  for index builds during initial sync
- :issue:`SERVER-106988` [v8.0] Fix ninja + icecream generation
- :issue:`SERVER-107008` Rely on timeseries::optionsAreEqual when
  comparing timeseries options in checkMetadataConsistency
- :issue:`SERVER-107272` Write Evergreen task for SAST report generation
- :issue:`SERVER-107282` [v8.1] Update CODEOWNERS to expand test-only
  definition
- :issue:`SERVER-107361` Rollover determination in the bucket catalog
  can fail to check mixed schema for large measurements
- :issue:`SERVER-107506` Add knob to toggle ScopedDebugInfo logging in
  signal handlers
- :issue:`SERVER-107698` Fix how "update_sharded.js" sets up its sharded
  collections
- :issue:`SERVER-108062` Remove
  multitenant_pre_image_expired_document_remover.js
- :issue:`SERVER-108091` [v8.0] Fix race in
  jstests/noPassthrough/indexbg_killop_stepdown.js in 7.0 and 8.0
- :issue:`SERVER-108178` [v8.0] Unlink
  s_read_write_concern_defaults_server_status from mongoD
- :issue:`SERVER-108247` [v8.0] Write concern integration tests run all
  commands, leading to high execution runtimes
- :issue:`SERVER-108415` [v8.0] fix push and mongot tasks after bazel
  backport
- :issue:`SERVER-108449` Fix allowed_requesters for SAST report
  generation
- :issue:`SERVER-108473` [v8.0] remove duplicated listing of
  read_write_concern_provenance_test
- :issue:`SERVER-108559` [v8.0] fix compiledb command on 8.0
- :issue:`SERVER-108582` Remove nonexistent PGO step from v8.0 pipeline
- :issue:`SERVER-108615` [v8.0] Remove reference to nonexistent "save
  code coverage data" function
- :issue:`SERVER-108661` Fix MSI packaging to properly write a
  packages.tgz file
- :issue:`SERVER-108778` Fix coverity task to use evergreen
  MONGO_VERSION
- :issue:`SERVER-108786` [v8.0] Fix MacOS community flags in the v8.0
  branch

