==============================
Troubleshoot Connection Issues
==============================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

This page outlines common connection issues and possible resolutions. Detailed
instructions for connecting to an |service| cluster can be found in the
:ref:`Get Started with Atlas <gswa-connect>` tutorial.

.. note::

   If you are an enterprise customer looking for support, please
   `file a ticket <https://docs.atlas.mongodb.com/support/#request-support>`__.
   For community support, visit `Community Support
   Resouces <https://www.mongodb.com/community-support-resources>`__.

Cluster :guilabel:`Connect` button is disabled
----------------------------------------------

Your cluster :guilabel:`Connect` button may be disabled if your
cluster is in the provisioning state. Your cluster needs to provision
when it is first deployed, or when it is
:doc:`scaled up or down </scale-cluster>`. The provisoning process can
take up to 10 minutes, after which the :guilabel:`Connect` button will
become enabled.

Connecting IP address not in IP Access List
-------------------------------------------

Before connecting to your |service| cluster, check that you added your
host's IP address to the :ref:`IP access list <access-list>` for your
cluster's project. |service| allows client connections only from IP
addresses and |cidr| address ranges in the IP access list.

Incorrect connection string format
----------------------------------

The :manual:`connection string format </reference/connection-string/>`
you use to connect to |service| depends on several factors, including:

- Your ``mongo`` shell version. To learn more, see
  :doc:`mongo-shell-connection`.
- Your driver version. To learn more, see :doc:`/driver-connection/`.

Verify your connection string in a test environment before putting
it into production.

Authentication to the cluster failed
------------------------------------

To connect to |service|, you must authenticate with a MongoDB database
user. To create a database user for your cluster, see
:doc:`security-add-mongodb-users/`.

Possible Solutions
~~~~~~~~~~~~~~~~~~

If you have created a user and are having trouble authenticating,
try the following:

- Check that you are using the correct username and password for
  your database user, and that you are connecting to the correct
  cluster.

- Check that you are specifying the correct ``authSource`` database in
  your connection string.

- If you have a special character in your password, see
  :ref:`Special characters in connection string password
  <special-pass-characters>`.

Too many open connections to your cluster
-----------------------------------------

|service| sets the limit for concurrent incoming connections to a
cluster based on the cluster tier. If you try to connect
when you are at this limit, MongoDB displays an error stating
``connection refused because too many open connections``.

For a detailed comparision of cluster tiers and their maximum
concurrent connections, see :ref:`connection-limits`.

Possible Solutions
~~~~~~~~~~~~~~~~~~

- Close any open connections to your cluster not currently in use.

- :doc:`Scale your cluster </scale-cluster>` to a higher tier to
  support more concurrent connections.

- Restart your application.

- To prevent this issue in the future, consider using the
  :urioption:`maxPoolSize` connection string option to limit the
  number of connections in the connection pool.

For more details on fixing this issue, see
:doc:`/reference/alert-resolutions/connection-alerts`.

Attempting to connect to a cluster from behind a firewall
---------------------------------------------------------

|service| clusters operate on port ``27017``. You must be able to reach
this port to connect to your clusters. Additionally, ensure that 
the appropriate ports are open for the following:

- For sharded clusters, grant access to port 27016.

- For :doc:`BI Connector </bi-connection>`, grant access to port 27015.

You can check your ability to reach a port using the third-party 
:guilabel:`Outgoing port tester`. For example, to check your ability to 
reach port 27017, visit http://portquiz.net:27017. 

If you cannot access these ports, check your system firewall settings 
and ensure that they are not blocking access to these ports.

.. _special-pass-characters:

Special characters in connection string password
------------------------------------------------

If you have special characters in your password, you must encode those
characters if using your password in a connection string URI. For a
complete list of special characters and their corresponding encodings,
see the `ASCII Codes Table <https://ascii.cl/>`__. Use the corresponding
:guilabel:`Hex` value for your characters.

You can also use an online tool to encode your connection string,
such as https://www.urlencoder.org/.

.. example::

   If your password in plain-text is ``p@ssw0rd'9'!``, you would need
   to encode your password as:

   .. code-block:: none
      :copyable: false

      p%40ssw0rd%279%27%21

.. important::

   Do not encode special characters in your password if you are using
   your password outside of a connection string URI (for example,
   pasting it into the ``mongo`` shell or MongoDB Compass).

Connection string incompatible with driver version
--------------------------------------------------

If you see this error message, your driver is likely out of date. For
instructions on updating your driver, refer to your specific
:driver:`Driver Documentation <>`.

MongoDB Compass Troubleshooting
-------------------------------

If you are using |compass| to connect to your cluster, you can visit
the :compass:`Compass Connection Errors
</current/troubleshooting/connection-errors/>` page for additional
troubleshooting resources.
