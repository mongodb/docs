.. _equals-ref:

======
equals
======

.. default-domain:: mongodb

.. meta::
   :keywords: atlas search, equals operator, equals, search equals operator, Atlas search equals operator, query Boolean values, query arrays, query object id, query Int32, query Int64, query Double, query DateTime, Boolean queries, array queries, object id queries, numeric queries, search operators, search operators for arrays, search array operators
   :description: Learn how to find fields whose values match a specific value so that Atlas Search can add those documents to the result set.


.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

Definition
----------

.. expression:: equals

   The ``equals`` operator checks whether a field matches a value
   you specify. ``equals`` supports querying the following data types:
   
   - :ref:`boolean <boolean-ref>`
   - :ref:`objectId <objectId-ref>`
   - :ref:`number <bson-data-types-number>`, including ``int32``,
     ``int64``, and ``double``
   - :ref:`date <bson-data-types-date>`
     
   You can use the ``equals`` operator to query booleans, objectIds,
   numbers, and dates in arrays. If at least one element in the array
   matches the "value" field in the ``equals`` operator, |fts| adds the
   document to the result set.

   .. note::

      The ``equals`` operator supports numbers up to 15 decimal digits.
      Additional decimal digits in documents or queries can cause
      precision issues or query inaccuracy.

.. _equals-syntax:

Syntax
------

``equals`` has the following syntax:

.. code-block:: javascript
   :copyable: false

   {
      $search: {
         "index": <index name>, // optional, defaults to "default"
         "equals": {
            "path": "<field-to-search>",
            "value": <boolean-value>|<objectId>|<number>|<date>,
            "score": <score-options>
         }
      }
   }

Options
-------

``equals`` uses the following terms to construct a query:

.. list-table::
   :header-rows: 1
   :widths: 10 20 60 10

   * - Field
     - Type
     - Description
     - Required?

   * - ``path``
     - string
     - Indexed field to search.
     - yes

   * - ``value``
     - :ref:`boolean <boolean-ref>`, :ref:`objectId <objectId-ref>`, 
       :ref:`number <bson-data-types-number>`, or :ref:`date <bson-data-types-date>`
     - Value to query for.
     - yes

   * - ``score``
     - object
     - Score assigned to matching search term results. Use one of the
       following options to modify the score:

       - ``boost``: multiply the result score by the given number.
       - ``constant``: replace the result score with the given number.

       For information on using ``score`` in your query, see
       :ref:`scoring-ref`.
     - no

Behavior
--------

``equals`` uses constant scoring. Each matching document receives
a score of ``1`` for each search clause matched. A document that matches
one search clause receives a score of ``1``, while a document that 
matches three search clauses receives a score of ``3``. See the
:ref:`equals-query-examples` section for scoring examples.

.. _equals-query-examples:

Examples
--------

The examples on this page use a collection named ``users`` containing 
the following three documents:

.. include:: /includes/atlas-search-op-insert-syntax.rst
             
.. code-block:: json
   :copyable: false

   {
     "_id" : ObjectId("5ed698faa1199b471010d70c"),
     "name" : "Jim Hall",
     "verified_user" : true,
     "account" : {
      "new_user" : true,
      "active_user" : true
     },
     "teammates" : [
      ObjectId("5ed6990aa1199b471010d70d"),
      ObjectId("59b99dbdcfa9a34dcd7885c8")
     ],
     "region" : "East",
     "account_created" : 2021-12-12T10:18:27.000+00:00,
     "employee_number" : 257
   }
   {
     "_id" : ObjectId("5ed6990aa1199b471010d70d"),
     "name" : "Ellen Smith",
     "verified_user" : true,
     "account" : {
      "new_user" : false,
      "active_user" : true
     },
     "teammates" : [
      ObjectId("5a9427648b0beebeb69537a5"),
      ObjectId("59b99dbdcfa9a34dcd7881d1")
     ],
     "region" : "Southwest",
     "account_created" : 2022-05-04T05:01:08.000+00:00,
     "employee_number" : 258
   }
   {
     "_id" : ObjectId("5ed6994fa1199b471010d70e"),
     "name" : "Fred Osgood",
     "verified_user" : false,
     "account" : {
      "new_user" : false,
      "active_user" : false
     },
     "teammates" : [
      ObjectId("5a9427648b0beebeb69589a1"),
      ObjectId("59b99dbdcfa9a34dcd7897d3")
     ],
     "region" : "Northwest",
     "account_created" : 2022-01-19T08:22:15.000+00:00
     "employee_number" : 259
   }

The ``users`` collection is indexed with the following 
:ref:`index definition <ref-index-definitions>`:

.. code-block:: javascript

   {
     "mappings": {
       "dynamic": false,
       "fields": {
         "account": {
           "dynamic": true,
           "type": "document"
         },
         "teammates": {
           "type": "objectId"
         },
         "verified_user": {
           "type": "boolean"
         },
         "region": {
           "type": "string"
         },
         "account_created" : {
           "type": "date"
         },
         "employee_number" : {
           "type": "number"
         }      
       }
     }
   }

Basic Examples
~~~~~~~~~~~~~~

.. _equals-boolean-example:

Boolean Examples
````````````````

The following example uses the ``equals`` operator to search the 
``users`` collection for documents in which the ``verified_user`` field 
is set to ``true``.

.. code-block:: javascript

   db.users.aggregate([
     {
       "$search": {
         "equals": {
           "path": "verified_user",
           "value": true
         }
       }
     },
     {
       "$project": { 
         "name": 1, 
         "_id": 0, 
         "score": { "$meta": "searchScore" }
       }
     }
   ])

The above query returns the following results:

.. code-block:: javascript

   { "name" : "Jim Hall", "score" : 1 }
   { "name" : "Ellen Smith", "score" : 1 }

The documents for "Jim Hall" and "Ellen Smith" each receive a score of ``1``
because those documents have the ``verified_user`` field set to ``true``.

The following example uses the ``equals`` operator to search the 
``users`` collection for documents in which the ``account.new_user`` 
field contains the boolean value ``true``.

.. code-block:: javascript

   db.users.aggregate([
     {
       "$search": {
         "equals": {
           "path": "account.new_user",
           "value": true
         }
       }
     }
   ])

The above query returns the document for "Jim Hall", because that 
document contains ``"new_user": true`` in the ``account`` object.

.. _equals-objectid-example:

ObjectId Example
````````````````

The following example uses the ``equals`` operator to search the ``users``
collection for documents in which the ``teammates`` field contains the value
``ObjectId("5a9427648b0beebeb69589a1")``.

.. code-block:: javascript

   db.users.aggregate([
     {
       "$search": {
         "equals": {
           "path": "teammates",
           "value": ObjectId("5a9427648b0beebeb69589a1")
         }
       }
     }
   ])

The above query returns the document for "Fred Osgood", because that document
contains ``ObjectId("5a9427648b0beebeb69589a1")`` in the ``teammates`` array.

Date Example
````````````

The following example uses the ``equals`` operator to search the 
``users`` collection for documents in which the ``account_created`` 
field contains the value that matches ``ISODate("2022-05-04T05:01:08.000+00:00")``.

.. code-block:: javascript

   db.users.aggregate([
     {
       "$search": {
         "equals": {
           "path": "account_created",
           "value": ISODate("2022-05-04T05:01:08.000+00:00")
         }
       }
     }
   ])

The above query returns the document for "Ellen Smith", because that 
document contains ``"account_created": 2022-05-04T05:01:08.000+00:00``.

.. _equals-number-example:

Number Example
``````````````

The following example uses the ``equals`` operator to search the 
``users`` collection for documents in which the ``employee_number`` 
field contains the value that matches ``259``.

.. code-block:: javascript

   db.users.aggregate([
     {
       "$search": {
         "equals": {
           "path": "employee_number",
           "value": 259
         }
       }
     }
   ])

The above query returns the document for "Fred Osgood", because that 
document contains ``"employee_number": 259``.

.. _equals-compound-query-example:

Compound Examples
~~~~~~~~~~~~~~~~~

The following example uses the :ref:`compound <compound-ref>` operator 
in conjunction with ``must``, ``mustNot``, and ``equals`` to search for 
documents in which the ``region`` field is ``Southwest`` and the 
``verified_user`` field is not ``false``.

.. code-block:: javascript

   db.users.aggregate([
     {
       "$search": {
         "compound": {
           "must": {
             "text": {
               "path": "region",
               "query": "Southwest"
             }
           },
           "mustNot": {
             "equals": {
               "path": "verified_user",
               "value": false
             }
           }
         }
       }
     }
   ])

The above query returns the document for "Ellen Smith", which is the 
only one in the collection which meets the search criteria.

The following example query has these search criteria:

- The ``verified_user`` field must be set to ``true``
- One of the following must be true:

  - The ``teammates`` array contains the value ``ObjectId("5ed6990aa1199b471010d70d")``
  - The ``region`` field is set to ``Northwest``

.. code-block:: javascript

   db.users.aggregate([
     {
       "$search": {
         "compound": {
           "must": {
             "equals": {
               "path": "verified_user",
               "value": true
             }
           },
           "should": [
             {
               "equals": {
                 "path": "teammates",
                 "value": ObjectId("5ed6990aa1199b471010d70d")
               }
             },
             {
               "text": {
                 "path": "region",
                 "query": "Northwest"
               }
             }
           ],
           "minimumShouldMatch": 1
           }
         }
       },
       {
         "$project": { 
           "name": 1, 
           "_id": 0, 
           "score": { "$meta": "searchScore" }
         }
       }
   ])

The above query returns the following results:

.. code-block:: javascript

   { "name" : "Jim Hall", "score" : 2 }

The document for "Jim Hall" receives a score of ``2`` because it meets the
requirements for the ``must`` clause and the first of the two ``should`` clauses.

You can search for multiple ObjectIDs with a compound query. The following
example query uses the ``compound`` operator with a ``should`` clause
to search for three different ObjectIDs, at least two of which must appear
to satisfy the query.

.. code-block:: javascript

   db.users.aggregate([
     {
       "$search": {
         "compound": {
           "should": [
             {
               "equals": {
                 "path": "teammates",
                 "value": ObjectId("5a9427648b0beebeb69537a5")
               }
             },
             {
               "equals": {
                 "path": "teammates",
                 "value": ObjectId("59b99dbdcfa9a34dcd7881d1")
               }
             },
             {
               "equals": {
                 "path": "teammates",
                 "value": ObjectId("5a9427648b0beebeb69579d0")
               }
             }
           ],
           "minimumShouldMatch": 2
           }
         }
       },
       {
         "$project": { 
           "name": 1, 
           "_id": 0, 
           "score": { "$meta": "searchScore" }
         }
       }
   ])

The above query returns the following results:

.. code-block:: javascript

   { "name" : "Ellen Smith", "score" : 2 }

The document for "Ellen Smith" receives a score of ``2`` because it contains
two of the specified ObjectIDs in its ``teammates`` array.
