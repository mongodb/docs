.. _bson-data-types-vector:

==========================
How to Index Vector Fields 
==========================

.. default-domain:: mongodb

.. meta::
   :description: Use the vector field type to index vector embeddings.
   :keywords: vector, vector field type, MongoDB Search field type, vector search, field type for indexing array of double or integer values, field type for indexing vector embeddings

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

.. |fts-field-type| replace:: ``vector``
.. |properties-link| replace:: :ref:`Field Properties <fts-vector-field-type-properties>`

.. composable-tutorial::
   :options: interface, language
   :defaults: driver, python

   You can use the ``vector`` type to index vector embeddings. The
   vector field must contain an array of :ref:`numbers 
   <bson-data-types-number>` of the following types:

   - |bson| ``int32``, ``int64``, or ``double`` data types
   - |bson| ``double`` data type  

   You can use the :ref:`vectorSearch <fts-vectorSearch-ref>` operator,
   similar to the :pipeline:`$vectorSearch` stage, in your
   :pipeline:`$search` aggregation pipeline to query fields indexed as
   the ``vector`` type. 

   .. fts-vector-field-type-limitations:

   ``vector`` Type Limitations 
   ---------------------------

   The following limitations apply:

   - You can't index fields with arrays of objects (|fts|
     ``embeddedDocuments`` type) as ``vector`` type. 
   - You can't set :ref:`storedSource <fts-stored-source-definition>` to
     ``true`` in index definitions that contain ``vector`` type. Instead,
     use ``include`` to specify the fields to store on ``mongot`` or use
     ``exclude`` to exclude the ``vector`` type field from storage.
   - You can't use the :pipeline:`$vectorSearch` stage to query fields
     indexed as the ``vector`` type.
   - You can index fields as the ``vector`` type in the {+playground+}.

   .. fts-vector-field-type-syntax:

   Define the Index for the ``vector`` Type
   ----------------------------------------

   .. selected-content:: 
      :selections: atlas-admin-api, None

      .. include:: /includes/fts/field-types/vector/steps-create-index-admin-api.rst

   .. selected-content::
      :selections: atlas-cli, None

      .. include:: /includes/fts/field-types/vector/steps-create-index-atlas-cli.rst

   .. selected-content::
      :selections: compass, None

      .. include:: /includes/fts/field-types/vector/steps-create-index-compass.rst

   .. selected-content::
      :selections: mongosh, None

      .. include:: /includes/fts/field-types/vector/steps-create-index-mongosh.rst

   .. selected-content::
      :selections: atlas-ui, None

      .. include:: /includes/fts/field-types/vector/steps-create-index-atlas-ui.rst

   .. selected-content::
      :selections: driver, c
   
      .. include:: /includes/fts/field-types/vector/steps-create-index-c.rst

   .. selected-content::
      :selections: driver, csharp

      .. include:: /includes/fts/field-types/vector/steps-create-index-csharp.rst

   .. selected-content::
      :selections: driver, cpp

      .. include:: /includes/fts/field-types/vector/steps-create-index-cpp.rst

   .. selected-content::
      :selections: driver, go

      .. include:: /includes/fts/field-types/vector/steps-create-index-go.rst

   .. selected-content::
      :selections: driver, java-sync       

      .. include:: /includes/fts/field-types/vector/steps-create-index-java.rst

   .. selected-content::
      :selections: driver, nodejs

      .. include:: /includes/fts/field-types/vector/steps-create-index-node.rst

   .. selected-content::
      :selections: driver, python
            
      .. include:: /includes/fts/field-types/vector/steps-create-index-python.rst

   .. _fts-vector-field-type-properties:

   Configure ``vector`` Field Properties
   -------------------------------------
   
   .. include:: /includes/fts/field-types/vector/field-properties-table.rst

   .. _fts-vector-field-type-example:

   Try an Example for the ``vector`` Type
   --------------------------------------

   The following index definition example uses the
   ``sample_mflix.embedded_movies`` collection in the :ref:`sample data
   <sample-data>`. After you load the collection, you can use the
   following example to index the ``plot_embedding_voyage_3_large``
   field as the ``vector`` type for running queries using the 
   :ref:`fts-vectorSearch-ref`. For a sample query to run against this
   index, see :ref:`fts-vectorSearch-egs`.  

   This index definition automatically indexes all the :ref:`dynamically
   <fts-dynamic-mappings>` indexable fields using the :ref:`default
   <fts-enable-dynamic-mappings>` ``typeSet`` and also indexes the
   ``plot_embedding_voyage_3_large`` field as ``vector`` type with the
   following settings:   
   
   - ``2048`` number of dimensions
   - ``dotProduct`` similarity function
   - ``scalar`` quantization

   .. selected-content:: 
      :selections: atlas-admin-api, None

      .. io-code-block:: 
         :copyable: true

         .. input:: /includes/fts/field-types/vector/simple-index-api.sh
            :language: shell
            :linenos:
         
         .. output:: 
            :visible: false

            {"collectionName":"embedded_movies","database":"sample_mflix","indexID":"687a8ce25532743c25aa2d34","latestDefinition":{"mappings":{"dynamic":true,"fields":{"plot_embedding_voyage_3_large":{"numDimensions":2048,"quantization":"scalar","similarity":"dotProduct","type":"vector"}}}},"latestDefinitionVersion":{"version":0},"name":"default","queryable":false,"status":"PENDING","type":"search"}

   .. selected-content::
      :selections: atlas-cli, None

      .. literalinclude:: /includes/fts/field-types/vector/simple-index-cli.json
         :language: json
         :linenos:
         :copyable: true

   .. selected-content::
      :selections: compass, None

      .. literalinclude:: /includes/fts/field-types/vector/simple-index-compass.json
         :language: json
         :linenos:
         :copyable: true

   .. selected-content::
      :selections: mongosh, None

      .. literalinclude:: /includes/fts/field-types/vector/simple-index-mongosh.js
         :language: javascript
         :linenos:
         :copyable: true

   .. selected-content::
      :selections: atlas-ui, None

      .. literalinclude:: /includes/fts/field-types/vector/simple-index-ui.json
         :language: json
         :linenos:
         :copyable: true 

   .. selected-content::
      :selections: driver, c

      .. literalinclude:: /includes/fts/field-types/vector/simple_index.c
         :language: c
         :linenos:
         :copyable: true 

   .. selected-content::
      :selections: driver, csharp

      .. literalinclude:: /includes/fts/field-types/vector/SimpleIndex.cs
         :language: csharp
         :linenos:
         :copyable: true 

   .. selected-content::
      :selections: driver, cpp

      .. literalinclude:: /includes/fts/field-types/vector/SimpleIndex.cpp
         :language: cpp
         :linenos:
         :copyable: true    

   .. selected-content::
      :selections: driver, go

      .. literalinclude:: /includes/fts/field-types/vector/simple_index.go
         :language: go
         :linenos:
         :copyable: true 

   .. selected-content::
      :selections: driver, java-sync

      .. literalinclude:: /includes/fts/field-types/vector/SimpleIndex.java
         :language: java
         :linenos:
         :copyable: true      

   .. selected-content::
      :selections: driver, nodejs

      .. literalinclude:: /includes/fts/field-types/vector/simple_index.js     
         :language: javascript
         :linenos:
         :copyable: true     

   .. selected-content::
      :selections: driver, python

      .. literalinclude:: /includes/fts/field-types/vector/simple_index.py  
         :language: python
         :linenos:
         :copyable: true   
      