===============
Install PyMongo
===============

.. admonition:: Install PyMongo on Windows

   If you are installing the |monitoring| agent on windows, please see
   the :doc:`/monitoring/tutorial/install-the-mms-agent-on-windows`
   document for complete Windows documentation.

Install Python Requirements
---------------------------

Install  `setuptools <http://pypi.python.org/pypi/setuptools>`_,
which you will use to install the remaining dependencies. Most
operating systems provide packages for ``setuptools``.

.. example::

   Debian and Ubuntu users can use the following command to
   install the package:

   .. code-block:: sh

      sudo apt-get install python-setuptools

   Red Hat Enterprise Linux (RHEL) CentOS, or Fedora users can use
   the following command to install the package:

   .. code-block:: sh

      sudo yum install python-setuptools

If your system runs Python 2.4, complete the
:doc:`Additional Requirements for Python 2.4
</monitoring/tutorial/install-python-2.4-requirements>` before
continuing.

Easy Installation
-----------------

.. start-content

While the C extensions are not required for |monitoring|, they
significantly improve performance. To install these extensions, make
sure you have a C compiler (e.g. ``gcc``) and Python header files
installed on your system. Debian and Ubuntu users should issue the
following command:

.. code-block:: sh

   sudo apt-get install build-essential python-dev

Red Hat, CentOS, and Fedora Users should issue the following
command:

.. code-block:: sh

   sudo yum install gcc python-devel

If you have not installed ``pymongo`` issue the
following command to install the latest version:

.. code-block:: sh

   sudo easy_install pymongo

To upgrade to the latest version of the driver, use the following
command:

.. code-block:: sh

   sudo easy_install -U pymongo

For more information concerning PyMongo installation, see `the
PyMongo documentation <http://api.mongodb.org/python/current/installation.html>`_.

.. end-content

.. _installing-pymongo-c-extensions:

Install the PyMongo C Extensions
--------------------------------

If you installed PyMongo *with* the C extensions (i.e. on a
system with a C compiler, or using the Windows installer) then you can
disregard this section. Otherwise use the following procedure to
reinstall your agent with C extensions.

1. Install ``gcc``, a C compiler, and the necessary development
   packages:

   Debian and Ubuntu users should issue the following command:

   .. code-block:: sh

      sudo apt-get install build-essential python-dev

   Red Hat, CentOS, and Fedora Users should issue the following
   command:

   .. code-block:: sh

      sudo yum install gcc python-devel

2. Install the ``pip`` utility so that you can uninstall the existing
   instance of PyMongo, by issuing the following command:

   .. code-block:: sh

      sudo easy_install pip

3. Remove the existing copy of PyMongo with the following command:

   .. code-block:: sh

      sudo pip uninstall pymongo

4. Now re-install PyMongo with the following command:

   .. code-block:: sh

      sudo pip install pymongo

After upgrading PyMongo, you will need to restart your Monitoring agent
to receive the full effect of the improvement.

.. note::

   When you restart your agent there is a 5 minute timeout before the
   agent will begin sending data to MMS again.

.. _building-pymongo-packages-with-c:

Build PyMongo Packages with PyMongo C Extensions
------------------------------------------------

If you are installing PyMongo and the Monitoring agent on systems that
*do not have* C compilers, you can create a ``.egg`` package of PyMongo
with C extensions to install on your system or systems.

.. note::

   The `packages distributed in PyPI <http://pypi.python.org/pypi/pymongo>`_
   for Windows include C extensions.

First, on a system that has a C-compiler, download the PyMongo source.
Always download the source for the latest version of the driver, which
you can find at the `PyMongo page on PyPi <http://pypi.python.org/pypi/pymongo>`_.

The following example uses version 2.6.2. Issue the following command:

.. code-block:: sh

   curl http://pypi.python.org/packages/source/p/pymongo/pymongo-2.6.2.tar.gz > pymongo-2.6.2.tar.gz

.. note::

   To install a C-compiler (i.e. ``gcc``) and the necessary
   dependencies, Debian and Ubuntu users should issue the following
   command:

   .. code-block:: sh

      sudo apt-get install build-essential python-dev

   Red Hat, CentOS, and Fedora Users should issue the following
   command:

   .. code-block:: sh

      sudo yum install gcc python-devel

Extract the driver as follows:

.. code-block:: sh

   tar -zxvf pymongo-2.6.2.tar.gz

Change directories and build the ``.egg`` package with the following
sequence:

.. code-block:: sh

   cd pymongo-2.6.2
   python setup.py bdist_egg

You can find  ``.egg`` file in the ``dist/`` sub-directory. The file
name will resemble "``pymongo-2.6.2-py2.7-linux-x86_64.egg``" but may
have a different name depending on your platform and the version of
python you use to compile.

.. warning::

   These "binary distributions," will only work on systems that
   resemble the environment on which you built the package. In other
   words, ensure that operating systems, versions of Python, and
   architecture (i.e. "32" or "64" bit) match.

Copy this file to the target system and issue the following command to
install the package (with root or "``sudo``" privileges):

.. code-block:: sh

   easy_install pymongo-2.6.2-py2.7-linux-x86_64.egg
