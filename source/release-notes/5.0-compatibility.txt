====================================
Compatibility Changes in MongoDB 5.0
====================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

The following 5.0 changes can affect compatibility with older
versions of MongoDB.


Removed Commands
----------------

Starting in MongoDB 5.0, these these database commands and
:binary:`~bin.mongo` shell helper methods are removed:

.. list-table::
   :header-rows: 1

   * - Removed Command
     - Alternative

   * - :method:`db.collection.ensureIndex()`
     - :method:`db.collection.createIndex()`

   * - :method:`db.resetError()`
     - Not available

   * - :dbcommand:`resetError`
     - Not available

   * - :dbcommand:`shardConnPoolStats`
     - :dbcommand:`connPoolStats`

   * - :dbcommand:`unsetSharding`
     - Not available

Removed Parameters
------------------

.. include:: /includes/5.0-changes/removed-parameters.rst

Removed Metrics
---------------

Starting in MongoDB 5.0, the :dbcommand:`serverStatus` command does not
output :serverstatus:`opReadConcernCounters`, which contained the
:ref:`read concern level <read-concern-levels>` specified by query
operations. Instead, the new :serverstatus:`readConcernCounters`
replaces :serverstatus:`opReadConcernCounters` and contains additional
information.

Starting in MongoDB 5.0, the :dbcommand:`serverStatus` command does not
output the ``cache pressure percentage threshold`` and the
``current cache pressure percentage`` under
``wiredTiger.snapshot-window-settings``.

Tools Changes
-------------

Replica Sets
------------

Starting in MongoDB 5.0, :rsconf:`~members[n].secondaryDelaySecs`
replaces ``slaveDelay``. This change is not backwards compatible. 

Manual Oplog Writes
~~~~~~~~~~~~~~~~~~~

Starting in MongoDB 5.0, it is no longer possible to perform manual
write operations to the :doc:`oplog </core/replica-set-oplog>` on a
cluster running as a :ref:`replica set <replication>`. Performing write
operations to the oplog when running as a
:term:`standalone instance <standalone>` should only be done with
guidance from MongoDB Support.

Projection Compatibility Changes
--------------------------------

Map Reduce Changes
------------------

Read Concern `Snapshot` on Capped Collections
---------------------------------------------

.. include:: /includes/extracts/transactions-capped-collection-read-change.rst

Update Operator Changes
-----------------------

Starting in MongoDB 5.0, :binary:`~bin.mongod` no longer raises
an error when you use the following update operators with an empty
operand expression ( ``{ }`` ):

- :update:`$addToSet`
- :update:`$bit`
- :update:`$currentDate`
- :update:`$inc`
- :update:`$max`
- :update:`$min`
- :update:`$mul`
- :update:`$pop`
- :update:`$pull`
- :update:`$pullAll`
- :update:`$push`
- :update:`$rename`
- :update:`$set`
- :update:`$setOnInsert`
- :update:`$unset`

An empty update results in no changes and no :term:`oplog` entry is
created (meaning that the operation is a no-op).

General Changes
---------------

- .. include:: /includes/5.0-changes/no-direct-write-system-views.rst

- Starting in MongoDB 5.0, the :dbcommand:`reIndex` command and the
  :method:`db.collection.reIndex()` shell method may only be run on
  :term:`standalone` instances.

- Starting in MongoDB 5.0, the number of :doc:`aggregation pipeline
  stages </reference/operator/aggregation-pipeline>` allowed in a single
  pipeline is limited to 1000.

- MongoDB 5.0 removes the ``--serviceExecutor`` command-line option and
  the corresponding ``net.serviceExecutor`` configuration option.

Deprecations
~~~~~~~~~~~~

- :method:`db.printSlaveReplicationInfo()`

  .. include:: /includes/deprecated-db.printSlaveReplicationInfo.rst

- :method:`rs.printSlaveReplicationInfo()`

  .. include:: /includes/deprecated-rs.printSlaveReplicationInfo.rst

5.0 Feature Compatibility
-------------------------
