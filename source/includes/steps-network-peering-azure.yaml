---
ref: nav-to-peering-connection
inherit:
  file: steps-source-project-nav.yaml
  ref: project-nav-peering-connection
title: "In |service|, add a new network peering connection for your project."
stepnum: 1
---
ref: configure-peering-connection
level: 4
stepnum: 2
title: "In |service|, configure your network peering connection."
content: |

  .. important::
  
     If you have |service| deployments in multiple regions, you must create a 
     peering connection for each |service| region. For example, if you have a |vpc| 
     in Sydney and |service| deployments in Sydney and Singapore, 
     create two peering connections. 

     To configure the |service| region, fill in the 
     :guilabel:`Atlas Vnet Region` field in the :guilabel:`Peering Connection` 
     modal.

  a. In the :guilabel:`Peering Connection` modal, select
     :guilabel:`Azure` and click :guilabel:`Next`.

  #. To create the Network Peering connection, fill in the
     requested information:

     .. list-table::
        :header-rows: 1
        :widths: 35 65

        * - Field
          - Description

        * - :guilabel:`Subscription ID`
          - Unique identifier for your Azure subscription. You
            can find this information on the :guilabel:`Overview` tab of your
            Azure :guilabel:`Virtual networks` dashboard.

        * - :guilabel:`Directory ID`
          - Unique identifier of your Azure directory. You
            can find this information on the
            :guilabel:`Properties` tab of your
            :guilabel:`Azure Active Directory` dashboard.

        * - :guilabel:`Resource Group Name`
          - Unique identifier of the Azure resource group to
            which the virtual network belongs. You can find this
            information on the :guilabel:`Overview` tab of your
            Azure virtual network.

        * - :guilabel:`VNet Name`
          - Name of your Azure virtual network. You can find
            this information on the :guilabel:`Virtual networks`
            dashboard.

        * - :guilabel:`Atlas CIDR`
          - |cidr| block for your Atlas cluster.

            .. include:: /includes/fact-peering-azure-atlas-cidr-block.rst

        * - :guilabel:`Atlas VNet Region`
          - Azure region in which your |service| cluster
            resides.

  #. Click :guilabel:`Next`.

---
ref: configure-peering-connection-azure
level: 4
stepnum: 3
title: "In |azure|, create the peering request."
content: |

  You must grant |service| the
  following permissions on the virtual network. You can revoke
  these permissions after the VNet peering has been
  established.

  - ``Microsoft.Network/virtualNetworks/virtualNetworkPeerings/read``

  - ``Microsoft.Network/virtualNetworks/virtualNetworkPeerings/write``

  - ``Microsoft.Network/virtualNetworks/virtualNetworkPeerings/delete``

  - ``Microsoft.Network/virtualNetworks/peer/action``

  To grant |service| permission to create a peering
  connection with your Azure virtual network:

  a. Launch the Azure console.

  #. Run the commands from the :guilabel:`Peering Connection`
     modal to create a service principal, create a new custom
     role, and assign the custom role to the service
     principal.

     .. note::

        Run the first command to create a service principal
        only once for all Azure VNets from the same Azure
        subscription.

  #. Click :guilabel:`Validate`.

  #. Click :guilabel:`Initiate Peering`.

...
