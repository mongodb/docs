title: Shut down the entire replica set.
stepnum: 1
ref: shutdown-replica-set
pre: |
  Shut down the replica set's :program:`mongod` processes using one of the
  following methods, depending on your configuration:


  - **Automated Deployment**:

    If you use |mms| Automation to manage the replica set, you must shut
    down through the |mms| console. See :doc:`/tutorial/shut-down-deployment`.

  - **Non-Automated Deployment on MongoDB 2.6 or Later**:

    Connect to each member of the set and issue the following:

    .. code-block:: javascript

       use admin
       db.shutdownServer()

  - **Non-Automated Deployment on MongoDB 2.4 or earlier**:

    Connect to each member of the set and issue the following:

    .. code-block:: javascript

       use admin
       db.shutdownServer( { force: true } )

---
title: "Restore the snapshot data files to the primary."
stepnum: 2
ref: copy
action:
  pre: |
    Extract the data files to the location where the :program:`mongod`
    process will access them through the :setting:`dbpath` setting. If you
    are restoring to existing hardware, use a different data directory than
    used previously. The following are example commands:
  language: sh
  code: |
    tar -xvf <backupRestoreName>.tar.gz
    mv <backupRestoreName> /data
---
title: "Start the primary with the new :setting:`dbpath`."
stepnum: 3
ref: start-with-new-path
action:
  pre: |
    For example:
  language: sh
  code: |
    mongod --dbpath <pathToData> --replSet <replicaSetName> --logpath <pathToData>/mongodb.log --fork
---
title: "Connect to the primary and initiate the replica set."
stepnum: 4
ref: initiate
action:
  - pre: |
      For example, first issue the following to connect:
    language: sh
    code: |
      mongo
  - pre: |
      And then issue :method:`rs.initiate()`:
    language: javascript
    code: |
      rs.initiate()
---
title: "Restart the primary as a standalone, *without* the ``--replSet`` option."
stepnum: 5
ref: restart-as-standalone
pre: |
  Use the following sequence:

  a. Shut down the process using one of the following methods:

     - **Automated Deployment**:

       Shut down through the |mms| console. See :doc:`/tutorial/shut-down-deployment`.

     - **Non-Automated Deployment on MongoDB 2.6 or Later**:

       .. code-block:: javascript

          use admin
          db.shutdownServer()

     - **Non-Automated Deployment on MongoDB 2.4 or earlier**:

       .. code-block:: javascript

          use admin
          db.shutdownServer( { force: true } )

  b. Restart the process as a standalone:

     .. code-block:: javascript

        mongod --dbpath /<pathToData> --logpath /<pathToData>/mongodb.log --fork
---
title: "Connect to the primary and drop the :term:`oplog`."
stepnum: 6
ref: drop-oplog
action:
  - pre: |
      For example, first issue the following to connect:
    language: sh
    code: |
      mongo
  - pre: |
      And then issue :method:`rs.drop()` to drop the oplog.
    language: javascript
    code: |
      use local
      db.oplog.rs.drop()
---
title: "Run the ``seedSecondary`` script on the primary."
stepnum: 7
ref: seed
action: 
  - pre: |
      Use the appropriate script for your operating system:

      .. list-table::
         :widths: 40 60

         * - UNIX-based
           - ``seedSecondary.sh``

         * - Windows
           - ``seedSecondary.bat``

      This script recreates the oplog collection and seeds it with the
      timestamp of the snapshot's creation. This allows the secondary to come
      back up to time without requiring a full initial sync. |mms| customizes
      this script for this particular snapshot and is included in the backup
      restore file.

  - pre: |
      To run the script, issue the following command, where:

      .. list-table::
         :widths: 40 60

         * - ``<mongodPort>``
           - The port of the :program:`mongod` process

         * - ``<oplogSizeInGigabytes>``
           - The size of the replica set's oplog

         * - ``<replicaSetName>``
           - The name of the replica set

         * - ``<primaryHost:primaryPort>``
           - The ``hostname:port`` combination for the replica set's primary

      - For **UNIX-based** systems:

        .. code-block:: sh

           ./seedSecondary.sh <mongodPort> <oplogSizeInGigabytes> <replicaSetName> <primaryHost:primaryPort>
           ./seedSecondary.sh 27018 2 rs-1 primaryHost.example.com:27017

      - For **Windows-based** systems:

        .. code-block:: sh

           .\seedSecondary.bat <mongodPort> <oplogSizeInGigabytes> <replicaSetName> <primaryHost:primaryPort>
           .\seedSecondary.bat 27018 2 rs-1 primaryHost.example.com:27017


---
title: "Restart the primary as part of a replica set."
stepnum: 8
ref: restart
pre: |
  Use the following sequence:

  a. Shut down the process using one of the following methods:

     - **Automated Deployment**:

       Shut down through the |mms| console. See :doc:`/tutorial/shut-down-deployment`.

     - **Non-Automated Deployment on MongoDB 2.6 or Later**:

       .. code-block:: javascript

          use admin
          db.shutdownServer()

     - **Non-Automated Deployment on MongoDB 2.4 or earlier**:

       .. code-block:: javascript

          use admin
          db.shutdownServer( { force: true } )

  b. Restart the process as part of a replica set:

     .. code-block:: javascript

        mongod --dbpath /<pathToData> --replSet <replicaSetName>

...
