========================
Administration Interface
========================

The *MMS Administration* section of the |mms| application
provides access to user management, system status, and system-wide
messaging.

Overview
--------

|mms| includes a tool to view system status and perform administrative
tasks, for example, set cron jobs and manage users and groups.

If you have administrative privileges for the MMS deployment, click
the :guilabel:`Admin` link in the top right corner of MMS to access
the system administration tool.

The :guilabel:`Admin` page includes the following sections and tabs:

- The default tab is the :ref:`overview-tab` tab which provides a
  system overview. :ref:`messages-tab`, Reports, :ref:`users-tab`, and
  :ref:`groups-tab` tabs provide additional functionality.

- The :ref:`Backup section <backup-tabs>` includes tabs for Jobs, Logs,
  Daemons, Blockstores, Grooms, and Job Timeline.

- The :ref:`Control Panel section <control-panel>` includes tabs for
  :guilabel:`Send Test Email` and :guilabel:`Send Test SMS` pages.

General Tabs
------------

.. _overview-tab:

Overview
~~~~~~~~

The :guilabel:`Overview` tab provides reports on system use and
activity.

This tab displays the summary table and :guilabel:`Total Pages Viewed`
and :guilabel:`Total Chart Requests` charts.

A summary table reports totals for:

- groups
- active groups
- active hosts
- users
- users active
- ping spillover queue
- increment spillover queue

Additionally two charts report:

- total page views
- total chart requests

.. _messages-tab:

Messages
~~~~~~~~

You can display a short message on any page of the MMS application to
notify or remind users, such as impending maintenance windows. Messages
may be *active*, i.e. visible, on all pages or a subset of pages.

The :guilabel:`Messages` tab provides information on existing messages
as well as an interface to add new messages or manage existing messages.

Message Table
`````````````

The *UI Messages* page holds a table of all available messages. Use the
search box on the top right to filter the list of messages.

For each message, the message table reports:

- which page or page prefix the message will appear on.

- the text of the message.

- whether the message is active or inactive. Active messages are also
  highlighted in orange.

- the creation date and time for the message.

- the date and time of the last modification for the message.

Add a Message
`````````````

To add a message which appears on one page, or on all pages,

#. Click the:guilabel:`Add Message` button.

#. In the :guilabel:`Add Message` interface, enter

   - the message, and

   - the page URL or optionally, page prefix in the :guilabel:`Add
     Message` interface.

     The page prefix allows you to specify a path of a single page or
     the URL prefix of a group of pages. The prefix must begin with a
     ``/`` character.

     For example, entering the page prefix ``/settings/profile`` will
     display a message on the default :guilabel:`Settings` page and
     :guilabel:`Profile` tab but not on any other page or tab in the
     application.

#. Click the :guilabel:`Active` checkbox to make the message live.
   Optionally, you can leave the box unchecked to disable the message.

#. Click the :guilabel:`Add` button to add the message.

Once added, active messages take 60 seconds before they display.

Disable a Message
`````````````````

To disable a message, click the orange square button to the right of
any alert listed on the :guilabel:`Messages` tab. The orange button
will change to a grey button.

To re-enable a disabled message, click the grey button; the grey button
will change to back to an orange button.

Delete a Message
````````````````

To delete a message, click the garbage can icon to the right of any alert
listed on the :guilabel:`Messages` tab.

.. _users-tab:

Users
~~~~~

The :guilabel:`Users` tab displays a list of user information for all
people with permission to use the |mms| application as well as provides
an interface to manage users. Use the search box on the upper right corner
to find a user record.

Users Information
`````````````````

For each user, the users table reports:

- the username

- the available administrative roles, if any

- the date and time of the last login.

- the date and time of the last access event.

- the total number of login.

- the user's configured timezone.

- the creation date and time.

Edit a User Record
``````````````````

To edit a user record,

#. Click the pencil icon at the far right of the user record.

#. In the :guilabel:`Edit User` interface, you can:

   - Edit the user's email.

   - Select the user's groups and roles.

   - Lock or unlock the account.

   - Specify the user's global roles.

#. When finished, click the :guilabel:`Save` button to save any changes
   and exit.

.. _groups-tab:

Groups
~~~~~~

The :guilabel:`Groups` tab lists all groups created with their date
created and the last date and time an agent for the group pinged MMS. At
the top right of the page is a search box to find a group by name.

Click a group name to go directly to the group pages in MMS. To return to
the system administration tool, click the browser back button or click the
:guilabel:`Admin` link in the top right of any page.

.. _backup-tabs:

Backup Tabs
-----------

Jobs
~~~~

You can see all active and stopped backup agent jobs on the
:guilabel:`Jobs` tab. For each backup job, the tab lists job group, name,
last agent conf, last oplog, head time, last snapshot, what the agent is
working on, the daemon, and the blockstore.

Click the group name to go directly to the backup job page for the group.
To return to the system administration tool, click the browser back button
or click the :guilabel:`Admin` link in the top right of any page.

Click the job name to see the results of the job on a detail page. On the
job detail page, click links to see the logs, resource usage, conf call,
and download a zipped archive file containing complete diagnostic
information for the specified job.

Logs
~~~~

The :guilabel:`Logs` tab lists backup logs by job and class with messages
grouped and counted by last 2 hours, last day, and last 3 days. Click a
count number to see all messages in the group.

Daemons
~~~~~~~

This tab lists all active backup daemons, as well as the ability to
pre-configure a new backup daemon.

For each backup daemon, this tab lists the server name, configuration,
head space used, head space free, the number of replica sets backed up,
the percentage of time the backup agent was busy, and job runtime counts
by 1 minute, 10 minutes, 60 minutes, less than or equal to 180 minutes,
and greater than 180 minutes.

Click the :guilabel:`Show JSON` link to view the backup daemon JSON. When
JSON displays, click the :guilabel:`View raw runtime data` link under the
code to view raw data. To hide the daemon JSON, click the :guilabel:`Hide
JSON` link.

Click the :guilabel:`Move all heads` link to move the backup daemon head
location. Select the location and click the :guilabel:`Move all heads`
button to move all jobs that live on this daemon to a new daemon.

For each backup daemon, you can select or deselect the assignment, backup
jobs, restore jobs, resource usage, and garbage collection configuration,
as well as indicate whether the disk type is SSD or HDD. If selected, the
algorithm that assigns jobs to daemons uses disk type to assign jobs with
high oplog churn to HHD daemons.

To pre-configure a new backup daemon, scroll to the bottom of this tab and
type the ``<machine>:<root head path>`` in the text field above the
:guilabel:`Pre-Configure New Daemon` button. Click the button to
pre-configure the new backup daemon.

Blockstores
~~~~~~~~~~~

The :guilabel:`Blockstores` tab lists all backup blockstores with the
ability to add a new blockstore.

To update an existing blockstore, edit the ``<hostname>:<port>``,
:guilabel:`MongoDD Auth Username`, and :guilabel:`MongoDB Auth
Password`. Click the :guilabel:`Encrypted Credentials` checkbox if the
username and password entered above used the ``credentialstool`` for
encryption.

To add a blockstore, enter the ``<id>`` and ``<hostname:port>`` in the
text fields above the :guilabel:`Add New Blockstore` button then click the
button to save and add the blockstore.

For all MongoDB connections, enter a single ``<hostname>:<port>`` for a
MongoDB standalone or a comma separated list of all replica set members.
A newly configured blockstore only becomes active when you select the
assignment checkbox.

Grooms
~~~~~~

This tab lists all active backup groom jobs, bytes saved from recent groom
jobs, and recently finished groom jobs. A groom is the process of garbage
collecting dead bytes from the Blockstore Database. *Dead* blocks are blocks
no longer referenced by a non-expired snapshot and, therefore, eligible for
garbage collection.

For active and recently finished backup groom jobs, the tab lists the
group, job name, savings, running time, stage, total blocks, scanned
blocks as a percent of total for active jobs, copied blocks as a percent
of total for finished jobs, direction, blockstore, and machine.

Job Timeline
~~~~~~~~~~~~

The :guilabel:`Job Timeline` tab displays the present and future scheduled
backup status for active jobs, as well as the ability to search
backup jobs by group, replica set, and machine.

To update the list automatically every 10 seconds, click the
:guilabel:`Auto refresh` checkbox at the top left of the list. Or click
the :guilabel:`Refresh` button to refresh data manually as needed.

To view the backup job JSON, click the :guilabel:`Show JSON` link under
the :guilabel:`Group` heading for any backup job. When JSON displays,
click the :guilabel:`View raw runtime data` link under the code to view
raw data. To hide the daemon JSON, click the :guilabel:`Hide JSON` link.

To move the job to a new backup daemon, click the :guilabel:`Move head`
link under the :guilabel:`Machine` heading for a backup job. Select the
location and click the :guilabel:`Move head` button to move the job to a
new backup daemon.

You can bind a backup job to a head by clicking the Set binding button
under the :guilabel:`Machine` heading for any backup job.

To break the backup job, click the :guilabel:`Break Job` link under the
:guilabel:`Machine` heading for any backup job. To unbreak the backup
job, click the :guilabel:`Unbreak Job` link.

.. _control-panel:

Control Panel Tabs
------------------

Send Test Email
~~~~~~~~~~~~~~~

Use this tab to send a test email with MMS. Fill out the :guilabel:`To`
and :guilabel:`Body` message then click the :guilabel:`Send Email`
button.

Send Test SMS
~~~~~~~~~~~~~

Use this tab to send an SMS message. Fill out the :guilabel:`To` and
:guilabel:`Body` message then click the :guilabel:`Send Email` button.
