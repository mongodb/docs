.. _golang-count-documents:

===============
Count Documents
===============

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

Overview
--------

In this guide, you can learn how to get an :ref:`accurate
<golang-accurate-count>` and :ref:`estimated <golang-estimated-count>` count of
the number of documents in your collection.

Sample Data
~~~~~~~~~~~

To run the examples in this guide, load the sample data into the ``tea.ratings`` collection with the following
snippet:

.. literalinclude:: /includes/fundamentals/code-snippets/CRUD/countAndEstimate.go
   :language: go
   :dedent:
   :start-after: begin insert docs
   :end-before: end insert docs

.. include:: /includes/fundamentals/automatic-db-coll-creation.rst

Each document contains a rating for a type of tea that corresponds to
the ``type`` and ``rating`` fields.

.. _golang-accurate-count:

Accurate Count
--------------

To count the number of documents that match your query filter, use the
``CountDocuments()`` method.

.. tip::

   If you pass an empty query filter, this method returns the total
   number of documents in the collection.

Modify Behavior
~~~~~~~~~~~~~~~

You can modify the behavior of ``CountDocuments()`` by passing in a
``CountOptions`` type. If you don't specify any options, the driver uses
its default values.

The ``CountOptions`` type allows you to configure options with the
following methods:

.. list-table::
   :widths: 30 70
   :header-rows: 1

   * - Method
     - Description

   * - ``SetCollation()``
     - | The type of language collation to use when sorting results.  
       | Default: ``nil``

   * - ``SetHint()`` 
     - | The index to use to scan for documents to count. 
       | Default: ``nil``

   * - ``SetLimit()`` 
     - | The maximum number of documents to count. 
       | Default: ``0`` 

   * - ``SetMaxTime()``
     - | The maximum amount of time that the query can run on the server.
       | Default: ``nil``

   * - ``SetSkip()`` 
     - | The number of documents to skip before counting.
       | Default: ``0``

Example 
```````

The following example counts the number of documents where the
``rating`` is less than ``6``:

.. io-code-block::
   :copyable: true

   .. input::
      :language: go

      filter := bson.D{{"rating", bson.D{{"$lt", 6}}}}

      count, err := coll.CountDocuments(context.TODO(), filter)
      if err != nil {
         panic(err)
      }
      fmt.Printf("Number of ratings less than six: %d\n", count)

   .. output::
      :language: none

      Number of ratings less than six: 4

Aggregation
-----------

You can also include the :manual:`$count </reference/operator/aggregation/count/>`
stage to count the number of documents in an aggregation pipeline.

Example
~~~~~~~

The following example performs the following actions:

- Counts the number of documents where the ``rating`` is greater than ``5``
- Assigns the count to a field called ``total_documents``

.. io-code-block::
   :copyable: true

   .. input::
      :language: go

      matchStage := bson.D{{"$match", bson.D{{"rating", bson.D{{"$gt", 5}}}}}}
      countStage := bson.D{{"$count", "total_documents"}}

      cursor, err := coll.Aggregate(context.TODO(), mongo.Pipeline{matchStage, countStage})
      if err != nil {
         panic(err)
      }

      var results []bson.D
      if err = cursor.All(context.TODO(), &results); err != nil {
         panic(err)
      }
      for _, result := range results {
         fmt.Println(result)
      }

   .. output::
      :language: none

      [{total_documents 5}]

.. _golang-estimated-count:

Estimated Count
---------------

To estimate the number of documents in your collection, use the
``EstimatedDocumentCount()`` method. 

.. note:: 

    The ``EstimatedDocumentCount()`` method is quicker than the
    ``CountDocuments()`` method because it uses the collection's
    metadata rather than scanning the entire collection. 

Modify Behavior
~~~~~~~~~~~~~~~

You can modify the behavior of ``EstimatedDocumentCount()`` by passing
in an ``EstimatedDocumentCountOptions`` type. If you don't specify any
options, the driver uses its default values.

The ``EstimatedDocumentCountOptions`` type allows you to configure
options with the following methods:

.. list-table::
   :widths: 30 70
   :header-rows: 1

   * - Method
     - Description

   * - ``SetMaxTime()``
     - | The maximum amount of time that the query can run on the server.
       | Default: ``nil``

Example 
```````

The following example estimates the number of documents in the
``ratings`` collection:

.. io-code-block::
   :copyable: true

   .. input::
      :language: go

      count, err := coll.EstimatedDocumentCount(context.TODO())
      if err != nil {
         panic(err)
      }
      fmt.Printf("Estimated number of documents in the ratings collection: %d\n", count)

   .. output::
      :language: none

      Estimated number of documents in the ratings collection: 9

Additional Information
----------------------

To learn more about the operations mentioned, see the following
guides:

- :ref:`golang-query-document`
- :ref:`golang-skip`
- :ref:`golang-limit`

.. - :doc:`Aggregation </fundamentals/aggregation>` 
.. - :doc:`Collations </fundamentals/collations>`

API Documentation
~~~~~~~~~~~~~~~~~

To learn more about any of the methods or types discussed in this
guide, see the following API Documentation:

- `CountDocuments() <{+api+}/mongo#Collection.CountDocuments>`__
- `CountOptions <{+api+}/mongo/options#CountOptions>`__
- `EstimatedDocumentCount() <{+api+}/mongo#Collection.EstimatedDocumentCount>`__
- `EstimatedDocumentCountOptions <{+api+}/mongo/options#EstimatedDocumentCountOptions>`__
