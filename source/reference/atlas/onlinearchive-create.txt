.. _mcli-atlas-cluster-onlinearchive-create-command:

===========================================
mongocli atlas cluster onlinearchive create
===========================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. include:: /includes/fact-online-archive-beta.rst

The ``onlinearchive create`` command creates an :atlas:`online archive 
</online-archive/manage-online-archive/>` for the specified collection in the ``M10`` or higher cluster. You can also create an online archive through the 
|service| :atlas:`UI </online-archive/configure-online-archive/>` or :atlas:`API </reference/api/online-archive-create-one/>`.

.. _mcli-atlas-cluster-online-archive-create-syntax:

Syntax 
------

.. code-block:: text 

   mongocli atlas cluster onlinearchive create 
        --archiveAfter <number-of-days> 
        --clusterName <cluster-name>
        --collection <collection-name>
        --dateField <date-field-name>
        --db <database-name>
        --partition <partition-field-names>   
        [ --profile|-P <profile-name> ]
        [ --projectId <project-ID> ]

.. _mcli-atlas-cluster-onlinearchive-create-options: 

Options 
-------

.. list-table::
   :header-rows: 1
   :widths: 20 10 60 10

   * - Option
     - Type
     - Description
     - Required?

   * - ``--archiveAfter``
     - int 
     - Number of days after which to archive cluster data.
     - yes

   * - ``--clusterName``
     - string
     - Name of the cluster. 
     - yes

   * - ``--collection``
     - string
     - Name of the collection for which to create an online archive.
     - yes

   * - ``--dateField``
     - string
     - Name of an already indexed date field from the documents.
     - yes

   * - ``--db``
     - string
     - Name of the database that contains the collection.
     - yes

   * - ``partition``
     - string
     - Name of the fields to use to partition data. You can specify up to two 
       frequently queried fields, separated by a comma, in the following format: ``<field-name>:<data-type>``. The order in which the fields are specified defines the position of the field in the partition. That is:

       - The first field has the first position (``0``) in the partition.  
       - The second field has the second position (``1``) in the partition.
       
       The data type must match the data type of the field in the documents.
     - no

   * - ``--profile``, ``-P``
     - string
     - Name of the profile where the public and private 
       keys for the project are saved. If omitted, uses the 
       {+default-profile+}. To learn more about creating a 
       profile, see :ref:`mcli-configure`.
     - no

   * - ``--projectId``
     - string
     - Unique identifier of the project that contains the 
       cluster. If omitted, uses the project ID in the profile or 
       :ref:`environment variable <mcli-env-var>`.
     - no

.. _mcli-atlas-cluster-onlinearchive-create-output: 

Output 
------

.. include:: /includes/command-output-intro.rst

.. include:: /includes/atlas-online-archive-output.rst

.. _mcli-atlas-cluster-onlinearchive-create-egs:

Examples 
--------

The following examples show two ways to create an online archive using the ``mongocli atlas onlinearchive create`` command. The **Basic Example** shows how to create an online archive without additional partition fields and the **Partitions Example** shows how to create an online archive with partitions.

.. tabs:: 

   .. tab:: Basic Example
      :tabid: basic
   
      The following ``mongocli atlas onlinearchive create`` command creates an online archive for the ``sample_mflix.movies`` collection in a cluster named ``myTestCluster`` using the default profile. The criteria for archiving data indicates that data should be archived when the current date is greater than the value of the ``dateField`` option plus the number of days specified through the ``archiveAfter`` option. 

      .. code-block:: shell 
   
         mongocli atlas cluster onlineArchive create --clusterName myTestCluster --db sample_mflix --collection movies --dateField released --archiveAfter 2 

      The previous command prints the following fields in |json| format to the 
      terminal. To learn more about these fields, see 
      :ref:`mcli-atlas-cluster-onlinearchive-create-output`.

      .. code-block:: sh
         :copyable: false 

         {
	         "_id": "5f1726ca460fd352106557c2",
	         "clusterName": "myTestCluster",
	         "collName": "movies",
	         "criteria": {
		         "dateField": "released",
		         "expireAfterDays": 2
	         },
	         "dbName": "sample_mflix",
	         "groupId": "5e2211c17a3e5a48f5497de3",
	         "paused": false,
	         "state": "PENDING"
         }

   .. tab:: Partitions Example
      :tabid: partitions

      The following ``mongocli atlas onlinearchive create`` command creates an online archive for the ``sample_mflix.movies`` collection in a cluster named ``myTestCluster`` using a profile named ``egAtlasProfile``. Data is partitioned based on the ``title`` field, ``year`` field, and ``released`` field from the documents in the collection. The criteria for archiving data indicates that data should be archived when the current 
      date is greater than the value of the ``dateField`` option plus the 
      number of days specified through the ``archiveAfter`` option. 

      .. code-block:: shell 
   
         mongocli atlas cluster onlineArchive create --clusterName myTestCluster --db sample_mflix --collection movies --dateField released --archiveAfter 2 --partition title:string,year:int -P egAtlasProfile 

      The previous command prints the following fields in |json| format to the 
      terminal. To learn more about these fields, see 
      :ref:`mcli-atlas-cluster-onlinearchive-create-output`.

      .. code-block:: sh
         :copyable: false 

         {
	         "_id": "5f173012a22aa23d58a8b2f0",
	         "clusterName": "myTestCluster",
	         "collName": "movies",
	         "criteria": {
		         "dateField": "released",
		         "expireAfterDays": 2
	         },
	         "dbName": "sample_mflix",
	         "groupId": "5e2211c17a3e5a48f5497de3",
	         "partitionFields": [
		         {
			         "fieldName": "title",
			         "fieldType": "string",
			         "order": 0
		         },
		         {
			         "fieldName": "year",
			         "fieldType": "number",
			         "order": 1
		         },
		         {
			         "fieldName": "released",
			         "fieldType": "date",
			         "order": 2
		         }
	         ],
	         "paused": false,
	         "state": "PENDING"
         }
