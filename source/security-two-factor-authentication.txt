.. _security-two-factor-auth:

=========================
Two Factor Authentication
=========================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol


Two-factor authentication provides a second layer of security for your
|service| account. If you enable |2fa| for your account and after you
enter your username and password, you are prompted for a six-digit
time-sensitive verification code. This code is sent to a separate
device, such as a mobile phone or security token, that you can read
and enter into |service| and complete your login.

.. note::

   .. include:: /includes/fact-org-owner-2fa.rst

   For more information on organization settings, see
   :ref:`Change Organization Settings <organization-settings>`.

|service| provides the following sources for |2fa| verification codes:

.. tabs::

   tabs:
     - id: phone
       name: Text or Voice
       content: |

         **Text Messages** (|sms|)

         When |service| prompts you for a verification code,
         |service| sends the 6-digit verification code using text
         (|sms|) to the provided phone number.

         The cellular carrier's |sms| rates apply.

         **Automated Voice Calls**

         When |service| prompts you for a verification code,
         |service| calls the provided phone number. An automated
         system repeats the 6-digit verification code a total of
         three times before hanging up.

         The cellular carrier's Voice Call rates apply.

         .. important:: Voice only works in the US / Canada.

         .. note::

            |service| users who operate within a geographic region
            with limited cellular service coverage or reliability may
            encounter delays in receiving the |2fa| code via |sms| or
            Voice. Consider using a |2fa| app or device instead.

     - id: app
       name: 2FA App
       content: |

         When |service| prompts you for a verification code, you can
         provide one that is generated in a |2fa| app. You must pair
         the |2fa| app with |service| first.

         This tutorial uses the `Google Authenticator`_ mobile app.

         There are other mobile device apps and web browser plug-ins
         that provide |2fa| capabilities. You can use any that support
         the |totp|.

         You can pair only one app with |service| at any one time.

     - id: token
       name: 2FA device
       content: |

         When |service| prompts you for a verification code, you can
         provide one that is generated in a |2fa| |piv| device. You
         must pair the |piv| device app with |service| first using a
         |2fa| app. These devices must support |totp|.

         This procedure uses a YubiKey security key, specifically
         those that work with `Authenticator Codes <https://support.yubico.com/support/solutions/articles/15000006419-using-your-yubikey-with-authenticator-codes>`__.
         Other |2fa| |piv| hardware devices that use |totp| should
         work in a similar fashion.

         .. admonition:: Informational Reference Only
            :class: note

            MongoDB does not endorse the aforementioned service, and
            its reference is intended only as informational. Defer to
            your organization's procedures in selecting the
            appropriate vendor or service for supporting |2fa| via
            smart card or similar device.

.. _two-factor-config:
.. _two-factor-text-voice:
.. _two-factor-google-authenticator:

Configure Two-Factor Authentication
-----------------------------------

.. tabs::

   hidden: true

   tabs:
     - id: phone
       name: Text or Voice
       content: |

         .. include:: /includes/steps/two-factor-auth-configure-text-voice.rst

     - id: app
       name: 2FA App
       content: |

         .. include:: /includes/steps/two-factor-auth-configure-authenticator.rst

     - id: token
       name: PIV device
       content: |

         .. include:: /includes/steps/two-factor-auth-configure-yubikey.rst

Configure Backup Two Factor Authentication Phone Number
-------------------------------------------------------

You can configure a backup phone number for receiving |2fa| codes if
the primary method fails or is unavailable.

If you have not yet enabled |2fa| for the |service| account, do so
before proceeding. See :ref:`two-factor-config`.

.. include:: /includes/steps/two-factor-auth-configure-backup.rst

.. _two-factor-recovery-codes:

Generate New Recovery Codes
---------------------------

|service| can generate single-use recovery codes for use where all
other methods of accessing the account fail. When you generate new
recovery codes, you invalidate previously generated ones.

If you have not yet enabled |2fa| for the |service| account, do so
before proceeding. See :ref:`two-factor-config`.

.. include:: /includes/steps/two-factor-generate-recovery-codes.rst

.. _two-factor-reset:

Reset Two Factor Authentication
-------------------------------

In order to reset your two-factor authentication, you must:

- Be able to receive email at the address associated with your
  account.
- Have the database username and password for a project of which
  you are a member.
- Be a direct member of the project which your username
  and password correspond to. If you have access to the project only
  through a team that has a role in the project, you cannot reset
  two-factor authentication for your |service| account.

.. important::

   Resetting |2fa| for an |service| account disables |2fa| for that
   account. You can re-configure |2fa| after performing the reset
   procedure.

1. Log in to |service|.

#. From the |2fa| entry dialog, select
   :guilabel:`Reset your two factor authentication`.

#. Select :guilabel:`Atlas user? Click here` at the bottom of the
   ``Reset Two Factor Authentication`` modal.

#. Enter your |service| username. |service| emails a link to the email
   account associated with the |service| username.

   .. important::

      The link to start the |2fa| reset procedure is only active for
      two hours after |service| sends the email. Make sure you click
      the link within the two-hour window.

#. Click the link in the email to start the |2fa| reset procedure.

#. Follow the directions on the |2fa| reset page. After completing the
   reset procedure, |service| allows you to log in to the |service|
   account without requiring a |2fa| code.
