stepnum: 1
title: "Stop all existing |onprem| services."
level: 4
ref: shutdown
pre: |

   Shut down the |onprem| Application.
action:
    language: sh
    code: |
      <install_dir>/bin/mongodb-mms stop
---
stepnum: 2
title: "On each |onprem| server, back up your existing configuration files and logs to a directory other than the install directory."
level: 4
ref: create-backups
content: |

  .. important::

     You need the backed-up ``<install_dir>/conf/conf-mms.properties``
     file for later in this procedure.

     Do not back up the entire ``conf`` directory. Some files need to 
     be overwritten with the upgrade.

action:
  pre: |

    The following example backs up the configuration files and logs to
    your home directory:

  language: sh
  code: |
    cp -a <install_dir>/conf/conf-mms.properties ~/mms_conf.backup/conf-mms.properties
    cp -a <install_dir>/conf/gen.key ~/mms_conf.backup/conf-mms.gen.key
    cp -a <install_dir>/logs ~/mms_logs.backup
---
stepnum: 3
level: 4
# Note: This step is borrowed from the archive install procedure, not from steps-source-upgrade.
source:
  file: steps-install-on-prem-from-archive.yaml
  ref: download
---
stepnum: 4
title: "Install the |onprem| package on each server being used for |onprem|."
level: 4
ref: install
content: |

  Navigate to the directory to which to install |onprem|. Extract the
  archive to that directory:

  .. code-block:: sh

     tar -zxf mongodb-mms-<version>.x86_64.tar.gz
---
stepnum: 5
title: "On each |onprem| server, restore the backed up logs and configuration files into the |onprem| installation directory."
ref: backcopy-logs
pre: |

    The following example restores the configuration files and logs from your
    home directory:

action:
  language: sh
  code: |
    cp -a ~/mms_conf.backup/conf-mms.properties <install_dir>/conf/conf-mms.properties
    cp -a ~/mms_conf.backup/conf-mms.gen.key <install_dir>/conf/gen.key
    cp -a ~/mms_logs.backup <install_dir>/logs 
---
stepnum: 6
title: "Start |onprem| on every server."
ref: start
pre: |
  Issue the following command:
action:
  language: sh
  code: |
    <install_dir>/bin/mongodb-mms start
...
