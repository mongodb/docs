===========
movePrimary
===========

.. default-domain:: mongodb

.. dbcommand:: movePrimary

   In a :term:`sharded cluster`, this command reassigns the database's
   :term:`primary shard`, which holds all un-sharded collections in
   the database. :dbcommand:`movePrimary` is an administrative command
   that is only available for :program:`mongos` instances. Only use
   :dbcommand:`movePrimary` when removing a shard from a sharded
   cluster.

   .. important:: Only use :dbcommand:`movePrimary` when:

      - the database does not contain any collections, *or*

      - you have drained all sharded collections using the
        :dbcommand:`removeShard` command.

      See :doc:`/tutorial/remove-shards-from-cluster` for a complete
      procedure.

   :dbcommand:`movePrimary` changes the primary shard for this
   database in the cluster metadata, and migrates all un-sharded
   collections to the specified shard. Use the command with the
   following form:

   .. code-block:: javascript

      { movePrimary : "test", to : "shard0001" }

   When the command returns, the database's primary location will
   shift to the designated :term:`shard`. To fully decommission a
   shard, use the :dbcommand:`removeShard` command.
   
   If the :dbcommand:`movePrimary` command moves any un-sharded collections 
   in the process, all :program:`mongos` instances need to be restarted
   or the :dbcommand:`flushRouterConfig` command needs to be invoked on all
   :program:`mongos` instances before writing any data, to notify them of the 
   primary shard change. If this process is not followed, data may end up being 
   written to the incorrect shard and appears to be missing without manual 
   efforts to correct this.
