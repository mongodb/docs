.. _config-private-endpoint:

===========================================================
Set Up a Private Endpoint for a {+FDI+} 
===========================================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

MongoDB supports |aws| private endpoints using the `{+aws-pl+}
<https://aws.amazon.com/privatelink/>`__ feature for your {+fdi+}. You 
can set up the private endpoints from the {+atlas-cli+}, |service| User Interface, 
and |api|.

Required Access
---------------

To set up a private endpoint, you must have :authrole:`Project Owner` access to the project.
Users with :authrole:`Organization Owner` access must add themselves as a ``Project Owner``
to the project before setting up a private endpoint.

Prerequisites 
-------------

1. Have an |aws| user account with an |iam| user policy that grants 
   permissions to create, modify, describe, and delete endpoints. To 
   learn more about controlling the use of interface endpoints, see 
   the :aws:`AWS Documentation 
   </vpc/latest/userguide/vpc-endpoints.html>`.

#. :aws:`Install the AWS CLI 
   </cli/latest/userguide/cli-chap-install.html>`.

#. If you have not already done so, create your |vpc| and EC2 instances 
   in |aws|. To learn more, see the :aws:`AWS documentation 
   </index.html>` for guidance.

.. note:: 

   You can't use your |service| cluster :ref:`private endpoint ID
   <private-endpoint>` for {+adf+}. The {+adf+} endpoint ID must be
   different from your |service| cluster endpoint ID, if you have one. 

Procedure
---------

.. tabs::
 
   .. tab:: {+atlas-cli+}
      :tabid: atlascli
 
      .. include:: /includes/extracts/atlas-dataFederation-privateEndpoints-create.rst
 
   .. tab:: {+atlas-admin-api+}
      :tabid: api
 
      To configure a private endpoint from the API, send a ``POST`` request 
      with the private endpoint ID to the ``privateNetworkSettings`` 
      endpoint. 

      - If the endpoint ID already exists and there is no change to 
        the comment associated with the endpoint, |service| makes no change 
        to the endpoint ID list.
      - If the endpoint ID already exists and there is a change to the 
        associated comment, |service| updates the ``comment`` value only in 
        the endpoint ID list.
      - If the endpoint ID doesn't exist, |service| appends the new endpoint 
        to the list of endpoints in the endpoint ID list.

      To learn more about the syntax and options, see :oas-atlas-op:`API 
      </createOneDataFederationPrivateEndpointForOneProject>`.
 
   .. tab:: {+atlas-ui+}
      :tabid: ui
 
      You can create a new private endpoint or add an existing private 
      endpoint through your |service| User Interface. To set up the private 
      endpoint:

      .. tabs:: 

         .. tab:: Create New Endpoint 
            :tabid: create-new 

            .. include:: /includes/steps/adf-create-new-privatelink.rst

         .. tab:: Add Existing Endpoint 
            :tabid: add-existing

            .. include:: /includes/steps/adf-add-existing-privatelink.rst

.. note:: 

   If the private endpoint setup is successful, you can see the
   :guilabel:`VPC Endpoint ID`, :guilabel:`Region`, and :guilabel:`VPC
   Endpoint DNS Name` in the :guilabel:`Private Endpoint` tab for
   :guilabel:`Federated Database Instance / Online Archive` in the
   {+atlas-ui+} :guilabel:`Network Access` page.
