.. facet::
   :name: programming_language
   :values: csharp, go, java, javascript/typescript, python, shell

.. meta::
   :keywords: code example, node.js, compass, java sync

.. _qe-create-application:

========================================================================
Create your {+qe+} Enabled Application
========================================================================

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

Overview
--------

This guide shows you how to build an application that implements {+qe+} 
to automatically encrypt and decrypt document fields.

After you complete the steps in this guide, you should have a working
client application that is ready for inserting documents with fields encrypted
with your {+cmk-long+}.

Before You Start
----------------

Ensure you have completed the following prerequisite tasks before creating your application:

#. :ref:`Install a {+qe+} compatible driver and dependencies <qe-install>`

#. :ref:`Install and configure a {+qe+} library <qe-csfle-install-library>`

#. :ref:`Create a {+cmk-long+} <qe-create-cmk>`

Full Application Code
~~~~~~~~~~~~~~~~~~~~~

To see the complete code for the sample application, select your programming
language in the language selector.

.. tabs-drivers::

   .. tab:: mongosh
      :tabid: shell

      `Complete mongosh Application <{+sample-app-url-qe+}/mongosh/>`__

   .. tab:: Node.js
      :tabid: nodejs

      `Complete Node.js Application <{+sample-app-url-qe+}/node/>`__

   .. tab:: Python
      :tabid: python

      `Complete Python Application <{+sample-app-url-qe+}/python/>`__

   .. tab:: Java
      :tabid: java-sync

      `Complete Java Application <{+sample-app-url-qe+}/java/>`__

   .. tab:: Go
      :tabid: go

      `Complete Go Application <{+sample-app-url-qe+}/go/>`__

   .. tab:: C#
      :tabid: csharp

      `Complete C# Application <{+sample-app-url-qe+}/csharp/>`__

Each sample application repository includes a ``README.md``
file that you can use to learn how to set up your environment and run
the application.

.. tabs-selector:: drivers

Procedure
---------

Select the tab for your key provider below.

.. tabs::


   .. tab:: {+aws-long+}
      :tabid: create-app-aws

      .. procedure::

         .. step:: Assign application variables

            .. include:: /includes/queryable-encryption/tutorials/assign-app-variables.rst

         .. step:: Add your KMS credentials
            
            Create a variable containing your KMS credentials with the
            following structure. Use the Access Key ID and Secret Access 
            Key you used in step 2.2 when you :ref:`created an AWS IAM user <qe-create-aws-iam-user>`.
            
            .. tabs-drivers::

               .. tab::
                  :tabid: shell

                  .. literalinclude:: /includes/qe-tutorials/mongosh/queryable-encryption-helpers.js
                     :start-after: start-aws-kms-credentials
                     :end-before: end-aws-kms-credentials
                     :language: javascript
                     :dedent:

                  .. include:: /includes/queryable-encryption/tutorials/automatic/named-kms-note.rst

                     .. replacement:: kms-provider

                        AWS
                     
                     .. replacement:: kms-provider-name

                        "my_aws_provider"

                  .. literalinclude:: /includes/queryable-encryption/tutorials/automatic/aws/named-kms/named-kms-shell.js
                     :language: javascript
                     :dedent:

                  .. include:: /includes/queryable-encryption/tutorials/automatic/default-kms-note.rst

                     .. replacement:: kms-provider-string

                        ``"aws"``

               .. tab::
                  :tabid: nodejs

                  .. literalinclude:: /includes/qe-tutorials/node/queryable-encryption-helpers.js
                     :start-after: start-aws-kms-credentials
                     :end-before: end-aws-kms-credentials
                     :language: javascript
                     :dedent:

                  .. include:: /includes/queryable-encryption/tutorials/automatic/named-kms-note.rst

                     .. replacement:: kms-provider

                        AWS
                     
                     .. replacement:: kms-provider-name

                        "my_aws_provider"

                  .. literalinclude:: /includes/queryable-encryption/tutorials/automatic/aws/named-kms/named-kms.js
                     :language: javascript
                     :dedent:

                  .. include:: /includes/queryable-encryption/tutorials/automatic/default-kms-note.rst

                     .. replacement:: kms-provider-string

                        ``"aws"``

               .. tab::
                  :tabid: python

                  .. literalinclude:: /includes/qe-tutorials/python/queryable_encryption_helpers.py
                     :start-after: start-aws-kms-credentials
                     :end-before: end-aws-kms-credentials
                     :language: python
                     :dedent:

                  .. include:: /includes/queryable-encryption/tutorials/automatic/named-kms-note.rst

                     .. replacement:: kms-provider

                        AWS
                     
                     .. replacement:: kms-provider-name

                        "my_aws_provider"

                  .. literalinclude:: /includes/queryable-encryption/tutorials/automatic/aws/named-kms/named-kms.py
                     :language: python
                     :dedent:

                  .. include:: /includes/queryable-encryption/tutorials/automatic/default-kms-note.rst

                     .. replacement:: kms-provider-string

                        ``"aws"``

               .. tab::
                  :tabid: java-sync

                  .. literalinclude:: /includes/qe-tutorials/java/src/main/java/com/mongodb/tutorials/qe/util/QueryableEncryptionHelpers.java
                     :start-after: start-aws-kms-credentials
                     :end-before: end-aws-kms-credentials
                     :language: java
                     :dedent:

                  .. include:: /includes/queryable-encryption/tutorials/automatic/named-kms-note.rst

                     .. replacement:: kms-provider

                        AWS
                     
                     .. replacement:: kms-provider-name

                        "my_aws_provider"

                  .. literalinclude:: /includes/queryable-encryption/tutorials/automatic/aws/named-kms/NamedKms.java
                     :language: java
                     :dedent:

                  .. include:: /includes/queryable-encryption/tutorials/automatic/default-kms-note.rst

                     .. replacement:: kms-provider-string

                        ``"aws"``

               .. tab::
                  :tabid: go

                  .. literalinclude:: /includes/qe-tutorials/go/queryable_encryption_helpers.go
                     :start-after: start-aws-kms-credentials
                     :end-before: end-aws-kms-credentials
                     :language: go
                     :dedent:

               .. tab::
                  :tabid: csharp

                  .. literalinclude:: /includes/qe-tutorials/csharp/QueryableEncryptionHelpers.cs
                     :start-after: start-aws-kms-credentials
                     :end-before: end-aws-kms-credentials
                     :language: csharp
                     :dedent:

                  .. include:: /includes/queryable-encryption/tutorials/automatic/named-kms-note.rst

                     .. replacement:: kms-provider

                        AWS
                     
                     .. replacement:: kms-provider-name

                        "my_aws_provider"

                  .. literalinclude:: /includes/queryable-encryption/tutorials/automatic/aws/named-kms/NamedKms.cs
                     :language: csharp
                     :dedent:

                  .. include:: /includes/queryable-encryption/tutorials/automatic/default-kms-note.rst

                     .. replacement:: kms-provider-string

                        ``"aws"``
      
            .. include:: /includes/queryable-encryption/tutorials/automatic/aws/role-authentication.rst

         .. step:: Add your CMK credentials

            Create a variable containing your {+cmk-long+} credentials
            with the following structure. Use the {+aws-arn-abbr+} and
            Region you recorded in step 1.3 when you :ref:`created a CMK <qe-create-cmk-aws>`.

            .. tabs-drivers::

               .. tab::
                  :tabid: shell

                  .. literalinclude:: /includes/qe-tutorials/mongosh/queryable-encryption-helpers.js
                     :start-after: start-aws-cmk-credentials
                     :end-before: end-aws-cmk-credentials
                     :language: javascript
                     :dedent:

               .. tab::
                  :tabid: nodejs

                  .. literalinclude:: /includes/qe-tutorials/node/queryable-encryption-helpers.js
                     :start-after: start-aws-cmk-credentials
                     :end-before: end-aws-cmk-credentials
                     :language: javascript
                     :dedent:

               .. tab::
                  :tabid: python

                  .. literalinclude:: /includes/qe-tutorials/python/queryable_encryption_helpers.py
                     :start-after: start-aws-cmk-credentials
                     :end-before: end-aws-cmk-credentials
                     :language: python
                     :dedent:

               .. tab::
                  :tabid: java-sync

                  .. literalinclude:: /includes/qe-tutorials/java/src/main/java/com/mongodb/tutorials/qe/util/QueryableEncryptionHelpers.java
                     :start-after: start-aws-cmk-credentials
                     :end-before: end-aws-cmk-credentials
                     :language: java
                     :dedent:

               .. tab::
                  :tabid: go

                  .. literalinclude:: /includes/qe-tutorials/go/queryable_encryption_helpers.go
                     :start-after: start-aws-cmk-credentials
                     :end-before: end-aws-cmk-credentials
                     :language: go
                     :dedent:

               .. tab::
                  :tabid: csharp

                  .. literalinclude:: /includes/qe-tutorials/csharp/QueryableEncryptionHelpers.cs
                     :start-after: start-aws-cmk-credentials
                     :end-before: end-aws-cmk-credentials
                     :language: csharp
                     :dedent:

         .. step:: Set automatic encryption options

            .. include:: /includes/queryable-encryption/shared-lib-learn-more.rst
        
            .. tabs-drivers::

               .. tab::
                  :tabid: shell

                  Create an ``autoEncryptionOptions`` object with the following
                  options:

                  - The namespace of your {+key-vault-long+}
                  - The ``kmsProviderCredentials`` object, which
                    contains your AWS KMS credentials

                  .. literalinclude:: /includes/qe-tutorials/mongosh/queryable-encryption-helpers.js
                     :start-after: start-auto-encryption-options
                     :end-before: end-auto-encryption-options
                     :language: javascript
                     :dedent:

               .. tab::
                  :tabid: nodejs

                  Create an ``autoEncryptionOptions`` object with the following
                  options:

                  - The namespace of your {+key-vault-long+}
                  - The ``kmsProviders`` object, which contains your AWS KMS credentials
                  - The ``sharedLibraryPathOptions`` object, which
                    contains the path to your {+shared-library+}

                  .. literalinclude:: /includes/qe-tutorials/node/queryable-encryption-helpers.js
                     :start-after: start-auto-encryption-options
                     :end-before: end-auto-encryption-options
                     :emphasize-lines: 5-9
                     :language: javascript
                     :dedent:

               .. tab::
                  :tabid: python

                  Create an ``AutoEncryptionOpts`` object with the following
                  options:

                  - The ``kms_provider_credentials`` object, which
                    contains your AWS KMS credentials
                  - The namespace of your {+key-vault-long+}
                  - The path to your {+shared-library+}

                  .. literalinclude:: /includes/qe-tutorials/python/queryable_encryption_helpers.py
                     :start-after: start-auto-encryption-options
                     :end-before: end-auto-encryption-options
                     :language: python
                     :dedent:

               .. tab::
                  :tabid: java-sync

                  Create an ``AutoEncryptionSettings`` object with the following
                  options:

                  - The namespace of your {+key-vault-long+}
                  - The ``kmsProviderCredentials`` object, which
                    contains your AWS KMS credentials
                  - The ``extraOptions`` object, which contains the path
                    to your {+shared-library+}

                  .. literalinclude:: /includes/qe-tutorials/java/src/main/java/com/mongodb/tutorials/qe/util/QueryableEncryptionHelpers.java
                     :start-after: start-auto-encryption-options
                     :end-before: end-auto-encryption-options
                     :emphasize-lines: 4-8
                     :language: java
                     :dedent:

               .. tab::
                  :tabid: go

                  Create an ``AutoEncryption`` object with the following
                  options:

                  - The namespace of your {+key-vault-long+}
                  - The ``kmsProviderCredentials`` object, which
                    contains your AWS KMS credentials
                  - The ``cryptSharedLibraryPath`` object, which
                    contains the path to your {+shared-library+}

                  .. literalinclude:: /includes/qe-tutorials/go/queryable_encryption_helpers.go
                     :start-after: start-auto-encryption-options
                     :end-before: end-auto-encryption-options
                     :emphasize-lines: 5-8
                     :language: go
                     :dedent:

               .. tab::
                  :tabid: csharp

                  Create an ``AutoEncryptionOptions`` object with the following
                  options:

                  - The namespace of your {+key-vault-long+}
                  - The ``kmsProviderCredentials`` object, which
                    contains your AWS KMS credentials
                  - The ``extraOptions`` object, which contains the path
                    to your {+shared-library+}

                  .. literalinclude:: /includes/qe-tutorials/csharp/QueryableEncryptionHelpers.cs
                     :start-after: start-auto-encryption-options
                     :end-before: end-auto-encryption-options
                     :emphasize-lines: 7-10
                     :language: csharp
                     :dedent:

         .. step:: Create a Client to Set Up an Encrypted Collection

            To create a client used to encrypt and decrypt data in
            your collection, instantiate a new ``MongoClient`` by using your
            connection URI and your automatic encryption options.

            .. tabs-drivers::

               .. tab::
                  :tabid: shell

                  .. literalinclude:: /includes/qe-tutorials/mongosh/queryable-encryption-tutorial.js
                     :start-after: start-create-client
                     :end-before: end-create-client
                     :language: javascript
                     :dedent:

               .. tab::
                  :tabid: nodejs

                  .. literalinclude:: /includes/qe-tutorials/node/queryable-encryption-tutorial.js
                     :start-after: start-create-client
                     :end-before: end-create-client
                     :language: javascript
                     :dedent:

               .. tab::
                  :tabid: python

                  .. literalinclude:: /includes/qe-tutorials/python/queryable_encryption_tutorial.py
                     :start-after: start-create-client
                     :end-before: end-create-client
                     :language: python
                     :dedent:

               .. tab::
                  :tabid: java-sync

                  .. literalinclude:: /includes/qe-tutorials/java/src/main/java/com/mongodb/tutorials/qe/QueryableEncryptionTutorial.java
                     :start-after: start-create-client
                     :end-before: end-create-client
                     :language: java
                     :dedent:

               .. tab::
                  :tabid: go

                  .. literalinclude:: /includes/qe-tutorials/go/queryable_encryption_tutorial.go
                     :start-after: start-create-client
                     :end-before: end-create-client
                     :language: go
                     :dedent:

               .. tab::
                  :tabid: csharp

                  :gold:`IMPORTANT:` If you are using the .NET/C# Driver version 3.0 or later,
                  you must add the following code to your application before
                  instantiating a new ``MongoClient``:

                  .. literalinclude:: /includes/qe-tutorials/csharp/QueryableEncryptionTutorial.cs
                     :start-after: start-create-client
                     :end-before: var clientSettings = MongoClientSettings.FromConnectionString(uri);
                     :language: csharp
                     :dedent:
            
                  Instantiate a new ``MongoClient`` by using your
                  connection URI and automatic encryption options:
                     
                  .. literalinclude:: /includes/qe-tutorials/csharp/QueryableEncryptionTutorial.cs
                     :start-after: MongoClientSettings.Extensions.AddAutoEncryption(); // .NET/C# Driver v3.0 or later only
                     :end-before: end-create-client
                     :language: csharp
                     :dedent:










   .. tab:: {+azure-kv+}
      :tabid: create-app-azure

      .. procedure::

         .. step:: Assign application variables

            .. include:: /includes/queryable-encryption/tutorials/assign-app-variables.rst

         .. _qe-tutorials-automatic-encryption-azure-kms-providers:

         .. step:: Add your KMS credentials

            Create a variable containing your KMS credentials with the
            following structure. Use the {+azure-kv+} credentials you 
            recorded in the when you :ref:`registered your application with Azure <qe-register-cmk-azure>`.

            .. tabs-drivers::

               .. tab::
                  :tabid: shell

                  .. literalinclude:: /includes/qe-tutorials/mongosh/queryable-encryption-helpers.js
                     :start-after: start-azure-kms-credentials
                     :end-before: end-azure-kms-credentials
                     :language: javascript
                     :dedent:

                  .. include:: /includes/queryable-encryption/tutorials/automatic/named-kms-note.rst

                     .. replacement:: kms-provider

                        Azure
                     
                     .. replacement:: kms-provider-name

                        "my_azure_provider"

                  .. literalinclude:: /includes/queryable-encryption/tutorials/automatic/azure/named-kms/named-kms-shell.js
                     :language: javascript
                     :dedent:

                  .. include:: /includes/queryable-encryption/tutorials/automatic/default-kms-note.rst

                     .. replacement:: kms-provider-string

                        ``"azure"``

               .. tab::
                  :tabid: nodejs

                  .. literalinclude:: /includes/qe-tutorials/node/queryable-encryption-helpers.js
                     :start-after: start-azure-kms-credentials
                     :end-before: end-azure-kms-credentials
                     :language: javascript
                     :dedent:

                  .. include:: /includes/queryable-encryption/tutorials/automatic/named-kms-note.rst

                     .. replacement:: kms-provider

                        Azure
                     
                     .. replacement:: kms-provider-name

                        "my_azure_provider"

                  .. literalinclude:: /includes/queryable-encryption/tutorials/automatic/azure/named-kms/named-kms.js
                     :language: javascript
                     :dedent:

                  .. include:: /includes/queryable-encryption/tutorials/automatic/default-kms-note.rst

                     .. replacement:: kms-provider-string

                        ``"azure"``

               .. tab::
                  :tabid: python

                  .. literalinclude:: /includes/qe-tutorials/python/queryable_encryption_helpers.py
                     :start-after: start-azure-kms-credentials
                     :end-before: end-azure-kms-credentials
                     :language: python
                     :dedent:

                  .. include:: /includes/queryable-encryption/tutorials/automatic/named-kms-note.rst

                     .. replacement:: kms-provider

                        Azure
                     
                     .. replacement:: kms-provider-name

                        "my_azure_provider"

                  .. literalinclude:: /includes/queryable-encryption/tutorials/automatic/azure/named-kms/named-kms.py
                     :language: python
                     :dedent:

                  .. include:: /includes/queryable-encryption/tutorials/automatic/default-kms-note.rst

                     .. replacement:: kms-provider-string

                        ``"azure"``

               .. tab::
                  :tabid: java-sync

                  .. literalinclude:: /includes/qe-tutorials/java/src/main/java/com/mongodb/tutorials/qe/util/QueryableEncryptionHelpers.java
                     :start-after: start-azure-kms-credentials
                     :end-before: end-azure-kms-credentials
                     :language: java
                     :dedent:

                  .. include:: /includes/queryable-encryption/tutorials/automatic/named-kms-note.rst

                     .. replacement:: kms-provider

                        Azure
                     
                     .. replacement:: kms-provider-name

                        "my_azure_provider"

                  .. literalinclude:: /includes/queryable-encryption/tutorials/automatic/azure/named-kms/NamedKms.java
                     :language: java
                     :dedent:

                  .. include:: /includes/queryable-encryption/tutorials/automatic/default-kms-note.rst

                     .. replacement:: kms-provider-string

                        ``"azure"``

               .. tab::
                  :tabid: go

                  .. literalinclude:: /includes/qe-tutorials/go/queryable_encryption_helpers.go
                     :start-after: start-azure-kms-credentials
                     :end-before: end-azure-kms-credentials
                     :language: go
                     :dedent:

               .. tab::
                  :tabid: csharp

                  .. literalinclude:: /includes/qe-tutorials/csharp/QueryableEncryptionHelpers.cs
                     :start-after: start-azure-kms-credentials
                     :end-before: end-azure-kms-credentials
                     :language: csharp
                     :dedent:

                  .. include:: /includes/queryable-encryption/tutorials/automatic/named-kms-note.rst

                     .. replacement:: kms-provider

                        Azure
                     
                     .. replacement:: kms-provider-name

                        "my_azure_provider"

                  .. literalinclude:: /includes/queryable-encryption/tutorials/automatic/azure/named-kms/NamedKms.cs
                     :language: csharp
                     :dedent:

                  .. include:: /includes/queryable-encryption/tutorials/automatic/default-kms-note.rst

                     .. replacement:: kms-provider-string

                        ``"azure"``

         .. step:: Add your CMK credentials
            
            Create a variable containing your {+cmk-long+} credentials 
            with the following structure. Use the CMK details you 
            recorded when you :ref:`created a CMK <qe-create-cmk-azure>`.

            .. tabs-drivers::

               .. tab::
                  :tabid: shell

                  .. literalinclude:: /includes/qe-tutorials/mongosh/queryable-encryption-helpers.js
                     :start-after: start-azure-cmk-credentials
                     :end-before: end-azure-cmk-credentials
                     :language: javascript
                     :dedent:

               .. tab::
                  :tabid: nodejs

                  .. literalinclude:: /includes/qe-tutorials/node/queryable-encryption-helpers.js
                     :start-after: start-azure-cmk-credentials
                     :end-before: end-azure-cmk-credentials
                     :language: javascript
                     :dedent:

               .. tab::
                  :tabid: python

                  .. literalinclude:: /includes/qe-tutorials/python/queryable_encryption_helpers.py
                     :start-after: start-azure-cmk-credentials
                     :end-before: end-azure-cmk-credentials
                     :language: python
                     :dedent:

               .. tab::
                  :tabid: java-sync

                  .. literalinclude:: /includes/qe-tutorials/java/src/main/java/com/mongodb/tutorials/qe/util/QueryableEncryptionHelpers.java
                     :start-after: start-azure-cmk-credentials
                     :end-before: end-azure-cmk-credentials
                     :language: java
                     :dedent:

               .. tab::
                  :tabid: go

                  .. literalinclude:: /includes/qe-tutorials/go/queryable_encryption_helpers.go
                     :start-after: start-azure-cmk-credentials
                     :end-before: end-azure-cmk-credentials
                     :language: go
                     :dedent:

               .. tab::
                  :tabid: csharp

                  .. literalinclude:: /includes/qe-tutorials/csharp/QueryableEncryptionHelpers.cs
                     :start-after: start-azure-cmk-credentials
                     :end-before: end-azure-cmk-credentials
                     :language: csharp
                     :dedent:


         .. step:: Create an encryption client

               To create a client for encrypting and decrypting data in
               encrypted collections, instantiate a new ``MongoClient``
               using your connection URI and automatic encryption
               options.

               .. tabs-drivers::

                  .. tab::
                     :tabid: shell

                     .. literalinclude:: /includes/qe-tutorials/mongosh/queryable-encryption-tutorial.js
                        :start-after: start-create-client
                        :end-before: end-create-client
                        :language: javascript
                        :dedent:

                  .. tab::
                     :tabid: nodejs

                     .. literalinclude:: /includes/qe-tutorials/node/queryable-encryption-tutorial.js
                        :start-after: start-create-client
                        :end-before: end-create-client
                        :language: javascript
                        :dedent:

                  .. tab::
                     :tabid: python

                     .. literalinclude:: /includes/qe-tutorials/python/queryable_encryption_tutorial.py
                        :start-after: start-create-client
                        :end-before: end-create-client
                        :language: python
                        :dedent:

                  .. tab::
                     :tabid: java-sync

                     .. literalinclude:: /includes/qe-tutorials/java/src/main/java/com/mongodb/tutorials/qe/QueryableEncryptionTutorial.java
                        :start-after: start-create-client
                        :end-before: end-create-client
                        :language: java
                        :dedent:

                  .. tab::
                     :tabid: go

                     .. literalinclude:: /includes/qe-tutorials/go/queryable_encryption_tutorial.go
                        :start-after: start-create-client
                        :end-before: end-create-client
                        :language: go
                        :dedent:

                  .. tab::
                     :tabid: csharp

                     :gold:`IMPORTANT:` If you are using the .NET/C# Driver version 3.0 or later,
                     you must add the following code to your application before
                     instantiating a new ``MongoClient``:

                     .. literalinclude:: /includes/qe-tutorials/csharp/QueryableEncryptionTutorial.cs
                        :start-after: start-create-client
                        :end-before: var clientSettings = MongoClientSettings.FromConnectionString(uri);
                        :language: csharp
                        :dedent:
            
                     Instantiate a new ``MongoClient`` by using your
                     connection URI and automatic encryption options:
                     
                     .. literalinclude:: /includes/qe-tutorials/csharp/QueryableEncryptionTutorial.cs
                        :start-after: MongoClientSettings.Extensions.AddAutoEncryption(); // .NET/C# Driver v3.0 or later only
                        :end-before: end-create-client
                        :language: csharp
                        :dedent:










   .. tab:: {+gcp-kms-abbr+}
      :tabid: create-app-gcp

      .. procedure::

         .. step:: Assign application variables

            .. include:: /includes/queryable-encryption/tutorials/assign-app-variables.rst


         .. step:: Add your KMS credentials

            Create a variable containing your KMS credentials with the
            following structure. 

            .. tabs-drivers::

               .. tab::
                  :tabid: shell

                  .. literalinclude:: /includes/qe-tutorials/mongosh/queryable-encryption-helpers.js
                     :start-after: start-gcp-kms-credentials
                     :end-before: end-gcp-kms-credentials
                     :language: javascript
                     :dedent:

                  .. include:: /includes/queryable-encryption/tutorials/automatic/named-kms-note.rst

                     .. replacement:: kms-provider

                        GCP
                     
                     .. replacement:: kms-provider-name

                        "my_gcp_provider"

                  .. literalinclude:: /includes/queryable-encryption/tutorials/automatic/gcp/named-kms/named-kms-shell.js
                     :language: javascript
                     :dedent:

                  .. include:: /includes/queryable-encryption/tutorials/automatic/default-kms-note.rst

                     .. replacement:: kms-provider-string

                        ``"gcp"``

               .. tab::
                  :tabid: nodejs

                  .. literalinclude:: /includes/qe-tutorials/node/queryable-encryption-helpers.js
                     :start-after: start-gcp-kms-credentials
                     :end-before: end-gcp-kms-credentials
                     :language: javascript
                     :dedent:

                  .. include:: /includes/queryable-encryption/tutorials/automatic/named-kms-note.rst

                     .. replacement:: kms-provider

                        GCP
                     
                     .. replacement:: kms-provider-name

                        "my_gcp_provider"

                  .. literalinclude:: /includes/queryable-encryption/tutorials/automatic/gcp/named-kms/named-kms.js
                     :language: javascript
                     :dedent:

                  .. include:: /includes/queryable-encryption/tutorials/automatic/default-kms-note.rst

                     .. replacement:: kms-provider-string

                        ``"gcp"``

               .. tab::
                  :tabid: python

                  .. literalinclude:: /includes/qe-tutorials/python/queryable_encryption_helpers.py
                     :start-after: start-gcp-kms-credentials
                     :end-before: end-gcp-kms-credentials
                     :language: python
                     :dedent:

                  .. include:: /includes/queryable-encryption/tutorials/automatic/named-kms-note.rst

                     .. replacement:: kms-provider

                        GCP
                     
                     .. replacement:: kms-provider-name

                        "my_gcp_provider"

                  .. literalinclude:: /includes/queryable-encryption/tutorials/automatic/gcp/named-kms/named-kms.py
                     :language: python
                     :dedent:

                  .. include:: /includes/queryable-encryption/tutorials/automatic/default-kms-note.rst

                     .. replacement:: kms-provider-string

                        ``"gcp"``

               .. tab::
                  :tabid: java-sync

                  .. literalinclude:: /includes/qe-tutorials/java/src/main/java/com/mongodb/tutorials/qe/util/QueryableEncryptionHelpers.java
                     :start-after: start-gcp-kms-credentials
                     :end-before: end-gcp-kms-credentials
                     :language: java
                     :dedent:

                  .. include:: /includes/queryable-encryption/tutorials/automatic/named-kms-note.rst

                     .. replacement:: kms-provider

                        GCP
                     
                     .. replacement:: kms-provider-name

                        "my_gcp_provider"

                  .. literalinclude:: /includes/queryable-encryption/tutorials/automatic/gcp/named-kms/NamedKms.java
                     :language: java
                     :dedent:

                  .. include:: /includes/queryable-encryption/tutorials/automatic/default-kms-note.rst

                     .. replacement:: kms-provider-string

                        ``"gcp"``

               .. tab::
                  :tabid: go

                  .. literalinclude:: /includes/qe-tutorials/go/queryable_encryption_helpers.go
                     :start-after: start-gcp-kms-credentials
                     :end-before: end-gcp-kms-credentials
                     :language: go
                     :dedent:

               .. tab::
                  :tabid: csharp

                  .. literalinclude:: /includes/qe-tutorials/csharp/QueryableEncryptionHelpers.cs
                     :start-after: start-gcp-kms-credentials
                     :end-before: end-gcp-kms-credentials
                     :language: csharp
                     :dedent:

                  .. include:: /includes/queryable-encryption/tutorials/automatic/named-kms-note.rst

                     .. replacement:: kms-provider

                        GCP
                     
                     .. replacement:: kms-provider-name

                        "my_gcp_provider"

                  .. literalinclude:: /includes/queryable-encryption/tutorials/automatic/gcp/named-kms/NamedKms.cs
                     :language: csharp
                     :dedent:

                  .. include:: /includes/queryable-encryption/tutorials/automatic/default-kms-note.rst

                     .. replacement:: kms-provider-string

                        ``"gcp"``


         .. step:: Add your CMK credentials
            
            Create a variable containing your {+cmk-long+} credentials 
            with the following structure. Use the credentials you recorded
            when you :ref:`created a CMK <qe-create-cmk-gcp>`.

            .. tabs-drivers::

               .. tab::
                  :tabid: shell

                  .. literalinclude:: /includes/qe-tutorials/mongosh/queryable-encryption-helpers.js
                     :start-after: start-gcp-cmk-credentials
                     :end-before: end-gcp-cmk-credentials
                     :language: javascript
                     :dedent:

               .. tab::
                  :tabid: nodejs

                  .. literalinclude:: /includes/qe-tutorials/node/queryable-encryption-helpers.js
                     :start-after: start-gcp-cmk-credentials
                     :end-before: end-gcp-cmk-credentials
                     :language: javascript
                     :dedent:

               .. tab::
                  :tabid: python

                  .. literalinclude:: /includes/qe-tutorials/python/queryable_encryption_helpers.py
                     :start-after: start-gcp-cmk-credentials
                     :end-before: end-gcp-cmk-credentials
                     :language: python
                     :dedent:

               .. tab::
                  :tabid: java-sync

                  .. literalinclude:: /includes/qe-tutorials/java/src/main/java/com/mongodb/tutorials/qe/util/QueryableEncryptionHelpers.java
                     :start-after: start-gcp-cmk-credentials
                     :end-before: end-gcp-cmk-credentials
                     :language: java
                     :dedent:

               .. tab::
                  :tabid: go

                  .. literalinclude:: /includes/qe-tutorials/go/queryable_encryption_helpers.go
                     :start-after: start-gcp-cmk-credentials
                     :end-before: end-gcp-cmk-credentials
                     :language: go
                     :dedent:

               .. tab::
                  :tabid: csharp

                  .. literalinclude:: /includes/qe-tutorials/csharp/QueryableEncryptionHelpers.cs
                     :start-after: start-gcp-cmk-credentials
                     :end-before: end-gcp-cmk-credentials
                     :language: csharp
                     :dedent:


         .. step:: Create an encryption client

               To create a client for encrypting and decrypting data in
               encrypted collections, instantiate a new ``MongoClient``
               using your connection URI and automatic encryption
               options.

               .. tabs-drivers::

                  .. tab::
                     :tabid: shell

                     .. literalinclude:: /includes/qe-tutorials/mongosh/queryable-encryption-tutorial.js
                        :start-after: start-create-client
                        :end-before: end-create-client
                        :language: javascript
                        :dedent:

                  .. tab::
                     :tabid: nodejs

                     .. literalinclude:: /includes/qe-tutorials/node/queryable-encryption-tutorial.js
                        :start-after: start-create-client
                        :end-before: end-create-client
                        :language: javascript
                        :dedent:

                  .. tab::
                     :tabid: python

                     .. literalinclude:: /includes/qe-tutorials/python/queryable_encryption_tutorial.py
                        :start-after: start-create-client
                        :end-before: end-create-client
                        :language: python
                        :dedent:

                  .. tab::
                     :tabid: java-sync

                     .. literalinclude:: /includes/qe-tutorials/java/src/main/java/com/mongodb/tutorials/qe/QueryableEncryptionTutorial.java
                        :start-after: start-create-client
                        :end-before: end-create-client
                        :language: java
                        :dedent:

                  .. tab::
                     :tabid: go

                     .. literalinclude:: /includes/qe-tutorials/go/queryable_encryption_tutorial.go
                        :start-after: start-create-client
                        :end-before: end-create-client
                        :language: go
                        :dedent:

                  .. tab::
                     :tabid: csharp

                     :gold:`IMPORTANT:` If you are using the .NET/C# Driver version 3.0 or later,
                     you must add the following code to your application before
                     instantiating a new ``MongoClient``:

                     .. literalinclude:: /includes/qe-tutorials/csharp/QueryableEncryptionTutorial.cs
                        :start-after: start-create-client
                        :end-before: var clientSettings = MongoClientSettings.FromConnectionString(uri);
                        :language: csharp
                        :dedent:
            
                     Instantiate a new ``MongoClient`` by using your
                     connection URI and automatic encryption options:
                     
                     .. literalinclude:: /includes/qe-tutorials/csharp/QueryableEncryptionTutorial.cs
                        :start-after: MongoClientSettings.Extensions.AddAutoEncryption(); // .NET/C# Driver v3.0 or later only
                        :end-before: end-create-client
                        :language: csharp
                        :dedent:










   .. tab:: {+kmip-kms-no-hover+}
      :tabid: create-app-kmip

      .. procedure::

         .. step:: Assign application variables

            .. include:: /includes/queryable-encryption/tutorials/assign-app-variables.rst

         .. step:: Add your KMS credentials

            Create a variable containing the endpoint of your 
            {+kmip-kms-no-hover+} with the following structure: 

            .. tabs-drivers::

               .. tab::
                  :tabid: shell

                  .. literalinclude:: /includes/qe-tutorials/mongosh/queryable-encryption-helpers.js
                     :start-after: start-kmip-kms-credentials
                     :end-before: end-kmip-kms-credentials
                     :language: javascript
                     :dedent:

                  .. include:: /includes/queryable-encryption/tutorials/automatic/named-kms-note.rst

                     .. replacement:: kms-provider

                        KMIP
                     
                     .. replacement:: kms-provider-name

                        "my_kmip_provider"

                  .. literalinclude:: /includes/queryable-encryption/tutorials/automatic/kmip/named-kms/named-kms-shell.js
                     :language: javascript
                     :dedent:

                  .. include:: /includes/queryable-encryption/tutorials/automatic/default-kms-note.rst

                     .. replacement:: kms-provider-string

                        ``"kmip"``

               .. tab::
                  :tabid: nodejs

                  .. literalinclude:: /includes/qe-tutorials/node/queryable-encryption-helpers.js
                     :start-after: start-kmip-kms-credentials
                     :end-before: end-kmip-kms-credentials
                     :language: javascript
                     :dedent:

                  .. include:: /includes/queryable-encryption/tutorials/automatic/named-kms-note.rst

                     .. replacement:: kms-provider

                        KMIP
                     
                     .. replacement:: kms-provider-name

                        "my_kmip_provider"

                  .. literalinclude:: /includes/queryable-encryption/tutorials/automatic/kmip/named-kms/named-kms.js
                     :language: javascript
                     :dedent:

                  .. include:: /includes/queryable-encryption/tutorials/automatic/default-kms-note.rst

                     .. replacement:: kms-provider-string

                        ``"kmip"``

               .. tab::
                  :tabid: python

                  .. literalinclude:: /includes/qe-tutorials/python/queryable_encryption_helpers.py
                     :start-after: start-kmip-kms-credentials
                     :end-before: end-kmip-kms-credentials
                     :language: python
                     :dedent:

                  .. include:: /includes/queryable-encryption/tutorials/automatic/named-kms-note.rst

                     .. replacement:: kms-provider

                        KMIP
                     
                     .. replacement:: kms-provider-name

                        "my_kmip_provider"

                  .. literalinclude:: /includes/queryable-encryption/tutorials/automatic/kmip/named-kms/named-kms.py
                     :language: python
                     :dedent:

                  .. include:: /includes/queryable-encryption/tutorials/automatic/default-kms-note.rst

                     .. replacement:: kms-provider-string

                        ``"kmip"``

               .. tab::
                  :tabid: java-sync

                  .. literalinclude:: /includes/qe-tutorials/java/src/main/java/com/mongodb/tutorials/qe/util/QueryableEncryptionHelpers.java
                     :start-after: start-kmip-kms-credentials
                     :end-before: end-kmip-kms-credentials
                     :language: java
                     :dedent:

                  .. include:: /includes/queryable-encryption/tutorials/automatic/named-kms-note.rst

                     .. replacement:: kms-provider

                        KMIP
                     
                     .. replacement:: kms-provider-name

                        "my_kmip_provider"

                  .. literalinclude:: /includes/queryable-encryption/tutorials/automatic/kmip/named-kms/NamedKms.java
                     :language: java
                     :dedent:

                  .. include:: /includes/queryable-encryption/tutorials/automatic/default-kms-note.rst

                     .. replacement:: kms-provider-string

                        ``"kmip"``

               .. tab::
                  :tabid: go

                  .. literalinclude:: /includes/qe-tutorials/go/queryable_encryption_helpers.go
                     :start-after: start-kmip-kms-credentials
                     :end-before: end-kmip-kms-credentials
                     :language: go
                     :dedent:

               .. tab::
                  :tabid: csharp

                  .. literalinclude:: /includes/qe-tutorials/csharp/QueryableEncryptionHelpers.cs
                     :start-after: start-kmip-kms-credentials
                     :end-before: end-kmip-kms-credentials
                     :language: csharp
                     :dedent:

                  .. include:: /includes/queryable-encryption/tutorials/automatic/named-kms-note.rst

                     .. replacement:: kms-provider

                        KMIP
                     
                     .. replacement:: kms-provider-name

                        "my_kmip_provider"

                  .. literalinclude:: /includes/queryable-encryption/tutorials/automatic/kmip/named-kms/NamedKms.cs
                     :language: csharp
                     :dedent:

                  .. include:: /includes/queryable-encryption/tutorials/automatic/default-kms-note.rst

                     .. replacement:: kms-provider-string

                        ``"kmip"``


         .. step:: Add your CMK credentials
            
            Create an empty object as shown in the following code example.
            This prompts your {+kmip-kms+} to generate a new {+cmk-long+}.

            .. tabs-drivers::

               .. tab::
                  :tabid: shell

                  .. literalinclude:: /includes/qe-tutorials/mongosh/queryable-encryption-helpers.js
                     :start-after: start-kmip-local-cmk-credentials
                     :end-before: end-kmip-local-cmk-credentials
                     :language: javascript
                     :dedent:

               .. tab::
                  :tabid: nodejs

                  .. literalinclude:: /includes/qe-tutorials/node/queryable-encryption-helpers.js
                     :start-after: start-kmip-local-cmk-credentials
                     :end-before: end-kmip-local-cmk-credentials
                     :language: javascript
                     :dedent:

               .. tab::
                  :tabid: python

                  .. literalinclude:: /includes/qe-tutorials/python/queryable_encryption_helpers.py
                     :start-after: start-kmip-local-cmk-credentials
                     :end-before: end-kmip-local-cmk-credentials
                     :language: python
                     :dedent:

               .. tab::
                  :tabid: java-sync

                  .. literalinclude:: /includes/qe-tutorials/java/src/main/java/com/mongodb/tutorials/qe/util/QueryableEncryptionHelpers.java
                     :start-after: start-kmip-local-cmk-credentials
                     :end-before: end-kmip-local-cmk-credentials
                     :language: java
                     :dedent:

               .. tab::
                  :tabid: go

                  .. literalinclude:: /includes/qe-tutorials/go/queryable_encryption_helpers.go
                     :start-after: start-kmip-local-cmk-credentials
                     :end-before: end-kmip-local-cmk-credentials
                     :language: go
                     :dedent:

               .. tab::
                  :tabid: csharp

                  .. literalinclude:: /includes/qe-tutorials/csharp/QueryableEncryptionHelpers.cs
                     :start-after: start-kmip-local-cmk-credentials
                     :end-before: end-kmip-local-cmk-credentials
                     :language: csharp
                     :dedent: 


         .. step:: Create an encryption client

               To create a client for encrypting and decrypting data in
               encrypted collections, instantiate a new ``MongoClient``
               using your connection URI and automatic encryption
               options.

               .. tabs-drivers::

                  .. tab::
                     :tabid: shell

                     .. literalinclude:: /includes/qe-tutorials/mongosh/queryable-encryption-tutorial.js
                        :start-after: start-create-client
                        :end-before: end-create-client
                        :language: javascript
                        :dedent:

                  .. tab::
                     :tabid: nodejs

                     .. literalinclude:: /includes/qe-tutorials/node/queryable-encryption-tutorial.js
                        :start-after: start-create-client
                        :end-before: end-create-client
                        :language: javascript
                        :dedent:

                  .. tab::
                     :tabid: python

                     .. literalinclude:: /includes/qe-tutorials/python/queryable_encryption_tutorial.py
                        :start-after: start-create-client
                        :end-before: end-create-client
                        :language: python
                        :dedent:

                  .. tab::
                     :tabid: java-sync

                     .. literalinclude:: /includes/qe-tutorials/java/src/main/java/com/mongodb/tutorials/qe/QueryableEncryptionTutorial.java
                        :start-after: start-create-client
                        :end-before: end-create-client
                        :language: java
                        :dedent:

                  .. tab::
                     :tabid: go

                     .. literalinclude:: /includes/qe-tutorials/go/queryable_encryption_tutorial.go
                        :start-after: start-create-client
                        :end-before: end-create-client
                        :language: go
                        :dedent:

                  .. tab::
                     :tabid: csharp

                     :gold:`IMPORTANT:` If you are using the .NET/C# Driver version 3.0 or later,
                     you must add the following code to your application before
                     instantiating a new ``MongoClient``:

                     .. literalinclude:: /includes/qe-tutorials/csharp/QueryableEncryptionTutorial.cs
                        :start-after: start-create-client
                        :end-before: var clientSettings = MongoClientSettings.FromConnectionString(uri);
                        :language: csharp
                        :dedent:
            
                     Instantiate a new ``MongoClient`` by using your
                     connection URI and automatic encryption options:
                     
                     .. literalinclude:: /includes/qe-tutorials/csharp/QueryableEncryptionTutorial.cs
                        :start-after: MongoClientSettings.Extensions.AddAutoEncryption(); // .NET/C# Driver v3.0 or later only
                        :end-before: end-create-client
                        :language: csharp
                        :dedent:

Next Steps
----------

After installing a driver and dependencies, creating a {+cmk-long+}, and
creating your application, see :ref:`Overview: Use {+qe+} 
<qe-overview-use-qe>` to encrypt and query data.