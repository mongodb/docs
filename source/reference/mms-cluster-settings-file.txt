.. _mms-cluster-settings-file: 

==========================
Cluster Configuration File
==========================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. _mms-cluster-settings-file-overview:

Overview 
--------

The ``mongocli`` command requires cluster configuration 
settings for creating or updating a |cloud| or |mms-full| 
cluster. The configuration properties can be provided 
through a ``.yaml`` or ``.json`` file. The following sections 
describe the :ref:`mms-config-props` that are required for 
creating or updating a cluster and provide a 
:ref:`mms-sample-config-file` that you can copy and modify. 

.. _mms-config-props:

Configuration Properties
------------------------

The following sections contain the: 

- Cluster-wide configuration properties
- Replica set member configuration properties
- Sharded cluster configuration properties

Cluster-Wide Settings 
~~~~~~~~~~~~~~~~~~~~~

The configuration file for creating or updating a |cloud| or 
|mms-full| cluster must contain the following cluster-wide settings:

.. list-table:: 
   :header-rows: 1 
   :widths: 20 10 70 

   * - Field 
     - Type 
     - Description 

   * - ``name``
     - string
     - Name of the cluster.

   * - ``version``
     - string
     - Version of the :manual:`mongod 
       </reference/program/mongod/#bin.mongod>` process to deploy.

   * - ``featureCompatibilityVersion``
     - string
     - :manual:`Feature Compatibility Version 
       </reference/command/setFeatureCompatibilityVersion#dbcmd.setFeatureCompatibilityVersion>` 
       of the deployment. 

   * - ``processes``
     - array of objects
     - Required for replica sets. An array of objects containing 
       settings for each 
       :manual:`mongod </reference/program/mongod/#bin.mongod>` 
       process. Each ``mongod`` has 
       :ref:`replica set member settings <replica-set-member-settings>`.

   * - ``shards``
     - array of objects
     - Required for sharded clusters. An array of objects containing 
       settings for each shard.

   * - ``config``
     - object
     - Required for sharded clusters. Object that contains your 
       :manual:`config server </core/sharded-cluster-config-servers/>` 
       replica set.

   * - ``mongos``
     - array of objects
     - Required for sharded clusters. An array of objects containing 
       settings for each :manual:`mongos </reference/program/mongos>` 
       instance.

.. _replica-set-member-settings:

Replica Set Member Settings 
~~~~~~~~~~~~~~~~~~~~~~~~~~~

The configuration file for creating or updating a |cloud| or 
|mms-full| cluster can contain the following settings for each 
replica set member:

.. list-table:: 
   :header-rows: 1 
   :widths: 20 10 60 10

   * - Field 
     - Type 
     - Description 
     - Required?

   * - ``buildIndexes``
     - boolean 
     - Flag that indicates whether to direct the :manual:`mongod 
       </reference/program/mongod/#bin.mongod>` to build indexes. 
       Value can be ``true`` or ``false``. 

       This setting corresponds to the :manual:`buildIndexes 
       </reference/replica-configuration/#rsconf.members[n].buildIndexes>` 
       :manual:`mongod </reference/program/mongod/#bin.mongod>` replica set 
       configuration option. 
     - no

   * - ``dbPath``
     - string
     - Directory where the :manual:`mongod 
       </reference/program/mongod/#bin.mongod>` instance stores its 
       data. This cannot be modified after deployment.
     - yes

   * - ``delay`` 
     - int 
     - Number of seconds behind the primary member that 
       this member should lag. This setting corresponds to the 
       :manual:`slaveDelay 
       </reference/replica-configuration/#rsconf.members[n].slaveDelay>` 
       :manual:`mongod </reference/program/mongod/#bin.mongod>` replica set 
       configuration option.
     - no

   * - ``hostname``
     - string
     - Name of the host to add to the replica set. This is the 
       host on which |mms| deploys the :manual:`mongod 
       </reference/program/mongod/#bin.mongod>` process.
     - yes

   * - ``logPath``
     - string
     - Location and name of the log file for the :manual:`mongod 
       </reference/program/mongod/#bin.mongod>` process 
       on the host.
     - yes

   * - ``port``
     - integer
     - Port for the replica set member. The :manual:`mongod 
       </reference/program/mongod/#bin.mongod>` process 
       must have exclusive access to the specified port. 
     - yes

   * - ``priority``
     - integer
     - :manual:`Priority 
       </reference/replica-configuration/#rsconf.members[n].priority>` 
       of the replica set member during elections. Value 
       can be: 

       - ``0`` 
       - ``1``

       Non-voting members must have a priority of ``0``. Replica 
       set members with a priority of ``0`` cannot become the primary 
       and cannot trigger elections. 
     - yes

   * - ``tls.CAFile``
     - string
     - ``.pem`` file that contains the root certificate chain from the 
       Certificate Authority. Specify the file name of the ``.pem`` file
       using relative or absolute paths.

       This setting corresponds to the :manual:`net.tls.CAFile
       </reference/configuration-options/#net.tls.CAFile>` |mongod|
       replica set configuration option.
     - no

   * - ``tls.certificateKeyFile``
     - string
     - ``.pem`` file that contains both the TLS certificate and key.

       ``tls.certificateKeyFile`` and ``tls.certificateSelector`` are
       mutually exclusive. You can only specify one.

       This setting corresponds to the :manual:`net.tls.certificateKeyFile
       </reference/configuration-options/#net.tls.certificateKeyFile>`
       |mongod| replica set configuration option.
     - no

   * - ``tls.certificateKeyFilePassword``
     - string
     - Password to de-crypt the certificate-key file.

       Use the ``tls.certificateKeyFilePassword`` option only if the
       certificate-key file is encrypted. In all cases, the |mongos| or
       |mongod| will redact the password from all logging and reporting
       output.

       This setting corresponds to the
       :manual:`net.tls.certificateKeyFilePassword 
       </reference/configuration-options/#net.tls.certificateKeyFilePassword>`
       |mongod| replica set configuration option.
     - no

   * - ``tls.certificateSelector``
     - string
     - Certificate property that the {+mdbagent+} uses to select a
       matching certificate from the operating system’s certificate
       store to use for TLS/SSL.

       {+mcli+} accepts one of the following key-value mappings as an
       argument of ``tls.certificateSelector``:

       .. list-table::
          :header-rows: 1
       
          * - Key
            - Value type
            - Description
          * - ``subject``
            - ASCII string	
            - The subject name or common name on the certificate.
          * - ``thumbprint``
            - hex string
            - A sequence of bytes, expressed as hexadecimal, used to
              identify a public key by its SHA-1 digest.

              The ``thumbprint`` is sometimes referred to as a
              ``fingerprint``.

       ``tls.certificateKeyFile`` and ``tls.certificateSelector`` are
       mutually exclusive. You can only specify one.

       This setting corresponds to the
       :manual:`net.tls.certificateSelector 
       </reference/configuration-options/#net.tls.certificateSelector>`
       |mongod| replica set configuration option.
     - no

   * - ``tls.clusterCertificateSelector``
     - string
     - Certificate property that the {+mdbagent+} uses to select a
       matching certificate from the operating system’s certificate
       store to use for :manual:`internal x.509 membership
       authentication
       </core/security-internal-authentication/#internal-auth-x509>`. 

       {+mcli+} accepts one of the following key-value mappings as an
       argument of ``tls.clusterCertificateSelector``:

       .. list-table::
          :header-rows: 1
       
          * - Key
            - Value type
            - Description
          * - ``subject``
            - ASCII string	
            - The subject name or common name on the certificate.
          * - ``thumbprint``
            - hex string
            - A sequence of bytes, expressed as hexadecimal, used to
              identify a public key by its SHA-1 digest.

              The ``thumbprint`` is sometimes referred to as a
              ``fingerprint``.

       ``tls.clusterCertificateSelector`` and ``tls.clusterFile`` are
       mutually exclusive. You can only specify one.

       This setting corresponds to the
       :manual:`net.tls.clustercertificateSelector 
       </reference/configuration-options/#net.tls.clustercertificateSelector>`
       |mongod| replica set configuration option.
     - no

   * - ``tls.clusterFile``
     - string
     - ``.pem`` file that contains the x.509 certificate-key file for
       :manual:`membership authentication
       </tutorial/configure-x509-member-authentication/#x509-internal-authentication>`
       for the cluster or replica set.

       ``tls.clusterCertificateSelector`` and ``tls.clusterFile`` are
       mutually exclusive. You can only specify one.

       This setting corresponds to the :manual:`net.tls.clusterFile
       </reference/configuration-options/#net.tls.clusterFile>`
       |mongod| replica set configuration option.
     - no

   * - ``tls.clusterPassword``
     - string
     - The password to de-crypt the x.509 certificate-key file specified
       with ``tls.clusterFile``.

       Use the ``tls.clusterPassword`` option only if the certificate-key
       file is encrypted. In all cases, the |mongos| or |mongod| will
       redact the password from all logging and reporting output.

       This setting corresponds to the :manual:`net.tls.clusterPassword
       </reference/configuration-options/#net.tls.clusterPassword>`
       |mongod| replica set configuration option.
     - no

   * - ``tls.CRLFile``
     - string
     - The ``.pem`` file that contains the Certificate Revocation List.
       Specify the file name of the ``.pem`` file using relative or
       absolute paths.

       This setting corresponds to the :manual:`net.tls.CRLFile
       </reference/configuration-options/#net.tls.CRLFile>`
       |mongod| replica set configuration option.
     - no

   * - ``tls.disabledProtocols``
     - string
     - Protocols or versions over which a MongoDB server running with
       TLS refuses incoming connections.

       This setting corresponds to the :manual:`net.tls.disabledProtocols
       </reference/configuration-options/#net.tls.disabledProtocols>`
       |mongod| replica set configuration option.
     - no

   * - ``tls.FIPSMode``
     - string
     - Enable or disable the use of the FIPS mode of the TLS library for
       the |mongos| or |mongod|. Your system must have a FIPS compliant
       library to use this option.

       This setting corresponds to the :manual:`net.tls.FIPSMode
       </reference/configuration-options/#net.tls.FIPSMode>`
       |mongod| replica set configuration option.
     - no

   * - ``tls.mode``
     - string
     - Enables TLS for all network connections. {+mcli+} accepts the
       following arguments for this setting:

       .. list-table::
          :header-rows: 1
          :widths: 20 40
        
          * - Value
            - Description
        
          * - ``disabled``
            - The server does not use tls.
        
          * - ``allowTLS``
            - Connections between servers do not use tls. For incoming
              connections, the server accepts both TLS and non-tls.

          * - ``preferTLS``
            - Connections between servers use tls. For incoming
              connections, the server accepts both TLS and non-tls.

          * - ``requireTLS``
            - The server uses and accepts only TLS encrypted connections.

       This setting corresponds to the :manual:`net.tls.mode
       </reference/configuration-options/#net.tls.mode>`
       |mongod| replica set configuration option.
     - no

   * - ``tls.PEMKeyFile``
     - string
     - ``.pem`` file that contains both the TLS certificate and key.

       .. important::

          This setting is deprecated. Use ``tls.certificateKeyFile``
          instead.

       This setting corresponds to the :manual:`net.ssl.PEMKeyFile
       </reference/configuration-options/#net.ssl.PEMKeyFile>`
       |mongod| replica set configuration option.
     - no

   * - ``votes``
     - integer
     - Number that indicates whether the replica set member 
       votes in the election. Value can be: 

       - ``0`` if the replica set member cannot vote
       - ``1`` if the replica set member can vote

       To learn more about ``votes``, see :manual:`votes 
       </reference/replica-configuration/#rsconf.members[n].votes>`.
     - yes

.. _shard-settings:

Shard Settings 
~~~~~~~~~~~~~~

The configuration file for creating or updating a |cloud| or 
|mms-full| cluster can contain the following settings for each 
shard:

.. list-table:: 
   :header-rows: 1 
   :widths: 20 10 60 10

   * - Field 
     - Type 
     - Description 
     - Required?

   * - ``name``
     - string
     - Name of the of the shard.
     - yes
   
   * - ``processes``
     - array of objects
     - An array of objects containing settings 
       for each 
       :manual:`mongod </reference/program/mongod/#bin.mongod>` 
       process. Each ``mongod`` has 
       :ref:`replica set member settings <replica-set-member-settings>`.
     - yes

.. _mms-sample-config-file:

Sample Configuration File 
-------------------------

.. tabs:: 

   .. tab:: YAML Replica Set Configuration
      :tabid: yaml 

      .. code-block:: text 

         name: "myCluster"
         version: 4.2.2
         featureCompatibilityVersion: 4.2
         processes:
             - hostname: host0
               dbPath: /data/cluster_2/rs1
               logPath: /data/cluster_2/rs1/mongodb.log
               priority: 1
               votes: 1
               port: 29010
             - hostname: host1
               dbPath: /data/cluster_2/rs2
               logPath: /data/cluster_2/rs2/mongodb.log
               priority: 1
               votes: 1
               port: 29020
             - hostname: host2
               dbPath: /data/cluster_2/rs3
               logPath: /data/cluster_2/rs3/mongodb.log
               priority: 1
               votes: 1
               port: 29030

   .. tab:: JSON Replica Set Configuration
      :tabid: json 

      .. code-block:: json 

         {
             "name": "myCluster",
             "version": "4.2.2",
             "featureCompatibilityVersion": "4.2",
             "processes": [
              {
                 "hostname": "host0",
                 "dbPath": "/data/cluster_3/rs1",
                 "logPath": "/data/cluster_3/rs1/mongodb.log",
                 "priority": 1,
                 "votes": 1,
                 "port": 30010
              },
              {
                 "hostname": "host1",
                 "dbPath": "/data/cluster_3/rs2",
                 "logPath": "/data/cluster_3/rs2/mongodb.log",
                 "priority": 1,
                 "votes": 1,
                 "port": 30020
              },
              {
                 "hostname": "host2",
                 "dbPath": "/data/cluster_3/rs3",
                 "logPath": "/data/cluster_3/rs3/mongodb.log",
                 "priority": 1,
                 "votes": 1,
                 "port": 30030
              }
            ]
         }

   .. tab:: JSON Sharded Cluster Configuration
      :tabid: json-sharded 

      .. code-block:: json 

         {
           "name": "myShardedCluster",
           "version": "4.2.2",
           "featureCompatibilityVersion": "4.2",
           "shards": [
             {
               "name": "myShard_0",
               "processes": [
                 {
                   "dbPath": "/data/myCluster/myShard_0/27000",
                   "hostname": "host0.example",
                   "logPath": "/data/myCluster/myShard_0/27000/mongodb.log",
                   "port": 27000,
                   "votes": 1
                 },
                 {
                   "dbPath": "/data/myCluster/myShard_0/27001",
                   "hostname": "host1.example",
                   "logPath": "/data/myCluster/myShard_0/27001/mongodb.log",
                   "port": 27001,
                   "votes": 1
                 },
                 {
                   "dbPath": "/data/myCluster/myShard_0/27002",
                   "hostname": "host2.example",
                   "logPath": "/data/myCluster/myShard_0/27002/mongodb.log",
                   "port": 27002,
                   "version": "4.2.8-ent",
                   "votes": 1
                 }
               ]
             },
             {
               "name": "myShard_1",
               "processes": [
                 {
                   "dbPath": "/data/myCluster/myShard_1/28000",
                   "hostname": "host3.example",
                   "logPath": "/data/myCluster/myShard_1/28000/mongodb.log",
                   "port": 28000,
                   "votes": 1
                 },
                 {
                   "dbPath": "/data/myCluster/myShard_1/28001",
                   "hostname": "host4.example",
                   "logPath": "/data/myCluster/myShard_1/28001/mongodb.log",
                   "port": 28001,
                   "votes": 1
                 },
                 {
                   "dbPath": "/data/myCluster/myShard_1/28002",
                   "hostname": "host5.example",
                   "logPath": "/data/myCluster/myShard_1/28002/mongodb.log",
                   "port": 28002,
                   "votes": 1
                 }
               ]
             }
           ],
           "config": {
             "name": "configRS",
             "processes": [
               {
                 "dbPath": "/data/myCluster/configRS/29000",
                 "hostname": "host6.example",
                 "logPath": "/data/myCluster/configRS/29000/mongodb.log",
                 "port": 29000,
                 "votes": 1
               },
               {
                 "dbPath": "/data/myCluster/configRS/29001",
                 "hostname": "host7.example",
                 "logPath": "/data/myCluster/configRS/29001/mongodb.log",
                 "port": 29001,
                 "votes": 1
               },
               {
                 "dbPath": "/data/myCluster/configRS/29002",
                 "hostname": "host8.example",
                 "logPath": "/data/myCluster/configRS/29002/mongodb.log",
                 "port": 29002,
                 "votes": 1
               }
             ]
           },
           "mongos": [
             {
               "hostname": "host9.example",
               "logPath": "/data/myCluster/mongoses/27015/mongodb.log",
               "port": 27015
             }
           ]
         }
