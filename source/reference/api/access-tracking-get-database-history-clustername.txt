===========================================
Get Database Access History by Cluster Name
===========================================

.. default-domain:: mongodb

.. meta::
   :canonical: https://www.mongodb.com/docs/atlas/reference/api-resources-spec/#tag/Access-Tracking

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

Retrieve the access logs of a cluster by cluster name.

.. include:: /includes/fact-projects-groups-synonyms.rst

.. include:: /includes/fact-atlas-free-tier-limits.rst

.. include:: /includes/api-requirements.rst

.. include:: /includes/api/base-api-uri.rst


Resource
--------

.. code-block:: http

   GET /groups/{GROUP-ID}/dbAccessHistory/clusters/{CLUSTER-NAME}


Request Path Parameters
~~~~~~~~~~~~~~~~~~~~~~~

.. list-table::
   :header-rows: 1
   :widths: 15 10 75

   * - Path Element
     - Required/Optional
     - Description

   * - ``GROUP-ID``

     - Required.

     - The unique identifier for the :ref:`project <group-id>`.

   * - ``CLUSTER-NAME``

     - Required.

     - The name of the cluster.

Request Query Parameters
~~~~~~~~~~~~~~~~~~~~~~~~

.. list-table::
   :widths: 20 14 11 45 10
   :header-rows: 1
   :stub-columns: 1

   * - Name
     - Type
     - Necessity
     - Description
     - Default

   * - envelope
     - boolean
     - Optional
     - Flag that indicates whether |service| wraps the response in an
       :ref:`envelope <api-envelope>`.

       Some |api| clients cannot access the |http| response headers or
       status code. To remediate this, set ``envelope=true`` in the
       query.

       Endpoints that return a list of results use the **results**
       object as an envelope. |service| adds the **status** parameter
       to the response body.

     - ``false``

.. include:: /includes/api/list-tables/requests/access-tracking-query.rst


Request Body Parameters
~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/no-body-parameters.rst

Response
--------

.. include:: /includes/list-table-access-tracking-response.rst

Example Request
---------------

.. code-block:: sh

   curl --user "username:apiKey" --digest \
        --header "Accept: application/json" \
        --request GET "https://cloud.mongodb.com/api/atlas/v1.0/groups/571c390a7cea7e4dbf32b625/dbAccessHistory/clusters/cluster0?start=1564064082000&end=1564064082000&nLogs=2"


Example Response
----------------

Response Header
~~~~~~~~~~~~~~~

.. include:: /includes/api/api-headers/200.rst

Response Body
~~~~~~~~~~~~~

.. code-block:: json

  {
    "accessLogs": [
      {
        "authResult": true,
        "authSource": "admin",
        "failureReason": null,
        "groupId": "571c390a7cea7e4dbf32b625",
        "hostname": "cluster0-shard-00-00-c01ab.mongodb.net:27017",
        "clusterName": "cluster0",
        "ipAddress": "123.45.0.1",
        "logLine": "2019-07-25T19:14:42.484+0000 I  ACCESS   [conn2167] Successfully authenticated as principal jon-snow on admin from client 123.45.0.1:8080",
        "timestamp": "Sun Jul 25 9:14:42 EDT 2019",
        "username": "jon-snow"
      },
      {
        "authResult": false,
        "authSource": "admin",
        "failureReason": "UserNotFound: Could not find user \"jane-doe\" for db \"admin\"",
        "groupId": "571c390a7cea7e4dbf32b625",
        "hostname": "cluster0-shard-00-00-c01ab.mongodb.net:27017",
        "clusterName": "cluster0",
        "ipAddress": "123.45.2.2",
        "logLine": "2019-07-25T19:13:39.316+0000 I  ACCESS   [conn1893] SASL SCRAM-SHA-1 authentication failed for jane-doe on admin from client 123.45.2.2:51842 ; UserNotFound: Could not find user \"jane-doe\" for db \"admin\"",
        "timestamp": "Sun Jul 25 9:14:42 EDT 2019",
        "username": "jane-doe"
      }
  ]}


