==================================================
Configure MongoDB Authentication and Authorization
==================================================

.. default-domain:: mongodb

Overview
--------

Your MongoDB processes can use the access control mechanisms described
here. If a MongoDB process uses access control, you must configure the
Monitoring and Backup Agents to authenticate as users with the proper
access.

.. only:: onprem

   If a :doc:`backing MongoDB instance
   </tutorial/prepare-backing-mongodb-instances>` runs with access
   control, the |application| must authenticate to the backing instances
   as a MongoDB user with appropriate access. The user must have the
   following roles: :authrole:`readWriteAnyDatabase`,
   :authrole:`clusterAdmin`, and :authrole:`dbAdminAnyDatabase`.

Access Control Mechanisms
-------------------------

.. _mongodb-cr:

MONGODB-CR
++++++++++

MongoDB Challenge-Response (``MONGODB-CR``) is the MongoDB default for
authentication and authorization. To enable ``MONGODB-CR``,
see :doc:`/tutorial/enable-mongodb-access-control`.

To configure the agents to authenticate as users with the proper access, see:

- :doc:`/tutorial/configure-monitoring-agent-for-cr`

- :doc:`/tutorial/configure-backup-agent-for-cr`

.. only:: onprem

   To configure the |application| to authenticate to the :doc:`backing
   instances </tutorial/prepare-backing-mongodb-instances>` using
   ``MONGODB-CR``, see :setting:`mongo.mongoUri`.

LDAP
++++

.. only:: onprem

   To configure the |onprem| to use an LDAP server for authentication, see
   :doc:`/tutorial/configure-for-ldap-authentication`.

To configure the agents to authenticate as users with the proper access, see:

- :doc:`/tutorial/configure-monitoring-agent-for-ldap`

- :doc:`/tutorial/configure-backup-agent-for-ldap`

Kerberos
++++++++

If your MongoDB deployment uses Kerberos for authentication, you must
create the Kerberos Principal for the |mms| agents, create a MongoDB user
for that Kerberos Principal, edit the agent's configuration file. If you
are running both the Monitoring Agent and the Backup Agent on the same
server, then both agents must connect as the same Kerberos Principal.

To create a Kerberos Principal and the associated MongoDB user, and to
configure the Monitoring and Backup Agents to authenticate as users with
the proper access, see:

- :doc:`/tutorial/configure-monitoring-agent-for-kerberos`

- :doc:`/tutorial/configure-backup-agent-for-kerberos`

Specify Kerberos as the MongoDB process's authentication mechanism when
:doc:`adding the deployment </tutorial/add-hosts-to-monitoring>` or when
:ref:`editing the deployment <edit-host-credentials>`.

.. only:: onprem

   To enable Kerberos authentication between the |application| and the
   :ref:`mms-application-database`, configure the
   :ref:`configuration-kerberos-settings` and the
   :setting:`mongo.mongoUri` setting. You must configure all required
   Kerberos settings to enable Kerberos authentication.

.. _edit-host-credentials:

Edit Host Credentials
---------------------

Before you edit authentication credentials, **first** configure the
Monitoring and Backup Agents with the proper credentials. Do this
**before** configuring the credentials on the deployment. See:

- :doc:`/tutorial/nav/configure-monitoring-agent`.

- :doc:`/tutorial/nav/configure-backup-agent`.

Then you can edit authentication credentials using the procedures below.

Edit Credentials for Monitoring a Host
++++++++++++++++++++++++++++++++++++++

Before editing these credentials, configure the Monitoring Agent with the
proper credentials. See :doc:`/tutorial/nav/configure-monitoring-agent`.

To edit credential information:

.. include:: /includes/steps/monitoring-agent-edit-host-credentials.rst

Edit Credentials for Backing up a Host
++++++++++++++++++++++++++++++++++++++

Before editing these credentials, configure the Backup Agent with the
proper credentials. See :doc:`/tutorial/nav/configure-backup-agent`.

To edit credential information:

.. include:: /includes/steps/backup-agent-edit-host-credentials.rst
