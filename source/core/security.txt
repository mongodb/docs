.. **BUILD WARNINGS**:: I could not find the reason multiple
   of the build warning in this file.

========
Security
========

.. default-domain:: mongodb

Overview
--------

.. only:: cloud

   |MMS| provides encryption, authentication and authorization to
   ensure the security of your |MMS| agents and MongoDB deployments.
   
.. only:: classic

   |MMS| provides configurable encryption, authentication, and
   authorization to ensure the security of your |MMS| agents and
   MongoDB deployments. |MMS| supports :ref:`security-ssl`,
   :ref:`security-mongodb-cr`, :ref:`security-ldap`, and
   :ref:`security-kerberos`.

.. only:: onprem

   |MMS| provides configurable encryption, authentication, and
   authorization to ensure the security of your |MMS| agents, |MMS|
   deployments, and MongoDB deployments. |MMS| supports
   :ref:`security-ssl`, :ref:`security-mongodb-cr`,
   :ref:`security-ldap`, and :ref:`security-kerberos`.

Encryption
~~~~~~~~~~
   
.. only:: onprem or classic

   |MMS| uses :ref:`security-ssl` for encrypting communications for the
   following Monitoring Agent and Backup Agent connections:

   - Connections to MongoDB instances

   - Connections to |MMS| servers

.. only:: cloud

   |MMS| uses :ref:`security-ssl` for encrypting communications for the
   Monitoring Agent and Backup Agent connections to |MMS| servers.

For information regarding |MMS| and SSL, see :ref:`security-ssl`. 

.. _security-access-control-authentication:

Access Control and Authentication
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

MongoDB uses Role-Based Access Control (RBAC) to determine access to a
MongoDB system. When run with access control, MongoDB requires users to
authenticate themselves to determine their access.

.. only:: onprem

   If the Backing instance runs with access control, |mms| Application
   Server must authenticate to its Backing instances as a user with
   :ref:`appropriate access <server-mongodb-user-access>`.

If a MongoDB deployment runs with access control, |MMS| agents must
authenticate to the deployment as a MongoDB user with appropriate
MongoDB user roles [#roles-disambiguation]_.  

- :doc:`/reference/required-access-monitoring-agent`
- :doc:`/reference/required-access-backup-agent`

.. only:: onprem or classic

   For an overview on authenticating with the supported mechanisms, see
   :ref:`security-mongodb-cr`, :ref:`security-ldap`, and
   :ref:`security-kerberos`.

.. _security-ssl:

SSL
---

SSL encrypts the connections made by Monitoring Agents and Backup
Agents to both MongoDB instances and to |MMS| servers. SSL
encryption ensures communications are readable only by the intended
parties.

.. only:: cloud or classic

   Agents always use SSL when communicating with the |MMS| servers. SSL
   encryption ensures communications are readable only by the intended
   parties.

.. only:: onprem

   Agents can use SSL when communicating with the |MMS| servers and
   when communicating with the MongoDB deployment. 

.. only:: onprem

   Connections to |MMS| Servers
   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~

   To ensure that the agents use SSL when connecting to the |MMS|
   servers, use an HTTPS proxy in front of |MMS|.

   You can optionally configure a Jetty instance to use HTTPS for
   connections between the |mms| application and agents. To do so, see
   :doc:`/tutorial/configure-jetty-https`.

.. only:: onprem or classic

   Connections to MongoDB Deployments
   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

   If the MongoDB deployment uses SSL, you must configure the |mms| agents
   as well as specify the host's :guilabel:`Use SSL` settings.

   .. include:: /includes/ref-ssl-configuration.rst

.. _security-mongodb-cr:

MONGODB-CR
----------

.. only:: classic or cloud

   |MMS| can use the MongoDB Challenge-Response, i.e. ``MONGODB-CR``,
   authentication mechanism to authenticate to a MongoDB deployment.

.. only:: onprem

   Application Configuration Settings
   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

   The |mms| Application can use MongoDB Challenge-Response, i.e.
   ``MONGODB-CR``, to authenticate to the backing MongoDB instances.
   See :setting:`mongo.mongoUri` and
   :ref:`on-prem-authentication-configuration` for more information.

.. only:: classic or onprem

   Agent Configuration
   ~~~~~~~~~~~~~~~~~~~

   If your MongoDB deployment uses ``MONGODB-CR`` for authentication, you
   must create a MongoDB user for the |mms| agents as well as specify the
   host's authentication settings.

   .. include:: /includes/ref-mongodb-cr-configuration.rst

.. only:: classic or onprem

   .. _security-ldap:

   LDAP
   ----

   .. only:: classic

      |mms| agents can use the LDAP authentication mechanism to
      authenticate to the MongoDB deployment.

   .. only:: onprem

      |mms| agents can use the LDAP authentication mechanism to connect
      to the MongoDB deployment. Additionally, and independently, the
      |mms| Application Server can use LDAP authentication to its
      Backing MongoDB instances.

   .. only:: onprem

      Application Configuration Settings
      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

      To configure LDAP authentication between the |mms| application
      and the backing MongoDB instances, see
      :doc:`/tutorial/configure-for-ldap-authentication`,
      :setting:`mongo.mongoUri`, :ref:`ldap-settings`, and
      :ref:`on-prem-authentication-configuration`.

   Agent Configuration
   ~~~~~~~~~~~~~~~~~~~

   If your MongoDB deployment uses LDAP for authentication, you must
   create a MongoDB user for the |mms| agents as well as specify the
   host's authentication settings.

   .. include:: /includes/ref-ldap-configuration.rst

.. only:: classic or onprem

   .. _security-kerberos:

   Kerberos
   --------

   .. only:: onprem

      Application Configuration Settings
      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

      To enable Kerberos authentication between the MMS application and
      its :doc:`backing database
      </tutorial/prepare-backing-mongodb-instances>`, see
      :ref:`configuration-kerberos-settings`, :setting:`mongo.mongoUri`,
      and :ref:`on-prem-authentication-configuration`.

   Agent Configuration
   ~~~~~~~~~~~~~~~~~~~

   If your MongoDB deployment uses Kerberos for authentication, you must
   create the Kerberos Principal for the |mms| agents, create a MongoDB
   user for that Kerberos Principal, edit the agent's configuration file,
   and specify the host's authentication settings.

   If you are running both the Monitoring Agent and the Backup Agent on
   the same server, then both agents must connect as the same Kerberos
   Principal. 
   
   .. include:: /includes/ref-kerberos-configuration.rst

Two-Factor Authentication
-------------------------

.. only:: classic or cloud

   To activate two-factor authentication, which users and
   administrators use to authenticate to the MMS interface, see
   :doc:`/core/two-factor-authentication`.

.. only:: onprem

   To activate and manage two-factor authentication, which users and
   administrators use to authenticate to the MMS interface, see
   :doc:`/core/two-factor-authentication` and
   :doc:`/tutorial/manage-two-factor-authentication`.

.. [#roles-disambiguation]
   MongoDB user roles are separate from |MMS| :doc:`user roles
   </reference/user-roles>`.
