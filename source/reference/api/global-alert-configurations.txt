===========================
Global Alert Configurations
===========================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: twocols

.. include:: /includes/fact-groups-projects-synonyms.rst

The ``globalAlertConfigs`` resource retrieves and updates :doc:`alert
configurations </tutorial/manage-alert-configurations>` for :doc:`global
alerts </tutorial/manage-global-alerts>`.

.. include:: /includes/api/base-api-uri.rst

Endpoints
---------

Get All Global Alert Configurations
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. code-block:: http

   GET /globalAlertConfigs

Get a Specific Global Alert Configuration
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. code-block:: http

   GET /globalAlertConfigs/GLOBAL-ALERT-CONFIG-ID

Get All Open Alerts Triggered by a Global Alert Configuration
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. code-block:: http

   GET /globalAlertConfigs/GLOBAL-ALERT-CONFIG-ID/alerts

Create a Global Alert Configuration
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. code-block:: none

   POST /globalAlertConfigs

The following fields are required:

- ``eventTypeName``
- ``notifications``
- ``forAllGroups``

The ``metricThreshold`` field is required if ``eventTypeName`` is set to
``OUTSIDE_METRIC_THRESHOLD``.

The ``threshold`` field is required if ``eventTypeName`` is set to either
of the following:

- ``TOO_FEW_HEALTHY_MEMBERS``
- ``TOO_MANY_UNHEALTHY_MEMBERS``

To enable the global alert configuration, set the ``enabled`` field to
``true``.

.. important::
   If the ``enabled`` field is not specified, |onprem| sets its value to
   ``false`` by default, and the global alert configuration is not enabled.

Update a Global Alert Configuration
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

For most updates, you must use ``PUT`` and send the entire entity. The only
exception is for updates to the ``enabled`` field, as described in
:ref:`patch-globalAlertConfigs-id`.

.. code-block:: none

   PUT /globalAlertConfigs/GLOBAL-ALERT-CONFIG-ID

.. _patch-globalAlertConfigs-id:

Enable or Disable a Global Alert Configuration
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Use to enable/disable a global alert configuration by setting the ``enabled``
field.

.. code-block:: none

   PATCH /globalAlertConfigs/GLOBAL-ALERT-CONFIG-ID

Delete a Global Alert Configuration
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. code-block:: none

   DELETE /globalAlertConfigs/GLOBAL-ALERT-CONFIG-ID

Sample Entity
-------------

The following is an example return document.

.. code-block:: json

   {
     "id" : "56a104e0e4b00664f588acbc",
     "groupIds" : [ ],
     "created" : "2016-05-17T20:20:34Z",
     "enabled" : true,
     "eventTypeName" : "OUTSIDE_METRIC_THRESHOLD",
     "forAllGroups" : true,
     "matchers" : [ ],
     "notifications" : [ {
       "delayMin" : 0,
       "intervalMin" : 5,
       "typeName": "EMAIL",
       "emailAddress": "admin@example.com"
       } ],
     "metricThreshold" : {
       "metricName" : "OPCOUNTER_CMD",
       "mode" : "AVERAGE",
       "operator" : "LESS_THAN",
       "threshold" : 100.0,
       "units" : "RAW"
       },
     "tags" : [ ],
     "typeName" : "HOST_METRIC",
     "updated" : "2016-08-24T20:25:36Z",
     "links" : []
   }

Entity Fields
-------------

.. list-table::
   :widths: 10 10 80
   :header-rows: 1
   :stub-columns: 1

   * - Name
     - Type
     - Description

   * - id
     - string
     - A unique identifier for the global alert configuration.

   * - groupIds
     - array of strings
     - The IDs of the groups the configuration applies to. This field applies
       only if ``forAllGroups`` is set to ``false``.

   * - created
     - date
     - When the global alert configuration was created.

   * - enabled
     - boolean
     - Specifies whether the global alert configuration is enabled.

   * - eventTypeName
     - string
     - The type of event that will trigger an alert.

       .. include:: /includes/extracts/possibleValues-api-eventTypeName.rst

   * - forAllGroups
     - boolean
     - Selects whether the global alert configuration applies to all groups.
       Also affects whether you can use the ``tags`` array to target the
       configuration to specific groups.

       If you set this to ``true``, the configuration applies to all groups.
       You can target the configuration to specific groups through the
       ``tags`` array.

       If set to ``false``, the configuration applies only to the groups
       specified in the ``groupIds`` array, and you must specify at least one
       project in the ``groupIds`` array. You cannot use the ``tags`` array for
       this configuration.

   * - matchers
     - object array
     - Rules to apply when matching an object against this global alert
       configuration. Only entities that match *all* these rules will be
       checked for an alert condition.

       You can filter using the ``matchers`` array only when the
       ``eventTypeName`` specifies an event for a host, replica set, or
       sharded cluster.

   * - matchers.fieldName
     - string
     - The name of the field in the target object to match on.

       .. include:: /includes/possibleValues-api-matchers.fieldName.rst

   * - matchers.operator
     - string
     - The operator to test the field's value. Possible values are:

       .. include:: /includes/possibleValues-api-matchers.operator.rst

   * - matchers.value
     - string
     - The value to test with the specified operator.

       .. include:: /includes/possibleValues-api-matchers.value.rst

   * - notifications
     - object array
     - Notifications to send when an alert condition is detected.

   * - notifications.delayMin
     - number
     - The number of minutes to wait after an alert condition is detected before
       sending out the first notification.

   * - notifications.intervalMin
     - number
     - The number of minutes to wait between successive notifications for
       unacknowledged alerts that are not resolved.

   * - notifications.typeName
     - string
     - The type of alert notification. Possible values are:

       - ``ADMIN``
       - ``GROUP``
       - ``USER``
       - ``SNMP``
       - ``EMAIL``
       - ``SMS`` (Available only if |onprem| is configured for :ref:`Twilio integration <twilio-sms-alert-settings>`.)
       - ``HIPCHAT``
       - ``SLACK``
       - ``FLOWDOCK``
       - ``PAGER_DUTY``

   * - notifications.emailEnabled
     - boolean
     - Specifies whether email notifications should be sent. Only present for
       notifications of type ``GROUP`` and ``USER``.

   * - notifications.smsEnabled
     - boolean
     - Specifies whether SMS notifications should be sent. Only present for
       notifications of type ``GROUP`` and ``USER``.

   * - notifications.username
     - string
     - The name of the |onprem| user to whom to send notifications. Only
       present for notifications of type ``USER``.

   * - notifications.snmpAddress
     - string
     - Hostname and port to send SNMP traps to. At this time |onprem| is only
       able to send SNMP traps to the standard SNMP port (162). Only present
       for ``SNMP`` notifications. |onprem| uses SNMP v2c.

   * - notifications.emailAddress
     - string
     - The email address to which to send notification. Only present for
       notifications of type ``EMAIL``.

   * - notifications.notificationToken
     - string
     - A HipChat API token. Only present for notifications of type ``HIP_CHAT``.
       If the token later becomes invalid, |onprem| sends an email to the project
       owner and eventually removes the token.

   * - notifications.roomName
     - string
     - HipChat room name. Only present for notifications of type ``HIP_CHAT``.

   * - notifications.channelName
     - string
     - The Slack channel name. Only present for ``SLACK`` notifications.

   * - notifications.apiToken
     - string
     - The Slack API token or Bot token. Only present for ``SLACK``
       notifications. If the token later becomes invalid, |onprem| sends an
       email to the project owner and eventually removes the token.

   * - notifications.orgName
     - string
     - The Flowdock organization name in lower-case letters. This is the
       name that appears after ``www.flowdock.com/app/`` in the URL
       string. Only present for ``FLOWDOCK`` notifications.

   * - notifications.flowName
     - string
     - The flow name, in lower-case letters. Only present for ``FLOWDOCK``
       notifications. The flow name appears after the organization name in the
       URL string:

       ``www.flowdock.com/app/<organization-name>/<flow-name>``.

   * - notifications.flowdockApiToken
     - string
     - The Flowdock "personal API token." Only present for ``FLOWDOCK``
       notifications. If the token later becomes invalid, |onprem| sends an
       email to the project owner and eventually removes the token.

   * - notifications.serviceKey
     - string
     - PagerDuty service key. Only present for ``PAGER_DUTY`` notifications.
       If the key later becomes invalid, |onprem| sends an email to the project
       owner and eventually removes the key.

   * - metricThreshold
     - object
     - The threshold that will cause an alert to be triggered. Only present
       if ``eventTypeName`` is set to ``OUTSIDE_METRIC_THRESHOLD``.

   * - metricThreshold.metricName
     - string
     - The name of the metric to check. Supports the same values as the
       ``metricName`` field of the ``globalAlerts`` resource. For a list of
       values, see :ref:`measurement-types-for-global-alerts-api`.

   * - metricThreshold.mode
     - string
     - This is set to ``AVERAGE`` and computes the current metric value as an
       average.

   * - metricThreshold.operator
     - string
     - The operator to apply when checking the current metric value against
       the threshold value. Possible values are:

       - ``GREATER_THAN``
       - ``LESS_THAN``

   * - metricThreshold.threshold
     - number
     - The threshold value outside of which an alert will be triggered.

   * - metricThreshold.units
     - string
     - The units for the threshold value. Depends on the type of metric. For
       example, a metric that measures memory consumption would have a byte
       measurement, while a metric that measures time would have a time unit.
       Possible values are:

       .. include:: /includes/possibleValues-api-units.rst

   * - threshold
     - object
     - The threshold that will cause an alert to be triggered. Only present
       if ``eventTypeName`` is set to one of the following:

       - ``TOO_FEW_HEALTHY_MEMBERS``
       - ``TOO_MANY_UNHEALTHY_MEMBERS``

   * - threshold.operator
     - string
     - The operator to apply when checking the current metric value against the
       threshold value.

       - ``GREATER_THAN``
       - ``LESS_THAN``

   * - threshold.threshold
     - number
     - The threshold value outside of which an alert will be triggered.

   * - tags
     - array of strings
     - The alert configuration applies only to groups with all the specified tags.

   * - typeName
     - string
     - *This field is deprecated and will be ignored.*

   * - updated
     - date
     - When this global alert configuration was last updated.

Links
-----

.. list-table::
   :header-rows: 1

   * - Relation
     - Description

   * - self
     - Me

Examples
--------

Get All Global Alert Configurations
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Request
```````

.. code-block:: sh

   curl -i -u "username:apiKey" --digest "https://<ops-manager-host>/api/public/v1.0/globalAlertConfigs"

Response
````````

.. code-block:: json

   HTTP/1.1 200 OK

   {
     "results" : [ {
       "created" : "2016-01-21T16:18:40Z",
       "enabled" : false,
       "eventTypeName" : "BACKUP_AGENT_DOWN",
       "forAllGroups" : true,
       "groupIds" : [ ],
       "id" : "56a104e0e4b00664f588acbc",
       "links" : [],
       "matchers" : [ ],
       "notifications" : [ {
         "delayMin" : 60,
         "intervalMin" : 60,
         "typeName" : "ADMIN"
       } ],
       "tags" : [ ],
       "typeName" : "AGENT",
       "updated" : "2016-01-28T03:53:30Z"
     }, ... ],
     "links" : [],
     "totalCount" : 16
   }

Get a Specific Global Alert Configuration
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Request
```````

.. code-block:: sh

   curl -i -u "username:apiKey" --digest "https://<ops-manager-host>/api/public/v1.0/globalAlertConfigs/578c023ae4b08e7209a5d5ac"

Response
````````

Response Header
~~~~~~~~~~~~~~~

.. include:: /includes/api/api-headers/401.rst

.. include:: /includes/api/api-headers/200.rst

Response Body
~~~~~~~~~~~~~

.. code-block:: json

   {
     "created" : "2016-07-17T22:10:02Z",
     "enabled" : true,
     "eventTypeName" : "TOO_MANY_UNHEALTHY_MEMBERS",
     "forAllGroups" : true,
     "groupIds" : [ ],
     "id" : "578c023ae4b08e7209a5d5ac",
     "matchers" : [ ],
     "notifications" : [ {
       "delayMin" : 60,
       "emailAddress" : "sos@example.com",
       "intervalMin" : 60,
       "typeName" : "EMAIL"
     } ],
     "tags" : [ ],
     "threshold" : {
       "operator" : "GREATER_THAN",
       "threshold" : 0
     },
     "typeName" : "REPLICA_SET",
     "updated" : "2016-08-17T20:42:26Z",
     "links" : []
   }

Get All Open Alerts Triggered by a Global Alert Configuration
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Request
```````

.. code-block:: sh

   curl -i -u "username:apiKey" --digest "https://<ops-manager-host>/api/public/v1.0/globalAlertConfigs/56a104e0e4b00664f588acb9/alerts"

Response
````````

Response Header
~~~~~~~~~~~~~~~

.. include:: /includes/api/api-headers/401.rst

.. include:: /includes/api/api-headers/200.rst

Response Body
~~~~~~~~~~~~~

.. code-block:: json

   {
     "results" : [ {
       "alertConfigId" : "56a104e0e4b00664f588acb9",
       "created" : "2016-10-22T15:57:24.126Z",
       "eventTypeName" : "LATE_SNAPSHOT",
       "groupId" : "{PROJECT-ID}",
       "id" : "572ca2ebe4b069bc2c56f1a",
       "lastNotified" : "2016-10-22T15:57:24.126Z",
       "replicaSetName" : "replicaSet-shard-0",
       "sourceTypeName" : "REPLICA_SET",
       "status" : "OPEN",
       "tags" : [ ],
       "updated" : "2016-10-22T15:57:24.126Z"
     } ],
     "links" : [],
     "totalCount" : 1
   }

Create a New Global Alert Configuration
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Request
```````

.. code-block:: sh

   curl -i -u "username:apiKey" --digest -H "Content-Type: application/json" -X POST "https://<ops-manager-host>/api/public/v1.0/globalAlertConfigs" --data '
   {
     "eventTypeName" : "CLUSTER_MONGOS_IS_MISSING",
     "enabled" : true,
     "forAllGroups" : true,
     "groupIds" : [ ],
     "notifications" : [ {
       "delayMin" : 0,
       "emailAddress" : "sos@example.net",
       "intervalMin" : 60,
       "typeName" : "EMAIL"
     } ],
     "tags" : [ ]
  }

Response
````````

.. code-block:: json

   HTTP/1.1 201 Created

   {
     "id" : "57046eebe4b08c698b25f458",
     "created" : "2016-10-26T02:05:31Z",
     "enabled" : true,
     "eventTypeName" : "CLUSTER_MONGOS_IS_MISSING",
     "forAllGroups" : true,
     "groupIds" : [ ],
     "matchers" : [ ],
     "notifications" : [ {
       "delayMin" : 0,
       "emailAddress" : "sos@example.net",
       "intervalMin" : 60,
       "typeName" : "EMAIL"
     } ],
     "tags" : [ ],
     "typeName" : "CLUSTER",
     "updated" : "2016-10-26T02:05:31Z",
     "links" : []
   }

Update an Existing Alert Configuration
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Request
```````

.. code-block:: sh

   curl -i -u "username:apiKey" --digest -H "Content-Type: application/json" -X PUT "https://<ops-manager-host>/api/public/v1.0/globalAlertConfigs/57046eebe4b08c698b25f458" --data '
   {
     "eventTypeName" : "CLUSTER_MONGOS_IS_MISSING",
     "enabled" : true,
     "forAllGroups" : true,
     "groupIds" : [ ],
     "matchers" : [ ],
     "notifications" : [ {
       "delayMin" : 0,
       "emailAddress" : "sos@example.net",
       "intervalMin" : 60,
       "typeName" : "EMAIL"
     }, {
       "delayMin" : 5,
       "emailAddress" : "admin@example.net",
       "intervalMin" : 30,
       "typeName" : "EMAIL"
     } ],
     "tags" : [ "production" ],
     "typeName" : "CLUSTER"
   }

Response
````````

Response Header
~~~~~~~~~~~~~~~

.. include:: /includes/api/api-headers/401.rst

.. include:: /includes/api/api-headers/200.rst

Response Body
~~~~~~~~~~~~~

.. code-block:: json

   {
     "id" : "57046eebe4b08c698b25f458",
     "created" : "2016-10-26T02:05:31Z",
     "enabled" : true,
     "eventTypeName" : "CLUSTER_MONGOS_IS_MISSING",
     "forAllGroups" : true,
     "groupIds" : [ ],
     "matchers" : [ ],
     "notifications" : [ {
       "delayMin" : 0,
       "emailAddress" : "sos@example.net",
       "intervalMin" : 60,
       "typeName" : "EMAIL"
     }, {
       "delayMin" : 5,
       "emailAddress" : "admin@example.net",
       "intervalMin" : 30,
       "typeName" : "EMAIL"
     } ],
     "tags" : [ "production" ],
     "typeName" : "CLUSTER",
     "updated" : "2016-11-02T03:03:22Z",
     "links" : []
   }

Disable a Global Alert Configuration
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Request
```````

.. code-block:: sh

   curl -i -u "username:apiKey" --digest -H "Content-Type: application/json" -X PUT "https://<ops-manager-host>/api/public/v1.0/globalAlertConfigs/57046eebe4b08c698b25f458" --data '
   {
     "enabled" : false
   }'

Response
````````

Response Header
~~~~~~~~~~~~~~~

.. include:: /includes/api/api-headers/401.rst

.. include:: /includes/api/api-headers/200.rst

Response Body
~~~~~~~~~~~~~

.. code-block:: json

   {
     "id" : "57046eebe4b08c698b25f458",
     "created" : "2016-10-26T02:05:31Z",
     "enabled" : false,
     "eventTypeName" : "CLUSTER_MONGOS_IS_MISSING",
     "forAllGroups" : true,
     "groupIds" : [ ],
     "matchers" : [ ],
     "notifications" : [ {
       "delayMin" : 0,
       "emailAddress" : "sos@example.net",
       "intervalMin" : 60,
       "typeName" : "EMAIL"
     }, {
       "delayMin" : 5,
       "emailAddress" : "admin@example.net",
       "intervalMin" : 30,
       "typeName" : "EMAIL"
     } ],
     "tags" : [ "production" ],
     "typeName" : "CLUSTER",
     "updated" : "2016-11-04T18:14:09Z",
     "links" : []
   }

Delete a Global Alert Configuration
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Request
```````

.. code-block:: sh

   curl -i -u "username:apiKey" --digest -X DELETE "https://<ops-manager-host>/api/public/v1.0/alertConfigs/57046eebe4b08c698b25f458"

Response
````````

.. include:: /includes/api/no-response-body.rst
