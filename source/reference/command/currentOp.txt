=========
currentOp
=========

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

Definition
----------

.. dbcommand:: currentOp

   .. deprecated:: 6.2
   
   .. include:: /includes/fact-current-op-deprecated.rst

   .. |command| replace:: currentOp

   Returns a :term:`document` that contains information on in-progress
   operations for the :binary:`~bin.mongod` instance. 

   .. include:: /includes/fact-currentOp-aggregation-stage.rst

Compatibility
-------------

This command is available in deployments hosted in the following environments: 

.. include:: /includes/fact-environments-atlas-only.rst

.. include:: /includes/fact-environments-atlas-support-all.rst

.. include:: /includes/fact-environments-onprem-only.rst

                
Syntax
------

The command has the following syntax:
   
.. code-block:: javascript

   db.adminCommand(
      { 
        currentOp: 1 
      }
   )

.. note::

  .. include:: /includes/5.0-fact-currentop.rst

Behavior
--------

``currentOp`` must run against the ``admin`` database, and
it can accept several optional fields.

.. list-table::
   :header-rows: 1
   :widths: 15 85
   
   * - Field
     - Description

   * - ``"$ownOps"``

     - Boolean. If set to ``true``, returns information on the current user's
       operations only.

       On :binary:`~bin.mongod` instances, users are always authorized to run
       ``currentOp`` with ``"$ownOps": true`` to view their own
       operations. See :ref:`access control <currentOp-access-control>`.

   * - ``"$all"``

     - Boolean. If set to ``true``, returns information on all operations,
       including operations on idle connections and system operations.

       ``"$all": true`` overrides any output field filters.

   * - <filter>

     - Specify filter conditions on the :ref:`currentOp-output-fields`.
       See :ref:`currentOp-examples`.

   * - ``comment``

     - .. include:: /includes/extracts/comment-content.rst
       
``currentOp`` and the :ref:`database profiler<profiler>` report
the same basic diagnostic information for CRUD operations, including
the following:
 
.. include:: /includes/fact-diagnostic-info.rst

Redaction
~~~~~~~~~

When using :ref:`Queryable Encryption <qe-manual-feature-qe>`,
``currentOp`` operations with the ``encryptionInformation`` option
redact certain information:

* The output omits all fields after ``"command"``.
* The output redacts ``"command"`` to include only the first element,
  ``$comment``, and ``$db``.

.. _currentOp-access-control:

Access Control
--------------

On systems running with :setting:`~security.authorization`, the user
must have access that includes the :authaction:`inprog` privilege
action.

Users can use
``$ownOps`` on :binary:`~bin.mongod` instances to view their own
operations without the :authaction:`inprog` privilege action.

.. code-block:: javascript

   db.adminCommand( { currentOp: 1, "$ownOps": 1 } )

.. seealso::

    :ref:`create-role-to-manage-ops`

.. _currentOp-examples:

Examples
--------

The following examples use the ``currentOp`` command with
various query documents to filter the output.

Display All Current Operations
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. code-block:: javascript

   db.adminCommand(
      {
        currentOp: true,
        "$all": true
      }
   )

.. NOTE TO WRITERS: If you're editing the following examples, make
   sure that you also update the examples on db.currentOp (the equiv. 
   method). Single sourcing is weird due to diffs in code block. - ARM

Write Operations Waiting for a Lock
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The following example returns information on all write operations that
are waiting for a lock:

.. code-block:: javascript

   db.adminCommand(
      {
        currentOp: true,
        "waitingForLock" : true,
        $or: [
           { "op" : { "$in" : [ "insert", "update", "remove" ] } },
           { "command.findandmodify": { $exists: true } }
       ]  
      }
   )

Active Operations with no Yields
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The following example returns information on all active running
operations that have never yielded:

.. code-block:: javascript

   db.adminCommand(
      {
        currentOp: true,
        "active" : true,
        "numYields" : 0,
        "waitingForLock" : false
      }
   )

Active Operations on a Specific Database
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The following example returns information on all active operations for
database ``db1`` that have been running longer than 3 seconds:

.. code-block:: javascript

   db.adminCommand(
      {
        currentOp: true,
        "active" : true,
        "secs_running" : { "$gt" : 3 },
        "ns" : /^db1\./
      }
   )

.. _currentOp-cmd-index-creation:

Active Indexing Operations
~~~~~~~~~~~~~~~~~~~~~~~~~~

The following example returns information on index creation operations:

.. code-block:: javascript

   db.adminCommand(
       {
         currentOp: true,
         $or: [
           { op: "command", "command.createIndexes": { $exists: true }  },
           { op: "none", "msg" : /^Index Build/ }
         ]
       }
   )

Output Example
--------------

.. include:: /includes/currentOp-output-example.rst

.. _currentOp-specific-output-examples:

Specific Output Examples
------------------------

.. include:: /includes/metrics/txt-section-intro.rst
.. include:: /includes/metrics/ex-resharding.rst

.. _currentOp-output-fields:

Output Fields
-------------

.. data:: currentOp.type

   The type of operation. Values are either:

   - ``op``
   - ``idleSession``
   - ``idleCursor``

   If the :data:`currentOp.type` is ``op``, :data:`currentOp.op`
   provides details on the specific operation.

.. data:: currentOp.host

   The name of the host against which the operation is run.

.. data:: currentOp.desc

   A description of the client. This string includes the
   :data:`~currentOp.connectionId`.

.. data:: currentOp.connectionId

   An identifier for the connection where the operation originated.

.. data:: currentOp.client

   A string with information about where the operation originated.
   
   For multi-document transactions, :data:`~currentOp.client` stores
   information about the most recent client to run an operation inside
   the transaction.

.. data:: currentOp.appName

   .. include:: /includes/fact-client-appname.rst

.. data:: currentOp.clientMetadata

   Additional information on the client.

   For multi-document transactions, :data:`~currentOp.client` stores
   information about the most recent client to run an operation inside
   the transaction.

.. data:: currentOp.currentOpTime

   The start time of the operation.

.. data:: currentOp.currentQueue

   .. versionadded:: 8.0

   The current :ref:`queue <server-status-queues>` of the operation.

   .. data:: currentOp.currentQueue.name

      The name of the current queue of the operation. 

      .. note::

         If  :data:`~currentOp.currentQueue` is present and
         :data:`~currentOp.currentQueue.name` is ``ingress``, the
         operation is waiting for ingress admission.    

   .. data:: currentOp.currentQueue.totalTimeQueuedMicros

      The cumulative total time that the operation spent in the
      corresponding queue, in microseconds. 

.. data:: currentOp.queues

   Information about the current operation's ``ingress`` and
   ``execution`` :ref:`server-status-queues`.

.. data:: currentOp.effectiveUsers

   An array that contains a document for each user associated with the
   operation. Each user document contains the ``user`` name and the
   authentication ``db``.

   .. seealso::

      :data:`currentOp.runBy`

.. data:: currentOp.runBy

   An array that contains a document for each user who is impersonating
   the :data:`effectiveUser(s)<currentOp.effectiveUsers>` for the
   operation. The runBy document contains the ``user`` name
   and the authentication ``db``. In general, the runBy user is
   the ``__system`` user; e.g.
   
   .. code-block:: javascript
   
      "runBy" : [
         {
            "user" : "__system",
            "db" : "local"
         }
      ]

   *Only available on sharded clusters*

.. data:: currentOp.lsid

   The session identifier.

   Only present if the operation is associated with a
   session.

.. data:: currentOp.transaction

   A document that contains :ref:`multi-document transaction
   <transactions>` information.

   Only present if the operation is part of a multi-document transaction.

   .. data:: currentOp.transaction.parameters

      A document that contains information on multi-document
      transaction.

      Only present if the operation is part of a multi-document
      transaction.

      .. data:: currentOp.transaction.parameters.txnNumber

         The transaction number.

         Only present if the operation is part of a multi-document transaction.

      .. data:: currentOp.transaction.parameters.autocommit

         A boolean flag that indicates if autocommit is on for the
         transaction.

         Only present if the operation is part of a multi-document transaction.

      .. data:: currentOp.transaction.parameters.readConcern

         The :ref:`read concern <transactions-read-concern>` for the
         transaction.

         Multi-document transactions support read concern
         :readconcern:`"snapshot"`, :readconcern:`"local"`, and
         :readconcern:`"majority"`.

         Only present if the operation is part of a multi-document transaction.

      .. data:: currentOp.transaction.readTimestamp

         The timestamp of the snapshot being read by the operations in
         the transaction.

         Only present if the operation is part of a multi-document transaction.

      .. data:: currentOp.transaction.startWallClockTime

         The date and time (with time zone) of the transaction start.

         Only present if the operation is part of a multi-document transaction.

      .. data:: currentOp.transaction.timeOpenMicros

         The duration of the transaction in microseconds.

         The :data:`~currentOp.transaction.timeActiveMicros`
         value added to the
         :data:`~currentOp.transaction.timeInactiveMicros`
         should equal the
         :data:`~currentOp.transaction.timeOpenMicros`.

         Only present if the operation is part of a multi-document transaction.

      .. data:: currentOp.transaction.timeActiveMicros

         The total amount of time that the transaction has been active;
         i.e. when the transaction had operations running.

         The
         :data:`~currentOp.transaction.timeActiveMicros`
         value added to the
         :data:`~currentOp.transaction.timeInactiveMicros`
         should equal the
         :data:`~currentOp.transaction.timeOpenMicros`.

         Only present if the operation is part of a multi-document transaction.

      .. data:: currentOp.transaction.timeInactiveMicros

         The total amount of time that the transaction has been
         inactive; i.e. when the transaction had no operations running.

         The
         :data:`~currentOp.transaction.timeInactiveMicros`
         value added to the
         :data:`~currentOp.transaction.timeActiveMicros`
         should equal the
         :data:`~currentOp.transaction.timeOpenMicros`.

         Only present if the operation is part of a multi-document transaction.

      .. data:: currentOp.transaction.expiryTime

         The date and time (with time zone) when the transaction will
         time out and abort.

         The :data:`currentOp.transaction.expiryTime` equals the
         :data:`currentOp.transaction.startWallClockTime` + the
         :parameter:`transactionLifetimeLimitSeconds`.

         For more information, see :ref:`transaction-limit` for
         transactions.

         Only present if the operation is part of a multi-document transaction.

.. data:: currentOp.twoPhaseCommitCoordinator

   Information on either:

   - .. _current-op-cmd-commit-coord-metrics:
   
     The commit coordination metrics for a :ref:`transaction whose
     write operations span multiple shards <transactions>`.
   
     Commit coordination is handled by a shard, and
     ``currentOp`` (run either on a :binary:`~bin.mongos` or a
     shard member) returns a shard's coordination information only for
     those transactions currently being coordinated by that shard.

     To filter for just the commit coordination metrics:

     .. code-block:: javascript

         db.currentOp( { desc:  "transaction coordinator" })

   - .. _current-op-cmd-commit-coord-operation:

     A specific commit coordination operation (i.e.
     :data:`currentOp.type` is ``op`` and :data:`currentOp.desc` is
     ``"TransactionCoordinator"``) spawned by the transaction
     coordinator.

   .. data:: currentOp.twoPhaseCommitCoordinator.lsid

      The session identifier for the multi-shard transaction.
      
      The combination of the
      :data:`~currentOp.twoPhaseCommitCoordinator.lsid` and
      :data:`~currentOp.twoPhaseCommitCoordinator.txnNumber` identifies
      the transaction.

      Available for both the :ref:`commit coordination metrics
      <current-op-cmd-commit-coord-metrics>` and for specific
      :ref:`coordination operation
      <current-op-cmd-commit-coord-operation>`.

   .. data:: currentOp.twoPhaseCommitCoordinator.txnNumber

      The transaction number for the multi-shard transaction.

      The combination of the
      :data:`~currentOp.twoPhaseCommitCoordinator.txnNumber` and
      :data:`~currentOp.twoPhaseCommitCoordinator.lsid` identifies the
      transaction.

      Available for both the :ref:`commit coordination metrics
      <current-op-cmd-commit-coord-metrics>` and for specific
      :ref:`coordination operation
      <current-op-cmd-commit-coord-operation>`.

   .. data:: currentOp.twoPhaseCommitCoordinator.action

      The specific commit coordination operation spawned by the
      transaction coordinator:
      
      - ``"sendingPrepare"``
      - ``"sendingCommit"``
      - ``"sendingAbort"``
      - ``"writingParticipantList"``
      - ``"writingDecision"``
      - ``"deletingCoordinatorDoc"``

      Only available for specific :ref:`coordination operation
      <current-op-cmd-commit-coord-operation>`.

   .. data:: currentOp.twoPhaseCommitCoordinator.startTime

      The start date and time of the
      :data:`~currentOp.twoPhaseCommitCoordinator.action`.

      Only available for specific :ref:`coordination operation
      <current-op-cmd-commit-coord-operation>`.

   .. data:: currentOp.twoPhaseCommitCoordinator.numParticipants

      Number of shards participating in this commit.

      Only available for the :ref:`commit coordination metrics
      <current-op-cmd-commit-coord-metrics>`.

   .. data:: currentOp.twoPhaseCommitCoordinator.state

      The current step/state of the commit coordination process.

      .. list-table::
         :widths: 20 80
         :header-rows: 1
         
         * - Step/stage
           - Description
         
         * - ``inactive``
           - Not actively part of a commit.

         * - ``writingParticipantList``
         
           - Writing a local record of the list of shards that are part
             of this multi-shard transaction.

         * - ``waitingForVotes``
         
           - Waiting for the participants to respond with vote to commit or abort.

         * - ``writingDecision``
         
           - Writing a local record of the coordinator's decision to commit or
             abort based on votes.

         * - ``waitingForDecisionAck``
 
           - Waiting for participants to acknowledge the coordinator's
             decision to commit or abort.

         * - ``deletingCoordinatorDoc``
         
           - Deleting the local record of commit decision.

      Only available for the :ref:`commit coordination metrics
      <current-op-cmd-commit-coord-metrics>`.

      See also
      :data:`currentOp.twoPhaseCommitCoordinator.stepDurations`.

   .. data:: currentOp.twoPhaseCommitCoordinator.commitStartTime

      The date and time when the commit started.

      Only available for the :ref:`commit coordination metrics
      <current-op-cmd-commit-coord-metrics>`.

   .. data:: currentOp.twoPhaseCommitCoordinator.hasRecoveredFromFailover

      A boolean that indicates whether the commit coordination was
      restarted due to failover on the shard that is coordinating the
      commit.

      If
      :data:`~currentOp.twoPhaseCommitCoordinator.hasRecoveredFromFailover`
      is true, then the times specified in
      :data:`currentOp.twoPhaseCommitCoordinator.stepDurations` may not
      be accurate for all steps.

      Only available for the :ref:`commit coordination metrics
      <current-op-cmd-commit-coord-metrics>`.

   .. data:: currentOp.twoPhaseCommitCoordinator.stepDurations

      A document that contains the duration, in microseconds, of the
      commit coordination :data:`steps/state
      <currentOp.twoPhaseCommitCoordinator.state>` completed or in
      progress:
      
      .. code-block:: javascript

         "stepDurations" : {
            "writingParticipantListMicros" : NumberLong(17801),
            "totalCommitDurationMicros" : NumberLong(42488463),
            "waitingForVotesMicros" : NumberLong(30378502),
            "writingDecisionMicros" : NumberLong(15015),
            "waitingForDecisionAcksMicros" : NumberLong(12077145),
            "deletingCoordinatorDocMicros" : NumberLong(6009)
         },

      If
      :data:`currentOp.twoPhaseCommitCoordinator.hasRecoveredFromFailover`
      is true, then the times specified in
      :data:`~currentOp.twoPhaseCommitCoordinator.stepDurations` may not
      be accurate for all steps.
      
      For a coordinator in an ``inactive`` state, the document is empty:
      
      .. code-block:: javascript
      
         "stepDurations" : {
         }

      Only available for the :ref:`commit coordination metrics
      <current-op-cmd-commit-coord-metrics>`.

      See :data:`currentOp.twoPhaseCommitCoordinator.state`.

   .. data:: currentOp.twoPhaseCommitCoordinator.decision
   
      A document that contains the commit/abort decision, for example:

      - For a commit decision:

        .. code-block:: javascript
   
           "decision" : {
              "decision" : "commit",
              "commitTimestamp" : Timestamp(1572034669, 3)
           }

      - For an abort decision:

        .. code-block:: javascript

           "decision" : {
              "decision" : "abort",
              "abortStatus" : {
                 "code" : 282,
                 "codeName" : "TransactionCoordinatorReachedAbortDecision",
                 "errmsg" : "Transaction exceeded deadline"
              }
           }

      Only available for the :ref:`commit coordination metrics
      <current-op-cmd-commit-coord-metrics>`.

   .. data:: currentOp.twoPhaseCommitCoordinator.deadline

      The date and time by which the commit must finish.

      Only available for the :ref:`commit coordination metrics
      <current-op-cmd-commit-coord-metrics>`.

.. data:: currentOp.opid

   The identifier for the operation. You can pass this value to
   :method:`db.killOp()` in :binary:`~bin.mongosh` to terminate the
   operation.

   .. include:: /includes/extracts/warning-terminating-ops-method.rst

.. data:: currentOp.active

   A boolean value specifying whether the operation has started. Value
   is ``true`` if the operation has started or ``false`` if the
   operation is idle, such as an idle connection or an internal thread
   that is currently idle. An operation can be active even if the
   operation has yielded to another operation. For some inactive
   background threads, such as an inactive ``signalProcessingThread``,
   MongoDB suppresses various empty fields.

.. data:: currentOp.secs_running

   The duration of the operation in seconds. MongoDB calculates this
   value by subtracting the current time from the start time of the
   operation.

   Only appears if the operation is running; i.e. if
   :data:`~currentOp.active` is ``true``.

.. data:: currentOp.microsecs_running

   The duration of the operation in microseconds. MongoDB calculates this
   value by subtracting the current time from the start time of the
   operation.

   Only appears if the operation is running; i.e. if
   :data:`~currentOp.active` is ``true``.

.. data:: currentOp.op

   A string that identifies the specific operation type. Only present
   if :data:`currentOp.type` is ``op``.

   The possible values are:

   - ``"none"``
   - ``"update"``
   - ``"insert"``
   - ``"query"``
   - ``"command"``
   - ``"getmore"``
   - ``"remove"``
   - ``"killcursors"``

   ``"query"`` operations include read operations.

   ``"command"`` operations include most 
   :ref:`commands <database-commands>` such as the
   :dbcommand:`createIndexes` and :dbcommand:`findAndModify`.

.. data:: currentOp.ns

   The :term:`namespace` the operation targets. A namespace consists of
   the :term:`database` name and the :term:`collection` name
   concatenated with a dot (``.``); that is,
   ``"<database>.<collection>"``.

.. data:: currentOp.command

   .. include:: /includes/extracts/command-field-currentOp.rst

.. data:: currentOp.planSummary

   Specifies whether the cursor uses a collection scan
   (``COLLSCAN``) or an index scan (``IXSCAN { ... }``).

   The ``IXSCAN`` also includes the specification document of the index
   used.

.. data:: currentOp.prepareReadConflicts

   The number of times the current operation had to wait for a
   prepared transaction with a write to commit or abort.

   While waiting, the current operation continues to hold any necessary
   locks and storage engine resources.

.. data:: currentOp.writeConflicts

   The number of times the current operation conflicted with
   another write operation on the same document.


.. data:: currentOp.cursor

   A document that contains the cursor information for ``getmore``
   operations; i.e. where :data:`~currentOp.op` is ``getmore``.

   If reporting on a ``getmore`` operation before the ``getmore`` has
   accessed its cursor information, the :data:`~currentOp.cursor` field
   is not available.

   .. data:: currentOp.cursor.cursorId

      The ID of the cursor.

   .. data:: currentOp.cursor.createdDate

      The date and time when the cursor was created.

   .. data:: currentOp.cursor.lastAccessDate

      The date and time when the cursor was last used.

   .. data:: currentOp.cursor.nDocsReturned

      The cumulative number of documents returned by the cursor.

   .. data:: currentOp.cursor.nBatchesReturned

      The cumulative number of batches returned by the cursor.

   .. data:: currentOp.cursor.noCursorTimeout

      The flag that indicates that the cursor will not timeout when idle;
      i.e. if the cursor has the ``noTimeout`` option set.

      - If true, the cursor does not time out when idle.

      - If false, the cursor times out when idle.

      .. seealso::

         :method:`cursor.addOption()`

   .. data:: currentOp.cursor.tailable

      The flag that indicates if the cursor is a :ref:`tailable cursor
      <tailable-cursors-landing-page>` for a capped collection. Tailable cursors
      remain open after the client exhausts the results in the initial
      cursor.

      .. seealso::

         - :dbcommand:`find`
         - :method:`cursor.tailable()`
         - :method:`cursor.addOption()`

   .. data:: currentOp.cursor.awaitData

      The flag that indicates whether the :ref:`tailable cursor
      <tailable-cursors-landing-page>` should temporarily block a
      :dbcommand:`getMore` command on the cursor while waiting for new
      data rather than returning no data.

      For non-tailable cursors, the value is always false.

      .. seealso::

         - :dbcommand:`find`
         - :method:`cursor.tailable()`
         - :method:`cursor.addOption()`

   .. data:: currentOp.cursor.originatingCommand

      The ``originatingCommand`` field contains the full command object
      (e.g. ``find`` or ``aggregate``) which originally created the
      cursor.

   .. data:: currentOp.cursor.planSummary

      Specifies whether the cursor uses a collection scan
      (``COLLSCAN``) or an index scan (``IXSCAN { ... }``).

      The ``IXSCAN`` also includes the specification document of the index
      used.

   .. data:: currentOp.cursor.operationUsingCursorId

      The ``opid`` of the operation using the cursor.

      Only present if the cursor is not idle.

.. data:: currentOp.locks

   The :data:`~currentOp.locks` document reports the type and mode of
   locks the operation currently holds. The possible lock types are as
   follows:

   .. include:: /includes/fact-lock-types.rst

   The possible modes are as follows:

   .. include:: /includes/fact-lock-modes.rst

.. data:: currentOp.admissionPriority

   For internal use. The value is the priority an operation has when it
   tries to acquire a ticket in order to perform a storage engine
   action.

   Possible values are: "low", "normal", and "immediate". Only
   operations with a "low" value are reported.

   Sample ``currentOp`` output: 

   .. code-block:: javascript
      :emphasize-lines: 12

      {
         type: 'op',
         host: 'ip-10-122-5-147:27017',
         desc: 'JournalFlusher',
         active: true,
         currentOpTime: '2022-10-11T12:45:52.053+00:00',
         opid: 201,
         op: 'none',
         ns: '',
         command: {},
         numYields: 0,
         admissionPriority: 'low',
         locks: {},
         waitingForLock: false,
         lockStats: {},
         waitingForFlowControl: false,
         flowControlStats: {}
      }

   The ``admissionPriority`` value is also reported in the :ref:`slow
   log <log-message-slow-ops>`.

   .. versionadded:: 6.3

.. data:: currentOp.waitingForLock

   Returns a boolean value. :data:`~currentOp.waitingForLock` is ``true`` if the
   operation is waiting for a lock and ``false`` if the operation has
   the required lock.

.. data:: currentOp.msg

   The :data:`~currentOp.msg` provides a message that describes the status and
   progress of the operation. In the case of indexing or mapReduce
   operations, the field reports the completion percentage.

.. data:: currentOp.progress

   Reports on the progress of mapReduce or indexing operations. The
   :data:`~currentOp.progress` fields corresponds to the completion percentage in
   the :data:`~currentOp.msg` field. The :data:`~currentOp.progress` specifies the following
   information:

   .. data:: currentOp.progress.done

      Reports the number completed.

   .. data:: currentOp.progress.total

      Reports the total number.

.. data:: currentOp.killPending

   Returns ``true`` if the operation is currently flagged for
   termination.  When the operation encounters its next safe termination point, the
   operation will terminate.

.. data:: currentOp.numYields

   :data:`~currentOp.numYields` is a counter that reports the number of times the
   operation has yielded to allow other operations to complete.

   Typically, operations yield when they need access to data that
   MongoDB has not yet fully read into memory. This allows
   other operations that have data in memory to complete quickly
   while MongoDB reads in data for the yielding operation.

.. data:: currentOp.dataThroughputLastSecond

   Amount of data (in MiB) processed by the :dbcommand:`validate`
   operation in the last second. Only available for a
   :dbcommand:`validate` operation that is currently scanning
   documents. For example:

   .. code-block:: json
      :emphasize-lines: 7

      "msg" : "Validate: scanning documents Validate: scanning documents: 7258/24000 30%",
      "progress" : {
         "done" : 7258,
         "total" : 24000
      },
      "numYields" : 0,
      "dataThroughputLastSecond" : 15.576952934265137,
      "dataThroughputAverage" : 15.375944137573242,

.. data:: currentOp.dataThroughputAverage

   The average amount of data (in MiB) processed by the
   :dbcommand:`validate` operation. Only available for a
   :dbcommand:`validate` operation that is currently scanning
   documents. For example:

   .. code-block:: json
      :emphasize-lines: 8

      "msg" : "Validate: scanning documents Validate: scanning documents: 7258/24000 30%",
      "progress" : {
         "done" : 7258,
         "total" : 24000
      },
      "numYields" : 0,
      "dataThroughputLastSecond" : 15.576952934265137,
      "dataThroughputAverage" : 15.375944137573242,

.. data:: currentOp.fsyncLock

   Specifies if database is currently locked for :method:`fsync
   write/snapshot <db.fsyncLock()>`.

   Only appears if locked; i.e. if :data:`~currentOp.fsyncLock` is
   ``true``.

.. data:: currentOp.info

   Information regarding how to unlock database from
   :method:`db.fsyncLock()`. Only appears if
   :data:`~currentOp.fsyncLock` is ``true``.

.. data:: currentOp.lockStats

   For each lock type and mode (see :data:`currentOp.locks` for
   descriptions of lock types and modes), returns the following
   information:

   .. COMMENT
      these definitions are for per operations and not for server,
      as such, they differ from those in serverStatus.txt

   .. data:: currentOp.lockStats.acquireCount

      Number of times the operation acquired the lock in the specified
      mode.

   .. data:: currentOp.lockStats.acquireWaitCount

      Number of times the operation had to wait for the
      :data:`~currentOp.lockStats.acquireCount` lock acquisitions
      because the locks were held in a conflicting mode.
      :data:`~currentOp.lockStats.acquireWaitCount` is less than or
      equal to :data:`~currentOp.lockStats.acquireCount`.

   .. data:: currentOp.lockStats.timeAcquiringMicros

      Cumulative time in microseconds that the operation had to wait to
      acquire the locks.

      :data:`~currentOp.lockStats.timeAcquiringMicros` divided by
      :data:`~currentOp.lockStats.acquireWaitCount` gives an
      approximate average wait time for the particular lock mode.

   .. data:: currentOp.lockStats.deadlockCount

      Number of times the operation encountered deadlocks while waiting
      for lock acquisitions.

.. data:: currentOp.waitingForFlowControl

   A boolean that indicates if the operation is in the process of waiting for
   :ref:`flow control <replication-flow-control>`.

.. data:: currentOp.flowControlStats

   The flow control statistics for this operation.

   .. data:: currentOp.flowControlStats.acquireCount
   
      The number of times this operation acquired a ticket.

   .. data:: currentOp.flowControlStats.acquireWaitCount

      The number of times this operation waited to acquire a ticket.

   .. data:: currentOp.flowControlStats.timeAcquiringMicros

      The total time this operation has waited to acquire a ticket.

.. data:: currentOp.totalOperationTimeElapsedSecs

   The total time elapsed, in seconds, for the current :ref:`resharding
   operation <sharding-resharding>`. The time is set to 0 when a new
   resharding operation starts.

   Only present if a resharding operation is taking place.

   .. versionadded:: 5.0

   Starting in MongoDB 6.1, this metric is also available on the
   coordinator during resharding.

.. data:: currentOp.updatesApplied

   The number of updates applied.

   Only present on a recipient shard when a resharding operation is
   taking place.

   .. versionadded:: 6.1

.. data:: currentOp.remainingOperationTimeEstimatedSecs

   .. include:: /includes/remainingOperationTimeEstimatedSecs-details.rst

   .. versionadded:: 5.0

.. data:: currentOp.allShardsLowestRemainingOperationTimeEstimatedSecs

   Calculated across all shards, the lowest estimate of the number of
   seconds remaining. 

   Only present on a coordinator when a resharding operation is
   taking place.

   .. versionadded:: 6.1

.. data:: currentOp.allShardsHighestRemainingOperationTimeEstimatedSecs

   Calculated across all shards, the highest estimate of the number of
   seconds remaining. 

   Only present on a coordinator when a resharding operation is
   taking place.

   .. versionadded:: 6.1

.. data:: currentOp.approxDocumentsToCopy

   The approximate number of documents to be copied from the donor
   shards to the recipient shards during the :ref:`resharding operation
   <sharding-resharding>`. This number is an estimate that is set at the
   beginning of the resharding operation and does not change after it
   has been set. The number is set to 0 when a new resharding operation
   starts. It is possible for ``$currentOp.documentsCopied`` and
   ``$currentOp.bytesCopied`` to end up exceeding
   ``$currentOp.approxDocumentsToCopy`` and
   ``$currentOp.approxBytesToCopy``, respectively, if
   the post-resharding data distribution is not perfectly uniform.

   Only present on a recipient shard when a resharding operation is
   taking place.

   .. versionadded:: 5.0

.. data:: currentOp.documentsCopied

   The number of documents copied form donor shards to recipient shards
   during the :ref:`resharding operation <sharding-resharding>`. The
   number is set to 0 when a new resharding operation starts.

   Only present on a recipient shard when a resharding operation is
   taking place.

   .. versionadded:: 5.0

.. data:: currentOp.approxBytesToCopy

   The approximate number of bytes to be copied from the donor shards to
   the recipient shards during the :ref:`resharding operation
   <sharding-resharding>`. This number is an estimate that is set at the
   beginning of the resharding operation and does not change after it
   has been set. The number is set to 0 when a new resharding operation
   starts. It is possible for ``$currentOp.documentsCopied`` and
   ``$currentOp.bytesCopied`` to end up exceeding
   ``$currentOp.approxDocumentsToCopy`` and
   ``$currentOp.approxBytesToCopy``, respectively, if the
   post-resharding data distribution is not perfectly uniform.

   Only present on a recipient shard when a resharding operation is
   taking place.

   .. versionadded:: 5.0

.. data:: currentOp.bytesCopied

   The number of bytes copied from donor shards to recipient shards
   during the :ref:`resharding operation <sharding-resharding>`. The
   number is set to 0 when a new resharding operation starts.

   Only present on a recipient shard when a resharding operation is
   taking place.

   .. versionadded:: 5.0

.. data:: currentOp.countWritesToStashCollections

   The number of writes to the recipient :term:`stash collections
   <stash collection>`.

   Only present on a recipient shard when a resharding operation is
   taking place.

   .. versionadded:: 6.1

.. data:: currentOp.countWritesDuringCriticalSection

   The number of writes attempted during the donor's critical
   section.

   Only present on a donor shard when a resharding operation is
   taking place.

   .. versionadded:: 6.1

.. data:: currentOp.countReadsDuringCriticalSection

   The number of reads attempted during the donor's critical
   section.

   Only present on a donor shard when a resharding operation is
   taking place.

   .. versionadded:: 6.1

.. data:: currentOp.deletesApplied

   The number of deletes applied to the temporary resharding collection.
   Each oplog entry that involves a delete increments the counter by 1.

   Only present on a recipient shard when a resharding operation is
   taking place.

   .. versionadded:: 6.1

.. data:: currentOp.insertsApplied

   The number of inserts applied to the temporary resharding collection.
   Each oplog entry that involves an insert increments the counter by 1.

   Only present on a recipient shard when a resharding operation is
   taking place.

   .. versionadded:: 6.1

.. data:: currentOp.totalCopyTimeElapsedSecs

   The total elapsed time, in seconds, for ongoing data copy tasks from
   donor shards to recipient shards for the current :ref:`resharding
   operation <sharding-resharding>`. The time is set to 0 when a new
   resharding operation starts.

   Only present on a recipient shard when a resharding operation is
   taking place.

   .. versionadded:: 5.0

   Starting in MongoDB 6.1, this metric is also available on the
   coordinator during resharding.

.. data:: currentOp.oplogEntriesFetched

   The number of entries fetched from the :term:`oplog` for the current
   :ref:`resharding operation <sharding-resharding>`. The number is set
   to 0 when a new resharding operation starts.

   Only present on a recipient shard when a resharding operation is
   taking place.

   .. versionadded:: 5.0

.. data:: currentOp.oplogEntriesApplied

   The number of entries applied to the :term:`oplog` for the current
   :ref:`resharding operation <sharding-resharding>`. The number is set
   to 0 when a new resharding operation starts.

   Only present on a recipient shard when a resharding operation is
   taking place.

   .. versionadded:: 5.0

.. data:: currentOp.totalApplyTimeElapsedSecs

   The total elapsed time, in seconds, for the apply step of the
   current :ref:`resharding operation <sharding-resharding>`. In the
   apply step, recipient shards apply :term:`oplog` entries to modify
   their data based on new incoming writes from donor shards. The time
   is set to 0 when a new resharding operation starts.

   Only present on a recipient shard when a resharding operation is
   taking place.

   .. versionadded:: 5.0

   Starting in MongoDB 6.1, this metric is also available on the
   coordinator during resharding.

.. data:: currentOp.countWritesDuringCriticalSection

   The number of writes performed in the critical section for the current
   :ref:`resharding operation <sharding-resharding>`. The critical
   section prevents new incoming writes to the collection currently
   being resharded. The number is set to 0 when a new resharding
   operation starts.

   Only present on a donor shard when a resharding operation is taking
   place.

   .. versionadded:: 5.0

.. data:: currentOp.totalCriticalSectionTimeElapsedSecs

   The total elapsed time, in seconds, for the critical section of the
   current :ref:`resharding operation <sharding-resharding>`. The
   critical section prevents new incoming writes to the collection
   currently being resharded. The time is set to 0 when a new
   resharding operation starts.

   Only present on a donor shard when a resharding operation is taking
   place.

   .. versionadded:: 5.0

   Starting in MongoDB 6.1, this metric is also available on the
   coordinator during resharding.

.. data:: currentOp.donorState

   The current state of a donor shard for the :ref:`resharding operation
   <sharding-resharding>`. The state is set to ``unused`` when a new
   resharding operation starts.

   Only present on a donor shard when a resharding operation is taking
   place.

   .. list-table::
      :widths: 20 80
      :header-rows: 1

      * - State
        - Description

      * - ``unused``
        - The resharding operation is about to start or recovering from
          a primary failover.

      * - ``preparing-to-donate``
        - The donor shard is preparing to donate data to the recipient
          shards.

      * - ``donating-initial-data``
        - The donor shard is donating data to the recipient shards.

      * - ``donating-oplog-entries``
        - The donor shard is donating :term:`oplog` entries to the
          recipient shards.

      * - ``preparing-to-block-writes``
        - The donor shard is about to prevent new incoming write
          operations to the collection that is being resharded.

      * - ``error``
        - An error occurred during the resharding operation.

      * - ``blocking-writes``
        - The donor shard is preventing new incoming write operations
          and the donor shard has notified all recipient shards that new
          incoming writes are prevented.

      * - ``done``
        - The donor shard has dropped the old sharded collection and the
          resharding operation is complete.

   .. versionadded:: 5.0

.. data:: currentOp.recipientState

   The current state of a recipient shard for a :ref:`resharding
   operation <sharding-resharding>`. The state is set to ``unused`` when
   a new resharding operation starts.

   Only present on a donor shard when a resharding operation is taking
   place.

   .. list-table::
      :widths: 20 80
      :header-rows: 1

      * - State
        - Description

      * - ``unused``
        - The resharding operation is about to start or recovering from
          a primary failover.

      * - ``awaiting-fetch-timestamp``
        - The recipient shard is waiting for the donor shards to be
          prepared to donate their data.

      * - ``creating-collection``
        - The recipient shard is creating the new sharded collection.

      * - ``cloning``
        - The recipient shard is receiving data from the donor shards.

      * - ``applying``
        - The recipient shard is applying :term:`oplog` entries to
          modify its copy of the data based on the new incoming writes
          from donor shards.

      * - ``error``
        - An error occurred during the resharding operation.

      * - ``strict-consistency``
        - The recipient shard has all data changes stored in a temporary
          collection.

      * - ``done``
        - The resharding operation is complete.


   .. versionadded:: 5.0

.. data:: currentOp.coordinatorState

   The state of the resharding coordinator for the current
   :ref:`resharding operation <sharding-resharding>`. The resharding
   coordinator is an operation that runs on the :ref:`config server
   <sharding-config-server>` primary. The state is set to
   ``unused`` when a new resharding operation starts.

   Only present on the coordinating config server.

   .. list-table::
      :widths: 20 80
      :header-rows: 1

      * - State
        - Description

      * - ``unused``
        - The resharding operation is about to start or recovering from
          a primary failover.

      * - ``initializing``
        - The resharding coordinator has inserted the coordinator
          document into ``config.reshardingOperations`` and has added
          the ``reshardingFields`` to the ``config.collections`` entry
          for the original collection.

      * - ``preparing-to-donate``
        - The resharding coordinator

          - has created a ``config.collections`` entry for the temporary
            resharding collection.
          - has inserted entries into ``config.chunks`` for ranges based
            on the new shard key.
          - has inserted entries into ``config.tags`` for any zones
            associated with the new shard key.

          The coordinator informs participant shards to begin the
          resharding operation. The coordinator then waits until all
          donor shards have picked a ``minFetchTimestamp`` and are ready
          to donate.

      * - ``cloning``
        - The resharding coordinator informs donor shards to donate data
          to recipient shards. The coordinator waits for all recipients
          to finish cloning the data from the donor.

      * - ``applying``
        - The resharding coordinator informs recipient shards to modify
          their copies of data based on new incoming writes from donor
          shards. The coordinator waits for all recipients to finish
          applying :term:`oplog` entries.

      * - ``blocking-writes``
        - The resharding coordinator informs donor shards to prevent new
          incoming write operations to the collection being resharded.
          The coordinator then waits for all recipients to have all data
          changes.

      * - ``aborting``
        - An unrecoverable error occurred during the resharding
          operation or the :dbcommand:`abortReshardCollection` command
          (or the :method:`sh.abortReshardCollection()` method) was run.

      * - ``committing``
        - The resharding coordinator removes the ``config.collections``
          entry for the temporary resharding collection. The coordinator
          then adds the ``recipientFields`` to the source collection's
          entry.

   .. versionadded:: 5.0

.. data:: currentOp.opStatus

   This metric is removed in version 6.1. 

   .. versionchanged:: 6.1

.. _currentOp-query-sampling-metrics:

.. data:: currentOp.collUuid

   The UUID of the :ref:`sampled collection <configureQueryAnalyzer>`.
   
   This field only appears on documents related to query sampling.
   For details, see :ref:`<sampled-queries-currentOp-stage>`.
   
   .. versionadded:: 7.0

.. data:: currentOp.startTime

   The time at which query sampling began.
   
   This field only appears on documents related to query sampling.
   For details, see :ref:`<sampled-queries-currentOp-stage>`.

   .. versionadded:: 7.0

.. data:: currentOp.samplesPerSecond

   The maximum number of queries to sample per second.
   
   On a sharded cluster, this is reported on ``mongos`` instead of 
   ``mongod``. On a replica set, this is reported on ``mongod``.
   
   This field only appears on documents related to query sampling.
   For details, see :ref:`<sampled-queries-currentOp-stage>`.
   
   .. versionadded:: 7.0
   
.. data:: currentOp.sampledReadsCount

   The number of sampled read queries.
   
   This field only appears on documents related to query sampling.
   For details, see :ref:`<sampled-queries-currentOp-stage>`.

   .. versionadded:: 7.0

.. data:: currentOp.sampledWritesCount

   The number of sampled write queries.
   
   This field only appears on documents related to query sampling.
   For details, see :ref:`<sampled-queries-currentOp-stage>`.
   
   .. versionadded:: 7.0

.. data:: currentOp.sampledReadsBytes

   The size of the sampled read queries, in bytes.
  
   On a replica set, this is reported on every ``mongod``.

   On a sharded cluster, this only reported on ``mongod`` with 
   ``--shardsvr``.
   
   This field only appears on documents related to query sampling.
   For details, see :ref:`<sampled-queries-currentOp-stage>`.
   
   .. versionadded:: 7.0

.. data:: currentOp.sampledWritesBytes
   
   The size of the sampled write queries, in bytes.
   
   On a replica set, this is reported on every ``mongod``.

   On a sharded cluster, this only reported on ``mongod`` with 
   ``--shardsvr``.
   
   This field only appears on documents related to query sampling.
   For details, see :ref:`<sampled-queries-currentOp-stage>`.
   
   .. versionadded:: 7.0
