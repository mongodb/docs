.. _autocomplete-tutorial:

==================================
How to Use Autocomplete with |fts|
==================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

This tutorial describes how to create an |fts| index that enables 
autocomplete queries. We will create an |fts| index for indexing 
values of the ``title`` field in the ``sample_mflix.movies`` 
collection. The index enables ``autocomplete`` operators to query the 
``title`` field. Then we will run a search for a sequence of 
characters against the ``title`` field for movie title suggestions that 
match the incomplete input string. It takes you through the following 
steps:

1. Set up an |fts| index with autocomplete data type for the 
   ``sample_mflix.movies`` collection.

#. Run |fts| queries against the ``title`` field in the 
   ``sample_mflix.movies`` collection for a sequence of characters that 
   appear in the movie titles.

Before you begin, ensure that your Atlas cluster meets the requirements 
described in the :ref:`Prerequisites <fts-tutorials-prereqs>`.

Define an Index with Autocomplete
---------------------------------

.. include:: /includes/fact-autocomplete-field-type.rst

In this section, you will create an |fts| index that indexes the 
``title`` field for autocompletion using the ``edgeGram`` tokenization 
strategy. 

.. include:: /includes/steps/fts-autocomplete-tutorial-create-index.rst

Run an Autocomplete Query
-------------------------

.. include:: /includes/fact-autocomplete-operator.rst

In this section, you will connect to your |service| cluster and the run 
the sample queries against the ``title`` field in the 
``sample_mflix.movies`` collection using the ``autocomplete`` operator. 
The sample queries use a sequence of characters to find movie titles 
that begin with the input character string. |fts| returns results that 
begin with the specified query string because the ``title`` field is 
indexed using the ``edgeGram`` tokenization strategy.

----------

.. |arrow| unicode:: U+27A4

|arrow| Use the **Select your language** drop-down menu to set the 
language of the example on this page.

----------

.. tabs-selector:: drivers

The following query searches for movies with the characters ``ger`` in
the ``title`` field. The query includes a:

- :pipeline:`$limit` stage to limit the output to 20 results.
- :pipeline:`$project` stage to exclude all fields except ``title``.

.. tabs-drivers::

   .. tab::
      :tabid: shell

      .. tip::
      
         Run the following command at {+mongosh+} prompt to use the
         ``sample_mflix`` database:

         .. code-block:: shell

            use sample_mflix
      
      .. literalinclude:: /includes/fts-tutorial/autocomplete/tutorial-shell.js
         :language: js
         :dedent:

   .. tab::
      :tabid: compass

      .. include:: /includes/fts-tutorial/autocomplete/tutorial.rst

   .. tab:: 
      :tabid: go

      .. literalinclude:: /includes/fts-tutorial/autocomplete/tutorial.go
         :language: go
         :dedent:

   .. tab:: 
      :tabid: java-sync 

      .. literalinclude:: /includes/fts-tutorial/autocomplete/tutorial.java
         :language: java
         :dedent:

   .. tab::
      :tabid: nodejs

      .. literalinclude:: /includes/fts-tutorial/autocomplete/tutorial.js
         :language: js
         :dedent:

   .. tab::
      :tabid: python

      .. literalinclude:: /includes/fts-tutorial/autocomplete/tutorial.py
         :language: python
         :dedent:

This query returns the following results:

.. tabs-drivers::

   .. tab::
      :tabid: shell

      .. code-block:: javascript
         :copyable: false
         :linenos:

         { title: "Gertie the Dinosaur" },
         { title: "Germany Year Zero" },
         { title: "Germany in Autumn" },
         { title: "Germany Pale Mother" },
         { title: "Gerhard Richter - Painting" },
         { title: "Geronimo: An American Legend" },
         { title: "How to Live in the German Federal Republic" },
         { title: "Geri's Game" },
         { title: "The Gerson Miracle" },
         { title: "The German Doctor" },
         { title: "From Caligari to Hitler: German Cinema in the Age of the Masse"},
         { title: "From Caligari to Hitler: German Cinema in the Age of the Masses"},
         { title: "Gervaise" },
         { title: "Gertrud" },
         { title: "Germinal" },
         { title: "Gerry" },
         { title: "Gèraldine" },
         { title: "Gerontophilia" },
         { title: "Pionery-geroi" },
         { title: "Rece do gèry" }

   .. tab::
      :tabid: compass

      .. code-block:: javascript
         :copyable: false
         :linenos:

         { title: "Gertie the Dinosaur" },
         { title: "Germany Year Zero" },
         { title: "Germany in Autumn" },
         { title: "Germany Pale Mother" },
         { title: "Gerhard Richter - Painting" },
         { title: "Geronimo: An American Legend" },
         { title: "How to Live in the German Federal Republic" },
         { title: "Geri's Game" },
         { title: "The Gerson Miracle" },
         { title: "The German Doctor" },
         { title: "From Caligari to Hitler: German Cinema in the Age of the Masse"},
         { title: "From Caligari to Hitler: German Cinema in the Age of the Masses"},
         { title: "Gervaise" },
         { title: "Gertrud" },
         { title: "Germinal" },
         { title: "Gerry" },
         { title: "Gèraldine" },
         { title: "Gerontophilia" },
         { title: "Pionery-geroi" },
         { title: "Rece do gèry" }

   .. tab:: 
      :tabid: go

      .. code-block:: go
         :copyable: false
         :linenos:

         [{title Gertie the Dinosaur}]
         [{title Germany Year Zero}]
         [{title Germany in Autumn}]
         [{title Germany Pale Mother}]
         [{title Gerhard Richter - Painting}]
         [{title Geronimo: An American Legend}]
         [{title How to Live in the German Federal Republic}]
         [{title Geri's Game}]
         [{title The Gerson Miracle}]
         [{title The German Doctor}]
         [{title From Caligari to Hitler: German Cinema in the Age of the Masses}]
         [{title From Caligari to Hitler: German Cinema in the Age of the Masses}]
         [{title Gervaise}]
         [{title Gertrud}]
         [{title Germinal}]
         [{title Gerry}]
         [{title Gèraldine}]
         [{title Gerontophilia}]
         [{title Pionery-geroi}]
         [{title Rece do gèry}]

   .. tab:: 
      :tabid: java-sync 

      .. code-block:: json
         :copyable: false
         :linenos:

         {"title": "Gertie the Dinosaur"}
         {"title": "Germany Year Zero"}
         {"title": "Germany in Autumn"}
         {"title": "Germany Pale Mother"}
         {"title": "Gerhard Richter - Painting"}
         {"title": "Geronimo: An American Legend"}
         {"title": "How to Live in the German Federal Republic"}
         {"title": "Geri's Game"}
         {"title": "The Gerson Miracle"}
         {"title": "The German Doctor"}
         {"title": "From Caligari to Hitler: German Cinema in the Age of the Masses"}
         {"title": "From Caligari to Hitler: German Cinema in the Age of the Masses"}
         {"title": "Gervaise"}
         {"title": "Gertrud"}
         {"title": "Germinal"}
         {"title": "Gerry"}
         {"title": "Gèraldine"}
         {"title": "Gerontophilia"}
         {"title": "Pionery-geroi"}
         {"title": "Rece do gèry"}

   .. tab::
      :tabid: nodejs
      
      .. code-block:: javascript
         :copyable: false
         :linenos:

         { title: 'Gertie the Dinosaur' }
         { title: 'Germany Year Zero' }
         { title: 'Germany in Autumn' }
         { title: 'Germany Pale Mother' }
         { title: 'Gerhard Richter - Painting' }
         { title: 'Geronimo: An American Legend' }
         { title: 'How to Live in the German Federal Republic' }
         { title: "Geri's Game" }
         { title: 'The Gerson Miracle' }
         { title: 'The German Doctor' }
         { title: 'From Caligari to Hitler: German Cinema in the Age of the Masses' }
         { title: 'From Caligari to Hitler: German Cinema in the Age of the Masses' }
         { title: 'Gervaise' }
         { title: 'Gertrud' }
         { title: 'Germinal' }
         { title: 'Gerry' }
         { title: 'Gèraldine' }
         { title: 'Gerontophilia' }
         { title: 'Pionery-geroi' }
         { title: 'Rece do gèry' }

   .. tab::
      :tabid: python

      .. code-block:: python
         :copyable: false
         :linenos:

         {'title': 'Gertie the Dinosaur'}
         {'title': 'Germany Year Zero'}
         {'title': 'Germany in Autumn'}
         {'title': 'Germany Pale Mother'}
         {'title': 'Gerhard Richter - Painting'}
         {'title': 'Geronimo: An American Legend'}
         {'title': 'How to Live in the German Federal Republic'}
         {'title': "Geri's Game"}
         {'title': 'The Gerson Miracle'}
         {'title': 'The German Doctor'}
         {'title': 'From Caligari to Hitler: German Cinema in the Age of the Masses'}
         {'title': 'From Caligari to Hitler: German Cinema in the Age of the Masses'}
         {'title': 'Gervaise'}
         {'title': 'Gertrud'}
         {'title': 'Germinal'}
         {'title': 'Gerry'}
         {'title': 'G\xe8raldine'}
         {'title': 'Gerontophilia'}
         {'title': 'Pionery-geroi'}
         {'title': 'Rece do g\xe8ry'}

In these results, the characters ``ger`` appear at the
beginning of a word in all the titles. |fts| returns ``Gèraldine`` 
and ``Rece do gèry`` in the results because we set ``foldDiacritics`` 
to ``true``.
