title: "Set |onprem| to :guilabel:`Local Mode`."
stepnum: 1
ref: edit-config-file
content: |
  a. Click :guilabel:`Admin` in the upper right corner to open system administration.

  #. From the :guilabel:`General` tab, click :guilabel:`Ops Manager Config`.

  #. Click the :guilabel:`Miscellaneous` button at the top of the page.

  #. For :setting:`Version Manifest Source`, select ``Local``.

  #. Note the directory specified in :setting:`Versions Directory`.
     This is the directory on your |onprem| servers where you will
     store the MongoDB binaries.

  #. For :guilabel:`Backup Version Auto Download`, select ``false``.

  .. note::

     When running in :guilabel:`Local Mode`, ensure that both the
     :setting:`Version Manifest Source` is ``Local`` and the
     :guilabel:`Backup Version Auto Download` is ``false``.
---
title: "Download the required MongoDB archives."
ref: download-binaries
content: |
   
   Go to MongoDB `Download Center
   <https://www.mongodb.com/download-center>`_ and download the MongoDB
   binary archives for the appropriate platforms and versions. 

   Binaries are stored as compressed archives (``.tgz`` for Mac OS X,
   Linux, or Solaris and ``.zip`` for Windows).

   .. note::

      See :ref:`local-mode-determine-versions` to review which versions
      you require.
   
   To download a Community Edition:
   
   a. Go to the `Community Server
      <https://www.mongodb.com/download-center#community>`_ tab in the
      Download Center.

   #. Select the version. The default version is the latest stable
      version.
     
      To select an older version, click :guilabel:`Previous Releases`
      or :guilabel:`All Version Binaries` link.

   #. Download the **archive** for your platform.

   To download an Enterprise Edition:

   a. Go to the `Enterprise Server
      <https://www.mongodb.com/download-center#enterprise>`_ tab in the
      Download Center.

   #. Select the version. The default version is the latest stable
      version.

      To select an older version, click the :guilabel:`Archived
      Releases` link.

   #. Download the **archive** for your platform. 
   
      For the current stable version, click the :guilabel:`Download`
      button and in the dialog that appears, click on the
      :guilabel:`archive` link.

      For older versions, click the :guilabel:`Archived Releases` link.
      For your platform and MongoDB version, click the link for the
      :guilabel:`Archive`.

---
title: "Populate all |onprem| servers with the necessary MongoDB binaries and archives."
ref: populate-with-binaries
content: |
  On *all* your |onprem| servers, including those with enabled Backup Daemons:

  a. Copy all of the archived binaries to the directory specified in
     :setting:`Versions Directory`. The versions directory stores all of
     the archived and extracted MongoDB binaries |onprem| needs to install
     and upgrade MongoDB deployments.

     .. note:: 
        Automation uses the archived binaries; Backup uses the
        extracted binaries. Both must be available in the versions directory.

     By default, the versions directory is found in the following
     locations on the following platforms.
      
     .. list-table::
        :header-rows: 1
        :widths: 30 70

        * - Operating System
          - Versions Directory Default Path

        * - RHEL, Ubuntu
          - 
            .. code-block:: sh

               /opt/mongodb/mms/mongodb-releases

        * - Linux Archive
          - 
            .. code-block:: sh
           
               <userSelected>/mongodb-releases
 
        * - Windows
          - 
            .. code-block:: powershell
           
               C:\MMSData\MongoDBReleases

     To specify a different path for your versions directory, use the
     :setting:`Versions Directory` setting on your |onprem| application.

  #. Navigate to the versions directory.

  #. Extract all of the archived binaries needed for the system's
     backup daemon. The extracted archive creates a subdirectory that
     uses the following naming convention:
     ``mongodb-<platform>-<architecture>-<version>``.

     .. important::

        Ensure that the binaries match the Backup Daemon's operating
        system and reflect the latest in the series for each MongoDB
        version in your deployments. For example, if the MongoDB
        version of your deployment is v3.2, latest in the series would
        be 3.2.x where x is the latest revision version number.
     
--- 
title: "Ensure that the |mms| user can read files in the Versions Directory. (Linux only)"
ref: mongodb-mms-as-owner
content: |

  The ``mongodb-mms`` user needs the read permissions to the versions
  directory.

  .. example::

     On a Linux platform, you should issue the ``chown`` command to change
     ownership for **all** files in the directory to ``mongodb-mms``:

     .. code-block:: sh

        sudo chown -R mongodb-mms:mongodb-mms <path-to-the-versions-directory>/*

     Set the permissions to:

     * ``read`` and ``write`` for the owner
     * ``read`` for the group 
     * ``none`` for all

     This enables |mms| can correctly read and extract the archived binaries.

     .. code-block:: sh

        sudo chmod -R 640 <path-to-the-versions-directory>/*

     The resulting listing of the versions directory should look like this:

     .. code-block:: sh

        -rw-r----- 1 mongodb-mms mongodb-mms 116513825 Apr 27 15:06 mongodb-linux-x86_64-2.6.9.tgz
        -rw-r----- 1 mongodb-mms mongodb-mms  51163601 May 22 10:05 mongodb-linux-x86_64-amazon-3.0.3.tgz
        -rw-r----- 1 mongodb-mms mongodb-mms  50972165 May 22 10:06 mongodb-linux-x86_64-suse11-3.0.3.tgz
        -rw-r----- 1 mongodb-mms mongodb-mms  95800685 Apr 27 15:05 mongodb-linux-x86_64-enterprise-amzn64-2.6.9.tgz
        -rw-r----- 1 mongodb-mms mongodb-mms  50594134 Apr 27 15:04 mongodb-linux-x86_64-enterprise-amzn64-3.0.2.tgz
        -rw-r----- 1 mongodb-mms mongodb-mms  50438645 Apr 27 15:04 mongodb-linux-x86_64-enterprise-suse11-3.0.2.tgz

---
title: "Update the version manifest for |onprem| on each |onprem| host."
ref: update-version-manifest
content: |

  The version manifest provides |onprem| with a list of all released
  MongoDB versions available to your |onprem| servers.

  a. Click the :guilabel:`Update MongoDB Version Manifest from MongoDB, Inc.` button.

  b. The :term:`version manifest` should update automatically.

---
title: "Copy and paste the contents the version manifest into the |onprem| application on each |onprem| host. (Optional)"
ref: enter-version-manifest
content: |

  If the automatic update does not work, you need to copy and paste the
  :term:`version manifest` to your |onprem| servers.

  a. From a computer that can access both the Internet and the |onprem|
     servers, download the version manifest from |manifestlink|.

  #. Open the manifest JSON file.

  #. Select all of the contents and copy them to the clipboard.

  #. In |onprem|, click :guilabel:`Admin` in the upper right corner to open
     system administration.

  #. Click the :guilabel:`General` tab.

  #. Click :guilabel:`Version Manifest`.

  #. Click the :guilabel:`Update MongoDB Version Manifest from MongoDB, Inc.` button.

  #. Paste the version manifest.

---
title: "For each group, specify which versions are available for download by Automation Agents."
ref: select-versions
content: |

  a. In |onprem|, click :guilabel:`Back To Project` in the upper left to exit
     system administration.

  #. Click the :guilabel:`Project` link at the top of the page and select the
     desired group.

  #. Click :guilabel:`Deployment`, then the :guilabel:`More` drop-down list,
     then :guilabel:`Version Manager`.

  #. Select the checkboxes for the versions of MongoDB that you have made
     available on the |application| server.
post: |

  .. important::
     
     For the selected versions, ensure that you have downloaded and
     placed both the archived and extracted binaries in the versions
     directory. Otherwise, |onprem| fails a pre-flight check when
     starting in :guilabel:`Local Mode`. See also :ref:`Start Ops
     Manager When All Versions Are Not Downloaded
     <fix-local-mode-start-failure>`.

---
title: "Review and approve your changes."
ref: confirm-deployment
content: |

  |mms| displays your proposed changes.

  a. If you are satisfied, click :guilabel:`Confirm & Deploy`.

  #. Otherwise, click :guilabel:`Cancel` and you can make
     additional changes.

...
