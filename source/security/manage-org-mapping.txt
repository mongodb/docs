.. _mms-manage-fed-org-map:

========================================================
Manage Organization Mapping for Federated Authentication
========================================================

.. default-domain:: mongodb

.. meta::
   :keywords: connect

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

When you map organizations to your Identity Provider, |mms| grants
users who authenticate through the |idp| membership in the selected
organizations. You can give these users a default
:ref:`role <organization-roles>` in the mapped organizations.
Organization mapping lets you configure a single |idp| to grant users
access to multiple |mms| organizations.

You can apply the same |idp| to multiple organizations. You can
assign each organization a single |idp|.

Prerequisites
-------------

To complete this tutorial, you must have already linked an |idp| to
|mms| and mapped one or more domains to that |idp|.
For instructions on these procedures, see:

- :ref:`mms-manage-fed-auth`
- :ref:`mms-manage-fed-domain-map`

Federation Management Access
----------------------------

.. include:: /includes/fact-fed-management-access.rst

Map an Organization to your Identity Provider
---------------------------------------------

Open the :guilabel:`Federation Management Console`
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/fact-open-fed-auth-console.rst

Connect an Organization to the Federation Application
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

1. Click :guilabel:`View Organizations`.

   |mms| displays all organizations where you are an
   :authrole:`Organization Owner`.

   Organizations which are not already connected to the Federation
   Application have :guilabel:`Connect` button in the
   :guilabel:`Actions` column.

#. Click the desired organization's :guilabel:`Connect` button.

After you connect the organization to the Federation Application, apply
an |idp| to the organization.

Apply an Identity Provider to the Organization
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

From the :guilabel:`Organizations` screen in the management console:

1. Click the :guilabel:`Name` of the organization you want to map to
   an |idp|.

#. On the :guilabel:`Identity Provider` screen, click
   :guilabel:`Apply Identity Provider`.

   |mms| directs you to the :guilabel:`Identity Providers` screen
   which shows all |idps| you have linked to |mms|.

#. For the |idp| you want to apply to the organization, click
   :guilabel:`Modify`.

#. At the bottom of the :guilabel:`Edit Identity Provider` form,
   select the organizations to which this |idp| applies.

#. Click :guilabel:`Next`.

#. Click :guilabel:`Finish`.

Verify the Connection between your Organization and your IdP
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

1. Click :guilabel:`Organizations` in the left navigation.

#. In the list of :guilabel:`Organizations`, ensure that your desired
   organization(s) now have the expected :guilabel:`Identity Provider`.

Select a Default User Role for the Organization
-----------------------------------------------

You can have |mms| grant users who authenticate through the |idp| a
default :ref:`role <organization-roles>` in a mapped organization. You
can select different roles for different organizations.

.. note::

   The selected role only applies to users who authenticate through the
   |idp| if they do not already have a :ref:`role <organization-roles>`
   in the organization.

Procedure
~~~~~~~~~

1. In the :guilabel:`Federation Management Console`, click
   :guilabel:`Organizations` in the left navigation.

#. Click the :guilabel:`Name` of the organization for which you
   want to assign default permissions.

#. In the :guilabel:`Default User Role` dropdown, select the desired
   role. To remove a default user role, click the
   :icon-fa4:`times-circle` next to the dropdown.

Change an Organization's Mapped Identity Provider
-------------------------------------------------

Reconfigure your |idp| to change the organizations to which it's mapped.

Unmap the Current Identity Provider
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

1. Click :guilabel:`Organizations` in the left navigation.

#. Click the :guilabel:`Identity Provider` of the organization whose
   |idp| you wish to change.

#. Click :guilabel:`Modify` for the |idp| which is currently mapped to
   the organization.

#. At the bottom of the :guilabel:`Edit Identity Provider` form,
   deselect the organization.

#. Click :guilabel:`Next`.

#. Click :guilabel:`Finish`.

Map the New Identity Provider
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

#. Click :guilabel:`Modify` for the |idp| you want to map to the
   organization.

#. At the bottom of the :guilabel:`Edit Identity Provider` form,
   select the organization.

#. Click :guilabel:`Next`.

#. Click :guilabel:`Finish`.

Disconnect an Organization from the Federation Application
----------------------------------------------------------

When you disconnect an organization from the Federation Application,
|mms| no longer grants membership or a default
:ref:`organization role <organization-roles>` to users who authenticate
through the |idp|.

From the :guilabel:`Federation Management Console`:

1. Click :guilabel:`View Organizations`.

#. Open the :guilabel:`Actions` dropdown for the organization you want
   to disconnect.

#. Click :guilabel:`Disconnect`.

#. Click :guilabel:`Confirm`.
