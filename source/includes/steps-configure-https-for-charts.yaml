title: Uncomment necessary lines of the Docker Compose file.
ref: uncomment-ssl
level: 4
stepnum: 1
content: |

   Uncomment the following variables in the
   ``services.charts.environment`` section of the Compose file you
   downloaded as part of the |charts-short|
   :doc:`installation procedure </installation>`:

   - ``CHARTS_HTTPS_CERTIFICATE_FILE``
   - ``CHARTS_HTTPS_CERTIFICATE_KEY_FILE``

   Replace the values of these variables with the *names* of your
   certificate file and key file respectively. The certificate must
   be in the ``.pem`` format and the key file must be a ``.key`` file.

   .. important::

      The values of these variables must be filenames, not complete
      file paths. These files are always loaded from the
      ``web-certs`` volume.
---
title: Copy the certificate and key file to the |charts-short| Docker volume.
ref: stop-charts-ssl
level: 4
stepnum: 2
content: |

  .. tabs-platforms::

     tabs:

       - id: windows
         content: |
           The following command copies certificate and key file in the
           ``C:\path\to\certs`` directory to the |charts-short| host.
           This example uses a wildcard (``*``) in the file extension
           of the certificate to copy both ``mycert.pem`` and
           ``mycert.key`` to the host:

           .. code-block:: ps1

              docker run -it -v mongodb-charts_web-certs:/volume -v /c/path/to/certs:/localcerts alpine sh -c 'cp /localcerts/mycert.* /volume'

           .. include:: /includes/fact-docker-unix-paths-windows.rst

       - id: macos
         content: |

           The following command copies certificates in the
           ``/path/to/certs`` directory to the |charts-short| host.
           This example uses a wildcard (``*``) in the file extension
           of the certificate to copy both ``mycert.pem`` and
           ``mycert.key`` to the host:

           .. code-block:: sh

              docker run -it -v mongodb-charts_web-certs:/volume -v /path/to/certs:/localcerts alpine sh -c 'cp /localcerts/mycert.* /volume'

       - id: linux
         content: |

           The following command copies certificates in the
           ``/path/to/certs`` directory to the |charts-short| host.
           This example uses a wildcard (``*``) in the file extension
           of the certificate to copy both ``mycert.pem`` and
           ``mycert.key`` to the host:

           .. code-block:: sh

              docker run -it -v mongodb-charts_web-certs:/volume -v /path/to/certs:/localcerts alpine sh -c 'cp /localcerts/mycert.* /volume'
---
title: Redeploy the |charts-short| Docker stack.
ref: stop-charts-ssl-http
level: 4
stepnum: 3
content: |

  If |charts| is already running, remove the |charts-short| Docker
  stack using the following command:

  .. include:: /includes/redeploy-docker-stack.rst
---
title: Check Docker logs to ensure that you have correctly configured HTTPS
ref: check-logs-https
level: 4
stepnum: 4
content: |

  First, run the following command to obtain the Docker service ID for
  |charts|:

  .. code-block:: sh

     docker service ls

  Retrieve the service logs by running the following command using the
  service ID from the previous step:

  .. code-block:: sh

     docker service logs <service ID>

  If there are no errors reported in the logs, |charts| should now be
  configured to use HTTPS and will now automatically redirect from
  the HTTP address to the HTTPS address in a web browser. If the logs
  return any errors, see the :ref:`Troubleshooting
  <charts-install-troubleshooting>` section for possible solutions to
  the issues listed.
...
