.. _monitor-cluster-metrics:

====================
View Cluster Metrics
====================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

|service| collects and displays metrics for your servers, databases,
and MongoDB processes.

.. note::
   The number of servers displayed on the :guilabel:`Metrics` page at any given time 
   depends on the browser screen size. You can utilize the :guilabel:`Toggle Members` 
   section to control which servers get displayed. Hover over the ``S`` and ``P`` icons to 
   find out which servers they represent. 

.. tabs::

   tabs:

   - id: all-metrics

     name: "All Cluster Metrics"

     content: |
       
       View Metrics for All Atlas Clusters in a Project
       ------------------------------------------------
       
       The :guilabel:`Clusters` view displays all clusters in a 
       |service| :ref:`project <projects>`. |service| displays up to four
       of the following charts for each cluster in the project:
       
       .. list-table::
          :widths: 35 65
          :header-rows: 1
        
          * - Chart
        
            - Data
        
          * - :guilabel:`Operations`
        
            - Displays the aggregated read (:guilabel:`R`) and write 
              (:guilabel:`W`) operations on the cluster. 
        
              For a replica set, the chart shows operations for the
              :term:`primary`. 
        
              For a :term:`sharded cluster`, the chart shows
              the sum of the operations on each primary in the cluster.
        
          * - :guilabel:`Logical Size`
              
              ``M0/M2/M5`` *Clusters Only*
        
            - Displays the sum of total bytes of the documents and index data
              across all databases in the cluster.
        
          * - :guilabel:`Disk Usage`
              
              ``M10+`` *Clusters Only*
        
            - The total bytes of used disk space for the cluster.
        
              For a replica set, the chart shows the disk usage of the
              primary host machine.
        
              For a sharded cluster, the chart shows the sum of disk usage
              on each primary host in the cluster. 

          * - :guilabel:`Total Index Size`

              ``M10+`` *Clusters Only*

            - The total bytes of disk space used by indexes for every database
              in the cluster.
        
          * - :guilabel:`Connections`
        
            - The total number of active connections to the cluster.
        
              For a replica set, the chart shows the number of active 
              connections to the primary.
        
              For a sharded cluster, the chart shows the sum of all 
              active connections to each primary in the cluster.
        
          * - :guilabel:`Disk IOPS`
              
              ``M10+`` *Clusters Only*
              
            - The sum of read and write input/output operations per second
              (IOPS) for the cluster. 
        
              For a replica set, the chart shows the total IOPS for the
              primary.
        
              For a sharded cluster, the chart shows the sum of IOPS on
              each primary in the cluster.

          * - :guilabel:`Atlas Search Operations`

              *Clusters with Active {+fts+} Indexes Only*

            - Charts which show several metrics associated with |fts|
              operations, including disk space used by |fts| indexes,
              |fts| process CPU usage, and |fts| memory usage.

   - id: replica-metrics

     name: "Replica Set Metrics"

     content: |

       View Metrics for an Atlas Replica Set
       -------------------------------------
       
       To view the metrics for a specific |service| cluster in a 
       :ref:`project <projects>`, click the :guilabel:`Metrics` button for
       that cluster. Alternatively, click on the name of the cluster to open
       the cluster overview, then click the :guilabel:`Metrics` tab.
       
       The :guilabel:`Metrics` view has three distinct sections:

       Chart Controls
       ~~~~~~~~~~~~~~
       
       |service| provides the following controls for the :guilabel:`Metric` 
       view. Adjusting any of these options affects all charts displayed under 
       the :guilabel:`Metrics` view:
       
       .. list-table::
          :widths: 35 65
          :header-rows: 1
       
          * - Control
            - Function
        
          * .. include:: /includes/extracts/monitor-view-control-granularity.rst
        
          * .. include:: /includes/extracts/monitor-view-control-zoom.rst
        
          * .. include:: /includes/extracts/monitor-view-control-current-display.rst
        
          * .. include:: /includes/extracts/monitor-view-control-toggle-members.rst
        
          * .. include:: /includes/extracts/monitor-view-control-add-chart.rst
        
          * .. include:: /includes/extracts/monitor-view-control-display-opcounters.rst
        
          * .. include:: /includes/extracts/monitor-view-control-display-annotations.rst
       
       Chart Display
       ~~~~~~~~~~~~~
       
       When viewing charts, you can do the following:
       
       .. list-table::
          :widths: 35 65
          :header-rows: 1
       
          * - Task
            - Action
        
          * .. include:: /includes/extracts/monitor-chart-controls-description.rst
        
          * .. include:: /includes/extracts/monitor-chart-controls-expand.rst
        
          * .. include:: /includes/extracts/monitor-chart-controls-zoom.rst
        
          * .. include:: /includes/extracts/monitor-chart-controls-point.rst
        
          * .. include:: /includes/extracts/monitor-chart-controls-move.rst
        
          * .. include:: /includes/extracts/monitor-chart-controls-share.rst
       
       Chart Selection
       ~~~~~~~~~~~~~~~
       
       |service| displays the available metrics to chart for the
       selected cluster under the :guilabel:`Toggle Charts` header. 
       Metrics are grouped into two sections:
       
       :guilabel:`MongoDB Metrics`
         Metrics associated with the MongoDB process. For metrics 
         related to database performance, such as 
         :guilabel:`DB Storage`, |service| presents the sum total across
         all databases in the cluster.
       
         If you enable 
         :guilabel:`Display Opcounters on Separate Charts`, 
         |service| replaces the :guilabel:`Opcounters` option with the
         individual components of that chart. 
       
       :guilabel:`Hardware Metrics`
         Metrics associated with the host machines supporting the cluster.
       
         Charts marked with the ``+`` symbol are inactive, 
         while charts marked with the ``-`` symbol are active. Click
         on any chart to toggle the chart state. 

   - id: sharded-metrics

     name: "Sharded Cluster Metrics"

     content: |

       View Metrics for an Atlas Sharded Cluster
       -----------------------------------------
 
       To view the metrics for a specific |service| cluster in a
       :ref:`project <projects>`, click the :guilabel:`Metrics` button
       for that cluster. Alternatively, click on the name of the cluster
       to open the cluster overview, then click the :guilabel:`Metrics`
       tab.
 
       The :guilabel:`Metrics` view has three distinct sections:
 
       Chart Controls
       ~~~~~~~~~~~~~~
 
       |service| provides the following controls for the 
       :guilabel:`Metric` view:
 
       .. list-table::
          :widths: 35 65
          :header-rows: 1
 
          * - Control
            - Function
 
          * .. include:: /includes/extracts/monitor-view-control-granularity-sharded.rst
 
          * .. include:: /includes/extracts/monitor-view-control-zoom.rst
 
          * .. include:: /includes/extracts/monitor-view-control-display-data.rst
 
          * .. include:: /includes/extracts/monitor-view-control-current-display.rst
 
          * .. include:: /includes/extracts/monitor-view-control-display.rst
 
          * .. include:: /includes/extracts/monitor-view-control-view.rst
 
       Chart Display
       ~~~~~~~~~~~~~
 
       When viewing charts, you can do the following:
 
       .. list-table::
          :widths: 35 65
          :header-rows: 1
 
          * - Task
 
            - Action
 
          * .. include:: /includes/extracts/monitor-chart-controls-zoom.rst
 
          * .. include:: /includes/extracts/monitor-chart-controls-point.rst
 
       Data Sources
       ~~~~~~~~~~~~
 
       |service| displays each data source that contributes to the 
       metric chart in a table below the chart. The table consists of 
       the following:
 
       .. list-table::
          :widths: 35 65
          :header-rows: 1
 
          * - Column
            - Description
 
          * - :guilabel:`Shard Name`
            - When :guilabel:`View` is set to ``SHARDS``, displays the name
              of each shard in the sharded cluster.
              
              When :guilabel:`View` is set to ``MONGOS`` or ``CONFIGS``,
              displays the name of each :binary:`mongos <bin.mongos>` or
              config server :binary:`mongod <bin.mongod>` process in the
              cluster.
 
              Click on a listed component to open the
              :guilabel:`Metrics` view for that component.
 
          * - :guilabel:`Alerts`
            - Indicates if there are any open alerts for the listed 
              shard or process. Click on the alert icon to open the
              :guilabel:`Alerts` view for that shard or process. For
              more information on responding to open alerts, see
              :doc:`/alert-resolutions`.
 
          * - :guilabel:`Data Size`
            - Only visible if :guilabel:`View` is set to ``SHARDS``.
 
              Indicates the logical size of all documents and indexes 
              on the shard.
 
          * - :guilabel:`Show`
            - Only visible if :guilabel:`View` is set to ``SHARDS``
 
              Indicates which replica set members to show on the selected
              chart. Select ``Primaries``, ``Secondaries`` or ``All``. 
 
          * - :guilabel:`Read`, :guilabel:`Write`, and :guilabel:`Queued`
            - Metric data related to the displayed chart. Hover over
              the corresponding column for a pop up with detailed
              information on the metrics shown.

   - id: process-metrics

     name: "MongoDB Process Metrics"

     content: |

       View Metrics for a Single MongoDB Process
       -----------------------------------------
 
       To view the metrics for a specific MongoDB process in a 
       |service| cluster, click on that process from the
       cluster view. The |service| process view displays three tabs for
       monitoring metrics for the process:
 
       - The :guilabel:`Status` tab displays the process metrics |service|
         collects from the selected :binary:`mongod <bin.mongod>` or
         :binary:`mongos <bin.mongos>` process.
 
       - The :guilabel:`Hardware` tab displays hardware metrics for
         the host machine supporting the selected 
         :binary:`mongod <bin.mongod>` or :binary:`mongos <bin.mongos>`
         process.
 
       - The :guilabel:`DB Stats` tab displays the database metrics for the
         selected database.
 
         |service| retrieves database metrics every 20 minutes by default but
         adjusts frequency when necessary to reduce the impact on database
         performance. If the collection of database statistics still affects
         performance, you can disable collection by clicking 
         :guilabel:`Settings` from the left-hand navigation, 
         then :guilabel:`Project Settings`, and then setting 
         :guilabel:`Collect Database Specific Statistics` to :guilabel:`No`.
 
       The view for each tab has three distinct sections:
 
       Chart Controls
       ~~~~~~~~~~~~~~
 
       |service| provides the following controls for the :guilabel:`Status`,
       :guilabel:`Hardware`, and :guilabel:`DB Stats` 
       views. Adjusting any of these options affects all charts displayed under 
       the selected view:
 
       .. list-table::
          :widths: 35 65
          :header-rows: 1
 
          * - Control
            - Function
 
          * .. include:: /includes/extracts/monitor-view-control-granularity.rst
 
          * .. include:: /includes/extracts/monitor-view-control-zoom.rst
 
          * .. include:: /includes/extracts/monitor-view-control-current-display.rst
 
          * .. include:: /includes/extracts/monitor-view-control-add-chart.rst
 
          * .. include:: /includes/extracts/monitor-view-control-select-database.rst
 
          * .. include:: /includes/extracts/monitor-view-control-display-opcounters.rst
 
          * .. include:: /includes/extracts/monitor-view-control-display-annotations.rst
 
       Chart Display
       ~~~~~~~~~~~~~
 
       When viewing charts, you can do the following:
 
       .. list-table::
          :widths: 35 65
          :header-rows: 1
 
          * - Task
 
            - Action
 
          * .. include:: /includes/extracts/monitor-chart-controls-description.rst
 
          * .. include:: /includes/extracts/monitor-chart-controls-expand.rst
 
          * .. include:: /includes/extracts/monitor-chart-controls-zoom.rst
 
          * .. include:: /includes/extracts/monitor-chart-controls-point.rst
 
          * .. include:: /includes/extracts/monitor-chart-controls-move.rst
 
          * .. include:: /includes/extracts/monitor-chart-controls-share.rst
 
       Chart Selection
       ~~~~~~~~~~~~~~~
 
       |service| displays the available metrics to chart for the
       selected cluster under the :guilabel:`Toggle Charts` header. 
 
       Charts marked with the ``+`` symbol are inactive, 
       while charts marked with the ``-`` symbol are active. Click
       on any chart to toggle the chart state. 

   - id: realtime-metrics

     name: "Real Time Metrics"

     content: |

       View Real Time Cluster Metrics
       ------------------------------
 
       .. admonition:: Availability
          :class: note 

          |service| supports :guilabel:`Real Time` metrics for
          ``mongod`` or ``mongos`` processes and replica
          set clusters. For sharded clusters, you can view 
          :guilabel:`Real Time` metrics for each shard replica set.

          You must have the :authrole:`Project Owner <Project Owner>`
          |service| user role to access the :guilabel:`Real Time` tab.
 
       To view Real Time metrics for a specific |service| cluster in a 
       :ref:`project <projects>`, click the :guilabel:`Metrics` button 
       for that cluster. Alternatively, click on the name of the cluster
       to open the cluster overview, then click the 
       :guilabel:`Metrics` tab. From the :guilabel:`Metrics` tab,
       click :guilabel:`Real Time` to open the 
       :doc:`Real-Time Performance Panel 
       </real-time-performance-panel>`.

       For complete documentation on the |service| real time metrics, 
       see :doc:`Real-Time Performance Panel 
       </real-time-performance-panel>` 

   - id: fts-metrics

     name: "Atlas Search Metrics"

     content: |

       View Atlas Search Metrics
       -------------------------

       .. admonition:: Availability
          :class: note 

          |fts| metrics are available for |service| clusters with at
          least one active |fts| index. To set up an |fts| index, see
          :ref:`fts-top-ref`.

       The following |fts| metrics are available:

       - :guilabel:`Search Process Memory`

       - :guilabel:`Search Process CPU`

       - :guilabel:`Search Normalized Process CPU`

       - :guilabel:`Search Disk Space Used`

       Chart Controls
       ~~~~~~~~~~~~~~
 
       |service| provides the following controls for the metrics charts.
       Adjusting any of these options affects all charts displayed under 
       the selected view:
 
       .. list-table::
          :widths: 35 65
          :header-rows: 1
 
          * - Control
            - Function
 
          * .. include:: /includes/extracts/monitor-view-control-granularity.rst
 
          * .. include:: /includes/extracts/monitor-view-control-zoom.rst
 
          * .. include:: /includes/extracts/monitor-view-control-current-display.rst
 
          * .. include:: /includes/extracts/monitor-view-control-add-chart.rst
 
          * .. include:: /includes/extracts/monitor-view-control-select-database.rst
 
          * .. include:: /includes/extracts/monitor-view-control-display-opcounters.rst
 
          * .. include:: /includes/extracts/monitor-view-control-display-annotations.rst
 
       Chart Display
       ~~~~~~~~~~~~~
 
       When viewing charts, you can do the following:
 
       .. list-table::
          :widths: 35 65
          :header-rows: 1
 
          * - Task
 
            - Action
 
          * .. include:: /includes/extracts/monitor-chart-controls-description.rst
 
          * .. include:: /includes/extracts/monitor-chart-controls-expand.rst
 
          * .. include:: /includes/extracts/monitor-chart-controls-zoom.rst
 
          * .. include:: /includes/extracts/monitor-chart-controls-point.rst
 
          * .. include:: /includes/extracts/monitor-chart-controls-move.rst
 
          * .. include:: /includes/extracts/monitor-chart-controls-share.rst
 
       Chart Selection
       ~~~~~~~~~~~~~~~
 
       |service| displays the available metrics to chart for the
       selected cluster under the :guilabel:`Toggle Charts` header. 
 
       Charts marked with the ``+`` symbol are inactive, 
       while charts marked with the ``-`` symbol are active. Click
       on any chart to toggle the chart state.

.. _monitoring-storage-granularity:

Monitoring Data Storage Granularity
-----------------------------------

|service| stores metrics data at increasing granularity levels. For each
increasing granularity level, |service| computes the metrics data based
on the averages from the previous granularity level. The length of
retention depends on the granularity. |service| computes the metrics data
based on the averages from the previous granularity level.


.. example::

   After 48 hours' worth of data is collected, each group of
   60 minutes is compacted into a single unit of an hour. After 63 days,
   each group of 24 hours is compacted into a single unit of a day.

Metrics data is gathered at a 1-minute granularity. |service| retains
different granularities of metric data for different periods of time:

.. list-table::
   :header-rows: 1

   * - Data Period
     - Duration of Retention

   * - 1 minute
     - 48 hours

   * - 5 minutes
     - 48 hours

   * - 1 hour
     - 63 days

   * - 1 day
     - Forever

|service| retains all database-specific statistics. MongoDB log data is
retained at a maximum rate of 2000 lines per 2 minutes.

Free Tier and Shared Cluster Monitoring Considerations
------------------------------------------------------

- ``M0`` Free Tier and ``M2/M5`` Shared clusters support a subset of
  the metrics and charts available. For complete documentation on
  the limitations of ``M0/M2/M5`` clusters,
  see :ref:`atlas-free-tier`.
  
- .. include:: /includes/fact-free-tier-monitoring-pause.rst
