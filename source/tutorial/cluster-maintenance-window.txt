.. _configure-maintenance-window:

============================
Configure Maintenance Window
============================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

You can set the hour of the day that |service| should start weekly
maintenance on your cluster. This setting is optional and is not
required for most clusters. Configure maintenance windows from your
:ref:`project settings <project-settings>`.

Typically, you do not need to manually configure a maintenance window.
|service| performs maintenance automatically in a rolling manner
to preserve continuous availability, with the exception of a
momentary replica set election. You can use the
:ref:`Test Failover <test-failover>` capability to ensure that
your application is resilient to replica set elections.

Custom maintenance windows provide greater control over your cluster
performance by allowing maintenance to occur at your preferred time of
day.

Maintenance Window Considerations
---------------------------------

Urgent Maintenance Activities
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

|service| performs urgent maintenance activities such as security
patches as soon as they are needed without regard to scheduled
maintenance windows.

Ongoing Maintenance Operations
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Once you schedule a maintenance window for your cluster, you cannot
change it until any ongoing maintenance operations have completed.

Maintenance Requires Replica Set Elections
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

|service| performs maintenance the same way as the maintenance
procedure described in the
:manual:`MongoDB Manual
</tutorial/perform-maintence-on-replica-set-members/>`. This
procedure requires at least one
:manual:`replica set election </core/replica-set-elections>` during
the maintenance window per replica set.

Use the :ref:`Test Failover <test-failover>` capability to ensure
that your application is resilient to replica set elections.

Maintenance Starts As Close to the Hour As Possible
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Maintenance always begins as close to the scheduled hour as
possible, but in-progress cluster updates or unexpected system
issues could delay the start time.

Procedure
---------

Open Your Project Settings
~~~~~~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/steps/view-modify-project-settings.rst

Configure Maintenance Window
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

1. Toggle the :guilabel:`Set Preferred Cluster Maintenance Start Time`
   setting to :guilabel:`On`.
   
#. Click :icon:`pencil-alt` to set
   the :guilabel:`Maintenance Start Time`. |service| displays this
   time in the time zone set in your :guilabel:`Profile`.

Respond to Required Maintenance
-------------------------------

When maintenance is required, |service|:

- Displays a banner in your project's cluster list showing the date and
  time when the maintenance is scheduled.

- Sends a notification email to users with the 
  :authrole:`Project Owner` role between 48 and 72 hours before the 
  scheduled maintenance.

  .. note::

     To configure how you receive scheduled maintenance window
     notifications, see :ref:`configure-mw-alert`.

  With this information, you can choose one of three options:

  1. Do nothing. The maintenance occurs during your scheduled
     maintenance window.

  2. Select :guilabel:`Begin Maintenance Now`. The scheduled
     maintenance starts immediately. If you choose this option,
     you are asked to confirm it in a separate modal.
     
  3. Select :guilabel:`Defer Maintenance for One Week`. The   
     scheduled maintenance starts during your preferred
     maintenance window one week after the given scheduled
     maintenance date and time. If you choose this option, you are
     asked to confirm it in a separate modal.
