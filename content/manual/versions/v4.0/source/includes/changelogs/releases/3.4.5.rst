.. _3.4.5-changelog:

3.4.5 Changelog
---------------

Sharding
~~~~~~~~

- :issue:`SERVER-28513` stale_mongos_updates_and_removes.js should only call ensurePrimaryShard once
- :issue:`SERVER-28850` Coverity analysis defect 100646: PW.PARAMETER_HIDDEN
- :issue:`SERVER-28854` Replace msgBase with msg in assertion detail
- :issue:`SERVER-28925` Use listDatabases({'nameOnly': true}) in the addShard implementation
- :issue:`SERVER-29016` Config primary may hang in shutdown waiting for Balancer
- :issue:`SERVER-29066` Sharded findAndModify will not implicitly create the database if it does not exist

Replication
~~~~~~~~~~~

- :issue:`SERVER-26360` After node goes into RECOVERING due to being too stale to sync from its source, it will never recover even if there is a valid sync source it could use
- :issue:`SERVER-26741` "Fatal Assertion 16360" triggered by temporary collections dropped when restarted in standalone mode
- :issue:`SERVER-27966` last_vote.js should wait for replication before stepping down node 0 pre-reconfig
- :issue:`SERVER-28387` Extend secondary catchup period during stepdown in server-23299-1.js
- :issue:`SERVER-28480` last_vote.js should use ReplSetTest::stepUp() on node 1 before reconfig
- :issue:`SERVER-28490` Check the state after acquiring the lock in bgsync
- :issue:`SERVER-28688` Deadlock between shutdown and stepdown
- :issue:`SERVER-28815` multi_rs.js - step down primary during upgrade/downgrade without {force:true}

Query
~~~~~

- :issue:`SERVER-26765` Move views tests into jsCore
- :issue:`SERVER-28952` Multikey indexes should not be eligible for DISTINCT_SCAN if distinct key is an array component

Storage
~~~~~~~

- :issue:`SERVER-28038` Improve WiredTigerRecordStore invariants for capped visiblity
- :issue:`SERVER-28357` MMAPv1 compact operation may trigger "quota exceeded" error (12501)
- :issue:`SERVER-28427` GlobalLock with timeout can still block indefinitely
- :issue:`SERVER-29088` Cache uuid in Collection class to fix perf regression

Operations
~~~~~~~~~~

- :issue:`SERVER-15407` Set thread name on Mac OS X and Linux
- :issue:`SERVER-26634` Integrate GDB pretty printers for server vocabulary types

Build and Packaging
~~~~~~~~~~~~~~~~~~~

- :issue:`SERVER-29352` Disable SNMP integration for OS X enterprise builds
- :issue:`SERVER-26781` Add support for building with openssl 1.1.0
- :issue:`SERVER-27682` Add SCons variable files for the MongoDB GCC and clang toolchains

Internals
~~~~~~~~~

- :issue:`SERVER-19677` Intel library self-check in unit tests
- :issue:`SERVER-21842` Generate report.json file and dump stacks on Windows when Event object created by resmoke.py is set
- :issue:`SERVER-27279` pthread_setname_np is not supported on SUSE 11.4
- :issue:`SERVER-27281` pkill/pgrep cannot find mongod on Linux
- :issue:`SERVER-27285` Add a jsCore passthrough with a replset that periodically SIGKILLs a secondary
- :issue:`SERVER-27408` burn_in_tests.py doesn't always exclude tagged tests when generating outfile
- :issue:`SERVER-27570` Enforce stricter checks on top level command BSON objects
- :issue:`SERVER-27727` Hide idle threads in hang_analyzer
- :issue:`SERVER-27869` Create a build artifact of hang_analyzer.py output and upload it to S3
- :issue:`SERVER-27870` Add option to invoke hang_analyzer.py with an explicit list of PIDs
- :issue:`SERVER-27871` Add hang_analyzer.py option to produce core dump, default to off
- :issue:`SERVER-27873` Dump a JavaScript backtrace of any code running in SpiderMonkey in hang_analyzer.py
- :issue:`SERVER-27874` Display locks and generate digraph for threads using LockManager locks and/or pthread_mutexes
- :issue:`SERVER-27877` hang_analyzer.py should deduplicate stacks from different threads in GDB
- :issue:`SERVER-28007` Re-enable support for CRC32 hardware acceleration on s390x
- :issue:`SERVER-28132` Remove sudo from hang_analyzer invocation in evergreen.yml
- :issue:`SERVER-28291` mongodb-uniqstack should dedupe based on frame.pc() rather than frame.name()
- :issue:`SERVER-28348` Detect single-process deadlocks involving LockManager locks and/or pthread_mutexes
- :issue:`SERVER-28349` Process output logs generated by hang_analyzer are missing stderr
- :issue:`SERVER-28354` Add new option to supply base process name in hang_analyzer
- :issue:`SERVER-28400` Update to Firefox ESR 45.8.0
- :issue:`SERVER-28415` Run thread backtrace before loading Python modules in hang_analyzer.py on ARM platform
- :issue:`SERVER-28416` Handle GDB error in hang_analyzer.py mongodb-uniqstack module
- :issue:`SERVER-28463` Add set scheduler-locking to Hang Analyzer to prevent threads from running in GDB
- :issue:`SERVER-28466` The hang analyzer should not attach to resmoke.py in Evergreen
- :issue:`SERVER-28479` hang_analyzer.py on OS X fails to find Python processes
- :issue:`SERVER-28584` Remove initialsync_{WT|MMAPv1}_dr tasks from sys-perf
- :issue:`SERVER-28588` Handle GDB error in hang_analyzer.py find_frame function
- :issue:`SERVER-28710` vectorized send() should handle EWOULDBLOCK
- :issue:`SERVER-28760` Add egress logging to legacy write path
- :issue:`SERVER-28868` Set noCursorTimeout option on oplog cursor in ReplSetTest.prototype.checkOplogs()
- :issue:`SERVER-28971` Error in depth_first_search algorithm incorrectly recurses on visited nodes
- :issue:`SERVER-28995` Format string in JstackDumper class of hang_analyzer.py has too few placeholders
- :issue:`SERVER-29018` 3.4: mongos segfault in getMore on view with find batchSize of 0
- :issue:`SERVER-29068` Retry operations in set_feature_compatibility_version.js after network interruption

