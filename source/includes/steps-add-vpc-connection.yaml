title: "Enable DNS hostnames and DNS resolution in AWS."
content: |

   Enabling :guilabel:`DNS hostnames` and :guilabel:`DNS
   resolution` can result in faster :ref:`VPC <security-vpc>` peering.

   .. tip ::

      AWS VPC resolves hostnames in an |service| cluster to their 
      private IP addresses when you enable :guilabel:`DNS resolution`.
      You can use these DNS entries to connect to hosts in your
      |service| cluster from the peered VPC since AWS handles
      resolving the peered hostnames automatically.
   
   a. Log in to your :abbr:`AWS (Amazon Web Services)` account.
   
   #. Go to the `VPC dashboard <https://console.aws.amazon.com/vpc>`_.
   
   #. Open your list of VPC resources.
   
   #. Select the VPC you want to peer with.
   
   #. Enable :guilabel:`DNS hostnames` and :guilabel:`DNS
      resolution`. See `Updating DNS Support for Your VPC
      <http://docs.aws.amazon.com/AmazonVPC/latest/UserGuide/vpc-dns.html#vpc-dns-updating>`_ 
      for further documentation on how to enable these options.
   
level: 4
ref: enable-dns
optional: true
---
title: "Go to VPC Peering view."
content: |
   From the :guilabel:`Clusters` view, select the :guilabel:`Security`
   tab, then :guilabel:`Peering`.

   Click :guilabel:`New Peering Connection`.
   
level: 4
ref: go-ip-whitelist-view
---
title: "Enter required information in the Peering Connection Dialog."
level: 4
ref: enter-ip-address
content: |

   To create the VPC Peering connection, fill in the requested
   information:
      
   .. list-table::
      :header-rows: 1
      :widths: 35 65
      
      * - Field
        - Notes

      * - :guilabel:`Account ID`

        - AWS Account ID of the owner of the peer VPC. Refer to the
          dialog for instructions on finding your :guilabel:`AWS
          Account ID`.

      * - :guilabel:`VPC ID`

        - The ID of the peer VPC. Refer to the dialog
          for instructions on finding your :guilabel:`VPC ID`.

      * - :guilabel:`VPC CIDR`

        - The peer VPC CIDR block or subset. Must not overlap with your
          :guilabel:`Atlas CIDR Block` or any other peering connection
          :guilabel:`VPC CIDR`.

          The CIDR block must be in one of the following 
          `private networks <https://tools.ietf.org/html/rfc1918#section-3>`_:

          - ``10.0.0.0`` - ``10.255.255.255``  (10/8 prefix)

          - ``172.16.0.0`` - ``172.31.255.255``  (172.16/12 prefix)

          - ``192.168.0.0`` - ``192.168.255.255`` (192.168/16 prefix)

          You can choose to add the VPC CIDR block address (or a
          subset) to the whitelist. For VPC peering connections, you
          can also add the Security Group associated with the peer VPC
          instead of the CIDR block. See :ref:`add-to-whitelist`.

          See `RFC 4632 <https://tools.ietf.org/html/rfc4632>`_ for more
          information about CIDR blocks.

      * - :guilabel:`Application VPC Region`

        - AWS region where the peer VPC resides.

          |service| creates a VPC for the |service| project in
          this region if no ``M10+`` clusters or VPC peering connections
          exist for the selected :guilabel:`Region`.

      * - :guilabel:`VPC CIDR Block`

        - The |service| VPC CIDR block. Must not overlap with the peer
          :guilabel:`VPC CIDR` block.
          
          .. include:: /includes/fact-vpc-cidr-block.rst

      * - :guilabel:`Atlas VPC Region`

        - AWS region where the |service| VPC resides.

          Uncheck :guilabel:`Same as application VPC region` to select
          a different region than where the application VPC resides. 
          

---
title: "Click :guilabel:`Initiate Peering`."
level: 4
ref: save
content: ""
---
title: Wait for approval of peering connection request.
level: 4
ref: wait
content: |
   The owner of the peer VPC must approve the VPC peering connection
   request. Ensure that the owner approves the request.

   |service| provides instructions for approving the connection request.

   .. important:: Requests expire after 7 days.

---
title: Add to route table.
level: 4
ref: route-table
content: |

   a. In the :guilabel:`VPC Dashboard`, click :guilabel:`Route Tables`.

   #. Select the Route Table for your VPC.

   #. Click the :guilabel:`Routes` tab.

   #. Click :guilabel:`Edit Routes`.

   #. Click :guilabel:`Add route`.

   #. Add the |service| VPC's CIDR block to the :guilabel:`Destination`
      column.

   #. Add the AWS Peering Connection ID to the :guilabel:`Target`
      column.

      This value is prefixed with ``pcx-``.

   #. Click :guilabel:`Save`.

...
